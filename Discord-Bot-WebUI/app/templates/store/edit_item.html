{% extends "base.html" %}

{% block page_css %}

{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/store.css') }}" />
{% endif %}
{% endblock %}

{% block main_content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Page Header -->
    <div class="c-admin-header" data-component="admin-header">
        <div class="c-admin-header__content">
            <h1 class="c-admin-header__title">
                <i class="ti ti-edit me-2"></i>Edit Store Item
            </h1>
            <p class="c-admin-header__description">Update item details and availability</p>
        </div>
    </div>

    <!-- Navigation -->
    <div class="row mb-4">
        <div class="col-12">
            <a href="{{ url_for('store.admin') }}" class="c-btn c-btn--outline-secondary">
                <i class="ti ti-arrow-left me-1"></i> Back to Store Admin
            </a>
        </div>
    </div>

    <!-- Edit Item Form -->
    <div class="row">
        <div class="col-xl-8 col-lg-10 col-12 mx-auto">
            <div class="c-card" data-component="store-edit-form">
                <div class="c-card__header border-bottom">
                    <h5 class="c-card__title mb-0">Item Details</h5>
                </div>
                <div class="c-card__body">
                    <form method="POST" action="{{ url_for('store.edit_item', item_id=item.id) }}" data-form="edit-item">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="store-edit-item-name" class="form-label">Item Name *</label>
                                    <input type="text" class="form-control" id="store-edit-item-name" name="name" required
                                           value="{{ item.name }}" placeholder="e.g. Team Jersey, Training Bag" data-form-control>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="price" class="form-label">Price (Admin Only)</label>
                                    <div class="input-group" data-input-group>
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="price" name="price"
                                               step="0.01" min="0" value="{{ item.price or '' }}" placeholder="15.00" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="store-edit-item-description" class="form-label">Description</label>
                            <textarea class="form-control" id="store-edit-item-description" name="description" rows="3"
                                      placeholder="Describe the item, materials, features, etc." data-form-control>{{ item.description or '' }}</textarea>
                        </div>

                        <div class="mb-3">
                            <label for="category" class="form-label">Category</label>
                            <input type="text" class="form-control" id="category" name="category"
                                   value="{{ item.category or '' }}" placeholder="e.g. Apparel, Equipment, Accessories" data-form-control>
                        </div>

                        <div class="mb-3">
                            <label for="image_url" class="form-label">Image URL</label>
                            <input type="url" class="form-control" id="image_url" name="image_url"
                                   value="{{ item.image_url or '' }}" placeholder="https://example.com/image.jpg" data-form-control>
                            <div class="form-text">Provide a direct link to an image of the item</div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="store-edit-item-is_active" name="is_active"
                                       {% if item.is_active %}checked{% endif %} data-form-control>
                                <label class="form-check-label" for="store-edit-item-is_active">
                                    Item is active and available for ordering
                                </label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Available Colors</label>
                                    <div id="colors-container" data-container="colors">
                                        {% if item.available_colors %}
                                        {% set colors = item.available_colors | replace("'", '"') | fromjson %}
                                        {% for color in colors %}
                                        <div class="input-group mb-2" data-input-group>
                                            <input type="text" class="form-control" name="colors[]" value="{{ color }}" placeholder="e.g. Red, Blue, Green" data-form-control aria-label="e.g. Red, Blue, Green">
                                            <button type="button" class="c-btn c-btn--outline-danger remove-color {% if loop.first and loop.last %}d-none{% endif %}" data-action="remove-color" aria-label="Button"><i class="ti ti-x"></i></button>
                                        </div>
                                        {% endfor %}
                                        {% else %}
                                        <div class="input-group mb-2" data-input-group>
                                            <input type="text" class="form-control" name="colors[]" placeholder="e.g. Red, Blue, Green" data-form-control aria-label="e.g. Red, Blue, Green">
                                            <button type="button" class="c-btn c-btn--outline-danger remove-color d-none" data-action="remove-color" aria-label="Button"><i class="ti ti-x"></i></button>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <button type="button" class="c-btn c-btn--sm c-btn--outline-primary" id="add-color" data-action="add-color">
                                        <i class="ti ti-plus me-1"></i>Add Color
                                    </button>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Available Sizes</label>
                                    <div id="sizes-container" data-container="sizes">
                                        {% if item.available_sizes %}
                                        {% set sizes = item.available_sizes | replace("'", '"') | fromjson %}
                                        {% for size in sizes %}
                                        <div class="input-group mb-2" data-input-group>
                                            <input type="text" class="form-control" name="sizes[]" value="{{ size }}" placeholder="e.g. S, M, L, XL" data-form-control aria-label="e.g. S, M, L, XL">
                                            <button type="button" class="c-btn c-btn--outline-danger remove-size {% if loop.first and loop.last %}d-none{% endif %}" data-action="remove-size" aria-label="Button"><i class="ti ti-x"></i></button>
                                        </div>
                                        {% endfor %}
                                        {% else %}
                                        <div class="input-group mb-2" data-input-group>
                                            <input type="text" class="form-control" name="sizes[]" placeholder="e.g. S, M, L, XL" data-form-control aria-label="e.g. S, M, L, XL">
                                            <button type="button" class="c-btn c-btn--outline-danger remove-size d-none" data-action="remove-size" aria-label="Button"><i class="ti ti-x"></i></button>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <button type="button" class="c-btn c-btn--sm c-btn--outline-primary" id="add-size" data-action="add-size">
                                        <i class="ti ti-plus me-1"></i>Add Size
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="c-form-actions">
                            <a href="{{ url_for('store.admin') }}" class="c-btn c-btn--outline-secondary">
                                <i class="ti ti-x me-1"></i>Cancel
                            </a>
                            <button type="submit" class="c-btn c-btn--primary">
                                <i class="ti ti-device-floppy me-1"></i>Update Item
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
<!-- Store Edit Item Module loaded via Vite in production, or directly in development -->
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<script type="module" src="{{ url_for('static', filename='custom_js/store-edit-item.js') }}"></script>
{% endif %}
{% endblock %}
