<!-- ============================================================================
     MODERN NAVBAR COMPONENT - BEM ARCHITECTURE
     ============================================================================

     Modern navbar with strict BEM naming and event delegation patterns.

     Features:
     - 100% BEM naming (.c-navbar-modern__element--modifier)
     - Zero inline styles or scripts
     - Data-action attributes for all interactions
     - Full accessibility (ARIA, keyboard nav)
     - Mobile-first responsive design
     - Dark mode support

     ============================================================================ -->
<nav class="c-navbar-modern"
     id="navbar-modern"
     data-component="navbar"
     role="navigation"
     aria-label="Main navigation">

    <!-- Mobile Menu Toggle -->
    <div class="c-navbar-modern__menu-toggle" data-mobile-only>
        <button class="c-navbar-modern__toggle-btn"
                type="button"
                data-action="toggle-menu"
                aria-label="Toggle navigation menu"
                aria-expanded="false"
                aria-controls="navbar-content">
            <i class="ti ti-menu-2 c-navbar-modern__toggle-icon"></i>
        </button>
    </div>

    <!-- Navbar Content Container -->
    <div class="c-navbar-modern__content" id="navbar-content">

        <!-- Player Search -->
        <div class="c-navbar-modern__search" data-component="search">
            <form class="c-navbar-modern__search-form"
                  data-action="prevent-submit"
                  data-form="search"
                  role="search"
                  aria-label="Search players">
                <input type="text"
                       id="player-search"
                       name="query"
                       class="c-navbar-modern__search-input"
                       placeholder="Search players"
                       aria-label="Search for players"
                       data-input="search"
                       autocomplete="off">
            </form>
        </div>

        <!-- Navigation Actions -->
        <ul class="c-navbar-modern__nav" role="menubar">

            <!-- Theme Switcher -->
            <li class="c-navbar-modern__nav-item" role="none">
                <button class="c-navbar-modern__nav-btn"
                        type="button"
                        data-action="toggle-navbar-dropdown"
                        data-dropdown="theme"
                        aria-label="Switch theme"
                        aria-haspopup="true"
                        aria-expanded="false"
                        role="menuitem">
                    <i class="ti ti-sun c-navbar-modern__nav-icon" data-role="theme-icon"></i>
                </button>

                <!-- Theme Dropdown -->
                <div class="c-navbar-modern__dropdown c-navbar-modern__dropdown--theme"
                     data-dropdown-id="theme"
                     role="menu"
                     aria-hidden="true"
                     aria-label="Theme options">
                    <button class="c-navbar-modern__dropdown-item"
                            type="button"
                            data-action="switch-theme"
                            data-theme="light"
                            role="menuitem">
                        <i class="ti ti-sun c-navbar-modern__dropdown-icon"></i>
                        <span class="c-navbar-modern__dropdown-text">Light</span>
                    </button>
                    <button class="c-navbar-modern__dropdown-item"
                            type="button"
                            data-action="switch-theme"
                            data-theme="dark"
                            role="menuitem">
                        <i class="ti ti-moon-stars c-navbar-modern__dropdown-icon"></i>
                        <span class="c-navbar-modern__dropdown-text">Dark</span>
                    </button>
                    <button class="c-navbar-modern__dropdown-item"
                            type="button"
                            data-action="switch-theme"
                            data-theme="system"
                            role="menuitem">
                        <i class="ti ti-device-desktop-analytics c-navbar-modern__dropdown-icon"></i>
                        <span class="c-navbar-modern__dropdown-text">System</span>
                    </button>
                </div>
            </li>

            <!-- Role Impersonation (Global Admin Only) -->
            {% if 'Global Admin' in user_roles %}
            <li class="c-navbar-modern__nav-item" role="none" data-desktop-only>
                <button class="c-navbar-modern__nav-btn"
                        type="button"
                        data-action="toggle-navbar-dropdown"
                        data-dropdown="impersonation"
                        aria-label="Role impersonation"
                        aria-haspopup="true"
                        aria-expanded="false"
                        role="menuitem">
                    <i class="ti ti-user-check c-navbar-modern__nav-icon" data-role="impersonation-icon"></i>
                    <span class="c-navbar-modern__badge c-navbar-modern__badge--warning u-hidden"
                          data-badge="impersonation-active"
                          aria-label="Impersonation active"></span>
                </button>

                <!-- Role Impersonation Dropdown -->
                <div class="c-navbar-modern__dropdown c-navbar-modern__dropdown--impersonation"
                     data-dropdown-id="impersonation"
                     role="menu"
                     aria-hidden="true"
                     aria-label="Role impersonation options">

                    <!-- Header -->
                    <div class="c-navbar-modern__dropdown-header">
                        <h6 class="c-navbar-modern__dropdown-title">View As Role</h6>
                        <button class="c-navbar-modern__icon-btn"
                                type="button"
                                data-action="refresh-roles"
                                aria-label="Refresh roles list">
                            <i class="ti ti-refresh"></i>
                        </button>
                    </div>

                    <div class="c-navbar-modern__dropdown-divider"></div>

                    <!-- Current Status -->
                    <div class="c-navbar-modern__dropdown-section">
                        <div class="c-navbar-modern__role-status" id="currentRoleStatus" data-status>
                            <i class="ti ti-user c-navbar-modern__role-status-icon"></i>
                            <span class="c-navbar-modern__role-status-text">Loading status...</span>
                        </div>
                    </div>

                    <!-- Stop Impersonation Button -->
                    <div class="c-navbar-modern__dropdown-section u-hidden" data-section="stop-impersonation">
                        <button class="c-btn c-btn--danger c-btn--sm c-btn--block"
                                type="button"
                                data-action="stop-impersonation"
                                id="stopImpersonationBtn">
                            <i class="ti ti-x"></i>
                            <span>Stop Impersonation</span>
                        </button>
                    </div>

                    <!-- Role Selection -->
                    <div class="c-navbar-modern__dropdown-section">
                        <label class="c-navbar-modern__dropdown-label" for="roleSelect">
                            Select Role(s) to View As:
                        </label>
                        <select class="c-navbar-modern__role-select"
                                id="roleSelect"
                                multiple
                                data-select="roles"
                                aria-label="Select roles to impersonate">
                            <option value="">Loading roles...</option>
                        </select>
                    </div>

                    <!-- Start Impersonation Button -->
                    <div class="c-navbar-modern__dropdown-section">
                        <button class="c-btn c-btn--primary c-btn--sm c-btn--block"
                                type="button"
                                data-action="start-impersonation"
                                id="startImpersonationBtn"
                                disabled>
                            <i class="ti ti-eye"></i>
                            <span>Start Viewing As Selected Roles</span>
                        </button>
                    </div>

                    <div class="c-navbar-modern__dropdown-divider"></div>

                    <!-- Help Text -->
                    <div class="c-navbar-modern__dropdown-section">
                        <p class="c-navbar-modern__dropdown-help">
                            <i class="ti ti-info-circle"></i>
                            This allows you to view the application as if you have different roles. Perfect for testing permissions without switching accounts.
                        </p>
                    </div>
                </div>
            </li>
            {% endif %}

            <!-- Messages -->
            {% if safe_current_user.is_authenticated %}
            <li class="c-navbar-modern__nav-item" role="none">
                <a href="{{ url_for('messages_pages.messages_inbox') }}"
                   class="c-navbar-modern__nav-btn"
                   aria-label="View messages"
                   role="menuitem"
                   title="Messages">
                    <i class="ti ti-message-circle c-navbar-modern__nav-icon"></i>
                    <span class="c-navbar-modern__badge c-navbar-modern__badge--primary u-hidden"
                          data-badge="messages-count"
                          aria-label="Unread messages"></span>
                </a>
            </li>
            {% endif %}

            <!-- Notifications -->
            <li class="c-navbar-modern__nav-item" role="none">
                <button class="c-navbar-modern__nav-btn"
                        type="button"
                        data-action="toggle-navbar-dropdown"
                        data-dropdown="notifications"
                        aria-label="View notifications"
                        aria-haspopup="true"
                        aria-expanded="false"
                        role="menuitem">
                    <i class="ti ti-bell c-navbar-modern__nav-icon"></i>
                    <span class="c-navbar-modern__badge c-navbar-modern__badge--danger u-hidden"
                          id="notification-badge"
                          data-badge="notification-count"
                          aria-label="Unread notifications"></span>
                </button>

                <!-- Notifications Dropdown -->
                <div class="c-navbar-modern__dropdown c-navbar-modern__dropdown--notifications"
                     data-dropdown-id="notifications"
                     role="menu"
                     aria-hidden="true"
                     aria-label="Notifications">

                    <!-- Header -->
                    <div class="c-navbar-modern__dropdown-header c-navbar-modern__dropdown-header--sticky">
                        <h6 class="c-navbar-modern__dropdown-title">Notifications</h6>
                        <div class="c-navbar-modern__dropdown-actions">
                            <span class="c-badge c-badge--primary" id="notification-count" data-count>0</span>
                            <button class="c-navbar-modern__icon-btn"
                                    type="button"
                                    data-action="mark-all-read"
                                    aria-label="Mark all notifications as read"
                                    title="Mark all as read">
                                <i class="ti ti-mail-opened"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Notifications List -->
                    <div class="c-navbar-modern__notifications-list" id="notifications-list" data-list>
                        {% if notifications and notifications|length > 0 %}
                        <ul class="c-navbar-modern__notifications" role="list">
                            {% for notification in notifications %}
                            <li class="c-navbar-modern__notification {% if not notification.read %}c-navbar-modern__notification--unread{% endif %}"
                                data-notification-id="{{ notification.id }}"
                                role="listitem">
                                <div class="c-navbar-modern__notification-icon">
                                    <i class="{{ notification.icon }}"></i>
                                </div>
                                <div class="c-navbar-modern__notification-content">
                                    <p class="c-navbar-modern__notification-text">{{ notification.content }}</p>
                                    <span class="c-navbar-modern__notification-time">{{ notification.created_at.strftime('%b %d, %I:%M %p') }}</span>
                                </div>
                                <button class="c-navbar-modern__notification-action"
                                        type="button"
                                        data-action="mark-read"
                                        data-notification-id="{{ notification.id }}"
                                        aria-label="Mark as read">
                                    <span class="c-navbar-modern__badge-dot"></span>
                                </button>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <div class="c-navbar-modern__empty-state">
                            <i class="ti ti-bell-off c-navbar-modern__empty-icon"></i>
                            <p class="c-navbar-modern__empty-text">No notifications</p>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Footer -->
                    <div class="c-navbar-modern__dropdown-footer">
                        <a href="{{ url_for('main.notifications') }}"
                           class="c-btn c-btn--primary c-btn--sm c-btn--block"
                           data-action="view-all-notifications">
                            View all notifications
                        </a>
                    </div>
                </div>
            </li>

            <!-- User Profile -->
            <li class="c-navbar-modern__nav-item" role="none">
                {% if safe_current_user.is_authenticated %}
                <button class="c-navbar-modern__nav-btn c-navbar-modern__nav-btn--avatar"
                        type="button"
                        data-action="toggle-navbar-dropdown"
                        data-dropdown="profile"
                        aria-label="User profile menu"
                        aria-haspopup="true"
                        aria-expanded="false"
                        role="menuitem">
                    <div class="c-navbar-modern__avatar">
                        {% if safe_current_user.player %}
                        <img src="{{ safe_current_user.player.profile_picture_url if safe_current_user.player.profile_picture_url else url_for('static', filename='img/default_player.png') }}"
                             alt="{{ safe_current_user.player.name }}"
                             class="c-navbar-modern__avatar-img">
                        {% else %}
                        <img src="{{ url_for('static', filename='img/default_player.png') }}"
                             alt="Default Profile Picture"
                             class="c-navbar-modern__avatar-img">
                        {% endif %}
                        <span class="c-navbar-modern__avatar-status" data-status="online"></span>
                    </div>
                </button>

                <!-- Profile Dropdown -->
                <div class="c-navbar-modern__dropdown c-navbar-modern__dropdown--profile"
                     data-dropdown-id="profile"
                     role="menu"
                     aria-hidden="true"
                     aria-label="User profile options">

                    {% if safe_current_user.player %}
                    <!-- Profile Header -->
                    <a href="{{ url_for('players.player_profile', player_id=safe_current_user.player.id) }}"
                       class="c-navbar-modern__profile-header"
                       data-action="view-profile">
                        <div class="c-navbar-modern__avatar c-navbar-modern__avatar--lg">
                            <img src="{{ safe_current_user.player.profile_picture_url if safe_current_user.player.profile_picture_url else url_for('static', filename='img/default_player.png') }}"
                                 alt="{{ safe_current_user.player.name }}"
                                 class="c-navbar-modern__avatar-img">
                            <span class="c-navbar-modern__avatar-status" data-status="online"></span>
                        </div>
                        <h6 class="c-navbar-modern__profile-name">{{ safe_current_user.player.name }}</h6>
                    </a>

                    <div class="c-navbar-modern__dropdown-divider"></div>

                    <!-- Profile Menu Items -->
                    <a href="{{ url_for('players.player_profile', player_id=safe_current_user.player.id) }}"
                       class="c-navbar-modern__dropdown-item"
                       role="menuitem">
                        <i class="ti ti-user c-navbar-modern__dropdown-icon"></i>
                        <span class="c-navbar-modern__dropdown-text">My Profile</span>
                    </a>
                    <a href="{{ url_for('account.settings') }}"
                       class="c-navbar-modern__dropdown-item"
                       role="menuitem">
                        <i class="ti ti-settings c-navbar-modern__dropdown-icon"></i>
                        <span class="c-navbar-modern__dropdown-text">Settings</span>
                    </a>

                    <div class="c-navbar-modern__dropdown-divider"></div>

                    {% else %}
                    <!-- No Player Profile -->
                    <a href="{{ url_for('players.create_profile') }}"
                       class="c-navbar-modern__dropdown-item"
                       role="menuitem">
                        <i class="ti ti-user-plus c-navbar-modern__dropdown-icon"></i>
                        <span class="c-navbar-modern__dropdown-text">Create Player Profile</span>
                    </a>

                    <div class="c-navbar-modern__dropdown-divider"></div>
                    {% endif %}

                    <!-- Logout -->
                    <form action="{{ url_for('auth.logout') }}"
                          method="post"
                          id="logout-form"
                          class="u-hidden">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    </form>
                    <button class="c-navbar-modern__dropdown-item c-navbar-modern__dropdown-item--logout"
                            type="button"
                            data-action="logout"
                            role="menuitem">
                        <span class="c-navbar-modern__dropdown-text">Logout</span>
                        <i class="ti ti-logout c-navbar-modern__dropdown-icon"></i>
                    </button>

                {% else %}
                <!-- Not Authenticated - Login/Register Links -->
                <button class="c-navbar-modern__nav-btn c-navbar-modern__nav-btn--avatar"
                        type="button"
                        data-action="toggle-navbar-dropdown"
                        data-dropdown="auth"
                        aria-label="Authentication menu"
                        aria-haspopup="true"
                        aria-expanded="false"
                        role="menuitem">
                    <div class="c-navbar-modern__avatar">
                        <img src="{{ url_for('static', filename='img/default_player.png') }}"
                             alt="Guest User"
                             class="c-navbar-modern__avatar-img">
                    </div>
                </button>

                <!-- Auth Dropdown -->
                <div class="c-navbar-modern__dropdown c-navbar-modern__dropdown--auth"
                     data-dropdown-id="auth"
                     role="menu"
                     aria-hidden="true"
                     aria-label="Authentication options">
                    <a href="{{ url_for('auth.login') }}"
                       class="c-navbar-modern__dropdown-item"
                       role="menuitem">
                        <i class="ti ti-login c-navbar-modern__dropdown-icon"></i>
                        <span class="c-navbar-modern__dropdown-text">Login</span>
                    </a>
                    <a href="{{ url_for('auth.register') }}"
                       class="c-navbar-modern__dropdown-item"
                       role="menuitem">
                        <i class="ti ti-user-plus c-navbar-modern__dropdown-icon"></i>
                        <span class="c-navbar-modern__dropdown-text">Register</span>
                    </a>
                </div>
                {% endif %}
            </li>
        </ul>
    </div>
</nav>

{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<!-- Link to Modern Navbar Styles (use components version, NOT layout version) -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/navbar-modern.css') }}">

<!-- Link to Modern Navbar JavaScript -->
<script src="{{ url_for('static', filename='js/navbar-modern.js') }}" defer></script>
{% endif %}
