{% extends "base.html" %}

{% block page_css %}
<!-- Admin Dashboard Styles -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/admin/admin-dashboard.css') }}" />
{% endblock %}

{% block main_content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="c-admin-header" data-component="admin-header">
                <div class="c-admin-header__content">
                    <h2 class="c-admin-header__title">Admin Dashboard</h2>
                    <p class="c-admin-header__description">Manage system configuration, roles, and container status</p>
                </div>
                <div class="c-admin-header__actions">
                    <button class="c-btn c-btn--primary" data-action="refresh-containers">
                        <i class="ti ti-refresh"></i>
                        <span>Refresh Containers</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Manage Roles and Permissions Section -->
        <div class="col-xl-6 mb-4">
            <div class="c-admin-card" data-component="permissions-card">
                <div class="c-admin-card__header">
                    <h5 class="c-admin-card__title">Manage Roles & Permissions</h5>
                </div>
                <div class="c-admin-card__body">
                    <form method="POST" action="{{ url_for('admin.admin_dashboard') }}" data-form="permissions-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="action" value="update_permissions">

                        <div class="c-form-group" data-form-group>
                            <label for="role_id" class="c-form-label c-form-label--required">Select Role</label>
                            <select name="role_id" id="role_id" class="c-form-select" required data-form-select>
                                <option value="" disabled selected>Select a role...</option>
                                {% for role in roles %}
                                <option value="{{ role.id }}">{{ role.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="c-form-group" data-form-group>
                            <label for="permissions" class="c-form-label">Assign Permissions</label>
                            <select name="permissions" id="permissions" class="c-form-select select2-multiple" multiple data-form-select>
                                {% for permission in permissions %}
                                <option value="{{ permission.id }}">{{ permission.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <button type="submit" class="c-btn c-btn--primary" data-action="submit-permissions">
                            <i class="ti ti-check"></i>
                            <span>Update Permissions</span>
                        </button>
                    </form>

                    <hr class="c-divider">

                    <h6 class="c-section-title">Current Permissions</h6>
                    <ul id="current-permissions-list" class="c-permissions-list" data-component="permissions-list">
                        <li class="c-permissions-list__item c-permissions-list__item--empty">Select a role to view permissions.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Quick Links Section -->
        <div class="col-xl-6 mb-4">
            <div class="c-admin-card" data-component="quick-links-card">
                <div class="c-admin-card__header">
                    <h5 class="c-admin-card__title">Quick Admin Links</h5>
                </div>
                <div class="c-admin-card__body">
                    <div class="c-quick-links" data-component="quick-links">
                        <a href="{{ url_for('admin.message_config.list_categories') }}" class="c-quick-links__item" data-action="navigate-to-messages">
                            <i class="ti ti-message-2 c-quick-links__icon c-quick-links__icon--primary"></i>
                            <div class="c-quick-links__content">
                                <h6 class="c-quick-links__title">Message Management</h6>
                                <p class="c-quick-links__description">Manage Discord bot messages and website announcements</p>
                            </div>
                        </a>
                        <a href="{{ url_for('admin.manage_polls') }}" class="c-quick-links__item" data-action="navigate-to-polls">
                            <i class="ti ti-chart-bar c-quick-links__icon c-quick-links__icon--success"></i>
                            <div class="c-quick-links__content">
                                <h6 class="c-quick-links__title">League Polls</h6>
                                <p class="c-quick-links__description">Create and manage league polls</p>
                            </div>
                        </a>
                        <a href="{{ url_for('admin.user_approvals') }}" class="c-quick-links__item" data-action="navigate-to-approvals">
                            <i class="ti ti-users c-quick-links__icon c-quick-links__icon--warning"></i>
                            <div class="c-quick-links__content">
                                <h6 class="c-quick-links__title">User Approvals</h6>
                                <p class="c-quick-links__description">Approve pending user registrations</p>
                            </div>
                        </a>
                        <a href="{{ url_for('admin.user_waitlist') }}" class="c-quick-links__item" data-action="navigate-to-waitlist">
                            <i class="ti ti-clock c-quick-links__icon c-quick-links__icon--info"></i>
                            <div class="c-quick-links__content">
                                <h6 class="c-quick-links__title">User Waitlist</h6>
                                <p class="c-quick-links__description">Manage users on the waitlist</p>
                            </div>
                        </a>
                        <a href="{{ url_for('monitoring.monitor_dashboard') }}" class="c-quick-links__item" data-action="navigate-to-monitoring">
                            <i class="ti ti-chart-dots c-quick-links__icon c-quick-links__icon--info"></i>
                            <div class="c-quick-links__content">
                                <h6 class="c-quick-links__title">System Monitoring</h6>
                                <p class="c-quick-links__description">Monitor system tasks and performance</p>
                            </div>
                        </a>
                        <a href="#" class="c-quick-links__item" data-action="open-task-management">
                            <i class="ti ti-list-check c-quick-links__icon c-quick-links__icon--primary"></i>
                            <div class="c-quick-links__content">
                                <h6 class="c-quick-links__title">Task Management</h6>
                                <p class="c-quick-links__description">Monitor and manage Celery tasks</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Docker Containers Status Section -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="c-admin-card" data-component="docker-status-card">
                <div class="c-admin-card__header">
                    <h5 class="c-admin-card__title">Docker Containers Status</h5>
                </div>
                <div class="c-admin-card__body">
                    <div id="dockerStatusContainer" class="row" data-container="docker-status">
                        <div class="col-12 text-center py-5">
                            <div class="c-loading-spinner" role="status" data-loading></div>
                            <p class="c-loading-text">Loading container status...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Management Section -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="c-admin-card" data-component="task-management-card">
                <div class="c-admin-card__header">
                    <h5 class="c-admin-card__title">Global Task Management</h5>
                    <div class="c-admin-card__actions">
                        <div class="c-button-group">
                            <button class="c-btn c-btn--primary c-btn--sm" data-action="refresh-task-list">
                                <i class="ti ti-refresh"></i>
                                <span>Refresh</span>
                            </button>
                            <button class="c-btn c-btn--outline-warning c-btn--sm" data-action="cleanup-old-tasks">
                                <i class="ti ti-broom"></i>
                                <span>Cleanup</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="c-admin-card__body">
                    <div id="taskManagementContainer" data-container="task-management">
                        <div class="text-center py-4">
                            <button class="c-btn c-btn--outline-primary" data-action="load-task-management">
                                <i class="ti ti-list-check"></i>
                                <span>Load Task Management</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3" data-container="toasts"></div>

<!-- Docker Logs Modal -->
<div class="c-modal" id="dockerLogsModal" aria-hidden="true" aria-labelledby="dockerLogsModalLabel" data-modal="docker-logs">
    <div class="c-modal__backdrop" data-modal-backdrop></div>
    <div class="c-modal__dialog c-modal__dialog--lg">
        <div class="c-modal__content">
            <div class="c-modal__header">
                <h3 class="c-modal__title" id="dockerLogsModalLabel">Container Logs</h3>
                <button class="c-modal__close" data-action="close-modal" data-modal-id="dockerLogsModal" aria-label="Close">
                    <i class="ti ti-x"></i>
                </button>
            </div>
            <div class="c-modal__body">
                <pre id="dockerLogsContent" class="c-code-block"></pre>
            </div>
            <div class="c-modal__footer">
                <button type="button" class="c-btn c-btn--secondary" data-action="close-modal" data-modal-id="dockerLogsModal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
<!-- Admin Dashboard Module - Handles Docker containers, tasks, and permissions -->
<script src="{{ url_for('static', filename='js/admin/admin-dashboard.js') }}"></script>
{% endblock %}
