{% extends "base_flowbite.html" %}

{% block title %}Admin Reports{% endblock %}

{% block main_content %}
<div class="container mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">All Feedback</h1>
        <p class="text-gray-500 dark:text-gray-400">View and manage user feedback and reports</p>
    </div>

    <!-- Filters -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div>
            <label for="filterStatus" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Status</label>
            <select id="filterStatus"
                    class="block w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-ecs-green focus:ring-ecs-green">
                <option value="">All Statuses</option>
                <option value="Open" {% if request.args.get('status') == 'Open' %}selected{% endif %}>Open</option>
                <option value="In Progress" {% if request.args.get('status') == 'In Progress' %}selected{% endif %}>In Progress</option>
                <option value="Closed" {% if request.args.get('status') == 'Closed' %}selected{% endif %}>Closed</option>
            </select>
        </div>
        <div>
            <label for="filterPriority" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Priority</label>
            <select id="filterPriority"
                    class="block w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-ecs-green focus:ring-ecs-green">
                <option value="">All Priorities</option>
                <option value="Low" {% if request.args.get('priority') == 'Low' %}selected{% endif %}>Low</option>
                <option value="Medium" {% if request.args.get('priority') == 'Medium' %}selected{% endif %}>Medium</option>
                <option value="High" {% if request.args.get('priority') == 'High' %}selected{% endif %}>High</option>
            </select>
        </div>
    </div>

    <!-- Reports Table -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700">
            <h2 class="font-semibold text-gray-900 dark:text-white">Feedback Reports</h2>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">ID</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hidden md:table-cell">Category</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Title</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            <a href="{{ url_for('admin.admin_reports', sort_by='priority', order='asc' if request.args.get('order') != 'asc' else 'desc') }}" class="flex items-center gap-1 hover:text-gray-700 dark:hover:text-gray-300">
                                Priority
                                {% if request.args.get('sort_by') == 'priority' %}
                                <i class="ti ti-arrow-{% if request.args.get('order') == 'asc' %}up{% else %}down{% endif %}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                            <a href="{{ url_for('admin.admin_reports', sort_by='status', order='asc' if request.args.get('order') != 'asc' else 'desc') }}" class="flex items-center gap-1 hover:text-gray-700 dark:hover:text-gray-300">
                                Status
                                {% if request.args.get('sort_by') == 'status' %}
                                <i class="ti ti-arrow-{% if request.args.get('order') == 'asc' %}up{% else %}down{% endif %}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hidden lg:table-cell">Submitted By</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider hidden lg:table-cell">
                            <a href="{{ url_for('admin.admin_reports', sort_by='created_at', order='asc' if request.args.get('order') != 'asc' else 'desc') }}" class="flex items-center gap-1 hover:text-gray-700 dark:hover:text-gray-300">
                                Date
                                {% if request.args.get('sort_by') == 'created_at' %}
                                <i class="ti ti-arrow-{% if request.args.get('order') == 'asc' %}up{% else %}down{% endif %}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                    {% for feedback in feedbacks %}
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                        <td class="px-4 py-3 text-gray-900 dark:text-white font-medium">#{{ feedback.id }}</td>
                        <td class="px-4 py-3 text-gray-600 dark:text-gray-300 hidden md:table-cell">{{ feedback.category }}</td>
                        <td class="px-4 py-3 text-gray-900 dark:text-white">
                            <div class="max-w-xs truncate">{{ feedback.title }}</div>
                        </td>
                        <td class="px-4 py-3">
                            {% if feedback.priority == 'Low' %}
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300">{{ feedback.priority }}</span>
                            {% elif feedback.priority == 'Medium' %}
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 dark:bg-yellow-900/50 text-yellow-700 dark:text-yellow-300">{{ feedback.priority }}</span>
                            {% elif feedback.priority == 'High' %}
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300">{{ feedback.priority }}</span>
                            {% else %}
                            {{ feedback.priority }}
                            {% endif %}
                        </td>
                        <td class="px-4 py-3">
                            {% if feedback.status == 'Open' %}
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300">{{ feedback.status }}</span>
                            {% elif feedback.status == 'In Progress' %}
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-cyan-100 dark:bg-cyan-900/50 text-cyan-700 dark:text-cyan-300">{{ feedback.status }}</span>
                            {% elif feedback.status == 'Closed' %}
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300">{{ feedback.status }}</span>
                            {% else %}
                            {{ feedback.status }}
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 text-gray-600 dark:text-gray-300 hidden lg:table-cell">
                            {% if feedback.user %}
                            {{ feedback.user.username }}
                            {% else %}
                            <span class="text-gray-400">Anonymous</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 text-gray-600 dark:text-gray-300 hidden lg:table-cell">
                            {{ feedback.created_at.strftime('%Y-%m-%d %H:%M') }}
                        </td>
                        <td class="px-4 py-3 text-right">
                            <a href="{{ url_for('admin.view_feedback', feedback_id=feedback.id) }}"
                               class="inline-flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-ecs-green text-white hover:bg-ecs-green/90 transition-colors">
                                <i class="ti ti-edit"></i>
                                View
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" class="px-4 py-12 text-center">
                            <div class="w-16 h-16 mx-auto rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4">
                                <i class="ti ti-message-off text-2xl text-gray-400"></i>
                            </div>
                            <p class="text-gray-500 dark:text-gray-400">No feedback reports found</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
<script src="{{ url_for('static', filename='custom_js/admin-reports.js') }}"></script>
<script>
AdminReports.init();
</script>
{% endblock %}
