{% extends "base_unauthenticated.html" %}

{% block page_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/authentication.css') }}" />
{% endblock %}

{% block main_content %}

<div class="c-auth-wrapper" data-component="auth-wrapper">
    <!-- ECS Logo -->
    <div class="c-auth-logo" data-component="auth-logo">
        <img src="{{ url_for('static', filename='img/ecs_logo.png') }}"
             alt="ECS Logo"
             class="c-auth-logo__image">
    </div>

    <!-- Reset Password Form -->
    <div class="c-auth-form" data-component="auth-form">
        <div class="c-auth-form__header">
            <h1 class="c-auth-form__title">Reset Password</h1>
            <p class="c-auth-form__subtitle">Enter your new password below</p>
        </div>

        <div class="c-auth-form__body">
            <form method="POST"
                  action="{{ url_for('auth.reset_password_token', token=token) }}"
                  data-form="reset-password">
                {{ empty_form.hidden_tag() }}

                <div class="c-auth-input-group c-auth-input-group--password">
                    {{ form.password(class="c-auth-input", placeholder="Enter New Password...", **{"data-input": "password"}) }}
                    <button type="button"
                            class="c-auth-password-toggle"
                            data-action="toggle-password"
                            aria-label="Toggle password visibility">
                        <i class="ti ti-eye-off"></i>
                    </button>
                </div>

                <div class="c-auth-input-group c-auth-input-group--password">
                    {{ form.password_confirm(class="c-auth-input", placeholder="Confirm New Password...", **{"data-input": "password-confirm"}) }}
                    <button type="button"
                            class="c-auth-password-toggle"
                            data-action="toggle-password-confirm"
                            aria-label="Toggle password confirmation visibility">
                        <i class="ti ti-eye-off"></i>
                    </button>
                </div>

                <button type="submit" class="c-auth-btn c-auth-btn--primary">
                    Reset Password
                </button>
            </form>

            <div class="c-auth-form__footer c-auth-form__footer--mt-lg">
                <p class="c-auth-form__footer-text">
                    <span>Already have an account? </span>
                    <a href="{{ url_for('auth.login') }}" class="c-auth-link">Login</a>
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Event delegation for password toggle
        document.addEventListener('click', function(e) {
            const target = e.target.closest('[data-action]');
            if (!target) return;

            const action = target.dataset.action;

            if (action === 'toggle-password' || action === 'toggle-password-confirm') {
                const inputGroup = target.closest('.c-auth-input-group--password');
                const passwordField = inputGroup.querySelector('[data-input]');

                if (passwordField) {
                    const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordField.setAttribute('type', type);
                    const icon = target.querySelector('i');
                    if (icon) {
                        icon.classList.toggle('ti-eye');
                        icon.classList.toggle('ti-eye-off');
                    }
                }
            }
        });
    });
</script>
{% endif %}
{% endblock %}
