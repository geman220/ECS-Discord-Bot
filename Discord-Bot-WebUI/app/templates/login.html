{% extends "base_unauthenticated.html" %}

{% block page_css %}

{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/authentication.css') }}" />
{% endif %}
{% endblock %}

{% block main_content %}
<div class="c-auth-wrapper" data-component="auth-wrapper">
    <!-- Logo Section -->
    <div class="c-auth-logo" data-component="auth-logo">
        <img src="{{ url_for('static', filename='img/ecs_logo.png') }}"
             alt="ECS Logo"
             class="c-auth-logo__image">
        <div class="c-auth-logo__divider"></div>
        <img src="{{ url_for('static', filename='img/ecs_pl_logo.png') }}"
             alt="ECS FC Pub League Logo"
             class="c-auth-logo__image">
    </div>

    <!-- Login Form -->
    <div class="c-auth-form" data-component="auth-form">
        <div class="c-auth-form__header">
            <h1 class="c-auth-form__title">Welcome Back</h1>
            <p class="c-auth-form__subtitle">Sign in to access your ECS FC account</p>
        </div>

        <div class="c-auth-form__body">
            <!-- Discord Login - Primary Action -->
            <a href="{{ url_for('auth.discord_login') }}"
               class="c-auth-btn c-auth-btn--discord"
               data-action="discord-login">
                <i class="ti ti-brand-discord c-auth-btn__icon"></i>
                Sign In with Discord
            </a>

            {% if safe_current_user.is_anonymous %}
            <!-- Discord Registration - Secondary Action -->
            <a href="{{ url_for('auth.discord_register') }}"
               class="c-auth-btn c-auth-btn--outline"
               data-action="discord-register">
                <i class="ti ti-user-plus c-auth-btn__icon"></i>
                New? Register with Discord
            </a>

            <!-- Waitlist Registration -->
            <a href="{{ url_for('auth.waitlist_register') }}"
               class="c-auth-btn c-auth-btn--warning"
               data-action="waitlist-register">
                <i class="ti ti-clock c-auth-btn__icon"></i>
                Join the Waitlist
            </a>

            <!-- More Options Toggle (for email login) -->
            <div class="c-auth-divider">
                <span class="c-auth-divider__text" data-action="toggle-options">More Options</span>
            </div>

            <!-- Hidden Email Login Section -->
            <div id="additional-options" class="is-hidden" data-container="additional-options">
                <!-- Email Login Form -->
                <form method="POST"
                      action="{{ url_for('auth.login') }}"
                      class="c-auth-email-form"
                      data-form="email-login">
                    {{ form.hidden_tag() }}

                    <div class="c-auth-input-group">
                        {{ form.email(class="c-auth-input", placeholder="Email address", **{"data-input": "email"}) }}
                    </div>

                    <div class="c-auth-input-group c-auth-input-group--password">
                        {{ form.password(class="c-auth-input", placeholder="Password", **{"data-input": "password"}) }}
                        <button type="button"
                                class="c-auth-password-toggle"
                                data-action="toggle-password"
                                aria-label="Toggle password visibility">
                            <i class="ti ti-eye-off"></i>
                        </button>
                    </div>

                    <div class="c-auth-form-row">
                        <div class="c-auth-checkbox">
                            {{ form.remember(class="c-auth-checkbox__input", id="remember-me") }}
                            {{ form.remember.label(class="c-auth-checkbox__label", for="remember-me") }}
                        </div>
                        <a href="{{ url_for('auth.forgot_password') }}" class="c-auth-link">Forgot Password?</a>
                    </div>

                    <button type="submit" class="c-auth-btn c-auth-btn--primary">Sign In with Email</button>
                </form>
            </div>

            <!-- Info Alert -->
            {% if session.get('waitlist_intent') %}
            <div class="c-auth-alert c-auth-alert--warning" data-alert>
                <h6 class="c-auth-alert__title">Join the Waitlist</h6>
                <p class="c-auth-alert__text">
                    Login to join the waitlist for the current season. You'll be notified when spots become available.
                </p>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
{# Auth actions (toggle-password, toggle-options) are handled by event-delegation/handlers/auth-actions.js #}
{% endblock %}
