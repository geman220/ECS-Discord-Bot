<!-- Sidebar Menu -->
<aside id="layout-menu" class="c-sidebar" role="navigation" aria-label="Main navigation" data-component="sidebar">
    <!-- Header with Logo and Toggle -->
    <div class="c-sidebar__header">
        <a href="{{ url_for('main.index') }}" class="c-sidebar__brand" data-action="navigate-home">
            <span class="c-sidebar__logo">
                <img src="{{ url_for('static', filename='img/ecs_logo.png') }}" alt="ECS Logo" class="c-sidebar__logo-img">
            </span>
            <span class="c-sidebar__brand-text">ECS</span>
        </a>

        <button type="button" class="c-sidebar__toggle" data-action="toggle-sidebar" aria-label="Toggle navigation menu">
            <i class="ti ti-menu-2 c-sidebar__toggle-icon c-sidebar__toggle-icon--desktop" aria-hidden="true"></i>
            <i class="ti ti-x c-sidebar__toggle-icon c-sidebar__toggle-icon--mobile" aria-hidden="true"></i>
        </button>
    </div>

    <div class="c-sidebar__shadow"></div>

    <!-- Main Navigation -->
    <!-- Note: menu-inner class required for Vuexy menu.js PerfectScrollbar compatibility -->
    <nav class="c-sidebar__nav menu-inner">
        <ul class="c-sidebar__list" role="list">
            <!-- Main Section Header -->
            <li class="c-sidebar__header-item" role="presentation">
                <span class="c-sidebar__header-label">Main</span>
            </li>

            <!-- Dashboard -->
            {% if safe_current_user.is_authenticated %}
            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'main.index' }}" role="none">
                <a class="c-sidebar__link" href="{{ url_for('main.index') }}" data-action="navigate" role="menuitem">
                    <i data-feather="home" class="c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Dashboard</span>
                </a>
            </li>
            {% endif %}

            <!-- Feedback -->
            {% if safe_current_user.is_authenticated %}
            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'feedback.submit_feedback' }}" role="none">
                <a class="c-sidebar__link" href="{{ url_for('feedback.submit_feedback') }}" data-action="navigate" role="menuitem">
                    <i data-feather="alert-circle" class="c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Submit Feedback / Bug</span>
                </a>
            </li>
            {% endif %}

            <!-- Coach Dashboard -->
            {% if 'Pub League Coach' in user_roles or 'ECS FC Coach' in user_roles or 'Pub League Admin' in user_roles or 'Global Admin' in user_roles %}
            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'teams.coach_dashboard' }}" role="none">
                <a class="c-sidebar__link" href="{{ url_for('teams.coach_dashboard') }}" data-action="navigate" role="menuitem">
                    <i data-feather="clipboard" class="c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Coach Dashboard</span>
                </a>
            </li>
            {% endif %}

            <!-- Help Topics -->
            {% if safe_current_user.is_authenticated %}
            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'help.index' }}" role="none">
                <a class="c-sidebar__link" href="{{ url_for('help.index') }}" data-action="navigate" role="menuitem">
                    <i data-feather="help-circle" class="c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Help Topics</span>
                </a>
            </li>
            {% endif %}

            {% set can_view_season_management = 'Pub League Admin' in user_roles or 'Global Admin' in user_roles %}
            {% set can_view_draft = 'Pub League Admin' in user_roles or 'Global Admin' in user_roles or 'Pub League Coach' in user_roles or 'ECS FC Coach' in user_roles %}
            {% set can_view_draft_predictions = 'Pub League Admin' in user_roles or 'Global Admin' in user_roles or 'Pub League Coach' in user_roles %}
            {% set can_view_teams = 'Pub League Admin' in user_roles or 'Global Admin' in user_roles or 'Pub League Coach' in user_roles or 'ECS FC Coach' in user_roles or 'pl-classic' in user_roles or 'pl-ecs-fc' in user_roles or 'pl-premier' in user_roles %}
            {% set can_view_standings = 'Pub League Admin' in user_roles or 'Global Admin' in user_roles or 'Pub League Coach' in user_roles or 'ECS FC Coach' in user_roles %}
            {% set can_view_calendar = 'Pub League Admin' in user_roles or 'Global Admin' in user_roles or 'Pub League Coach' in user_roles or 'ECS FC Coach' in user_roles or 'Pub League Ref' in user_roles %}
            {% set can_view_any_ecsfc_section = can_view_season_management or can_view_draft or can_view_draft_predictions or can_view_standings or can_view_calendar or can_view_teams %}

            <!-- ECS FC League Section -->
            {% if can_view_any_ecsfc_section %}
            <li class="c-sidebar__header-item" role="presentation">
                <span class="c-sidebar__header-label">ECS FC League</span>
            </li>

            {% if can_view_season_management %}
            <!-- League Management Hub -->
            <li class="c-sidebar__item c-sidebar__item--expandable {{ 'is-open' if 'league_management' in request.endpoint }}" role="none" data-expandable>
                <button type="button" class="c-sidebar__link c-sidebar__link--toggle" data-action="toggle-submenu" aria-expanded="{{ 'true' if 'league_management' in request.endpoint else 'false' }}" role="menuitem">
                    <i class="ti ti-tournament c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">League Management <span class="c-badge c-badge--success c-badge--sm" data-badge aria-label="New feature">NEW</span></span>
                    <i class="c-sidebar__chevron ti ti-chevron-down" aria-hidden="true"></i>
                </button>
                <ul class="c-sidebar__submenu" role="list">
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin_panel.league_management_dashboard' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin_panel.league_management_dashboard') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">League Hub Dashboard</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin_panel.season_wizard' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin_panel.season_wizard') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Season Wizard</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin_panel.league_management_teams' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin_panel.league_management_teams') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Teams</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin_panel.league_management_seasons' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin_panel.league_management_seasons') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Seasons</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin_panel.league_management_history' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin_panel.league_management_history') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">History</span>
                        </a>
                    </li>

                    <!-- Legacy Tools Nested Submenu -->
                    <li class="c-sidebar__item c-sidebar__item--expandable {{ 'is-open' if 'publeague' in request.path or 'auto-schedule' in request.path or 'playoff' in request.path }}" role="none" data-expandable>
                        <button type="button" class="c-sidebar__link c-sidebar__link--toggle c-sidebar__link--legacy" data-action="toggle-submenu" aria-expanded="{{ 'true' if 'publeague' in request.path or 'auto-schedule' in request.path or 'playoff' in request.path else 'false' }}" role="menuitem">
                            <i class="ti ti-archive c-sidebar__icon c-sidebar__icon--legacy" aria-hidden="true"></i>
                            <span class="c-sidebar__label c-sidebar__label--legacy">Legacy Tools</span>
                            <i class="c-sidebar__chevron ti ti-chevron-down" aria-hidden="true"></i>
                        </button>
                        <ul class="c-sidebar__submenu c-sidebar__submenu--nested" role="list">
                            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'publeague.season.manage_seasons' }}" role="none">
                                <a class="c-sidebar__link" href="{{ url_for('publeague.season.manage_seasons') }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">Create Season</span>
                                </a>
                            </li>
                            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'publeague.manage_teams' }}" role="none">
                                <a class="c-sidebar__link" href="{{ url_for('publeague.manage_teams') }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">Create Teams</span>
                                </a>
                            </li>
                            <li class="c-sidebar__item {{ 'is-active' if request.endpoint.endswith('manage_publeague_schedule') }}" role="none">
                                {% if current_pub_league_season %}
                                <a class="c-sidebar__link" href="{{ url_for('publeague.schedule.manage_publeague_schedule', season_id=current_pub_league_season.id) }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">Pub League Schedule</span>
                                </a>
                                {% else %}
                                <a class="c-sidebar__link c-sidebar__link--disabled" href="#" data-action="no-active-season" role="menuitem" aria-disabled="true">
                                    <span class="c-sidebar__label">Pub League Schedule</span>
                                </a>
                                {% endif %}
                            </li>
                            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'publeague.schedule.manage_ecsfc_schedule' }}" role="none">
                                <a class="c-sidebar__link" href="{{ url_for('publeague.schedule.manage_ecsfc_schedule', season_id=g.current_ecs_fc_season.id if g.current_ecs_fc_season else 0) }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">ECS FC Schedule</span>
                                </a>
                            </li>
                            <li class="c-sidebar__item {{ 'is-active' if 'auto-schedule' in request.path }}" role="none">
                                <a class="c-sidebar__link" href="{{ url_for('auto_schedule.schedule_manager') }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">Auto Schedule</span>
                                </a>
                            </li>
                            {% if current_pub_league_season %}
                            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'auto_schedule.view_seasonal_schedule' }}" role="none">
                                <a class="c-sidebar__link" href="{{ url_for('auto_schedule.view_seasonal_schedule', season_id=current_pub_league_season.id) }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">View Season Schedule</span>
                                </a>
                            </li>
                            <li class="c-sidebar__item {{ 'is-active' if 'playoff' in request.path and 'generator' in request.path }}" role="none">
                                <a class="c-sidebar__link" href="{{ url_for('playoff.playoff_generator_redirect') }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">Playoff Generator</span>
                                </a>
                            </li>
                            <li class="c-sidebar__item {{ 'is-active' if 'playoff' in request.path and 'bracket' in request.path }}" role="none">
                                <a class="c-sidebar__link" href="{{ url_for('playoff.view_bracket_redirect') }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">Playoff Bracket</span>
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </li>
                </ul>
            </li>
            {% endif %}

            {% if can_view_draft %}
            <!-- Draft Section -->
            <li class="c-sidebar__item c-sidebar__item--expandable {{ 'is-open' if 'draft' in request.path }}" role="none" data-expandable>
                <button type="button" class="c-sidebar__link c-sidebar__link--toggle" data-action="toggle-submenu" aria-expanded="{{ 'true' if 'draft' in request.path else 'false' }}" role="menuitem">
                    <i data-feather="list" class="c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Draft</span>
                    <i class="c-sidebar__chevron ti ti-chevron-down" aria-hidden="true"></i>
                </button>
                <ul class="c-sidebar__submenu" role="list">
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'draft_enhanced.draft_league' and 'classic' in request.path }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('draft_enhanced.draft_league', league_name='classic') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Classic Division</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'draft_enhanced.draft_league' and 'premier' in request.path }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('draft_enhanced.draft_league', league_name='premier') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Premier Division</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'draft_enhanced.draft_league' and 'ecs_fc' in request.path }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('draft_enhanced.draft_league', league_name='ecs_fc') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">ECS FC Division</span>
                        </a>
                    </li>
                    {% if can_view_draft_predictions %}
                    <li class="c-sidebar__item {{ 'is-active' if 'draft-predictions' in request.path }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('draft_predictions.index') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Draft Predictions</span>
                        </a>
                    </li>
                    {% endif %}
                    {% if 'Pub League Admin' in user_roles or 'Global Admin' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.draft_history' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.draft_history') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Draft History</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}

            <!-- Teams Overview -->
            {% if can_view_teams and admin_settings.teams_navigation_enabled %}
            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'teams.teams_overview' }}" role="none">
                <a class="c-sidebar__link" href="{{ url_for('teams.teams_overview') }}" data-action="navigate" role="menuitem">
                    <i data-feather="users" class="c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Teams</span>
                </a>
            </li>
            {% endif %}
            {% endif %}

            <!-- Standings -->
            {% if can_view_standings %}
            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'teams.view_standings' }}" role="none">
                <a class="c-sidebar__link" href="{{ url_for('teams.view_standings') }}" data-action="navigate" role="menuitem">
                    <i data-feather="bar-chart" class="c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Standings</span>
                </a>
            </li>
            {% endif %}

            <!-- League Store -->
            {% set store_enabled = admin_settings.get('store_navigation_enabled', True) %}
            {% if ('Pub League Coach' in user_roles or 'Pub League Admin' in user_roles or 'Global Admin' in user_roles) and (store_enabled or 'Global Admin' in user_roles) %}
            <li class="c-sidebar__item {{ 'is-active' if 'store' in request.path }}" role="none">
                <a class="c-sidebar__link" href="{{ url_for('store.index') }}" data-action="navigate" role="menuitem">
                    <i class="ti ti-shopping-cart c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">League Store</span>
                </a>
            </li>
            {% endif %}

            <!-- Calendar -->
            {% if can_view_calendar %}
            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'calendar.calendar_view' }}" role="none">
                <a class="c-sidebar__link" href="{{ url_for('calendar.calendar_view') }}" data-action="navigate" role="menuitem">
                    <i data-feather="calendar" class="c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Pub League Calendar</span>
                </a>
            </li>
            {% endif %}

            <!-- Admin Panel - Prominent -->
            {% if 'Global Admin' in user_roles or 'Pub League Admin' in user_roles %}
            <li class="c-sidebar__item {{ 'is-active' if request.blueprint == 'admin_panel' }}" role="none">
                <a class="c-sidebar__link c-sidebar__link--primary" href="{{ url_for('admin_panel.dashboard') }}" data-action="navigate" role="menuitem">
                    <i class="ti ti-layout-dashboard c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Admin Panel <span class="c-badge c-badge--success c-badge--sm" data-badge aria-label="New feature">NEW</span></span>
                </a>
            </li>
            {% endif %}

            <!-- Digital Wallets -->
            {% if 'Pub League Admin' in user_roles or 'Global Admin' in user_roles %}
            <li class="c-sidebar__item c-sidebar__item--expandable {{ 'is-open' if 'wallet' in request.path and 'admin' in request.path }}" role="none" data-expandable>
                <button type="button" class="c-sidebar__link c-sidebar__link--toggle" data-action="toggle-submenu" aria-expanded="{{ 'true' if 'wallet' in request.path and 'admin' in request.path else 'false' }}" role="menuitem">
                    <i class="ti ti-device-mobile c-sidebar__icon" aria-hidden="true"></i>
                    <span class="c-sidebar__label">Digital Wallets</span>
                    <i class="c-sidebar__chevron ti ti-chevron-down" aria-hidden="true"></i>
                </button>
                <ul class="c-sidebar__submenu" role="list">
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint and 'wizard' in request.endpoint }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('wallet_config.setup_wizard') }}" data-action="navigate" role="menuitem">
                            <i class="ti ti-wand c-sidebar__icon" aria-hidden="true"></i>
                            <span class="c-sidebar__label">Setup Wizard</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'wallet_admin.wallet_management' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('wallet_admin.wallet_management') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Dashboard</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint and request.endpoint.startswith('pass_studio.') }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('pass_studio.index') }}" data-action="navigate" role="menuitem">
                            <i class="ti ti-brush c-sidebar__icon" aria-hidden="true"></i>
                            <span class="c-sidebar__label">Pass Studio</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'wallet_admin.passes_list' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('wallet_admin.passes_list') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Manage Passes</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'wallet_admin.scanner' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('wallet_admin.scanner') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Scanner</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'wallet_admin.checkins_list' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('wallet_admin.checkins_list') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Check-ins</span>
                        </a>
                    </li>
                    {% if 'Global Admin' in user_roles %}
                    <li class="c-sidebar__item c-sidebar__item--expandable {{ 'is-open' if request.endpoint and request.endpoint in ['wallet_config.diagnostics', 'wallet_config.help_page'] }}" role="none" data-expandable>
                        <button type="button" class="c-sidebar__link c-sidebar__link--toggle" data-action="toggle-submenu" aria-expanded="{{ 'true' if request.endpoint and request.endpoint in ['wallet_config.diagnostics', 'wallet_config.help_page'] else 'false' }}" role="menuitem">
                            <i class="ti ti-settings c-sidebar__icon" aria-hidden="true"></i>
                            <span class="c-sidebar__label">Settings</span>
                            <i class="c-sidebar__chevron ti ti-chevron-down" aria-hidden="true"></i>
                        </button>
                        <ul class="c-sidebar__submenu c-sidebar__submenu--nested" role="list">
                            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'wallet_config.diagnostics' }}" role="none">
                                <a class="c-sidebar__link" href="{{ url_for('wallet_config.diagnostics') }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">Diagnostics</span>
                                </a>
                            </li>
                            <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'wallet_config.help_page' }}" role="none">
                                <a class="c-sidebar__link" href="{{ url_for('wallet_config.help_page') }}" data-action="navigate" role="menuitem">
                                    <span class="c-sidebar__label">Help & Docs</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}

            <!-- Legacy Admin Section -->
            {% if 'Pub League Admin' in user_roles or 'Global Admin' in user_roles or 'Discord Admin' in user_roles %}
            {% set legacy_active = (
                request.endpoint == 'admin.discord_management' or
                request.endpoint in ['admin.manage_polls', 'admin.create_poll', 'admin.poll_results'] or
                ('message' in request.path and 'admin' in request.path) or
                request.endpoint == 'admin.view_scheduled_messages' or
                request.endpoint == 'admin.validate_scheduled_messages' or
                request.endpoint == 'admin.user_approvals' or
                request.endpoint == 'admin.user_waitlist' or
                request.endpoint == 'user_management.manage_users' or
                'user_management' in request.path or
                'duplicate_management' in request.path or
                request.endpoint.startswith('duplicate_management.') or
                'substitute' in request.path or
                'sub_requests' in request.path or
                request.endpoint == 'teams.season_overview' or
                request.endpoint == 'admin.match_verification_dashboard' or
                ('notifications' in request.path and 'admin' in request.path) or
                request.endpoint == 'security_status.security_dashboard' or
                request.endpoint == 'admin.match_management' or
                request.endpoint == 'monitoring.monitor_dashboard' or
                request.endpoint == 'monitoring.db_monitoring' or
                request.endpoint == 'admin.admin_dashboard' or
                request.endpoint == 'design.design_guide' or
                request.endpoint == 'admin.discord_onboarding.admin_test_onboarding' or
                request.endpoint == 'bot_admin.bot_management' or
                request.endpoint == 'admin.admin_reports' or
                request.blueprint == 'ai_prompts'
            ) %}
            <li class="c-sidebar__item c-sidebar__item--expandable {{ 'is-open' if legacy_active }}" role="none" data-expandable>
                <button type="button" class="c-sidebar__link c-sidebar__link--toggle c-sidebar__link--legacy" data-action="toggle-submenu" aria-expanded="{{ 'true' if legacy_active else 'false' }}" role="menuitem">
                    <i class="ti ti-archive c-sidebar__icon c-sidebar__icon--legacy" aria-hidden="true"></i>
                    <span class="c-sidebar__label c-sidebar__label--legacy">Legacy Admin <span class="c-badge c-badge--warning c-badge--sm" data-badge aria-label="Old feature">Old</span></span>
                    <i class="c-sidebar__chevron ti ti-chevron-down" aria-hidden="true"></i>
                </button>
                <ul class="c-sidebar__submenu" role="list">
                    <!-- Info banner -->
                    <li class="c-sidebar__item c-sidebar__item--info" role="none">
                        <div class="c-sidebar__info-banner">
                            <span class="c-sidebar__info-text">
                                <i class="ti ti-info-circle" aria-hidden="true"></i>Use <a href="{{ url_for('admin_panel.dashboard') }}" class="c-sidebar__info-link" data-action="navigate">Admin Panel</a> instead
                            </span>
                        </div>
                    </li>

                    <!-- Discord Tools -->
                    {% if 'Pub League Admin' in user_roles or 'Global Admin' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.discord_management' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.discord_management') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Discord Join Status</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint in ['admin.manage_polls', 'admin.create_poll', 'admin.poll_results'] }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.manage_polls') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">League Polls</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if 'message' in request.path and 'admin' in request.path }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.message_config.list_categories') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Message Management</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.view_scheduled_messages' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.view_scheduled_messages') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Scheduled Messages</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.validate_scheduled_messages' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.validate_scheduled_messages') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">System Validation</span>
                        </a>
                    </li>
                    {% endif %}

                    <!-- Player Management -->
                    {% if 'Pub League Admin' in user_roles or 'Global Admin' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.user_approvals' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.user_approvals') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">User Approvals</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.user_waitlist' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.user_waitlist') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">User Waitlist</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'user_management.manage_users' or 'user_management' in request.path }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('user_management.manage_users') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Manage Players</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if 'duplicate_management' in request.path or request.endpoint.startswith('duplicate_management.') }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('duplicate_management.duplicate_registrations') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Duplicate Management</span>
                        </a>
                    </li>
                    {% endif %}

                    <!-- Substitute Management -->
                    {% if 'Pub League Admin' in user_roles or 'Global Admin' in user_roles or 'ECS FC Coach' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.substitute_pool.manage_substitute_pools' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.substitute_pool.manage_substitute_pools') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Substitute Pools</span>
                        </a>
                    </li>
                    {% if 'Pub League Admin' in user_roles or 'Global Admin' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.manage_sub_requests' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.manage_sub_requests') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Sub Requests</span>
                        </a>
                    </li>
                    {% endif %}
                    {% endif %}

                    <!-- Other Legacy Items -->
                    {% if 'Pub League Admin' in user_roles or 'Global Admin' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'teams.season_overview' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('teams.season_overview') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Season Overview</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.match_verification_dashboard' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.match_verification_dashboard') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Match Verification</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if 'notifications' in request.path and 'admin' in request.path }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('notification_admin.notification_dashboard') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Push Notifications</span>
                        </a>
                    </li>
                    {% endif %}

                    <!-- Security Dashboard -->
                    {% if 'Global Admin' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'security_status.security_dashboard' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('security_status.security_dashboard') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Security Dashboard</span>
                        </a>
                    </li>
                    {% endif %}

                    <!-- Discord Bot Admin -->
                    {% if 'Discord Admin' in user_roles or 'Global Admin' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.match_management' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.match_management') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Match Management (MLS)</span>
                        </a>
                    </li>
                    {% endif %}

                    <!-- Global Admin Only -->
                    {% if 'Global Admin' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'monitoring.monitor_dashboard' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('monitoring.monitor_dashboard') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Task Monitor</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'monitoring.db_monitoring' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('monitoring.db_monitoring') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Database Monitor</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.admin_dashboard' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.admin_dashboard') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Dev Tools</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'design.design_guide' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('design.design_guide') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Design System</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.discord_onboarding.admin_test_onboarding' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.test_onboarding') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Test Onboarding</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'bot_admin.bot_management' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('bot_admin.bot_management') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Bot Admin</span>
                        </a>
                    </li>
                    <li class="c-sidebar__item {{ 'is-active' if request.endpoint == 'admin.admin_reports' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('admin.admin_reports') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">Review Feedback</span>
                        </a>
                    </li>
                    {% endif %}

                    <!-- AI Prompts -->
                    {% if 'Global Admin' in user_roles or 'Pub League Admin' in user_roles %}
                    <li class="c-sidebar__item {{ 'is-active' if request.blueprint == 'ai_prompts' }}" role="none">
                        <a class="c-sidebar__link" href="{{ url_for('ai_prompts.list_prompts') }}" data-action="navigate" role="menuitem">
                            <span class="c-sidebar__label">AI Prompts</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            {% endif %}
        </ul>
    </nav>

    {# NOTE: Messaging is now handled by the floating chat widget in base.html #}
    {# See: components/_chat_widget.html #}
</aside>
