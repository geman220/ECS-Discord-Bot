<!-- Mobile Bottom Navigation Bar -->
<!-- Only visible on mobile devices (< 768px) -->
<!-- Provides quick access to primary app features -->

<nav class="mobile-bottom-nav d-md-none" id="mobileBottomNav">
    <div class="bottom-nav-container">
        <!-- Home -->
        <a href="{{ url_for('main.index') }}"
           class="bottom-nav-item {% if request.endpoint == 'main.index' %}active{% endif %}"
           data-page="home">
            <i class="ti ti-home bottom-nav-icon"></i>
            <span class="bottom-nav-label">Home</span>
        </a>

        <!-- Teams -->
        <a href="{{ url_for('teams.teams_overview') }}"
           class="bottom-nav-item {% if 'team' in request.endpoint %}active{% endif %}"
           data-page="teams">
            <i class="ti ti-users bottom-nav-icon"></i>
            <span class="bottom-nav-label">Teams</span>
        </a>

        <!-- Schedule -->
        <a href="{{ url_for('teams.view_standings') }}"
           class="bottom-nav-item {% if 'standings' in request.endpoint or 'season' in request.endpoint %}active{% endif %}"
           data-page="schedule">
            <i class="ti ti-calendar bottom-nav-icon"></i>
            <span class="bottom-nav-label">Schedule</span>
        </a>

        <!-- More Menu -->
        <button class="bottom-nav-item"
                data-page="more"
                data-bs-toggle="offcanvas"
                data-bs-target="#mobileMoreMenu"
                aria-controls="mobileMoreMenu">
            <i class="ti ti-dots-vertical bottom-nav-icon"></i>
            <span class="bottom-nav-label">More</span>
        </button>
    </div>
</nav>

<!-- More Menu Offcanvas (Slide up from bottom) -->
<div class="offcanvas offcanvas-bottom mobile-more-menu"
     tabindex="-1"
     id="mobileMoreMenu"
     aria-labelledby="mobileMoreMenuLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="mobileMoreMenuLabel">
            <i class="ti ti-menu-2 me-2"></i>More Options
        </h5>
        <button type="button"
                class="btn-close"
                data-bs-dismiss="offcanvas"
                aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div class="list-group list-group-flush">
            <!-- Profile -->
            {% if safe_current_user.is_authenticated and safe_current_user.player %}
            <a href="{{ url_for('players.player_profile', player_id=safe_current_user.player.id) }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-user me-3"></i>
                My Profile
            </a>
            {% endif %}

            <!-- Messages -->
            {% if safe_current_user.is_authenticated %}
            <a href="{{ url_for('messages_pages.messages_inbox') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-mail me-3"></i>
                Messages
            </a>
            {% endif %}

            <!-- Calendar -->
            <a href="{{ url_for('calendar.calendar_view') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-calendar-event me-3"></i>
                Calendar
            </a>

            <!-- Settings -->
            {% if safe_current_user.is_authenticated %}
            <a href="{{ url_for('account.settings') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-settings me-3"></i>
                Settings
            </a>
            {% endif %}

            <!-- Draft Leagues (if user has access) -->
            {% if safe_current_user.is_authenticated and ('Admin' in user_roles or 'Global Admin' in user_roles or 'Coach' in user_roles or 'Pub League Admin' in user_roles or 'Pub League Coach' in user_roles) %}
            <div class="list-group-item mobile-menu-section-header">
                <small class="text-muted fw-bold">DRAFT</small>
            </div>
            <a href="{{ url_for('draft_enhanced.draft_league', league_name='premier') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-trophy me-3"></i>
                Premier League Draft
            </a>
            <a href="{{ url_for('draft_enhanced.draft_league', league_name='classic') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-layout-cards me-3"></i>
                Classic League Draft
            </a>
            {% endif %}

            <!-- Coach Dashboard (if coach) -->
            {% if safe_current_user.is_authenticated and ('Pub League Coach' in user_roles or 'ECS FC Coach' in user_roles or 'Admin' in user_roles or 'Global Admin' in user_roles) %}
            <a href="{{ url_for('teams.coach_dashboard') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-clipboard me-3"></i>
                Coach Dashboard
            </a>
            {% endif %}

            <!-- Admin Panel (if admin) -->
            {% if safe_current_user.is_authenticated and ('Admin' in user_roles or 'Global Admin' in user_roles) %}
            <a href="{{ url_for('admin_panel.dashboard') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-shield me-3"></i>
                Admin Panel
            </a>
            {% endif %}

            <!-- Wallet (if admin) -->
            {% if safe_current_user.is_authenticated and ('Admin' in user_roles or 'Global Admin' in user_roles or 'Pub League Admin' in user_roles) %}
            <a href="{{ url_for('wallet_admin.wallet_management') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-wallet me-3"></i>
                Wallet Management
            </a>
            {% endif %}

            <!-- Feedback -->
            {% if safe_current_user.is_authenticated %}
            <a href="{{ url_for('feedback.submit_feedback') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-message-circle me-3"></i>
                Submit Feedback
            </a>
            {% endif %}

            <!-- Help -->
            {% if safe_current_user.is_authenticated %}
            <a href="{{ url_for('help.index') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-help-circle me-3"></i>
                Help Topics
            </a>
            {% endif %}

            <div class="dropdown-divider"></div>

            <!-- Theme Toggle -->
            <button class="list-group-item list-group-item-action js-mobile-theme-toggle"
                    id="mobileThemeToggle"
                    data-action="toggle-theme">
                <i class="ti ti-moon me-3" id="mobileThemeIcon"></i>
                <span id="mobileThemeText">Dark Mode</span>
            </button>

            {% if safe_current_user.is_authenticated %}
            <div class="dropdown-divider"></div>

            <!-- Logout -->
            <a href="{{ url_for('auth.logout') }}"
               class="list-group-item list-group-item-action text-danger">
                <i class="ti ti-logout me-3"></i>
                Logout
            </a>
            {% else %}
            <div class="dropdown-divider"></div>

            <!-- Login -->
            <a href="{{ url_for('auth.login') }}"
               class="list-group-item list-group-item-action">
                <i class="ti ti-login me-3"></i>
                Login
            </a>
            {% endif %}
        </div>
    </div>
</div>

<!-- Mobile Bottom Nav JavaScript - Extracted to mobile-bottom-nav.js -->
<!-- Script is loaded by base.html in development mode -->
<!-- Uses EventDelegation with data-action="toggle-theme" for theme toggle -->
<script>
// Only load the script in development mode (production uses bundled version)
{% if not (vite_production_mode is defined and vite_production_mode()) and not (vite_dev_mode is defined and vite_dev_mode()) %}
(function() {
    // Load the external module if not already loaded
    if (!window.MobileBottomNav) {
        var script = document.createElement('script');
        script.src = "{{ url_for('static', filename='custom_js/mobile-bottom-nav.js') }}";
        document.head.appendChild(script);
    }
})();
{% endif %}
</script>
