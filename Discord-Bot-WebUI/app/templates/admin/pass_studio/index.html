{% extends 'admin/layout.html' %}
{% block title %}Pass Studio{% endblock %}

{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-primary mb-1">
                <i class="ti ti-brush me-2"></i>Pass Studio
            </h2>
            <p class="text-muted mb-0">Design and configure your digital wallet passes</p>
        </div>
        <a href="{{ url_for('wallet_admin.wallet_management') }}" class="c-btn c-btn--outline-secondary">
            <i class="ti ti-arrow-left me-1"></i> Back to Dashboard
        </a>
    </div>

    <!-- Prerequisites Check -->
    {% if not wallet_config.ready %}
    <div class="alert alert-warning mb-4" data-alert>
        <div class="d-flex">
            <i class="ti ti-alert-triangle me-2 fs-4"></i>
            <div>
                <strong>Setup Required</strong>
                <p class="mb-2 mt-1">
                    Before you can design passes, you need to complete the initial setup:
                </p>
                <ul class="mb-2">
                    {% if not wallet_config.progress.certificates %}
                    <li>Upload Apple Wallet certificates</li>
                    {% endif %}
                    {% if not wallet_config.progress.assets %}
                    <li>Upload pass assets (icon, logo)</li>
                    {% endif %}
                </ul>
                <a href="{{ url_for('wallet_config.setup_wizard') }}" class="c-btn c-btn--warning c-btn--sm">
                    <i class="ti ti-wand me-1"></i> Run Setup Wizard
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Pass Type Selection -->
    <div class="row">
        <!-- ECS Membership Pass -->
        <div class="col-lg-6 mb-4">
            <div class="c-card h-100 {{ 'border-success' if ecs_type else 'border-warning' }}">
                <div class="c-card__header d-flex align-items-center">
                    <div class="avatar avatar-md me-3" class="bg-custom" data-bg-color="{{ ecs_type.background_color if ecs_type else '#1a472a' }};">
                        <span class="avatar-initial text-white" data-badge><i class="ti ti-id-badge"></i></span>
                    </div>
                    <div>
                        <h5 class="mb-0">ECS Membership Pass</h5>
                        <small class="text-muted">Annual supporter membership card</small>
                    </div>
                </div>
                <div class="c-card__body">
                    {% if ecs_type %}
                    <div class="mb-3">
                        <div class="d-flex align-items-center mb-2">
                            <span class="badge bg-success me-2" data-badge>Active</span>
                            <small class="text-muted">{{ ecs_type.validity_type|title }} validity</small>
                        </div>
                        <div class="d-flex gap-2 mb-3">
                            <div class="d-inline-block px-2 py-1 rounded" class="bg-custom" data-bg-color="{{ ecs_type.background_color }}; color: {{ ecs_type.foreground_color }}; font-size: 0.75rem;">
                                {{ ecs_type.logo_text }}
                            </div>
                        </div>
                    </div>
                    <p class="text-muted small mb-3">
                        Configure colors, fields, locations, and more for your ECS membership passes.
                        Includes support for <strong>subgroups</strong> like Gorilla FC and North End Faithful.
                    </p>
                    <a href="{{ url_for('pass_studio.studio', pass_type_code='ecs_membership') }}" class="c-btn c-btn--primary">
                        <i class="ti ti-brush me-1"></i> Open in Studio
                    </a>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="ti ti-alert-circle fs-1 text-warning"></i>
                        <p class="mt-2 text-muted">Pass type not configured</p>
                        <a href="{{ url_for('wallet_config.setup_wizard') }}" class="c-btn c-btn--outline-warning c-btn--sm">
                            Run Setup
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Pub League Pass -->
        <div class="col-lg-6 mb-4">
            <div class="c-card h-100 {{ 'border-success' if pub_type else 'border-warning' }}">
                <div class="c-card__header d-flex align-items-center">
                    <div class="avatar avatar-md me-3" class="bg-custom" data-bg-color="{{ pub_type.background_color if pub_type else '#213e96' }};">
                        <span class="avatar-initial text-white"><i class="ti ti-ball-football"></i></span>
                    </div>
                    <div>
                        <h5 class="mb-0">Pub League Pass</h5>
                        <small class="text-muted">Seasonal player registration card</small>
                    </div>
                </div>
                <div class="c-card__body">
                    {% if pub_type %}
                    <div class="mb-3">
                        <div class="d-flex align-items-center mb-2">
                            <span class="badge bg-success me-2" data-badge>Active</span>
                            <small class="text-muted">{{ pub_type.validity_type|title }} validity</small>
                        </div>
                        <div class="d-flex gap-2 mb-3">
                            <div class="d-inline-block px-2 py-1 rounded" class="bg-custom" data-bg-color="{{ pub_type.background_color }}; color: {{ pub_type.foreground_color }}; font-size: 0.75rem;">
                                {{ pub_type.logo_text }}
                            </div>
                        </div>
                    </div>
                    <p class="text-muted small mb-3">
                        Configure colors, fields, locations, and more for your Pub League player passes.
                        Includes support for <strong>team names</strong> and season information.
                    </p>
                    <a href="{{ url_for('pass_studio.studio', pass_type_code='pub_league') }}" class="c-btn c-btn--primary">
                        <i class="ti ti-brush me-1"></i> Open in Studio
                    </a>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="ti ti-alert-circle fs-1 text-warning"></i>
                        <p class="mt-2 text-muted">Pass type not configured</p>
                        <a href="{{ url_for('wallet_config.setup_wizard') }}" class="c-btn c-btn--outline-warning c-btn--sm">
                            Run Setup
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Help -->
    <div class="c-card">
        <div class="c-card__header">
            <h5 class="mb-0"><i class="ti ti-help me-2"></i>How Pass Studio Works</h5>
        </div>
        <div class="c-card__body">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <div class="d-flex align-items-start">
                        <div class="avatar avatar-sm bg-label-primary me-2">
                            <span class="avatar-initial"><i class="ti ti-palette"></i></span>
                        </div>
                        <div>
                            <h6 class="mb-1">Appearance</h6>
                            <small class="text-muted">Set colors, logo text, and branding</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="d-flex align-items-start">
                        <div class="avatar avatar-sm bg-label-info me-2">
                            <span class="avatar-initial"><i class="ti ti-forms"></i></span>
                        </div>
                        <div>
                            <h6 class="mb-1">Fields</h6>
                            <small class="text-muted">Configure what info appears on passes</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="d-flex align-items-start">
                        <div class="avatar avatar-sm bg-label-success me-2">
                            <span class="avatar-initial"><i class="ti ti-map-pin"></i></span>
                        </div>
                        <div>
                            <h6 class="mb-1">Locations</h6>
                            <small class="text-muted">Add partner venues for notifications</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="d-flex align-items-start">
                        <div class="avatar avatar-sm bg-label-warning me-2">
                            <span class="avatar-initial"><i class="ti ti-building-store"></i></span>
                        </div>
                        <div>
                            <h6 class="mb-1">Sponsors</h6>
                            <small class="text-muted">Manage sponsor info on passes</small>
                        </div>
                    </div>
                </div>
            </div>
            <hr>
            <p class="text-muted mb-0">
                <i class="ti ti-info-circle me-1"></i>
                Changes made in the studio are saved as drafts. Use the <strong>Publish</strong> button to push updates to all existing passes on user devices.
            </p>
        </div>
    </div>
</div>
{% endblock %}
