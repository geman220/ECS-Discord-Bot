{% extends 'admin/layout.html' %}
{% block title %}Pass Studio - {{ pass_type.name }}{% endblock %}

{% block custom_css %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/admin/pass-studio.css') }}">
{% endif %}
{% endblock %}

{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-primary mb-1">
                <i class="ti ti-brush me-2"></i>{{ pass_type.name }}
                <span class="unsaved-indicator badge bg-warning ms-2" data-badge>Unsaved</span>
            </h2>
            <p class="text-muted mb-0">Configure your {{ pass_type.name }} wallet pass</p>
        </div>
        <div class="d-flex gap-2">
            <!-- Pass Type Switcher -->
            {% if other_type %}
            <a href="{{ url_for('pass_studio.studio', pass_type_code=other_type.code) }}" class="c-btn c-btn--outline-secondary">
                <i class="ti ti-switch-horizontal me-1"></i> Switch to {{ other_type.name }}
            </a>
            {% endif %}
            <a href="{{ url_for('pass_studio.index') }}" class="c-btn c-btn--outline-secondary">
                <i class="ti ti-arrow-left me-1"></i> Back
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Left Column: Live Preview -->
        <div class="col-lg-4 mb-4">
            <div class="pass-preview-container">
                <div class="c-card-modern">
                    <div class="c-card-modern__header">
                        <h6 class="c-card-modern__title"><i class="ti ti-device-mobile me-2"></i>Live Preview</h6>
                    </div>
                    <div class="c-card-modern__body">
                        {% include 'admin/pass_studio/components/preview_card.html' %}
                    </div>
                    <div class="c-card-modern__footer c-card-modern__footer--center">
                        <small class="c-text-muted">Preview updates as you make changes</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Editor Tabs -->
        <div class="col-lg-8">
            <div class="c-card-modern">
                <div class="c-card-modern__header">
                    <!-- Tabs -->
                    <ul class="c-tabs" role="tablist" data-tabs>
                        <li class="c-tabs__item">
                            <button class="c-tabs__link {{ 'is-active' if active_tab == 'appearance' }}" data-bs-toggle="tab" data-bs-target="#tab-appearance" type="button" role="tab">
                                <i class="ti ti-palette me-1"></i> Appearance
                            </button>
                        </li>
                        <li class="c-tabs__item">
                            <button class="c-tabs__link {{ 'is-active' if active_tab == 'fields' }}" data-bs-toggle="tab" data-bs-target="#tab-fields" type="button" role="tab">
                                <i class="ti ti-forms me-1"></i> Fields
                            </button>
                        </li>
                        <li class="c-tabs__item">
                            <button class="c-tabs__link {{ 'is-active' if active_tab == 'locations' }}" data-bs-toggle="tab" data-bs-target="#tab-locations" type="button" role="tab">
                                <i class="ti ti-map-pin me-1"></i> Locations
                                <span class="c-badge c-badge--{{ 'success' if location_count < max_locations else 'warning' }} ms-1">{{ location_count }}/{{ max_locations }}</span>
                            </button>
                        </li>
                        <li class="c-tabs__item">
                            <button class="c-tabs__link {{ 'is-active' if active_tab == 'sponsors' }}" data-bs-toggle="tab" data-bs-target="#tab-sponsors" type="button" role="tab">
                                <i class="ti ti-building-store me-1"></i> Sponsors
                            </button>
                        </li>
                        {% if pass_type_code == 'ecs_membership' %}
                        <li class="c-tabs__item">
                            <button class="c-tabs__link {{ 'is-active' if active_tab == 'subgroups' }}" data-bs-toggle="tab" data-bs-target="#tab-subgroups" type="button" role="tab">
                                <i class="ti ti-users-group me-1"></i> Subgroups
                            </button>
                        </li>
                        {% endif %}
                    </ul>
                </div>
                <div class="c-card-modern__body">
                    <div class="c-tabs__content">
                        <!-- Appearance Tab -->
                        <div class="c-tabs__pane {{ 'is-active' if active_tab == 'appearance' }}" data-tab-id="tab-appearance" role="tabpanel">
                            {% include 'admin/pass_studio/components/appearance_tab.html' %}
                        </div>

                        <!-- Fields Tab -->
                        <div class="c-tabs__pane {{ 'is-active' if active_tab == 'fields' }}" data-tab-id="tab-fields" role="tabpanel">
                            {% include 'admin/pass_studio/components/fields_tab.html' %}
                        </div>

                        <!-- Locations Tab -->
                        <div class="c-tabs__pane {{ 'is-active' if active_tab == 'locations' }}" data-tab-id="tab-locations" role="tabpanel">
                            {% include 'admin/pass_studio/components/locations_tab.html' %}
                        </div>

                        <!-- Sponsors Tab -->
                        <div class="c-tabs__pane {{ 'is-active' if active_tab == 'sponsors' }}" data-tab-id="tab-sponsors" role="tabpanel">
                            {% include 'admin/pass_studio/components/sponsors_tab.html' %}
                        </div>

                        {% if pass_type_code == 'ecs_membership' %}
                        <!-- Subgroups Tab -->
                        <div class="c-tabs__pane {{ 'is-active' if active_tab == 'subgroups' }}" data-tab-id="tab-subgroups" role="tabpanel">
                            {% include 'admin/pass_studio/components/subgroups_tab.html' %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{# Asset Cropper Modal #}
{% include 'admin/pass_studio/components/asset_cropper_modal.html' %}
{% endblock %}

{% block scripts %}
{% if not config.get('ASSETS_PRODUCTION_MODE') %}
{# Asset Cropper Library #}
<script src="{{ url_for('static', filename='js/pass-studio-cropper.js') }}"></script>

{# Pass Studio Main JavaScript - Extracted from inline script #}
<script src="{{ url_for('static', filename='js/pass-studio.js') }}"></script>
{% endif %}

<!--
MIGRATION NOTE: Inline JavaScript has been extracted to /app/static/js/pass-studio.js
All pass studio functionality now uses external JS with data attributes for configuration

Migrated functions:
- PassStudio.init()
- PassStudio.loadPreviewData()
- PassStudio.loadAssets()
- PassStudio.updateAssetPreviews()
- PassStudio.setPreviewPlatform()
- PassStudio.updatePassStylePreview()
- PassStudio.openAssetCropper()
- PassStudio.updatePreview()
- PassStudio.updatePreviewFields()
- PassStudio.saveAppearance()
- And all other PassStudio methods
-->

<script data-pass-type-code="{{ pass_type_code }}">
// Initialize with pass type code from data attribute
</script>
{% endblock %}
