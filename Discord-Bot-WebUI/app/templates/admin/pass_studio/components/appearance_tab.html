{# Appearance Tab Component #}
{# Configure pass colors, logo text, assets, and visual branding #}

<form id="appearance-form" data-action="save-appearance">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    {# Pass Style Selector - determines overall layout #}
    <div class="mb-4">
        <h6 class="text-primary mb-3"><i class="ti ti-layout me-2"></i>Apple Wallet Pass Style</h6>
        <p class="text-muted small mb-3">Choose the pass layout style. This affects how fields and images are arranged.</p>

        <div class="row">
            <div class="col-12">
                <div class="btn-group w-100" role="group" aria-label="Pass style selector">
                    <input type="radio" class="btn-check" name="apple_pass_style" id="style_generic" value="generic"
                           {% if (pass_type.apple_pass_style or 'generic') == 'generic' %}checked{% endif %}
                           data-on-change="update-pass-style">
                    <label class="c-btn c-btn--outline-primary" for="style_generic">
                        <i class="ti ti-id-badge me-1"></i>Generic
                        <span class="badge bg-success ms-1" data-badge>Recommended</span>
                    </label>

                    <input type="radio" class="btn-check" name="apple_pass_style" id="style_storeCard" value="storeCard"
                           {% if pass_type.apple_pass_style == 'storeCard' %}checked{% endif %}
                           data-on-change="update-pass-style">
                    <label class="c-btn c-btn--outline-primary" for="style_storeCard">
                        <i class="ti ti-credit-c-card me-1"></i>Store Card
                    </label>

                    <input type="radio" class="btn-check" name="apple_pass_style" id="style_eventTicket" value="eventTicket"
                           {% if pass_type.apple_pass_style == 'eventTicket' %}checked{% endif %}
                           data-on-change="update-pass-style">
                    <label class="c-btn c-btn--outline-primary" for="style_eventTicket">
                        <i class="ti ti-ticket me-1"></i>Event Ticket
                    </label>
                </div>
            </div>
        </div>

        {# Style descriptions #}
        <div class="mt-3" id="style-description">
            <div class="alert alert-info py-2 mb-0" id="style-desc-generic" class="{% if (pass_type.apple_pass_style or 'generic') != 'generic' %}u-hidden{% endif %}" data-alert>
                <strong>Generic Pass:</strong> Clean layout with thumbnail image in header. Primary field displayed separately below.
                Best for membership cards - fields are clearly readable without overlapping images.
            </div>
            <div class="alert alert-info py-2 mb-0" id="style-desc-storeCard" class="{% if pass_type.apple_pass_style != 'storeCard' %}u-hidden{% endif %}" data-alert>
                <strong>Store Card:</strong> Strip image as banner with primary field overlaid on top.
                Good for loyalty/points cards. <span class="text-warning">Note: Text appears ON the strip image.</span>
            </div>
            <div class="alert alert-info py-2 mb-0" id="style-desc-eventTicket" class="{% if pass_type.apple_pass_style != 'eventTicket' %}u-hidden{% endif %}" data-alert>
                <strong>Event Ticket:</strong> Strip image displayed cleanly with notch at top. Fields appear below the strip - no overlay!
                Great for membership cards with a banner image.
            </div>
        </div>
    </div>

    <hr>

    {# Colors Section #}
    <div class="mb-4">
        <h6 class="text-primary mb-3"><i class="ti ti-palette me-2"></i>Pass Colors</h6>

        <div class="row">
            {# Background Color #}
            <div class="col-md-4 mb-3">
                <label class="form-label">Background Color</label>
                <div class="input-group" data-input-group>
                    <input type="color"
                           class="form-control form-control-color color-input"
                           id="background_color"
                           name="background_color"
                           value="{{ pass_type.background_color }}"
                           title="Choose background color" data-form-control>
                    <input type="text"
                           class="form-control"
                           value="{{ pass_type.background_color }}"
                           id="background_color_text"
                           maxlength="7"
                           pattern="^#[0-9A-Fa-f]{6}$"
                           data-on-input="sync-color-input" data-target="background_color" data-form-control>
                </div>
                <small class="text-muted">Main background of the pass</small>
            </div>

            {# Foreground Color #}
            <div class="col-md-4 mb-3">
                <label class="form-label">Foreground Color</label>
                <div class="input-group" data-input-group>
                    <input type="color"
                           class="form-control form-control-color color-input"
                           id="foreground_color"
                           name="foreground_color"
                           value="{{ pass_type.foreground_color }}"
                           title="Choose text color" data-form-control>
                    <input type="text"
                           class="form-control"
                           value="{{ pass_type.foreground_color }}"
                           id="foreground_color_text"
                           maxlength="7"
                           pattern="^#[0-9A-Fa-f]{6}$"
                           data-on-input="sync-color-input" data-target="foreground_color" data-form-control>
                </div>
                <small class="text-muted">Main text and values</small>
            </div>

            {# Label Color #}
            <div class="col-md-4 mb-3">
                <label class="form-label">Label Color</label>
                <div class="input-group" data-input-group>
                    <input type="color"
                           class="form-control form-control-color color-input"
                           id="label_color"
                           name="label_color"
                           value="{{ pass_type.label_color }}"
                           title="Choose label color" data-form-control>
                    <input type="text"
                           class="form-control"
                           value="{{ pass_type.label_color }}"
                           id="label_color_text"
                           maxlength="7"
                           pattern="^#[0-9A-Fa-f]{6}$"
                           data-on-input="sync-color-input" data-target="label_color" data-form-control>
                </div>
                <small class="text-muted">Field labels (e.g., "MEMBER")</small>
            </div>
        </div>

        {# Color Presets #}
        <div class="mt-2">
            <small class="text-muted d-block mb-2">Quick presets:</small>
            <div class="d-flex gap-2 flex-wrap">
                <button type="button" class="c-btn c-btn--sm bg-ecs-green text-white"
                        data-action="apply-color-preset" data-bg="#1a472a" data-fg="#ffffff" data-label="#c8c8c8">
                    ECS Green
                </button>
                <button type="button" class="c-btn c-btn--sm bg-sounders-blue text-white"
                        data-action="apply-color-preset" data-bg="#213e96" data-fg="#ffffff" data-label="#c8c8c8">
                    Sounders Blue
                </button>
                <button type="button" class="c-btn c-btn--sm bg-dark text-white"
                        data-action="apply-color-preset" data-bg="#000000" data-fg="#ffffff" data-label="#999999">
                    Dark Mode
                </button>
                <button type="button" class="c-btn c-btn--sm bg-deep-red text-white"
                        data-action="apply-color-preset" data-bg="#8b0000" data-fg="#ffffff" data-label="#ffcccc">
                    Deep Red
                </button>
            </div>
        </div>
    </div>

    <hr>

    {# Logo & Branding Section #}
    <div class="mb-4">
        <h6 class="text-primary mb-3"><i class="ti ti-typography me-2"></i>Logo & Branding</h6>

        <div class="row">
            {# Logo Text #}
            <div class="col-md-6 mb-3">
                <label class="form-label">Logo Text</label>
                <input type="text"
                       class="form-control"
                       id="logo_text"
                       name="logo_text"
                       value="{{ pass_type.logo_text }}"
                       maxlength="50"
                       placeholder="e.g., ECS FC"
                       data-on-input="update-preview-field" data-form-control>
                <small class="text-muted">Text displayed at the top of the pass (max 50 chars)</small>
            </div>

            {# Show Logo Toggle #}
            <div class="col-md-6 mb-3">
                <label class="form-label">Logo Display</label>
                <div class="form-check form-switch mt-2">
                    <input class="form-check-input" type="checkbox" id="show_logo" name="show_logo"
                           {% if pass_type.show_logo is not defined or pass_type.show_logo != false %}checked{% endif %}
                           data-on-change="toggle-logo-visibility">
                    <label class="form-check-label" for="show_logo">Show logo image on pass</label>
                </div>
                <small class="text-muted">Uncheck to hide the logo even if one is uploaded</small>
            </div>
        </div>
    </div>

    <hr>

    {# Apple Wallet Assets Section #}
    {# Assets vary by pass style:
       - generic: icon, logo, thumbnail
       - storeCard/eventTicket: icon, logo, strip
    #}
    <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="text-primary mb-0"><i class="ti ti-brand-apple me-2"></i>Apple Wallet Assets</h6>
            <div class="dropdown">
                <button class="c-btn c-btn--primary c-btn--sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" data-dropdown-toggle>
                    <i class="ti ti-upload me-1"></i>Upload Asset
                </button>
                <ul class="dropdown-menu dropdown-menu-end" data-dropdown-menu>
                    <li><h6 class="dropdown-header">Required</h6></li>
                    <li><a class="dropdown-item js-open-asset-cropper" data-action="open-asset-cropper" data-asset-type="icon">
                        <i class="ti ti-app-window me-2"></i>Icon (29x29)
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><h6 class="dropdown-header">Optional</h6></li>
                    <li><a class="dropdown-item js-open-asset-cropper" data-action="open-asset-cropper" data-asset-type="logo">
                        <i class="ti ti-photo me-2"></i>Logo (160x50)
                    </a></li>
                    <li><a class="dropdown-item js-open-asset-cropper" data-action="open-asset-cropper" data-asset-type="strip">
                        <i class="ti ti-layout-distribute-horizontal me-2"></i>Strip (375x123)
                    </a></li>
                    <li><a class="dropdown-item js-open-asset-cropper" data-action="open-asset-cropper" data-asset-type="thumbnail">
                        <i class="ti ti-photo-square-rounded me-2"></i>Thumbnail (90x90)
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><h6 class="dropdown-header">High Resolution (@2x)</h6></li>
                    <li><a class="dropdown-item js-open-asset-cropper" data-action="open-asset-cropper" data-asset-type="icon2x">
                        <i class="ti ti-app-window me-2"></i>Icon @2x (58x58)
                    </a></li>
                    <li><a class="dropdown-item js-open-asset-cropper" data-action="open-asset-cropper" data-asset-type="logo2x">
                        <i class="ti ti-photo me-2"></i>Logo @2x (320x100)
                    </a></li>
                    <li><a class="dropdown-item js-open-asset-cropper" data-action="open-asset-cropper" data-asset-type="strip2x">
                        <i class="ti ti-layout-distribute-horizontal me-2"></i>Strip @2x (750x246)
                    </a></li>
                    <li><a class="dropdown-item js-open-asset-cropper" data-action="open-asset-cropper" data-asset-type="thumbnail2x">
                        <i class="ti ti-photo-square-rounded me-2"></i>Thumbnail @2x (180x180)
                    </a></li>
                </ul>
            </div>
        </div>
        <p class="text-muted small mb-3">Click any card below to replace, or use the Upload button to add new assets.</p>

        {# Required Assets (all styles) #}
        <div class="mb-3">
            <span class="badge bg-danger mb-2" data-badge>Required</span>
            <div class="row">
                {# Icon #}
                <div class="col-md-4 col-lg-3 mb-3">
                    <div class="asset-upload-c-card js-open-asset-cropper" data-asset-type="icon" data-action="open-asset-cropper">
                        <div class="asset-preview">
                            {% if assets.get('icon') %}
                            <img src="{{ url_for('wallet_config.get_asset', asset_id=assets['icon'].id) }}"
                                 alt="Icon" id="asset-preview-icon">
                            <span class="badge bg-success position-absolute top-0 end-0 m-1" data-badge><i class="ti ti-check"></i></span>
                            {% else %}
                            <div class="asset-placeholder">
                                <i class="ti ti-photo fs-1"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="asset-info">
                            <strong>Icon</strong>
                            <small class="text-muted d-block">29x29 points (@2x: 58x58px)</small>
                            <small class="text-muted d-block">Shown on lock screen</small>
                        </div>
                    </div>
                </div>

                {# Logo #}
                <div class="col-md-4 col-lg-3 mb-3">
                    <div class="asset-upload-c-card js-open-asset-cropper" data-asset-type="logo" data-action="open-asset-cropper">
                        <div class="asset-preview">
                            {% if assets.get('logo') %}
                            <img src="{{ url_for('wallet_config.get_asset', asset_id=assets['logo'].id) }}"
                                 alt="Logo" id="asset-preview-logo">
                            <span class="badge bg-success position-absolute top-0 end-0 m-1" data-badge><i class="ti ti-check"></i></span>
                            {% else %}
                            <div class="asset-placeholder">
                                <i class="ti ti-photo fs-1"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="asset-info">
                            <strong>Logo</strong>
                            <small class="text-muted d-block">160x50 points (@2x: 320x100px)</small>
                            <small class="text-muted d-block">Displayed in pass header</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {# Style-specific Assets #}
        <div>
            <span class="badge bg-secondary mb-2" data-badge>Optional - Style Specific</span>
            <div class="row">
                {# Strip - for storeCard and eventTicket #}
                <div class="col-md-4 col-lg-3 mb-3 asset-strip-container {% if (pass_type.apple_pass_style or 'generic') == 'generic' %}u-hidden{% endif %}" id="asset-strip-wrapper">
                    <div class="asset-upload-c-card js-open-asset-cropper" data-asset-type="strip" data-action="open-asset-cropper">
                        <div class="asset-preview">
                            {% if assets.get('strip') %}
                            <img src="{{ url_for('wallet_config.get_asset', asset_id=assets['strip'].id) }}"
                                 alt="Strip" id="asset-preview-strip">
                            <span class="badge bg-success position-absolute top-0 end-0 m-1" data-badge><i class="ti ti-check"></i></span>
                            {% else %}
                            <div class="asset-placeholder">
                                <i class="ti ti-photo fs-1"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="asset-info">
                            <strong>Strip <span class="badge bg-primary ms-1" data-badge>Main Image</span></strong>
                            <small class="text-muted d-block">375x123 points (@2x: 750x246px)</small>
                            <small class="text-muted d-block">Banner - primary field overlays this</small>
                        </div>
                    </div>
                </div>

                {# Thumbnail - for generic only #}
                <div class="col-md-4 col-lg-3 mb-3 asset-thumbnail-container {% if (pass_type.apple_pass_style or 'generic') != 'generic' %}u-hidden{% endif %}" id="asset-thumbnail-wrapper">
                    <div class="asset-upload-c-card js-open-asset-cropper" data-asset-type="thumbnail" data-action="open-asset-cropper">
                        <div class="asset-preview">
                            {% if assets.get('thumbnail') %}
                            <img src="{{ url_for('wallet_config.get_asset', asset_id=assets['thumbnail'].id) }}"
                                 alt="Thumbnail" id="asset-preview-thumbnail">
                            <span class="badge bg-success position-absolute top-0 end-0 m-1" data-badge><i class="ti ti-check"></i></span>
                            {% else %}
                            <div class="asset-placeholder">
                                <i class="ti ti-photo fs-1"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="asset-info">
                            <strong>Thumbnail <span class="badge bg-primary ms-1" data-badge>Main Image</span></strong>
                            <small class="text-muted d-block">90x90 points (@2x: 180x180px)</small>
                            <small class="text-muted d-block">Square image in header area</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr>

    {# Google Wallet Settings #}
    <div class="mb-4">
        <h6 class="text-primary mb-3"><i class="ti ti-brand-google me-2"></i>Google Wallet</h6>
        <p class="text-muted small mb-3">Google Wallet uses external image URLs instead of embedded images.</p>

        <div class="row">
            {# Hero Image URL #}
            <div class="col-md-6 mb-3">
                <label class="form-label">Hero Image URL</label>
                <div class="input-group" data-input-group>
                    <span class="input-group-text"><i class="ti ti-photo"></i></span>
                    <input type="url"
                           class="form-control"
                           id="google_hero_image_url"
                           name="google_hero_image_url"
                           value="{{ pass_type.google_hero_image_url or '' }}"
                           placeholder="https://example.com/hero.png"
                           data-on-input="update-google-preview" data-form-control>
                </div>
                <small class="text-muted">Banner image at top (recommended: 1032x336px)</small>
            </div>

            {# Logo URL #}
            <div class="col-md-6 mb-3">
                <label class="form-label">Logo URL</label>
                <div class="input-group" data-input-group>
                    <span class="input-group-text"><i class="ti ti-building"></i></span>
                    <input type="url"
                           class="form-control"
                           id="google_logo_url"
                           name="google_logo_url"
                           value="{{ pass_type.google_logo_url or '' }}"
                           placeholder="https://example.com/logo.png"
                           data-on-input="update-google-preview" data-form-control>
                </div>
                <small class="text-muted">Square logo image (optional, uses Apple logo if blank)</small>
            </div>
        </div>

        {# Preview hint #}
        {% if pass_type.google_hero_image_url or pass_type.google_logo_url %}
        <div class="alert alert-success py-2 mb-0" data-alert>
            <i class="ti ti-check me-1"></i>
            Google Wallet images configured. Switch to Google preview to see them.
        </div>
        {% else %}
        <div class="alert alert-info py-2 mb-0" data-alert>
            <i class="ti ti-info-circle me-1"></i>
            Add URLs above to customize Google Wallet appearance. If left blank, Apple assets will be used where possible.
        </div>
        {% endif %}
    </div>

    <hr>

    {# Barcode Settings #}
    <div class="mb-4">
        <h6 class="text-primary mb-3"><i class="ti ti-qrcode me-2"></i>Barcode Settings</h6>

        <div class="form-check form-switch">
            <input class="form-check-input"
                   type="checkbox"
                   id="suppress_barcode"
                   name="suppress_barcode"
                   {% if pass_type.suppress_barcode %}checked{% endif %}
                   data-on-change="update-barcode-preview">
            <label class="form-check-label" for="suppress_barcode">
                <strong>Hide Barcode</strong>
            </label>
        </div>
        <small class="text-muted d-block mt-1">
            Enable this to hide the QR code from the pass. Useful if you don't need scanning functionality.
        </small>
    </div>

    <hr>

    {# Save Button #}
    <div class="d-flex justify-content-end">
        <button type="button" class="c-btn c-btn--primary transform-none" data-action="save-appearance">
            <i class="ti ti-device-floppy me-1"></i> Save Appearance
        </button>
    </div>
</form>

{#
  ============================================================================
  INLINE SCRIPT REMOVED - STANDARDIZATION COMPLIANCE
  ============================================================================

  This inline script block has been removed per modal standardization guidelines.
  All functionality should be moved to:
  /app/static/custom_js/pass-studio-appearance.js (or similar external JS file)

  Functions that need to be externalized:
  - applyColorPreset(bg, fg, label) - use data-action="apply-color-preset"
  - Color input sync handlers - use event delegation on .color-input

  Use data attributes for event binding:
  - data-action="apply-color-preset" data-bg="#xxx" data-fg="#xxx" data-label="#xxx"
  - data-action="sync-color-input" data-target="color_field_id"
  - data-action="update-pass-style"
  - data-action="update-preview-field"
  - data-action="toggle-logo-visibility"
  - data-action="open-asset-cropper" data-asset-type="icon|logo|strip|thumbnail"
  - data-action="update-google-preview"
  - data-action="update-barcode-preview"
  - data-action="save-appearance" (form submission)

  ============================================================================
#}
