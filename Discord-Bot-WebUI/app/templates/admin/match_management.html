{% extends "base.html" %}
{% block title %}Match Management{% endblock %}

{% block main_content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
        <div>
            <h2 class="fw-bold text-primary mb-1">
                <i class="ti ti-calendar-event me-2"></i>Match Management
            </h2>
            <p class="text-muted mb-0">Manage match scheduling, threads, and live reporting automation</p>
        </div>
        <div class="d-flex align-items-center gap-2">
            <div class="d-flex align-items-center gap-2 text-muted">
                <div class="spinner-border spinner-border-sm text-primary spinner-container hidden" id="refreshSpinner" role="status" data-spinner></div>
                <span class="small">Last updated: <span id="lastUpdated" class="fw-medium">{{ current_time.strftime('%I:%M %p') }}</span></span>
            </div>
            <div class="btn-group">
                <button class="c-btn c-btn--primary" data-bs-toggle="modal" data-bs-target="#addMatchModal">
                    <i class="ti ti-plus me-1"></i>Add Match
                </button>
                <button class="c-btn c-btn--outline-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" data-dropdown-toggle>
                    <span class="visually-hidden">More Actions</span>
                </button>
                <ul class="dropdown-menu" data-dropdown-menu>
                    <li><a class="dropdown-item" href="{{ url_for('admin_live.dashboard') }}"><i class="ti ti-broadcast me-2"></i>Live Reporting Dashboard</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" data-action="fetch-all-from-e-s-p-n" class="js-fetch-all-from-e-s-p-n"><i class="ti ti-download me-2"></i>Fetch from ESPN</a></li>
                    <li><a class="dropdown-item" data-action="schedule-all-matches" class="js-schedule-all-matches"><i class="ti ti-calendar-check me-2"></i>Schedule All</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" data-action="show-queue-status" class="js-show-queue-status"><i class="ti ti-list-details me-2"></i>Queue Status</a></li>
                    <li><a class="dropdown-item" data-action="show-cache-status" class="js-show-cache-status"><i class="ti ti-database me-2"></i>Cache Status</a></li>
                    <li><a class="dropdown-item" data-action="refresh-statuses" class="js-refresh-statuses"><i class="ti ti-refresh me-2"></i>Refresh Data</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Quick Stats Overview -->
    <div class="row mb-4">
        <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
            <div class="c-card h-100" data-component="worker-stats-card" data-worker="total-matches">
                <div class="c-card__body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="card-info">
                            <h6 class="c-card__title mb-2 text-nowrap">Total Matches</h6>
                            <div class="d-flex align-items-center">
                                <h3 class="mb-0" id="totalMatches">{{ matches|length }}</h3>
                                <small class="text-muted ms-2">scheduled</small>
                            </div>
                        </div>
                        <div class="card-icon">
                            <div class="avatar">
                                <div class="avatar-initial bg-label-primary rounded">
                                    <i class="ti ti-calendar-event"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
            <div class="c-card h-100" data-component="worker-stats-card" data-worker="active-threads">
                <div class="c-card__body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="card-info">
                            <h6 class="c-card__title mb-2 text-nowrap">Active Threads</h6>
                            <div class="d-flex align-items-center">
                                <h3 class="mb-0" id="activeThreads">--</h3>
                                <small class="text-muted ms-2">created</small>
                            </div>
                        </div>
                        <div class="card-icon">
                            <div class="avatar">
                                <div class="avatar-initial bg-label-success rounded">
                                    <i class="ti ti-messages"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
            <div class="c-card h-100 card-hover" data-component="worker-stats-card" data-worker="live-reporting">
                <div class="c-card__body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="card-info">
                            <h6 class="c-card__title mb-2 text-nowrap">Live Reporting</h6>
                            <div class="d-flex align-items-center">
                                <h3 class="mb-0" id="liveReporting">--</h3>
                                <small class="text-muted ms-2">active</small>
                            </div>
                            <div id="liveReportingDetails" class="mt-2 small text-muted">
                                <!-- Will be populated with active match details -->
                            </div>
                            <div class="mt-3">
                                <a href="{{ url_for('admin_live.dashboard') }}" class="c-btn c-btn--sm btn-label-info">
                                    <i class="ti ti-dashboard me-1"></i>Dashboard
                                </a>
                            </div>
                        </div>
                        <div class="card-icon">
                            <div class="avatar">
                                <div class="avatar-initial bg-label-info rounded">
                                    <i class="ti ti-broadcast"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6 col-md-6 mb-3">
            <div class="c-card h-100" data-component="worker-stats-card" data-worker="system-health">
                <div class="c-card__body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="card-info">
                            <h6 class="c-card__title mb-2 text-nowrap">System Health</h6>
                            <div class="d-flex align-items-center">
                                <h3 class="mb-0" id="systemHealth">--</h3>
                                <small class="text-muted ms-2">status</small>
                            </div>
                        </div>
                        <div class="card-icon">
                            <div class="avatar">
                                <div class="avatar-initial bg-label-warning rounded">
                                    <i class="ti ti-heart-rate-monitor"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter and Search Bar -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="c-card">
                <div class="c-card__body py-3">
                    <div class="row align-items-center">
                        <div class="col-md-4" data-form-group>
                            <div class="input-group" data-input-group>
                                <span class="input-group-text"><i class="ti ti-search"></i></span>
                                <input type="text" class="form-control" id="matchSearch" placeholder="Search matches..." data-form-control>
                            </div>
                        </div>
                        <div class="col-md-2" data-form-group>
                            <select class="form-select" id="competitionFilter" data-form-select>
                                <option value="">All Competitions</option>
                                <option value="MLS">MLS</option>
                                <option value="US Open Cup">US Open Cup</option>
                                <option value="Concacaf Champions League">Concacaf Champions League</option>
                                <option value="Leagues Cup">Leagues Cup</option>
                            </select>
                        </div>
                        <div class="col-md-2" data-form-group>
                            <select class="form-select" id="timeFilter" data-form-select>
                                <option value="relevant">Relevant Only</option>
                                <option value="all">All Matches</option>
                                <option value="upcoming">Upcoming Only</option>
                                <option value="previous">Previous Only</option>
                            </select>
                        </div>
                        <div class="col-md-2" data-form-group>
                            <select class="form-select" id="statusFilter" data-form-select>
                                <option value="">All Status</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="running">Running</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="col-md-2" data-form-group>
                            <select class="form-select" id="viewMode" data-form-select>
                                <option value="cards">Card View</option>
                                <option value="table">Table View</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="c-btn c-btn--outline-secondary w-100" data-action="clear-filters" class="js-clear-filters">
                                <i class="ti ti-filter-x me-1"></i>Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Match Cards View -->
    <div id="matchCardsContainer" class="match-cards-container">
        <div class="row" id="matchCardsRow">
            {% for match in matches %}
            <div class="col-xl-6 col-lg-12 mb-4 match-card-wrapper" data-match-id="{{ match.id }}"
                 data-match-type="current" data-competition="{{ match.competition }}" data-status="{{ match.live_reporting_status }}"
                 data-component="match-card">
                <div class="c-card match-card h-100">
                    <div class="c-card__body">
                        <!-- Match Header -->
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="d-flex align-items-center">
                                <div class="avatar me-3">
                                    <div class="avatar-initial bg-label-{{ 'success' if match.is_home_game else 'warning' }} rounded">
                                        <i class="ti ti-{{ 'home' if match.is_home_game else 'plane' }}"></i>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="mb-1">
                                        {% if match.is_home_game %}
                                        Sounders vs {{ match.opponent }}
                                        {% else %}
                                        {{ match.opponent }} vs Sounders
                                        {% endif %}
                                    </h5>
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="badge bg-light text-dark" data-badge>{{ match.competition }}</span>
                                        <small class="text-muted">{{ match.venue or 'TBD' }}</small>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown">
                                <button class="c-btn c-btn--sm c-btn--icon-only c-btn--outline-secondary dropdown-toggle hide-arrow" 
                                        data-bs-toggle="dropdown" data-dropdown-toggle>
                                    <i class="ti ti-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" data-dropdown-menu>
                                    <li><a class="dropdown-item" data-action="edit-match" data-value="{{ match.id }}" class="js-edit-match">
                                        <i class="ti ti-edit me-2"></i>Edit Match</a></li>
                                    <li><a class="dropdown-item" data-action="debug-match-tasks" data-value="{{ match.id }}" class="js-debug-match-tasks">
                                        <i class="ti ti-bug me-2"></i>Debug Tasks</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-danger" data-action="remove-match" data-value="{{ match.id }}" class="js-remove-match">
                                        <i class="ti ti-trash me-2"></i>Remove</a></li>
                                </ul>
                            </div>
                        </div>

                        <!-- Match Details -->
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="ti ti-calendar me-2 text-muted"></i>
                                    <span class="small">{{ match.date_time.strftime('%m/%d/%Y') }}</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <i class="ti ti-clock me-2 text-muted"></i>
                                    <span class="small scheduled-time" data-time data-component="scheduled-time">{{ match.date_time.strftime('%I:%M %p PT') }}</span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-end">
                                    <div class="mb-2">
                                        <span class="badge bg-{{ match.status_color }}" id="status-{{ match.id }}" data-badge>
                                            <i class="ti {{ match.status_icon }}"></i>
                                            {{ match.status_display }}
                                        </span>
                                    </div>
                                    {% if match.discord_thread_id %}
                                    <a href="https://discord.com/channels/{{ config.SERVER_ID }}/{{ config.MATCH_CHANNEL_ID }}/{{ match.discord_thread_id }}" 
                                       class="c-btn c-btn--sm c-btn--outline-primary" target="_blank">
                                        <i class="ti ti-brand-discord me-1"></i>View Thread
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Thread and Reporting Status -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="status-section">
                                    <h6 class="small text-muted mb-2">THREAD STATUS</h6>
                                    {% if match.thread_created %}
                                    <div class="d-flex align-items-center">
                                        <div class="status-dot bg-success me-2"></div>
                                        <span class="small fw-medium">Created</span>
                                    </div>
                                    {% else %}
                                    <div class="d-flex align-items-center">
                                        <div class="status-dot bg-warning me-2"></div>
                                        <span class="small fw-medium">Pending</span>
                                        {% if match.thread_creation_time %}
                                        <small class="text-muted ms-2">
                                            {{ match.thread_creation_time.strftime('%m/%d %I:%M %p') }}
                                        </small>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="status-section">
                                    <h6 class="small text-muted mb-2">LIVE REPORTING</h6>
                                    <div class="d-flex align-items-center">
                                        <div class="status-dot bg-{{ match.status_color }} me-2"></div>
                                        <span class="small fw-medium">{{ match.status_display }}</span>
                                        {% if match.live_reporting_scheduled and not match.live_reporting_started %}
                                        <small class="text-muted ms-2">
                                            Start: {{ (match.date_time - timedelta(minutes=5)).strftime('%I:%M %p') }}
                                        </small>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Task Details -->
                        <div class="task-details-section mb-3">
                            <h6 class="small text-muted mb-2">TASK DETAILS</h6>
                            <div class="task-details-container" id="task-details-{{ match.id }}">
                                <!-- Loading state -->
                                <div class="text-center py-2">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status" data-spinner></div>
                                    <small class="text-muted d-block mt-1">Loading task info...</small>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex flex-wrap gap-2">
                            <!-- Thread Actions -->
                            {% if not match.thread_created %}
                            <button class="c-btn c-btn--outline-primary c-btn--sm" data-action="schedule-match" data-value="{{ match.id }}" class="js-schedule-match">
                                <i class="ti ti-calendar-plus me-1"></i>Schedule Thread
                            </button>
                            <button class="c-btn c-btn--success c-btn--sm" data-action="create-thread-now" data-value="{{ match.id }}" class="js-create-thread-now">
                                <i class="ti ti-plus me-1"></i>Create Now
                            </button>
                            {% endif %}
                            
                            <!-- Live Reporting Actions -->
                            {% if match.live_reporting_status in ['not_started', 'scheduled', 'stopped'] %}
                            <button class="c-btn c-btn--warning c-btn--sm" data-action="start-live-reporting" data-value="{{ match.id }}" class="js-start-live-reporting">
                                <i class="ti ti-play me-1"></i>Start Reporting
                            </button>
                            {% elif match.live_reporting_status == 'running' %}
                            <button class="c-btn c-btn--danger c-btn--sm" data-action="stop-live-reporting" data-value="{{ match.id }}" class="js-stop-live-reporting">
                                <i class="ti ti-stop me-1"></i>Stop Reporting
                            </button>
                            {% endif %}
                            
                            <!-- Force Actions -->
                            <button class="c-btn c-btn--outline-warning c-btn--sm" data-action="force-schedule-match" data-value="{{ match.id }}" class="js-force-schedule-match">
                                <i class="ti ti-refresh me-1"></i>Force Schedule
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Historical Matches Section -->
        {% if historical_count > 0 %}
        <div class="row mt-4">
            <div class="col-12">
                <div class="c-card">
                    <div class="c-card__body py-3">
                        <button class="c-btn c-btn--outline-secondary c-btn--sm w-100" type="button" data-bs-toggle="collapse" data-bs-target="#historicalMatches" aria-expanded="false" aria-controls="historicalMatches" data-collapse-toggle>
                            <i class="ti ti-history me-2"></i>
                            Show Historical Matches ({{ historical_count }} older matches)
                            <i class="ti ti-chevron-down ms-2" id="historicalToggleIcon"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="collapse" id="historicalMatches">
            <div class="row mt-3" id="historicalMatchesRow">
                {% for match in historical_matches %}
                <div class="col-xl-6 col-lg-12 mb-4 match-card-wrapper historical-match" data-match-id="{{ match.id }}"
                     data-match-type="historical" data-competition="{{ match.competition }}" data-status="{{ match.live_reporting_status }}"
                     data-component="match-card">
                    <div class="c-card match-card h-100 opacity-75">
                        <div class="c-card__body">
                            <!-- Match Header -->
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="avatar me-3">
                                        <div class="avatar-initial bg-label-secondary rounded">
                                            <i class="ti ti-history"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <h5 class="mb-1 text-muted">
                                            {% if match.is_home_game %}
                                            Sounders vs {{ match.opponent }}
                                            {% else %}
                                            {{ match.opponent }} vs Sounders
                                            {% endif %}
                                        </h5>
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="badge bg-light text-dark" data-badge>{{ match.competition }}</span>
                                            <small class="text-muted">{{ match.venue or 'TBD' }}</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted d-block">{{ match.date_time.strftime('%m/%d/%Y') }}</small>
                                    <small class="text-muted">{{ match.date_time.strftime('%I:%M %p') }} PT</small>
                                </div>
                            </div>

                            <!-- Match Details -->
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <div class="avatar mx-auto mb-1">
                                            <div class="avatar-initial bg-label-info rounded-circle">
                                                <i class="ti ti-message-circle"></i>
                                            </div>
                                        </div>
                                        <h6 class="mb-1 text-muted">THREAD STATUS</h6>
                                        <p class="mb-0">
                                            {% if match.discord_thread_id %}
                                            <span class="badge bg-success" data-badge>Created</span>
                                            {% else %}
                                            <span class="badge bg-secondary" data-badge>Not Created</span>
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <div class="avatar mx-auto mb-1">
                                            <div class="avatar-initial bg-label-warning rounded-circle">
                                                <i class="ti ti-broadcast"></i>
                                            </div>
                                        </div>
                                        <h6 class="mb-1 text-muted">LIVE REPORTING</h6>
                                        <p class="mb-0">
                                            <span class="badge bg-label-{{ match.status_color }}" data-badge>{{ match.status_display }}</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <div class="avatar mx-auto mb-1">
                                            <div class="avatar-initial bg-label-secondary rounded-circle">
                                                <i class="ti ti-list-details"></i>
                                            </div>
                                        </div>
                                        <h6 class="mb-1 text-muted">TASK DETAILS</h6>
                                        <p class="mb-0">
                                            <small class="text-muted">Historical</small>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Task Details Section (Loaded on expand) -->
                            <div class="task-details-section mb-3">
                                <h6 class="text-muted mb-2"><i class="ti ti-list-details me-2"></i>Task Details</h6>
                                <div class="task-details-container" id="task-details-{{ match.id }}">
                                    <div class="text-center text-muted py-3">
                                        <small>Expand to load task details</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Table View (Hidden by default) -->
    <div id="matchTableContainer" class="match-table-container">
        <div class="c-card">
            <div class="c-card__body">
                <div class="c-table-wrapper" data-table-responsive>
                    <table class="c-table c-table--hoverable" id="matchesTable" data-table>
                        <thead class="c-table--light" scope="col">
                            <tr>
                                <th scope="col">Match</th>
                                <th scope="col">Date & Time</th>
                                <th scope="col">Competition</th>
                                <th scope="col">Thread</th>
                                <th scope="col">Reporting</th>
                                <th scope="col">Tasks</th>
                                <th class="text-center" scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for match in matches %}
                            <tr id="match-row-{{ match.id }}" data-match-id="{{ match.id }}" data-match-type="current">
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar me-2">
                                            <div class="avatar-initial bg-label-{{ 'success' if match.is_home_game else 'warning' }} rounded-circle">
                                                <i class="ti ti-{{ 'home' if match.is_home_game else 'plane' }}"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">
                                                {% if match.is_home_game %}
                                                Sounders vs {{ match.opponent }}
                                                {% else %}
                                                {{ match.opponent }} vs Sounders
                                                {% endif %}
                                            </h6>
                                            <small class="text-muted">{{ match.venue or 'TBD' }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div>{{ match.date_time.strftime('%m/%d/%Y') }}</div>
                                    <small class="text-muted">{{ match.date_time.strftime('%I:%M %p PT') }}</small>
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark" data-badge>{{ match.competition }}</span>
                                </td>
                                <td>
                                    {% if match.thread_created %}
                                    <span class="badge bg-success" data-badge>Created</span>
                                    {% else %}
                                    <span class="badge bg-warning" data-badge>Pending</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-{{ match.status_color }}" data-badge>{{ match.status_display }}</span>
                                </td>
                                <td>
                                    <div id="table-task-details-{{ match.id }}">
                                        <small class="text-muted">Loading...</small>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="btn-group btn-group-sm">
                                        {% if not match.thread_created %}
                                        <button class="c-btn c-btn--outline-primary" data-action="schedule-match" data-value="{{ match.id }}" class="js-schedule-match" title="Schedule">
                                            <i class="ti ti-calendar-plus"></i>
                                        </button>
                                        {% endif %}
                                        {% if match.live_reporting_status in ['not_started', 'scheduled', 'stopped'] %}
                                        <button class="c-btn c-btn--outline-warning" data-action="start-live-reporting" data-value="{{ match.id }}" class="js-start-live-reporting" title="Start Reporting">
                                            <i class="ti ti-play"></i>
                                        </button>
                                        {% elif match.live_reporting_status == 'running' %}
                                        <button class="c-btn c-btn--outline-danger" data-action="stop-live-reporting" data-value="{{ match.id }}" class="js-stop-live-reporting" title="Stop Reporting">
                                            <i class="ti ti-stop"></i>
                                        </button>
                                        {% endif %}
                                        <button class="c-btn c-btn--outline-secondary" data-action="edit-match" data-value="{{ match.id }}" class="js-edit-match" title="Edit">
                                            <i class="ti ti-edit"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Match Modal -->
<div class="modal c-modal fade" data-modal id="addMatchModal" tabindex="-1" aria-labelledby="addMatchModalLabel">
    <div class="modal-dialog c-modal__dialog modal-lg c-modal__dialog--lg" data-modal-dialog>
        <div class="modal-content c-modal__content" data-modal-content data-modal-content>
            <div class="modal-header c-modal__header" data-modal-header data-modal-header>
                <h5 class="modal-title c-modal__title" id="addMatchModalLabel">
                    <i class="ti ti-plus me-2"></i>Add New Match
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" data-dismiss></button>
            </div>
            <div class="modal-body c-modal__body" data-modal-body data-modal-body>
                <div class="alert alert-info" data-alert>
                    <i class="ti ti-info-circle me-2"></i>
                    Enter a date and competition to fetch Seattle Sounders match information from ESPN automatically.
                </div>
                <form id="addMatchForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="matchDate" class="form-label">Match Date</label>
                            <input type="date" class="form-control" id="matchDate" name="date" required data-form-control>
                            <div class="form-text">System will search ESPN for matches on this date</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="matchCompetition" class="form-label">Competition</label>
                            <select class="form-select" id="matchCompetition" name="competition" required data-form-select>
                                <option value="MLS">MLS</option>
                                <option value="US Open Cup">US Open Cup</option>
                                <option value="Concacaf Champions League">Concacaf Champions League</option>
                                <option value="Concacaf">Concacaf</option>
                                <option value="Leagues Cup">Leagues Cup</option>
                                <option value="FIFA Club World Cup">FIFA Club World Cup</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer c-modal__footer" data-modal-footer data-modal-footer>
                <button type="button" class="c-btn c-btn--outline-secondary" data-bs-dismiss="modal" data-dismiss>Cancel</button>
                <button type="button" class="c-btn c-btn--primary" data-action="add-match-by-date" class="js-add-match-by-date">
                    <i class="ti ti-download me-1"></i>Fetch Match from ESPN
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Queue Status Modal -->
<div class="modal c-modal fade" data-modal id="queueStatusModal" tabindex="-1" aria-labelledby="queueStatusModalLabel">
    <div class="modal-dialog c-modal__dialog modal-xl c-modal__dialog--xl" data-modal-dialog>
        <div class="modal-content c-modal__content" data-modal-content data-modal-content>
            <div class="modal-header c-modal__header" data-modal-header data-modal-header>
                <h5 class="modal-title c-modal__title" id="queueStatusModalLabel">
                    <i class="ti ti-list-details me-2"></i>System Queue Status
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" data-dismiss></button>
            </div>
            <div class="modal-body c-modal__body" data-modal-body data-modal-body>
                <div id="queueStatusContent">
                    <div class="text-center py-4">
                        <div class="spinner-border" role="status" data-spinner></div>
                        <p class="text-muted mt-2">Loading queue status...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer c-modal__footer" data-modal-footer data-modal-footer>
                <button type="button" class="c-btn c-btn--outline-secondary" data-bs-dismiss="modal" data-dismiss>Close</button>
                <button type="button" class="c-btn c-btn--primary" data-action="refresh-queue-status" class="js-refresh-queue-status">
                    <i class="ti ti-refresh me-1"></i>Refresh
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block custom_css %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/admin/match-management.css') }}?v={{ current_time.timestamp() }}">
{% endif %}
{% endblock %}

{% block custom_js %}
{{ super() }}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% if not config.get('ASSETS_PRODUCTION_MODE') %}
<script src="{{ url_for('static', filename='custom_js/match-management.js') }}?v={{ current_time.timestamp() }}"></script>

{% endif %}
{% endblock %}