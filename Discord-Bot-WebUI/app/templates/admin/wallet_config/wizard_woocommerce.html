<h5><i class="ti ti-shopping-cart me-2"></i>Step 5: WooCommerce Integration</h5>

<div class="alert alert-info">
    <div class="d-flex">
        <div class="me-3">
            <i class="ti ti-info-circle fs-3"></i>
        </div>
        <div>
            <h6 class="alert-heading">Connect Your Online Store</h6>
            <p class="mb-0">This step connects your WooCommerce store to automatically generate digital wallet passes when customers purchase ECS memberships or Pub League registrations.</p>
        </div>
    </div>
</div>

<!-- Current Status -->
<div class="mb-4">
    <h6>Integration Status</h6>

    <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">WooCommerce Connection</h6>
            <div>
                {% if step_data.webhook_configured %}
                <span class="badge bg-label-success">Connected</span>
                {% else %}
                <span class="badge bg-label-warning">Not Configured</span>
                {% endif %}
            </div>
        </div>
        <div class="card-body">
            {% if step_data.webhook_configured %}
            <div class="alert alert-success mb-3">
                <i class="ti ti-circle-check me-2"></i>
                <strong>WooCommerce is connected!</strong> Orders containing membership products will automatically generate wallet passes.
            </div>
            <p class="mb-0"><strong>Last webhook received:</strong> {{ step_data.last_webhook_time or 'Never' }}</p>
            {% else %}
            <p class="mb-3">Follow the steps below to connect your WooCommerce store.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Setup Instructions -->
<div class="mb-4">
    <h6>Setup Instructions</h6>

    <div class="accordion" id="wooSetupAccordion">
        <!-- Step 1: Download Plugin -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#wooStep1">
                    <span class="badge bg-primary rounded-circle me-2">1</span>
                    Download the WordPress Plugin
                </button>
            </h2>
            <div id="wooStep1" class="accordion-collapse collapse show" data-bs-parent="#wooSetupAccordion">
                <div class="accordion-body">
                    <p>Download the ECS Digital Wallet Pass plugin for WordPress:</p>

                    <a href="{{ url_for('wallet_config.download_woo_plugin') }}" class="btn btn-primary mb-3">
                        <i class="ti ti-download me-1"></i> Download Plugin (ecs-wallet-pass.zip)
                    </a>

                    <div class="alert alert-info mb-3">
                        <i class="ti ti-info-circle me-2"></i>
                        <strong>Important:</strong> The plugin downloads as a ZIP file. <strong>Do not unzip it</strong> - WordPress will extract it automatically during installation.
                    </div>

                    <div class="alert bg-body-tertiary border">
                        <h6><i class="ti ti-bulb me-1"></i> Why a Plugin?</h6>
                        <p class="mb-0 small">Using a plugin is safer than editing your theme's functions.php file. Plugins survive theme updates and won't break your site if there's an error.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Install Plugin -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#wooStep2">
                    <span class="badge bg-primary rounded-circle me-2">2</span>
                    Install the Plugin in WordPress
                </button>
            </h2>
            <div id="wooStep2" class="accordion-collapse collapse" data-bs-parent="#wooSetupAccordion">
                <div class="accordion-body">
                    <div class="alert alert-primary mb-4">
                        <i class="ti ti-info-circle me-2"></i>
                        <strong>WordPress Admin URL:</strong> Your WordPress admin dashboard is typically at <code>https://yoursite.com/wp-admin</code>
                    </div>

                    <h6 class="mb-3">Step-by-Step Installation</h6>

                    <div class="card mb-3 border">
                        <div class="card-header bg-body-tertiary">
                            <strong>Step 2.1:</strong> Log into WordPress Admin
                        </div>
                        <div class="card-body">
                            <ol class="mb-0">
                                <li>Open your browser and go to <code>https://yoursite.com/wp-admin</code></li>
                                <li>Enter your WordPress admin username and password</li>
                                <li>Click <strong>"Log In"</strong></li>
                            </ol>
                        </div>
                    </div>

                    <div class="card mb-3 border">
                        <div class="card-header bg-body-tertiary">
                            <strong>Step 2.2:</strong> Navigate to Plugin Upload
                        </div>
                        <div class="card-body">
                            <ol class="mb-3">
                                <li>In the left sidebar, hover over <strong>"Plugins"</strong></li>
                                <li>Click <strong>"Add New"</strong> from the submenu</li>
                                <li>At the top of the page, click the <strong>"Upload Plugin"</strong> button</li>
                            </ol>
                            <div class="bg-body-tertiary p-3 rounded text-center">
                                <p class="mb-2 small text-muted">WordPress Admin Sidebar Path:</p>
                                <code class="fs-6">Plugins → Add New → Upload Plugin</code>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3 border">
                        <div class="card-header bg-body-tertiary">
                            <strong>Step 2.3:</strong> Upload and Install
                        </div>
                        <div class="card-body">
                            <ol class="mb-0">
                                <li>Click <strong>"Choose File"</strong> (or "Browse")</li>
                                <li>Navigate to your Downloads folder and select <code>ecs-wallet-pass.zip</code></li>
                                <li>Click <strong>"Install Now"</strong></li>
                                <li>Wait for the installation to complete (usually a few seconds)</li>
                                <li>Click <strong>"Activate Plugin"</strong></li>
                            </ol>
                            <div class="alert alert-warning mt-3 mb-0 small">
                                <i class="ti ti-alert-triangle me-2"></i>
                                <strong>Remember:</strong> Upload the ZIP file directly - don't extract it first!
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-success">
                        <i class="ti ti-circle-check me-2"></i>
                        <strong>Success!</strong> Once activated, you'll see "ECS Digital Wallet Pass" in your plugins list. You can find its settings at <strong>Settings → ECS Wallet Pass</strong>.
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="card bg-body-tertiary h-100">
                                <div class="card-body text-center">
                                    <i class="ti ti-puzzle text-primary" style="font-size: 2rem;"></i>
                                    <p class="mb-0 mt-2 small"><strong>1. Plugins → Add New</strong></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-body-tertiary h-100">
                                <div class="card-body text-center">
                                    <i class="ti ti-upload text-warning" style="font-size: 2rem;"></i>
                                    <p class="mb-0 mt-2 small"><strong>2. Upload Plugin</strong></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-body-tertiary h-100">
                                <div class="card-body text-center">
                                    <i class="ti ti-check text-success" style="font-size: 2rem;"></i>
                                    <p class="mb-0 mt-2 small"><strong>3. Activate Plugin</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Configure Plugin -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#wooStep3">
                    <span class="badge bg-primary rounded-circle me-2">3</span>
                    Configure Plugin Settings
                </button>
            </h2>
            <div id="wooStep3" class="accordion-collapse collapse" data-bs-parent="#wooSetupAccordion">
                <div class="accordion-body">
                    <p>After activating the plugin, configure it:</p>

                    <ol class="mb-3">
                        <li>Go to <strong>Settings → ECS Wallet Pass</strong></li>
                        <li>Enter the following settings:</li>
                    </ol>

                    <div class="table-responsive mb-3">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Setting</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Portal URL</strong></td>
                                    <td>
                                        <code id="portalUrl">{{ request.host_url.rstrip('/') }}</code>
                                        <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('portalUrl')">
                                            <i class="ti ti-copy"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Webhook Secret</strong></td>
                                    <td>
                                        <code id="webhookSecret">{{ step_data.webhook_secret or 'Generate a secret key below' }}</code>
                                        <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('webhookSecret')">
                                            <i class="ti ti-copy"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>WooCommerce Site URL</strong></td>
                                    <td>
                                        <div class="input-group" style="max-width: 400px;">
                                            <input type="url" class="form-control" id="woocommerceSiteUrl"
                                                   value="{{ step_data.woocommerce_site_url or '' }}"
                                                   placeholder="https://weareecs.com">
                                            <button class="btn btn-primary" type="button" onclick="saveWooCommerceUrl()">
                                                <i class="ti ti-device-floppy me-1"></i> Save
                                            </button>
                                        </div>
                                        <div id="wooUrlStatus" class="mt-1">
                                            {% if step_data.woocommerce_site_url %}
                                            <span class="text-success"><i class="ti ti-check me-1"></i>Configured</span>
                                            {% else %}
                                            <span class="text-warning"><i class="ti ti-alert-triangle me-1"></i>Required</span>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    {% if not step_data.woocommerce_site_url %}
                    <div class="alert alert-warning mb-3" id="wooUrlWarning">
                        <i class="ti ti-alert-triangle me-2"></i>
                        <strong>WooCommerce Site URL not configured!</strong> Enter your WordPress site URL above (e.g., <code>https://weareecs.com</code>).
                        <br><small class="text-muted">This is required for the portal to send download tokens back to WooCommerce after creating passes.</small>
                    </div>
                    {% endif %}

                    {% if not step_data.webhook_secret %}
                    <div class="alert alert-warning">
                        <i class="ti ti-alert-triangle me-2"></i>
                        <strong>Webhook Secret not configured!</strong> You need to set the <code>WALLET_WEBHOOK_SECRET</code> environment variable on this server.
                        <br><br>
                        <strong>Generate a secure secret:</strong>
                        <div class="input-group mt-2" style="max-width: 400px;">
                            <input type="text" class="form-control" id="generatedSecret" readonly value="">
                            <button class="btn btn-outline-primary" type="button" onclick="generateSecret()">
                                <i class="ti ti-refresh me-1"></i> Generate
                            </button>
                            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('generatedSecret')">
                                <i class="ti ti-copy"></i>
                            </button>
                        </div>
                        <small class="text-muted mt-2 d-block">Copy this secret and add it to both your server environment and WordPress plugin settings.</small>
                    </div>
                    {% endif %}

                    <ol start="3">
                        <li>Click <strong>"Save Changes"</strong></li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Step 4: Create Webhook -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#wooStep4">
                    <span class="badge bg-primary rounded-circle me-2">4</span>
                    Create WooCommerce Webhook
                </button>
            </h2>
            <div id="wooStep4" class="accordion-collapse collapse" data-bs-parent="#wooSetupAccordion">
                <div class="accordion-body">
                    <p>Create a webhook to notify the portal when orders are updated:</p>

                    <ol class="mb-3">
                        <li>In WordPress, go to <strong>WooCommerce → Settings → Advanced → Webhooks</strong></li>
                        <li>Click <strong>"Add webhook"</strong></li>
                        <li>Fill in the following:</li>
                    </ol>

                    <div class="table-responsive mb-3">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Field</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Name</strong></td>
                                    <td>ECS Wallet Pass</td>
                                </tr>
                                <tr>
                                    <td><strong>Status</strong></td>
                                    <td>Active</td>
                                </tr>
                                <tr>
                                    <td><strong>Topic</strong></td>
                                    <td>
                                        <strong>Order updated</strong>
                                        <br><small class="text-muted">Note: WooCommerce doesn't have an "Order completed" topic. The portal creates passes when orders reach "processing" status (payment received) or "completed" status.</small>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Delivery URL</strong></td>
                                    <td>
                                        <code id="webhookUrl">{{ request.host_url.rstrip('/') }}/api/v1/wallet/webhook/order-completed</code>
                                        <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('webhookUrl')">
                                            <i class="ti ti-copy"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Secret</strong></td>
                                    <td><em>(Same webhook secret from Step 3)</em></td>
                                </tr>
                                <tr>
                                    <td><strong>API Version</strong></td>
                                    <td>WP REST API Integration v3</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-info mb-3">
                        <i class="ti ti-info-circle me-2"></i>
                        <strong>Why "Order updated"?</strong> WooCommerce sends this webhook whenever an order status changes. The portal creates passes when orders reach "processing" (payment received) or "completed" status, so customers get their pass immediately after payment.
                    </div>

                    <ol start="4">
                        <li>Click <strong>"Save webhook"</strong></li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Step 5: Test -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#wooStep5">
                    <span class="badge bg-primary rounded-circle me-2">5</span>
                    Test the Connection
                </button>
            </h2>
            <div id="wooStep5" class="accordion-collapse collapse" data-bs-parent="#wooSetupAccordion">
                <div class="accordion-body">
                    <p>Verify everything is working:</p>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6><i class="ti ti-plug me-1"></i> Test Webhook Endpoint</h6>
                                    <p class="small text-muted">Verify the webhook endpoint is reachable</p>
                                    <a href="{{ request.host_url.rstrip('/') }}/api/v1/wallet/webhook/test"
                                       target="_blank" class="btn btn-outline-primary btn-sm">
                                        <i class="ti ti-external-link me-1"></i> Test Connection
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6><i class="ti ti-shopping-cart me-1"></i> Test with Real Order</h6>
                                    <p class="small text-muted">Create a test order in WooCommerce</p>
                                    <ol class="small mb-0">
                                        <li>Create a test order with a membership product</li>
                                        <li>Mark the order as "Completed"</li>
                                        <li>Check if the pass appears in Manage Passes</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-success">
                        <i class="ti ti-circle-check me-2"></i>
                        <strong>That's it!</strong> When customers purchase membership products and payment is received, they'll automatically receive download buttons for their digital wallet pass on the order confirmation page and in their email.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Plugin Validation -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0"><i class="ti ti-plug-connected me-2"></i>Plugin Validation</h6>
        <button type="button" class="btn btn-sm btn-outline-primary" onclick="validatePluginConnection()">
            <i class="ti ti-refresh me-1"></i> Check Connection
        </button>
    </div>
    <div class="card-body">
        <p>Verify that your WooCommerce plugin is properly installed and can communicate with this portal:</p>

        <div id="plugin-validation-result">
            <div class="alert bg-body-tertiary border mb-0">
                <i class="ti ti-info-circle me-2"></i>
                Click "Check Connection" to validate your plugin setup.
            </div>
        </div>

        <div class="mt-3">
            <h6>What This Test Checks:</h6>
            <ul class="small mb-0">
                <li><strong>Webhook endpoint:</strong> Verifies the portal's webhook endpoint is accessible</li>
                <li><strong>Authentication:</strong> Confirms the webhook secret matches (if configured)</li>
                <li><strong>Response format:</strong> Ensures proper JSON communication</li>
            </ul>
        </div>
    </div>
</div>

<!-- Product Name Patterns -->
<div class="card mb-4">
    <div class="card-header">
        <h6 class="mb-0"><i class="ti ti-list-check me-2"></i>Product Name Patterns</h6>
    </div>
    <div class="card-body">
        <p>The plugin automatically detects membership products based on their names. Make sure your WooCommerce products match these patterns:</p>

        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Pass Type</th>
                        <th>Product Name Examples</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <span class="badge bg-label-success">ECS Membership</span>
                        </td>
                        <td>
                            <ul class="mb-0 small">
                                <li>ECS 2026 Membership Card</li>
                                <li>ECS Membership 2025</li>
                                <li>ECS Membership Card</li>
                                <li>ECS Membership Package 2025</li>
                                <li><code>ECS 2026 Membership Card (testing)</code> <span class="badge bg-label-info">For Testing</span></li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="badge bg-label-warning">Pub League</span>
                        </td>
                        <td>
                            <ul class="mb-0 small">
                                <li>Pub League Registration</li>
                                <li>Pub League Spring 2025</li>
                                <li>Pub League Fall 2025</li>
                                <li>Pub League Season Pass</li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="alert alert-info mt-3 mb-0">
            <i class="ti ti-info-circle me-2"></i>
            <strong>Tip:</strong> The pattern matching is case-insensitive and ignores text in parentheses. So "ECS 2026 Membership Card (testing)" will match and use year 2026.
        </div>
    </div>
</div>

<!-- What Customers See -->
<div class="card">
    <div class="card-header">
        <h6 class="mb-0"><i class="ti ti-eye me-2"></i>What Customers Will See</h6>
    </div>
    <div class="card-body">
        <p>After completing an order with a membership product, customers will see:</p>

        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="card bg-body-tertiary h-100">
                    <div class="card-body text-center">
                        <i class="ti ti-receipt text-primary" style="font-size: 2rem;"></i>
                        <h6 class="mt-2">Order Confirmation Page</h6>
                        <p class="small text-muted mb-0">Download buttons appear immediately after checkout</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card bg-body-tertiary h-100">
                    <div class="card-body text-center">
                        <i class="ti ti-mail text-primary" style="font-size: 2rem;"></i>
                        <h6 class="mt-2">Order Email</h6>
                        <p class="small text-muted mb-0">Download link included in the order complete email</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card bg-body-tertiary h-100">
                    <div class="card-body text-center">
                        <i class="ti ti-user text-primary" style="font-size: 2rem;"></i>
                        <h6 class="mt-2">My Account</h6>
                        <p class="small text-muted mb-0">"Digital Pass" button in order history</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.value || element.textContent;
    navigator.clipboard.writeText(text).then(() => {
        // Show brief feedback
        const btn = element.nextElementSibling;
        const originalHtml = btn.innerHTML;
        btn.innerHTML = '<i class="ti ti-check"></i>';
        setTimeout(() => { btn.innerHTML = originalHtml; }, 1500);
    });
}

function generateSecret() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let secret = '';
    for (let i = 0; i < 32; i++) {
        secret += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    document.getElementById('generatedSecret').value = secret;
}

function saveWooCommerceUrl() {
    const urlInput = document.getElementById('woocommerceSiteUrl');
    const statusDiv = document.getElementById('wooUrlStatus');
    const warningDiv = document.getElementById('wooUrlWarning');
    const url = urlInput.value.trim();

    if (!url) {
        statusDiv.innerHTML = '<span class="text-danger"><i class="ti ti-x me-1"></i>URL is required</span>';
        return;
    }

    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        statusDiv.innerHTML = '<span class="text-danger"><i class="ti ti-x me-1"></i>URL must start with http:// or https://</span>';
        return;
    }

    statusDiv.innerHTML = '<span class="text-info"><i class="ti ti-loader ti-spin me-1"></i>Saving...</span>';

    fetch('{{ url_for("wallet_config.save_woocommerce_url") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.content || ''
        },
        body: JSON.stringify({ woocommerce_site_url: url })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            statusDiv.innerHTML = '<span class="text-success"><i class="ti ti-check me-1"></i>Saved successfully!</span>';
            if (warningDiv) {
                warningDiv.style.display = 'none';
            }
        } else {
            statusDiv.innerHTML = '<span class="text-danger"><i class="ti ti-x me-1"></i>' + (data.error || 'Failed to save') + '</span>';
        }
    })
    .catch(error => {
        statusDiv.innerHTML = '<span class="text-danger"><i class="ti ti-x me-1"></i>Error: ' + error.message + '</span>';
    });
}

function validatePluginConnection() {
    const resultDiv = document.getElementById('plugin-validation-result');
    resultDiv.innerHTML = `
        <div class="alert alert-info mb-0">
            <i class="ti ti-loader ti-spin me-2"></i>
            Checking webhook endpoint...
        </div>
    `;

    // Test our own webhook endpoint
    fetch('{{ request.host_url.rstrip("/") }}/api/v1/wallet/webhook/test')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'ok') {
                resultDiv.innerHTML = `
                    <div class="alert alert-success mb-3">
                        <i class="ti ti-circle-check me-2"></i>
                        <strong>Webhook Endpoint:</strong> Accessible and responding correctly
                    </div>
                    <div class="card bg-body-tertiary">
                        <div class="card-body">
                            <h6>Connection Details</h6>
                            <table class="table table-sm mb-0">
                                <tr>
                                    <td><strong>Status</strong></td>
                                    <td><span class="badge bg-label-success">OK</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Webhook URL</strong></td>
                                    <td><code>${data.webhook_url || 'N/A'}</code></td>
                                </tr>
                                <tr>
                                    <td><strong>Message</strong></td>
                                    <td>${data.message || 'Endpoint reachable'}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="alert alert-info mt-3 mb-0">
                        <i class="ti ti-info-circle me-2"></i>
                        <strong>Next Step:</strong> To fully test the integration, create a test order in WooCommerce with a product like "ECS 2026 Membership Card (testing)" - the pass will be created when payment is received (order moves to "processing" status).
                    </div>
                `;
            } else {
                throw new Error('Unexpected response from webhook endpoint');
            }
        })
        .catch(error => {
            resultDiv.innerHTML = `
                <div class="alert alert-danger mb-0">
                    <i class="ti ti-alert-circle me-2"></i>
                    <strong>Error:</strong> Could not reach webhook endpoint
                    <p class="mb-0 mt-2 small">${error.message}</p>
                </div>
            `;
        });
}
</script>
