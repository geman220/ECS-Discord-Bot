{% extends "base_flowbite.html" %}

{% block title %}Wallet Configuration Diagnostics{% endblock %}

{% block content %}
<div class="p-4 space-y-6">
    <!-- Page Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-1">
                <a href="{{ url_for('admin.admin_dashboard') }}" class="hover:text-[#1a472a] dark:hover:text-[#c9a227]">Admin</a>
                <span>/</span>
                <a href="{{ url_for('wallet_admin.wallet_management') }}" class="hover:text-[#1a472a] dark:hover:text-[#c9a227]">Digital Wallets</a>
                <span>/</span>
                <span>Diagnostics</span>
            </div>
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                <i class="ti ti-stethoscope text-[#1a472a] dark:text-[#c9a227]"></i>
                Wallet System Diagnostics
            </h1>
            <p class="text-gray-500 dark:text-gray-400">Detailed diagnostic information about your wallet pass configuration</p>
        </div>
        <div class="flex gap-2">
            <a href="{{ url_for('wallet_admin.wallet_management') }}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg transition-colors">
                <i class="ti ti-arrow-left mr-2"></i>Back to Dashboard
            </a>
            <button onclick="window.print()" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg transition-colors">
                <i class="ti ti-printer mr-2"></i>Print Report
            </button>
        </div>
    </div>

    <!-- Configuration Summary -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
            <h5 class="font-semibold text-gray-900 dark:text-white">Configuration Summary</h5>
            <div>
                {% if diagnostics.config_status.configured %}
                <span class="px-3 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 rounded-full">Valid Configuration</span>
                {% else %}
                <span class="px-3 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300 rounded-full">Issues Found</span>
                {% endif %}
            </div>
        </div>
        <div class="p-6">
            <!-- Status Alert -->
            {% if diagnostics.config_status.configured %}
            <div class="flex items-start gap-4 p-4 mb-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
                <i class="ti ti-circle-check text-2xl text-green-600 dark:text-green-400"></i>
                <div>
                    <strong class="text-green-800 dark:text-green-300">Wallet pass system is properly configured</strong>
                    <p class="text-green-700 dark:text-green-400 text-sm">All required components are in place.</p>
                </div>
            </div>
            {% else %}
            <div class="flex items-start gap-4 p-4 mb-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                <i class="ti ti-alert-triangle text-2xl text-yellow-600 dark:text-yellow-400"></i>
                <div>
                    <strong class="text-yellow-800 dark:text-yellow-300">Configuration issues detected</strong>
                    <p class="text-yellow-700 dark:text-yellow-400 text-sm">Issues were found that may prevent wallet passes from working properly.</p>
                </div>
            </div>
            {% endif %}

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- System Information -->
                <div>
                    <h6 class="font-semibold text-gray-900 dark:text-white mb-3">System Information</h6>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                            <tbody>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">App Path</th>
                                    <td class="py-2 text-right">{{ diagnostics.system_info.app_path }}</td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Asset Path</th>
                                    <td class="py-2 text-right">{{ diagnostics.system_info.asset_path }}</td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Certificate Path</th>
                                    <td class="py-2 text-right">{{ diagnostics.system_info.cert_path }}</td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Template Path</th>
                                    <td class="py-2 text-right">{{ diagnostics.system_info.template_path }}</td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Pass Type ID</th>
                                    <td class="py-2 text-right">{{ diagnostics.system_info.pass_type_id or 'Not configured' }}</td>
                                </tr>
                                <tr>
                                    <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Team ID</th>
                                    <td class="py-2 text-right">{{ diagnostics.system_info.team_id or 'Not configured' }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Directory Status -->
                <div>
                    <h6 class="font-semibold text-gray-900 dark:text-white mb-3">Directory Status</h6>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                <tr>
                                    <th scope="col" class="px-3 py-2">Directory</th>
                                    <th scope="col" class="px-3 py-2">Status</th>
                                    <th scope="col" class="px-3 py-2">Permissions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for name, details in diagnostics.directory_checks.items() %}
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="px-3 py-2 font-medium text-gray-900 dark:text-white">{{ name }}</td>
                                    <td class="px-3 py-2">
                                        {% if details.exists %}
                                        <span class="flex items-center gap-1 text-green-600 dark:text-green-400"><i class="ti ti-check"></i> Exists</span>
                                        {% else %}
                                        <span class="flex items-center gap-1 text-red-600 dark:text-red-400"><i class="ti ti-x"></i> Missing</span>
                                        {% endif %}
                                    </td>
                                    <td class="px-3 py-2">
                                        {% if details.exists and details.writable %}
                                        <span class="flex items-center gap-1 text-green-600 dark:text-green-400"><i class="ti ti-check"></i> Writable</span>
                                        {% elif details.exists %}
                                        <span class="flex items-center gap-1 text-red-600 dark:text-red-400"><i class="ti ti-x"></i> Not Writable</span>
                                        {% else %}
                                        <span class="text-gray-400 dark:text-gray-500">N/A</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    {% if not diagnostics.config_status.configured %}
                    <div class="mt-4">
                        <h6 class="font-semibold text-gray-900 dark:text-white mb-2">Issues to Resolve:</h6>
                        <ul class="list-disc list-inside text-red-600 dark:text-red-400 text-sm space-y-1">
                            {% for issue in diagnostics.config_status.issues %}
                            <li>{{ issue }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Database Configuration -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h5 class="font-semibold text-gray-900 dark:text-white">Database Configuration</h5>
        </div>
        <div class="p-6 space-y-6">
            <!-- Pass Types -->
            <div>
                <h6 class="font-semibold text-gray-900 dark:text-white mb-3">Pass Types</h6>
                {% if diagnostics.database_checks and diagnostics.database_checks['Pass Types'] %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- ECS Pass Type -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                        <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-600">
                            <h6 class="font-medium text-gray-900 dark:text-white">ECS Membership Pass Type</h6>
                            {% if diagnostics.database_checks['Pass Types'].ecs_type.exists %}
                            <span class="px-2 py-0.5 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 rounded">Found</span>
                            {% else %}
                            <span class="px-2 py-0.5 text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300 rounded">Missing</span>
                            {% endif %}
                        </div>
                        <div class="p-4">
                            {% if diagnostics.database_checks['Pass Types'].ecs_type.exists %}
                            <button type="button" class="text-[#1a472a] dark:text-[#c9a227] text-sm flex items-center gap-1 mb-2" onclick="toggleDetails('ecs-details')">
                                <i class="ti ti-chevron-down" id="ecs-details-icon"></i> View Details
                            </button>
                            <div id="ecs-details" class="hidden">
                                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                    <tbody>
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Code</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].ecs_type.details.code }}</td>
                                        </tr>
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Name</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].ecs_type.details.name }}</td>
                                        </tr>
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Description</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].ecs_type.details.description }}</td>
                                        </tr>
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Background Color</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].ecs_type.details.background_color }}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Active</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].ecs_type.details.is_active }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <p class="text-red-600 dark:text-red-400 text-sm">ECS Membership pass type is not defined in the database.</p>
                            <p class="text-gray-500 dark:text-gray-400 text-xs mt-1">Run <code class="px-1 py-0.5 bg-gray-200 dark:bg-gray-600 rounded">flask wallet init_types</code> to initialize.</p>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Pub League Pass Type -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                        <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-600">
                            <h6 class="font-medium text-gray-900 dark:text-white">Pub League Pass Type</h6>
                            {% if diagnostics.database_checks['Pass Types'].pub_type.exists %}
                            <span class="px-2 py-0.5 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 rounded">Found</span>
                            {% else %}
                            <span class="px-2 py-0.5 text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300 rounded">Missing</span>
                            {% endif %}
                        </div>
                        <div class="p-4">
                            {% if diagnostics.database_checks['Pass Types'].pub_type.exists %}
                            <button type="button" class="text-[#1a472a] dark:text-[#c9a227] text-sm flex items-center gap-1 mb-2" onclick="toggleDetails('pub-details')">
                                <i class="ti ti-chevron-down" id="pub-details-icon"></i> View Details
                            </button>
                            <div id="pub-details" class="hidden">
                                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                    <tbody>
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Code</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].pub_type.details.code }}</td>
                                        </tr>
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Name</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].pub_type.details.name }}</td>
                                        </tr>
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Description</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].pub_type.details.description }}</td>
                                        </tr>
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Background Color</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].pub_type.details.background_color }}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row" class="py-2 font-medium text-gray-900 dark:text-white">Active</th>
                                            <td class="py-2">{{ diagnostics.database_checks['Pass Types'].pub_type.details.is_active }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <p class="text-red-600 dark:text-red-400 text-sm">Pub League pass type is not defined in the database.</p>
                            <p class="text-gray-500 dark:text-gray-400 text-xs mt-1">Run <code class="px-1 py-0.5 bg-gray-200 dark:bg-gray-600 rounded">flask wallet init_types</code> to initialize.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="flex items-start gap-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                    <i class="ti ti-alert-circle text-red-600 dark:text-red-400"></i>
                    <p class="text-red-700 dark:text-red-400 text-sm">No pass types found. Run <code class="px-1 py-0.5 bg-red-100 dark:bg-red-900/50 rounded">flask wallet init_types</code> to initialize them.</p>
                </div>
                {% endif %}
            </div>

            <!-- Certificates -->
            <div>
                <h6 class="font-semibold text-gray-900 dark:text-white mb-3">Certificates</h6>
                {% if diagnostics.database_checks and diagnostics.database_checks['Certificates'] %}
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                    <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-600">
                        <h6 class="font-medium text-gray-900 dark:text-white">Apple Wallet Certificates</h6>
                        {% if diagnostics.database_checks['Certificates'].complete %}
                        <span class="px-2 py-0.5 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 rounded">Complete</span>
                        {% else %}
                        <span class="px-2 py-0.5 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300 rounded">Incomplete</span>
                        {% endif %}
                    </div>
                    <div class="p-4">
                        {% if diagnostics.database_checks['Certificates'].apple %}
                        <button type="button" class="text-[#1a472a] dark:text-[#c9a227] text-sm flex items-center gap-1 mb-2" onclick="toggleDetails('cert-details')">
                            <i class="ti ti-chevron-down" id="cert-details-icon"></i> View Certificate Details
                        </button>
                        <div id="cert-details" class="hidden mb-4">
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                    <thead class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-600 dark:text-gray-400">
                                        <tr>
                                            <th scope="col" class="px-3 py-2">Type</th>
                                            <th scope="col" class="px-3 py-2">Name</th>
                                            <th scope="col" class="px-3 py-2">File</th>
                                            <th scope="col" class="px-3 py-2">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for cert_type, cert in diagnostics.database_checks['Certificates'].apple.items() %}
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <td class="px-3 py-2 font-medium text-gray-900 dark:text-white">{{ cert_type }}</td>
                                            <td class="px-3 py-2">{{ cert.name }}</td>
                                            <td class="px-3 py-2">{{ cert.file_name }}</td>
                                            <td class="px-3 py-2">{{ cert.is_active and 'Active' or 'Inactive' }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <h6 class="font-medium text-gray-900 dark:text-white mb-2">Certificate Status</h6>
                        <ul class="space-y-1 text-sm">
                            {% set cert_types = ['certificate', 'key', 'wwdr'] %}
                            {% for cert_type in cert_types %}
                            {% if cert_type in diagnostics.database_checks['Certificates'].apple %}
                            <li class="flex items-center gap-2 text-green-600 dark:text-green-400"><i class="ti ti-check"></i> {{ cert_type|capitalize }} is present</li>
                            {% else %}
                            <li class="flex items-center gap-2 text-red-600 dark:text-red-400"><i class="ti ti-x"></i> {{ cert_type|capitalize }} is missing</li>
                            {% endif %}
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p class="text-yellow-600 dark:text-yellow-400 text-sm mb-3">No Apple certificates have been uploaded yet.</p>
                        <a href="{{ url_for('wallet_config.certificates') }}" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-[#1a472a] dark:text-[#c9a227] border border-[#1a472a] dark:border-[#c9a227] hover:bg-[#1a472a]/10 dark:hover:bg-[#c9a227]/10 rounded-lg transition-colors">
                            Upload Certificates
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="flex items-start gap-3 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                    <i class="ti ti-alert-triangle text-yellow-600 dark:text-yellow-400"></i>
                    <p class="text-yellow-700 dark:text-yellow-400 text-sm">No certificate information available.</p>
                </div>
                {% endif %}
            </div>

            <!-- Assets -->
            <div>
                <h6 class="font-semibold text-gray-900 dark:text-white mb-3">Assets</h6>
                {% if diagnostics.database_checks and diagnostics.database_checks['Assets'] %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- ECS Assets -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-600">
                            <h6 class="font-medium text-gray-900 dark:text-white">ECS Membership Assets</h6>
                        </div>
                        <div class="p-4">
                            {% if diagnostics.database_checks['Assets'].ecs_assets %}
                            <button type="button" class="text-[#1a472a] dark:text-[#c9a227] text-sm flex items-center gap-1 mb-2" onclick="toggleDetails('ecs-assets-details')">
                                <i class="ti ti-chevron-down" id="ecs-assets-details-icon"></i> View Asset Details
                            </button>
                            <div id="ecs-assets-details" class="hidden mb-4">
                                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                    <thead class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-600 dark:text-gray-400">
                                        <tr>
                                            <th scope="col" class="px-3 py-2">Asset</th>
                                            <th scope="col" class="px-3 py-2">File</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for asset_type, asset in diagnostics.database_checks['Assets'].ecs_assets.items() %}
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <td class="px-3 py-2 font-medium text-gray-900 dark:text-white">{{ asset_type }}</td>
                                            <td class="px-3 py-2">{{ asset.file_name }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <h6 class="font-medium text-gray-900 dark:text-white mb-2">Asset Status</h6>
                            <ul class="space-y-1 text-sm">
                                {% set required_assets = ['icon', 'logo'] %}
                                {% for asset_type in required_assets %}
                                {% if asset_type in diagnostics.database_checks['Assets'].ecs_assets %}
                                <li class="flex items-center gap-2 text-green-600 dark:text-green-400"><i class="ti ti-check"></i> {{ asset_type|capitalize }} is present</li>
                                {% else %}
                                <li class="flex items-center gap-2 text-red-600 dark:text-red-400"><i class="ti ti-x"></i> {{ asset_type|capitalize }} is missing</li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="text-yellow-600 dark:text-yellow-400 text-sm mb-3">No ECS Membership assets have been uploaded yet.</p>
                            <a href="{{ url_for('wallet_config.assets') }}" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-[#1a472a] dark:text-[#c9a227] border border-[#1a472a] dark:border-[#c9a227] hover:bg-[#1a472a]/10 dark:hover:bg-[#c9a227]/10 rounded-lg transition-colors">
                                Upload Assets
                            </a>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Pub League Assets -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-600">
                            <h6 class="font-medium text-gray-900 dark:text-white">Pub League Assets</h6>
                        </div>
                        <div class="p-4">
                            {% if diagnostics.database_checks['Assets'].pub_assets %}
                            <button type="button" class="text-[#1a472a] dark:text-[#c9a227] text-sm flex items-center gap-1 mb-2" onclick="toggleDetails('pub-assets-details')">
                                <i class="ti ti-chevron-down" id="pub-assets-details-icon"></i> View Asset Details
                            </button>
                            <div id="pub-assets-details" class="hidden mb-4">
                                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                    <thead class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-600 dark:text-gray-400">
                                        <tr>
                                            <th scope="col" class="px-3 py-2">Asset</th>
                                            <th scope="col" class="px-3 py-2">File</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for asset_type, asset in diagnostics.database_checks['Assets'].pub_assets.items() %}
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <td class="px-3 py-2 font-medium text-gray-900 dark:text-white">{{ asset_type }}</td>
                                            <td class="px-3 py-2">{{ asset.file_name }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <h6 class="font-medium text-gray-900 dark:text-white mb-2">Asset Status</h6>
                            <ul class="space-y-1 text-sm">
                                {% set required_assets = ['icon', 'logo'] %}
                                {% for asset_type in required_assets %}
                                {% if asset_type in diagnostics.database_checks['Assets'].pub_assets %}
                                <li class="flex items-center gap-2 text-green-600 dark:text-green-400"><i class="ti ti-check"></i> {{ asset_type|capitalize }} is present</li>
                                {% else %}
                                <li class="flex items-center gap-2 text-red-600 dark:text-red-400"><i class="ti ti-x"></i> {{ asset_type|capitalize }} is missing</li>
                                {% endif %}
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="text-yellow-600 dark:text-yellow-400 text-sm mb-3">No Pub League assets have been uploaded yet.</p>
                            <a href="{{ url_for('wallet_config.assets') }}" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-[#1a472a] dark:text-[#c9a227] border border-[#1a472a] dark:border-[#c9a227] hover:bg-[#1a472a]/10 dark:hover:bg-[#c9a227]/10 rounded-lg transition-colors">
                                Upload Assets
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="flex items-start gap-3 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                    <i class="ti ti-alert-triangle text-yellow-600 dark:text-yellow-400"></i>
                    <p class="text-yellow-700 dark:text-yellow-400 text-sm">No asset information available.</p>
                </div>
                {% endif %}
            </div>

            <!-- Templates -->
            <div>
                <h6 class="font-semibold text-gray-900 dark:text-white mb-3">Templates</h6>
                {% if diagnostics.database_checks and diagnostics.database_checks['Templates'] %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- ECS Templates -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-600">
                            <h6 class="font-medium text-gray-900 dark:text-white">ECS Membership Templates</h6>
                        </div>
                        <div class="p-4">
                            {% if diagnostics.database_checks['Templates'].ecs_templates %}
                            <button type="button" class="text-[#1a472a] dark:text-[#c9a227] text-sm flex items-center gap-1 mb-2" onclick="toggleDetails('ecs-templates-list')">
                                <i class="ti ti-chevron-down" id="ecs-templates-list-icon"></i> View Templates ({{ diagnostics.database_checks['Templates'].ecs_templates|length }})
                            </button>
                            <div id="ecs-templates-list" class="hidden mb-4">
                                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                    <thead class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-600 dark:text-gray-400">
                                        <tr>
                                            <th scope="col" class="px-3 py-2">Name</th>
                                            <th scope="col" class="px-3 py-2">Platform</th>
                                            <th scope="col" class="px-3 py-2">Default</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for template in diagnostics.database_checks['Templates'].ecs_templates %}
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <td class="px-3 py-2 font-medium text-gray-900 dark:text-white">{{ template.name }}</td>
                                            <td class="px-3 py-2">{{ template.platform }}</td>
                                            <td class="px-3 py-2">
                                                {% if template.is_default %}
                                                <span class="px-2 py-0.5 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 rounded">Default</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <h6 class="font-medium text-gray-900 dark:text-white mb-2">Template Status</h6>
                            <ul class="space-y-1 text-sm">
                                {% set has_default = false %}
                                {% for template in diagnostics.database_checks['Templates'].ecs_templates %}
                                {% if template.is_default %}
                                {% set has_default = true %}
                                {% endif %}
                                {% endfor %}

                                {% if has_default %}
                                <li class="flex items-center gap-2 text-green-600 dark:text-green-400"><i class="ti ti-check"></i> Default template is set</li>
                                {% else %}
                                <li class="flex items-center gap-2 text-yellow-600 dark:text-yellow-400"><i class="ti ti-alert-triangle"></i> No default template is set</li>
                                {% endif %}
                            </ul>
                            {% else %}
                            <p class="text-yellow-600 dark:text-yellow-400 text-sm mb-3">No ECS Membership templates have been created yet.</p>
                            <a href="{{ url_for('wallet_config.templates') }}" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-[#1a472a] dark:text-[#c9a227] border border-[#1a472a] dark:border-[#c9a227] hover:bg-[#1a472a]/10 dark:hover:bg-[#c9a227]/10 rounded-lg transition-colors">
                                Create Templates
                            </a>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Pub League Templates -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-600">
                            <h6 class="font-medium text-gray-900 dark:text-white">Pub League Templates</h6>
                        </div>
                        <div class="p-4">
                            {% if diagnostics.database_checks['Templates'].pub_templates %}
                            <button type="button" class="text-[#1a472a] dark:text-[#c9a227] text-sm flex items-center gap-1 mb-2" onclick="toggleDetails('pub-templates-list')">
                                <i class="ti ti-chevron-down" id="pub-templates-list-icon"></i> View Templates ({{ diagnostics.database_checks['Templates'].pub_templates|length }})
                            </button>
                            <div id="pub-templates-list" class="hidden mb-4">
                                <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                                    <thead class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-600 dark:text-gray-400">
                                        <tr>
                                            <th scope="col" class="px-3 py-2">Name</th>
                                            <th scope="col" class="px-3 py-2">Platform</th>
                                            <th scope="col" class="px-3 py-2">Default</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for template in diagnostics.database_checks['Templates'].pub_templates %}
                                        <tr class="border-b border-gray-200 dark:border-gray-600">
                                            <td class="px-3 py-2 font-medium text-gray-900 dark:text-white">{{ template.name }}</td>
                                            <td class="px-3 py-2">{{ template.platform }}</td>
                                            <td class="px-3 py-2">
                                                {% if template.is_default %}
                                                <span class="px-2 py-0.5 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 rounded">Default</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <h6 class="font-medium text-gray-900 dark:text-white mb-2">Template Status</h6>
                            <ul class="space-y-1 text-sm">
                                {% set has_default = false %}
                                {% for template in diagnostics.database_checks['Templates'].pub_templates %}
                                {% if template.is_default %}
                                {% set has_default = true %}
                                {% endif %}
                                {% endfor %}

                                {% if has_default %}
                                <li class="flex items-center gap-2 text-green-600 dark:text-green-400"><i class="ti ti-check"></i> Default template is set</li>
                                {% else %}
                                <li class="flex items-center gap-2 text-yellow-600 dark:text-yellow-400"><i class="ti ti-alert-triangle"></i> No default template is set</li>
                                {% endif %}
                            </ul>
                            {% else %}
                            <p class="text-yellow-600 dark:text-yellow-400 text-sm mb-3">No Pub League templates have been created yet.</p>
                            <a href="{{ url_for('wallet_config.templates') }}" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-[#1a472a] dark:text-[#c9a227] border border-[#1a472a] dark:border-[#c9a227] hover:bg-[#1a472a]/10 dark:hover:bg-[#c9a227]/10 rounded-lg transition-colors">
                                Create Templates
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="flex items-start gap-3 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                    <i class="ti ti-alert-triangle text-yellow-600 dark:text-yellow-400"></i>
                    <p class="text-yellow-700 dark:text-yellow-400 text-sm">No template information available.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Troubleshooting Actions -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h5 class="font-semibold text-gray-900 dark:text-white">Troubleshooting Actions</h5>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center p-6 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                    <i class="ti ti-refresh text-4xl text-[#1a472a] dark:text-[#c9a227] mb-3"></i>
                    <h5 class="font-semibold text-gray-900 dark:text-white mb-2">Reinitialize Pass Types</h5>
                    <p class="text-gray-500 dark:text-gray-400 text-sm mb-4">Recreate the basic pass type configuration if it's missing or corrupted.</p>
                    <button type="button" class="w-full inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-[#1a472a] hover:bg-[#1a472a]/90 dark:bg-[#c9a227] dark:hover:bg-[#c9a227]/90 rounded-lg transition-colors" onclick="showCommand('flask wallet init_types')">
                        Run Command
                    </button>
                </div>

                <div class="text-center p-6 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                    <i class="ti ti-bug text-4xl text-yellow-600 dark:text-yellow-400 mb-3"></i>
                    <h5 class="font-semibold text-gray-900 dark:text-white mb-2">Test Configuration</h5>
                    <p class="text-gray-500 dark:text-gray-400 text-sm mb-4">Run comprehensive tests on your wallet pass configuration.</p>
                    <a href="{{ url_for('wallet_config.test_config') }}" class="w-full inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-yellow-500 hover:bg-yellow-600 rounded-lg transition-colors">
                        Run Tests
                    </a>
                </div>

                <div class="text-center p-6 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                    <i class="ti ti-wand text-4xl text-blue-600 dark:text-blue-400 mb-3"></i>
                    <h5 class="font-semibold text-gray-900 dark:text-white mb-2">Setup Wizard</h5>
                    <p class="text-gray-500 dark:text-gray-400 text-sm mb-4">Restart the setup wizard to guide you through configuration.</p>
                    <a href="{{ url_for('wallet_config.setup_wizard') }}" class="w-full inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                        Start Wizard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Command Modal -->
<div id="commandModal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-md max-h-full">
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2">
                    <i class="ti ti-terminal"></i>Run Command
                </h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" onclick="closeCommandModal()">
                    <i class="ti ti-x text-xl"></i>
                </button>
            </div>
            <div class="p-4 md:p-5">
                <p class="text-gray-600 dark:text-gray-300 mb-3">To run this command, open a terminal in your project directory and execute:</p>
                <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                    <code class="text-green-400 font-mono" id="commandText"></code>
                </div>
                <div class="flex items-start gap-3 mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                    <i class="ti ti-alert-triangle text-yellow-600 dark:text-yellow-400 mt-0.5"></i>
                    <p class="text-yellow-700 dark:text-yellow-400 text-sm">This action must be performed by a system administrator on the server.</p>
                </div>
            </div>
            <div class="flex items-center p-4 md:p-5 border-t border-gray-200 rounded-b dark:border-gray-600">
                <button type="button" onclick="closeCommandModal()" class="w-full text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
// Toggle detail sections
function toggleDetails(id) {
    const element = document.getElementById(id);
    const icon = document.getElementById(id + '-icon');
    if (element) {
        const isHidden = element.classList.contains('hidden');
        if (isHidden) {
            element.classList.remove('hidden');
            if (icon) icon.classList.add('rotate-180');
        } else {
            element.classList.add('hidden');
            if (icon) icon.classList.remove('rotate-180');
        }
    }
}

// Show command modal
function showCommand(command) {
    document.getElementById('commandText').textContent = command;
    const modal = document.getElementById('commandModal');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
}

// Close command modal
function closeCommandModal() {
    const modal = document.getElementById('commandModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
}
</script>
{% endblock %}
