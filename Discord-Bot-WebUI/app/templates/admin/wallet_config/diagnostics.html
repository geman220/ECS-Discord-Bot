{% extends 'admin/layout.html' %}
{% block title %}Wallet Configuration Diagnostics{% endblock %}

{% block custom_css %}
<style>
    /* Diagnostics - Theme-aware styling */
    .code-block {
        background-color: var(--bs-tertiary-bg, #f8f9fa);
        border-radius: 4px;
        padding: 15px;
        margin: 15px 0;
        font-family: monospace;
        overflow-x: auto;
        white-space: pre;
    }
    .status-good {
        color: var(--bs-success, #28a745);
    }
    .status-warning {
        color: var(--bs-warning, #ffc107);
    }
    .status-error {
        color: var(--bs-danger, #dc3545);
    }
    .detail-toggle {
        cursor: pointer;
        color: var(--bs-primary);
    }
    .detail-content {
        background-color: var(--bs-tertiary-bg, #f8f9fa);
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
    }
    .directory-item {
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 8px;
    }
    .directory-item:nth-child(odd) {
        background-color: var(--bs-tertiary-bg, rgba(0, 0, 0, 0.03));
    }
</style>
{% endblock custom_css %}

{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="fw-bold text-primary mb-1">
                        <i class="ti ti-stethoscope me-2"></i>Wallet System Diagnostics
                    </h2>
                    <p class="text-muted mb-0">Detailed diagnostic information about your wallet pass configuration</p>
                </div>
                <div>
                    <a href="{{ url_for('wallet_admin.wallet_management') }}" class="btn btn-outline-secondary">
                        <i class="ti ti-arrow-left me-1"></i> Back to Dashboard
                    </a>
                    <button onclick="window.print()" class="btn btn-outline-primary ms-2">
                        <i class="ti ti-printer me-1"></i> Print Report
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration Summary -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Configuration Summary</h5>
                    <div>
                        {% if diagnostics.config_status.configured %}
                            <span class="badge bg-label-success">Valid Configuration</span>
                        {% else %}
                            <span class="badge bg-label-warning">Issues Found</span>
                        {% endif %}
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        {% if diagnostics.config_status.configured %}
                            <div class="alert alert-success d-flex">
                                <i class="ti ti-circle-check me-3 fs-4"></i>
                                <div>
                                    <strong>Wallet pass system is properly configured</strong>
                                    <p class="mb-0">All required components are in place.</p>
                                </div>
                            </div>
                        {% else %}
                            <div class="alert alert-warning d-flex">
                                <i class="ti ti-alert-triangle me-3 fs-4"></i>
                                <div>
                                    <strong>Configuration issues detected</strong>
                                    <p class="mb-0">Issues were found that may prevent wallet passes from working properly.</p>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="row">
                        <!-- Left Column -->
                        <div class="col-md-6">
                            <h6>System Information</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <th>App Path</th>
                                            <td>{{ diagnostics.system_info.app_path }}</td>
                                        </tr>
                                        <tr>
                                            <th>Asset Path</th>
                                            <td>{{ diagnostics.system_info.asset_path }}</td>
                                        </tr>
                                        <tr>
                                            <th>Certificate Path</th>
                                            <td>{{ diagnostics.system_info.cert_path }}</td>
                                        </tr>
                                        <tr>
                                            <th>Template Path</th>
                                            <td>{{ diagnostics.system_info.template_path }}</td>
                                        </tr>
                                        <tr>
                                            <th>Pass Type ID</th>
                                            <td>{{ diagnostics.system_info.pass_type_id or 'Not configured' }}</td>
                                        </tr>
                                        <tr>
                                            <th>Team ID</th>
                                            <td>{{ diagnostics.system_info.team_id or 'Not configured' }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Right Column -->
                        <div class="col-md-6">
                            <h6>Directory Status</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Directory</th>
                                            <th>Status</th>
                                            <th>Permissions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for name, details in diagnostics.directory_checks.items() %}
                                        <tr>
                                            <td>{{ name }}</td>
                                            <td>
                                                {% if details.exists %}
                                                    <i class="ti ti-check text-success"></i> Exists
                                                {% else %}
                                                    <i class="ti ti-x text-danger"></i> Missing
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if details.exists and details.writable %}
                                                    <i class="ti ti-check text-success"></i> Writable
                                                {% elif details.exists %}
                                                    <i class="ti ti-x text-danger"></i> Not Writable
                                                {% else %}
                                                    <span class="text-muted">N/A</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            {% if not diagnostics.config_status.configured %}
                                <div class="mt-3">
                                    <h6>Issues to Resolve:</h6>
                                    <ul class="text-danger">
                                        {% for issue in diagnostics.config_status.issues %}
                                            <li>{{ issue }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Database Configuration -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Database Configuration</h5>
                </div>
                <div class="card-body">
                    <!-- Pass Types -->
                    <h6 class="mb-3">Pass Types</h6>
                    {% if diagnostics.database_checks and diagnostics.database_checks['Pass Types'] %}
                        <div class="row mb-3">
                            <!-- ECS Pass Type -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">ECS Membership Pass Type</h6>
                                        {% if diagnostics.database_checks['Pass Types'].ecs_type.exists %}
                                            <span class="badge bg-label-success">Found</span>
                                        {% else %}
                                            <span class="badge bg-label-danger">Missing</span>
                                        {% endif %}
                                    </div>
                                    {% if diagnostics.database_checks['Pass Types'].ecs_type.exists %}
                                        <div class="card-body">
                                            <div class="detail-toggle" onclick="toggleDetail('ecs-details')">
                                                <i class="ti ti-chevron-down me-1"></i> View Details
                                            </div>
                                            <div id="ecs-details" class="detail-content d-none">
                                                <table class="table table-sm">
                                                    <tbody>
                                                        <tr>
                                                            <th>Code</th>
                                                            <td>{{ diagnostics.database_checks['Pass Types'].ecs_type.details.code }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Name</th>
                                                            <td>{{ diagnostics.database_checks['Pass Types'].ecs_type.details.name }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Description</th>
                                                            <td>{{ diagnostics.database_checks['Pass Types'].ecs_type.details.description }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Background Color</th>
                                                            <td>
                                                                <div class="d-flex align-items-center">
                                                                    <div style="width: 20px; height: 20px; background-color: {{ diagnostics.database_checks['Pass Types'].ecs_type.details.background_color }}; margin-right: 5px; border: 1px solid #ddd;"></div>
                                                                    {{ diagnostics.database_checks['Pass Types'].ecs_type.details.background_color }}
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th>Active</th>
                                                            <td>{{ diagnostics.database_checks['Pass Types'].ecs_type.details.is_active }}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="card-body">
                                            <p class="mb-0 text-danger">ECS Membership pass type is not defined in the database.</p>
                                            <p class="small text-muted">Run <code>flask wallet init_types</code> to initialize.</p>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Pub League Pass Type -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">Pub League Pass Type</h6>
                                        {% if diagnostics.database_checks['Pass Types'].pub_type.exists %}
                                            <span class="badge bg-label-success">Found</span>
                                        {% else %}
                                            <span class="badge bg-label-danger">Missing</span>
                                        {% endif %}
                                    </div>
                                    {% if diagnostics.database_checks['Pass Types'].pub_type.exists %}
                                        <div class="card-body">
                                            <div class="detail-toggle" onclick="toggleDetail('pub-details')">
                                                <i class="ti ti-chevron-down me-1"></i> View Details
                                            </div>
                                            <div id="pub-details" class="detail-content d-none">
                                                <table class="table table-sm">
                                                    <tbody>
                                                        <tr>
                                                            <th>Code</th>
                                                            <td>{{ diagnostics.database_checks['Pass Types'].pub_type.details.code }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Name</th>
                                                            <td>{{ diagnostics.database_checks['Pass Types'].pub_type.details.name }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Description</th>
                                                            <td>{{ diagnostics.database_checks['Pass Types'].pub_type.details.description }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th>Background Color</th>
                                                            <td>
                                                                <div class="d-flex align-items-center">
                                                                    <div style="width: 20px; height: 20px; background-color: {{ diagnostics.database_checks['Pass Types'].pub_type.details.background_color }}; margin-right: 5px; border: 1px solid #ddd;"></div>
                                                                    {{ diagnostics.database_checks['Pass Types'].pub_type.details.background_color }}
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th>Active</th>
                                                            <td>{{ diagnostics.database_checks['Pass Types'].pub_type.details.is_active }}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="card-body">
                                            <p class="mb-0 text-danger">Pub League pass type is not defined in the database.</p>
                                            <p class="small text-muted">Run <code>flask wallet init_types</code> to initialize.</p>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-danger">
                            <i class="ti ti-alert-circle me-2"></i> 
                            No pass types found. Run <code>flask wallet init_types</code> to initialize them.
                        </div>
                    {% endif %}

                    <!-- Certificates -->
                    <h6 class="mb-3 mt-4">Certificates</h6>
                    {% if diagnostics.database_checks and diagnostics.database_checks['Certificates'] %}
                        <div class="card mb-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">Apple Wallet Certificates</h6>
                                <div>
                                    {% if diagnostics.database_checks['Certificates'].complete %}
                                        <span class="badge bg-label-success">Complete</span>
                                    {% else %}
                                        <span class="badge bg-label-warning">Incomplete</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="card-body">
                                {% if diagnostics.database_checks['Certificates'].apple %}
                                    <div class="detail-toggle" onclick="toggleDetail('cert-details')">
                                        <i class="ti ti-chevron-down me-1"></i> View Certificate Details
                                    </div>
                                    <div id="cert-details" class="detail-content d-none">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Type</th>
                                                    <th>Name</th>
                                                    <th>File</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for cert_type, cert in diagnostics.database_checks['Certificates'].apple.items() %}
                                                <tr>
                                                    <td>{{ cert_type }}</td>
                                                    <td>{{ cert.name }}</td>
                                                    <td>{{ cert.file_name }}</td>
                                                    <td>{{ cert.is_active and 'Active' or 'Inactive' }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <h6>Certificate Status</h6>
                                        <ul>
                                            {% set cert_types = ['certificate', 'key', 'wwdr'] %}
                                            {% for cert_type in cert_types %}
                                                {% if cert_type in diagnostics.database_checks['Certificates'].apple %}
                                                    <li class="status-good"><i class="ti ti-check me-1"></i> {{ cert_type|capitalize }} is present</li>
                                                {% else %}
                                                    <li class="status-error"><i class="ti ti-x me-1"></i> {{ cert_type|capitalize }} is missing</li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% else %}
                                    <p class="mb-0 text-warning">No Apple certificates have been uploaded yet.</p>
                                    <a href="{{ url_for('wallet_config.certificates') }}" class="btn btn-sm btn-outline-primary mt-2">
                                        Upload Certificates
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="ti ti-alert-triangle me-2"></i>
                            No certificate information available.
                        </div>
                    {% endif %}

                    <!-- Assets -->
                    <h6 class="mb-3 mt-4">Assets</h6>
                    {% if diagnostics.database_checks and diagnostics.database_checks['Assets'] %}
                        <div class="row mb-3">
                            <!-- ECS Assets -->
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h6 class="mb-0">ECS Membership Assets</h6>
                                    </div>
                                    <div class="card-body">
                                        {% if diagnostics.database_checks['Assets'].ecs_assets %}
                                            <div class="detail-toggle" onclick="toggleDetail('ecs-assets-details')">
                                                <i class="ti ti-chevron-down me-1"></i> View Asset Details
                                            </div>
                                            <div id="ecs-assets-details" class="detail-content d-none">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>Asset</th>
                                                            <th>File</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for asset_type, asset in diagnostics.database_checks['Assets'].ecs_assets.items() %}
                                                        <tr>
                                                            <td>{{ asset_type }}</td>
                                                            <td>{{ asset.file_name }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <h6>Asset Status</h6>
                                                <ul>
                                                    {% set required_assets = ['icon', 'logo'] %}
                                                    {% for asset_type in required_assets %}
                                                        {% if asset_type in diagnostics.database_checks['Assets'].ecs_assets %}
                                                            <li class="status-good"><i class="ti ti-check me-1"></i> {{ asset_type|capitalize }} is present</li>
                                                        {% else %}
                                                            <li class="status-error"><i class="ti ti-x me-1"></i> {{ asset_type|capitalize }} is missing</li>
                                                        {% endif %}
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        {% else %}
                                            <p class="mb-0 text-warning">No ECS Membership assets have been uploaded yet.</p>
                                            <a href="{{ url_for('wallet_config.assets') }}" class="btn btn-sm btn-outline-primary mt-2">
                                                Upload Assets
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pub League Assets -->
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h6 class="mb-0">Pub League Assets</h6>
                                    </div>
                                    <div class="card-body">
                                        {% if diagnostics.database_checks['Assets'].pub_assets %}
                                            <div class="detail-toggle" onclick="toggleDetail('pub-assets-details')">
                                                <i class="ti ti-chevron-down me-1"></i> View Asset Details
                                            </div>
                                            <div id="pub-assets-details" class="detail-content d-none">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>Asset</th>
                                                            <th>File</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for asset_type, asset in diagnostics.database_checks['Assets'].pub_assets.items() %}
                                                        <tr>
                                                            <td>{{ asset_type }}</td>
                                                            <td>{{ asset.file_name }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <h6>Asset Status</h6>
                                                <ul>
                                                    {% set required_assets = ['icon', 'logo'] %}
                                                    {% for asset_type in required_assets %}
                                                        {% if asset_type in diagnostics.database_checks['Assets'].pub_assets %}
                                                            <li class="status-good"><i class="ti ti-check me-1"></i> {{ asset_type|capitalize }} is present</li>
                                                        {% else %}
                                                            <li class="status-error"><i class="ti ti-x me-1"></i> {{ asset_type|capitalize }} is missing</li>
                                                        {% endif %}
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        {% else %}
                                            <p class="mb-0 text-warning">No Pub League assets have been uploaded yet.</p>
                                            <a href="{{ url_for('wallet_config.assets') }}" class="btn btn-sm btn-outline-primary mt-2">
                                                Upload Assets
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="ti ti-alert-triangle me-2"></i>
                            No asset information available.
                        </div>
                    {% endif %}

                    <!-- Templates -->
                    <h6 class="mb-3 mt-4">Templates</h6>
                    {% if diagnostics.database_checks and diagnostics.database_checks['Templates'] %}
                        <div class="row mb-3">
                            <!-- ECS Templates -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">ECS Membership Templates</h6>
                                    </div>
                                    <div class="card-body">
                                        {% if diagnostics.database_checks['Templates'].ecs_templates %}
                                            <div class="detail-toggle" onclick="toggleDetail('ecs-templates-list')">
                                                <i class="ti ti-chevron-down me-1"></i> View Templates ({{ diagnostics.database_checks['Templates'].ecs_templates|length }})
                                            </div>
                                            <div id="ecs-templates-list" class="detail-content d-none">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>Name</th>
                                                            <th>Platform</th>
                                                            <th>Default</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for template in diagnostics.database_checks['Templates'].ecs_templates %}
                                                        <tr>
                                                            <td>{{ template.name }}</td>
                                                            <td>{{ template.platform }}</td>
                                                            <td>
                                                                {% if template.is_default %}
                                                                    <span class="badge bg-label-success">Default</span>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <h6>Template Status</h6>
                                                <ul>
                                                    {% set has_default = false %}
                                                    {% for template in diagnostics.database_checks['Templates'].ecs_templates %}
                                                        {% if template.is_default %}
                                                            {% set has_default = true %}
                                                        {% endif %}
                                                    {% endfor %}
                                                    
                                                    {% if has_default %}
                                                        <li class="status-good"><i class="ti ti-check me-1"></i> Default template is set</li>
                                                    {% else %}
                                                        <li class="status-warning"><i class="ti ti-alert-triangle me-1"></i> No default template is set</li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                        {% else %}
                                            <p class="mb-0 text-warning">No ECS Membership templates have been created yet.</p>
                                            <a href="{{ url_for('wallet_config.templates') }}" class="btn btn-sm btn-outline-primary mt-2">
                                                Create Templates
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pub League Templates -->
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Pub League Templates</h6>
                                    </div>
                                    <div class="card-body">
                                        {% if diagnostics.database_checks['Templates'].pub_templates %}
                                            <div class="detail-toggle" onclick="toggleDetail('pub-templates-list')">
                                                <i class="ti ti-chevron-down me-1"></i> View Templates ({{ diagnostics.database_checks['Templates'].pub_templates|length }})
                                            </div>
                                            <div id="pub-templates-list" class="detail-content d-none">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>Name</th>
                                                            <th>Platform</th>
                                                            <th>Default</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for template in diagnostics.database_checks['Templates'].pub_templates %}
                                                        <tr>
                                                            <td>{{ template.name }}</td>
                                                            <td>{{ template.platform }}</td>
                                                            <td>
                                                                {% if template.is_default %}
                                                                    <span class="badge bg-label-success">Default</span>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <div class="mt-3">
                                                <h6>Template Status</h6>
                                                <ul>
                                                    {% set has_default = false %}
                                                    {% for template in diagnostics.database_checks['Templates'].pub_templates %}
                                                        {% if template.is_default %}
                                                            {% set has_default = true %}
                                                        {% endif %}
                                                    {% endfor %}
                                                    
                                                    {% if has_default %}
                                                        <li class="status-good"><i class="ti ti-check me-1"></i> Default template is set</li>
                                                    {% else %}
                                                        <li class="status-warning"><i class="ti ti-alert-triangle me-1"></i> No default template is set</li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                        {% else %}
                                            <p class="mb-0 text-warning">No Pub League templates have been created yet.</p>
                                            <a href="{{ url_for('wallet_config.templates') }}" class="btn btn-sm btn-outline-primary mt-2">
                                                Create Templates
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="ti ti-alert-triangle me-2"></i>
                            No template information available.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Troubleshooting Actions -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Troubleshooting Actions</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-body text-center">
                            <i class="ti ti-refresh fs-1 mb-3 text-primary"></i>
                            <h5>Reinitialize Pass Types</h5>
                            <p class="small mb-3">Recreate the basic pass type configuration if it's missing or corrupted.</p>
                            <div class="d-grid">
                                <button class="btn btn-primary" onclick="runCommand('flask wallet init_types')">
                                    Run Command
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-body text-center">
                            <i class="ti ti-bug fs-1 mb-3 text-warning"></i>
                            <h5>Test Configuration</h5>
                            <p class="small mb-3">Run comprehensive tests on your wallet pass configuration.</p>
                            <div class="d-grid">
                                <a href="{{ url_for('wallet_config.test_config') }}" class="btn btn-warning">
                                    Run Tests
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card mb-3">
                        <div class="card-body text-center">
                            <i class="ti ti-wand fs-1 mb-3 text-info"></i>
                            <h5>Setup Wizard</h5>
                            <p class="small mb-3">Restart the setup wizard to guide you through configuration.</p>
                            <div class="d-grid">
                                <a href="{{ url_for('wallet_config.setup_wizard') }}" class="btn btn-info">
                                    Start Wizard
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Command Modal -->
<div class="modal fade" id="commandModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Run Command</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>To run this command, open a terminal in your project directory and execute:</p>
                <div class="code-block">
                    <code id="commandText"></code>
                </div>
                <p class="text-warning">
                    <i class="ti ti-alert-triangle me-2"></i>
                    This action must be performed by a system administrator on the server.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
// Toggle detail sections
function toggleDetail(id) {
    const element = document.getElementById(id);
    if (element) {
        const isHidden = element.classList.contains('d-none');
        if (isHidden) {
            element.classList.remove('d-none');
            element.previousElementSibling.innerHTML = '<i class="ti ti-chevron-up me-1"></i> Hide Details';
        } else {
            element.classList.add('d-none');
            element.previousElementSibling.innerHTML = '<i class="ti ti-chevron-down me-1"></i> View Details';
        }
    }
}

// Show command modal
function runCommand(command) {
    document.getElementById('commandText').textContent = command;
    new bootstrap.Modal(document.getElementById('commandModal')).show();
}
</script>
{% endblock %}