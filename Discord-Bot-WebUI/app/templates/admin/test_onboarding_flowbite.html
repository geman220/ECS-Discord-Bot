{% extends "base_flowbite.html" %}

{% block title %}Test Onboarding System{% endblock %}

{% block content %}
<div class="p-4 space-y-6">
    <!-- Page Header -->
    <div>
        <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-1">
            <a href="{{ url_for('admin.admin_dashboard') }}" class="hover:text-blue-600 dark:hover:text-blue-400">Admin</a>
            <span>/</span>
            <span>Test Onboarding</span>
        </div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Onboarding System Testing Interface</h1>
        <p class="text-gray-500 dark:text-gray-400">Test the complete onboarding flow step by step</p>
    </div>

    <form method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <!-- Test Setup Info -->
        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6">
            <h6 class="font-semibold text-blue-800 dark:text-blue-300 mb-2 flex items-center gap-2">
                <i class="ti ti-info-circle"></i>Test Setup
            </h6>
            <p class="text-sm text-blue-700 dark:text-blue-400 mb-2">This interface lets you test the onboarding system using your own Discord account without going through the full registration process.</p>
            {% if user_discord_id %}
            <p class="text-sm text-blue-700 dark:text-blue-400"><strong>Your Discord ID:</strong> <code class="bg-blue-100 dark:bg-blue-900/40 px-1 rounded">{{ user_discord_id }}</code></p>
            {% else %}
            <p class="text-sm text-yellow-600 dark:text-yellow-400 flex items-center gap-1">
                <i class="ti ti-alert-triangle"></i>You need a Discord ID linked to test. Link your Discord account first.
            </p>
            {% endif %}
        </div>

        <!-- User Configuration -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Discord ID to Test</label>
                <input type="text" name="discord_id" value="{{ user_discord_id if user_discord_id else '' }}"
                       placeholder="Enter Discord ID"
                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Leave blank to use your own Discord ID</p>
            </div>
            <div>
                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Test Scenario Flags</label>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="checkbox" name="scenario_flags" value="no_onboarding" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600">
                        <span class="ms-2 text-sm text-gray-700 dark:text-gray-300">Simulate incomplete onboarding</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="scenario_flags" value="no_league" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600">
                        <span class="ms-2 text-sm text-gray-700 dark:text-gray-300">Simulate no league selected</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="scenario_flags" value="different_league" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600">
                        <span class="ms-2 text-sm text-gray-700 dark:text-gray-300">Test different league (Classic)</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="scenario_flags" value="unapproved" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600">
                        <span class="ms-2 text-sm text-gray-700 dark:text-gray-300">Simulate unapproved user</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- State Management -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 mb-6">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <h6 class="font-semibold text-gray-900 dark:text-white">User State Management</h6>
            </div>
            <div class="p-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <button type="submit" name="action" value="reset_user_state" class="w-full inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-yellow-500 hover:bg-yellow-600 rounded-lg transition-colors">
                            <i class="ti ti-refresh mr-2"></i>Reset to Fresh
                        </button>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400 text-center">Clear all onboarding data</p>
                    </div>
                    <div>
                        <button type="submit" name="action" value="apply_scenario_flags" class="w-full inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 rounded-lg transition-colors">
                            <i class="ti ti-adjustments mr-2"></i>Apply Scenario Flags
                        </button>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400 text-center">Set user state based on flags above</p>
                    </div>
                    <div>
                        <button type="submit" name="action" value="show_current_state" class="w-full inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg transition-colors">
                            <i class="ti ti-chart-bar mr-2"></i>Show Current State
                        </button>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400 text-center">Display user's onboarding status</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onboarding Flow Testing -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 mb-6">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <h6 class="font-semibold text-gray-900 dark:text-white">Onboarding Flow Testing</h6>
            </div>
            <div class="p-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="border-2 border-blue-200 dark:border-blue-800 rounded-lg p-4 text-center">
                        <h6 class="font-semibold text-gray-900 dark:text-white mb-2">Step 1: Join Discord</h6>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Simulate user joining server</p>
                        <button type="submit" name="action" value="test_user_join" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                            Simulate Join
                        </button>
                    </div>
                    <div class="border-2 border-green-200 dark:border-green-800 rounded-lg p-4 text-center">
                        <h6 class="font-semibold text-gray-900 dark:text-white mb-2">Step 2: Send Welcome DM</h6>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Contextual welcome based on state</p>
                        <button type="submit" name="action" value="test_contextual_welcome" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors">
                            Send Welcome DM
                        </button>
                    </div>
                    <div class="border-2 border-cyan-200 dark:border-cyan-800 rounded-lg p-4 text-center">
                        <h6 class="font-semibold text-gray-900 dark:text-white mb-2">Step 3: New Player Alert</h6>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Post to #pl-new-players</p>
                        <button type="submit" name="action" value="test_new_player_notification" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 rounded-lg transition-colors">
                            Send Notification
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- League Selection Testing -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 mb-6">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <h6 class="font-semibold text-gray-900 dark:text-white">League Selection Testing</h6>
            </div>
            <div class="p-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Test User Response to Bot</label>
                        <div class="flex gap-2 mb-2">
                            <input type="text" name="test_message" value="I think premier"
                                   placeholder="Test message (e.g., 'I want premier')"
                                   class="flex-1 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                            <button type="submit" name="action" value="test_league_selection" class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/40 border border-blue-200 dark:border-blue-800 rounded-lg transition-colors">
                                Process
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Test how bot processes league selection messages</p>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Quick League Tests</label>
                        <div class="flex flex-col gap-2">
                            <button type="submit" name="action" value="test_league_classic" class="w-full px-4 py-2 text-sm font-medium text-yellow-700 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 hover:bg-yellow-100 dark:hover:bg-yellow-900/40 border border-yellow-200 dark:border-yellow-800 rounded-lg transition-colors">
                                Test "classic" response
                            </button>
                            <button type="submit" name="action" value="test_league_premier" class="w-full px-4 py-2 text-sm font-medium text-green-700 dark:text-green-400 bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/40 border border-green-200 dark:border-green-800 rounded-lg transition-colors">
                                Test "premier" response
                            </button>
                            <button type="submit" name="action" value="test_league_ecs_fc" class="w-full px-4 py-2 text-sm font-medium text-cyan-700 dark:text-cyan-400 bg-cyan-50 dark:bg-cyan-900/20 hover:bg-cyan-100 dark:hover:bg-cyan-900/40 border border-cyan-200 dark:border-cyan-800 rounded-lg transition-colors">
                                Test "ecs fc" response
                            </button>
                            <button type="submit" name="action" value="test_league_unclear" class="w-full px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg transition-colors">
                                Test unclear response
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Message Management -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 mb-6">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <h6 class="font-semibold text-gray-900 dark:text-white">Message Configuration</h6>
            </div>
            <div class="p-4">
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">Manage and customize all onboarding messages</p>
                <button type="submit" name="action" value="manage_messages" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-700 rounded-lg transition-colors">
                    <i class="ti ti-settings mr-2"></i>Manage Messages
                </button>
            </div>
        </div>
    </form>

    <!-- Results -->
    {% if results %}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
            <h6 class="font-semibold text-gray-900 dark:text-white">Test Results</h6>
        </div>
        <div class="p-4">
            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4">
                {% for result in results %}
                <div class="mb-2">
                    <code class="text-sm text-gray-700 dark:text-gray-300">{{ result }}</code>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Links -->
    <div class="flex flex-wrap gap-2">
        <a href="{{ url_for('admin.user_approvals') }}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/40 border border-blue-200 dark:border-blue-800 rounded-lg transition-colors">
            User Approvals
        </a>
        <span class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg">
            #pl-new-players
        </span>
    </div>
</div>
{% endblock %}
