{% extends "base_flowbite.html" %}
{% from 'macros/flowbite.html' import card, button %}

{% block title %}Edit Help Topic{% endblock %}
{% block page_title %}Edit Help Topic{% endblock %}

{% block head_extra %}
{{ super() }}
<link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
{% endblock %}

{% block main_content %}
<div class="space-y-6">
    <!-- Breadcrumb -->
    <nav class="flex" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="{{ url_for('help.admin_help_topics') }}" class="inline-flex items-center text-sm font-medium text-gray-500 hover:text-ecs-green dark:text-gray-400 dark:hover:text-ecs-green">
                    <i class="ti ti-settings mr-2"></i>
                    Admin - Help Topics
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="ti ti-chevron-right text-gray-400 mx-2"></i>
                    <span class="text-sm font-medium text-gray-900 dark:text-white">Edit Topic</span>
                </div>
            </li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Edit Help Topic</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Update the help topic content and settings</p>
        </div>
    </div>

    <!-- Edit Form Card -->
    {% call card() %}
    <form method="POST" class="space-y-6">
        {{ form.hidden_tag() }}

        <!-- Title Field -->
        <div>
            <label for="title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                {{ form.title.label.text }}
                <span class="text-red-500">*</span>
            </label>
            {{ form.title(class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2.5 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:border-ecs-green focus:ring-1 focus:ring-ecs-green", placeholder="Enter help topic title") }}
        </div>

        <!-- Markdown Content Field -->
        <div>
            <label for="markdown_editor" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                {{ form.markdown_content.label.text }}
                <span class="text-red-500">*</span>
            </label>
            {{ form.markdown_content(class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2.5 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:border-ecs-green focus:ring-1 focus:ring-ecs-green", id="markdown_editor", rows="10", placeholder="Enter help content in Markdown") }}
        </div>

        <!-- Roles Field -->
        <div>
            <label for="roles" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                {{ form.roles.label.text }}
            </label>
            {{ form.roles(class="w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2.5 text-gray-900 dark:text-white focus:border-ecs-green focus:ring-1 focus:ring-ecs-green", multiple="multiple", size="5") }}
            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                Hold Ctrl/Cmd to select multiple roles. Leave empty or select "Public" for all users.
            </p>
        </div>

        <!-- Form Actions -->
        <div class="flex items-center gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
            {{ button(form.submit.label.text, variant="primary", type="submit", icon="device-floppy") }}
            {{ button("Cancel", variant="outline", href=url_for('help.admin_help_topics'), icon="x") }}
        </div>
    </form>
    {% endcall %}
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const editorElement = document.getElementById('markdown_editor');
    if (editorElement) {
        const easyMDE = new EasyMDE({
            element: editorElement,
            autosave: {
                enabled: true,
                uniqueId: "edit_help_topic_{{ topic.id }}",
                delay: 1000,
            },
            spellChecker: false,
            toolbar: ["bold", "italic", "heading", "|", "quote", "code", "table", "image", "|", "preview", "side-by-side", "fullscreen"],
            status: ["autosave", "lines", "words"],
            minHeight: "300px",
        });

        // Apply dark mode styles to EasyMDE
        if (document.documentElement.classList.contains('dark')) {
            const editorWrapper = document.querySelector('.EasyMDEContainer');
            if (editorWrapper) {
                editorWrapper.classList.add('dark-mode');
            }
        }
    }
});
</script>
<style>
    /* Dark mode styles for EasyMDE */
    .dark .EasyMDEContainer .CodeMirror {
        background-color: rgb(55, 65, 81);
        color: rgb(229, 231, 235);
        border-color: rgb(75, 85, 99);
    }
    .dark .EasyMDEContainer .editor-toolbar {
        background-color: rgb(31, 41, 55);
        border-color: rgb(75, 85, 99);
    }
    .dark .EasyMDEContainer .editor-toolbar button {
        color: rgb(156, 163, 175);
    }
    .dark .EasyMDEContainer .editor-toolbar button:hover {
        background-color: rgb(55, 65, 81);
    }
    .dark .EasyMDEContainer .editor-toolbar button.active {
        background-color: rgb(55, 65, 81);
    }
    .dark .EasyMDEContainer .editor-statusbar {
        color: rgb(156, 163, 175);
    }
    .dark .EasyMDEContainer .CodeMirror-cursor {
        border-left-color: rgb(229, 231, 235);
    }
    .dark .EasyMDEContainer .editor-preview {
        background-color: rgb(31, 41, 55);
        color: rgb(229, 231, 235);
    }
    .dark .EasyMDEContainer .editor-preview-side {
        background-color: rgb(31, 41, 55);
        color: rgb(229, 231, 235);
        border-color: rgb(75, 85, 99);
    }
</style>
{% endif %}
{% endblock %}
