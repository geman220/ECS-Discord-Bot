{% extends "base.html" %}
{% block title %}Admin - Help Topics{% endblock %}

{% block main_content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <div class="c-card__header mb-4">
        <h4 class="c-card__title">Admin - Help Topics</h4>
        <div class="c-card__actions">
            <a href="{{ url_for('help.bulk_upload_help_topics') }}" class="c-btn c-btn--secondary">
                <i class="ti ti-upload c-btn__icon"></i>
                Bulk Upload
            </a>
            <a href="{{ url_for('help.new_help_topic') }}" class="c-btn c-btn--primary">
                <i class="ti ti-plus c-btn__icon"></i>
                Create New Help Topic
            </a>
        </div>
    </div>
    <div class="c-card">
        <div class="c-card__body">
            <ul class="c-list-modern">
                {% for topic in topics %}
                <li class="c-list-modern__item">
                    <span class="c-list-modern__title">{{ topic.title }}</span>
                    <div class="c-list-modern__actions">
                        <a href="{{ url_for('help.edit_help_topic', topic_id=topic.id) }}"
                           class="c-btn c-btn--sm c-btn--warning">
                            <i class="ti ti-edit c-btn__icon"></i>
                            Edit
                        </a>
                        <button class="c-btn c-btn--sm c-btn--danger"
                                data-action="confirm-delete"
                                data-topic-id="{{ topic.id }}">
                            <i class="ti ti-trash c-btn__icon"></i>
                            Delete
                        </button>
                        <form class="js-delete-form"
                              action="{{ url_for('help.delete_help_topic', topic_id=topic.id) }}"
                              method="post"
                              data-form-id="{{ topic.id }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        </form>
                    </div>
                </li>
                {% else %}
                <li class="c-list-modern__item c-list-modern__item--empty">
                    <i class="ti ti-info-circle c-list-modern__icon"></i>
                    No help topics found.
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<script>
    // Delete confirmation handler using event delegation
    document.addEventListener('click', function(e) {
        if (e.target.closest('[data-action="confirm-delete"]')) {
            e.preventDefault();
            const btn = e.target.closest('[data-action="confirm-delete"]');
            const topicId = btn.dataset.topicId;

            Swal.fire({
                title: 'Are you sure?',
                text: "This will permanently delete the help topic.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : '#dc3545',
                cancelButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('secondary') : '#6c757d',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    const form = document.querySelector(`[data-form-id="${topicId}"]`);
                    if (form) form.submit();
                }
            });
        }
    });
</script>
{% endif %}
{% endblock %}
