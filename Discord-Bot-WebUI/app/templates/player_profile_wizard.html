{% extends "base_unauthenticated.html" %}

{% block title %}Profile Verification - {{ player.name }}{% endblock %}

{% block page_css %}

{% if not config.get('ASSETS_PRODUCTION_MODE') %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/profile-wizard.css') }}">
{% endif %}
{% endblock %}

{% block main_content %}
<div class="c-wizard" data-component="profile-wizard">
    <!-- Progress Indicator -->
    <div class="c-wizard__progress" data-component="wizard-progress">
        <div class="c-wizard__progress-bar" id="progressBar" style="width: 0%;"></div>
        <div class="c-wizard__progress-steps">
            <div class="c-wizard__progress-step c-wizard__progress-step--active" data-step-indicator="1">
                <div class="c-wizard__progress-dot">
                    <i class="ti ti-home"></i>
                </div>
                <span class="c-wizard__progress-label">Welcome</span>
            </div>
            <div class="c-wizard__progress-step" data-step-indicator="2">
                <div class="c-wizard__progress-dot">
                    <i class="ti ti-user"></i>
                </div>
                <span class="c-wizard__progress-label">Contact</span>
            </div>
            <div class="c-wizard__progress-step" data-step-indicator="3">
                <div class="c-wizard__progress-dot">
                    <i class="ti ti-ball-football"></i>
                </div>
                <span class="c-wizard__progress-label">Playing</span>
            </div>
            <div class="c-wizard__progress-step" data-step-indicator="4">
                <div class="c-wizard__progress-dot">
                    <i class="ti ti-notes"></i>
                </div>
                <span class="c-wizard__progress-label">Notes</span>
            </div>
            <div class="c-wizard__progress-step" data-step-indicator="5">
                <div class="c-wizard__progress-dot">
                    <i class="ti ti-check"></i>
                </div>
                <span class="c-wizard__progress-label">Confirm</span>
            </div>
        </div>
    </div>

    <form method="POST" action="{{ url_for('players.wizard_profile_update', player_id=player.id) }}" id="wizardForm" class="c-wizard__form">
        {{ form.hidden_tag() }}
        <input type="hidden" name="current_step" id="currentStep" value="1">

        <!-- Step 1: Welcome -->
        <div class="c-wizard__step c-wizard__step--active" data-step="1">
            <div class="c-wizard__card c-wizard__card--welcome">
                <div class="c-wizard__card-content">
                    <!-- Profile Avatar -->
                    <div class="c-wizard__avatar-section">
                        {% if player.profile_picture_url %}
                        <img src="{{ player.profile_picture_url }}?v={{ player.updated_at.timestamp() if player.updated_at else '0' }}"
                             class="c-wizard__avatar" alt="{{ player.name }}">
                        {% else %}
                        <div class="c-wizard__avatar c-wizard__avatar--placeholder">
                            <i class="ti ti-user"></i>
                        </div>
                        {% endif %}
                        {% if player.teams %}
                        <div class="c-wizard__team-badge">
                            {% for team in player.teams %}{{ team.name }}{% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <h1 class="c-wizard__welcome-title">Welcome, {{ player.name.split(' ')[0] }}!</h1>

                    <div class="c-wizard__welcome-message">
                        <div class="c-wizard__welcome-icon">
                            <i class="ti ti-trophy"></i>
                        </div>
                        <h2>New Season Check-In</h2>
                        <p>Let's make sure your profile is up to date for the upcoming season. This only takes a minute!</p>
                    </div>

                    <div class="c-wizard__checklist">
                        <div class="c-wizard__checklist-item">
                            <i class="ti ti-circle-check"></i>
                            <span>Verify your contact info</span>
                        </div>
                        <div class="c-wizard__checklist-item">
                            <i class="ti ti-circle-check"></i>
                            <span>Update playing preferences</span>
                        </div>
                        <div class="c-wizard__checklist-item">
                            <i class="ti ti-circle-check"></i>
                            <span>Add notes for coaches</span>
                        </div>
                        <div class="c-wizard__checklist-item">
                            <i class="ti ti-circle-check"></i>
                            <span>Confirm everything is accurate</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Contact Information -->
        <div class="c-wizard__step" data-step="2">
            <div class="c-wizard__card">
                <div class="c-wizard__card-header">
                    <div class="c-wizard__card-icon">
                        <i class="ti ti-address-book"></i>
                    </div>
                    <div class="c-wizard__card-titles">
                        <h2 class="c-wizard__card-title">Contact Information</h2>
                        <p class="c-wizard__card-subtitle">Make sure we can reach you</p>
                    </div>
                </div>
                <div class="c-wizard__card-body">
                    <div class="c-wizard__field">
                        <label class="c-wizard__label" for="name">
                            <i class="ti ti-user"></i> Full Name
                        </label>
                        {{ form.name(class="c-wizard__input", placeholder="Your full name", id="name", **{"data-field": "name"}) }}
                    </div>

                    <div class="c-wizard__field">
                        <label class="c-wizard__label" for="email">
                            <i class="ti ti-mail"></i> Email Address
                        </label>
                        {{ form.email(class="c-wizard__input", placeholder="your@email.com", id="email", **{"data-field": "email"}) }}
                    </div>

                    <div class="c-wizard__field">
                        <label class="c-wizard__label" for="phone">
                            <i class="ti ti-phone"></i> Phone Number
                        </label>
                        {{ form.phone(class="c-wizard__input", placeholder="(555) 123-4567", id="phone", **{"data-field": "phone"}) }}
                    </div>

                    <div class="c-wizard__field-row">
                        <div class="c-wizard__field c-wizard__field--half">
                            <label class="c-wizard__label" for="jersey_size">
                                <i class="ti ti-shirt"></i> Jersey Size
                            </label>
                            {{ form.jersey_size(class="c-wizard__select", id="jersey_size", **{"data-field": "jersey_size"}) }}
                        </div>
                        <div class="c-wizard__field c-wizard__field--half">
                            <label class="c-wizard__label" for="pronouns">
                                <i class="ti ti-message-circle"></i> Pronouns
                            </label>
                            {{ form.pronouns(class="c-wizard__select", id="pronouns", **{"data-field": "pronouns"}) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Playing Preferences -->
        <div class="c-wizard__step" data-step="3">
            <div class="c-wizard__card">
                <div class="c-wizard__card-header">
                    <div class="c-wizard__card-icon">
                        <i class="ti ti-ball-football"></i>
                    </div>
                    <div class="c-wizard__card-titles">
                        <h2 class="c-wizard__card-title">Playing Preferences</h2>
                        <p class="c-wizard__card-subtitle">Help your coach understand your style</p>
                    </div>
                </div>
                <div class="c-wizard__card-body">
                    <div class="c-wizard__field">
                        <label class="c-wizard__label" for="favorite_position">
                            <i class="ti ti-star"></i> Favorite Position
                        </label>
                        {{ form.favorite_position(class="c-wizard__select", id="favorite_position", **{"data-field": "favorite_position"}) }}
                    </div>

                    <div class="c-wizard__field">
                        <label class="c-wizard__label">
                            <i class="ti ti-list-check"></i> Other Positions You Enjoy
                        </label>
                        <span class="c-wizard__field-hint">Tap to select all that apply</span>
                        <div class="c-wizard__checkbox-group c-wizard__checkbox-group--positions" data-field="other_positions">
                            {% set selected_other = form.other_positions.data or [] %}
                            {% for value, label in form.other_positions.choices %}
                            {% if value != 'no_preference' %}
                            <div class="c-wizard__checkbox-item">
                                <input type="checkbox" name="other_positions" value="{{ value }}" id="other_pos_{{ value }}"
                                       {% if value in selected_other %}checked{% endif %}>
                                <label class="c-wizard__checkbox-label" for="other_pos_{{ value }}">{{ label }}</label>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>

                    <div class="c-wizard__field">
                        <label class="c-wizard__label">
                            <i class="ti ti-x"></i> Positions to Avoid
                        </label>
                        <span class="c-wizard__field-hint">Tap any you'd prefer not to play</span>
                        <div class="c-wizard__checkbox-group c-wizard__checkbox-group--positions" data-field="positions_not_to_play">
                            {% set selected_avoid = form.positions_not_to_play.data or [] %}
                            {% for value, label in form.positions_not_to_play.choices %}
                            {% if value != 'no_preference' %}
                            <div class="c-wizard__checkbox-item">
                                <input type="checkbox" name="positions_not_to_play" value="{{ value }}" id="avoid_pos_{{ value }}"
                                       {% if value in selected_avoid %}checked{% endif %}>
                                <label class="c-wizard__checkbox-label" for="avoid_pos_{{ value }}">{{ label }}</label>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>

                    <div class="c-wizard__field">
                        <label class="c-wizard__label" for="frequency_play_goal">
                            <i class="ti ti-shield"></i> Goalkeeper Willingness
                        </label>
                        <span class="c-wizard__field-hint">How often would you play in goal?</span>
                        {{ form.frequency_play_goal(class="c-wizard__select", id="frequency_play_goal", **{"data-field": "frequency_play_goal"}) }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Notes & Availability -->
        <div class="c-wizard__step" data-step="4">
            <div class="c-wizard__card">
                <div class="c-wizard__card-header">
                    <div class="c-wizard__card-icon">
                        <i class="ti ti-notes"></i>
                    </div>
                    <div class="c-wizard__card-titles">
                        <h2 class="c-wizard__card-title">Notes & Availability</h2>
                        <p class="c-wizard__card-subtitle">Anything else we should know?</p>
                    </div>
                </div>
                <div class="c-wizard__card-body">
                    <div class="c-wizard__field">
                        <label class="c-wizard__label" for="expected_weeks_available">
                            <i class="ti ti-calendar"></i> Expected Availability
                        </label>
                        <span class="c-wizard__field-hint">How many weeks can you play this season?</span>
                        {{ form.expected_weeks_available(class="c-wizard__select", id="expected_weeks_available", **{"data-field": "expected_weeks_available"}) }}
                    </div>

                    <div class="c-wizard__field">
                        <label class="c-wizard__label" for="willing_to_referee">
                            <i class="ti ti-whistle"></i> Interested in Refereeing?
                        </label>
                        {{ form.willing_to_referee(class="c-wizard__select", id="willing_to_referee", **{"data-field": "willing_to_referee"}) }}
                    </div>

                    <div class="c-wizard__field">
                        <label class="c-wizard__label" for="player_notes">
                            <i class="ti ti-message"></i> Notes for Your Coach
                        </label>
                        <span class="c-wizard__field-hint">Injuries, availability issues, or anything else</span>
                        {{ form.player_notes(class="c-wizard__textarea", rows=4, placeholder="E.g., I can't play on specific dates, injury concerns, etc.", id="player_notes", **{"data-field": "player_notes"}) }}
                    </div>

                    <div class="c-wizard__info-box">
                        <i class="ti ti-info-circle"></i>
                        <p>Your notes are only visible to coaches and league admins.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Review & Confirm -->
        <div class="c-wizard__step" data-step="5">
            <div class="c-wizard__card c-wizard__card--confirm">
                <div class="c-wizard__card-header c-wizard__card-header--success">
                    <div class="c-wizard__card-icon c-wizard__card-icon--success">
                        <i class="ti ti-clipboard-check"></i>
                    </div>
                    <div class="c-wizard__card-titles">
                        <h2 class="c-wizard__card-title">Review & Confirm</h2>
                        <p class="c-wizard__card-subtitle">Please verify your information is correct</p>
                    </div>
                </div>
                <div class="c-wizard__card-body">
                    <!-- Contact Summary -->
                    <div class="c-wizard__review-section">
                        <div class="c-wizard__review-header">
                            <i class="ti ti-address-book"></i>
                            <span>Contact Information</span>
                            <button type="button" class="c-wizard__review-edit" data-goto-step="2">
                                <i class="ti ti-pencil"></i>
                            </button>
                        </div>
                        <div class="c-wizard__review-grid">
                            <div class="c-wizard__review-item">
                                <span class="c-wizard__review-label">Name</span>
                                <span class="c-wizard__review-value" data-review="name">-</span>
                            </div>
                            <div class="c-wizard__review-item">
                                <span class="c-wizard__review-label">Email</span>
                                <span class="c-wizard__review-value" data-review="email">-</span>
                            </div>
                            <div class="c-wizard__review-item">
                                <span class="c-wizard__review-label">Phone</span>
                                <span class="c-wizard__review-value" data-review="phone">-</span>
                            </div>
                            <div class="c-wizard__review-item">
                                <span class="c-wizard__review-label">Jersey</span>
                                <span class="c-wizard__review-value" data-review="jersey_size">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Playing Preferences Summary -->
                    <div class="c-wizard__review-section">
                        <div class="c-wizard__review-header">
                            <i class="ti ti-ball-football"></i>
                            <span>Playing Preferences</span>
                            <button type="button" class="c-wizard__review-edit" data-goto-step="3">
                                <i class="ti ti-pencil"></i>
                            </button>
                        </div>
                        <div class="c-wizard__review-grid">
                            <div class="c-wizard__review-item">
                                <span class="c-wizard__review-label">Favorite Position</span>
                                <span class="c-wizard__review-value" data-review="favorite_position">-</span>
                            </div>
                            <div class="c-wizard__review-item">
                                <span class="c-wizard__review-label">Goalkeeper</span>
                                <span class="c-wizard__review-value" data-review="frequency_play_goal">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Availability Summary -->
                    <div class="c-wizard__review-section">
                        <div class="c-wizard__review-header">
                            <i class="ti ti-calendar"></i>
                            <span>Availability & Notes</span>
                            <button type="button" class="c-wizard__review-edit" data-goto-step="4">
                                <i class="ti ti-pencil"></i>
                            </button>
                        </div>
                        <div class="c-wizard__review-grid">
                            <div class="c-wizard__review-item">
                                <span class="c-wizard__review-label">Weeks Available</span>
                                <span class="c-wizard__review-value" data-review="expected_weeks_available">-</span>
                            </div>
                            <div class="c-wizard__review-item">
                                <span class="c-wizard__review-label">Referee Interest</span>
                                <span class="c-wizard__review-value" data-review="willing_to_referee">-</span>
                            </div>
                        </div>
                        <div class="c-wizard__review-notes" data-review="player_notes">
                            No additional notes
                        </div>
                    </div>

                    <!-- Confirmation Checkbox -->
                    <div class="c-wizard__confirm-box">
                        <label class="c-wizard__confirm-checkbox">
                            <input type="checkbox" id="confirmCheck" name="confirm_accurate" required>
                            <span class="c-wizard__confirm-checkmark"></span>
                            <span class="c-wizard__confirm-text">
                                I have reviewed my profile and confirm all information is accurate
                            </span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="c-wizard__nav">
            <button type="button" class="c-wizard__nav-btn c-wizard__nav-btn--back" id="prevBtn" data-action="prev" disabled>
                <i class="ti ti-chevron-left"></i>
                <span>Back</span>
            </button>

            <button type="button" class="c-wizard__nav-btn c-wizard__nav-btn--next" id="nextBtn" data-action="next">
                <span>Get Started</span>
                <i class="ti ti-chevron-right"></i>
            </button>

            <button type="submit" name="verify_profile" class="c-wizard__nav-btn c-wizard__nav-btn--confirm" id="confirmBtn" data-action="confirm" style="display: none;">
                <i class="ti ti-shield-check"></i>
                <span>Confirm Profile</span>
            </button>
        </div>
    </form>

    <!-- Swipe Hint (mobile only) -->
    <div class="c-wizard__swipe-hint" id="swipeHint">
        <i class="ti ti-hand-finger"></i>
        <span>Swipe to navigate</span>
    </div>

    <!-- Auto-save Indicator -->
    <div class="c-wizard__save-indicator" id="saveIndicator">
        <i class="ti ti-check"></i>
        <span>Saved</span>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}

{% if not config.get('ASSETS_PRODUCTION_MODE') %}
<script src="{{ url_for('static', filename='js/profile-wizard.js') }}"></script>
<script>
{% endif %}
document.addEventListener('DOMContentLoaded', function() {
    // Initialize wizard
    const wizard = new ProfileWizard({
        totalSteps: 5,
        playerId: {{ player.id }},
        csrfToken: '{{ form.csrf_token._value() }}',
        autoSaveUrl: '{{ url_for("players.wizard_auto_save", player_id=player.id) }}'
    });
});
</script>
{% endblock %}
