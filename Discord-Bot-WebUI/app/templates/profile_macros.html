{# ===== Player Profile Reusable Macros ===== #}
{# These macros are used across player_profile.html and player_profile_wizard.html #}


{# ----- Avatar Macro ----- #}
{# Renders a player's profile picture with optional badge indicators #}
{% macro render_avatar(player, size='lg', show_badges=true) %}
<div class="c-profile-avatar c-profile-avatar--{{ size }}" data-component="profile-avatar">
    {% if player.profile_picture_url %}
    <img src="{{ player.profile_picture_url }}?v={{ player.updated_at.timestamp() if player.updated_at else '0' }}"
         class="c-profile-avatar__image rounded-circle"
         alt="{{ player.name }}'s Profile Picture">
    {% else %}
    <img src="{{ url_for('static', filename='img/default_player.png') }}"
         class="c-profile-avatar__image c-profile-avatar__image--default rounded-circle"
         alt="Default Profile Picture">
    {% endif %}
    {% if show_badges %}
        {% if player.is_coach %}
        <span class="c-profile-avatar__badge c-profile-avatar__badge--coach avatar-status bg-success"
              data-bs-toggle="tooltip"
              data-bs-placement="top"
              title="Coach"></span>
        {% endif %}
        {% if player.is_ref %}
        <span class="c-profile-avatar__badge c-profile-avatar__badge--ref avatar-status bg-warning"
              data-bs-toggle="tooltip"
              data-bs-placement="top"
              title="Referee"></span>
        {% endif %}
    {% endif %}
</div>
{% endmacro %}


{# ----- Info Row Macro ----- #}
{# Renders a row with icon, label, and value - used in contact info cards #}
{% macro render_info_row(icon, label, value, icon_color='primary') %}
<div class="c-info-row" data-component="info-row">
    <div class="c-info-row__icon avatar avatar-sm bg-label-{{ icon_color }}">
        <i class="{{ icon }}"></i>
    </div>
    <div class="c-info-row__content">
        <h6 class="c-info-row__label mb-0">{{ label }}</h6>
        <span class="c-info-row__value">{{ value if value else 'Not specified' }}</span>
    </div>
</div>
{% endmacro %}


{# ----- Stat Box Macro ----- #}
{# Renders a single stat box with icon, value, and label #}
{% macro render_stat_box(icon, value, label, color='primary') %}
<div class="c-stat-box" data-component="stat-box">
    <div class="c-stat-box__icon text-{{ color }}">{{ icon }}</div>
    <div class="c-stat-box__value">{{ value }}</div>
    <div class="c-stat-box__label">{{ label }}</div>
</div>
{% endmacro %}


{# ----- Card Header Macro ----- #}
{# Renders a card header with optional edit button #}
{% macro render_card_header(title, icon='', show_edit=false, edit_section='') %}
<div class="c-profile-card-header c-card__header border-bottom" data-component="profile-card-header">
    <h5 class="c-profile-card-header__title c-card__title mb-0">
        {% if icon %}<i class="{{ icon }} c-profile-card-header__icon"></i>{% endif %}{{ title }}
    </h5>
    {% if show_edit %}
    <button type="button"
            class="c-profile-card-header__edit-btn c-btn c-btn--sm c-btn--primary edit-toggle"
            data-section="{{ edit_section }}"
            data-action="edit-section">
        <i class="ti ti-pencil me-1"></i>Edit
    </button>
    {% endif %}
</div>
{% endmacro %}


{# ----- Empty State Macro ----- #}
{# Renders an empty state placeholder #}
{% macro render_empty_state(icon, message) %}
<div class="c-empty-state text-center py-4" data-component="empty-state">
    <div class="c-empty-state__icon mb-3">
        <i class="{{ icon }}"></i>
    </div>
    <p class="c-empty-state__message mb-0">{{ message }}</p>
</div>
{% endmacro %}


{# ----- Contact Channel Option Macro ----- #}
{# Renders a contact channel checkbox for the contact modal #}
{% macro render_contact_channel(channel_id, icon, label, enabled, available, description='') %}
<div class="c-contact-channel {% if not available %}c-contact-channel--disabled{% endif %}"
     data-component="contact-channel">
    <div class="c-contact-channel__check form-check mb-0">
        <input type="checkbox"
               class="c-contact-channel__input form-check-input"
               name="contact_channels"
               value="{{ channel_id }}"
               id="channel_{{ channel_id }}"
               {{ 'disabled' if not available else '' }}
               {{ 'checked' if enabled and available else '' }}>
        <label class="c-contact-channel__label form-check-label" for="channel_{{ channel_id }}">
            <span class="c-contact-channel__icon c-contact-channel__icon--{{ channel_id }}">
                <i class="{{ icon }}"></i>
            </span>
            <span class="c-contact-channel__info">
                <strong class="c-contact-channel__title">{{ label }}</strong>
                {% if description %}
                <small class="c-contact-channel__description text-muted d-block">{{ description }}</small>
                {% endif %}
                {% if not available %}
                <small class="c-contact-channel__status c-contact-channel__status--unavailable text-danger d-block">Not available for this player</small>
                {% elif not enabled %}
                <small class="c-contact-channel__status c-contact-channel__status--disabled text-warning d-block">Disabled by player</small>
                {% endif %}
            </span>
        </label>
    </div>
</div>
{% endmacro %}


{# ----- Team Badge Macro ----- #}
{# Renders a team badge with link #}
{% macro render_team_badge(team) %}
<div class="c-team-badge badge bg-label-light fs-6" data-component="team-badge">
    <a href="{{ url_for('teams.team_details', team_id=team.id) }}"
       class="c-team-badge__link text-decoration-none"
       data-action="view-team">
        <i class="ti ti-users c-team-badge__icon"></i>{{ team.name }}
    </a>
</div>
{% endmacro %}


{# ----- Profile Status Card Macro ----- #}
{# Renders the profile verification status card #}
{% macro render_profile_status(player, is_own_profile, profile_expired, format_pacific_time) %}
<div class="c-profile-status-card c-card mb-4" data-component="profile-status-card">
    <div class="c-profile-status-card__header c-card__header border-bottom">
        <h5 class="c-profile-status-card__title c-card__title mb-0">Profile Status</h5>
    </div>
    <div class="c-profile-status-card__body c-card__body">
        {% if player.profile_last_updated %}
        <div class="c-profile-status-card__info">
            <div class="c-profile-status-card__icon avatar avatar-sm bg-label-success">
                <i class="ti ti-check"></i>
            </div>
            <div class="c-profile-status-card__content">
                <h6 class="c-profile-status-card__label mb-0">Last Updated</h6>
                <span class="c-profile-status-card__value text-success">{{ format_pacific_time(player.profile_last_updated) }}</span>
            </div>
        </div>
        {% else %}
        <div class="c-profile-status-card__info">
            <div class="c-profile-status-card__icon avatar avatar-sm bg-label-warning">
                <i class="ti ti-alert-triangle"></i>
            </div>
            <div class="c-profile-status-card__content">
                <h6 class="c-profile-status-card__label mb-0">Profile Status</h6>
                <span class="c-profile-status-card__value text-warning">
                    {% if is_own_profile %}Please verify your profile information{% else %}Player has not verified their profile{% endif %}
                </span>
            </div>
        </div>
        {% endif %}

        {% if is_own_profile %}
        <div class="c-profile-status-card__actions text-center">
            <button type="button"
                    class="c-profile-status-card__verify-btn c-btn c-btn--primary"
                    id="verifyProfileBtn"
                    data-action="verify-profile">
                <i class="ti ti-check-circle me-1"></i>
                {% if player.profile_last_updated %}
                    Confirm Profile is Still Accurate
                {% else %}
                    Verify My Profile Information
                {% endif %}
            </button>
        </div>

        <small class="c-profile-status-card__help-text text-muted d-block text-center mt-2">
            Click to confirm your profile information is current and accurate
        </small>

        {% if not player.profile_last_updated %}
        <div class="c-profile-status-card__alert alert alert-danger py-2 mt-3 mb-0" data-alert>
            <i class="ti ti-alert-circle me-1"></i>
            <small>Your profile needs verification</small>
        </div>
        {% elif profile_expired %}
        <div class="c-profile-status-card__alert alert alert-warning py-2 mt-3 mb-0" data-alert>
            <i class="ti ti-alert-triangle me-1"></i>
            <small>Your profile verification expired - please review and update your information</small>
        </div>
        {% endif %}
        {% endif %}
    </div>
</div>
{% endmacro %}


{# ----- Editable Field Macro ----- #}
{# Field that can toggle between view and edit mode #}
{% macro render_editable_field(field_id, label, view_value, form_field, field_type='text') %}
<div class="c-editable-field form-group" data-component="editable-field">
    <label for="{{ field_id }}" class="c-editable-field__label form-label fw-semibold">{{ label }}</label>
    <div class="c-editable-field__view-mode view-mode">
        <span class="c-editable-field__value form-control-plaintext">{{ view_value if view_value else 'Not specified' }}</span>
    </div>
    <div class="c-editable-field__edit-mode edit-mode u-hidden">
        {% if field_type == 'select' %}
        {{ form_field(class="c-editable-field__input form-select", id=field_id) }}
        {% elif field_type == 'textarea' %}
        {{ form_field(class="c-editable-field__input form-control", id=field_id, rows=3) }}
        {% else %}
        {{ form_field(class="c-editable-field__input form-control", id=field_id) }}
        {% endif %}
    </div>
</div>
{% endmacro %}


{# ----- Settings Tab Navigation Macro ----- #}
{# Renders the tab navigation for settings page #}
{% macro settings_tabs(active_tab='account') %}
<div class="c-settings-tabs-wrapper settings-tabs-wrapper" data-component="settings-tabs">
    <nav class="c-settings-tabs nav nav-pills settings-nav-scroll mb-4">
        <a class="c-settings-tabs__item nav-link {% if active_tab == 'account' %}active{% endif %}"
           href="#account"
           data-bs-toggle="tab"
           data-bs-target="#tab-account"
           data-action="switch-tab">
            <i class="ti ti-user-circle c-settings-tabs__icon"></i>
            <span class="c-settings-tabs__text">Account</span>
        </a>
        <a class="c-settings-tabs__item nav-link {% if active_tab == 'security' %}active{% endif %}"
           href="#security"
           data-bs-toggle="tab"
           data-bs-target="#tab-security"
           data-action="switch-tab">
            <i class="ti ti-lock c-settings-tabs__icon"></i>
            <span class="c-settings-tabs__text">Security</span>
        </a>
        <a class="c-settings-tabs__item nav-link {% if active_tab == 'notifications' %}active{% endif %}"
           href="#notifications"
           data-bs-toggle="tab"
           data-bs-target="#tab-notifications"
           data-action="switch-tab">
            <i class="ti ti-bell c-settings-tabs__icon"></i>
            <span class="c-settings-tabs__text">Notifications</span>
        </a>
        <a class="c-settings-tabs__item nav-link {% if active_tab == 'integrations' %}active{% endif %}"
           href="#integrations"
           data-bs-toggle="tab"
           data-bs-target="#tab-integrations"
           data-action="switch-tab">
            <i class="ti ti-plug c-settings-tabs__icon"></i>
            <span class="c-settings-tabs__text">Integrations</span>
        </a>
    </nav>
</div>
{% endmacro %}


{# ----- Notification Channel Card Macro ----- #}
{# Renders a notification channel card for settings page #}
{% macro notification_channel_card(icon, title, description, toggle_field, enabled=false, extra_content='') %}
<div class="c-notification-channel-card c-card mb-3 {% if enabled %}c-notification-channel-card--enabled{% endif %}"
     data-component="notification-channel-card">
    <div class="c-notification-channel-card__body c-card__body">
        <div class="c-notification-channel-card__icon-wrapper bg-{{ 'success' if enabled else 'secondary' }} bg-opacity-10 text-{{ 'success' if enabled else 'secondary' }}">
            <i class="{{ icon }}"></i>
        </div>
        <div class="c-notification-channel-card__content">
            <div class="c-notification-channel-card__header">
                <h6 class="c-notification-channel-card__title mb-0">{{ title }}</h6>
                <div class="c-notification-channel-card__toggle form-check form-switch mb-0">
                    {{ toggle_field(class="c-notification-channel-card__switch form-check-input") }}
                </div>
            </div>
            <p class="c-notification-channel-card__description text-muted small mb-0">{{ description }}</p>
            {{ extra_content|safe }}
        </div>
    </div>
</div>
{% endmacro %}
