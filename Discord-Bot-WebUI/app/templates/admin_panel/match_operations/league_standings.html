{% extends "admin_panel/base.html" %}

{% block title %}League Standings - Admin Panel{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">
    <a href="{{ url_for('admin_panel.match_operations') }}">Match Operations</a>
</li>
<li class="breadcrumb-item active">League Standings</li>
{% endblock %}

{% block panel_content %}

<!-- Current Season Info -->
<div class="c-panel-section" data-component="panel-section">
    <div class="c-card" data-card>
        <div class="c-card__header">
            <h5 class="c-card__title">
                <i class="ti ti-calendar"></i>
                Current Season: {{ standings_data.current_season.name if standings_data.current_season else 'No Active Season' }}
            </h5>
        </div>
        <div class="c-card__body">
            {% if standings_data.current_season %}
            <div class="c-season-info" data-component="season-info">
                <div class="c-season-info__item">
                    <strong>Total Teams:</strong> {{ standings_data.total_teams or 0 }}
                </div>
                <div class="c-season-info__item">
                    <strong>Start Date:</strong> {{ standings_data.current_season.start_date.strftime('%Y-%m-%d') if standings_data.current_season.start_date else 'TBD' }}
                </div>
                <div class="c-season-info__item">
                    <strong>End Date:</strong> {{ standings_data.current_season.end_date.strftime('%Y-%m-%d') if standings_data.current_season.end_date else 'TBD' }}
                </div>
                <div class="c-season-info__item">
                    <strong>Status:</strong>
                    <span class="c-badge c-badge--success" data-badge>Active</span>
                </div>
            </div>
            {% else %}
            <div class="c-alert c-alert--warning" data-alert data-alert-type="warning">
                <i class="ti ti-alert-triangle c-alert__icon"></i>
                <div class="c-alert__content">
                    No active season found. Please create a season to view standings.
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- League Standings Table -->
{% if standings_data.standings %}
<div class="c-panel-section" data-component="panel-section">
    <div class="c-card" data-card>
        <div class="c-card__header">
            <h5 class="c-card__title">
                <i class="ti ti-list-numbers"></i>
                League Table
            </h5>
        </div>
        <div class="c-card__body">
            <div class="c-table-responsive" data-table-container>
                <table class="c-table" data-table data-table-type="standings">
                    <thead class="c-table__head">
                        <tr class="c-table__row">
                            <th class="c-table__header c-table__header--center" scope="col">#</th>
                            <th class="c-table__header" scope="col">Team</th>
                            <th class="c-table__header c-table__header--center" scope="col">MP</th>
                            <th class="c-table__header c-table__header--center" scope="col">W</th>
                            <th class="c-table__header c-table__header--center" scope="col">D</th>
                            <th class="c-table__header c-table__header--center" scope="col">L</th>
                            <th class="c-table__header c-table__header--center" scope="col">GF</th>
                            <th class="c-table__header c-table__header--center" scope="col">GA</th>
                            <th class="c-table__header c-table__header--center" scope="col">GD</th>
                            <th class="c-table__header c-table__header--center" scope="col">Pts</th>
                        </tr>
                    </thead>
                    <tbody class="c-table__body">
                        {% for standing in standings_data.standings %}
                        <tr class="c-table__row" data-team-id="{{ standing.team.id if standing.team else '' }}">
                            <td class="c-table__cell c-table__cell--center">
                                <strong>{{ standing.position }}</strong>
                            </td>
                            <td class="c-table__cell">
                                <div class="c-team-name" data-component="team-name">
                                    <div class="c-team-avatar">
                                        <span class="c-team-avatar__initial">{{ standing.team.name[0] if standing.team.name else 'T' }}</span>
                                    </div>
                                    <strong>{{ standing.team.name or 'Unknown Team' }}</strong>
                                </div>
                            </td>
                            <td class="c-table__cell c-table__cell--center">{{ standing.matches_played }}</td>
                            <td class="c-table__cell c-table__cell--center">{{ standing.wins }}</td>
                            <td class="c-table__cell c-table__cell--center">{{ standing.draws }}</td>
                            <td class="c-table__cell c-table__cell--center">{{ standing.losses }}</td>
                            <td class="c-table__cell c-table__cell--center">{{ standing.goals_for }}</td>
                            <td class="c-table__cell c-table__cell--center">{{ standing.goals_against }}</td>
                            <td class="c-table__cell c-table__cell--center">
                                {% if standing.goal_difference > 0 %}
                                    <span class="c-text-success">+{{ standing.goal_difference }}</span>
                                {% elif standing.goal_difference < 0 %}
                                    <span class="c-text-danger">{{ standing.goal_difference }}</span>
                                {% else %}
                                    <span class="c-text-muted">0</span>
                                {% endif %}
                            </td>
                            <td class="c-table__cell c-table__cell--center">
                                <strong class="c-text-primary">{{ standing.points }}</strong>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Legend -->
            <div class="c-standings-legend" data-component="standings-legend">
                <small class="c-text-muted">
                    <strong>Legend:</strong> MP = Matches Played, W = Wins, D = Draws, L = Losses, GF = Goals For, GA = Goals Against, GD = Goal Difference, Pts = Points
                </small>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="c-panel-section" data-component="panel-section">
    <div class="c-card" data-card>
        <div class="c-card__body">
            <div class="c-empty-state" data-component="empty-state" data-empty-type="standings">
                <i class="ti ti-list-numbers c-empty-state__icon"></i>
                <h5 class="c-empty-state__title">No Standings Available</h5>
                <p class="c-empty-state__text">Standings will appear once teams are assigned to leagues and matches are played.</p>
                <div class="c-empty-state__actions">
                    <a href="{{ url_for('admin_panel.manage_teams') }}" class="c-btn c-btn--outline-primary">
                        <i class="ti ti-users"></i>Manage Teams
                    </a>
                    <a href="{{ url_for('admin_panel.view_matches') }}" class="c-btn c-btn--outline-info">
                        <i class="ti ti-calendar"></i>View Matches
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Quick Actions -->
<div class="c-panel-section" data-component="panel-section">
    <div class="c-alert c-alert--info" data-alert data-alert-type="info">
        <i class="ti ti-info-circle c-alert__icon"></i>
        <div class="c-alert__content">
            <strong>League Standings:</strong>
            View current season standings. Points are calculated as: Win = 3 points, Draw = 1 point, Loss = 0 points.
            <em>Note: This is demo data. Actual standings will be calculated from real match results.</em>
        </div>
    </div>
</div>

{% endblock %}

{% block custom_css %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/match-operations/seasons.css') }}">
{% endif %}
{% endblock %}
