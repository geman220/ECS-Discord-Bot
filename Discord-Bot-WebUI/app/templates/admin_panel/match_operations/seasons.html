{% extends "admin_panel/base.html" %}

{% block title %}Season Management - Admin Panel{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">
    <a href="{{ url_for('admin_panel.match_operations') }}">Match Operations</a>
</li>
<li class="breadcrumb-item active">Season Management</li>
{% endblock %}

{% block panel_content %}

<!-- Statistics Cards -->
<div class="c-stats-grid" data-component="stats-grid">
    <div class="c-stat-card c-stat-card--primary" data-stat-card data-stat-type="total">
        <div class="c-stat-card__content">
            <div class="c-stat-card__body">
                <h5 class="c-stat-card__value">{{ stats.total_seasons or 0 }}</h5>
                <p class="c-stat-card__label">Total Seasons</p>
            </div>
            <div class="c-stat-card__icon">
                <i class="ti ti-calendar-time"></i>
            </div>
        </div>
    </div>

    <div class="c-stat-card c-stat-card--success" data-stat-card data-stat-type="active">
        <div class="c-stat-card__content">
            <div class="c-stat-card__body">
                <h5 class="c-stat-card__value">{{ stats.active_seasons or 0 }}</h5>
                <p class="c-stat-card__label">Active Seasons</p>
            </div>
            <div class="c-stat-card__icon">
                <i class="ti ti-calendar-check"></i>
            </div>
        </div>
    </div>

    <div class="c-stat-card c-stat-card--warning" data-stat-card data-stat-type="upcoming">
        <div class="c-stat-card__content">
            <div class="c-stat-card__body">
                <h5 class="c-stat-card__value">{{ stats.upcoming_seasons or 0 }}</h5>
                <p class="c-stat-card__label">Upcoming Seasons</p>
            </div>
            <div class="c-stat-card__icon">
                <i class="ti ti-calendar-plus"></i>
            </div>
        </div>
    </div>

    <div class="c-stat-card c-stat-card--info" data-stat-card data-stat-type="past">
        <div class="c-stat-card__content">
            <div class="c-stat-card__body">
                <h5 class="c-stat-card__value">{{ stats.past_seasons or 0 }}</h5>
                <p class="c-stat-card__label">Past Seasons</p>
            </div>
            <div class="c-stat-card__icon">
                <i class="ti ti-calendar-minus"></i>
            </div>
        </div>
    </div>
</div>

<!-- Current Season Info -->
<div class="c-panel-section" data-component="panel-section">
    <div class="c-card" data-card>
        <div class="c-card__header">
            <h5 class="c-card__title">
                <i class="ti ti-crown"></i>Current Season: {{ stats.current_season or 'None Set' }}
            </h5>
        </div>
        <div class="c-card__body">
            {% if stats.current_season != 'None' %}
            <div class="c-alert c-alert--success" data-alert data-alert-type="success">
                <i class="ti ti-check-circle c-alert__icon"></i>
                <div class="c-alert__content">
                    <strong>{{ stats.current_season }}</strong> is currently active and being used for new matches and leagues.
                </div>
            </div>
            {% else %}
            <div class="c-alert c-alert--warning" data-alert data-alert-type="warning">
                <i class="ti ti-alert-triangle c-alert__icon"></i>
                <div class="c-alert__content">
                    No current season is set. Please set a season as current to enable match scheduling and league operations.
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Seasons Table -->
<div class="c-panel-section" data-component="panel-section">
    <div class="c-card" data-card>
        <div class="c-card__header c-card__header--action">
            <h5 class="c-card__title">
                <i class="ti ti-calendar-time"></i>All Seasons
            </h5>
            <button class="c-btn c-btn--primary c-btn--sm" data-action="create-season">
                <i class="ti ti-plus"></i>Create Season
            </button>
        </div>
        <div class="c-card__body">
            {% if seasons %}
            <div class="c-table-responsive" data-table-container>
                <table class="c-table" data-table data-table-type="seasons">
                    <thead class="c-table__head">
                        <tr class="c-table__row">
                            <th class="c-table__header" scope="col">Season Name</th>
                            <th class="c-table__header" scope="col">Start Date</th>
                            <th class="c-table__header" scope="col">End Date</th>
                            <th class="c-table__header" scope="col">Matches</th>
                            <th class="c-table__header" scope="col">Status</th>
                            <th class="c-table__header" scope="col">Current</th>
                            <th class="c-table__header" scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="c-table__body">
                        {% for season in seasons %}
                        <tr class="c-table__row" data-season-id="{{ season.id }}">
                            <td class="c-table__cell">
                                <strong>{{ season.name }}</strong>
                            </td>
                            <td class="c-table__cell">
                                {% if season.start_date %}
                                    {{ season.start_date.strftime('%Y-%m-%d') }}
                                {% else %}
                                    <span class="c-text-muted">TBD</span>
                                {% endif %}
                            </td>
                            <td class="c-table__cell">
                                {% if season.end_date %}
                                    {{ season.end_date.strftime('%Y-%m-%d') }}
                                {% else %}
                                    <span class="c-text-muted">TBD</span>
                                {% endif %}
                            </td>
                            <td class="c-table__cell">
                                <span class="c-badge c-badge--info" data-badge data-badge-type="count">{{ season.match_count or 0 }}</span>
                            </td>
                            <td class="c-table__cell">
                                {% if season.status == 'active' %}
                                    <span class="c-badge c-badge--success" data-badge data-status="active">Active</span>
                                {% elif season.status == 'upcoming' %}
                                    <span class="c-badge c-badge--warning" data-badge data-status="upcoming">Upcoming</span>
                                {% elif season.status == 'completed' %}
                                    <span class="c-badge c-badge--secondary" data-badge data-status="completed">Completed</span>
                                {% else %}
                                    <span class="c-badge c-badge--secondary" data-badge data-status="unknown">{{ season.status or 'Unknown' }}</span>
                                {% endif %}
                            </td>
                            <td class="c-table__cell">
                                {% if season.is_current %}
                                    <span class="c-badge c-badge--success" data-badge data-current="true">
                                        <i class="ti ti-crown"></i>Current
                                    </span>
                                {% else %}
                                    <button class="c-btn c-btn--outline-primary c-btn--sm" data-action="set-current-season" data-season-id="{{ season.id }}">
                                        Set Current
                                    </button>
                                {% endif %}
                            </td>
                            <td class="c-table__cell">
                                <div class="c-btn-group" data-btn-group>
                                    <button class="c-btn c-btn--icon c-btn--outline-info" data-action="view-season" data-season-id="{{ season.id }}" aria-label="View season">
                                        <i class="ti ti-eye"></i>
                                    </button>
                                    <button class="c-btn c-btn--icon c-btn--outline-warning" data-action="edit-season" data-season-id="{{ season.id }}" aria-label="Edit season">
                                        <i class="ti ti-edit"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="c-empty-state" data-component="empty-state" data-empty-type="seasons">
                <i class="ti ti-calendar-off c-empty-state__icon"></i>
                <h5 class="c-empty-state__title">No Seasons Found</h5>
                <p class="c-empty-state__text">Create your first season to get started with league management.</p>
                <button class="c-btn c-btn--primary" data-action="create-season">
                    <i class="ti ti-plus"></i>Create Season
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="c-panel-section" data-component="panel-section">
    <div class="c-alert c-alert--info" data-alert data-alert-type="info">
        <i class="ti ti-info-circle c-alert__icon"></i>
        <div class="c-alert__content">
            <strong>Season Management:</strong>
            Seasons organize your leagues and matches by time period. Only one season can be current at a time.
        </div>
    </div>
</div>

{% endblock %}

{% block custom_css %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/match-operations/seasons.css') }}">
{% endblock %}

{% block custom_js %}
{{ super() }}
<script src="{{ url_for('static', filename='js/match-operations/seasons.js') }}"></script>
{% endblock %}
