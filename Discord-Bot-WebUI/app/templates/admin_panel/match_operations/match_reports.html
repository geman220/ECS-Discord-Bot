{% extends "admin_panel/base.html" %}

{% block title %}Match Reports - Admin Panel{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">
    <a href="{{ url_for('admin_panel.match_operations') }}">Match Operations</a>
</li>
<li class="breadcrumb-item active">Match Reports</li>
{% endblock %}

{% block custom_css %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/match-operations/seasons.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/match-operations/match-reports.css') }}">
{% endif %}
{% endblock %}

{% block panel_content %}

<!-- Reports Overview Statistics -->
<div class="c-stats-grid" data-component="stats-grid">
    <div class="c-stat-card c-stat-card--primary">
        <div class="c-stat-card__content">
            <div class="c-stat-card__body">
                <h5 class="c-stat-card__value">{{ reports_data.total_matches if reports_data else 0 }}</h5>
                <p class="c-stat-card__label">Total Matches</p>
            </div>
            <i class="ti ti-calendar c-stat-card__icon"></i>
        </div>
    </div>
    <div class="c-stat-card c-stat-card--success">
        <div class="c-stat-card__content">
            <div class="c-stat-card__body">
                <h5 class="c-stat-card__value">{{ reports_data.completed_matches if reports_data else 0 }}</h5>
                <p class="c-stat-card__label">Completed</p>
            </div>
            <i class="ti ti-check c-stat-card__icon"></i>
        </div>
    </div>
    <div class="c-stat-card c-stat-card--warning">
        <div class="c-stat-card__content">
            <div class="c-stat-card__body">
                <h5 class="c-stat-card__value">{{ reports_data.pending_matches if reports_data else 0 }}</h5>
                <p class="c-stat-card__label">Pending</p>
            </div>
            <i class="ti ti-clock c-stat-card__icon"></i>
        </div>
    </div>
    <div class="c-stat-card c-stat-card--info">
        <div class="c-stat-card__content">
            <div class="c-stat-card__body">
                <h5 class="c-stat-card__value">{{ reports_data.total_teams if reports_data else 0 }}</h5>
                <p class="c-stat-card__label">Total Teams</p>
            </div>
            <i class="ti ti-users c-stat-card__icon"></i>
        </div>
    </div>
</div>

<!-- Report Actions -->
<div class="c-panel-section">
    <div class="c-card">
        <div class="c-card__header">
            <h5 class="c-card__title">
                <i class="ti ti-report"></i>
                Generate Reports
            </h5>
        </div>
        <div class="c-card__body">
            <div class="c-report-actions" data-component="report-actions">
                <button class="c-report-actions__button" data-action="generate-match-report">
                    <i class="ti ti-file-text c-report-actions__icon"></i>
                    <span class="c-report-actions__label">Match Summary</span>
                </button>
                <button class="c-report-actions__button" data-action="generate-league-report">
                    <i class="ti ti-trophy c-report-actions__icon"></i>
                    <span class="c-report-actions__label">League Statistics</span>
                </button>
                <button class="c-report-actions__button" data-action="generate-team-report">
                    <i class="ti ti-users c-report-actions__icon"></i>
                    <span class="c-report-actions__label">Team Performance</span>
                </button>
                <button class="c-report-actions__button" data-action="generate-custom-report">
                    <i class="ti ti-chart-bar c-report-actions__icon"></i>
                    <span class="c-report-actions__label">Custom Report</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Quick Reports and Export Options -->
<div class="c-report-grid" data-component="report-grid">
    <!-- Quick Reports -->
    <div class="c-report-grid__column">
        <div class="c-card">
            <div class="c-card__header">
                <h5 class="c-card__title">
                    <i class="ti ti-clock-fast"></i>
                    Quick Reports
                </h5>
            </div>
            <div class="c-card__body c-card__body--no-padding">
                <div class="c-quick-report">
                    <button class="c-quick-report__item" data-action="view-recent-matches">
                        <div class="c-quick-report__content">
                            <i class="ti ti-calendar-event c-quick-report__icon"></i>
                            <div class="c-quick-report__details">
                                <div class="c-quick-report__title">Recent Matches</div>
                                <div class="c-quick-report__subtitle">Last 7 days activity</div>
                            </div>
                        </div>
                        <span class="c-quick-report__value">
                            <span class="c-badge c-badge--primary">{{ reports_data.recent_matches|length if reports_data and reports_data.recent_matches else 0 }}</span>
                        </span>
                    </button>
                    <button class="c-quick-report__item" data-action="view-upcoming-matches">
                        <div class="c-quick-report__content">
                            <i class="ti ti-calendar-plus c-quick-report__icon"></i>
                            <div class="c-quick-report__details">
                                <div class="c-quick-report__title">Upcoming Matches</div>
                                <div class="c-quick-report__subtitle">Next 7 days schedule</div>
                            </div>
                        </div>
                        <span class="c-quick-report__value">
                            <span class="c-badge c-badge--success">{{ reports_data.upcoming_matches if reports_data else 0 }}</span>
                        </span>
                    </button>
                    <button class="c-quick-report__item" data-action="view-top-scorers">
                        <div class="c-quick-report__content">
                            <i class="ti ti-trophy c-quick-report__icon"></i>
                            <div class="c-quick-report__details">
                                <div class="c-quick-report__title">Top Scorers</div>
                                <div class="c-quick-report__subtitle">Highest scoring teams</div>
                            </div>
                        </div>
                        <i class="ti ti-chevron-right c-quick-report__chevron"></i>
                    </button>
                    <button class="c-quick-report__item" data-action="view-league-standings">
                        <div class="c-quick-report__content">
                            <i class="ti ti-list-numbers c-quick-report__icon"></i>
                            <div class="c-quick-report__details">
                                <div class="c-quick-report__title">League Standings</div>
                                <div class="c-quick-report__subtitle">Current league positions</div>
                            </div>
                        </div>
                        <i class="ti ti-chevron-right c-quick-report__chevron"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Options -->
    <div class="c-report-grid__column">
        <div class="c-card">
            <div class="c-card__header">
                <h5 class="c-card__title">
                    <i class="ti ti-download"></i>
                    Export Options
                </h5>
            </div>
            <div class="c-card__body c-card__body--no-padding">
                <div class="c-quick-report">
                    <button class="c-quick-report__item" data-action="export-pdf">
                        <div class="c-quick-report__content">
                            <i class="ti ti-file-type-pdf c-quick-report__icon"></i>
                            <div class="c-quick-report__details">
                                <div class="c-quick-report__title">PDF Report</div>
                                <div class="c-quick-report__subtitle">Formatted report document</div>
                            </div>
                        </div>
                        <i class="ti ti-chevron-right c-quick-report__chevron"></i>
                    </button>
                    <button class="c-quick-report__item" data-action="export-excel">
                        <div class="c-quick-report__content">
                            <i class="ti ti-file-spreadsheet c-quick-report__icon"></i>
                            <div class="c-quick-report__details">
                                <div class="c-quick-report__title">Excel Spreadsheet</div>
                                <div class="c-quick-report__subtitle">Data for analysis</div>
                            </div>
                        </div>
                        <i class="ti ti-chevron-right c-quick-report__chevron"></i>
                    </button>
                    <button class="c-quick-report__item" data-action="export-csv">
                        <div class="c-quick-report__content">
                            <i class="ti ti-file-text c-quick-report__icon"></i>
                            <div class="c-quick-report__details">
                                <div class="c-quick-report__title">CSV Export</div>
                                <div class="c-quick-report__subtitle">Raw data export</div>
                            </div>
                        </div>
                        <i class="ti ti-chevron-right c-quick-report__chevron"></i>
                    </button>
                    <button class="c-quick-report__item" data-action="schedule-report">
                        <div class="c-quick-report__content">
                            <i class="ti ti-calendar-time c-quick-report__icon"></i>
                            <div class="c-quick-report__details">
                                <div class="c-quick-report__title">Schedule Report</div>
                                <div class="c-quick-report__subtitle">Automated reports</div>
                            </div>
                        </div>
                        <i class="ti ti-chevron-right c-quick-report__chevron"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Match Results -->
{% if reports_data and reports_data.recent_matches %}
<div class="c-panel-section">
    <div class="c-card">
        <div class="c-card__header c-card__header--action">
            <h5 class="c-card__title">
                <i class="ti ti-history"></i>
                Recent Match Results
            </h5>
            <button class="c-btn c-btn--outline-primary c-btn--sm" data-action="view-all-matches">
                <i class="ti ti-eye"></i>View All
            </button>
        </div>
        <div class="c-card__body">
            <div class="c-table-responsive">
                <table class="c-table">
                    <thead class="c-table__head">
                        <tr>
                            <th class="c-table__header">Date</th>
                            <th class="c-table__header">Home Team</th>
                            <th class="c-table__header">Score</th>
                            <th class="c-table__header">Away Team</th>
                            <th class="c-table__header">League</th>
                            <th class="c-table__header">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="c-table__body">
                        {% for match in reports_data.recent_matches[:10] %}
                        <tr class="c-table__row">
                            <td class="c-table__cell">
                                {{ match.date.strftime('%Y-%m-%d') if match.date else 'N/A' }}
                                {% if match.time %}
                                    <br><small class="c-text-muted">{{ match.time.strftime('%H:%M') }}</small>
                                {% endif %}
                            </td>
                            <td class="c-table__cell">
                                <strong>{{ match.home_team.name if match.home_team else 'TBD' }}</strong>
                            </td>
                            <td class="c-table__cell">
                                {% if match.home_score is not none and match.away_score is not none %}
                                    <span class="c-badge c-badge--{{ 'success' if match.home_score > match.away_score else 'info' if match.home_score == match.away_score else 'secondary' }}">
                                        {{ match.home_score }} - {{ match.away_score }}
                                    </span>
                                {% else %}
                                    <span class="c-badge c-badge--warning">Pending</span>
                                {% endif %}
                            </td>
                            <td class="c-table__cell">
                                {{ match.away_team.name if match.away_team else 'TBD' }}
                            </td>
                            <td class="c-table__cell">
                                {% if match.league %}
                                    <span class="c-badge c-badge--info">{{ match.league.name }}</span>
                                {% else %}
                                    <span class="c-text-muted">No League</span>
                                {% endif %}
                            </td>
                            <td class="c-table__cell">
                                <div class="c-btn-group">
                                    <button class="c-btn c-btn--icon c-btn--outline-info" data-action="view-match-report" data-match-id="{{ match.id }}" aria-label="View match">
                                        <i class="ti ti-eye"></i>
                                    </button>
                                    <button class="c-btn c-btn--icon c-btn--outline-info" data-action="generate-match-report" data-match-id="{{ match.id }}" aria-label="Generate report">
                                        <i class="ti ti-file-text"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Statistics Charts -->
<div class="c-chart-grid" data-component="chart-grid">
    <div class="c-chart-container">
        <h5 class="c-chart-container__title">
            <i class="ti ti-chart-pie"></i>
            Match Status Distribution
        </h5>
        <canvas id="matchStatusChart" class="c-chart-container__canvas"></canvas>
    </div>
    <div class="c-chart-container">
        <h5 class="c-chart-container__title">
            <i class="ti ti-chart-line"></i>
            Matches per Week
        </h5>
        <canvas id="matchesPerWeekChart" class="c-chart-container__canvas"></canvas>
    </div>
</div>

<!-- Team Performance Summary -->
{% if reports_data and reports_data.teams %}
<div class="c-panel-section">
    <div class="c-card">
        <div class="c-card__header c-card__header--action">
            <h5 class="c-card__title">
                <i class="ti ti-users"></i>
                Team Performance Summary
            </h5>
            <div class="c-performance-toggle" data-component="performance-toggle">
                <input type="radio" class="btn-check" name="performanceView" id="viewWins" autocomplete="off" checked>
                <label class="c-btn c-btn--outline-primary c-btn--sm" for="viewWins">Wins</label>
                <input type="radio" class="btn-check" name="performanceView" id="viewGoals" autocomplete="off">
                <label class="c-btn c-btn--outline-primary c-btn--sm" for="viewGoals">Goals</label>
                <input type="radio" class="btn-check" name="performanceView" id="viewMatches" autocomplete="off">
                <label class="c-btn c-btn--outline-primary c-btn--sm" for="viewMatches">Matches</label>
            </div>
        </div>
        <div class="c-card__body">
            <div class="c-table-responsive">
                <table class="c-table">
                    <thead class="c-table__head">
                        <tr>
                            <th class="c-table__header">Team</th>
                            <th class="c-table__header">League</th>
                            <th class="c-table__header">Played</th>
                            <th class="c-table__header">Won</th>
                            <th class="c-table__header">Lost</th>
                            <th class="c-table__header">Goals For</th>
                            <th class="c-table__header">Goals Against</th>
                            <th class="c-table__header">Goal Difference</th>
                            <th class="c-table__header">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="c-table__body">
                        {% for team in reports_data.teams[:10] %}
                        <tr class="c-table__row">
                            <td class="c-table__cell">
                                <div class="c-team-name">
                                    <div class="c-team-avatar">
                                        <span class="c-team-avatar__initial">{{ team.name[0] if team.name else 'T' }}</span>
                                    </div>
                                    <strong>{{ team.name }}</strong>
                                </div>
                            </td>
                            <td class="c-table__cell">
                                {% if team.league %}
                                    <span class="c-badge c-badge--info">{{ team.league.name }}</span>
                                {% else %}
                                    <span class="c-text-muted">No League</span>
                                {% endif %}
                            </td>
                            <td class="c-table__cell">{{ team.matches_played if team.matches_played else 0 }}</td>
                            <td class="c-table__cell">
                                <span class="c-badge c-badge--success">{{ team.wins if team.wins else 0 }}</span>
                            </td>
                            <td class="c-table__cell">
                                <span class="c-badge c-badge--danger">{{ team.losses if team.losses else 0 }}</span>
                            </td>
                            <td class="c-table__cell">{{ team.goals_for if team.goals_for else 0 }}</td>
                            <td class="c-table__cell">{{ team.goals_against if team.goals_against else 0 }}</td>
                            <td class="c-table__cell">
                                {% set goal_diff = (team.goals_for or 0) - (team.goals_against or 0) %}
                                <span class="c-badge c-badge--{{ 'success' if goal_diff > 0 else 'danger' if goal_diff < 0 else 'secondary' }}">
                                    {{ '+' + goal_diff|string if goal_diff > 0 else goal_diff }}
                                </span>
                            </td>
                            <td class="c-table__cell">
                                <div class="c-btn-group">
                                    <button class="c-btn c-btn--icon c-btn--outline-info" data-action="view-team-report" data-team-id="{{ team.id }}" aria-label="View team">
                                        <i class="ti ti-eye"></i>
                                    </button>
                                    <button class="c-btn c-btn--icon c-btn--outline-info" data-action="generate-team-report" data-team-id="{{ team.id }}" aria-label="Generate report">
                                        <i class="ti ti-file-text"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block custom_js %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/match-operations/match-reports.js') }}"></script>
{% endif %}
{% endblock %}
