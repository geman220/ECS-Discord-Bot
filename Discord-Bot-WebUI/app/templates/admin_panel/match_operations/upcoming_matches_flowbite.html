{% extends "admin_panel/base_flowbite.html" %}
{% from 'macros/flowbite.html' import card, button, badge, alert, empty_state %}

{% block admin_title %}Upcoming Matches{% endblock %}
{% block panel_description %}View all upcoming scheduled matches{% endblock %}

{% block breadcrumb_items %}
<li>
    <div class="flex items-center">
        <i class="ti ti-chevron-right w-4 h-4 text-gray-400"></i>
        <a href="{{ url_for('admin_panel.match_operations') }}" class="ml-1 text-sm font-medium text-gray-500 hover:text-ecs-green dark:text-gray-400 dark:hover:text-white">Match Operations</a>
    </div>
</li>
<li>
    <div class="flex items-center">
        <i class="ti ti-chevron-right w-4 h-4 text-gray-400"></i>
        <span class="ml-1 text-sm font-medium text-gray-500 dark:text-gray-400">Upcoming Matches</span>
    </div>
</li>
{% endblock %}

{% block panel_content %}
<!-- Statistics Cards -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="rounded-lg p-5 bg-ecs-green text-white">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-3xl font-bold">{{ upcoming|length }}</p>
                <p class="text-sm text-white/80 mt-1">Total Upcoming</p>
            </div>
            <i class="ti ti-calendar-plus text-4xl text-white/50"></i>
        </div>
    </div>

    <div class="rounded-lg p-5 bg-yellow-500 text-white">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-3xl font-bold">{{ today_matches }}</p>
                <p class="text-sm text-white/80 mt-1">Today</p>
            </div>
            <i class="ti ti-calendar-event text-4xl text-white/50"></i>
        </div>
    </div>

    <div class="rounded-lg p-5 bg-blue-500 text-white">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-3xl font-bold">{{ this_week }}</p>
                <p class="text-sm text-white/80 mt-1">This Week</p>
            </div>
            <i class="ti ti-calendar-week text-4xl text-white/50"></i>
        </div>
    </div>

    <div class="rounded-lg p-5 bg-green-500 text-white">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-3xl font-bold">{{ unscheduled }}</p>
                <p class="text-sm text-white/80 mt-1">Unscheduled</p>
            </div>
            <i class="ti ti-clock-question text-4xl text-white/50"></i>
        </div>
    </div>
</div>

<!-- Upcoming Matches Table -->
{% call card(title="Upcoming Matches", subtitle="All matches scheduled in the future") %}
{% if upcoming %}
<div class="overflow-x-auto">
    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
            <tr>
                <th scope="col" class="px-6 py-3">Date</th>
                <th scope="col" class="px-6 py-3">Time</th>
                <th scope="col" class="px-6 py-3">Match</th>
                <th scope="col" class="px-6 py-3">League</th>
                <th scope="col" class="px-6 py-3">Venue</th>
                <th scope="col" class="px-6 py-3">Status</th>
                <th scope="col" class="px-6 py-3">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for match in upcoming %}
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                <td class="px-6 py-4">
                    {% if match.date %}
                        <div class="font-medium text-gray-900 dark:text-white">{{ match.date.strftime('%Y-%m-%d') }}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">{{ match.date.strftime('%A') }}</div>
                    {% else %}
                        <span class="text-gray-400 dark:text-gray-500">TBD</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    {% if match.time %}
                        {{ match.time.strftime('%H:%M') }}
                    {% else %}
                        <span class="text-gray-400 dark:text-gray-500">TBD</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center">
                        <span class="font-medium text-gray-900 dark:text-white">{{ match.home_team.name if match.home_team else 'TBD' }}</span>
                        <span class="mx-2 text-gray-400 dark:text-gray-500">vs</span>
                        <span class="font-medium text-gray-900 dark:text-white">{{ match.away_team.name if match.away_team else 'TBD' }}</span>
                    </div>
                </td>
                <td class="px-6 py-4">
                    {% if match.league %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-ecs-green/10 text-ecs-green dark:bg-ecs-green/20">
                            {{ match.league.name }}
                        </span>
                    {% else %}
                        <span class="text-gray-400 dark:text-gray-500">-</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    {% if match.venue %}
                        {{ match.venue }}
                    {% else %}
                        <span class="text-gray-400 dark:text-gray-500">TBD</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    {% if match.date and match.time %}
                        {% set days_until = (match.date - moment().date()).days %}
                        {% if days_until == 0 %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">
                                <i class="ti ti-clock mr-1"></i>Today
                            </span>
                        {% elif days_until == 1 %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
                                Tomorrow
                            </span>
                        {% elif days_until <= 7 %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-ecs-green/10 text-ecs-green dark:bg-ecs-green/20">
                                {{ days_until }} days
                            </span>
                        {% else %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">
                                {{ days_until }} days
                            </span>
                        {% endif %}
                    {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">
                            Unscheduled
                        </span>
                    {% endif %}
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center gap-1">
                        <button type="button" class="p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded-lg transition-colors" data-action="view-match" data-match-id="{{ match.id }}" title="View">
                            <i class="ti ti-eye"></i>
                        </button>
                        <button type="button" class="p-2 text-yellow-600 hover:bg-yellow-100 dark:hover:bg-yellow-900/30 rounded-lg transition-colors" data-action="edit-match" data-match-id="{{ match.id }}" title="Edit">
                            <i class="ti ti-edit"></i>
                        </button>
                        {% if not match.date or not match.time %}
                        <button type="button" class="p-2 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/30 rounded-lg transition-colors" data-action="schedule-match" data-match-id="{{ match.id }}" title="Schedule">
                            <i class="ti ti-calendar-plus"></i>
                        </button>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<!-- Empty State -->
<div class="text-center py-12">
    <div class="mx-auto w-16 h-16 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700 mb-4">
        <i class="ti ti-calendar-off text-3xl text-gray-400 dark:text-gray-500"></i>
    </div>
    <h5 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No Upcoming Matches</h5>
    <p class="text-gray-500 dark:text-gray-400 mb-4">There are no upcoming matches scheduled at this time.</p>
    <a href="{{ url_for('admin_panel.schedule_matches') }}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-ecs-green rounded-lg hover:bg-ecs-green-700">
        <i class="ti ti-calendar-plus mr-2"></i>Schedule Matches
    </a>
</div>
{% endif %}
{% endcall %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const isDark = document.documentElement.classList.contains('dark');

    document.addEventListener('click', function(e) {
        const target = e.target.closest('[data-action]');
        if (!target) return;

        const action = target.dataset.action;
        const matchId = target.dataset.matchId;

        switch(action) {
            case 'view-match':
                // Redirect to match detail or show modal
                window.location.href = `{{ url_for('admin_panel.view_matches') }}?match_id=${matchId}`;
                break;
            case 'edit-match':
                window.location.href = `{{ url_for('admin_panel.match_results') }}?match_id=${matchId}`;
                break;
            case 'schedule-match':
                window.location.href = `{{ url_for('admin_panel.schedule_matches') }}?match_id=${matchId}`;
                break;
        }
    });
});
</script>
{% endblock %}
