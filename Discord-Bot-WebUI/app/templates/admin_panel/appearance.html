{% extends "admin_panel/base.html" %}
{% import 'macros.html' as macros %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">System</li>
<li class="breadcrumb-item active">Appearance</li>
{% endblock %}

{% block custom_css %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/admin-panel/appearance.css') }}">
{% endblock %}

{% block panel_content %}
<div class="row">
    <div class="col-12">
        <!-- Page Header -->
        <div class="c-appearance-header" data-component="appearance-header">
            <div class="c-appearance-header__content">
                <h4 class="c-appearance-header__title">
                    <i class="ti ti-palette c-appearance-header__icon"></i>
                    <span>Theme Customization</span>
                </h4>
                <p class="c-appearance-header__subtitle">Customize colors for the Modern theme. Changes apply site-wide.</p>
            </div>
            <div class="c-appearance-header__actions">
                <button type="button" class="c-btn c-btn--outline-secondary" data-action="export-colors">
                    <i class="ti ti-download"></i>Export
                </button>
                <button type="button" class="c-btn c-btn--outline-secondary" data-action="show-import">
                    <i class="ti ti-upload"></i>Import
                </button>
                <button type="button" class="c-btn c-btn--outline-danger" data-action="reset-colors">
                    <i class="ti ti-refresh"></i>Reset to Default
                </button>
            </div>
        </div>

        {% if has_custom_colors %}
        <div class="c-appearance-alert" data-component="alert">
            <i class="ti ti-info-circle c-appearance-alert__icon"></i>
            <div class="c-appearance-alert__content">
                <strong>Custom colors are active.</strong>
                These colors override the default Modern theme palette.
            </div>
        </div>
        {% endif %}

        <!-- Live Preview Section - Full Width -->
        <div class="c-theme-preview" data-component="theme-preview">
            <div class="c-theme-preview__header">
                <div>
                    <h5 class="c-theme-preview__title">
                        <i class="ti ti-eye"></i>
                        <span>Live Preview</span>
                    </h5>
                    <p class="c-theme-preview__subtitle">See your color changes in real-time for both modes</p>
                </div>
                <div class="c-theme-preview__mode-toggle">
                    <button type="button" class="c-theme-preview__mode-btn is-active" id="previewBothBtn" data-action="preview-mode" data-mode="both">Both</button>
                    <button type="button" class="c-theme-preview__mode-btn" id="previewLightBtn" data-action="preview-mode" data-mode="light">Light Only</button>
                    <button type="button" class="c-theme-preview__mode-btn" id="previewDarkBtn" data-action="preview-mode" data-mode="dark">Dark Only</button>
                </div>
            </div>
            <div class="c-theme-preview__body">
                <div class="c-theme-preview__grid" id="previewContainer">
                    <!-- Light Mode Preview -->
                    <div id="lightPreviewCol">
                        <div class="c-theme-preview__panel" data-preview-panel="light">
                            <span class="c-theme-preview__label" data-badge>
                                <i class="ti ti-sun"></i>
                                <span>Light Mode</span>
                            </span>
                            <div id="light-preview-area" class="light-preview-area" data-preview-bg="{{ colors.light.bg_body }}">
                                <!-- Simulated Navbar -->
                                <div class="preview-navbar" data-preview-bg="{{ colors.light.bg_card }}" data-preview-border="{{ colors.light.border }}">
                                    <span class="preview-heading" data-preview-color="{{ colors.light.text_heading }}">ECS Dashboard</span>
                                    <input type="text" class="form-control form-control-sm preview-input" data-preview-bg="{{ colors.light.bg_input }}" data-preview-border="{{ colors.light.border_input }}" data-preview-color="{{ colors.light.text_body }}" placeholder="Search..." data-form-control>
                                </div>

                                <!-- Simulated Card -->
                                <div class="preview-card" data-preview-bg="{{ colors.light.bg_card }}" data-preview-border="{{ colors.light.border }}" data-preview-border-left="{{ colors.light.primary }}">
                                    <div class="preview-card-content">
                                        <h6 class="preview-heading" data-preview-color="{{ colors.light.text_heading }}">Card Title</h6>
                                        <p class="preview-body" data-preview-color="{{ colors.light.text_body }}">
                                            This is body text showing <a href="#" class="preview-link" data-preview-color="{{ colors.light.text_link }}">a sample link</a>.
                                        </p>
                                        <p class="preview-muted" data-preview-color="{{ colors.light.text_muted }}">Muted caption text</p>
                                    </div>
                                </div>

                                <!-- Buttons -->
                                <div class="preview-buttons">
                                    <button class="c-btn c-btn--sm me-1 preview-btn-primary" data-preview-bg="{{ colors.light.primary }}" data-preview-border="{{ colors.light.primary }}">Primary</button>
                                    <button class="c-btn c-btn--sm me-1 preview-btn-secondary" data-preview-bg="{{ colors.light.secondary }}" data-preview-border="{{ colors.light.secondary }}">Secondary</button>
                                    <button class="c-btn c-btn--sm preview-btn-accent" data-preview-bg="{{ colors.light.accent }}" data-preview-border="{{ colors.light.accent }}">Accent</button>
                                </div>

                                <!-- Status Badges -->
                                <div>
                                    <span class="badge me-1 preview-badge-success" data-preview-bg="{{ colors.light.success }}" data-badge>Success</span>
                                    <span class="badge me-1 preview-badge-warning" data-preview-bg="{{ colors.light.warning }}" data-badge>Warning</span>
                                    <span class="badge me-1 preview-badge-danger" data-preview-bg="{{ colors.light.danger }}" data-badge>Danger</span>
                                    <span class="badge preview-badge-info" data-preview-bg="{{ colors.light.info }}" data-badge>Info</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dark Mode Preview -->
                    <div id="darkPreviewCol">
                        <div class="c-theme-preview__panel" data-preview-panel="dark">
                            <span class="c-theme-preview__label" data-badge>
                                <i class="ti ti-moon"></i>
                                <span>Dark Mode</span>
                            </span>
                            <div id="dark-preview-area" class="dark-preview-area" data-preview-bg="{{ colors.dark.bg_body }}">
                                <!-- Simulated Navbar -->
                                <div class="preview-navbar-dark" data-preview-bg="{{ colors.dark.bg_card }}" data-preview-border="{{ colors.dark.border }}">
                                    <span class="preview-heading-dark" data-preview-color="{{ colors.dark.text_heading }}">ECS Dashboard</span>
                                    <input type="text" class="form-control form-control-sm preview-input-dark" data-preview-bg="{{ colors.dark.bg_input }}" data-preview-border="{{ colors.dark.border_input }}" data-preview-color="{{ colors.dark.text_body }}" placeholder="Search..." data-form-control>
                                </div>

                                <!-- Simulated Card -->
                                <div class="preview-card-dark" data-preview-bg="{{ colors.dark.bg_card }}" data-preview-border="{{ colors.dark.border }}" data-preview-border-left="{{ colors.dark.primary }}">
                                    <div class="preview-card-content">
                                        <h6 class="preview-heading-dark" data-preview-color="{{ colors.dark.text_heading }}">Card Title</h6>
                                        <p class="preview-body-dark" data-preview-color="{{ colors.dark.text_body }}">
                                            This is body text showing <a href="#" class="preview-link-dark" data-preview-color="{{ colors.dark.text_link }}">a sample link</a>.
                                        </p>
                                        <p class="preview-muted-dark" data-preview-color="{{ colors.dark.text_muted }}">Muted caption text</p>
                                    </div>
                                </div>

                                <!-- Buttons -->
                                <div class="preview-buttons">
                                    <button class="c-btn c-btn--sm me-1 preview-btn-primary-dark" data-preview-bg="{{ colors.dark.primary }}" data-preview-border="{{ colors.dark.primary }}">Primary</button>
                                    <button class="c-btn c-btn--sm me-1 preview-btn-secondary-dark" data-preview-bg="{{ colors.dark.secondary }}" data-preview-border="{{ colors.dark.secondary }}">Secondary</button>
                                    <button class="c-btn c-btn--sm preview-btn-accent-dark" data-preview-bg="{{ colors.dark.accent }}" data-preview-border="{{ colors.dark.accent }}">Accent</button>
                                </div>

                                <!-- Status Badges -->
                                <div>
                                    <span class="badge me-1 preview-badge-success-dark" data-preview-bg="{{ colors.dark.success }}" data-badge>Success</span>
                                    <span class="badge me-1 preview-badge-warning-dark" data-preview-bg="{{ colors.dark.warning }}" data-badge>Warning</span>
                                    <span class="badge me-1 preview-badge-danger-dark" data-preview-bg="{{ colors.dark.danger }}" data-badge>Danger</span>
                                    <span class="badge preview-badge-info-dark" data-preview-bg="{{ colors.dark.info }}" data-badge>Info</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Color Tabs -->
        <ul class="nav nav-tabs appearance-tabs" role="tablist" data-tabs>
            <li class="nav-item">
                <button class="nav-link appearance-tab-link active" data-bs-toggle="tab" data-bs-target="#light-mode" type="button">
                    <i class="ti ti-sun appearance-tab-icon"></i>Light Mode Colors
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link appearance-tab-link" data-bs-toggle="tab" data-bs-target="#dark-mode" type="button">
                    <i class="ti ti-moon appearance-tab-icon"></i>Dark Mode Colors
                </button>
            </li>
        </ul>

        <div class="tab-content">
            <!-- LIGHT MODE COLORS -->
            <div class="tab-pane fade show active" id="light-mode" data-tab-pane>
                <div class="row">
                    <!-- Brand Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-color-category" data-component="color-category">
                            <div class="c-color-category__header">
                                <h6 class="c-color-category__title">
                                    <i class="ti ti-brush c-color-category__title-icon"></i>
                                    <span>Brand Colors</span>
                                </h6>
                                <small class="c-color-category__subtitle">Main identity colors used throughout the site</small>
                            </div>
                            <div class="c-color-category__body">
                                <div class="color-field-group">
                                    <label class="form-label color-field-label">
                                        <span class="color-field-name">Primary</span>
                                        <span class="color-field-description">Buttons, links, active states</span>
                                    </label>
                                    <div class="input-group color-picker-group" data-input-group>
                                        <input type="color" class="form-control form-control-color color-picker-input" id="light-primary" value="{{ colors.light.primary }}" data-form-control>
                                        <input type="text" class="form-control color-hex-input" id="light-primary-hex" value="{{ colors.light.primary }}" pattern="^#[0-9A-Fa-f]{6}$" data-form-control>
                                    </div>
                                </div>
                                <div class="color-field-group">
                                    <label class="form-label color-field-label">
                                        <span class="color-field-name">Primary Light</span>
                                        <span class="color-field-description">Hover states, highlights</span>
                                    </label>
                                    <div class="input-group color-picker-group" data-input-group>
                                        <input type="color" class="form-control form-control-color color-picker-input" id="light-primary_light" value="{{ colors.light.primary_light }}" data-form-control>
                                        <input type="text" class="form-control color-hex-input" id="light-primary_light-hex" value="{{ colors.light.primary_light }}" data-form-control>
                                    </div>
                                </div>
                                <div class="color-field-group">
                                    <label class="form-label color-field-label">
                                        <span class="color-field-name">Primary Dark</span>
                                        <span class="color-field-description">Pressed states, emphasis</span>
                                    </label>
                                    <div class="input-group color-picker-group" data-input-group>
                                        <input type="color" class="form-control form-control-color color-picker-input" id="light-primary_dark" value="{{ colors.light.primary_dark }}" data-form-control>
                                        <input type="text" class="form-control color-hex-input" id="light-primary_dark-hex" value="{{ colors.light.primary_dark }}" data-form-control>
                                    </div>
                                </div>
                                <div class="color-field-group">
                                    <label class="form-label color-field-label">
                                        <span class="color-field-name">Secondary</span>
                                        <span class="color-field-description">Secondary buttons, muted UI</span>
                                    </label>
                                    <div class="input-group color-picker-group" data-input-group>
                                        <input type="color" class="form-control form-control-color color-picker-input" id="light-secondary" value="{{ colors.light.secondary }}" data-form-control>
                                        <input type="text" class="form-control color-hex-input" id="light-secondary-hex" value="{{ colors.light.secondary }}" data-form-control>
                                    </div>
                                </div>
                                <div class="color-field-group">
                                    <label class="form-label color-field-label">
                                        <span class="color-field-name">Accent</span>
                                        <span class="color-field-description">CTAs, highlights, badges</span>
                                    </label>
                                    <div class="input-group color-picker-group" data-input-group>
                                        <input type="color" class="form-control form-control-color color-picker-input" id="light-accent" value="{{ colors.light.accent }}" data-form-control>
                                        <input type="text" class="form-control color-hex-input" id="light-accent-hex" value="{{ colors.light.accent }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Text Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-card h-100">
                            <div class="c-card__header bg-light">
                                <h6 class="mb-0"><i class="ti ti-typography me-2 text-primary"></i>Text Colors</h6>
                                <small class="text-muted">Typography and content colors</small>
                            </div>
                            <div class="c-card__body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Heading Text</span>
                                        <span class="text-muted small">h1-h6, card titles</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-text_heading" value="{{ colors.light.text_heading }}" data-form-control>
                                        <input type="text" class="form-control" id="light-text_heading-hex" value="{{ colors.light.text_heading }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Body Text</span>
                                        <span class="text-muted small">Paragraphs, content</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-text_body" value="{{ colors.light.text_body }}" data-form-control>
                                        <input type="text" class="form-control" id="light-text_body-hex" value="{{ colors.light.text_body }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Muted Text</span>
                                        <span class="text-muted small">Captions, labels, hints</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-text_muted" value="{{ colors.light.text_muted }}" data-form-control>
                                        <input type="text" class="form-control" id="light-text_muted-hex" value="{{ colors.light.text_muted }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Link Color</span>
                                        <span class="text-muted small">Clickable text links</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-text_link" value="{{ colors.light.text_link }}" data-form-control>
                                        <input type="text" class="form-control" id="light-text_link-hex" value="{{ colors.light.text_link }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-card h-100">
                            <div class="c-card__header bg-light">
                                <h6 class="mb-0"><i class="ti ti-traffic-lights me-2 text-primary"></i>Status Colors</h6>
                                <small class="text-muted">Alerts, badges, feedback states</small>
                            </div>
                            <div class="c-card__body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Success</span>
                                        <span class="text-muted small">Confirmations, completed</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-success" value="{{ colors.light.success }}" data-form-control>
                                        <input type="text" class="form-control" id="light-success-hex" value="{{ colors.light.success }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Warning</span>
                                        <span class="text-muted small">Cautions, pending states</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-warning" value="{{ colors.light.warning }}" data-form-control>
                                        <input type="text" class="form-control" id="light-warning-hex" value="{{ colors.light.warning }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Danger</span>
                                        <span class="text-muted small">Errors, destructive actions</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-danger" value="{{ colors.light.danger }}" data-form-control>
                                        <input type="text" class="form-control" id="light-danger-hex" value="{{ colors.light.danger }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Info</span>
                                        <span class="text-muted small">Information, tips</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-info" value="{{ colors.light.info }}" data-form-control>
                                        <input type="text" class="form-control" id="light-info-hex" value="{{ colors.light.info }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Background Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-card h-100">
                            <div class="c-card__header bg-light">
                                <h6 class="mb-0"><i class="ti ti-layout me-2 text-primary"></i>Backgrounds</h6>
                                <small class="text-muted">Page and component backgrounds</small>
                            </div>
                            <div class="c-card__body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Page Background</span>
                                        <span class="text-muted small">Main body background</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-bg_body" value="{{ colors.light.bg_body }}" data-form-control>
                                        <input type="text" class="form-control" id="light-bg_body-hex" value="{{ colors.light.bg_body }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Card Background</span>
                                        <span class="text-muted small">Cards, modals, panels</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-bg_card" value="{{ colors.light.bg_card }}" data-form-control>
                                        <input type="text" class="form-control" id="light-bg_card-hex" value="{{ colors.light.bg_card }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Input Background</span>
                                        <span class="text-muted small">Form fields, inputs</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-bg_input" value="{{ colors.light.bg_input }}" data-form-control>
                                        <input type="text" class="form-control" id="light-bg_input-hex" value="{{ colors.light.bg_input }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Border Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-card h-100">
                            <div class="c-card__header bg-light">
                                <h6 class="mb-0"><i class="ti ti-border-style me-2 text-primary"></i>Borders</h6>
                                <small class="text-muted">Separators and outlines</small>
                            </div>
                            <div class="c-card__body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Default Border</span>
                                        <span class="text-muted small">Card borders, dividers</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-border" value="{{ colors.light.border }}" data-form-control>
                                        <input type="text" class="form-control" id="light-border-hex" value="{{ colors.light.border }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Input Border</span>
                                        <span class="text-muted small">Form field borders</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="light-border_input" value="{{ colors.light.border_input }}" data-form-control>
                                        <input type="text" class="form-control" id="light-border_input-hex" value="{{ colors.light.border_input }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DARK MODE COLORS -->
            <div class="tab-pane fade" id="dark-mode" data-tab-pane>
                <div class="row">
                    <!-- Brand Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-card h-100">
                            <div class="c-card__header bg-light">
                                <h6 class="mb-0"><i class="ti ti-brush me-2 text-primary"></i>Brand Colors</h6>
                                <small class="text-muted">Adjusted for dark mode visibility</small>
                            </div>
                            <div class="c-card__body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Primary</span>
                                        <span class="text-muted small">Brighter for dark backgrounds</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-primary" value="{{ colors.dark.primary }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-primary-hex" value="{{ colors.dark.primary }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Primary Light</span>
                                        <span class="text-muted small">Hover states</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-primary_light" value="{{ colors.dark.primary_light }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-primary_light-hex" value="{{ colors.dark.primary_light }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Primary Dark</span>
                                        <span class="text-muted small">Pressed states</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-primary_dark" value="{{ colors.dark.primary_dark }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-primary_dark-hex" value="{{ colors.dark.primary_dark }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Secondary</span>
                                        <span class="text-muted small">Secondary UI elements</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-secondary" value="{{ colors.dark.secondary }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-secondary-hex" value="{{ colors.dark.secondary }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Accent</span>
                                        <span class="text-muted small">CTAs, highlights</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-accent" value="{{ colors.dark.accent }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-accent-hex" value="{{ colors.dark.accent }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Text Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-card h-100">
                            <div class="c-card__header bg-light">
                                <h6 class="mb-0"><i class="ti ti-typography me-2 text-primary"></i>Text Colors</h6>
                                <small class="text-muted">Light text on dark backgrounds</small>
                            </div>
                            <div class="c-card__body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Heading Text</span>
                                        <span class="text-muted small">h1-h6, card titles</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-text_heading" value="{{ colors.dark.text_heading }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-text_heading-hex" value="{{ colors.dark.text_heading }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Body Text</span>
                                        <span class="text-muted small">Paragraphs, content</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-text_body" value="{{ colors.dark.text_body }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-text_body-hex" value="{{ colors.dark.text_body }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Muted Text</span>
                                        <span class="text-muted small">Captions, labels</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-text_muted" value="{{ colors.dark.text_muted }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-text_muted-hex" value="{{ colors.dark.text_muted }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Link Color</span>
                                        <span class="text-muted small">Clickable text</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-text_link" value="{{ colors.dark.text_link }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-text_link-hex" value="{{ colors.dark.text_link }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-card h-100">
                            <div class="c-card__header bg-light">
                                <h6 class="mb-0"><i class="ti ti-traffic-lights me-2 text-primary"></i>Status Colors</h6>
                                <small class="text-muted">Brighter for dark backgrounds</small>
                            </div>
                            <div class="c-card__body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Success</span>
                                        <span class="text-muted small">Confirmations</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-success" value="{{ colors.dark.success }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-success-hex" value="{{ colors.dark.success }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Warning</span>
                                        <span class="text-muted small">Cautions</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-warning" value="{{ colors.dark.warning }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-warning-hex" value="{{ colors.dark.warning }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Danger</span>
                                        <span class="text-muted small">Errors</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-danger" value="{{ colors.dark.danger }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-danger-hex" value="{{ colors.dark.danger }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Info</span>
                                        <span class="text-muted small">Information</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-info" value="{{ colors.dark.info }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-info-hex" value="{{ colors.dark.info }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Background Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-card h-100">
                            <div class="c-card__header bg-light">
                                <h6 class="mb-0"><i class="ti ti-layout me-2 text-primary"></i>Backgrounds</h6>
                                <small class="text-muted">Dark mode surface colors</small>
                            </div>
                            <div class="c-card__body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Page Background</span>
                                        <span class="text-muted small">Darkest layer</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-bg_body" value="{{ colors.dark.bg_body }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-bg_body-hex" value="{{ colors.dark.bg_body }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Card Background</span>
                                        <span class="text-muted small">Elevated surfaces</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-bg_card" value="{{ colors.dark.bg_card }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-bg_card-hex" value="{{ colors.dark.bg_card }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Input Background</span>
                                        <span class="text-muted small">Form fields</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-bg_input" value="{{ colors.dark.bg_input }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-bg_input-hex" value="{{ colors.dark.bg_input }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Sidebar Background</span>
                                        <span class="text-muted small">Navigation panel</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-bg_sidebar" value="{{ colors.dark.bg_sidebar }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-bg_sidebar-hex" value="{{ colors.dark.bg_sidebar }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Border Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="c-card h-100">
                            <div class="c-card__header bg-light">
                                <h6 class="mb-0"><i class="ti ti-border-style me-2 text-primary"></i>Borders</h6>
                                <small class="text-muted">Subtle separators for dark mode</small>
                            </div>
                            <div class="c-card__body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Default Border</span>
                                        <span class="text-muted small">Card borders, dividers</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-border" value="{{ colors.dark.border }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-border-hex" value="{{ colors.dark.border }}" data-form-control>
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Input Border</span>
                                        <span class="text-muted small">Form field borders</span>
                                    </label>
                                    <div class="input-group" data-input-group>
                                        <input type="color" class="form-control form-control-color" id="dark-border_input" value="{{ colors.dark.border_input }}" data-form-control>
                                        <input type="text" class="form-control" id="dark-border_input-hex" value="{{ colors.dark.border_input }}" data-form-control>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save Button -->
        <div class="c-appearance-save" data-component="save-actions">
            <button type="button" class="c-appearance-save__btn" data-action="save-colors">
                <i class="ti ti-device-floppy"></i>
                <span>Save Changes</span>
            </button>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal c-modal fade" data-modal id="importModal" tabindex="-1" aria-labelledby="importModalLabel">
    <div class="modal-dialog c-modal__dialog" data-modal-dialog>
        <div class="modal-content c-modal__content" data-modal-content data-modal-content>
            <div class="modal-header c-modal__header" data-modal-header data-modal-header>
                <h5 class="modal-title c-modal__title" id="importModalLabel"><i class="ti ti-upload me-2"></i>Import Color Scheme</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" data-dismiss></button>
            </div>
            <div class="modal-body c-modal__body" data-modal-body data-modal-body>
                <div class="mb-3">
                    <label class="form-label">Paste JSON</label>
                    <textarea class="form-control" id="importJson" rows="10" placeholder='{"light": {...}, "dark": {...}}' data-form-control></textarea>
                </div>
            </div>
            <div class="modal-footer c-modal__footer" data-modal-footer data-modal-footer>
                <button type="button" class="c-btn c-btn--secondary" data-bs-dismiss="modal" data-dismiss>Cancel</button>
                <button type="button" class="c-btn c-btn--primary js-import-colors" data-action="import-colors">Import</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') %}
<script>
// Event delegation for appearance actions
document.addEventListener('DOMContentLoaded', function() {
    // Export colors
    document.querySelectorAll('.js-export-colors').forEach(btn => {
        btn.addEventListener('click', exportColors);
    });

    // Show import modal
    document.querySelectorAll('.js-show-import').forEach(btn => {
        btn.addEventListener('click', showImportModal);
    });

    // Reset colors
    document.querySelectorAll('.js-reset-colors').forEach(btn => {
        btn.addEventListener('click', resetColors);
    });

    // Preview mode buttons
    document.querySelectorAll('.js-preview-mode').forEach(btn => {
        btn.addEventListener('click', function() {
            setPreviewMode(this.dataset.mode);
        });
    });

    // Save colors button
    document.querySelectorAll('.js-save-colors').forEach(btn => {
        btn.addEventListener('click', saveColors);
    });

    // Import colors button
    document.querySelectorAll('.js-import-colors').forEach(btn => {
        btn.addEventListener('click', importColors);
    });
});

// Color field definitions
const lightColorFields = [
    'primary', 'primary_light', 'primary_dark', 'secondary', 'accent',
    'success', 'warning', 'danger', 'info',
    'text_heading', 'text_body', 'text_muted', 'text_link',
    'bg_body', 'bg_card', 'bg_input',
    'border', 'border_input'
];

const darkColorFields = [
    'primary', 'primary_light', 'primary_dark', 'secondary', 'accent',
    'success', 'warning', 'danger', 'info',
    'text_heading', 'text_body', 'text_muted', 'text_link',
    'bg_body', 'bg_card', 'bg_input', 'bg_sidebar',
    'border', 'border_input'
];

// Preview mode switching
function setPreviewMode(mode) {
    const lightCol = document.getElementById('lightPreviewCol');
    const darkCol = document.getElementById('darkPreviewCol');
    const bothBtn = document.getElementById('previewBothBtn');
    const lightBtn = document.getElementById('previewLightBtn');
    const darkBtn = document.getElementById('previewDarkBtn');

    [bothBtn, lightBtn, darkBtn].forEach(btn => btn.classList.remove('active'));

    if (mode === 'both') {
        lightCol.className = 'col-md-6 mb-3 mb-md-0';
        darkCol.className = 'col-md-6';
        lightCol.hidden = false;
        darkCol.hidden = false;
        bothBtn.classList.add('active');
    } else if (mode === 'light') {
        lightCol.className = 'col-12';
        lightCol.hidden = false;
        darkCol.hidden = true;
        lightBtn.classList.add('active');
    } else {
        darkCol.className = 'col-12';
        lightCol.hidden = true;
        darkCol.hidden = false;
        darkBtn.classList.add('active');
    }
}

// Initialize preview colors from data attributes
function initializePreviewColors() {
    // Apply colors to elements with data attributes
    document.querySelectorAll('[data-preview-bg]').forEach(el => {
        el.style.background = el.dataset.previewBg;
    });
    document.querySelectorAll('[data-preview-color]').forEach(el => {
        el.style.color = el.dataset.previewColor;
    });
    document.querySelectorAll('[data-preview-border]').forEach(el => {
        el.style.borderColor = el.dataset.previewBorder;
    });
    document.querySelectorAll('[data-preview-border-left]').forEach(el => {
        el.style.borderLeftColor = el.dataset.previewBorderLeft;
    });
}

// Call on page load
document.addEventListener('DOMContentLoaded', initializePreviewColors);

// Sync color picker with hex input
document.querySelectorAll('input[type="color"]').forEach(picker => {
    const hexInput = document.getElementById(picker.id + '-hex');
    if (hexInput) {
        picker.addEventListener('input', () => {
            hexInput.value = picker.value;
            updatePreview();
        });
        hexInput.addEventListener('input', () => {
            if (/^#[0-9A-Fa-f]{6}$/.test(hexInput.value)) {
                picker.value = hexInput.value;
                updatePreview();
            }
        });
    }
});

function updatePreview() {
    // Light mode preview updates
    updateLightPreview();
    // Dark mode preview updates
    updateDarkPreview();
}

function updateLightPreview() {
    const area = document.getElementById('light-preview-area');
    if (!area) return;

    const getValue = (id) => document.getElementById(id)?.value;

    // Background
    area.style.background = getValue('light-bg_body') || '#FAFAFA';

    // Navbar
    const navbar = area.querySelector('.preview-navbar');
    if (navbar) {
        navbar.style.background = getValue('light-bg_card') || '#FFFFFF';
        navbar.style.borderColor = getValue('light-border') || '#E4E4E7';
    }

    // Navbar title
    const navTitle = area.querySelector('.preview-navbar .preview-heading');
    if (navTitle) navTitle.style.color = getValue('light-text_heading') || '#18181B';

    // Input
    const input = area.querySelector('.preview-input');
    if (input) {
        input.style.background = getValue('light-bg_input') || '#FFFFFF';
        input.style.borderColor = getValue('light-border_input') || '#D4D4D8';
        input.style.color = getValue('light-text_body') || '#52525B';
    }

    // Card
    const card = area.querySelector('.preview-card');
    if (card) {
        card.style.background = getValue('light-bg_card') || '#FFFFFF';
        card.style.borderColor = getValue('light-border') || '#E4E4E7';
        card.style.borderLeftColor = getValue('light-primary') || '#7C3AED';
    }

    // Text
    area.querySelectorAll('.preview-heading').forEach(el => {
        el.style.color = getValue('light-text_heading') || '#18181B';
    });
    area.querySelectorAll('.preview-body').forEach(el => {
        el.style.color = getValue('light-text_body') || '#52525B';
    });
    area.querySelectorAll('.preview-muted').forEach(el => {
        el.style.color = getValue('light-text_muted') || '#71717A';
    });
    area.querySelectorAll('.preview-link').forEach(el => {
        el.style.color = getValue('light-text_link') || '#7C3AED';
    });

    // Buttons
    const btnPrimary = area.querySelector('.preview-btn-primary');
    if (btnPrimary) {
        btnPrimary.style.background = getValue('light-primary') || '#7C3AED';
        btnPrimary.style.borderColor = getValue('light-primary') || '#7C3AED';
    }
    const btnSecondary = area.querySelector('.preview-btn-secondary');
    if (btnSecondary) {
        btnSecondary.style.background = getValue('light-secondary') || '#64748B';
        btnSecondary.style.borderColor = getValue('light-secondary') || '#64748B';
    }
    const btnAccent = area.querySelector('.preview-btn-accent');
    if (btnAccent) {
        btnAccent.style.background = getValue('light-accent') || '#F59E0B';
        btnAccent.style.borderColor = getValue('light-accent') || '#F59E0B';
    }

    // Badges
    const badgeSuccess = area.querySelector('.preview-badge-success');
    if (badgeSuccess) badgeSuccess.style.background = getValue('light-success') || '#10B981';
    const badgeWarning = area.querySelector('.preview-badge-warning');
    if (badgeWarning) badgeWarning.style.background = getValue('light-warning') || '#F59E0B';
    const badgeDanger = area.querySelector('.preview-badge-danger');
    if (badgeDanger) badgeDanger.style.background = getValue('light-danger') || '#EF4444';
    const badgeInfo = area.querySelector('.preview-badge-info');
    if (badgeInfo) badgeInfo.style.background = getValue('light-info') || '#3B82F6';
}

function updateDarkPreview() {
    const area = document.getElementById('dark-preview-area');
    if (!area) return;

    const getValue = (id) => document.getElementById(id)?.value;

    // Background
    area.style.background = getValue('dark-bg_body') || '#09090B';

    // Navbar
    const navbar = area.querySelector('.preview-navbar-dark');
    if (navbar) {
        navbar.style.background = getValue('dark-bg_card') || '#18181B';
        navbar.style.borderColor = getValue('dark-border') || '#3F3F46';
    }

    // Navbar title
    const navTitle = area.querySelector('.preview-heading-dark');
    if (navTitle) navTitle.style.color = getValue('dark-text_heading') || '#FAFAFA';

    // Input
    const input = area.querySelector('.preview-input-dark');
    if (input) {
        input.style.background = getValue('dark-bg_input') || '#27272A';
        input.style.borderColor = getValue('dark-border_input') || '#3F3F46';
        input.style.color = getValue('dark-text_body') || '#A1A1AA';
    }

    // Card
    const card = area.querySelector('.preview-card-dark');
    if (card) {
        card.style.background = getValue('dark-bg_card') || '#18181B';
        card.style.borderColor = getValue('dark-border') || '#3F3F46';
        card.style.borderLeftColor = getValue('dark-primary') || '#A78BFA';
    }

    // Text
    area.querySelectorAll('.preview-heading-dark').forEach(el => {
        el.style.color = getValue('dark-text_heading') || '#FAFAFA';
    });
    area.querySelectorAll('.preview-body-dark').forEach(el => {
        el.style.color = getValue('dark-text_body') || '#A1A1AA';
    });
    area.querySelectorAll('.preview-muted-dark').forEach(el => {
        el.style.color = getValue('dark-text_muted') || '#71717A';
    });
    area.querySelectorAll('.preview-link-dark').forEach(el => {
        el.style.color = getValue('dark-text_link') || '#A78BFA';
    });

    // Buttons
    const btnPrimary = area.querySelector('.preview-btn-primary-dark');
    if (btnPrimary) {
        btnPrimary.style.background = getValue('dark-primary') || '#A78BFA';
        btnPrimary.style.borderColor = getValue('dark-primary') || '#A78BFA';
    }
    const btnSecondary = area.querySelector('.preview-btn-secondary-dark');
    if (btnSecondary) {
        btnSecondary.style.background = getValue('dark-secondary') || '#94A3B8';
        btnSecondary.style.borderColor = getValue('dark-secondary') || '#94A3B8';
    }
    const btnAccent = area.querySelector('.preview-btn-accent-dark');
    if (btnAccent) {
        btnAccent.style.background = getValue('dark-accent') || '#FBBF24';
        btnAccent.style.borderColor = getValue('dark-accent') || '#FBBF24';
    }

    // Badges
    const badgeSuccess = area.querySelector('.preview-badge-success-dark');
    if (badgeSuccess) badgeSuccess.style.background = getValue('dark-success') || '#34D399';
    const badgeWarning = area.querySelector('.preview-badge-warning-dark');
    if (badgeWarning) badgeWarning.style.background = getValue('dark-warning') || '#FBBF24';
    const badgeDanger = area.querySelector('.preview-badge-danger-dark');
    if (badgeDanger) badgeDanger.style.background = getValue('dark-danger') || '#F87171';
    const badgeInfo = area.querySelector('.preview-badge-info-dark');
    if (badgeInfo) badgeInfo.style.background = getValue('dark-info') || '#60A5FA';
}

function gatherColors() {
    const colors = { light: {}, dark: {} };

    lightColorFields.forEach(field => {
        const el = document.getElementById(`light-${field}`);
        if (el) colors.light[field] = el.value;
    });

    darkColorFields.forEach(field => {
        const el = document.getElementById(`dark-${field}`);
        if (el) colors.dark[field] = el.value;
    });

    return colors;
}

function saveColors() {
    const colors = gatherColors();
    const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;

    fetch('{{ url_for("admin_panel.save_colors") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Csrftoken': csrfToken
        },
        body: JSON.stringify(colors)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            Swal.fire({
                icon: 'success',
                title: 'Colors Saved',
                text: data.message,
                confirmButtonText: 'Refresh Now'
            }).then(() => {
                window.location.reload();
            });
        } else {
            Swal.fire('Error', data.message, 'error');
        }
    })
    .catch(error => {
        Swal.fire('Error', 'Failed to save colors', 'error');
        console.error(error);
    });
}

function resetColors() {
    Swal.fire({
        title: 'Reset Colors?',
        text: 'This will reset all colors to their default values.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, Reset',
        cancelButtonText: 'Cancel'
    }).then((result) => {
        if (result.isConfirmed) {
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;

            fetch('{{ url_for("admin_panel.reset_colors") }}', {
                method: 'POST',
                headers: { 'X-Csrftoken': csrfToken }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Colors Reset',
                        text: data.message,
                        confirmButtonText: 'Refresh Now'
                    }).then(() => {
                        window.location.reload();
                    });
                } else {
                    Swal.fire('Error', data.message, 'error');
                }
            });
        }
    });
}

function exportColors() {
    const colors = gatherColors();
    const json = JSON.stringify(colors, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ecs-theme-colors.json';
    a.click();
    URL.revokeObjectURL(url);
}

function showImportModal() {
    ModalManager.show('importModal');
}

function importColors() {
    try {
        const json = document.getElementById('importJson').value;
        const colors = JSON.parse(json);

        if (!colors.light || !colors.dark) {
            throw new Error('Invalid color structure');
        }

        const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;

        fetch('{{ url_for("admin_panel.import_colors") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Csrftoken': csrfToken
            },
            body: JSON.stringify({ colors: colors })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                bootstrap.Modal.getInstance(document.getElementById('importModal')).hide();
                Swal.fire({
                    icon: 'success',
                    title: 'Colors Imported',
                    text: data.message,
                    confirmButtonText: 'Refresh Now'
                }).then(() => {
                    window.location.reload();
                });
            } else {
                Swal.fire('Error', data.message, 'error');
            }
        });
    } catch (e) {
        Swal.fire('Error', 'Invalid JSON format', 'error');
    }
}
</script>
{% endif %}
{% endblock %}
