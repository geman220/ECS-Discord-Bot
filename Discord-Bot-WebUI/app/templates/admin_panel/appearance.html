{% extends "admin_panel/base.html" %}
{% import 'macros.html' as macros %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">System</li>
<li class="breadcrumb-item active">Appearance</li>
{% endblock %}

{% block panel_content %}
<div class="row">
    <div class="col-12">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h4 class="mb-1">
                    <i class="ti ti-palette me-2 text-primary"></i>Theme Customization
                </h4>
                <p class="text-muted mb-0">Customize colors for the Modern theme. Changes apply site-wide.</p>
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-outline-secondary" onclick="exportColors()">
                    <i class="ti ti-download me-1"></i>Export
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="showImportModal()">
                    <i class="ti ti-upload me-1"></i>Import
                </button>
                <button type="button" class="btn btn-outline-danger" onclick="resetColors()">
                    <i class="ti ti-refresh me-1"></i>Reset to Default
                </button>
            </div>
        </div>

        {% if has_custom_colors %}
        <div class="alert alert-info d-flex align-items-center mb-4">
            <i class="ti ti-info-circle me-2 fs-4"></i>
            <div>
                <strong>Custom colors are active.</strong>
                These colors override the default Modern theme palette.
            </div>
        </div>
        {% endif %}

        <!-- Live Preview Section - Full Width -->
        <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0"><i class="ti ti-eye me-2 text-primary"></i>Live Preview</h5>
                    <small class="text-muted">See your color changes in real-time for both modes</small>
                </div>
                <div class="btn-group btn-group-sm">
                    <button type="button" class="btn btn-outline-primary active" id="previewBothBtn" onclick="setPreviewMode('both')">Both</button>
                    <button type="button" class="btn btn-outline-primary" id="previewLightBtn" onclick="setPreviewMode('light')">Light Only</button>
                    <button type="button" class="btn btn-outline-primary" id="previewDarkBtn" onclick="setPreviewMode('dark')">Dark Only</button>
                </div>
            </div>
            <div class="card-body">
                <div class="row" id="previewContainer">
                    <!-- Light Mode Preview -->
                    <div class="col-md-6 mb-3 mb-md-0" id="lightPreviewCol">
                        <div class="border rounded">
                            <div class="px-3 py-2 border-bottom" style="background: #F4F4F5;">
                                <span class="badge bg-secondary">Light Mode</span>
                            </div>
                            <div id="light-preview-area" class="p-4" style="background: {{ colors.light.bg_body }}; min-height: 300px;">
                                <!-- Simulated Navbar -->
                                <div class="rounded mb-3 p-2 d-flex justify-content-between align-items-center preview-navbar" style="background: {{ colors.light.bg_card }}; border: 1px solid {{ colors.light.border }};">
                                    <span class="fw-bold preview-heading" style="color: {{ colors.light.text_heading }};">ECS Dashboard</span>
                                    <input type="text" class="form-control form-control-sm preview-input" style="width: 150px; background: {{ colors.light.bg_input }}; border-color: {{ colors.light.border_input }}; color: {{ colors.light.text_body }};" placeholder="Search...">
                                </div>

                                <!-- Simulated Card -->
                                <div class="rounded mb-3 preview-card" style="background: {{ colors.light.bg_card }}; border: 1px solid {{ colors.light.border }}; border-left: 4px solid {{ colors.light.primary }};">
                                    <div class="p-3">
                                        <h6 class="mb-2 preview-heading" style="color: {{ colors.light.text_heading }};">Card Title</h6>
                                        <p class="mb-2 small preview-body" style="color: {{ colors.light.text_body }};">
                                            This is body text showing <a href="#" class="preview-link" style="color: {{ colors.light.text_link }};">a sample link</a>.
                                        </p>
                                        <p class="mb-0 small preview-muted" style="color: {{ colors.light.text_muted }};">Muted caption text</p>
                                    </div>
                                </div>

                                <!-- Buttons -->
                                <div class="mb-3">
                                    <button class="btn btn-sm me-1 preview-btn-primary" style="background: {{ colors.light.primary }}; border-color: {{ colors.light.primary }}; color: white;">Primary</button>
                                    <button class="btn btn-sm me-1 preview-btn-secondary" style="background: {{ colors.light.secondary }}; border-color: {{ colors.light.secondary }}; color: white;">Secondary</button>
                                    <button class="btn btn-sm preview-btn-accent" style="background: {{ colors.light.accent }}; border-color: {{ colors.light.accent }}; color: #18181B;">Accent</button>
                                </div>

                                <!-- Status Badges -->
                                <div>
                                    <span class="badge me-1 preview-badge-success" style="background: {{ colors.light.success }}; color: white;">Success</span>
                                    <span class="badge me-1 preview-badge-warning" style="background: {{ colors.light.warning }}; color: #18181B;">Warning</span>
                                    <span class="badge me-1 preview-badge-danger" style="background: {{ colors.light.danger }}; color: white;">Danger</span>
                                    <span class="badge preview-badge-info" style="background: {{ colors.light.info }}; color: white;">Info</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dark Mode Preview -->
                    <div class="col-md-6" id="darkPreviewCol">
                        <div class="border rounded">
                            <div class="px-3 py-2 border-bottom" style="background: #27272A;">
                                <span class="badge" style="background: #3F3F46; color: #A1A1AA;">Dark Mode</span>
                            </div>
                            <div id="dark-preview-area" class="p-4" style="background: {{ colors.dark.bg_body }}; min-height: 300px;">
                                <!-- Simulated Navbar -->
                                <div class="rounded mb-3 p-2 d-flex justify-content-between align-items-center preview-navbar-dark" style="background: {{ colors.dark.bg_card }}; border: 1px solid {{ colors.dark.border }};">
                                    <span class="fw-bold preview-heading-dark" style="color: {{ colors.dark.text_heading }};">ECS Dashboard</span>
                                    <input type="text" class="form-control form-control-sm preview-input-dark" style="width: 150px; background: {{ colors.dark.bg_input }}; border-color: {{ colors.dark.border_input }}; color: {{ colors.dark.text_body }};" placeholder="Search...">
                                </div>

                                <!-- Simulated Card -->
                                <div class="rounded mb-3 preview-card-dark" style="background: {{ colors.dark.bg_card }}; border: 1px solid {{ colors.dark.border }}; border-left: 4px solid {{ colors.dark.primary }};">
                                    <div class="p-3">
                                        <h6 class="mb-2 preview-heading-dark" style="color: {{ colors.dark.text_heading }};">Card Title</h6>
                                        <p class="mb-2 small preview-body-dark" style="color: {{ colors.dark.text_body }};">
                                            This is body text showing <a href="#" class="preview-link-dark" style="color: {{ colors.dark.text_link }};">a sample link</a>.
                                        </p>
                                        <p class="mb-0 small preview-muted-dark" style="color: {{ colors.dark.text_muted }};">Muted caption text</p>
                                    </div>
                                </div>

                                <!-- Buttons -->
                                <div class="mb-3">
                                    <button class="btn btn-sm me-1 preview-btn-primary-dark" style="background: {{ colors.dark.primary }}; border-color: {{ colors.dark.primary }}; color: #09090B;">Primary</button>
                                    <button class="btn btn-sm me-1 preview-btn-secondary-dark" style="background: {{ colors.dark.secondary }}; border-color: {{ colors.dark.secondary }}; color: #09090B;">Secondary</button>
                                    <button class="btn btn-sm preview-btn-accent-dark" style="background: {{ colors.dark.accent }}; border-color: {{ colors.dark.accent }}; color: #09090B;">Accent</button>
                                </div>

                                <!-- Status Badges -->
                                <div>
                                    <span class="badge me-1 preview-badge-success-dark" style="background: {{ colors.dark.success }}; color: #09090B;">Success</span>
                                    <span class="badge me-1 preview-badge-warning-dark" style="background: {{ colors.dark.warning }}; color: #09090B;">Warning</span>
                                    <span class="badge me-1 preview-badge-danger-dark" style="background: {{ colors.dark.danger }}; color: #09090B;">Danger</span>
                                    <span class="badge preview-badge-info-dark" style="background: {{ colors.dark.info }}; color: #09090B;">Info</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Color Tabs -->
        <ul class="nav nav-tabs mb-4" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#light-mode" type="button">
                    <i class="ti ti-sun me-1"></i>Light Mode Colors
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#dark-mode" type="button">
                    <i class="ti ti-moon me-1"></i>Dark Mode Colors
                </button>
            </li>
        </ul>

        <div class="tab-content">
            <!-- LIGHT MODE COLORS -->
            <div class="tab-pane fade show active" id="light-mode">
                <div class="row">
                    <!-- Brand Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-brush me-2 text-primary"></i>Brand Colors</h6>
                                <small class="text-muted">Main identity colors used throughout the site</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Primary</span>
                                        <span class="text-muted small">Buttons, links, active states</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-primary" value="{{ colors.light.primary }}">
                                        <input type="text" class="form-control" id="light-primary-hex" value="{{ colors.light.primary }}" pattern="^#[0-9A-Fa-f]{6}$">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Primary Light</span>
                                        <span class="text-muted small">Hover states, highlights</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-primary_light" value="{{ colors.light.primary_light }}">
                                        <input type="text" class="form-control" id="light-primary_light-hex" value="{{ colors.light.primary_light }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Primary Dark</span>
                                        <span class="text-muted small">Pressed states, emphasis</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-primary_dark" value="{{ colors.light.primary_dark }}">
                                        <input type="text" class="form-control" id="light-primary_dark-hex" value="{{ colors.light.primary_dark }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Secondary</span>
                                        <span class="text-muted small">Secondary buttons, muted UI</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-secondary" value="{{ colors.light.secondary }}">
                                        <input type="text" class="form-control" id="light-secondary-hex" value="{{ colors.light.secondary }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Accent</span>
                                        <span class="text-muted small">CTAs, highlights, badges</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-accent" value="{{ colors.light.accent }}">
                                        <input type="text" class="form-control" id="light-accent-hex" value="{{ colors.light.accent }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Text Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-typography me-2 text-primary"></i>Text Colors</h6>
                                <small class="text-muted">Typography and content colors</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Heading Text</span>
                                        <span class="text-muted small">h1-h6, card titles</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-text_heading" value="{{ colors.light.text_heading }}">
                                        <input type="text" class="form-control" id="light-text_heading-hex" value="{{ colors.light.text_heading }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Body Text</span>
                                        <span class="text-muted small">Paragraphs, content</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-text_body" value="{{ colors.light.text_body }}">
                                        <input type="text" class="form-control" id="light-text_body-hex" value="{{ colors.light.text_body }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Muted Text</span>
                                        <span class="text-muted small">Captions, labels, hints</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-text_muted" value="{{ colors.light.text_muted }}">
                                        <input type="text" class="form-control" id="light-text_muted-hex" value="{{ colors.light.text_muted }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Link Color</span>
                                        <span class="text-muted small">Clickable text links</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-text_link" value="{{ colors.light.text_link }}">
                                        <input type="text" class="form-control" id="light-text_link-hex" value="{{ colors.light.text_link }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-traffic-lights me-2 text-primary"></i>Status Colors</h6>
                                <small class="text-muted">Alerts, badges, feedback states</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Success</span>
                                        <span class="text-muted small">Confirmations, completed</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-success" value="{{ colors.light.success }}">
                                        <input type="text" class="form-control" id="light-success-hex" value="{{ colors.light.success }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Warning</span>
                                        <span class="text-muted small">Cautions, pending states</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-warning" value="{{ colors.light.warning }}">
                                        <input type="text" class="form-control" id="light-warning-hex" value="{{ colors.light.warning }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Danger</span>
                                        <span class="text-muted small">Errors, destructive actions</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-danger" value="{{ colors.light.danger }}">
                                        <input type="text" class="form-control" id="light-danger-hex" value="{{ colors.light.danger }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Info</span>
                                        <span class="text-muted small">Information, tips</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-info" value="{{ colors.light.info }}">
                                        <input type="text" class="form-control" id="light-info-hex" value="{{ colors.light.info }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Background Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-layout me-2 text-primary"></i>Backgrounds</h6>
                                <small class="text-muted">Page and component backgrounds</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Page Background</span>
                                        <span class="text-muted small">Main body background</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-bg_body" value="{{ colors.light.bg_body }}">
                                        <input type="text" class="form-control" id="light-bg_body-hex" value="{{ colors.light.bg_body }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Card Background</span>
                                        <span class="text-muted small">Cards, modals, panels</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-bg_card" value="{{ colors.light.bg_card }}">
                                        <input type="text" class="form-control" id="light-bg_card-hex" value="{{ colors.light.bg_card }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Input Background</span>
                                        <span class="text-muted small">Form fields, inputs</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-bg_input" value="{{ colors.light.bg_input }}">
                                        <input type="text" class="form-control" id="light-bg_input-hex" value="{{ colors.light.bg_input }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Border Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-border-style me-2 text-primary"></i>Borders</h6>
                                <small class="text-muted">Separators and outlines</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Default Border</span>
                                        <span class="text-muted small">Card borders, dividers</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-border" value="{{ colors.light.border }}">
                                        <input type="text" class="form-control" id="light-border-hex" value="{{ colors.light.border }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Input Border</span>
                                        <span class="text-muted small">Form field borders</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="light-border_input" value="{{ colors.light.border_input }}">
                                        <input type="text" class="form-control" id="light-border_input-hex" value="{{ colors.light.border_input }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DARK MODE COLORS -->
            <div class="tab-pane fade" id="dark-mode">
                <div class="row">
                    <!-- Brand Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-brush me-2 text-primary"></i>Brand Colors</h6>
                                <small class="text-muted">Adjusted for dark mode visibility</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Primary</span>
                                        <span class="text-muted small">Brighter for dark backgrounds</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-primary" value="{{ colors.dark.primary }}">
                                        <input type="text" class="form-control" id="dark-primary-hex" value="{{ colors.dark.primary }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Primary Light</span>
                                        <span class="text-muted small">Hover states</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-primary_light" value="{{ colors.dark.primary_light }}">
                                        <input type="text" class="form-control" id="dark-primary_light-hex" value="{{ colors.dark.primary_light }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Primary Dark</span>
                                        <span class="text-muted small">Pressed states</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-primary_dark" value="{{ colors.dark.primary_dark }}">
                                        <input type="text" class="form-control" id="dark-primary_dark-hex" value="{{ colors.dark.primary_dark }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Secondary</span>
                                        <span class="text-muted small">Secondary UI elements</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-secondary" value="{{ colors.dark.secondary }}">
                                        <input type="text" class="form-control" id="dark-secondary-hex" value="{{ colors.dark.secondary }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Accent</span>
                                        <span class="text-muted small">CTAs, highlights</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-accent" value="{{ colors.dark.accent }}">
                                        <input type="text" class="form-control" id="dark-accent-hex" value="{{ colors.dark.accent }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Text Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-typography me-2 text-primary"></i>Text Colors</h6>
                                <small class="text-muted">Light text on dark backgrounds</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Heading Text</span>
                                        <span class="text-muted small">h1-h6, card titles</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-text_heading" value="{{ colors.dark.text_heading }}">
                                        <input type="text" class="form-control" id="dark-text_heading-hex" value="{{ colors.dark.text_heading }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Body Text</span>
                                        <span class="text-muted small">Paragraphs, content</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-text_body" value="{{ colors.dark.text_body }}">
                                        <input type="text" class="form-control" id="dark-text_body-hex" value="{{ colors.dark.text_body }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Muted Text</span>
                                        <span class="text-muted small">Captions, labels</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-text_muted" value="{{ colors.dark.text_muted }}">
                                        <input type="text" class="form-control" id="dark-text_muted-hex" value="{{ colors.dark.text_muted }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Link Color</span>
                                        <span class="text-muted small">Clickable text</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-text_link" value="{{ colors.dark.text_link }}">
                                        <input type="text" class="form-control" id="dark-text_link-hex" value="{{ colors.dark.text_link }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-traffic-lights me-2 text-primary"></i>Status Colors</h6>
                                <small class="text-muted">Brighter for dark backgrounds</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Success</span>
                                        <span class="text-muted small">Confirmations</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-success" value="{{ colors.dark.success }}">
                                        <input type="text" class="form-control" id="dark-success-hex" value="{{ colors.dark.success }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Warning</span>
                                        <span class="text-muted small">Cautions</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-warning" value="{{ colors.dark.warning }}">
                                        <input type="text" class="form-control" id="dark-warning-hex" value="{{ colors.dark.warning }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Danger</span>
                                        <span class="text-muted small">Errors</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-danger" value="{{ colors.dark.danger }}">
                                        <input type="text" class="form-control" id="dark-danger-hex" value="{{ colors.dark.danger }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Info</span>
                                        <span class="text-muted small">Information</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-info" value="{{ colors.dark.info }}">
                                        <input type="text" class="form-control" id="dark-info-hex" value="{{ colors.dark.info }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Background Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-layout me-2 text-primary"></i>Backgrounds</h6>
                                <small class="text-muted">Dark mode surface colors</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Page Background</span>
                                        <span class="text-muted small">Darkest layer</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-bg_body" value="{{ colors.dark.bg_body }}">
                                        <input type="text" class="form-control" id="dark-bg_body-hex" value="{{ colors.dark.bg_body }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Card Background</span>
                                        <span class="text-muted small">Elevated surfaces</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-bg_card" value="{{ colors.dark.bg_card }}">
                                        <input type="text" class="form-control" id="dark-bg_card-hex" value="{{ colors.dark.bg_card }}">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Input Background</span>
                                        <span class="text-muted small">Form fields</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-bg_input" value="{{ colors.dark.bg_input }}">
                                        <input type="text" class="form-control" id="dark-bg_input-hex" value="{{ colors.dark.bg_input }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Sidebar Background</span>
                                        <span class="text-muted small">Navigation panel</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-bg_sidebar" value="{{ colors.dark.bg_sidebar }}">
                                        <input type="text" class="form-control" id="dark-bg_sidebar-hex" value="{{ colors.dark.bg_sidebar }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Border Colors -->
                    <div class="col-md-6 col-xl-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="ti ti-border-style me-2 text-primary"></i>Borders</h6>
                                <small class="text-muted">Subtle separators for dark mode</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Default Border</span>
                                        <span class="text-muted small">Card borders, dividers</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-border" value="{{ colors.dark.border }}">
                                        <input type="text" class="form-control" id="dark-border-hex" value="{{ colors.dark.border }}">
                                    </div>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label d-flex justify-content-between">
                                        <span>Input Border</span>
                                        <span class="text-muted small">Form field borders</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="dark-border_input" value="{{ colors.dark.border_input }}">
                                        <input type="text" class="form-control" id="dark-border_input-hex" value="{{ colors.dark.border_input }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save Button -->
        <div class="d-flex justify-content-end mt-4">
            <button type="button" class="btn btn-primary btn-lg" onclick="saveColors()">
                <i class="ti ti-device-floppy me-2"></i>Save Changes
            </button>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="ti ti-upload me-2"></i>Import Color Scheme</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Paste JSON</label>
                    <textarea class="form-control" id="importJson" rows="10" placeholder='{"light": {...}, "dark": {...}}'></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="importColors()">Import</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
<script>
// Color field definitions
const lightColorFields = [
    'primary', 'primary_light', 'primary_dark', 'secondary', 'accent',
    'success', 'warning', 'danger', 'info',
    'text_heading', 'text_body', 'text_muted', 'text_link',
    'bg_body', 'bg_card', 'bg_input',
    'border', 'border_input'
];

const darkColorFields = [
    'primary', 'primary_light', 'primary_dark', 'secondary', 'accent',
    'success', 'warning', 'danger', 'info',
    'text_heading', 'text_body', 'text_muted', 'text_link',
    'bg_body', 'bg_card', 'bg_input', 'bg_sidebar',
    'border', 'border_input'
];

// Preview mode switching
function setPreviewMode(mode) {
    const lightCol = document.getElementById('lightPreviewCol');
    const darkCol = document.getElementById('darkPreviewCol');
    const bothBtn = document.getElementById('previewBothBtn');
    const lightBtn = document.getElementById('previewLightBtn');
    const darkBtn = document.getElementById('previewDarkBtn');

    [bothBtn, lightBtn, darkBtn].forEach(btn => btn.classList.remove('active'));

    if (mode === 'both') {
        lightCol.className = 'col-md-6 mb-3 mb-md-0';
        darkCol.className = 'col-md-6';
        lightCol.style.display = '';
        darkCol.style.display = '';
        bothBtn.classList.add('active');
    } else if (mode === 'light') {
        lightCol.className = 'col-12';
        lightCol.style.display = '';
        darkCol.style.display = 'none';
        lightBtn.classList.add('active');
    } else {
        darkCol.className = 'col-12';
        lightCol.style.display = 'none';
        darkCol.style.display = '';
        darkBtn.classList.add('active');
    }
}

// Sync color picker with hex input
document.querySelectorAll('input[type="color"]').forEach(picker => {
    const hexInput = document.getElementById(picker.id + '-hex');
    if (hexInput) {
        picker.addEventListener('input', () => {
            hexInput.value = picker.value;
            updatePreview();
        });
        hexInput.addEventListener('input', () => {
            if (/^#[0-9A-Fa-f]{6}$/.test(hexInput.value)) {
                picker.value = hexInput.value;
                updatePreview();
            }
        });
    }
});

function updatePreview() {
    // Light mode preview updates
    updateLightPreview();
    // Dark mode preview updates
    updateDarkPreview();
}

function updateLightPreview() {
    const area = document.getElementById('light-preview-area');
    if (!area) return;

    const getValue = (id) => document.getElementById(id)?.value;

    // Background
    area.style.background = getValue('light-bg_body') || '#FAFAFA';

    // Navbar
    const navbar = area.querySelector('.preview-navbar');
    if (navbar) {
        navbar.style.background = getValue('light-bg_card') || '#FFFFFF';
        navbar.style.borderColor = getValue('light-border') || '#E4E4E7';
    }

    // Navbar title
    const navTitle = area.querySelector('.preview-navbar .preview-heading');
    if (navTitle) navTitle.style.color = getValue('light-text_heading') || '#18181B';

    // Input
    const input = area.querySelector('.preview-input');
    if (input) {
        input.style.background = getValue('light-bg_input') || '#FFFFFF';
        input.style.borderColor = getValue('light-border_input') || '#D4D4D8';
        input.style.color = getValue('light-text_body') || '#52525B';
    }

    // Card
    const card = area.querySelector('.preview-card');
    if (card) {
        card.style.background = getValue('light-bg_card') || '#FFFFFF';
        card.style.borderColor = getValue('light-border') || '#E4E4E7';
        card.style.borderLeftColor = getValue('light-primary') || '#7C3AED';
    }

    // Text
    area.querySelectorAll('.preview-heading').forEach(el => {
        el.style.color = getValue('light-text_heading') || '#18181B';
    });
    area.querySelectorAll('.preview-body').forEach(el => {
        el.style.color = getValue('light-text_body') || '#52525B';
    });
    area.querySelectorAll('.preview-muted').forEach(el => {
        el.style.color = getValue('light-text_muted') || '#71717A';
    });
    area.querySelectorAll('.preview-link').forEach(el => {
        el.style.color = getValue('light-text_link') || '#7C3AED';
    });

    // Buttons
    const btnPrimary = area.querySelector('.preview-btn-primary');
    if (btnPrimary) {
        btnPrimary.style.background = getValue('light-primary') || '#7C3AED';
        btnPrimary.style.borderColor = getValue('light-primary') || '#7C3AED';
    }
    const btnSecondary = area.querySelector('.preview-btn-secondary');
    if (btnSecondary) {
        btnSecondary.style.background = getValue('light-secondary') || '#64748B';
        btnSecondary.style.borderColor = getValue('light-secondary') || '#64748B';
    }
    const btnAccent = area.querySelector('.preview-btn-accent');
    if (btnAccent) {
        btnAccent.style.background = getValue('light-accent') || '#F59E0B';
        btnAccent.style.borderColor = getValue('light-accent') || '#F59E0B';
    }

    // Badges
    const badgeSuccess = area.querySelector('.preview-badge-success');
    if (badgeSuccess) badgeSuccess.style.background = getValue('light-success') || '#10B981';
    const badgeWarning = area.querySelector('.preview-badge-warning');
    if (badgeWarning) badgeWarning.style.background = getValue('light-warning') || '#F59E0B';
    const badgeDanger = area.querySelector('.preview-badge-danger');
    if (badgeDanger) badgeDanger.style.background = getValue('light-danger') || '#EF4444';
    const badgeInfo = area.querySelector('.preview-badge-info');
    if (badgeInfo) badgeInfo.style.background = getValue('light-info') || '#3B82F6';
}

function updateDarkPreview() {
    const area = document.getElementById('dark-preview-area');
    if (!area) return;

    const getValue = (id) => document.getElementById(id)?.value;

    // Background
    area.style.background = getValue('dark-bg_body') || '#09090B';

    // Navbar
    const navbar = area.querySelector('.preview-navbar-dark');
    if (navbar) {
        navbar.style.background = getValue('dark-bg_card') || '#18181B';
        navbar.style.borderColor = getValue('dark-border') || '#3F3F46';
    }

    // Navbar title
    const navTitle = area.querySelector('.preview-heading-dark');
    if (navTitle) navTitle.style.color = getValue('dark-text_heading') || '#FAFAFA';

    // Input
    const input = area.querySelector('.preview-input-dark');
    if (input) {
        input.style.background = getValue('dark-bg_input') || '#27272A';
        input.style.borderColor = getValue('dark-border_input') || '#3F3F46';
        input.style.color = getValue('dark-text_body') || '#A1A1AA';
    }

    // Card
    const card = area.querySelector('.preview-card-dark');
    if (card) {
        card.style.background = getValue('dark-bg_card') || '#18181B';
        card.style.borderColor = getValue('dark-border') || '#3F3F46';
        card.style.borderLeftColor = getValue('dark-primary') || '#A78BFA';
    }

    // Text
    area.querySelectorAll('.preview-heading-dark').forEach(el => {
        el.style.color = getValue('dark-text_heading') || '#FAFAFA';
    });
    area.querySelectorAll('.preview-body-dark').forEach(el => {
        el.style.color = getValue('dark-text_body') || '#A1A1AA';
    });
    area.querySelectorAll('.preview-muted-dark').forEach(el => {
        el.style.color = getValue('dark-text_muted') || '#71717A';
    });
    area.querySelectorAll('.preview-link-dark').forEach(el => {
        el.style.color = getValue('dark-text_link') || '#A78BFA';
    });

    // Buttons
    const btnPrimary = area.querySelector('.preview-btn-primary-dark');
    if (btnPrimary) {
        btnPrimary.style.background = getValue('dark-primary') || '#A78BFA';
        btnPrimary.style.borderColor = getValue('dark-primary') || '#A78BFA';
    }
    const btnSecondary = area.querySelector('.preview-btn-secondary-dark');
    if (btnSecondary) {
        btnSecondary.style.background = getValue('dark-secondary') || '#94A3B8';
        btnSecondary.style.borderColor = getValue('dark-secondary') || '#94A3B8';
    }
    const btnAccent = area.querySelector('.preview-btn-accent-dark');
    if (btnAccent) {
        btnAccent.style.background = getValue('dark-accent') || '#FBBF24';
        btnAccent.style.borderColor = getValue('dark-accent') || '#FBBF24';
    }

    // Badges
    const badgeSuccess = area.querySelector('.preview-badge-success-dark');
    if (badgeSuccess) badgeSuccess.style.background = getValue('dark-success') || '#34D399';
    const badgeWarning = area.querySelector('.preview-badge-warning-dark');
    if (badgeWarning) badgeWarning.style.background = getValue('dark-warning') || '#FBBF24';
    const badgeDanger = area.querySelector('.preview-badge-danger-dark');
    if (badgeDanger) badgeDanger.style.background = getValue('dark-danger') || '#F87171';
    const badgeInfo = area.querySelector('.preview-badge-info-dark');
    if (badgeInfo) badgeInfo.style.background = getValue('dark-info') || '#60A5FA';
}

function gatherColors() {
    const colors = { light: {}, dark: {} };

    lightColorFields.forEach(field => {
        const el = document.getElementById(`light-${field}`);
        if (el) colors.light[field] = el.value;
    });

    darkColorFields.forEach(field => {
        const el = document.getElementById(`dark-${field}`);
        if (el) colors.dark[field] = el.value;
    });

    return colors;
}

function saveColors() {
    const colors = gatherColors();
    const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;

    fetch('{{ url_for("admin_panel.save_colors") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Csrftoken': csrfToken
        },
        body: JSON.stringify(colors)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            Swal.fire({
                icon: 'success',
                title: 'Colors Saved',
                text: data.message,
                confirmButtonText: 'Refresh Now'
            }).then(() => {
                window.location.reload();
            });
        } else {
            Swal.fire('Error', data.message, 'error');
        }
    })
    .catch(error => {
        Swal.fire('Error', 'Failed to save colors', 'error');
        console.error(error);
    });
}

function resetColors() {
    Swal.fire({
        title: 'Reset Colors?',
        text: 'This will reset all colors to their default values.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, Reset',
        cancelButtonText: 'Cancel'
    }).then((result) => {
        if (result.isConfirmed) {
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;

            fetch('{{ url_for("admin_panel.reset_colors") }}', {
                method: 'POST',
                headers: { 'X-Csrftoken': csrfToken }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Colors Reset',
                        text: data.message,
                        confirmButtonText: 'Refresh Now'
                    }).then(() => {
                        window.location.reload();
                    });
                } else {
                    Swal.fire('Error', data.message, 'error');
                }
            });
        }
    });
}

function exportColors() {
    const colors = gatherColors();
    const json = JSON.stringify(colors, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ecs-theme-colors.json';
    a.click();
    URL.revokeObjectURL(url);
}

function showImportModal() {
    new bootstrap.Modal(document.getElementById('importModal')).show();
}

function importColors() {
    try {
        const json = document.getElementById('importJson').value;
        const colors = JSON.parse(json);

        if (!colors.light || !colors.dark) {
            throw new Error('Invalid color structure');
        }

        const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;

        fetch('{{ url_for("admin_panel.import_colors") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Csrftoken': csrfToken
            },
            body: JSON.stringify({ colors: colors })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                bootstrap.Modal.getInstance(document.getElementById('importModal')).hide();
                Swal.fire({
                    icon: 'success',
                    title: 'Colors Imported',
                    text: data.message,
                    confirmButtonText: 'Refresh Now'
                }).then(() => {
                    window.location.reload();
                });
            } else {
                Swal.fire('Error', data.message, 'error');
            }
        });
    } catch (e) {
        Swal.fire('Error', 'Invalid JSON format', 'error');
    }
}
</script>
{% endblock %}
