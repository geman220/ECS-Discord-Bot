{% extends "admin_panel/base.html" %}

{% block title %}RSVP Status - Admin Panel{% endblock %}

{% block panel_description %}View and manage RSVP responses for matches{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{{ url_for('admin_panel.reports_dashboard') }}">Reports</a></li>
<li class="breadcrumb-item active">RSVP Status</li>
{% endblock %}

{% block panel_content %}
<div class="row" data-match-id="{% if is_ecs_fc_match %}ecs_{{ ecs_match.id }}{% elif match %}{{ match.id }}{% endif %}">
    <!-- Match Info -->
    <div class="col-12 mb-4">
        <div class="c-card">
            <div class="c-card__header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="ti ti-calendar-event me-2"></i>
                    {% if is_ecs_fc_match and ecs_match %}
                        ECS FC Match: {{ ecs_match.opponent }}
                    {% elif match %}
                        {{ match.home_team.name if match.home_team else 'TBD' }} vs {{ match.away_team.name if match.away_team else 'TBD' }}
                    {% else %}
                        Match RSVP Status
                    {% endif %}
                </h5>
                {% if is_ecs_fc_match %}
                <span class="badge bg-primary" data-badge>ECS FC</span>
                {% endif %}
            </div>
            <div class="c-card__body">
                <div class="row">
                    <div class="col-md-4">
                        <strong>Date:</strong>
                        {% if is_ecs_fc_match and ecs_match %}
                            {{ ecs_match.date.strftime('%b %d, %Y') if ecs_match.date else 'TBD' }}
                        {% elif match %}
                            {{ match.date.strftime('%b %d, %Y') if match.date else 'TBD' }}
                        {% endif %}
                    </div>
                    <div class="col-md-4">
                        <strong>Time:</strong>
                        {% if is_ecs_fc_match and ecs_match %}
                            {{ ecs_match.time or 'TBD' }}
                        {% elif match %}
                            {{ match.time.strftime('%I:%M %p') if match.time else 'TBD' }}
                        {% endif %}
                    </div>
                    <div class="col-md-4">
                        <strong>Location:</strong>
                        {% if is_ecs_fc_match and ecs_match %}
                            {{ ecs_match.location or 'TBD' }}
                        {% elif match %}
                            {{ match.location or match.field or 'TBD' }}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RSVP Summary -->
    <div class="col-md-4 col-sm-6 mb-4">
        <div class="c-card h-100 bg-success bg-opacity-10">
            <div class="c-card__body text-center">
                <i class="ti ti-check fs-1 text-success mb-2"></i>
                <h3 class="mb-0">{{ rsvps.yes|length if rsvps.yes else 0 }}</h3>
                <small class="text-muted">Yes / In</small>
            </div>
        </div>
    </div>
    <div class="col-md-4 col-sm-6 mb-4">
        <div class="c-card h-100 bg-danger bg-opacity-10">
            <div class="c-card__body text-center">
                <i class="ti ti-x fs-1 text-danger mb-2"></i>
                <h3 class="mb-0">{{ rsvps.no|length if rsvps.no else 0 }}</h3>
                <small class="text-muted">No / Out</small>
            </div>
        </div>
    </div>
    <div class="col-md-4 col-sm-6 mb-4">
        <div class="c-card h-100 bg-warning bg-opacity-10">
            <div class="c-card__body text-center">
                <i class="ti ti-question-mark fs-1 text-warning mb-2"></i>
                <h3 class="mb-0">{{ rsvps.maybe|length if rsvps.maybe else 0 }}</h3>
                <small class="text-muted">Maybe / Tentative</small>
            </div>
        </div>
    </div>

    <!-- RSVP Details -->
    <div class="col-12">
        <div class="c-card">
            <div class="c-card__header">
                <h5 class="mb-0"><i class="ti ti-list me-2"></i>RSVP Responses</h5>
            </div>
            <div class="c-card__body p-0">
                <ul class="nav nav-tabs px-3 pt-2" role="tablist" data-tabs>
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#yes-tab">
                            <i class="ti ti-check text-success me-1"></i>Yes ({{ rsvps.yes|length if rsvps.yes else 0 }})
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#no-tab">
                            <i class="ti ti-x text-danger me-1"></i>No ({{ rsvps.no|length if rsvps.no else 0 }})
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#maybe-tab">
                            <i class="ti ti-question-mark text-warning me-1"></i>Maybe ({{ rsvps.maybe|length if rsvps.maybe else 0 }})
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#no-response-tab">
                            <i class="ti ti-minus text-muted me-1"></i>No Response ({{ rsvps.no_response|length if rsvps.no_response else 0 }})
                        </a>
                    </li>
                </ul>
                <div class="tab-content p-3">
                    <!-- Yes Tab -->
                    <div class="tab-pane fade show active" id="yes-tab" data-tab-pane>
                        {% if rsvps.yes %}
                        <div class="c-table-wrapper" data-table-responsive>
                            <table class="c-table c-table--compact c-table--hoverable" data-table data-mobile-table data-table-type="rsvp">
                                <thead scope="col">
                                    <tr>
                                        <th scope="col">Player</th>
                                        <th scope="col">Responded</th>
                                        <th scope="col">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for rsvp in rsvps.yes %}
                                    <tr>
                                        <td>{{ rsvp.player.name if rsvp.player else 'Unknown' }}</td>
                                        <td><small class="text-muted">{{ rsvp.responded_at.strftime('%b %d, %I:%M %p') if rsvp.responded_at else '-' }}</small></td>
                                        <td>
                                            <button class="c-btn c-btn--sm c-btn--outline-secondary js-update-rsvp" data-action="update-rsvp" data-player-id="{{ rsvp.player.id }}" data-response="no">Change to No</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-muted text-center py-3">No "Yes" responses yet.</p>
                        {% endif %}
                    </div>

                    <!-- No Tab -->
                    <div class="tab-pane fade" id="no-tab" data-tab-pane>
                        {% if rsvps.no %}
                        <div class="c-table-wrapper" data-table-responsive>
                            <table class="c-table c-table--compact c-table--hoverable" data-table data-mobile-table data-table-type="rsvp">
                                <thead scope="col">
                                    <tr>
                                        <th scope="col">Player</th>
                                        <th scope="col">Responded</th>
                                        <th scope="col">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for rsvp in rsvps.no %}
                                    <tr>
                                        <td>{{ rsvp.player.name if rsvp.player else 'Unknown' }}</td>
                                        <td><small class="text-muted">{{ rsvp.responded_at.strftime('%b %d, %I:%M %p') if rsvp.responded_at else '-' }}</small></td>
                                        <td>
                                            <button class="c-btn c-btn--sm c-btn--outline-secondary js-update-rsvp" data-action="update-rsvp" data-player-id="{{ rsvp.player.id }}" data-response="yes">Change to Yes</button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-muted text-center py-3">No "No" responses.</p>
                        {% endif %}
                    </div>

                    <!-- Maybe Tab -->
                    <div class="tab-pane fade" id="maybe-tab" data-tab-pane>
                        {% if rsvps.maybe %}
                        <div class="c-table-wrapper" data-table-responsive>
                            <table class="c-table c-table--compact c-table--hoverable" data-table data-mobile-table data-table-type="rsvp">
                                <thead scope="col">
                                    <tr>
                                        <th scope="col">Player</th>
                                        <th scope="col">Responded</th>
                                        <th scope="col">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for rsvp in rsvps.maybe %}
                                    <tr>
                                        <td>{{ rsvp.player.name if rsvp.player else 'Unknown' }}</td>
                                        <td><small class="text-muted">{{ rsvp.responded_at.strftime('%b %d, %I:%M %p') if rsvp.responded_at else '-' }}</small></td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="c-btn c-btn--outline-success js-update-rsvp" data-action="update-rsvp" data-player-id="{{ rsvp.player.id }}" data-response="yes">Yes</button>
                                                <button class="c-btn c-btn--outline-danger js-update-rsvp" data-action="update-rsvp" data-player-id="{{ rsvp.player.id }}" data-response="no">No</button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-muted text-center py-3">No "Maybe" responses.</p>
                        {% endif %}
                    </div>

                    <!-- No Response Tab -->
                    <div class="tab-pane fade" id="no-response-tab" data-tab-pane>
                        {% if rsvps.no_response %}
                        <div class="c-table-wrapper" data-table-responsive>
                            <table class="c-table c-table--compact c-table--hoverable" data-table data-mobile-table data-table-type="rsvp">
                                <thead scope="col">
                                    <tr>
                                        <th scope="col">Player</th>
                                        <th scope="col">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for player in rsvps.no_response %}
                                    <tr>
                                        <td>{{ player.name if player else 'Unknown' }}</td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <button class="c-btn c-btn--outline-success js-update-rsvp" data-action="update-rsvp" data-player-id="{{ player.id }}" data-response="yes">Yes</button>
                                                <button class="c-btn c-btn--outline-danger js-update-rsvp" data-action="update-rsvp" data-player-id="{{ player.id }}" data-response="no">No</button>
                                                <button class="c-btn c-btn--outline-warning js-update-rsvp" data-action="update-rsvp" data-player-id="{{ player.id }}" data-response="maybe">Maybe</button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p class="text-muted text-center py-3">All players have responded!</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
{# RSVP actions now handled by EventDelegation via admin-reports-handlers.js #}
{# Match ID stored in data-match-id attribute on row container #}
{% endblock %}
