{% extends "admin_panel/base.html" %}
{% import 'macros.html' as macros %}

{% block title %}Mobile Features - Admin Panel{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">Mobile Features</li>
{% endblock %}

{% block panel_content %}

    <!-- Mobile Features Overview -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title text-white mb-1">{{ stats.total_app_installs or 0 }}</h5>
                            <p class="card-text small opacity-75 mb-0">App Installs</p>
                        </div>
                        <div class="card-icon">
                            <i class="ti ti-download" style="font-size: 2rem; opacity: 0.5;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title text-white mb-1">{{ stats.mobile_users or 0 }}</h5>
                            <p class="card-text small opacity-75 mb-0">Mobile Users</p>
                        </div>
                        <div class="card-icon">
                            <i class="ti ti-device-mobile" style="font-size: 2rem; opacity: 0.5;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title text-white mb-1">{{ stats.push_subscriptions or 0 }}</h5>
                            <p class="card-text small opacity-75 mb-0">Push Subscriptions</p>
                        </div>
                        <div class="card-icon">
                            <i class="ti ti-bell" style="font-size: 2rem; opacity: 0.5;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title text-white mb-1">{{ stats.app_downloads or 0 }}</h5>
                            <p class="card-text small opacity-75 mb-0">App Downloads</p>
                        </div>
                        <div class="card-icon">
                            <i class="ti ti-download" style="font-size: 2rem; opacity: 0.5;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile User & App Management -->
    <div class="row mb-4">
        <!-- Mobile User Management -->
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="ti ti-users me-2"></i>Mobile User Management
                    </h5>
                </div>
                <div class="card-body">
                    <p>Manage users with mobile app access and their roles</p>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('admin_panel.mobile_user_management') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-user-cog me-2"></i>Manage Mobile Users
                                </div>
                                <span class="badge bg-primary">{{ stats.mobile_users or 0 }}</span>
                            </div>
                        </a>
                        <a href="{{ url_for('admin_panel.user_management') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-users-group me-2"></i>All User Management
                                </div>
                            </div>
                        </a>
                        <a href="{{ url_for('admin_panel.mobile_users') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-device-mobile me-2"></i>View Mobile Users
                                </div>
                                <span class="badge bg-success">{{ stats.active_mobile_users or 0 }}</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile App Settings -->
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="ti ti-device-mobile me-2"></i>Mobile App Settings
                    </h5>
                </div>
                <div class="card-body">
                    <p>Configure mobile app features and functionality</p>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('admin_panel.mobile_config') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-settings-cog me-2"></i>App Configuration
                                </div>
                                <i class="ti ti-chevron-right"></i>
                            </div>
                        </a>
                        <a href="{{ url_for('admin_panel.mobile_app_distribution') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-app-window me-2"></i>App Distribution
                                </div>
                                <i class="ti ti-chevron-right"></i>
                            </div>
                        </a>
                        <a href="{{ url_for('admin_panel.mobile_features_toggle') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-toggle-left me-2"></i>Feature Toggles
                                </div>
                                <i class="ti ti-chevron-right"></i>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Push Notifications & Analytics -->
    <div class="row">
        <!-- Push Notification Management -->
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="ti ti-bell me-2"></i>Push Notifications
                    </h5>
                </div>
                <div class="card-body">
                    <p>Manage mobile push notification campaigns</p>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('admin_panel.push_notifications') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-send me-2"></i>Send Notification
                                </div>
                                <i class="ti ti-chevron-right"></i>
                            </div>
                        </a>
                        <a href="{{ url_for('admin_panel.notification_groups_list') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-users-group me-2"></i>Notification Groups
                                </div>
                                <i class="ti ti-chevron-right"></i>
                            </div>
                        </a>
                        <a href="{{ url_for('admin_panel.campaigns_list') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-broadcast me-2"></i>Push Campaigns
                                </div>
                                <i class="ti ti-chevron-right"></i>
                            </div>
                        </a>
                        <a href="{{ url_for('admin_panel.push_subscriptions') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-users me-2"></i>Subscriptions
                                </div>
                                <span class="badge bg-warning">{{ stats.push_subscriptions or 0 }}</span>
                            </div>
                        </a>
                        <a href="{{ url_for('admin_panel.push_history') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-history me-2"></i>Notification History
                                </div>
                                <i class="ti ti-chevron-right"></i>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Analytics -->
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="ti ti-chart-line me-2"></i>Mobile Analytics
                    </h5>
                </div>
                <div class="card-body">
                    <p>Track mobile app performance and user engagement</p>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('admin_panel.mobile_analytics') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-chart-dots me-2"></i>Usage Analytics
                                </div>
                                <i class="ti ti-chevron-right"></i>
                            </div>
                        </a>
                        <a href="{{ url_for('admin_panel.mobile_app_analytics') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-chart-bar me-2"></i>App Analytics
                                </div>
                                <i class="ti ti-chevron-right"></i>
                            </div>
                        </a>
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-download me-2"></i>App Downloads
                                </div>
                                <span class="badge bg-info">{{ stats.app_downloads or 0 }}</span>
                            </div>
                        </div>
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="ti ti-users me-2"></i>Active Mobile Users
                                </div>
                                <span class="badge bg-success">{{ stats.active_mobile_users or 0 }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Status & Configuration -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="ti ti-device-mobile me-2"></i>Mobile Platform Status
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center p-3 border-end">
                                <div class="h4 mb-1 text-{% if stats.mobile_service_status == 'active' %}success{% else %}danger{% endif %}">
                                    {% if stats.mobile_service_status == 'active' %}Online{% else %}Offline{% endif %}
                                </div>
                                <div class="text-muted small">Mobile Service</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 border-end">
                                <div class="h4 mb-1 text-{% if stats.push_service_status == 'active' %}success{% else %}danger{% endif %}">
                                    {% if stats.push_service_status == 'active' %}Active{% else %}Inactive{% endif %}
                                </div>
                                <div class="text-muted small">Push Service</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3 border-end">
                                <div class="h4 mb-1 text-info">{{ stats.mobile_app_version or 'v1.0.0' }}</div>
                                <div class="text-muted small">App Version</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center p-3">
                                <div class="h4 mb-1 text-primary">{{ stats.last_updated or 'Recently' }}</div>
                                <div class="text-muted small">Last Updated</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Information Alert -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-info border-0" style="background: linear-gradient(135deg, rgba(0, 123, 255, 0.1) 0%, rgba(0, 123, 255, 0.05) 100%);">
                <h6 class="alert-heading mb-2"><i class="ti ti-info-circle me-2"></i>Mobile App Status Information</h6>
                <p class="mb-2 small">
                    <strong>Mobile Service Status</strong> reflects whether the mobile app is configured and enabled in Admin Settings.
                    <strong>Push Service Status</strong> shows if push notifications are enabled.
                </p>
                <div class="row small">
                    <div class="col-md-4">
                        <strong>If "Offline":</strong>
                        <ul class="mb-0 ps-3">
                            <li>Check Admin Config for <code>mobile_app_enabled</code></li>
                            <li>Verify API endpoints are accessible</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <strong>If "Inactive":</strong>
                        <ul class="mb-0 ps-3">
                            <li>Enable <code>push_notifications_enabled</code></li>
                            <li>Configure Firebase/APNS keys</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <strong>Mobile App (In Development):</strong>
                        <ul class="mb-0 ps-3">
                            <li>iOS &amp; Android apps in progress</li>
                            <li>Contact tech team for API docs</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile API Documentation Link -->
    <div class="row mt-3">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="ti ti-api me-2"></i>Mobile API Documentation
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">
                        The following API endpoints are available for mobile app integration. Share this with the mobile development team.
                    </p>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Endpoint</th>
                                    <th>Method</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>/api/mobile/auth/login</code></td>
                                    <td><span class="badge bg-success">POST</span></td>
                                    <td>User authentication</td>
                                </tr>
                                <tr>
                                    <td><code>/api/mobile/user/profile</code></td>
                                    <td><span class="badge bg-primary">GET</span></td>
                                    <td>Get user profile data</td>
                                </tr>
                                <tr>
                                    <td><code>/api/mobile/matches</code></td>
                                    <td><span class="badge bg-primary">GET</span></td>
                                    <td>Get matches for user's team</td>
                                </tr>
                                <tr>
                                    <td><code>/api/mobile/push/register</code></td>
                                    <td><span class="badge bg-success">POST</span></td>
                                    <td>Register device for push notifications</td>
                                </tr>
                                <tr>
                                    <td><code>/api/mobile/notifications</code></td>
                                    <td><span class="badge bg-primary">GET</span></td>
                                    <td>Get user notifications</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="text-muted small mb-0 mt-2">
                        <i class="ti ti-info-circle me-1"></i>
                        Full API documentation available at <code>/api/docs</code> (if enabled) or contact tech support for Swagger/OpenAPI spec.
                    </p>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block custom_css %}
{{ super() }}
<style>
{# Shared component styles (card-icon, status-indicator, list-group dark mode) are in foundation-overrides.css #}

/* Page-specific: Mobile responsive border adjustments */
@media (max-width: 768px) {
    .border-end {
        border-right: none !important;
        border-bottom: 1px solid var(--bs-border-color) !important;
    }
}
</style>
{% endblock %}