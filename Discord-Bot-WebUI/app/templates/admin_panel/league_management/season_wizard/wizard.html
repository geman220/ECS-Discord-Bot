{% extends "admin_panel/base.html" %}

{% block panel_description %}Create a new season with teams, schedules, and Discord integration{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{{ url_for('admin_panel.league_management_dashboard') }}">League Management</a></li>
<li class="breadcrumb-item active">Season Wizard</li>
{% endblock %}

{% block custom_css %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/admin/season-wizard.css') }}">
{% endif %}
{% endblock %}

{% block panel_content %}
<div class="c-season-wizard-page">
<div class="row">
    <div class="col-12">
        <!-- Current Step Info Card -->
        <div class="c-wizard__info">
            <i class="ti ti-wand c-wizard__info-icon" id="stepIcon"></i>
            <div class="c-wizard__info-content">
                <h6 class="c-wizard__info-title" id="stepTitle">Step 1 of 5: Basic Information</h6>
                <p class="c-wizard__info-description" id="stepDescription">Select the league type and name your season</p>
            </div>
        </div>

        <div class="c-wizard">
            <!-- Progress Steps -->
            <ul class="c-wizard__steps">
                <li class="c-wizard__step c-wizard__step--active" data-step="0" id="wizardStep0">
                    <div class="c-wizard__step-trigger js-goto-step" data-action="goto-step" data-step="0">
                        <div class="c-wizard__step-circle">
                            <i class="ti ti-file-description"></i>
                        </div>
                        <div class="c-wizard__step-text">Basic Info</div>
                        <div class="c-wizard__step-tooltip">Step 1: Season type & name</div>
                    </div>
                </li>

                <li class="c-wizard__step c-wizard__step--pending" data-step="1" id="wizardStep1">
                    <div class="c-wizard__step-trigger js-goto-step" data-action="goto-step" data-step="1">
                        <div class="c-wizard__step-circle">
                            <i class="ti ti-users-group"></i>
                        </div>
                        <div class="c-wizard__step-text">Teams</div>
                        <div class="c-wizard__step-tooltip">Step 2: Configure teams</div>
                    </div>
                </li>

                <li class="c-wizard__step c-wizard__step--pending" data-step="2" id="wizardStep2">
                    <div class="c-wizard__step-trigger js-goto-step" data-action="goto-step" data-step="2">
                        <div class="c-wizard__step-circle">
                            <i class="ti ti-calendar-event"></i>
                        </div>
                        <div class="c-wizard__step-text">Schedule</div>
                        <div class="c-wizard__step-tooltip">Step 3: Weeks & dates</div>
                    </div>
                </li>

                <li class="c-wizard__step c-wizard__step--pending" data-step="3" id="wizardStep3">
                    <div class="c-wizard__step-trigger js-goto-step" data-action="goto-step" data-step="3">
                        <div class="c-wizard__step-circle">
                            <i class="ti ti-brand-discord"></i>
                        </div>
                        <div class="c-wizard__step-text">Discord</div>
                        <div class="c-wizard__step-tooltip">Step 4: Preview resources</div>
                    </div>
                </li>

                <li class="c-wizard__step c-wizard__step--pending" data-step="4" id="wizardStep4">
                    <div class="c-wizard__step-trigger js-goto-step" data-action="goto-step" data-step="4">
                        <div class="c-wizard__step-circle">
                            <i class="ti ti-check"></i>
                        </div>
                        <div class="c-wizard__step-text">Review</div>
                        <div class="c-wizard__step-tooltip">Step 5: Confirm & create</div>
                    </div>
                </li>
            </ul>

            <!-- Step Content -->
            <div class="c-wizard__content">
                <form id="seasonWizardForm">
                    <!-- Step 1: Basic Info -->
                    <div class="c-wizard__panel c-wizard__panel--active" id="step-0">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">League Type <span class="text-danger">*</span></label>
                                <div class="d-flex gap-3">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="league_type" id="typePubLeague" value="Pub League" checked>
                                        <label class="form-check-label" for="typePubLeague">
                                            <i class="ti ti-trophy text-warning me-1"></i>Pub League
                                        </label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="league_type" id="typeEcsFc" value="ECS FC">
                                        <label class="form-check-label" for="typeEcsFc">
                                            <i class="ti ti-ball-football text-primary me-1"></i>ECS FC
                                        </label>
                                    </div>
                                </div>
                                <small class="text-muted">Pub League includes Premier & Classic divisions</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="seasonName">Season Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="seasonName" name="season_name"
                                       placeholder="e.g., Spring 2025" required data-form-control>
                                <small class="text-muted">A unique name for this season</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="startDate">Season Start Date</label>
                                <input type="date" class="form-control" id="startDate" name="start_date" data-form-control>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mt-4">
                                    <input class="form-check-input" type="checkbox" id="setAsCurrent" name="set_as_current">
                                    <label class="form-check-label" for="setAsCurrent">
                                        Set as current season
                                    </label>
                                    <small class="text-muted d-block">This will trigger a rollover from the existing current season</small>
                                </div>
                            </div>
                        </div>

                        <!-- Rollover Warning -->
                        <div id="rolloverWarning" class="alert alert-warning mt-3 u-hidden" data-alert>
                            <i class="ti ti-alert-triangle me-2"></i>
                            <strong>Rollover Warning:</strong> Setting this as current will:
                            <ul class="mb-0 mt-2">
                                <li>Mark the existing current season as inactive</li>
                                <li>Record player team history from the old season</li>
                                <li>Clear team assignments for players</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Step 2: Teams -->
                    <div class="c-wizard__panel" id="step-1">
                        <!-- Pub League Teams -->
                        <div id="pubLeagueTeams">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="c-card border h-100">
                                        <div class="c-card__header bg-warning bg-opacity-10">
                                            <h6 class="mb-0"><i class="ti ti-crown me-1"></i>Premier Division</h6>
                                        </div>
                                        <div class="c-card__body">
                                            <label class="form-label">Number of Teams</label>
                                            <input type="number" class="form-control" id="premierTeamCount"
                                                   name="premier_team_count" value="8" min="2" max="16" data-form-control>
                                            <small class="text-muted">Typically 8 teams for round-robin</small>

                                            <div class="mt-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="premierCustomNames">
                                                    <label class="form-check-label" for="premierCustomNames">
                                                        Use custom team names
                                                    </label>
                                                </div>
                                            </div>
                                            <div id="premierCustomNamesDiv" class="mt-2 u-hidden">
                                                <textarea class="form-control" id="premierTeamNames" rows="4"
                                                          placeholder="Enter one team name per line" data-form-control></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="c-card border h-100">
                                        <div class="c-card__header bg-info bg-opacity-10">
                                            <h6 class="mb-0"><i class="ti ti-users me-1"></i>Classic Division</h6>
                                        </div>
                                        <div class="c-card__body">
                                            <label class="form-label">Number of Teams</label>
                                            <input type="number" class="form-control" id="classicTeamCount"
                                                   name="classic_team_count" value="4" min="2" max="16" data-form-control>
                                            <small class="text-muted">Typically 4 teams</small>

                                            <div class="mt-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="classicCustomNames">
                                                    <label class="form-check-label" for="classicCustomNames">
                                                        Use custom team names
                                                    </label>
                                                </div>
                                            </div>
                                            <div id="classicCustomNamesDiv" class="mt-2 u-hidden">
                                                <textarea class="form-control" id="classicTeamNames" rows="4"
                                                          placeholder="Enter one team name per line" data-form-control></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ECS FC Teams -->
                        <div id="ecsFcTeams" class="u-hidden">
                            <div class="c-card border">
                                <div class="c-card__header bg-primary bg-opacity-10">
                                    <h6 class="mb-0"><i class="ti ti-ball-football me-1"></i>ECS FC Teams</h6>
                                </div>
                                <div class="c-card__body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">Number of Teams</label>
                                            <input type="number" class="form-control" id="ecsFcTeamCount"
                                                   name="team_count" value="8" min="2" max="16" data-form-control>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="ecsFcCustomNames">
                                            <label class="form-check-label" for="ecsFcCustomNames">
                                                Use custom team names
                                            </label>
                                        </div>
                                    </div>
                                    <div id="ecsFcCustomNamesDiv" class="mt-2 u-hidden">
                                        <textarea class="form-control" id="ecsFcTeamNames" rows="4"
                                                  placeholder="Enter one team name per line" data-form-control></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Skip Team Creation Option -->
                        <div class="mt-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="skipTeamCreation" name="skip_team_creation">
                                <label class="form-check-label" for="skipTeamCreation">
                                    Skip team creation (create teams manually later)
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Schedule -->
                    <div class="c-wizard__panel" id="step-2">
                        <div class="alert alert-info" data-alert>
                            <i class="ti ti-info-circle me-2"></i>
                            Detailed schedule configuration can be done via the
                            <a href="{{ url_for('auto_schedule.schedule_manager') }}">Auto Schedule</a>
                            system after season creation.
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Regular Season Weeks</label>
                                <input type="number" class="form-control" id="regularWeeks"
                                       name="regular_weeks" value="7" min="1" max="20" data-form-control>
                                <small class="text-muted">Number of regular season weeks</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Playoff Weeks</label>
                                <input type="number" class="form-control" id="playoffWeeks"
                                       name="playoff_weeks" value="2" min="0" max="6" data-form-control>
                                <small class="text-muted">Number of playoff weeks</small>
                            </div>
                        </div>

                        <!-- Special Weeks (Pub League Only) -->
                        <div id="specialWeeksSection" class="mt-4">
                            <h6>Special Weeks (Pub League)</h6>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="hasFunWeek" name="has_fun_week">
                                        <label class="form-check-label" for="hasFunWeek">
                                            Include Fun Week
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="hasTstWeek" name="has_tst_week">
                                        <label class="form-check-label" for="hasTstWeek">
                                            Include TST Week
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="hasBonusWeek" name="has_bonus_week">
                                        <label class="form-check-label" for="hasBonusWeek">
                                            Include Bonus Week
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Discord Preview -->
                    <div class="c-wizard__panel" id="step-3">
                        <div id="discordPreviewLoading" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status" data-spinner>
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-muted">Generating preview...</p>
                        </div>

                        <div id="discordPreviewContent" class="u-hidden">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="c-card border h-100">
                                        <div class="c-card__header">
                                            <h6 class="mb-0"><i class="ti ti-folder me-1"></i>Categories</h6>
                                        </div>
                                        <div class="c-card__body">
                                            <ul id="previewCategories" class="list-unstyled mb-0"></ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="c-card border h-100">
                                        <div class="c-card__header">
                                            <h6 class="mb-0"><i class="ti ti-message me-1"></i>Channels</h6>
                                        </div>
                                        <div class="c-card__body u-max-h-300 u-overflow-y-auto">
                                            <ul id="previewChannels" class="list-unstyled mb-0"></ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="c-card border h-100">
                                        <div class="c-card__header">
                                            <h6 class="mb-0"><i class="ti ti-shield me-1"></i>Roles</h6>
                                        </div>
                                        <div class="c-card__body u-max-h-300 u-overflow-y-auto">
                                            <ul id="previewRoles" class="list-unstyled mb-0"></ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-info mt-3" data-alert>
                                <i class="ti ti-info-circle me-2"></i>
                                Estimated Discord API calls: <strong id="estimatedApiCalls">0</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Review -->
                    <div class="c-wizard__panel" id="step-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="c-card border">
                                    <div class="c-card__body">
                                        <h6><i class="ti ti-file-description me-1"></i>Basic Info</h6>
                                        <table class="c-table c-table--compact mb-0" data-table data-mobile-table data-table-type="schedule">
                                            <tr>
                                                <td class="text-muted">League Type:</td>
                                                <td id="reviewLeagueType"></td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Season Name:</td>
                                                <td id="reviewSeasonName"></td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Start Date:</td>
                                                <td id="reviewStartDate"></td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Set as Current:</td>
                                                <td id="reviewSetAsCurrent"></td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="c-card border">
                                    <div class="c-card__body">
                                        <h6><i class="ti ti-users-group me-1"></i>Teams</h6>
                                        <div id="reviewTeams"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="c-card border">
                                    <div class="c-card__body">
                                        <h6><i class="ti ti-calendar me-1"></i>Schedule</h6>
                                        <table class="c-table c-table--compact mb-0" data-table data-mobile-table data-table-type="schedule">
                                            <tr>
                                                <td class="text-muted">Regular Weeks:</td>
                                                <td id="reviewRegularWeeks"></td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Playoff Weeks:</td>
                                                <td id="reviewPlayoffWeeks"></td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Navigation -->
            <div class="c-wizard__navigation">
                <div>
                    <button type="button" class="c-btn c-btn--secondary js-wizard-prev u-hidden" id="prevBtn" data-action="wizard-prev">
                        <i class="ti ti-arrow-left me-1"></i> Previous
                    </button>
                </div>
                <div>
                    <button type="button" class="c-btn c-btn--primary js-wizard-next" id="nextBtn" data-action="wizard-next">
                        Next <i class="ti ti-arrow-right ms-1"></i>
                    </button>
                    <button type="button" class="c-btn c-btn--success js-create-season u-hidden" id="createBtn" data-action="create-season">
                        <i class="ti ti-check me-1"></i> Create Season
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
</div><!-- /.c-season-wizard-page -->
{% endblock %}

{% block custom_js %}
{{ super() }}
<script>
// Wizard configuration
window.WIZARD_CONFIG = {
    previewDiscordUrl: '{{ url_for("admin_panel.wizard_preview_discord") }}',
    createSeasonUrl: '{{ url_for("admin_panel.wizard_create_season") }}',
    dashboardUrl: '{{ url_for("admin_panel.league_management_dashboard") }}'
};
</script>
{% endblock %}
