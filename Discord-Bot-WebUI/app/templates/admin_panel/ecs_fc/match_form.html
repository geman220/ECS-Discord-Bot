{% extends "admin_panel/base.html" %}

{% block title %}{% if match %}Edit Match{% else %}Create Match{% endif %} - ECS FC{% endblock %}

{% block panel_description %}{% if match %}Edit existing match{% else %}Create a new ECS FC match{% endif %}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{{ url_for('admin_panel.ecs_fc_dashboard') }}">ECS FC Hub</a></li>
<li class="breadcrumb-item active">{% if match %}Edit Match{% else %}Create Match{% endif %}</li>
{% endblock %}

{% block panel_content %}
<div class="row">
    <div class="col-lg-8 col-md-10 mx-auto">
        <div class="c-card">
            <div class="c-card__header">
                <h5 class="mb-0">
                    <i class="ti ti-{% if match %}edit{% else %}plus{% endif %} me-2"></i>
                    {% if match %}Edit Match{% else %}Create New Match{% endif %}
                </h5>
            </div>
            <div class="c-card__body">
                <form method="post" id="matchForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    <!-- Team Selection -->
                    <div class="mb-4">
                        <label for="team_id" class="c-form-label">Team <span class="text-danger">*</span></label>
                        <select name="team_id" id="team_id" class="c-form-control" required {% if match %}disabled{% endif %}>
                            <option value="">Select Team...</option>
                            {% for team in teams %}
                            <option value="{{ team.id }}"
                                    {% if (match and match.team_id == team.id) or (preselect_team_id == team.id) %}selected{% endif %}>
                                {{ team.name }}
                            </option>
                            {% endfor %}
                        </select>
                        {% if match %}
                        <input type="hidden" name="team_id" value="{{ match.team_id }}">
                        {% endif %}
                    </div>

                    <!-- Opponent Selection -->
                    <div class="mb-4">
                        <label class="c-form-label">Opponent <span class="text-danger">*</span></label>
                        <div class="btn-group w-100 mb-3" role="group">
                            <input type="radio" class="btn-check" name="opponent_source" id="oppLibrary"
                                   value="library" {% if not match or match.external_opponent_id %}checked{% endif %}
                                   data-action="toggle-opponent-source" data-source="library">
                            <label class="c-btn c-btn--outline-primary" for="oppLibrary">
                                <i class="ti ti-books me-1"></i>From Library
                            </label>

                            <input type="radio" class="btn-check" name="opponent_source" id="oppCustom"
                                   value="custom" {% if match and not match.external_opponent_id %}checked{% endif %}
                                   data-action="toggle-opponent-source" data-source="custom">
                            <label class="c-btn c-btn--outline-primary" for="oppCustom">
                                <i class="ti ti-pencil me-1"></i>Custom Entry
                            </label>
                        </div>

                        <!-- Library dropdown -->
                        <div id="librarySelect" class="{% if match and not match.external_opponent_id %}is-hidden{% endif %}">
                            <div class="input-group">
                                <select name="external_opponent_id" id="external_opponent_id" class="c-form-control">
                                    <option value="">Select Opponent...</option>
                                    {% for opp in opponents %}
                                    <option value="{{ opp.id }}"
                                            {% if match and match.external_opponent_id == opp.id %}selected{% endif %}>
                                        {{ opp.name }}{% if opp.league_affiliation %} ({{ opp.league_affiliation }}){% endif %}
                                    </option>
                                    {% endfor %}
                                </select>
                                <a href="{{ url_for('admin_panel.ecs_fc_opponents') }}" class="c-btn c-btn--outline-secondary" target="_blank" aria-label="Add"><i class="ti ti-plus"></i></a>
                            </div>
                        </div>

                        <!-- Custom input -->
                        <div id="customInput" class="{% if not match or match.external_opponent_id %}is-hidden{% endif %}">
                            <input type="text" name="opponent_name" id="opponent_name" class="c-form-control"
                                   placeholder="e.g., Seattle United O50"
                                   value="{% if match and not match.external_opponent_id %}{{ match.opponent_name }}{% endif %}">
                        </div>
                    </div>

                    <div class="row">
                        <!-- Date -->
                        <div class="col-md-6 mb-4">
                            <label for="match_date" class="c-form-label">Date <span class="text-danger">*</span></label>
                            <input type="date" name="match_date" id="match_date" class="c-form-control" required
                                   value="{% if match %}{{ match.match_date.strftime('%Y-%m-%d') }}{% endif %}">
                        </div>

                        <!-- Time -->
                        <div class="col-md-6 mb-4">
                            <label for="match_time" class="c-form-label">Time <span class="text-danger">*</span></label>
                            <input type="time" name="match_time" id="match_time" class="c-form-control" required
                                   value="{% if match %}{{ match.match_time.strftime('%H:%M') }}{% else %}19:00{% endif %}">
                        </div>
                    </div>

                    <div class="row">
                        <!-- Location -->
                        <div class="col-md-8 mb-4">
                            <label for="location" class="c-form-label">Location <span class="text-danger">*</span></label>
                            <input type="text" name="location" id="location" class="c-form-control" required
                                   placeholder="e.g., Memorial Stadium"
                                   value="{% if match %}{{ match.location }}{% endif %}">
                        </div>

                        <!-- Field Name -->
                        <div class="col-md-4 mb-4">
                            <label for="field_name" class="c-form-label">Field Name</label>
                            <input type="text" name="field_name" id="field_name" class="c-form-control"
                                   placeholder="e.g., Field A"
                                   value="{% if match %}{{ match.field_name }}{% endif %}">
                        </div>
                    </div>

                    <div class="row">
                        <!-- Home/Away -->
                        <div class="col-md-6 mb-4">
                            <label class="c-form-label">Home/Away <span class="text-danger">*</span></label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="is_home_match" id="isHome"
                                       value="true" {% if not match or match.is_home_match %}checked{% endif %}>
                                <label class="c-btn c-btn--outline-success" for="isHome">
                                    <i class="ti ti-home me-1"></i>Home
                                </label>

                                <input type="radio" class="btn-check" name="is_home_match" id="isAway"
                                       value="false" {% if match and not match.is_home_match %}checked{% endif %}>
                                <label class="c-btn c-btn--outline-secondary" for="isAway">
                                    <i class="ti ti-map-pin me-1"></i>Away
                                </label>
                            </div>
                        </div>

                        <!-- RSVP Deadline -->
                        <div class="col-md-6 mb-4">
                            <label for="rsvp_deadline" class="c-form-label">RSVP Deadline</label>
                            <input type="datetime-local" name="rsvp_deadline" id="rsvp_deadline" class="c-form-control"
                                   value="{% if match and match.rsvp_deadline %}{{ match.rsvp_deadline.strftime('%Y-%m-%dT%H:%M') }}{% endif %}">
                        </div>
                    </div>

                    {% if match %}
                    <!-- Status (edit only) -->
                    <div class="mb-4">
                        <label for="status" class="c-form-label">Status</label>
                        <select name="status" id="status" class="c-form-control">
                            <option value="SCHEDULED" {% if match.status == 'SCHEDULED' %}selected{% endif %}>Scheduled</option>
                            <option value="IN_PROGRESS" {% if match.status == 'IN_PROGRESS' %}selected{% endif %}>In Progress</option>
                            <option value="COMPLETED" {% if match.status == 'COMPLETED' %}selected{% endif %}>Completed</option>
                            <option value="CANCELLED" {% if match.status == 'CANCELLED' %}selected{% endif %}>Cancelled</option>
                            <option value="POSTPONED" {% if match.status == 'POSTPONED' %}selected{% endif %}>Postponed</option>
                        </select>
                    </div>
                    {% endif %}

                    <!-- Notes -->
                    <div class="mb-4">
                        <label for="notes" class="c-form-label">Notes</label>
                        <textarea name="notes" id="notes" class="c-form-control" rows="3"
                                  placeholder="Any additional notes...">{% if match %}{{ match.notes }}{% endif %}</textarea>
                    </div>

                    <!-- Submit -->
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('admin_panel.ecs_fc_dashboard') }}" class="c-btn c-btn--outline-secondary">
                            <i class="ti ti-arrow-left me-1"></i>Cancel
                        </a>
                        <button type="submit" class="c-btn c-btn--primary">
                            <i class="ti ti-{% if match %}check{% else %}plus{% endif %} me-1"></i>
                            {% if match %}Save Changes{% else %}Create Match{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% block custom_js %}
{{ super() }}
{# ECS FC match form - uses admin-ecs-fc-match.js module #}
{% endblock %}
{% endblock %}
