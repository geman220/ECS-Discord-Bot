{% extends "admin_panel/base_flowbite.html" %}
{% from 'macros/flowbite.html' import card, button, badge, alert, modal_form, modal_info %}

{% block admin_title %}Message Management{% endblock %}
{% block panel_description %}Manage Discord bot messages and website announcements{% endblock %}

{% block breadcrumb_items %}
<li>
    <div class="flex items-center">
        <i class="ti ti-chevron-right w-4 h-4 text-gray-400"></i>
        <span class="ml-1 text-sm font-medium text-gray-500 dark:text-gray-400">Message Management</span>
    </div>
</li>
{% endblock %}

{% block panel_content %}
<!-- Status Overview Cards -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-5">
        <div class="flex items-center">
            <div class="flex items-center justify-center w-12 h-12 rounded-lg bg-blue-100 dark:bg-blue-900/30 mr-3">
                <i class="ti ti-message-2 text-2xl text-blue-600 dark:text-blue-400"></i>
            </div>
            <div>
                <h4 class="text-2xl font-bold text-gray-900 dark:text-white">{{ categories|length if categories else 0 }}</h4>
                <p class="text-sm text-gray-500 dark:text-gray-400">Message Categories</p>
            </div>
        </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-5">
        <div class="flex items-center">
            <div class="flex items-center justify-center w-12 h-12 rounded-lg bg-green-100 dark:bg-green-900/30 mr-3">
                <i class="ti ti-file-text text-2xl text-green-600 dark:text-green-400"></i>
            </div>
            <div>
                <h4 class="text-2xl font-bold text-gray-900 dark:text-white">{{ categories|map(attribute='templates')|map('length')|sum if categories else 0 }}</h4>
                <p class="text-sm text-gray-500 dark:text-gray-400">Total Templates</p>
            </div>
        </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-5">
        <div class="flex items-center">
            <div class="flex items-center justify-center w-12 h-12 rounded-lg bg-yellow-100 dark:bg-yellow-900/30 mr-3">
                <i class="ti ti-speakerphone text-2xl text-yellow-600 dark:text-yellow-400"></i>
            </div>
            <div>
                <h4 class="text-2xl font-bold text-gray-900 dark:text-white">{{ announcements|length if announcements else 0 }}</h4>
                <p class="text-sm text-gray-500 dark:text-gray-400">Active Announcements</p>
            </div>
        </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-5">
        <div class="flex items-center">
            <div class="flex items-center justify-center w-12 h-12 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 mr-3">
                <i class="ti ti-brand-discord text-2xl text-indigo-600 dark:text-indigo-400"></i>
            </div>
            <div>
                <h4 class="text-lg font-bold text-gray-900 dark:text-white">Discord Bot</h4>
                <p class="text-sm text-gray-500 dark:text-gray-400">Test messaging</p>
                <a href="{{ url_for('admin.discord_onboarding.admin_test_onboarding') }}" class="text-xs text-cyan-600 hover:underline dark:text-cyan-400">
                    <i class="ti ti-test-pipe mr-1"></i>Test
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Setup Action Card (if no categories) -->
{% if not categories %}
<div class="bg-white dark:bg-gray-800 rounded-lg shadow p-5 mb-6">
    <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
            <h5 class="text-lg font-semibold text-gray-900 dark:text-white">Setup Discord Message System</h5>
            <p class="text-sm text-gray-500 dark:text-gray-400">Initialize message templates for automated Discord bot communications</p>
        </div>
        <button type="button" class="px-4 py-2 text-sm font-medium text-white bg-ecs-green rounded-lg hover:bg-ecs-green-700" data-modal-target="setupModal" data-modal-toggle="setupModal">
            <i class="ti ti-settings mr-1"></i>Initialize System
        </button>
    </div>
</div>
{% endif %}

<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Message Categories (2/3 width) -->
    <div class="lg:col-span-2 space-y-6">
        {% if categories %}
        {% for category in categories %}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
            <!-- Category Header -->
            <div class="px-4 py-3 {% if 'ecs' in category.name.lower() or 'fc' in category.name.lower() %}bg-ecs-green{% elif 'premier' in category.name.lower() or 'pub' in category.name.lower() %}bg-green-500{% elif 'classic' in category.name.lower() %}bg-yellow-500{% else %}bg-blue-500{% endif %} text-white">
                <div class="flex items-center justify-between">
                    <h5 class="font-semibold flex items-center">
                        {% if 'ecs' in category.name.lower() or 'fc' in category.name.lower() %}
                        <i class="ti ti-shield mr-2"></i>
                        {% elif 'premier' in category.name.lower() or 'pub' in category.name.lower() %}
                        <i class="ti ti-star mr-2"></i>
                        {% elif 'classic' in category.name.lower() %}
                        <i class="ti ti-heart mr-2"></i>
                        {% else %}
                        <i class="ti ti-world mr-2"></i>
                        {% endif %}
                        {{ category.name }}
                    </h5>
                    <button type="button" class="px-3 py-1.5 text-xs font-medium text-gray-900 bg-white rounded-lg hover:bg-gray-100" data-action="create-template" data-category-id="{{ category.id }}" data-category-name="{{ category.name }}">
                        <i class="ti ti-plus mr-1"></i>New Template
                    </button>
                </div>
            </div>

            <!-- Category Content -->
            <div class="p-4">
                {% if category.templates %}
                <div class="space-y-3">
                    {% for template in category.templates %}
                    <div class="border {{ 'border-green-200 dark:border-green-800' if template.is_active else 'border-yellow-200 dark:border-yellow-800' }} rounded-lg p-3">
                        <div class="flex flex-wrap items-start justify-between gap-3">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1">
                                    <h6 class="font-medium text-gray-900 dark:text-white truncate">{{ template.name }}</h6>
                                    {% if template.is_active %}
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">Active</span>
                                    {% else %}
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">Inactive</span>
                                    {% endif %}
                                </div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">Key: <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">{{ template.key }}</code></p>
                                {% if template.description %}
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">{{ template.description }}</p>
                                {% endif %}
                                <div class="bg-gray-50 dark:bg-gray-700 p-2 rounded text-xs text-gray-600 dark:text-gray-300">
                                    {{ template.message_content[:150] }}{% if template.message_content|length > 150 %}...{% endif %}
                                </div>
                                {% if template.variables %}
                                <div class="mt-2">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Variables: </span>
                                    {% for var in template.variables %}
                                    <code class="text-xs bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-1 rounded">{{'{'}}{{ var }}{{'}'}}</code>{% if not loop.last %} {% endif %}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="flex flex-col gap-1">
                                <a href="{{ url_for('admin.message_config.edit_template', template_id=template.id) }}" class="px-3 py-1.5 text-xs font-medium text-white bg-ecs-green rounded hover:bg-ecs-green-700">
                                    <i class="ti ti-edit mr-1"></i>Edit
                                </a>
                                <button type="button" class="px-3 py-1.5 text-xs font-medium text-cyan-700 bg-cyan-50 rounded hover:bg-cyan-100 dark:bg-cyan-900/30 dark:text-cyan-300" data-action="preview-template" data-template-id="{{ template.id }}">
                                    <i class="ti ti-eye mr-1"></i>Preview
                                </button>
                                <button type="button" class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300" data-action="copy-template" data-template-id="{{ template.id }}">
                                    <i class="ti ti-copy mr-1"></i>Copy
                                </button>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-2">Last updated: {{ template.updated_at.strftime('%b %d, %Y at %I:%M %p') }}</p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-6">
                    <i class="ti ti-file-text text-4xl text-gray-300 dark:text-gray-600 mb-2"></i>
                    <p class="text-sm text-gray-500 dark:text-gray-400">No templates in this category</p>
                </div>
                {% endif %}

                <!-- Category Context Info -->
                <div class="mt-4 p-3 rounded-lg border-l-4 {% if 'ecs' in category.name.lower() or 'fc' in category.name.lower() %}border-ecs-green bg-ecs-green/5{% elif 'premier' in category.name.lower() %}border-green-500 bg-green-50 dark:bg-green-900/10{% elif 'classic' in category.name.lower() %}border-yellow-500 bg-yellow-50 dark:bg-yellow-900/10{% else %}border-blue-500 bg-blue-50 dark:bg-blue-900/10{% endif %}">
                    <p class="text-xs text-gray-600 dark:text-gray-400">
                        <strong>Context:</strong>
                        {% if 'ecs' in category.name.lower() or 'fc' in category.name.lower() %}
                        ECS FC division messages for competitive league players.
                        {% elif 'premier' in category.name.lower() %}
                        Premier division messages for competitive recreational players.
                        {% elif 'classic' in category.name.lower() %}
                        Classic division messages for casual recreational players.
                        {% else %}
                        System-wide messages used across all leagues.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <!-- Empty State -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-8 text-center">
            <i class="ti ti-message-off text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
            <h5 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No Message Templates Found</h5>
            <p class="text-gray-500 dark:text-gray-400 mb-4">Initialize the message system to get started with Discord bot communications.</p>
            <button type="button" class="px-4 py-2 text-sm font-medium text-white bg-ecs-green rounded-lg hover:bg-ecs-green-700" data-modal-target="setupModal" data-modal-toggle="setupModal">
                <i class="ti ti-settings mr-1"></i>Initialize System
            </button>
        </div>
        {% endif %}
    </div>

    <!-- Sidebar (1/3 width) -->
    <div class="space-y-6">
        <!-- Website Announcements -->
        {% call card(title="Website Announcements") %}
        <div class="flex items-center justify-between mb-4">
            <span class="text-sm text-gray-500 dark:text-gray-400">Manage site-wide announcements</span>
            <button type="button" class="p-1.5 text-ecs-green hover:bg-ecs-green/10 rounded" data-action="create-announcement">
                <i class="ti ti-plus"></i>
            </button>
        </div>
        {% if announcements %}
        <div class="space-y-3">
            {% for announcement in announcements[:3] %}
            <div class="border-b dark:border-gray-700 pb-3 last:border-0">
                <div class="flex items-start justify-between">
                    <div class="flex-1 min-w-0">
                        <h6 class="font-medium text-gray-900 dark:text-white text-sm truncate">{{ announcement.title }}</h6>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ announcement.content[:60] }}{% if announcement.content|length > 60 %}...{% endif %}</p>
                        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">{{ announcement.created_at.strftime('%b %d, %Y') }}</p>
                    </div>
                    <div class="flex gap-1 ml-2">
                        <button type="button" class="p-1 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded" data-action="edit-announcement" data-announcement-id="{{ announcement.id }}">
                            <i class="ti ti-edit text-sm"></i>
                        </button>
                        <button type="button" class="p-1 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded" data-action="delete-announcement" data-announcement-id="{{ announcement.id }}">
                            <i class="ti ti-trash text-sm"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% if announcements|length > 3 %}
        <p class="text-center text-xs text-gray-500 dark:text-gray-400 mt-3">Showing 3 of {{ announcements|length }} announcements</p>
        {% endif %}
        {% else %}
        <div class="text-center py-6">
            <i class="ti ti-speakerphone text-4xl text-gray-300 dark:text-gray-600 mb-2"></i>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">No announcements yet</p>
            <button type="button" class="px-3 py-1.5 text-xs font-medium text-white bg-green-500 rounded hover:bg-green-600" data-action="create-announcement">
                <i class="ti ti-plus mr-1"></i>Create Announcement
            </button>
        </div>
        {% endif %}
        {% endcall %}

        <!-- Quick Actions -->
        {% call card(title="Quick Actions") %}
        <div class="space-y-2">
            {% if categories %}
            <a href="{{ url_for('admin.discord_onboarding.admin_test_onboarding') }}" class="flex items-center px-3 py-2 text-sm text-cyan-700 bg-cyan-50 rounded-lg hover:bg-cyan-100 dark:bg-cyan-900/30 dark:text-cyan-300 dark:hover:bg-cyan-900/50">
                <i class="ti ti-test-pipe mr-2"></i>Test Welcome Message
            </a>
            {% endif %}
            <button type="button" class="flex items-center w-full px-3 py-2 text-sm text-ecs-green bg-ecs-green/10 rounded-lg hover:bg-ecs-green/20" data-action="create-announcement">
                <i class="ti ti-plus mr-2"></i>Create Announcement
            </button>
        </div>
        {% endcall %}

        <!-- Help Card -->
        {% call card(title="Message System Guide") %}
        <div class="space-y-4">
            <div>
                <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Discord Templates</p>
                <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1 ml-4 list-disc">
                    <li>Automated welcome messages for new users</li>
                    <li>League-specific communication templates</li>
                    <li>System error and notification messages</li>
                </ul>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Template Variables</p>
                <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1 ml-4 list-disc">
                    <li><code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">{{'{'}}username{{'}'}}</code> - User's Discord name</li>
                    <li><code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">{{'{'}}league_display_name{{'}'}}</code> - League name</li>
                    <li><code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">{{'{'}}team_name{{'}'}}</code> - Team name</li>
                </ul>
            </div>
        </div>
        {% endcall %}
    </div>
</div>

<!-- Preview Modal -->
{% call modal_info('previewModal', 'Message Preview', size='lg') %}
<div id="previewContent">
    <div class="text-center py-8">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-ecs-green"></div>
    </div>
</div>
{% endcall %}

<!-- Announcement Modal -->
{% call modal_form('announcementModal', 'Create Announcement', form_id='announcementForm', action='', method='POST', size='md', submit_text='Save Announcement', submit_color='primary', loading_text='Saving...') %}
<input type="hidden" id="announcement_id" name="announcement_id" value="">
<div>
    <label for="announcement_title" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Title</label>
    <input type="text" id="announcement_title" name="title" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-ecs-green focus:border-ecs-green block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
</div>
<div>
    <label for="announcement_content" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Content</label>
    <textarea id="announcement_content" name="content" rows="4" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-ecs-green focus:border-ecs-green block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required></textarea>
</div>
<div>
    <label for="announcement_type" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Type</label>
    <select id="announcement_type" name="type" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-ecs-green focus:border-ecs-green block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
        <option value="info">Info</option>
        <option value="warning">Warning</option>
        <option value="success">Success</option>
        <option value="danger">Important</option>
    </select>
</div>
<div class="flex items-center">
    <input type="checkbox" id="announcement_is_active" name="is_active" checked class="w-4 h-4 text-ecs-green bg-gray-100 border-gray-300 rounded focus:ring-ecs-green dark:bg-gray-700 dark:border-gray-600">
    <label for="announcement_is_active" class="ml-2 text-sm font-medium text-gray-900 dark:text-white">Active</label>
</div>
{% endcall %}

<!-- Create Template Modal -->
{% call modal_form('createTemplateModal', 'Create New Template', form_id='createTemplateForm', action='', method='POST', size='lg', submit_text='Create Template', submit_color='primary', loading_text='Creating...') %}
<input type="hidden" id="create_category_id" name="category_id" value="">
<div>
    <label for="create_template_name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Template Name</label>
    <input type="text" id="create_template_name" name="name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-ecs-green focus:border-ecs-green block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
</div>
<div>
    <label for="create_template_key" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Template Key</label>
    <input type="text" id="create_template_key" name="key" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-ecs-green focus:border-ecs-green block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required>
    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Unique identifier (e.g., welcome_message, league_info)</p>
</div>
<div>
    <label for="create_template_description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Description</label>
    <textarea id="create_template_description" name="description" rows="2" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-ecs-green focus:border-ecs-green block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white"></textarea>
</div>
<div>
    <label for="create_template_content" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Message Content</label>
    <textarea id="create_template_content" name="message_content" rows="6" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-ecs-green focus:border-ecs-green block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white font-mono text-xs" required></textarea>
    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Use variables like <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">{{'{'}}username{{'}'}}</code>, <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">{{'{'}}league_display_name{{'}'}}</code></p>
</div>
<div class="flex items-center">
    <input type="checkbox" id="create_template_active" name="is_active" checked class="w-4 h-4 text-ecs-green bg-gray-100 border-gray-300 rounded focus:ring-ecs-green dark:bg-gray-700 dark:border-gray-600">
    <label for="create_template_active" class="ml-2 text-sm font-medium text-gray-900 dark:text-white">Active</label>
</div>
{% endcall %}

<!-- Setup Modal -->
{% call modal_info('setupModal', 'Setup Message System', size='md') %}
<div class="p-4 mb-4 text-sm text-blue-800 rounded-lg bg-blue-50 dark:bg-blue-900/30 dark:text-blue-300">
    <h6 class="font-medium mb-1"><i class="ti ti-info-circle mr-1"></i>Initialize Message Templates</h6>
    <p>To set up the Discord bot message system, you need to run the initialization script.</p>
</div>
<div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg mb-4">
    <p class="text-sm font-medium text-gray-900 dark:text-white mb-1">Run this command:</p>
    <code class="text-sm text-ecs-green">python initialize_message_config.py</code>
</div>
<p class="text-xs text-gray-500 dark:text-gray-400 mb-2">This will create:</p>
<ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1 ml-4 list-disc">
    <li>Default message categories (Onboarding, League, System)</li>
    <li>Template messages for common scenarios</li>
    <li>Database tables for message management</li>
</ul>
{% endcall %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const isDark = document.documentElement.classList.contains('dark');

    // Modal setup
    function showModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            modal.setAttribute('aria-hidden', 'false');
        }
    }

    function hideModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            modal.setAttribute('aria-hidden', 'true');
        }
    }

    function setupModal(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;

        document.querySelectorAll(`[data-modal-toggle="${modalId}"]`).forEach(btn => {
            btn.addEventListener('click', () => showModal(modalId));
        });

        document.querySelectorAll(`[data-modal-hide="${modalId}"]`).forEach(btn => {
            btn.addEventListener('click', () => hideModal(modalId));
        });

        const backdrop = modal.querySelector('[data-modal-backdrop]');
        if (backdrop) {
            backdrop.addEventListener('click', () => hideModal(modalId));
        }
    }

    setupModal('previewModal');
    setupModal('announcementModal');
    setupModal('createTemplateModal');
    setupModal('setupModal');

    // Action handlers
    document.addEventListener('click', function(e) {
        const target = e.target.closest('[data-action]');
        if (!target) return;

        const action = target.dataset.action;

        switch(action) {
            case 'create-announcement':
                document.getElementById('announcementModalLabel').innerHTML = '<i class="ti ti-speakerphone mr-2"></i>Create Announcement';
                document.getElementById('announcementForm').reset();
                document.getElementById('announcement_id').value = '';
                document.getElementById('announcement_is_active').checked = true;
                showModal('announcementModal');
                break;

            case 'edit-announcement':
                const announcementId = target.dataset.announcementId;
                document.getElementById('announcementModalLabel').innerHTML = '<i class="ti ti-edit mr-2"></i>Edit Announcement';
                document.getElementById('announcement_id').value = announcementId;
                // In production, fetch announcement data via API
                showModal('announcementModal');
                break;

            case 'delete-announcement':
                const delId = target.dataset.announcementId;
                Swal.fire({
                    title: 'Delete Announcement?',
                    text: 'This action cannot be undone.',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, Delete',
                    confirmButtonColor: '#dc2626',
                    background: isDark ? '#1f2937' : '#ffffff',
                    color: isDark ? '#f3f4f6' : '#111827'
                });
                break;

            case 'create-template':
                const categoryId = target.dataset.categoryId;
                const categoryName = target.dataset.categoryName;
                document.getElementById('createTemplateModalLabel').innerHTML = `<i class="ti ti-plus mr-2"></i>Create Template for ${categoryName}`;
                document.getElementById('createTemplateForm').reset();
                document.getElementById('create_category_id').value = categoryId;
                document.getElementById('create_template_active').checked = true;
                showModal('createTemplateModal');
                break;

            case 'preview-template':
                const templateId = target.dataset.templateId;
                document.getElementById('previewContent').innerHTML = `
                    <div class="mb-4">
                        <h6 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Discord Message Preview:</h6>
                        <div class="bg-gray-900 text-gray-100 p-4 rounded-lg font-mono text-sm whitespace-pre-wrap">
                            Hello <span class="text-blue-400">@SampleUser</span>!

Welcome to **Pub League Premier**!

Here's what you need to know:
- League contact: admin@ecsfc.com
- Check Discord for match announcements
- Have fun and play fair!
                        </div>
                    </div>
                    <div>
                        <h6 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sample variables used:</h6>
                        <pre class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs overflow-auto">{
  "username": "SampleUser",
  "league_display_name": "Pub League Premier",
  "league_contact_info": "admin@ecsfc.com"
}</pre>
                    </div>
                `;
                showModal('previewModal');
                break;

            case 'copy-template':
                Swal.fire({
                    title: 'Copied!',
                    text: 'Template content copied to clipboard.',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false,
                    background: isDark ? '#1f2937' : '#ffffff',
                    color: isDark ? '#f3f4f6' : '#111827'
                });
                break;
        }
    });

    // Form submissions
    document.getElementById('announcementForm')?.addEventListener('submit', function(e) {
        e.preventDefault();
        Swal.fire({
            title: 'Success!',
            text: 'Announcement saved successfully.',
            icon: 'success',
            confirmButtonColor: '#1a472a',
            background: isDark ? '#1f2937' : '#ffffff',
            color: isDark ? '#f3f4f6' : '#111827'
        }).then(() => {
            hideModal('announcementModal');
        });
    });

    document.getElementById('createTemplateForm')?.addEventListener('submit', function(e) {
        e.preventDefault();
        Swal.fire({
            title: 'Success!',
            text: 'Template created successfully.',
            icon: 'success',
            confirmButtonColor: '#1a472a',
            background: isDark ? '#1f2937' : '#ffffff',
            color: isDark ? '#f3f4f6' : '#111827'
        }).then(() => {
            hideModal('createTemplateModal');
        });
    });
});
</script>
{% endblock %}
