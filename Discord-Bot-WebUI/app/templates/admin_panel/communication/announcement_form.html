{% extends "admin_panel/base.html" %}

{% block title %}{{ title }} - Admin Panel{% endblock %}

{% block panel_content %}
<div class="row">
    <div class="col-12">
        <div class="c-card">
            <div class="c-card__header d-flex justify-content-between align-items-center">
                <h5 class="c-card__title mb-0">
                    <i class="ti ti-speakerphone me-2"></i>{{ title }}
                </h5>
                <a href="{{ url_for('admin_panel.announcements') }}" class="c-btn c-btn--outline-secondary c-btn--sm">
                    <i class="ti ti-arrow-left me-1"></i>Back to Announcements
                </a>
            </div>
            <div class="c-card__body">
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="title" class="form-label">Announcement Title *</label>
                                <input type="text" class="form-control" id="title" name="title" 
                                       value="{{ announcement.title if announcement else '' }}" 
                                       required maxlength="255" data-form-control>
                                <div class="form-text">Clear, concise title for the announcement</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="priority" class="form-label">Priority</label>
                                <select class="form-select" id="priority" name="priority" data-form-select>
                                    <option value="low" {% if announcement and announcement.priority == 'low' %}selected{% endif %}>Low</option>
                                    <option value="normal" {% if not announcement or announcement.priority == 'normal' %}selected{% endif %}>Normal</option>
                                    <option value="medium" {% if announcement and announcement.priority == 'medium' %}selected{% endif %}>Medium</option>
                                    <option value="high" {% if announcement and announcement.priority == 'high' %}selected{% endif %}>High</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="announcement_type" class="form-label">Type</label>
                                <select class="form-select" id="announcement_type" name="announcement_type" data-form-select>
                                    <option value="general" {% if not announcement or announcement.announcement_type == 'general' %}selected{% endif %}>General</option>
                                    <option value="league" {% if announcement and announcement.announcement_type == 'league' %}selected{% endif %}>League</option>
                                    <option value="match" {% if announcement and announcement.announcement_type == 'match' %}selected{% endif %}>Match</option>
                                    <option value="system" {% if announcement and announcement.announcement_type == 'system' %}selected{% endif %}>System</option>
                                    <option value="urgent" {% if announcement and announcement.announcement_type == 'urgent' %}selected{% endif %}>Urgent</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="content" class="form-label">Content *</label>
                        <textarea class="form-control" id="content" name="content" rows="8" required data-form-control>{{ announcement.content if announcement else '' }}</textarea>
                        <div class="form-text">Detailed announcement content. Supports basic HTML formatting.</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex justify-content-between">
                                <div>
                                    {% if announcement %}
                                    <button type="button" class="c-btn c-btn--danger" data-action="delete-announcement" data-id="{{ announcement.id }}">
                                        <i class="ti ti-trash me-1"></i>Delete Announcement
                                    </button>
                                    {% endif %}
                                </div>
                                <div>
                                    <a href="{{ url_for('admin_panel.announcements') }}" class="c-btn c-btn--secondary me-2">
                                        <i class="ti ti-x me-1"></i>Cancel
                                    </a>
                                    <button type="submit" class="c-btn c-btn--primary">
                                        <i class="ti ti-device-floppy me-1"></i>{% if announcement %}Update{% else %}Create{% endif %} Announcement
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Preview Card -->
<div class="row mt-4">
    <div class="col-12">
        <div class="c-card">
            <div class="c-card__header">
                <h6 class="c-card__title mb-0">
                    <i class="ti ti-eye me-2"></i>Preview
                </h6>
            </div>
            <div class="c-card__body">
                <div id="preview-content">
                    <div class="alert alert-info" data-alert>
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="alert-heading" id="preview-title">{{ announcement.title if announcement else 'Announcement Title' }}</h6>
                                <div id="preview-body">{{ announcement.content if announcement else 'Announcement content will appear here...' }}</div>
                            </div>
                            <div>
                                <span class="badge bg-info" id="preview-priority" data-badge>{{ (announcement.priority if announcement else 'normal').title() }}</span>
                            </div>
                        </div>
                        <hr>
                        <div class="mb-0">
                            <small class="text-muted">
                                <strong>Type:</strong> <span id="preview-type">{{ (announcement.announcement_type if announcement else 'general').title() }}</span>
                                <strong class="ms-3">Created:</strong> {{ moment().format('YYYY-MM-DD HH:mm') }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<script type="module" src="{{ url_for('static', filename='js/admin/announcement-form.js') }}"></script>
{% endif %}
{% endblock %}