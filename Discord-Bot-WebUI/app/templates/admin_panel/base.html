{% extends "base.html" %}

{% block main_content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Admin Panel Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center flex-column flex-md-row">
                        <div class="text-center text-md-start mb-3 mb-md-0">
                            <h1 class="text-white mb-2 h3 h-md-1">
                                <i class="ti ti-settings me-2"></i>Admin Panel
                            </h1>
                            <p class="mb-0 opacity-75 small">
                                {% block panel_description %}Centralized administrative control center for ECS FC{% endblock %}
                            </p>
                        </div>
                        <div class="text-center text-md-end">
                            <div class="badge bg-white text-primary mb-2">
                                <i class="ti ti-shield-check me-1"></i>
                                <span class="d-none d-sm-inline">{% if 'Global Admin' in user_roles %}Global Admin{% else %}Pub League Admin{% endif %}</span>
                                <span class="d-sm-none">Admin</span>
                            </div>
                            <div class="small opacity-75">
                                <span class="d-none d-md-inline">Logged in as: </span>
                                <span class="d-md-none">{{ (safe_current_user.name or safe_current_user.username)[:15] }}{% if (safe_current_user.name or safe_current_user.username)|length > 15 %}...{% endif %}</span>
                                <span class="d-none d-md-inline">{{ safe_current_user.name or safe_current_user.username }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation Toggle -->
    <div class="d-lg-none mb-3">
        <button class="btn btn-primary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#mobileNavigation" aria-expanded="false" aria-controls="mobileNavigation">
            <i class="ti ti-menu-2 me-2"></i>Admin Navigation
        </button>
    </div>

    <!-- Navigation Tabs -->
    <div class="row mb-4">
        <div class="col-12">
            <nav class="navbar navbar-expand-lg navbar-light bg-body-tertiary rounded-3 shadow-sm p-2 p-lg-3">
                <div class="container-fluid px-0">
                    <div class="collapse navbar-collapse" id="mobileNavigation">
                        <div class="admin-nav-scroll w-100">
                            <ul class="navbar-nav mb-2 mb-lg-0 flex-lg-row flex-column flex-nowrap">
                        <!-- Dashboard -->
                        <li class="nav-item mb-2 mb-lg-0">
                            <a class="nav-link {% if request.endpoint == 'admin_panel.dashboard' %}active{% endif %}" 
                               href="{{ url_for('admin_panel.dashboard') }}">
                                <i class="ti ti-dashboard me-1"></i><span class="nav-link-text">Dashboard</span>
                            </a>
                        </li>
                        
                        <!-- System Management -->
                        <li class="nav-item dropdown mb-2 mb-lg-0">
                            <a class="nav-link dropdown-toggle {% if 'feature_toggles' in request.endpoint or 'monitoring' in request.endpoint or 'cache' in request.endpoint or 'health' in request.endpoint or 'redis' in request.endpoint or 'docker' in request.endpoint or 'security' in request.endpoint %}active{% endif %}"
                               href="#" role="button" data-bs-toggle="dropdown">
                                <i class="ti ti-settings me-1"></i><span class="nav-link-text">System</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.feature_toggles') }}">
                                    <i class="ti ti-toggle-left me-2"></i>Feature Toggles</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.system_monitoring') }}">
                                    <i class="ti ti-activity me-2"></i>System Monitoring</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.cache_management') }}">
                                    <i class="ti ti-database me-2"></i>Cache Management</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.api_management') }}">
                                    <i class="ti ti-api me-2"></i>API Management</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.navigation_settings') }}">
                                    <i class="ti ti-navigation me-2"></i>Navigation Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li class="dropdown-header">Infrastructure</li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.health_dashboard') }}">
                                    <i class="ti ti-heartbeat me-2"></i>System Health</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.redis_management') }}">
                                    <i class="ti ti-database me-2"></i>Redis Management</a></li>
                                {% if 'Global Admin' in user_roles %}
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.docker_management') }}">
                                    <i class="ti ti-box me-2"></i>Docker Management</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.performance_monitoring') }}">
                                    <i class="ti ti-chart-line me-2"></i>Performance Monitor</a></li>
                                {% endif %}
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.security_dashboard') }}">
                                    <i class="ti ti-shield-check me-2"></i>Security Dashboard</a></li>
                            </ul>
                        </li>
                        
                        <!-- User & Communication -->
                        <li class="nav-item dropdown mb-2 mb-lg-0">
                            <a class="nav-link dropdown-toggle {% if 'users' in request.endpoint or 'communication' in request.endpoint or 'message' in request.endpoint %}active{% endif %}" 
                               href="#" role="button" data-bs-toggle="dropdown">
                                <i class="ti ti-users me-1"></i><span class="nav-link-text">Users</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.user_management') }}">
                                    <i class="ti ti-users me-2"></i>User Management</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.communication_hub') }}">
                                    <i class="ti ti-message-circle me-2"></i>Communication Hub</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.message_template_management') }}">
                                    <i class="ti ti-template me-2"></i>Message Templates</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.push_notifications') }}">
                                    <i class="ti ti-bell me-2"></i>Push Notifications</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.notification_groups_list') }}">
                                    <i class="ti ti-users-group me-2"></i>Notification Groups</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.campaigns_list') }}">
                                    <i class="ti ti-broadcast me-2"></i>Push Campaigns</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.direct_messaging') }}">
                                    <i class="ti ti-send me-2"></i>Direct Messaging (SMS/DM)</a></li>
                            </ul>
                        </li>

                        <!-- League Management Hub -->
                        <li class="nav-item dropdown mb-2 mb-lg-0">
                            <a class="nav-link dropdown-toggle {% if 'league_management' in request.endpoint %}active{% endif %}"
                               href="#" role="button" data-bs-toggle="dropdown" title="League Management">
                                <i class="ti ti-tournament me-1"></i><span class="nav-link-text">League Mgmt</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="dropdown-header">League Management Hub</li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.league_management_dashboard') }}">
                                    <i class="ti ti-dashboard me-2"></i>Dashboard</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.season_wizard') }}">
                                    <i class="ti ti-wand me-2"></i>Season Wizard</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li class="dropdown-header">Management</li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.league_management_teams') }}">
                                    <i class="ti ti-users-group me-2"></i>Teams</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.league_management_seasons') }}">
                                    <i class="ti ti-calendar me-2"></i>Seasons</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.league_management_history') }}">
                                    <i class="ti ti-history me-2"></i>History</a></li>
                            </ul>
                        </li>

                        <!-- Pub League Operations (Premier, Classic, ECS FC) -->
                        <li class="nav-item dropdown mb-2 mb-lg-0">
                            <a class="nav-link dropdown-toggle {% if ('match' in request.endpoint and 'mls' not in request.endpoint) or 'substitute' in request.endpoint or 'playoff' in request.endpoint %}active{% endif %}"
                               href="#" role="button" data-bs-toggle="dropdown" title="Pub League Operations">
                                <i class="ti ti-trophy me-1"></i><span class="nav-link-text">Pub League Ops</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="dropdown-header">Pub League Operations</li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.match_operations') }}">
                                    <i class="ti ti-trophy me-2"></i>Match Operations</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.match_verification') }}">
                                    <i class="ti ti-shield-check me-2"></i>Match Verification</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.substitute_management') }}">
                                    <i class="ti ti-user-plus me-2"></i>Substitute Management</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.substitute_pools') }}">
                                    <i class="ti ti-users-group me-2"></i>Substitute Pools</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.playoff_management') }}">
                                    <i class="ti ti-tournament me-2"></i>Playoff Management</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.quick_actions') }}">
                                    <i class="ti ti-bolt me-2"></i>Quick Actions</a></li>
                            </ul>
                        </li>

                        <!-- MLS Management (ESPN Data, Live Reporting) -->
                        <li class="nav-item dropdown mb-2 mb-lg-0">
                            <a class="nav-link dropdown-toggle {% if 'mls' in request.endpoint or 'admin_live' in request.endpoint %}active{% endif %}"
                               href="#" role="button" data-bs-toggle="dropdown">
                                <i class="ti ti-soccer-field me-1"></i><span class="nav-link-text">MLS</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="dropdown-header">MLS / Sounders Management</li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.mls_overview') }}">
                                    <i class="ti ti-calendar me-2"></i>MLS Overview</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.mls_matches') }}">
                                    <i class="ti ti-list me-2"></i>All MLS Matches</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li class="dropdown-header">Live Reporting (ESPN)</li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.live_reporting_dashboard') }}">
                                    <i class="ti ti-broadcast me-2"></i>Live Reporting Dashboard</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.mls_task_monitoring') }}">
                                    <i class="ti ti-activity me-2"></i>Task Monitoring</a></li>
                            </ul>
                        </li>

                        <!-- Discord & Bot -->
                        <li class="nav-item dropdown mb-2 mb-lg-0">
                            <a class="nav-link dropdown-toggle {% if 'discord' in request.endpoint %}active{% endif %}"
                               href="#" role="button" data-bs-toggle="dropdown">
                                <i class="ti ti-brand-discord me-1"></i><span class="nav-link-text">Discord</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.discord_overview') }}">
                                    <i class="ti ti-brand-discord me-2"></i>Discord Overview</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.discord_players') }}">
                                    <i class="ti ti-users me-2"></i>Player Status</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.discord_roles') }}">
                                    <i class="ti ti-shield me-2"></i>Role Sync</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.discord_onboarding') }}">
                                    <i class="ti ti-user-plus me-2"></i>Onboarding</a></li>
                            </ul>
                        </li>

                        <!-- Reports & Content -->
                        <li class="nav-item dropdown mb-2 mb-lg-0">
                            <a class="nav-link dropdown-toggle {% if 'reports' in request.endpoint or 'feedback' in request.endpoint or 'draft' in request.endpoint or 'rsvp' in request.endpoint %}active{% endif %}"
                               href="#" role="button" data-bs-toggle="dropdown">
                                <i class="ti ti-report-analytics me-1"></i><span class="nav-link-text">Reports</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.feedback_list') }}">
                                    <i class="ti ti-message-report me-2"></i>Feedback Management</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li class="dropdown-header">Draft Management</li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.draft_history') }}">
                                    <i class="ti ti-list-numbers me-2"></i>Draft History &amp; Stats</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('draft_predictions.admin_dashboard') }}">
                                    <i class="ti ti-chart-bar me-2"></i>Draft Predictions</a></li>
                            </ul>
                        </li>

                        <!-- External Services -->
                        <li class="nav-item dropdown mb-2 mb-lg-0">
                            <a class="nav-link dropdown-toggle {% if 'mobile_features' in request.endpoint or 'store' in request.endpoint or request.blueprint == 'ai_prompts' %}active{% endif %}"
                               href="#" role="button" data-bs-toggle="dropdown">
                                <i class="ti ti-world me-1"></i><span class="nav-link-text">Services</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.mobile_features') }}">
                                    <i class="ti ti-device-mobile me-2"></i>Mobile Features</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('admin_panel.store_management') }}">
                                    <i class="ti ti-shopping-cart me-2"></i>Store Management</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('ai_prompts.list_prompts') }}">
                                    <i class="ti ti-brain me-2"></i>AI Prompts</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li class="dropdown-header">External Links</li>
                                <li><a class="dropdown-item" href="{{ url_for('wallet_admin.wallet_management') }}">
                                    <i class="ti ti-wallet me-2"></i>Digital Wallet</a></li>
                            </ul>
                        </li>
                        
                        <!-- Audit & Logs -->
                        <li class="nav-item mb-2 mb-lg-0">
                            <a class="nav-link {% if 'audit' in request.endpoint %}active{% endif %}"
                               href="{{ url_for('admin_panel.audit_logs') }}">
                                <i class="ti ti-history me-1"></i><span class="nav-link-text">Audit Logs</span>
                            </a>
                        </li>

                        <!-- Appearance/Theme Settings -->
                        <li class="nav-item mb-2 mb-lg-0">
                            <a class="nav-link {% if 'appearance' in request.endpoint %}active{% endif %}"
                               href="{{ url_for('admin_panel.appearance') }}">
                                <i class="ti ti-palette me-1"></i><span class="nav-link-text">Appearance</span>
                            </a>
                        </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <!-- Breadcrumb -->
    {% block breadcrumb %}
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{{ url_for('admin_panel.dashboard') }}">Admin Panel</a>
            </li>
            {% block breadcrumb_items %}{% endblock %}
        </ol>
    </nav>
    {% endblock %}

    <!-- Page Content -->
    {% block panel_content %}{% endblock %}

    <!-- Network Status Indicator -->
    <div class="network-status status-indicator active" title="Online"></div>

    <!-- Toast Container for Mobile Notifications -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;"></div>
</div>
{% endblock %}

{% block custom_css %}
{{ super() }}
<!-- admin-mobile.css now consolidated into layout/mobile.css -->
<style>
/* Admin Navigation - Responsive Horizontal Scroll */
.navbar.bg-body-tertiary {
    overflow: visible !important;
    position: relative;
    z-index: 1030;
}

.admin-nav-scroll {
    /* Allow dropdowns to escape on desktop */
    overflow: visible !important;
    max-width: 100%;
    padding-bottom: 4px;
}

/* Only enable horizontal scroll on tablet where we need it */
@media (min-width: 768px) and (max-width: 991.98px) {
    .admin-nav-scroll {
        overflow-x: auto !important;
        overflow-y: visible !important;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: rgba(0,0,0,0.2) transparent;
    }
}

.admin-nav-scroll::-webkit-scrollbar {
    height: 4px;
}

.admin-nav-scroll::-webkit-scrollbar-track {
    background: transparent;
}

.admin-nav-scroll::-webkit-scrollbar-thumb {
    background-color: rgba(0,0,0,0.2);
    border-radius: 4px;
}

.admin-nav-scroll .navbar-nav {
    display: flex;
    flex-wrap: nowrap;
    gap: 0.125rem;
    width: max-content;
    min-width: 100%;
}

/* Nav item styling for horizontal scroll */
.admin-nav-scroll .nav-item {
    flex-shrink: 0;
}

.admin-nav-scroll .nav-link {
    white-space: nowrap;
    padding: 0.35rem 0.4rem;
    font-size: 0.75rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
    color: var(--bs-body-color, var(--ecs-neutral-60, #52525B));
}

.admin-nav-scroll .nav-link:hover {
    background-color: rgba(var(--ecs-primary-rgb, 124, 58, 237), 0.1);
    color: var(--ecs-primary, #7C3AED);
}

.admin-nav-scroll .nav-link.active,
.admin-nav-scroll .nav-link.ecs-active {
    background-color: var(--ecs-primary, #7C3AED);
    color: white !important;
}

/* Dark mode nav link colors */
[data-style="dark"] .admin-nav-scroll .nav-link {
    color: var(--ecs-dark-text-muted, #A1A1AA) !important;
}

[data-style="dark"] .admin-nav-scroll .nav-link:hover {
    background-color: rgba(var(--ecs-primary-rgb, 167, 139, 250), 0.15);
    color: var(--ecs-primary-light, #A78BFA) !important;
}

[data-style="dark"] .admin-nav-scroll .nav-link.active,
[data-style="dark"] .admin-nav-scroll .nav-link.ecs-active {
    background-color: var(--ecs-primary, #A78BFA);
    color: var(--ecs-dark-bg-body, #09090B) !important;
}

/* =====================================================
   ADMIN PANEL DROPDOWN STYLES - HIGH SPECIFICITY
   These styles MUST override Bootstrap/Sneat defaults
   ===================================================== */

/* Dropdown menus - Maximum specificity selectors */
.admin-nav-scroll .dropdown-menu,
.admin-nav-scroll .dropdown-menu.show,
.admin-nav-scroll ul.dropdown-menu,
.admin-nav-scroll ul.dropdown-menu.show,
.navbar .admin-nav-scroll .dropdown-menu,
.navbar .admin-nav-scroll .dropdown-menu.show,
.navbar .admin-nav-scroll ul.dropdown-menu,
.navbar .admin-nav-scroll ul.dropdown-menu.show,
ul.dropdown-menu[data-bs-popper],
ul.dropdown-menu[data-bs-popper="static"],
.admin-nav-scroll .nav-item.dropdown > .dropdown-menu {
    position: absolute !important;
    z-index: 9999 !important;
    background: #ffffff !important;
    background-color: #ffffff !important;
    border: 1px solid #d1d5db !important;
    border-radius: 0.5rem !important;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1) !important;
    padding: 0.5rem 0 !important;
    min-width: 220px !important;
    margin-top: 0.125rem !important;
    top: 100% !important;
    left: 0 !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    opacity: 1 !important;
}

/* Dark mode dropdown backgrounds - Maximum specificity */
[data-style="dark"] .admin-nav-scroll .dropdown-menu,
[data-style="dark"] .admin-nav-scroll .dropdown-menu.show,
[data-style="dark"] .admin-nav-scroll ul.dropdown-menu,
[data-style="dark"] .admin-nav-scroll ul.dropdown-menu.show,
[data-style="dark"] .navbar .admin-nav-scroll .dropdown-menu,
[data-style="dark"] ul.dropdown-menu[data-bs-popper],
[data-style="dark"] ul.dropdown-menu[data-bs-popper="static"],
[data-style="dark"] .admin-nav-scroll .nav-item.dropdown > .dropdown-menu,
html[data-style="dark"] .admin-nav-scroll .dropdown-menu,
html[data-style="dark"] .admin-nav-scroll .dropdown-menu.show,
body[data-style="dark"] .admin-nav-scroll .dropdown-menu,
body[data-style="dark"] .admin-nav-scroll .dropdown-menu.show {
    background: #27272a !important;
    background-color: #27272a !important;
    border-color: #3f3f46 !important;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6), 0 4px 12px rgba(0, 0, 0, 0.4) !important;
}

/* Dropdown items styling - Light Mode */
.admin-nav-scroll .dropdown-item,
.admin-nav-scroll .dropdown-menu .dropdown-item,
.admin-nav-scroll a.dropdown-item,
.navbar .admin-nav-scroll .dropdown-item {
    padding: 0.5rem 1rem !important;
    color: #1f2937 !important;
    font-weight: 500 !important;
    font-size: 0.8125rem !important;
    transition: all 0.15s ease !important;
    background: transparent !important;
    background-color: transparent !important;
}

.admin-nav-scroll .dropdown-item i,
.admin-nav-scroll .dropdown-menu .dropdown-item i {
    color: #6b7280 !important;
}

.admin-nav-scroll .dropdown-item:hover,
.admin-nav-scroll .dropdown-item:focus,
.admin-nav-scroll .dropdown-menu .dropdown-item:hover,
.admin-nav-scroll .dropdown-menu .dropdown-item:focus {
    background: rgba(124, 58, 237, 0.1) !important;
    background-color: rgba(124, 58, 237, 0.1) !important;
    color: #7c3aed !important;
}

.admin-nav-scroll .dropdown-item:hover i,
.admin-nav-scroll .dropdown-item:focus i {
    color: #7c3aed !important;
}

/* Dark mode dropdown items - Maximum specificity */
[data-style="dark"] .admin-nav-scroll .dropdown-item,
[data-style="dark"] .admin-nav-scroll .dropdown-menu .dropdown-item,
[data-style="dark"] .admin-nav-scroll a.dropdown-item,
html[data-style="dark"] .admin-nav-scroll .dropdown-item,
body[data-style="dark"] .admin-nav-scroll .dropdown-item {
    color: #e5e7eb !important;
    background: transparent !important;
    background-color: transparent !important;
}

[data-style="dark"] .admin-nav-scroll .dropdown-item i,
[data-style="dark"] .admin-nav-scroll .dropdown-menu .dropdown-item i,
html[data-style="dark"] .admin-nav-scroll .dropdown-item i {
    color: #a1a1aa !important;
}

[data-style="dark"] .admin-nav-scroll .dropdown-item:hover,
[data-style="dark"] .admin-nav-scroll .dropdown-item:focus,
[data-style="dark"] .admin-nav-scroll .dropdown-menu .dropdown-item:hover,
[data-style="dark"] .admin-nav-scroll .dropdown-menu .dropdown-item:focus,
html[data-style="dark"] .admin-nav-scroll .dropdown-item:hover,
html[data-style="dark"] .admin-nav-scroll .dropdown-item:focus {
    background: rgba(167, 139, 250, 0.2) !important;
    background-color: rgba(167, 139, 250, 0.2) !important;
    color: #c4b5fd !important;
}

[data-style="dark"] .admin-nav-scroll .dropdown-item:hover i,
[data-style="dark"] .admin-nav-scroll .dropdown-item:focus i,
html[data-style="dark"] .admin-nav-scroll .dropdown-item:hover i {
    color: #c4b5fd !important;
}

/* Dropdown headers - High specificity */
.admin-nav-scroll .dropdown-header,
.admin-nav-scroll .dropdown-menu .dropdown-header,
.admin-nav-scroll li.dropdown-header,
.navbar .admin-nav-scroll .dropdown-header {
    color: #6b7280 !important;
    font-weight: 600 !important;
    font-size: 0.6875rem !important;
    text-transform: uppercase !important;
    letter-spacing: 0.05em !important;
    padding: 0.5rem 1rem 0.25rem !important;
    background: transparent !important;
    background-color: transparent !important;
}

[data-style="dark"] .admin-nav-scroll .dropdown-header,
[data-style="dark"] .admin-nav-scroll .dropdown-menu .dropdown-header,
[data-style="dark"] .admin-nav-scroll li.dropdown-header,
html[data-style="dark"] .admin-nav-scroll .dropdown-header {
    color: #a1a1aa !important;
}

/* Dropdown dividers */
.admin-nav-scroll .dropdown-divider,
.admin-nav-scroll .dropdown-menu .dropdown-divider,
.admin-nav-scroll hr.dropdown-divider,
.navbar .admin-nav-scroll .dropdown-divider {
    border-color: #e5e7eb !important;
    margin: 0.5rem 0 !important;
    opacity: 1 !important;
    background: transparent !important;
}

[data-style="dark"] .admin-nav-scroll .dropdown-divider,
[data-style="dark"] .admin-nav-scroll .dropdown-menu .dropdown-divider,
[data-style="dark"] .admin-nav-scroll hr.dropdown-divider,
html[data-style="dark"] .admin-nav-scroll .dropdown-divider {
    border-color: #3f3f46 !important;
}

/* Navbar solid background */
.navbar.bg-body-tertiary {
    background: #ffffff !important;
    background-color: #ffffff !important;
    border: 1px solid #e5e7eb !important;
}

[data-style="dark"] .navbar.bg-body-tertiary,
html[data-style="dark"] .navbar.bg-body-tertiary,
body[data-style="dark"] .navbar.bg-body-tertiary {
    background: #18181b !important;
    background-color: #18181b !important;
    border-color: #3f3f46 !important;
}

/* Dropdown parent positioning */
.admin-nav-scroll .nav-item.dropdown {
    position: relative !important;
}

/* lg screens (992px-1199px): compact text + icons */
@media (min-width: 992px) {
    .admin-nav-scroll .nav-link-text {
        display: inline;
    }

    .admin-nav-scroll .nav-link {
        padding: 0.35rem 0.45rem;
        font-size: 0.7rem;
    }

    .admin-nav-scroll .nav-link i {
        margin-right: 0.15rem !important;
        font-size: 0.85rem;
    }
}

/* xl screens (1200px-1399px): slightly larger */
@media (min-width: 1200px) {
    .admin-nav-scroll .nav-link-text {
        display: inline;
    }

    .admin-nav-scroll .nav-link i {
        margin-right: 0.2rem !important;
        font-size: 0.9rem;
    }

    .admin-nav-scroll .nav-link {
        padding: 0.4rem 0.55rem;
        font-size: 0.78rem;
    }
}

/* xxl screens (1400px+): comfortable spacing */
@media (min-width: 1400px) {
    .admin-nav-scroll .nav-link {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
    }

    .admin-nav-scroll .nav-link i {
        margin-right: 0.25rem !important;
        font-size: 1rem;
    }
}

/* Tablet: horizontal scroll with indicator (768px-991px) */
@media (min-width: 768px) and (max-width: 991.98px) {
    .admin-nav-scroll {
        position: relative;
    }

    .admin-nav-scroll::after {
        content: '';
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 24px;
        background: linear-gradient(to right, transparent, var(--bs-body-bg, #fff));
        pointer-events: none;
        opacity: 0.8;
    }

    .admin-nav-scroll .nav-link {
        min-height: 44px;
        display: flex;
        align-items: center;
    }
}

/* Mobile collapsed menu styling */
@media (max-width: 767.98px) {
    .admin-nav-scroll {
        overflow-x: visible;
        overflow-y: visible;
        max-width: none;
    }

    .admin-nav-scroll .navbar-nav {
        flex-direction: column;
        flex-wrap: wrap;
        gap: 0.5rem;
        width: 100%;
        min-width: auto;
    }

    .admin-nav-scroll .nav-link {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
        min-height: 48px;
        display: flex;
        align-items: center;
        white-space: normal;
    }

    .admin-nav-scroll .nav-link-text {
        display: inline;
    }

    .admin-nav-scroll .nav-link i {
        margin-right: 0.5rem !important;
        flex-shrink: 0;
    }

    /* Dropdown menus full-width on mobile */
    .admin-nav-scroll .dropdown-menu,
    .admin-nav-scroll .dropdown-menu.show {
        position: static !important;
        width: 100%;
        margin-top: 0.25rem;
        box-shadow: none !important;
        border: 1px solid #e5e7eb !important;
        border-radius: 0.375rem !important;
        /* Ensure solid background on mobile too */
        background-color: #f9fafb !important;
        z-index: auto !important;
    }

    [data-style="dark"] .admin-nav-scroll .dropdown-menu,
    [data-style="dark"] .admin-nav-scroll .dropdown-menu.show {
        background-color: #262626 !important;
        border-color: #3F3F46 !important;
    }

    .admin-nav-scroll .dropdown-item {
        min-height: 44px;
        display: flex;
        align-items: center;
        padding: 0.625rem 1rem;
        color: #374151 !important;
    }

    [data-style="dark"] .admin-nav-scroll .dropdown-item {
        color: #d1d5db !important;
    }
}

/* Enhanced navigation styling */
.nav-pills .nav-link {
    color: var(--ecs-muted, #6c757d);
    border-radius: 0.5rem;
    padding: 0.75rem 1rem;
    transition: all 0.2s ease;
}

.nav-pills .nav-link:hover {
    background-color: rgba(13, 110, 253, 0.1);
    color: var(--ecs-primary, #0d6efd);
}

.nav-pills .nav-link.active {
    background-color: var(--ecs-primary, #0d6efd);
    color: white;
}

.nav-pills .nav-link i {
    font-size: 1.1rem;
}

/* Card hover effects */
.admin-card {
    transition: all 0.2s ease;
    cursor: pointer;
}

.admin-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

/* Status indicators */
.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 0.5rem;
}

.status-indicator.active {
    background-color: var(--ecs-success, #28a745);
    box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);
}

.status-indicator.inactive {
    background-color: var(--ecs-danger, #dc3545);
    box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2);
}

/* Additional page-specific styles can go here */
</style>
{% endblock %}

{% block custom_js %}
{{ super() }}
<script>
// Mobile-first JavaScript enhancements
document.addEventListener('DOMContentLoaded', function() {
    // Mobile navigation auto-collapse
    const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
    const navbarCollapse = document.querySelector('.navbar-collapse');
    
    navLinks.forEach(link => {
        link.addEventListener('click', () => {
            if (window.innerWidth < 992 && navbarCollapse && navbarCollapse.classList.contains('show')) {
                const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
                if (bsCollapse) {
                    bsCollapse.hide();
                }
            }
        });
    });
    
    // Touch gesture support for cards
    const adminCards = document.querySelectorAll('.admin-card');
    adminCards.forEach(card => {
        let touchStartY = 0;
        
        card.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        });
        
        card.addEventListener('touchend', (e) => {
            const touchEndY = e.changedTouches[0].clientY;
            const diff = touchStartY - touchEndY;
            
            // Simple swipe up gesture for card interaction
            if (Math.abs(diff) > 50 && diff > 0) {
                card.click();
            }
        });
    });
    
    // Progressive loading for heavy content
    if ('IntersectionObserver' in window) {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('loaded');
                }
            });
        });
        
        document.querySelectorAll('.lazy-load').forEach(el => {
            observer.observe(el);
        });
    }
    
    // Responsive table handling
    function handleResponsiveTables() {
        const tables = document.querySelectorAll('.table-responsive table');
        
        tables.forEach(table => {
            if (window.innerWidth < 768) {
                // Add mobile-friendly attributes
                const headers = table.querySelectorAll('th');
                const rows = table.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    cells.forEach((cell, index) => {
                        if (headers[index]) {
                            cell.setAttribute('data-label', headers[index].textContent);
                        }
                    });
                });
                
                // Add mobile stack class for very small screens
                if (window.innerWidth < 576) {
                    table.classList.add('table-mobile-stack');
                }
            } else {
                table.classList.remove('table-mobile-stack');
            }
        });
    }
    
    // Call on load and resize
    handleResponsiveTables();
    window.addEventListener('resize', handleResponsiveTables);
    
    // Network status monitoring
    function updateNetworkStatus() {
        const statusIndicator = document.querySelector('.network-status');
        if (statusIndicator) {
            if (navigator.onLine) {
                statusIndicator.className = 'network-status status-indicator active';
                statusIndicator.title = 'Online';
            } else {
                statusIndicator.className = 'network-status status-indicator danger';
                statusIndicator.title = 'Offline';
                
                // Show offline notification
                AdminPanel.showMobileToast('You are currently offline. Some features may not work.', 'warning');
            }
        }
    }
    
    window.addEventListener('online', () => {
        updateNetworkStatus();
        AdminPanel.showMobileToast('Connection restored', 'success');
    });
    
    window.addEventListener('offline', updateNetworkStatus);
    updateNetworkStatus();
    
    // Auto-refresh management for mobile battery optimization
    let autoRefreshInterval;
    function manageAutoRefresh() {
        if (window.innerWidth < 768) {
            // Clear any existing auto-refresh on mobile
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                console.log('Auto-refresh disabled on mobile for battery optimization');
            }
        }
    }
    
    window.addEventListener('resize', manageAutoRefresh);
    manageAutoRefresh();
    
    // Performance monitoring
    if ('PerformanceObserver' in window) {
        const observer = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            entries.forEach(entry => {
                if (entry.entryType === 'navigation') {
                    const loadTime = entry.loadEventEnd - entry.loadEventStart;
                    console.log('Page load time:', loadTime + 'ms');
                    
                    // Warn on slow loading for mobile
                    if (loadTime > 3000 && window.innerWidth < 768) {
                        console.warn('Slow page load detected on mobile');
                    }
                }
            });
        });
        
        try {
            observer.observe({ entryTypes: ['navigation'] });
        } catch (e) {
            console.log('Performance observer not fully supported');
        }
    }
    
    // Prevent double-tap zoom on buttons and forms
    document.querySelectorAll('button, .btn, input, select, textarea').forEach(element => {
        element.addEventListener('touchend', function(e) {
            e.preventDefault();
            this.click();
        });
        
        element.addEventListener('click', function(e) {
            if (e.detail > 1) {
                e.preventDefault();
            }
        });
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            const href = this.getAttribute('href');
            // Skip empty hash links (href="#") - they're not valid selectors
            if (!href || href === '#') {
                return;
            }
            e.preventDefault();
            try {
                const target = document.querySelector(href);
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            } catch (err) {
                // Invalid selector, ignore
                console.debug('Invalid anchor selector:', href);
            }
        });
    });
});

// Global mobile utilities
window.AdminPanel = {
    isMobile: () => window.innerWidth < 768,
    isTablet: () => window.innerWidth >= 768 && window.innerWidth < 992,
    isDesktop: () => window.innerWidth >= 992,
    
    showMobileToast: (message, type = 'info') => {
        // Mobile-optimized toast notifications
        const toast = document.createElement('div');
        toast.className = `toast align-items-center text-white bg-${type} border-0`;
        toast.setAttribute('role', 'alert');
        toast.innerHTML = `
            <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        `;
        
        const container = document.querySelector('.toast-container');
        if (container) {
            container.appendChild(toast);
            
            const toastInstance = new bootstrap.Toast(toast, {
                autohide: true,
                delay: AdminPanel.isMobile() ? 3000 : 5000
            });
            
            toastInstance.show();
            
            toast.addEventListener('hidden.bs.toast', () => {
                toast.remove();
            });
        }
    },
    
    confirmAction: (message, callback) => {
        if (AdminPanel.isMobile()) {
            // Use native confirm on mobile for better UX
            if (confirm(message)) {
                callback();
            }
        } else {
            // Use SweetAlert2 on desktop if available
            if (typeof Swal !== 'undefined') {
                Swal.fire({
                    title: 'Confirm Action',
                    text: message,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Yes',
                    cancelButtonText: 'No'
                }).then((result) => {
                    if (result.isConfirmed) {
                        callback();
                    }
                });
            } else {
                if (confirm(message)) {
                    callback();
                }
            }
        }
    },
    
    showLoading: (element) => {
        if (element) {
            element.classList.add('loading');
        }
    },
    
    hideLoading: (element) => {
        if (element) {
            element.classList.remove('loading');
        }
    },
    
    // Optimized fetch for mobile
    fetch: async (url, options = {}) => {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), AdminPanel.isMobile() ? 10000 : 30000);
        
        try {
            const response = await fetch(url, {
                ...options,
                signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            return response;
        } catch (error) {
            clearTimeout(timeoutId);
            
            if (error.name === 'AbortError') {
                AdminPanel.showMobileToast('Request timed out. Please try again.', 'warning');
            } else if (!navigator.onLine) {
                AdminPanel.showMobileToast('No internet connection. Please check your network.', 'danger');
            }
            
            throw error;
        }
    }
};

// Register service worker for offline support
if ('serviceWorker' in navigator && 'caches' in window) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/js/sw.js')
            .then(registration => {
                console.log('SW registered:', registration);
            })
            .catch(error => {
                console.log('SW registration failed:', error);
            });
    });
}

// Prevent iOS bounce scroll
document.body.addEventListener('touchstart', function(e) {
    if (e.target === document.body) {
        e.preventDefault();
    }
}, { passive: false });

document.body.addEventListener('touchend', function(e) {
    if (e.target === document.body) {
        e.preventDefault();
    }
}, { passive: false });

document.body.addEventListener('touchmove', function(e) {
    if (e.target === document.body) {
        e.preventDefault();
    }
}, { passive: false });
</script>
{% endblock %}