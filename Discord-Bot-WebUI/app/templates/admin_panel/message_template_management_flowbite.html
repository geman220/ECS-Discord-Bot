{% extends "admin_panel/base_flowbite.html" %}
{% from 'macros/flowbite.html' import card, button, badge, alert %}

{% block admin_title %}Message Template Management{% endblock %}
{% block panel_description %}Manage message templates and categories{% endblock %}

{% block breadcrumb_items %}
<li>
    <div class="flex items-center">
        <i class="ti ti-chevron-right w-4 h-4 text-gray-400"></i>
        <span class="ml-1 text-sm font-medium text-gray-500 dark:text-gray-400">Message Template Management</span>
    </div>
</li>
{% endblock %}

{% block panel_content %}
<!-- Template Overview Stats -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg shadow p-5">
        <div class="flex items-center">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/50 mr-4">
                <i class="ti ti-template text-2xl text-blue-600 dark:text-blue-400"></i>
            </div>
            <div>
                <h3 class="text-2xl font-bold text-blue-600 dark:text-blue-400">{{ stats.total_templates or 0 }}</h3>
                <span class="text-sm text-blue-700 dark:text-blue-300">Total Templates</span>
            </div>
        </div>
    </div>
    <div class="bg-green-50 dark:bg-green-900/30 rounded-lg shadow p-5">
        <div class="flex items-center">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/50 mr-4">
                <i class="ti ti-check-circle text-2xl text-green-600 dark:text-green-400"></i>
            </div>
            <div>
                <h3 class="text-2xl font-bold text-green-600 dark:text-green-400">{{ stats.active_templates or 0 }}</h3>
                <span class="text-sm text-green-700 dark:text-green-300">Active Templates</span>
            </div>
        </div>
    </div>
    <div class="bg-cyan-50 dark:bg-cyan-900/30 rounded-lg shadow p-5">
        <div class="flex items-center">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-cyan-100 dark:bg-cyan-900/50 mr-4">
                <i class="ti ti-category text-2xl text-cyan-600 dark:text-cyan-400"></i>
            </div>
            <div>
                <h3 class="text-2xl font-bold text-cyan-600 dark:text-cyan-400">{{ stats.total_categories or 0 }}</h3>
                <span class="text-sm text-cyan-700 dark:text-cyan-300">Categories</span>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow mb-6">
    <div class="p-5 border-b border-gray-200 dark:border-gray-700">
        <h5 class="text-lg font-semibold text-gray-900 dark:text-white">
            <i class="ti ti-bolt mr-2"></i>Quick Actions
        </h5>
    </div>
    <div class="p-5">
        <div class="flex flex-wrap gap-3">
            <button type="button" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700" data-action="create-template">
                <i class="ti ti-plus mr-1"></i>New Template
            </button>
            <button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-600" data-action="create-category">
                <i class="ti ti-category mr-1"></i>New Category
            </button>
            <button type="button" class="px-4 py-2 text-sm font-medium text-green-700 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800" data-action="bulk-activate">
                <i class="ti ti-checks mr-1"></i>Bulk Activate
            </button>
            <button type="button" class="px-4 py-2 text-sm font-medium text-cyan-700 bg-cyan-50 border border-cyan-200 rounded-lg hover:bg-cyan-100 dark:bg-cyan-900/30 dark:text-cyan-400 dark:border-cyan-800" data-action="export-templates">
                <i class="ti ti-download mr-1"></i>Export All
            </button>
        </div>
    </div>
</div>

<!-- Templates by Category -->
{% if categories %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
    {% for category in categories %}
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
        <div class="p-5 border-b border-gray-200 dark:border-gray-700">
            <div class="flex justify-between items-center">
                <h6 class="text-md font-semibold text-gray-900 dark:text-white">
                    <i class="ti ti-folder mr-2 text-blue-500"></i>{{ category.name }}
                </h6>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">{{ category.templates|length }} templates</span>
            </div>
            {% if category.description %}
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">{{ category.description }}</p>
            {% endif %}
        </div>
        <div class="p-5">
            {% if category.templates %}
            <div class="space-y-2">
                {% for template in category.templates[:5] %}
                <a href="#" class="block p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-action="view-template" data-template-id="{{ template.id }}">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium text-gray-900 dark:text-white">{{ template.name }}</div>
                            {% if template.description %}
                            <p class="text-sm text-gray-500 dark:text-gray-400">{{ template.description[:60] }}{% if template.description|length > 60 %}...{% endif %}</p>
                            {% endif %}
                        </div>
                        <div class="flex items-center gap-2">
                            {% if template.is_active %}
                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">Active</span>
                            {% else %}
                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Inactive</span>
                            {% endif %}
                            <i class="ti ti-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                </a>
                {% endfor %}
                {% if category.templates|length > 5 %}
                <a href="#" class="block p-3 text-center text-sm text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400" data-action="view-category" data-category-id="{{ category.id }}">
                    View {{ category.templates|length - 5 }} more templates...
                </a>
                {% endif %}
            </div>
            {% else %}
            <div class="text-center py-6">
                <i class="ti ti-inbox text-4xl text-gray-400 dark:text-gray-500 mb-2"></i>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-3">No templates in this category yet.</p>
                <button type="button" class="px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800" data-action="create-template-in-category" data-category-id="{{ category.id }}">
                    <i class="ti ti-plus mr-1"></i>Add Template
                </button>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="p-4 mb-6 text-sm text-blue-800 rounded-lg bg-blue-50 dark:bg-blue-900/50 dark:text-blue-300">
    <div class="flex items-center">
        <i class="ti ti-info-circle mr-2 text-lg"></i>
        <div>
            <strong>No Categories Found</strong><br>
            Start by creating categories to organize your message templates.
            <button type="button" class="ml-2 px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700" data-action="create-category">
                <i class="ti ti-plus mr-1"></i>Create First Category
            </button>
        </div>
    </div>
</div>
{% endif %}

<!-- All Templates Table -->
{% if templates %}
<div class="bg-white dark:bg-gray-800 rounded-lg shadow">
    <div class="p-5 border-b border-gray-200 dark:border-gray-700">
        <h5 class="text-lg font-semibold text-gray-900 dark:text-white">
            <i class="ti ti-list mr-2"></i>All Templates
        </h5>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                <tr>
                    <th scope="col" class="px-4 py-3">Template Name</th>
                    <th scope="col" class="px-4 py-3">Category</th>
                    <th scope="col" class="px-4 py-3">Status</th>
                    <th scope="col" class="px-4 py-3">Last Updated</th>
                    <th scope="col" class="px-4 py-3">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for template in templates[:20] %}
                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td class="px-4 py-3">
                        <div class="font-medium text-gray-900 dark:text-white">{{ template.name }}</div>
                        {% if template.description %}
                        <p class="text-xs text-gray-500 dark:text-gray-400">{{ template.description[:80] }}{% if template.description|length > 80 %}...{% endif %}</p>
                        {% endif %}
                    </td>
                    <td class="px-4 py-3">
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">{{ template.category.name if template.category else 'Uncategorized' }}</span>
                    </td>
                    <td class="px-4 py-3">
                        {% if template.is_active %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">Active</span>
                        {% else %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300">Inactive</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-3 text-sm">{{ template.updated_at.strftime('%Y-%m-%d') if template.updated_at else 'Never' }}</td>
                    <td class="px-4 py-3">
                        <div class="flex items-center gap-1">
                            <button type="button" class="p-2 text-blue-600 hover:bg-blue-100 dark:hover:bg-blue-900/30 rounded-lg" data-action="view-template" data-template-id="{{ template.id }}" title="View">
                                <i class="ti ti-eye"></i>
                            </button>
                            <button type="button" class="p-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg" data-action="edit-template" data-template-id="{{ template.id }}" title="Edit">
                                <i class="ti ti-edit"></i>
                            </button>
                            <button type="button" class="p-2 {% if template.is_active %}text-yellow-600 hover:bg-yellow-100 dark:hover:bg-yellow-900/30{% else %}text-green-600 hover:bg-green-100 dark:hover:bg-green-900/30{% endif %} rounded-lg" data-action="toggle-template" data-template-id="{{ template.id }}" title="Toggle">
                                <i class="ti ti-{% if template.is_active %}power{% else %}check{% endif %}"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% if templates|length > 20 %}
    <div class="p-4 text-center">
        <button type="button" class="px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800" data-action="load-more-templates">
            Load More Templates ({{ templates|length - 20 }} remaining)
        </button>
    </div>
    {% endif %}
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const isDark = document.documentElement.classList.contains('dark');

    document.addEventListener('click', function(e) {
        const target = e.target.closest('[data-action]');
        if (!target) return;

        const action = target.dataset.action;

        switch (action) {
            case 'create-template':
                e.preventDefault();
                createTemplate();
                break;
            case 'create-category':
                e.preventDefault();
                createCategory();
                break;
            case 'bulk-activate':
                e.preventDefault();
                bulkActivate();
                break;
            case 'export-templates':
                e.preventDefault();
                exportTemplates();
                break;
            case 'view-template':
                e.preventDefault();
                viewTemplate(target.dataset.templateId);
                break;
            case 'edit-template':
                e.preventDefault();
                editTemplate(target.dataset.templateId);
                break;
            case 'toggle-template':
                e.preventDefault();
                toggleTemplate(target.dataset.templateId);
                break;
            case 'view-category':
                e.preventDefault();
                viewCategory(target.dataset.categoryId);
                break;
            case 'create-template-in-category':
                e.preventDefault();
                createTemplateInCategory(target.dataset.categoryId);
                break;
        }
    });

    function createTemplate() {
        Swal.fire({
            title: 'Create New Template',
            html: `
                <div class="text-left space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Template Name</label>
                        <input type="text" id="templateName" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter template name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                        <select id="templateCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="">Select a category...</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                        <textarea id="templateDescription" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Template description (optional)"></textarea>
                    </div>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'Create Template',
            confirmButtonColor: '#1a472a',
            background: isDark ? '#1f2937' : '#ffffff',
            color: isDark ? '#f3f4f6' : '#111827',
            preConfirm: () => {
                const name = document.getElementById('templateName').value;
                if (!name) {
                    Swal.showValidationMessage('Template name is required');
                    return false;
                }
                return {
                    name,
                    category: document.getElementById('templateCategory').value,
                    description: document.getElementById('templateDescription').value
                };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const formData = new FormData();
                formData.append('name', result.value.name);
                formData.append('description', result.value.description || '');
                formData.append('category_id', result.value.category || '');
                formData.append('content', '');
                formData.append('is_active', 'on');

                fetch('{{ url_for("admin_panel.create_message_template") }}', {
                    method: 'POST',
                    headers: { 'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '' },
                    body: formData
                })
                .then(response => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Created!',
                        text: 'Template has been created successfully.',
                        background: isDark ? '#1f2937' : '#ffffff',
                        color: isDark ? '#f3f4f6' : '#111827'
                    }).then(() => window.location.reload());
                })
                .catch(error => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to create template.',
                        background: isDark ? '#1f2937' : '#ffffff',
                        color: isDark ? '#f3f4f6' : '#111827'
                    });
                });
            }
        });
    }

    function createCategory() {
        Swal.fire({
            title: 'Create New Category',
            html: `
                <div class="text-left space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category Name</label>
                        <input type="text" id="categoryName" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter category name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                        <textarea id="categoryDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Category description (optional)"></textarea>
                    </div>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'Create Category',
            confirmButtonColor: '#1a472a',
            background: isDark ? '#1f2937' : '#ffffff',
            color: isDark ? '#f3f4f6' : '#111827',
            preConfirm: () => {
                const name = document.getElementById('categoryName').value;
                if (!name) {
                    Swal.showValidationMessage('Category name is required');
                    return false;
                }
                return { name, description: document.getElementById('categoryDescription').value };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                const formData = new FormData();
                formData.append('name', result.value.name);
                formData.append('description', result.value.description || '');

                fetch('{{ url_for("admin_panel.create_message_category") }}', {
                    method: 'POST',
                    headers: { 'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '' },
                    body: formData
                })
                .then(response => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Created!',
                        text: 'Category has been created successfully.',
                        background: isDark ? '#1f2937' : '#ffffff',
                        color: isDark ? '#f3f4f6' : '#111827'
                    }).then(() => window.location.reload());
                })
                .catch(error => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to create category.',
                        background: isDark ? '#1f2937' : '#ffffff',
                        color: isDark ? '#f3f4f6' : '#111827'
                    });
                });
            }
        });
    }

    function viewTemplate(templateId) {
        fetch(`/admin-panel/communication/messages/template/${templateId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success && data.template) {
                    const t = data.template;
                    Swal.fire({
                        title: t.name,
                        html: `
                            <div class="text-left">
                                <p><strong>Category:</strong> ${t.category || 'Uncategorized'}</p>
                                <p><strong>Status:</strong> <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${t.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">${t.is_active ? 'Active' : 'Inactive'}</span></p>
                                ${t.description ? `<p><strong>Description:</strong> ${t.description}</p>` : ''}
                                <hr class="my-3">
                                <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
                                    <pre class="whitespace-pre-wrap text-sm">${t.content || 'No content'}</pre>
                                </div>
                            </div>
                        `,
                        width: '600px',
                        confirmButtonText: 'Close',
                        confirmButtonColor: '#1a472a',
                        background: isDark ? '#1f2937' : '#ffffff',
                        color: isDark ? '#f3f4f6' : '#111827'
                    });
                }
            });
    }

    function editTemplate(templateId) {
        window.location.href = `/admin-panel/communication/messages/template/${templateId}/edit`;
    }

    function toggleTemplate(templateId) {
        Swal.fire({
            title: 'Toggle Template Status?',
            text: 'This will change the active status of the template.',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Toggle Status',
            confirmButtonColor: '#1a472a',
            background: isDark ? '#1f2937' : '#ffffff',
            color: isDark ? '#f3f4f6' : '#111827'
        }).then((result) => {
            if (result.isConfirmed) {
                const formData = new FormData();
                formData.append('template_id', templateId);

                fetch('{{ url_for("admin_panel.toggle_message_template") }}', {
                    method: 'POST',
                    headers: { 'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '' },
                    body: formData
                })
                .then(response => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Updated!',
                        text: 'Template status has been toggled.',
                        background: isDark ? '#1f2937' : '#ffffff',
                        color: isDark ? '#f3f4f6' : '#111827'
                    }).then(() => window.location.reload());
                });
            }
        });
    }

    function viewCategory(categoryId) {
        window.location.href = `/admin-panel/communication/messages/category/${categoryId}`;
    }

    function createTemplateInCategory(categoryId) {
        Swal.fire({
            title: 'Create New Template',
            html: `
                <div class="text-left space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Template Name</label>
                        <input type="text" id="templateName" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter template name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                        <textarea id="templateDescription" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Template description (optional)"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Content</label>
                        <textarea id="templateContent" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter template content..."></textarea>
                    </div>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'Create Template',
            confirmButtonColor: '#1a472a',
            background: isDark ? '#1f2937' : '#ffffff',
            color: isDark ? '#f3f4f6' : '#111827',
            preConfirm: () => {
                const name = document.getElementById('templateName').value;
                if (!name) {
                    Swal.showValidationMessage('Template name is required');
                    return false;
                }
                return {
                    name,
                    category_id: categoryId,
                    description: document.getElementById('templateDescription').value,
                    content: document.getElementById('templateContent').value
                };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                fetch('/admin-panel/communication/messages/templates/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('meta[name=csrf-token]')?.getAttribute('content')
                    },
                    body: JSON.stringify(result.value)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Created!',
                            text: 'Template has been created.',
                            background: isDark ? '#1f2937' : '#ffffff',
                            color: isDark ? '#f3f4f6' : '#111827'
                        }).then(() => location.reload());
                    }
                });
            }
        });
    }

    function bulkActivate() {
        Swal.fire({
            title: 'Bulk Activate Templates',
            text: 'This will activate all currently inactive templates. Are you sure?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Activate All Inactive',
            confirmButtonColor: '#1a472a',
            background: isDark ? '#1f2937' : '#ffffff',
            color: isDark ? '#f3f4f6' : '#111827'
        }).then((result) => {
            if (result.isConfirmed) {
                fetch('/admin-panel/communication/messages/templates/bulk-activate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('meta[name=csrf-token]')?.getAttribute('content')
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Activated!',
                            text: `${data.count || 'All'} templates have been activated.`,
                            background: isDark ? '#1f2937' : '#ffffff',
                            color: isDark ? '#f3f4f6' : '#111827'
                        }).then(() => location.reload());
                    }
                });
            }
        });
    }

    function exportTemplates() {
        Swal.fire({
            title: 'Export Templates',
            html: `
                <div class="space-y-3">
                    <p class="text-sm text-gray-600 dark:text-gray-400">Choose export format:</p>
                    <a href="/admin-panel/communication/messages/templates/export?format=json" class="block w-full px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800">
                        <i class="ti ti-file-code mr-2"></i>Export as JSON
                    </a>
                    <a href="/admin-panel/communication/messages/templates/export?format=csv" class="block w-full px-4 py-2 text-sm font-medium text-green-600 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800">
                        <i class="ti ti-file-spreadsheet mr-2"></i>Export as CSV
                    </a>
                </div>
            `,
            showConfirmButton: false,
            showCancelButton: true,
            cancelButtonText: 'Close',
            background: isDark ? '#1f2937' : '#ffffff',
            color: isDark ? '#f3f4f6' : '#111827'
        });
    }
});
</script>
{% endblock %}
