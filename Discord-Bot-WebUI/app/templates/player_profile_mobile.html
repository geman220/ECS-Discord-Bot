{% extends "mobile_base.html" %}

{% block title %}Update Your Profile - {{ player.name }}{% endblock %}

{% block main_content %}
<div class="container-fluid py-3" data-component="profile-mobile">
    <!-- Header Card -->
    <div class="c-profile-header c-profile-header--mobile" data-component="profile-header">
        <div class="c-profile-header__body">
            <div class="c-profile-header__avatar-wrapper">
                {% if player.profile_picture_url %}
                <img src="{{ player.profile_picture_url %}?v={{ player.updated_at.timestamp() }}"
                     class="c-profile-header__avatar c-profile-header__avatar--lg"
                     alt="Profile Picture">
                {% else %}
                <img src="{{ url_for('static', filename='img/default_player.png') }}"
                     class="c-profile-header__avatar c-profile-header__avatar--lg"
                     alt="Default Profile Picture">
                {% endif %}
            </div>
            <h3 class="c-profile-header__name">{{ player.name }}</h3>
            {% if player.teams %}
                {% for team in player.teams %}
                <span class="c-badge c-badge--team" data-badge>{{ team.name }}</span>
                {% endfor %}
            {% endif %}
        </div>
    </div>

    <!-- Welcome Message -->
    <div class="c-welcome-c-card" data-component="welcome-card">
        <div class="c-welcome-card__body">
            <h4 class="c-welcome-card__title">
                <i class="ti ti-trophy"></i>Welcome to the New Season!
            </h4>
            <p class="c-welcome-card__text">We are so excited for this season! Please update your profile so your coaches have accurate information for this upcoming season.</p>
        </div>
    </div>

    <!-- Profile Status Alert -->
    {% if profile_expired %}
    <div class="c-alert c-alert--warning" role="alert" data-component="alert">
        <i class="ti ti-alert-circle c-alert__icon"></i>
        <div class="c-alert__content">
            <h5 class="c-alert__heading">Profile Review Required</h5>
            <p class="c-alert__text">Your profile hasn't been updated in over 5 months. Please review and confirm your information is current.</p>
        </div>
    </div>
    {% else %}
    <div class="c-alert c-alert--info" role="alert" data-component="alert">
        <i class="ti ti-info-circle c-alert__icon"></i>
        <p class="c-alert__text">Please review your profile information below.</p>
    </div>
    {% endif %}

    <!-- Instructions -->
    <div class="c-alert c-alert--info" role="alert" data-component="alert">
        <i class="ti ti-info-circle c-alert__icon"></i>
        <div class="c-alert__content">
            <h6 class="c-alert__heading">Please Review Your Information</h6>
            <p class="c-alert__text">Check all your details below and make any necessary updates. If everything looks correct, you can confirm your profile at the bottom.</p>
        </div>
    </div>

    <!-- Profile Update Form -->
    <form method="POST" action="{{ url_for('players.mobile_profile_update', player_id=player.id) }}" data-component="profile-form">
        {{ form.hidden_tag() }}

        <!-- Contact Information -->
        <div class="c-form-section" data-component="form-section">
            <div class="c-form-section__header">
                <h5 class="c-form-section__title">Contact Information</h5>
            </div>
            <div class="c-form-section__body">
                <div class="c-form-field" data-form-field>
                    {{ form.name.label(class="c-form-field__label") }}
                    {{ form.name(class="form-control form-control-lg", placeholder="Your full name") }}
                </div>

                <div class="c-form-field" data-form-field>
                    {{ form.email.label(class="c-form-field__label") }}
                    {{ form.email(class="form-control form-control-lg", placeholder="your@email.com") }}
                </div>

                <div class="c-form-field" data-form-field>
                    {{ form.phone.label(class="c-form-field__label") }}
                    {{ form.phone(class="form-control form-control-lg", placeholder="(555) 123-4567") }}
                </div>

                <div class="c-form-field" data-form-field>
                    {{ form.jersey_size.label(class="c-form-field__label") }}
                    {{ form.jersey_size(class="form-select form-select-lg") }}
                </div>

                <div class="c-form-field" data-form-field>
                    {{ form.pronouns.label(class="c-form-field__label") }}
                    {{ form.pronouns(class="form-select form-select-lg") }}
                </div>
            </div>
        </div>

        <!-- Playing Preferences -->
        <div class="c-form-section" data-component="form-section">
            <div class="c-form-section__header">
                <h5 class="c-form-section__title">Playing Preferences</h5>
            </div>
            <div class="c-form-section__body">
                <div class="c-form-field" data-form-field>
                    {{ form.expected_weeks_available.label(class="c-form-field__label") }}
                    {{ form.expected_weeks_available(class="form-select form-select-lg") }}
                </div>

                <div class="c-form-field" data-form-field>
                    {{ form.favorite_position.label(class="c-form-field__label") }}
                    {{ form.favorite_position(class="form-select form-select-lg") }}
                </div>

                <div class="c-form-field" data-form-field>
                    {{ form.frequency_play_goal.label(class="c-form-field__label") }}
                    <small class="c-form-field__help">How often would you like to play goalkeeper?</small>
                    {{ form.frequency_play_goal(class="form-select form-select-lg") }}
                </div>

                <div class="c-form-field" data-form-field>
                    {{ form.other_positions.label(class="c-form-field__label") }}
                    <small class="c-form-field__help">Select all positions you enjoy playing</small>
                    {{ form.other_positions(class="form-select form-select-lg select-height-120", multiple=True) }}
                </div>

                <div class="c-form-field" data-form-field>
                    {{ form.positions_not_to_play.label(class="c-form-field__label") }}
                    <small class="c-form-field__help">Select positions you prefer not to play</small>
                    {{ form.positions_not_to_play(class="form-select form-select-lg select-height-120", multiple=True) }}
                </div>

                <div class="c-form-field" data-form-field>
                    {{ form.willing_to_referee.label(class="c-form-field__label") }}
                    {{ form.willing_to_referee(class="form-select form-select-lg") }}
                </div>
            </div>
        </div>

        <!-- Player Notes -->
        <div class="c-form-section" data-component="form-section">
            <div class="c-form-section__header">
                <h5 class="c-form-section__title">Additional Notes</h5>
            </div>
            <div class="c-form-section__body">
                <div class="c-form-field" data-form-field>
                    {{ form.player_notes.label(class="c-form-field__label") }}
                    <small class="c-form-field__help">Any additional information about your playing preferences or availability</small>
                    {{ form.player_notes(class="form-control", rows=4, placeholder="E.g., I can't play on specific dates, injury concerns, etc.") }}
                </div>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div class="c-form-actions" data-component="form-actions">
            <button type="submit" name="update_profile" class="c-btn c-btn--primary c-btn--lg" data-action="save-profile">
                <i class="ti ti-device-floppy"></i>Save All Changes
            </button>
        </div>
    </form>

    <!-- Quick Confirm Section -->
    <div class="c-verify-c-card c-verify-card--success" data-component="verify-card">
        <div class="c-verify-card__body">
            <h5 class="c-verify-card__title">
                <i class="ti ti-circle-check"></i>Profile Review Complete?
            </h5>
            <p class="c-verify-card__text">If you've reviewed all your information above and everything is accurate, click below to confirm:</p>
            <form method="POST" action="{{ url_for('players.mobile_profile_update', player_id=player.id) }}">
                {{ form.csrf_token }}
                <button type="submit" name="verify_profile" class="c-btn c-btn--success c-btn--lg w-100" data-action="verify-profile">
                    <i class="ti ti-shield-check"></i>Confirm Profile is Accurate
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<div data-profile-form-init
     data-unsaved-warning="true"></div>
<script src="{{ url_for('static', filename='custom_js/profile-form-handler.js') }}"></script>
{% endif %}
{% endblock %}
