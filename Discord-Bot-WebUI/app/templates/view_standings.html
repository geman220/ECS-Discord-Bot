{% extends "base.html" %}
{% import 'macros.html' as macros %}

{% block main_content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Page Header -->
    <div class="c-standings-header" data-component="standings-header">
        <div class="c-standings-header__content">
            <h2 class="c-standings-header__title">League Standings</h2>
            <p class="c-standings-header__subtitle">Current team rankings and statistics</p>
        </div>
        <div class="c-standings-header__actions">
            <select class="form-select form-select-sm" id="seasonSelector" data-form-select>
                <option selected>Current Season</option>
            </select>
        </div>
    </div>

    <!-- Tabs for Leagues -->
    <ul class="c-nav-modern c-nav-modern--pills" id="league-tabs" role="tablist" data-nav="standings-tabs">
        <li class="c-nav-modern__item" role="presentation">
            <button class="c-nav-modern__link c-nav-modern__link--active"
                    id="premier-tab"
                    data-bs-toggle="pill"
                    data-bs-target="#premier"
                    type="button"
                    role="tab"
                    aria-controls="premier"
                    aria-selected="true">
                <i class="ti ti-trophy c-nav-modern__icon"></i>Premier Division
            </button>
        </li>
        <li class="c-nav-modern__item" role="presentation">
            <button class="c-nav-modern__link"
                    id="classic-tab"
                    data-bs-toggle="pill"
                    data-bs-target="#classic"
                    type="button"
                    role="tab"
                    aria-controls="classic"
                    aria-selected="false">
                <i class="ti ti-ball-football c-nav-modern__icon"></i>Classic Division
            </button>
        </li>
        {% if ecsfc_standings %}
        <li class="c-nav-modern__item" role="presentation">
            <button class="c-nav-modern__link"
                    id="ecsfc-tab"
                    data-bs-toggle="pill"
                    data-bs-target="#ecsfc"
                    type="button"
                    role="tab"
                    aria-controls="ecsfc"
                    aria-selected="false">
                <i class="ti ti-shield c-nav-modern__icon"></i>ECS FC Division
            </button>
        </li>
        {% endif %}
    </ul>

    <!-- Tab Content -->
    <div class="c-tab-content-modern" id="leagueTabsContent">
        <!-- Premier Division Standings -->
        <div class="c-tab-pane-modern show active" id="premier" role="tabpanel" aria-labelledby="premier-tab">
            <div class="c-card-modern">
                <div class="c-card-modern__header">
                    <h5 class="c-card-modern__title">Premier Division Standings</h5>
                    <div class="c-card-modern__actions">
                        <span class="c-badge c-badge--primary" data-bs-toggle="tooltip" data-bs-placement="top" title="Teams are ranked by points, then goal difference, then goals scored" data-badge>
                            <i class="ti ti-info-circle"></i> Ranking Info
                        </span>
                    </div>
                </div>
                <div class="c-table-wrapper" data-table-responsive>
                    <table class="c-table c-table--hoverable" data-table>
                        <thead class="c-table--light" scope="col">
                            <tr>
                                <th class="text-center col-rank" scope="col">#</th>
                                <th class="col-team" scope="col">Team</th>
                                <th class="text-center" scope="col">P</th>
                                <th class="text-center" scope="col">W</th>
                                <th class="text-center" scope="col">D</th>
                                <th class="text-center" scope="col">L</th>
                                <th class="text-center" scope="col">GF</th>
                                <th class="text-center" scope="col">GA</th>
                                <th class="text-center" scope="col">GD</th>
                                <th class="text-center" scope="col">Pts</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for standing in premier_standings %}
                            {% set stats = premier_stats.get(standing.team.id, {'top_scorer_name': 'N/A', 'top_scorer_goals': 0, 'top_assister_name': 'N/A', 'top_assister_assists': 0, 'recent_form': 'N/A', 'avg_goals_per_match': 0}) %}
                            <tr>
                                <td class="text-center fw-bold" data-label="#">{{ loop.index }}</td>
                                <td data-label="Team">
                                    <div class="d-flex align-items-center">
                                        {{ macros.team_avatar(standing.team, 'sm', 'bg-success me-2') }}
                                        <a href="{{ url_for('teams.team_details', team_id=standing.team.id) }}"
                                           class="team-name"
                                           data-bs-toggle="popover"
                                           data-bs-trigger="hover"
                                           data-bs-placement="right"
                                           data-bs-html="true"
                                           data-bs-title="{{ standing.team.name }}"
                                           data-bs-content="
                                           <div class='team-stats-popover'>
                                               <div class='mb-2'><strong>Top Scorer:</strong> {{ stats['top_scorer_name'] }} ({{ stats['top_scorer_goals'] }} goals)</div>
                                               <div class='mb-2'><strong>Top Assister:</strong> {{ stats['top_assister_name'] }} ({{ stats['top_assister_assists'] }} assists)</div>
                                               <div class='mb-2'><strong>Recent Form:</strong> {{ stats['recent_form'] }}</div>
                                               <div><strong>Avg Goals:</strong> {{ stats['avg_goals_per_match'] }} per match</div>
                                           </div>">
                                            {{ standing.team.name }}
                                        </a>
                                    </div>
                                </td>
                                <td class="text-center" data-label="P">{{ standing.played }}</td>
                                <td class="text-center" data-label="W">{{ standing.wins }}</td>
                                <td class="text-center" data-label="D">{{ standing.draws }}</td>
                                <td class="text-center" data-label="L">{{ standing.losses }}</td>
                                <td class="text-center" data-label="GF">{{ standing.goals_for }}</td>
                                <td class="text-center" data-label="GA">{{ standing.goals_against }}</td>
                                <td class="text-center" data-label="GD">{{ standing.goal_difference }}</td>
                                <td class="text-center fw-bold" data-label="Pts">{{ standing.points }}</td>
                            </tr>
                            {% endfor %}
                            {% if premier_standings|length == 0 %}
                            <tr>
                                <td colspan="10" class="text-center p-4">
                                    <div class="c-empty-state" data-component="empty-state">
                                        <div class="c-empty-state__icon">
                                            <i class="ti ti-trophy"></i>
                                        </div>
                                        <p class="c-empty-state__text">No standings data available for Premier Division.</p>
                                    </div>
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Classic Division Standings -->
        <div class="c-tab-pane-modern" id="classic" role="tabpanel" aria-labelledby="classic-tab">
            <div class="c-card-modern">
                <div class="c-card-modern__header">
                    <h5 class="c-card-modern__title">Classic Division Standings</h5>
                    <div class="c-card-modern__actions">
                        <span class="c-badge c-badge--primary" data-bs-toggle="tooltip" data-bs-placement="top" title="Teams are ranked by points, then goal difference, then goals scored" data-badge>
                            <i class="ti ti-info-circle"></i> Ranking Info
                        </span>
                    </div>
                </div>
                <div class="c-table-wrapper" data-table-responsive>
                    <table class="c-table c-table--hoverable" data-table>
                        <thead class="c-table--light" scope="col">
                            <tr>
                                <th class="text-center col-rank" scope="col">#</th>
                                <th class="col-team" scope="col">Team</th>
                                <th class="text-center" scope="col">P</th>
                                <th class="text-center" scope="col">W</th>
                                <th class="text-center" scope="col">D</th>
                                <th class="text-center" scope="col">L</th>
                                <th class="text-center" scope="col">GF</th>
                                <th class="text-center" scope="col">GA</th>
                                <th class="text-center" scope="col">GD</th>
                                <th class="text-center" scope="col">Pts</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for standing in classic_standings %}
                            {% set stats = classic_stats.get(standing.team.id, {'top_scorer_name': 'N/A', 'top_scorer_goals': 0, 'top_assister_name': 'N/A', 'top_assister_assists': 0, 'recent_form': 'N/A', 'avg_goals_per_match': 0}) %}
                            <tr>
                                <td class="text-center fw-bold" data-label="#">{{ loop.index }}</td>
                                <td data-label="Team">
                                    <div class="d-flex align-items-center">
                                        {{ macros.team_avatar(standing.team, 'sm', 'bg-primary me-2') }}
                                        <a href="{{ url_for('teams.team_details', team_id=standing.team.id) }}"
                                           class="team-name"
                                           data-bs-toggle="popover"
                                           data-bs-trigger="hover"
                                           data-bs-placement="right"
                                           data-bs-html="true"
                                           data-bs-title="{{ standing.team.name }}"
                                           data-bs-content="
                                           <div class='team-stats-popover'>
                                               <div class='mb-2'><strong>Top Scorer:</strong> {{ stats['top_scorer_name'] }} ({{ stats['top_scorer_goals'] }} goals)</div>
                                               <div class='mb-2'><strong>Top Assister:</strong> {{ stats['top_assister_name'] }} ({{ stats['top_assister_assists'] }} assists)</div>
                                               <div class='mb-2'><strong>Recent Form:</strong> {{ stats['recent_form'] }}</div>
                                               <div><strong>Avg Goals:</strong> {{ stats['avg_goals_per_match'] }} per match</div>
                                           </div>">
                                            {{ standing.team.name }}
                                        </a>
                                    </div>
                                </td>
                                <td class="text-center" data-label="P">{{ standing.played }}</td>
                                <td class="text-center" data-label="W">{{ standing.wins }}</td>
                                <td class="text-center" data-label="D">{{ standing.draws }}</td>
                                <td class="text-center" data-label="L">{{ standing.losses }}</td>
                                <td class="text-center" data-label="GF">{{ standing.goals_for }}</td>
                                <td class="text-center" data-label="GA">{{ standing.goals_against }}</td>
                                <td class="text-center" data-label="GD">{{ standing.goal_difference }}</td>
                                <td class="text-center fw-bold" data-label="Pts">{{ standing.points }}</td>
                            </tr>
                            {% endfor %}
                            {% if classic_standings|length == 0 %}
                            <tr>
                                <td colspan="10" class="text-center p-4">
                                    <div class="c-empty-state" data-component="empty-state">
                                        <div class="c-empty-state__icon">
                                            <i class="ti ti-ball-football"></i>
                                        </div>
                                        <p class="c-empty-state__text">No standings data available for Classic Division.</p>
                                    </div>
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        {% if ecsfc_standings %}
        <!-- ECS FC Division Standings -->
        <div class="c-tab-pane-modern" id="ecsfc" role="tabpanel" aria-labelledby="ecsfc-tab">
            <div class="c-card-modern">
                <div class="c-card-modern__header">
                    <h5 class="c-card-modern__title">ECS FC Division Standings</h5>
                    <div class="c-card-modern__actions">
                        <span class="c-badge c-badge--primary" data-bs-toggle="tooltip" data-bs-placement="top" title="Teams are ranked by points, then goal difference, then goals scored" data-badge>
                            <i class="ti ti-info-circle"></i> Ranking Info
                        </span>
                    </div>
                </div>
                <div class="c-table-wrapper" data-table-responsive>
                    <table class="c-table c-table--hoverable" data-table>
                        <thead class="c-table--light" scope="col">
                            <tr>
                                <th class="text-center col-rank" scope="col">#</th>
                                <th class="col-team" scope="col">Team</th>
                                <th class="text-center" scope="col">P</th>
                                <th class="text-center" scope="col">W</th>
                                <th class="text-center" scope="col">D</th>
                                <th class="text-center" scope="col">L</th>
                                <th class="text-center" scope="col">GF</th>
                                <th class="text-center" scope="col">GA</th>
                                <th class="text-center" scope="col">GD</th>
                                <th class="text-center" scope="col">Pts</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for standing in ecsfc_standings %}
                            {% set stats = ecsfc_stats.get(standing.team.id, {'top_scorer_name': 'N/A', 'top_scorer_goals': 0, 'top_assister_name': 'N/A', 'top_assister_assists': 0, 'recent_form': 'N/A', 'avg_goals_per_match': 0}) %}
                            <tr>
                                <td class="text-center fw-bold" data-label="#">{{ loop.index }}</td>
                                <td data-label="Team">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar avatar-sm bg-warning me-2 d-flex align-items-center justify-content-center">
                                            <span class="team-initial text-white">{{ standing.team.name[0] }}</span>
                                        </div>
                                        <a href="{{ url_for('teams.team_details', team_id=standing.team.id) }}"
                                           class="team-name"
                                           data-bs-toggle="popover"
                                           data-bs-trigger="hover"
                                           data-bs-placement="right"
                                           data-bs-html="true"
                                           data-bs-title="{{ standing.team.name }}"
                                           data-bs-content="
                                           <div class='team-stats-popover'>
                                               <div class='mb-2'><strong>Top Scorer:</strong> {{ stats['top_scorer_name'] }} ({{ stats['top_scorer_goals'] }} goals)</div>
                                               <div class='mb-2'><strong>Top Assister:</strong> {{ stats['top_assister_name'] }} ({{ stats['top_assister_assists'] }} assists)</div>
                                               <div class='mb-2'><strong>Recent Form:</strong> {{ stats['recent_form'] }}</div>
                                               <div><strong>Avg Goals:</strong> {{ stats['avg_goals_per_match'] }} per match</div>
                                           </div>">
                                            {{ standing.team.name }}
                                        </a>
                                    </div>
                                </td>
                                <td class="text-center" data-label="P">{{ standing.played }}</td>
                                <td class="text-center" data-label="W">{{ standing.wins }}</td>
                                <td class="text-center" data-label="D">{{ standing.draws }}</td>
                                <td class="text-center" data-label="L">{{ standing.losses }}</td>
                                <td class="text-center" data-label="GF">{{ standing.goals_for }}</td>
                                <td class="text-center" data-label="GA">{{ standing.goals_against }}</td>
                                <td class="text-center" data-label="GD">{{ standing.goal_difference }}</td>
                                <td class="text-center fw-bold" data-label="Pts">{{ standing.points }}</td>
                            </tr>
                            {% endfor %}
                            {% if ecsfc_standings|length == 0 %}
                            <tr>
                                <td colspan="10" class="text-center p-4">
                                    <div class="c-empty-state" data-component="empty-state">
                                        <div class="c-empty-state__icon">
                                            <i class="ti ti-shield"></i>
                                        </div>
                                        <p class="c-empty-state__text">No standings data available for ECS FC Division.</p>
                                    </div>
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Legend -->
    <div class="c-standings-legend" data-component="standings-legend">
        <div class="c-card-modern">
            <div class="c-card-modern__body">
                <h6 class="c-standings-legend__title">Legend</h6>
                <div class="c-standings-legend__items">
                    <div class="c-standings-legend__item">
                        <span class="c-standings-legend__abbr">P:</span>
                        <span class="c-standings-legend__label">Played</span>
                    </div>
                    <div class="c-standings-legend__item">
                        <span class="c-standings-legend__abbr">W:</span>
                        <span class="c-standings-legend__label">Won</span>
                    </div>
                    <div class="c-standings-legend__item">
                        <span class="c-standings-legend__abbr">D:</span>
                        <span class="c-standings-legend__label">Drawn</span>
                    </div>
                    <div class="c-standings-legend__item">
                        <span class="c-standings-legend__abbr">L:</span>
                        <span class="c-standings-legend__label">Lost</span>
                    </div>
                    <div class="c-standings-legend__item">
                        <span class="c-standings-legend__abbr">GF:</span>
                        <span class="c-standings-legend__label">Goals For</span>
                    </div>
                    <div class="c-standings-legend__item">
                        <span class="c-standings-legend__abbr">GA:</span>
                        <span class="c-standings-legend__label">Goals Against</span>
                    </div>
                    <div class="c-standings-legend__item">
                        <span class="c-standings-legend__abbr">GD:</span>
                        <span class="c-standings-legend__label">Goal Difference</span>
                    </div>
                    <div class="c-standings-legend__item">
                        <span class="c-standings-legend__abbr">Pts:</span>
                        <span class="c-standings-legend__label">Points</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block custom_css %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/standings.css') }}">
{% endif %}
{% endblock %}

{% block custom_js %}
{{ super() }}

{% if not config.get('ASSETS_PRODUCTION_MODE') %}
<script src="{{ url_for('static', filename='custom_js/view-standings.js') }}"></script>

{% endif %}
{% endblock %}