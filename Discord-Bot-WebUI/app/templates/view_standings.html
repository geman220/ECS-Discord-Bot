{% extends "base.html" %}

{% block main_content %}
<div class="container-fluid">
    <!-- Premier League Standings -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="card-title text-primary mb-0">Premier Divison Standings</h4>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-bordered table-striped mb-0">
                    <thead class="thead-light">
                        <tr>
                            <th class="text-nowrap" style="padding: 4px 8px;">Position</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Team</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Played</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Won</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Drawn</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Lost</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Goals For</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Goals Against</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Goal Difference</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Points</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for standing_tuple in premier_standings %}
                        {% set standing = standing_tuple[0] %}
                        {% set stats = standing_tuple[1] %}
                        <tr class="align-middle {% if loop.index == 1 %}table-success{% elif loop.index == 2 %}table-info{% elif loop.index == 3 %}table-warning{% elif loop.previtem and loop.previtem.points == standing.points and loop.previtem.goal_difference == standing.goal_difference %}table-secondary{% endif %}">
                            <td class="font-weight-bold" style="padding: 4px 8px;">{{ loop.index }}</td>
                            <td class="text-left text-wrap" style="padding: 4px 8px;">
                                <a href="{{ url_for('teams.team_details', team_id=standing.team.id) }}"
                                   class="text-primary font-weight-bold"
                                   data-bs-toggle="popover" title="{{ standing.team.name }}"
                                   data-bs-html="true" data-bs-content="
                                   <strong>Top Scorer:</strong> {{ stats.top_scorer_name }} ({{ stats.top_scorer_goals }} goals)<br>
                                   <strong>Top Assister:</strong> {{ stats.top_assister_name }} ({{ stats.top_assister_assists }} assists)<br>
                                   <strong>Recent Form:</strong> {{ stats.recent_form }}<br>
                                   <strong>Avg Goals per Match:</strong> {{ stats.avg_goals_per_match }}">
                                    {{ standing.team.name }}
                                </a>
                            </td>
                            <td style="padding: 4px 8px;">{{ standing.played }}</td>
                            <td style="padding: 4px 8px;">{{ standing.won }}</td>
                            <td style="padding: 4px 8px;">{{ standing.drawn }}</td>
                            <td style="padding: 4px 8px;">{{ standing.lost }}</td>
                            <td style="padding: 4px 8px;">{{ standing.goals_for }}</td>
                            <td style="padding: 4px 8px;">{{ standing.goals_against }}</td>
                            <td style="padding: 4px 8px;">{{ standing.goal_difference }}</td>
                            <td class="font-weight-bold" style="padding: 4px 8px;">{{ standing.points }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Classic League Standings -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="card-title text-primary mb-0">Classic Division Standings</h4>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-bordered table-striped mb-0">
                    <thead class="thead-light">
                        <tr>
                            <th class="text-nowrap" style="padding: 4px 8px;">Position</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Team</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Played</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Won</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Drawn</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Lost</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Goals For</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Goals Against</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Goal Difference</th>
                            <th class="text-nowrap" style="padding: 4px 8px;">Points</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for standing_tuple in classic_standings %}
                        {% set standing = standing_tuple[0] %}
                        {% set stats = standing_tuple[1] %}
                        <tr class="align-middle {% if loop.index == 1 %}table-success{% elif loop.index == 2 %}table-info{% elif loop.index == 3 %}table-warning{% elif loop.previtem and loop.previtem.points == standing.points and loop.previtem.goal_difference == standing.goal_difference %}table-secondary{% endif %}">
                            <td class="font-weight-bold" style="padding: 4px 8px;">{{ loop.index }}</td>
                            <td class="text-left text-wrap" style="padding: 4px 8px;">
                                <a href="{{ url_for('teams.team_details', team_id=standing.team.id) }}"
                                   class="text-primary font-weight-bold"
                                   data-bs-toggle="popover" title="{{ standing.team.name }}"
                                   data-bs-html="true" data-bs-content="
                                   <strong>Top Scorer:</strong> {{ stats.top_scorer_name }} ({{ stats.top_scorer_goals }} goals)<br>
                                   <strong>Top Assister:</strong> {{ stats.top_assister_name }} ({{ stats.top_assister_assists }} assists)<br>
                                   <strong>Recent Form:</strong> {{ stats.recent_form }}<br>
                                   <strong>Avg Goals per Match:</strong> {{ stats.avg_goals_per_match }}">
                                    {{ standing.team.name }}
                                </a>
                            </td>
                            <td style="padding: 4px 8px;">{{ standing.played }}</td>
                            <td style="padding: 4px 8px;">{{ standing.won }}</td>
                            <td style="padding: 4px 8px;">{{ standing.drawn }}</td>
                            <td style="padding: 4px 8px;">{{ standing.lost }}</td>
                            <td style="padding: 4px 8px;">{{ standing.goals_for }}</td>
                            <td style="padding: 4px 8px;">{{ standing.goals_against }}</td>
                            <td style="padding: 4px 8px;">{{ standing.goal_difference }}</td>
                            <td class="font-weight-bold" style="padding: 4px 8px;">{{ standing.points }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
<!-- Popover Initialization -->
<script>
    $(document).ready(function () {
        $('[data-bs-toggle="popover"]').popover({
            trigger: 'hover',
            placement: 'top',
        });
    });
</script>
{% endblock %}
