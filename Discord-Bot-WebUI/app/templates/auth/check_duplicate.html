{% extends "base_unauthenticated.html" %}

{% block page_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/authentication.css') }}" />
{% endblock %}

{% block main_content %}

<div class="c-auth-wrapper">
    <div class="c-auth-inner">
        <!-- ECS Logos -->
        <div class="c-auth-branding c-auth-branding--desktop">
            <div class="c-auth-branding__content">
                <img src="{{ url_for('static', filename='img/ecs_logo.png') }}" alt="ECS Logo" class="c-auth-branding__logo c-auth-branding__logo--primary">
                <img src="{{ url_for('static', filename='img/ecs_pl_logo.png') }}" alt="ECS FC Pub League Logo" class="c-auth-branding__logo c-auth-branding__logo--secondary">
            </div>
        </div>

        <!-- Duplicate Check Form -->
        <div class="c-auth-panel">
            <div class="c-auth-panel__content">
                <h1 class="c-auth-panel__title">Is This You?</h1>
                <p class="c-auth-panel__subtitle">We found existing profiles that might belong to you. Please review them carefully.</p>

                <form method="POST" id="duplicate-check-form" data-form="duplicate-check">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <input type="hidden" id="player_id" name="player_id" value="">
                    <input type="hidden" id="action" name="action" value="">

                    <!-- Potential Duplicates -->
                    {% if duplicates %}
                        {% for dup in duplicates %}
                        <div class="c-card-modern c-card-modern--selectable" data-player-id="{{ dup.id }}">
                            <div class="c-card-modern__body">
                                <div class="c-duplicate-profile">
                                    <div class="c-duplicate-profile__info">
                                        <h6 class="c-duplicate-profile__name">{{ dup.name }}</h6>
                                        <div class="c-duplicate-profile__meta">
                                            <div class="c-duplicate-profile__meta-item">
                                                <i class="ti ti-mail"></i>
                                                <span>{{ dup.email }}</span>
                                            </div>
                                            <div class="c-duplicate-profile__meta-item">
                                                <i class="ti ti-target"></i>
                                                <span>Match reason: {{ dup.reason.replace('_', ' ').title() }}</span>
                                            </div>
                                            <div class="c-duplicate-profile__meta-item">
                                                <i class="ti ti-percentage"></i>
                                                <span>Confidence: {{ (dup.confidence * 100)|round }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="c-duplicate-profile__action">
                                        <button type="button"
                                                class="c-btn-modern c-btn-modern--primary c-btn-modern--sm js-claim-account"
                                                data-action="claim-account"
                                                data-player-id="{{ dup.id }}"
                                                data-player-name="{{ dup.name }}"
                                                data-player-email="{{ dup.email }}">
                                            <i class="ti ti-check"></i>
                                            <span>Yes, this is me</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}

                    <!-- None of these options -->
                    <div class="c-card-modern c-card-modern--alternative">
                        <div class="c-card-modern__body">
                            <div class="c-auth-alternative">
                                <h6 class="c-auth-alternative__title">
                                    <i class="ti ti-user-plus"></i>
                                    <span>None of these are me</span>
                                </h6>
                                <p class="c-auth-alternative__description">Create a brand new account instead.</p>
                                <button type="button"
                                        class="c-btn-modern c-btn-modern--secondary js-create-new"
                                        id="create-new-btn"
                                        data-action="create-new-account">
                                    <i class="ti ti-plus"></i>
                                    <span>Create New Account</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Help Text -->
                <div class="c-alert c-alert--info" role="alert" data-alert>
                    <div class="c-alert__icon">
                        <i class="ti ti-info-circle"></i>
                    </div>
                    <div class="c-alert__content">
                        <h6 class="c-alert__title">Why are we asking?</h6>
                        <p class="c-alert__message">
                            We want to prevent duplicate accounts and ensure you don't lose your player history.
                            If you claim an existing account, we'll send a verification email to the old address to confirm it's really you.
                        </p>
                    </div>
                </div>

                <!-- Back to login -->
                <div class="c-auth-footer">
                    <a href="{{ url_for('auth.login') }}" class="c-link" data-action="back-to-login">
                        <i class="ti ti-arrow-left"></i>
                        <span>Back to Login</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}
<script src="{{ url_for('static', filename='custom_js/check-duplicate.js') }}"></script>
{% endblock %}