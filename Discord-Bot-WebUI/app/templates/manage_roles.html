{% extends "base.html" %}

{% block title %}Manage Roles and Permissions{% endblock %}

{% block custom_css %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/roles.css') }}">
{% endif %}
{% endblock %}

{% block main_content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Page Header -->
    <div class="c-admin-header" data-component="admin-header">
        <div class="c-admin-header__content">
            <h1 class="c-admin-header__title">Manage Roles and Permissions</h1>
            <p class="c-admin-header__description">Configure role-based access control for your application</p>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="c-alerts" data-component="alerts">
        {% for category, message in messages %}
        <div class="c-alert c-alert--{{ category }}" role="alert" data-alert>
            <i class="ti ti-{% if category == 'success' %}check-circle{% elif category == 'danger' %}alert-circle{% elif category == 'warning' %}alert-triangle{% else %}info-circle{% endif %} c-alert__icon"></i>
            <span class="c-alert__text">{{ message }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <!-- Roles Management Card -->
    <div class="c-card">
        <div class="c-card__header">
            <h5 class="c-card__title">Role Permissions</h5>
        </div>
        <div class="c-card__body">
            <form method="POST"
                  action="{{ url_for('admin.manage_roles') }}"
                  data-form="manage-roles">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="row mb-4">
                    <div class="col-lg-6">
                        <label for="role_id" class="form-label">Select Role</label>
                        <select name="role_id"
                                id="role_id"
                                class="form-select"
                                data-form-select
                                data-action="load-role-permissions">
                            <option value="" disabled selected>Select a role...</option>
                            {% for role in roles %}
                            <option value="{{ role.id }}">{{ role.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-lg-12">
                        <label for="permissions" class="form-label">Select Permissions</label>
                        <select name="permissions"
                                id="permissions"
                                class="form-select"
                                multiple
                                data-form-select
                                data-select2="true"
                                data-placeholder="Select permissions...">
                            {% for permission in permissions %}
                            <option value="{{ permission.id }}">{{ permission.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="c-btn c-btn--primary">
                        <i class="ti ti-check"></i> Update Permissions
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block custom_js %}
{{ super() }}

{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<script src="{{ url_for('static', filename='custom_js/manage-roles.js') }}"></script>

{% endif %}
{% endblock %}
