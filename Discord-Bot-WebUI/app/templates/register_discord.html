{% extends "base_unauthenticated.html" %}

{% block page_css %}

{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/authentication.css') }}" />
{% endif %}
{% endblock %}

{% block title %}Complete Registration{% endblock title %}

{% block main_content %}

<div class="c-auth-wrapper c-auth-wrapper--wide" data-component="auth-wrapper">
    <!-- ECS Logo -->
    <div class="c-auth-logo" data-component="auth-logo">
        <img src="{{ url_for('static', filename='img/ecs_logo.png') }}"
             alt="ECS Logo"
             class="c-auth-logo__image">
    </div>

    <!-- Discord Registration Completion -->
    <div class="c-auth-form" data-component="auth-form">
        <div class="c-auth-form__header">
            <h1 class="c-auth-form__title">Complete Registration</h1>
            <p class="c-auth-form__subtitle">Finish setting up your account with Discord</p>
        </div>

        <div class="c-auth-form__body">
            <div class="c-auth-alert c-auth-alert--info" data-alert>
                <h6 class="c-auth-alert__title">Welcome, {{ discord_username }}!</h6>
                <p class="c-auth-alert__text">
                    Complete your registration for ECS FC. Please read and accept the terms below to create your account.
                </p>
            </div>

            <div class="c-auth-help-c-card c-auth-help-card--mb-lg" data-component="account-info">
                <h6 class="c-auth-help-card__title">Account Information</h6>
                <div class="c-auth-help-card__list">
                    <div class="c-auth-help-card__item">
                        <strong>Email:</strong> {{ discord_email }}
                    </div>
                    <div class="c-auth-help-card__item">
                        <strong>Username:</strong> {{ discord_username }}
                    </div>
                </div>
            </div>

            <!-- Liability Waiver and Code of Conduct -->
            <div class="c-waiver" data-component="waiver">
                <div class="c-waiver__header">
                    <h6 class="c-waiver__header-title">
                        ⚠️ Please Read Before Completing Registration
                    </h6>
                    <p class="c-auth-alert__text c-auth-alert__text--mt-xs">
                        Registration requires acceptance of our liability waiver and code of conduct.
                    </p>
                </div>

                <div class="c-waiver__content">
                    <h6 class="c-waiver__section-title">Waiver of Liability and Hold Harmless Agreement</h6>
                    <p>"Participant" hereby releases, waives, discharges and covenants not to sue ECS Pub League, a Washington nonprofit organization, and its affiliated associations, officers, directors, employees, agents, and contractors (collectively, the "Released Parties") from any and all liability, claims, demands, actions and causes of action whatsoever arising out of or related to any loss, damage, or injury, including death, that may be sustained by Participant, or to any property belonging to Participant, whether caused by the negligence of the Released Parties, or otherwise, while participating in such athletic and related event activities, or while in, on or upon the premises where the activities are being conducted.</p>

                    <p>Participant is fully aware of risks and hazards connected with the proposed soccer activity, including the risk of injury to a participant's neck, back, spine, knees or other parts of their body, and Participant hereby elects to participate as a voluntary participant in said activity, and to enter the premises of the various fields used to conduct soccer games or training and engage in such activity knowing that the activity may be hazardous to Participant or Participant's property. PARTICIPANT VOLUNTARILY ASSUMES FULL RESPONSIBILITY FOR ANY RISKS OF LOSS, PROPERTY DAMAGE OR PERSONAL INJURY, INCLUDING DEATH, that may be sustained by any of its players, coaches, opponents, or fans, or any loss or damage to property owned by Participant, as a result of being engaged in such an activity, whether caused by the negligence of the Released Parties or otherwise.</p>

                    <p>Participant acknowledges that ECS Pub League does not carry insurance on behalf of the Participant. Participant further hereby agrees to indemnify and hold harmless the Released Parties from and against any loss, liability, damage or costs, including court costs and attorney's fees, that they may incur due to Participant's participation in the proposed league activities, whether caused by the negligence of the Released Parties or otherwise. Participant agrees that this Waiver of Liability and Hold Harmless Agreement shall be construed in accordance with the laws of the State of Washington. Participant acknowledges full, adequate and complete consideration and intends to be bound by the terms contained herein.</p>

                    <h6 class="c-waiver__section-title">ECS Pub League Code of Conduct</h6>
                    <p>Participant further acknowledges and accepts as a condition of participation that ECS Pub League is a 21+ adult recreational league for very casual no/low contact soccer for beginners and beginner-friendly low-intermediate recreational players. We're not for everyone. Our level of skill, physicality, and competitiveness is typically well below even the lowest divisions of other leagues.</p>

                    <p>We do not discriminate based on race, color, religion, gender, gender expression, age, national origin, ancestry, disability, marital status, sexual orientation, or military status, in any of our activities or operations.</p>

                    <p>We do, however, reserve the right to deny play at any time for anyone who is deemed a poor fit for the league's mission and the culture of the unique community we serve because of skill, experience, physicality, competitiveness, or similar reasons.</p>

                    <p><strong>More serious infractions may result in yellow cards, red cards, suspensions, or expulsion from the league:</strong></p>
                    <ul class="c-waiver__list">
                        <li class="c-waiver__list-item">Excessive physical play and tackling, whether called as fouls or not. The bar is set intentionally lower in this league.</li>
                        <li class="c-waiver__list-item">Repeated dissent and/or unsporting behavior by words or action, including excessive arguing with referees and/or other players.</li>
                        <li class="c-waiver__list-item">Playing in a dangerous manner that causes or threatens to cause injury.</li>
                    </ul>

                    <p><strong>Less serious infractions will be handled in private conversations with coaches and/or league leadership. Further corrective action up to expulsion from the league may be implemented if infractions continue after verbal warnings and discussions:</strong></p>
                    <ul class="c-waiver__list">
                        <li class="c-waiver__list-item">Regularly ball hogging and excessive dribbling rather than passing.</li>
                        <li class="c-waiver__list-item">Regularly playing out of position to get themselves more directly involved in play.</li>
                        <li class="c-waiver__list-item">Regularly dribbling through multiple opponents, especially those who are less skilled.</li>
                        <li class="c-waiver__list-item">Regularly passing to only more talented players and not involving the whole team.</li>
                        <li class="c-waiver__list-item">Excessive shooting, especially when passing was a better decision.</li>
                        <li class="c-waiver__list-item">Running up the score, or excessive celebration on and off the field, including on social media.</li>
                        <li class="c-waiver__list-item">In Classic: Not giving new players enough space and time to dribble or pass.</li>
                    </ul>

                    <p>This is intentionally not an exhaustive list, because it's not about players merely adhering to the letter of the law or finding loopholes, it's about playing to maintain the Spirit of Pub League. Ultimately, a player's suitability for either division is up to a group decision of league management, taking into consideration feedback from coaches and other players, with a particular focus on regularly exhibited patterns and consistent behaviors.</p>

                    <p><strong>PARTICIPANT HAS READ THIS WAIVER OF LIABILITY AND CODE OF CONDUCT AND FULLY UNDERSTAND ITS TERMS, UNDERSTANDS THAT THEY HAVE GIVEN UP SUBSTANTIAL RIGHTS AND AGREES TO IT BY REGISTERING TO PLAY IN THE LEAGUE, DOING SO FREELY AND VOLUNTARILY WITHOUT ANY INDUCEMENT.</strong></p>
                </div>
            </div>

            <form method="post" action="{{ url_for('auth.register_with_discord') }}" data-form="discord-register">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <!-- Terms and Conditions Agreement -->
                <div class="c-auth-checkbox">
                    <input type="checkbox"
                           class="c-auth-checkbox__input"
                           id="terms-agreement"
                           name="terms_agreement"
                           required
                           data-controller="terms-agreement">
                    <label class="c-auth-checkbox__label c-auth-checkbox__label--muted" for="terms-agreement">
                        I agree to the ECS FC terms and conditions, liability waiver, and code of conduct
                    </label>
                </div>

                <div class="c-auth-btn-row">
                    <button type="submit"
                            class="c-auth-btn c-auth-btn--primary c-auth-btn-row__item"
                            id="complete-registration-btn"
                            disabled
                            data-target="submit-button">
                        Register
                    </button>
                    <a href="{{ url_for('auth.login') }}"
                       class="c-auth-btn c-auth-btn--outline c-auth-btn-row__item--auto">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock main_content %}

{% block custom_js %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle terms agreement checkbox
        document.addEventListener('change', function(e) {
            const target = e.target;
            if (!target.matches('[data-controller="terms-agreement"]')) return;

            const submitBtn = document.querySelector('[data-target="submit-button"]');
            const label = document.querySelector('label[for="terms-agreement"]');

            if (submitBtn) {
                submitBtn.disabled = !target.checked;
            }

            if (label) {
                label.classList.toggle('c-auth-checkbox__label--muted', !target.checked);
            }
        });
    });
</script>
{% endif %}
{% endblock %}
