{% extends "base.html" %}

{% block styles %}
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/players-list.css') }}">
{% endif %}
{% endblock %}

{% block main_content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Page Header -->
    <div class="c-page-header" data-component="page-header">
        <div class="c-page-header__content">
            <h2 class="c-page-header__title">Player List</h2>
            <p class="c-page-header__subtitle">Manage and view all registered players</p>
        </div>
        <div class="c-page-header__actions">
            <!-- Update Players Button -->
            <form method="POST" action="{{ url_for('players.update_players') }}" data-form="update-players">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit"
                        class="c-btn c-btn--success"
                        data-action="sync-players">
                    <i data-feather="refresh-cw"></i>
                    <span class="c-page-header__action-text">Update Players</span>
                </button>
            </form>

            <!-- Create Player Button -->
            <button type="button"
                    class="c-btn c-btn--primary"
                    data-bs-toggle="modal"
                    data-bs-target="#createPlayerModal"
                    data-action="create-player">
                <i data-feather="plus"></i>
                <span class="c-page-header__action-text">Create Player</span>
            </button>
        </div>
    </div>

    <!-- Filter Bar -->
    <div class="c-filter-bar" data-component="filter-bar">
        <form method="GET"
              action="{{ url_for('players.view_players') }}"
              class="c-filter-bar__form"
              data-form="search-players">
            <div class="c-filter-bar__search">
                <div class="input-group">
                    <input type="text"
                           class="form-control c-filter-bar__input"
                           name="search"
                           placeholder="Search by name, email, phone, etc."
                           value="{{ search_term }}"
                           data-input="search">
                    <button class="c-btn c-btn--primary c-filter-bar__button"
                            type="submit"
                            data-action="search">
                        <i data-feather="search"></i>
                    </button>
                    <button class="c-btn c-btn--secondary c-filter-bar__button"
                            type="button"
                            data-action="clear-search">
                        <i data-feather="x"></i>
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Players Table -->
    <div class="c-players-table" data-component="players-table">
        <div class="c-table-wrapper">
            <table class="c-table c-players-table__table" data-mobile-table data-table-type="players">
                <thead class="c-players-table__head">
                    <tr>
                        <th scope="col" class="c-players-table__header">Name</th>
                        <th scope="col" class="c-players-table__header">Email</th>
                        <th scope="col" class="c-players-table__header">Phone</th>
                        <th scope="col" class="c-players-table__header">Jersey Size</th>
                        <th scope="col" class="c-players-table__header">Primary League</th>
                        <th scope="col" class="c-players-table__header">Other Leagues</th>
                        <th scope="col" class="c-players-table__header c-players-table__header--actions">Actions</th>
                    </tr>
                </thead>
                <tbody class="c-players-table__body">
                    {% for player in players %}
                    <tr class="c-player-row" data-player-id="{{ player.id }}" data-player-row>
                        <td class="c-player-row__cell c-player-row__cell--name" data-label="Name">
                            <div class="c-player-row__name-wrapper">
                                <div class="c-player-row__avatar">
                                    {% if player.profile_picture_url %}
                                    <img src="{{ player.profile_picture_url }}"
                                         alt="{{ player.name }}"
                                         class="c-player-row__avatar-image">
                                    {% else %}
                                    <img src="{{ url_for('static', filename='img/default_player.png') }}"
                                         alt="{{ player.name }}"
                                         class="c-player-row__avatar-image">
                                    {% endif %}
                                    {% if player.user_id %}
                                    <span class="c-online-status c-online-status--sm is-offline"
                                          data-online-status="{{ player.user_id }}"
                                          title="Offline"
                                          aria-label="Online status"></span>
                                    {% endif %}
                                </div>
                                <span class="c-player-row__name">{{ player.name }}</span>
                            </div>
                        </td>
                        <td class="c-player-row__cell" data-label="Email">{{ player.user.email }}</td>
                        <td class="c-player-row__cell" data-label="Phone">{{ player.phone }}</td>
                        <td class="c-player-row__cell" data-label="Jersey Size">
                            <span class="c-badge c-badge--info" data-badge>{{ player.jersey_size }}</span>
                        </td>
                        <td class="c-player-row__cell" data-label="Primary League">
                            {% if player.primary_league %}
                            <span class="c-badge c-badge--primary" data-badge>
                                <i class="ti ti-trophy"></i>{{ player.primary_league.name }}
                            </span>
                            {% else %}
                            <span class="c-badge c-badge--secondary" data-badge>N/A</span>
                            {% endif %}
                        </td>
                        <td class="c-player-row__cell" data-label="Other Leagues">
                            <div class="c-player-row__leagues">
                                {% for league in player.other_leagues %}
                                <span class="c-badge c-badge--light c-badge--small" data-badge>{{ league.name }}</span>
                                {% endfor %}
                            </div>
                        </td>
                        <td class="c-player-row__cell c-player-row__cell--actions" data-label="Actions">
                            <div class="c-player-row__actions">
                                <a href="{{ url_for('players.player_profile', player_id=player.id) }}"
                                   class="c-btn c-btn--sm c-btn--primary"
                                   data-action="view-player"
                                   data-player-id="{{ player.id }}">
                                    <i data-feather="eye"></i>
                                    <span class="c-player-row__action-text">View</span>
                                </a>
                                <button type="button"
                                        class="c-btn c-btn--sm c-btn--danger"
                                        data-action="delete-player"
                                        data-player-id="{{ player.id }}"
                                        data-player-name="{{ player.name }}">
                                    <i data-feather="trash-2"></i>
                                    <span class="c-player-row__action-text">Delete</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Empty State -->
        {% if not players %}
        <div class="c-empty-state" data-component="empty-state">
            <div class="c-empty-state__icon">
                <i class="ti ti-users-off"></i>
            </div>
            <p class="c-empty-state__text">No players found</p>
            {% if search_term %}
            <p class="c-empty-state__help">Try adjusting your search criteria</p>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if pagination.pages > 1 %}
    <nav class="c-pagination" aria-label="Page navigation" data-component="pagination">
        <ul class="pagination c-pagination__list">
            {% if pagination.has_prev %}
            <li class="page-item c-pagination__item">
                <a class="page-link c-pagination__link"
                   href="{{ url_for('players.view_players', page=pagination.prev_num, search=search_term) }}"
                   aria-label="Previous"
                   data-page="prev">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
            {% endif %}

            {% for page_num in range(1, pagination.pages + 1) %}
            <li class="page-item c-pagination__item {% if pagination.page == page_num %}c-pagination__item--active{% endif %}">
                <a class="page-link c-pagination__link"
                   href="{{ url_for('players.view_players', page=page_num, search=search_term) }}"
                   data-page="{{ page_num }}">
                    {{ page_num }}
                </a>
            </li>
            {% endfor %}

            {% if pagination.has_next %}
            <li class="page-item c-pagination__item">
                <a class="page-link c-pagination__link"
                   href="{{ url_for('players.view_players', page=pagination.next_num, search=search_term) }}"
                   aria-label="Next"
                   data-page="next">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>

<!-- Create Player Modal -->
<div class="modal c-modal fade"
     id="createPlayerModal"
     tabindex="-1"
     aria-labelledby="createPlayerModalLabel"
     aria-hidden="true"
     data-modal="create-player">
    <div class="modal-dialog c-modal__dialog">
        <form method="POST"
              action="{{ url_for('players.create_player') }}"
              class="modal-content c-modal__content">
            <div class="modal-header c-modal__header">
                <h5 class="modal-title c-modal__title" id="createPlayerModalLabel">
                    Create New Player
                </h5>
                <button type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                        data-action="close-modal"></button>
            </div>
            <div class="modal-body c-modal__body">
                <!-- CSRF Token -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <!-- Name Field -->
                <div class="mb-3 c-form-field">
                    <label for="playerName" class="form-label c-form-field__label">Name</label>
                    <input type="text"
                           class="form-control c-form-field__input"
                           id="playerName"
                           name="name"
                           required
                           data-input="name">
                </div>

                <!-- Email Field -->
                <div class="mb-3 c-form-field">
                    <label for="playerEmail" class="form-label c-form-field__label">Email</label>
                    <input type="email"
                           class="form-control c-form-field__input"
                           id="playerEmail"
                           name="email"
                           required
                           data-input="email">
                </div>

                <!-- Phone Number Field -->
                <div class="mb-3 c-form-field">
                    <label for="playerPhone" class="form-label c-form-field__label">Phone Number</label>
                    <input type="tel"
                           class="form-control c-form-field__input"
                           id="playerPhone"
                           name="phone"
                           required
                           data-input="phone">
                </div>

                <!-- Jersey Size Field -->
                <div class="mb-3 c-form-field">
                    <label for="playerJerseySize" class="form-label c-form-field__label">Jersey Size</label>
                    <select class="form-select c-form-field__select"
                            id="playerJerseySize"
                            name="jersey_size"
                            required
                            data-input="jersey-size">
                        <option value="" disabled selected>Select a size</option>
                        {% for size in jersey_sizes %}
                        <option value="{{ size }}">{{ size }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- League Selection Field -->
                <div class="mb-3 c-form-field">
                    <label for="playerLeague" class="form-label c-form-field__label">League</label>
                    <select class="form-select c-form-field__select"
                            id="playerLeague"
                            name="league_id"
                            required
                            data-input="league">
                        <option value="" disabled selected>Select a league</option>
                        {% for league in leagues %}
                        <option value="{{ league.id }}">{{ league.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="modal-footer c-modal__footer">
                <button type="button"
                        class="c-btn c-btn--outline-secondary"
                        data-bs-dismiss="modal"
                        data-action="close-modal">Cancel</button>
                <button type="submit" class="c-btn c-btn--primary">
                    <i data-feather="plus"></i>Create Player
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block custom_js %}
<script src="{{ url_for('static', filename='custom_js/players-list.js') }}"></script>
<script>
    // Initialize Feather icons
    if (typeof feather !== 'undefined') {
        feather.replace();
    }
</script>
{{ super() }}
{% if not config.get('ASSETS_PRODUCTION_MODE') and (vite_production_mode is not defined or not vite_production_mode()) %}
{% endif %}
{% endblock %}
