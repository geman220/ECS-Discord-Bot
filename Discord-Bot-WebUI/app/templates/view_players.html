{% extends "base.html" %}

{% block main_content %}
<div class="container-xxl flex-grow-1 container-p-y">
    <!-- Page Heading -->
    <div class="content-header row">
        <div class="content-header-left col-md-6 col-12 mb-2">
            <h2 class="content-header-title">Player List</h2>
        </div>
    </div>

    <!-- Actions -->
    <div class="row mb-2">
        <div class="col-12 d-flex align-items-center">
            <!-- Update Players Button -->
            <form method="POST" action="{{ url_for('players.update_players') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-success me-2">
                    <i data-feather="refresh-cw"></i> Update Players
                </button>
            </form>

            <!-- Create Player Button -->
            <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#createPlayerModal">
                <i data-feather="plus"></i> Create Player
            </button>

            <!-- Search Form -->
            <form method="GET" action="{{ url_for('players.view_players') }}" class="d-flex align-items-center flex-grow-1">
                <div class="input-group">
                    <input type="text" class="form-control" name="search" placeholder="Search by name, email, phone, etc." value="{{ search_term }}">
                    <button class="btn btn-primary" type="submit"><i data-feather="search"></i></button>
                    <button class="btn btn-secondary" type="button" onclick="clearSearch()"><i data-feather="x"></i></button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tabs for Leagues -->
    <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link {% if active_tab == 'classic' %}active{% endif %}" id="classic-tab" data-bs-toggle="tab" href="#classic" role="tab" aria-controls="classic" aria-selected="{% if active_tab == 'classic' %}true{% else %}false{% endif %}">Classic League</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if active_tab == 'premier' %}active{% endif %}" id="premier-tab" data-bs-toggle="tab" href="#premier" role="tab" aria-controls="premier" aria-selected="{% if active_tab == 'premier' %}true{% else %}false{% endif %}">Premier League</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if active_tab == 'ecsfc' %}active{% endif %}" id="ecsfc-tab" data-bs-toggle="tab" href="#ecsfc" role="tab" aria-controls="ecsfc" aria-selected="{% if active_tab == 'ecsfc' %}true{% else %}false{% endif %}">ECS FC</a>
        </li>
    </ul>

    <div class="tab-content">
        <!-- Classic League Players Table -->
        <div class="tab-pane fade {% if active_tab == 'classic' %}show active{% endif %}" id="classic" role="tabpanel" aria-labelledby="classic-tab">
            {% set players = classic_players %}
            {% set league_name = 'Classic League' %}
            {% include 'player_table.html' %}
        </div>

        <!-- Premier League Players Table -->
        <div class="tab-pane fade {% if active_tab == 'premier' %}show active{% endif %}" id="premier" role="tabpanel" aria-labelledby="premier-tab">
            {% set players = premier_players %}
            {% set league_name = 'Premier League' %}
            {% include 'player_table.html' %}
        </div>

        <!-- ECS FC Players Table -->
        <div class="tab-pane fade {% if active_tab == 'ecsfc' %}show active{% endif %}" id="ecsfc" role="tabpanel" aria-labelledby="ecsfc-tab">
            {% set players = ecsfc_players %}
            {% set league_name = 'ECS FC' %}
            {% include 'player_table.html' %}
        </div>
    </div>
</div>

<!-- Create Player Modal -->
<div class="modal fade" id="createPlayerModal" tabindex="-1" aria-labelledby="createPlayerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form method="POST" action="{{ url_for('players.create_player') }}" class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createPlayerModalLabel">Create New Player</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- CSRF Token -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <!-- Name Field -->
                <div class="mb-3">
                    <label for="playerName" class="form-label">Name</label>
                    <input type="text" class="form-control" id="playerName" name="name" required>
                </div>

                <!-- Email Field -->
                <div class="mb-3">
                    <label for="playerEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="playerEmail" name="email" required>
                </div>

                <!-- Phone Number Field -->
                <div class="mb-3">
                    <label for="playerPhone" class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" id="playerPhone" name="phone" required>
                </div>

                <!-- Jersey Size Field -->
                <div class="mb-3">
                    <label for="playerJerseySize" class="form-label">Jersey Size</label>
                    <select class="form-select" id="playerJerseySize" name="jersey_size" required>
                        <option value="" disabled selected>Select a size</option>
                        {% for size in jersey_sizes %}
                        <option value="{{ size }}">{{ size }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- League Selection Field -->
                <div class="mb-3">
                    <label for="playerLeague" class="form-label">League</label>
                    <select class="form-select" id="playerLeague" name="league_id" required>
                        <option value="" disabled selected>Select a league</option>
                        {% for league in leagues %}
                        <option value="{{ league.id }}">{{ league.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Player</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block custom_js %}
<!-- Include Feather Icons -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        if (feather) {
            feather.replace();
        }
    });

    function clearSearch() {
        // Redirect to the same page without the search term and reset pagination
        window.location.href = "{{ url_for('players.view_players') }}";
    }
</script>
{{ super() }}
<script>
    function confirmDeletePlayer(playerId) {
        Swal.fire({
            title: 'Are you sure?',
            text: "This will delete the player and associated user account.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete them!',
        }).then((result) => {
            if (result.isConfirmed) {
                // Create a temporary form to submit the deletion
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/players/delete_player/${playerId}`;

                // Add CSRF token
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrf_token';
                csrfInput.value = '{{ csrf_token() }}';
                form.appendChild(csrfInput);

                document.body.appendChild(form);
                form.submit();
            }
        });
    }
</script>
{% endblock %}
