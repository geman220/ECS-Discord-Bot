var e,t,n=Object.defineProperty,a=Object.getOwnPropertyNames,o=(e,t,a)=>((e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a)(e,"symbol"!=typeof t?t+"":t,a),s=(e={"js/main-Bkx4snpk.js"(e,t){var n;const a={handlers:new Map,debug:!1,stats:{handlersRegistered:0,eventsProcessed:0,errorsEncountered:0},register(e,t,n={}){"function"==typeof t?(this.handlers.set(e,(e,a)=>(n.preventDefault&&a.preventDefault(),n.stopPropagation&&a.stopPropagation(),t(e,a))),this.stats.handlersRegistered++,this.debug&&console.log(`[EventDelegation] Registered handler: ${e}`)):console.error(`[EventDelegation] Handler for action "${e}" must be a function`)},unregister(e){this.handlers.has(e)&&(this.handlers.delete(e),this.stats.handlersRegistered--,this.debug&&console.log(`[EventDelegation] Unregistered handler: ${e}`))},isRegistered(e){return this.handlers.has(e)},getRegisteredActions(){return Array.from(this.handlers.keys())},init(){document.addEventListener("click",this.handleClick.bind(this),!1),document.addEventListener("change",this.handleChange.bind(this),!1),document.addEventListener("input",this.handleInput.bind(this),!1),document.addEventListener("submit",this.handleSubmit.bind(this),!1),document.addEventListener("keydown",this.handleKeydown.bind(this),!1),console.log("[EventDelegation] System initialized"),console.log(`[EventDelegation] Registered ${this.stats.handlersRegistered} handlers`)},handleClick(e){const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,a=this.handlers.get(n);if(a){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling click action: ${n}`,{element:t,data:t.dataset});try{a(t,e)}catch(o){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,o),this.handleError(n,o,t)}}else this.debug&&console.warn(`[EventDelegation] No handler registered for action: ${n}`)},handleChange(e){const t=e.target.closest("[data-on-change]");if(!t)return;const n=t.dataset.onChange,a=this.handlers.get(n);if(a){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling change action: ${n}`,{element:t,value:t.value});try{a(t,e)}catch(o){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,o),this.handleError(n,o,t)}}},handleInput(e){const t=e.target.closest("[data-on-input]");if(!t)return;const n=t.dataset.onInput,a=this.handlers.get(n);if(a){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling input action: ${n}`,{element:t,value:t.value});try{a(t,e)}catch(o){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,o),this.handleError(n,o,t)}}},handleSubmit(e){const t=e.target.closest("[data-on-submit]");if(!t)return;const n=t.dataset.onSubmit,a=this.handlers.get(n);if(a){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling submit action: ${n}`,{form:t,data:new FormData(t)});try{a(t,e)}catch(o){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,o),this.handleError(n,o,t)}}},handleKeydown(e){const t=e.target.closest("[data-on-keydown]");if(!t)return;const n=t.dataset.onKeydown,a=this.handlers.get(n);if(a){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling keydown action: ${n}`,{element:t,key:e.key,code:e.code});try{a(t,e)}catch(o){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,o),this.handleError(n,o,t)}}},handleError(e,t,n){console.error(`[EventDelegation] Action "${e}" failed:`,t),"function"==typeof showNotification&&showNotification("Error",`Action failed: ${e}`,"error")},enableDebug(){this.debug=!0,console.log("[EventDelegation] Debug mode enabled")},disableDebug(){this.debug=!1,console.log("[EventDelegation] Debug mode disabled")},getStats(){return{...this.stats,registeredActions:this.handlers.size}},resetStats(){this.stats.eventsProcessed=0,this.stats.errorsEncountered=0}};function s(e,t,n){"undefined"!=typeof Swal?Swal.fire({title:"Update RSVP Status?",text:"Are you sure you want to update this player's RSVP status?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, update it",cancelButtonText:"Cancel",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",customClass:{confirmButton:"swal-btn-confirm",cancelButton:"swal-btn-cancel"},buttonsStyling:!1}).then(a=>{var o;if(a.isConfirmed){const a=new FormData,s=(null==(o=document.querySelector('input[name="csrf_token"]'))?void 0:o.value)||"";a.append("csrf_token",s),a.append("player_id",e),a.append("match_id",t),a.append("response",n),Swal.fire({title:"Updating...",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}}),fetch("/admin/update_rsvp",{method:"POST",body:a,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(function(e){e.success?Swal.fire({title:"Success!",text:"RSVP updated successfully.",icon:"success",timer:1500,showConfirmButton:!1}).then(()=>{window.location.reload()}):Swal.fire({title:"Error",text:e.message||"Error updating RSVP.",icon:"error"})}).catch(function(e){console.error("[updateRSVPStatus] Error:",e),Swal.fire({title:"Error",text:"An error occurred while updating RSVP. Please try again.",icon:"error"})})}}):console.error("[updateRSVPStatus] SweetAlert2 not available")}function i(e,t){if("function"!=typeof window.showToast){if("undefined"!=typeof Toastify){const n={success:`linear-gradient(to right, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"#198754"}, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("success-light"):"#198754"})`,error:`linear-gradient(to right, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545"}, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger-light"):"#dc3545"})`,warning:`linear-gradient(to right, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning"):"#ffc107"}, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning-light"):"#ffc107"})`,info:`linear-gradient(to right, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("info"):"#0dcaf0"}, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("info-light"):"#0dcaf0"})`};return void Toastify({text:t,duration:3e3,gravity:"top",position:"right",style:{background:n[e]||n.info}}).showToast()}console.log(`[${e}] ${t}`)}else window.showToast(e,t)}function r(e){const t=document.getElementById("subscriptionLoading"),n=document.getElementById("subscriptionContent");t&&t.classList.toggle("is-hidden",!e),n&&n.classList.toggle("is-hidden",e)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){a.init()}):a.init(),a.register("show-task-info",function(e,t){t.preventDefault();const n=e.dataset.taskId,a=e.dataset.taskType,o=e.dataset.taskData;if(!n||!a)return void console.error("[show-task-info] Missing required data attributes");let s;try{s=o?JSON.parse(o):{}}catch(i){console.error("[show-task-info] Failed to parse task data:",i),s={}}"function"==typeof showTaskInfo?showTaskInfo(n,a,s):console.error("[show-task-info] Function not found")}),a.register("revoke-task",function(e,t){t.preventDefault();const n=e.dataset.taskId,a=e.dataset.matchId,o=e.dataset.taskType;n&&a&&o?"function"==typeof revokeTask?revokeTask(n,a,o):console.error("[revoke-task] Function not found"):console.error("[revoke-task] Missing required data attributes")}),a.register("reschedule-task",function(e,t){t.preventDefault();const n=e.dataset.matchId,a=e.dataset.taskType;n&&a?"function"==typeof rescheduleTask?rescheduleTask(n,a):console.error("[reschedule-task] Function not found"):console.error("[reschedule-task] Missing required data attributes")}),a.register("refresh-tasks",function(e,t){t.preventDefault(),"function"==typeof loadAllTaskDetails?loadAllTaskDetails():"function"==typeof refreshStatuses?refreshStatuses():console.error("[refresh-tasks] No refresh function found")}),a.register("toggle-historical",function(e,t){t.preventDefault();const n=e.dataset.target;if(!n)return void console.error("[toggle-historical] Missing target ID");const a=document.querySelector(n);a&&window.bootstrap&&bootstrap.Collapse.getOrCreateInstance(a).toggle()}),a.register("schedule-match",function(e,t){t.preventDefault();const n=e.dataset.matchId;n?"function"==typeof scheduleMatch?scheduleMatch(n):console.error("[schedule-match] Function not found"):console.error("[schedule-match] Missing match ID")}),a.register("verify-match",function(e,t){t.preventDefault();const n=e.dataset.matchId;if(n)if("function"==typeof verifyMatch)verifyMatch(n);else{const t=e.dataset.verifyUrl||`/admin/match_verification/${n}`;window.location.href=t}else console.error("[verify-match] Missing match ID")}),a.register("edit-match",function(e,t){t.preventDefault();const n=e.dataset.matchId;n?"function"==typeof editMatch?editMatch(n):console.error("[edit-match] Function not found"):console.error("[edit-match] Missing match ID")}),a.register("draft-player",function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.playerName;n&&a?"function"==typeof confirmDraftPlayer?confirmDraftPlayer(n,a):window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.showDraftModal?window.draftSystemInstance.showDraftModal(n,a):console.error("[draft-player] No draft function available"):console.error("[draft-player] Missing required data attributes")}),a.register("remove-player",function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.teamId,o=e.dataset.playerName,s=e.dataset.teamName;n&&a?"function"==typeof confirmRemovePlayer?confirmRemovePlayer(n,a,o,s):console.error("[remove-player] Function not found"):console.error("[remove-player] Missing required data attributes")}),a.register("view-player-profile",function(e,t){t.preventDefault();const n=e.dataset.playerId;n?window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.openPlayerModal?window.draftSystemInstance.openPlayerModal(n):"function"==typeof openPlayerModal?openPlayerModal(n):console.error("[view-player-profile] No modal function available"):console.error("[view-player-profile] Missing player ID")}),a.register("search-players",function(e,t){const n=e.value.toLowerCase().trim();window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.handleSearch?window.draftSystemInstance.handleSearch(t):document.querySelectorAll('[data-component="player-card"]').forEach(e=>{var t;const a=(e.dataset.playerName||"").toLowerCase(),o=!n||a.includes(n);null==(t=e.closest('[data-component="player-column"]'))||t.classList.toggle("d-none",!o)})}),a.register("filter-position",function(e,t){if(window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.handleFilter)window.draftSystemInstance.handleFilter(t);else{const t=e.value.toLowerCase();document.querySelectorAll('[data-component="player-card"]').forEach(e=>{var n;const a=(e.dataset.position||"").toLowerCase(),o=!t||a===t;null==(n=e.closest('[data-component="player-column"]'))||n.classList.toggle("d-none",!o)})}}),a.register("sort-players",function(e,t){window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.handleSort?window.draftSystemInstance.handleSort(t):console.warn("[sort-players] Sort function not available")}),a.register("edit-match-report",function(e,t){t.preventDefault();const n=e.dataset.matchId;n?"function"==typeof handleEditButtonClick?handleEditButtonClick(n):console.error("[edit-match-report] handleEditButtonClick function not found"):console.error("[edit-match-report] Missing match ID")}),a.register("add-goal",function(e,t){t.preventDefault();let n=e.dataset.matchId;if(!n){const t=e.getAttribute("onclick");if(t){const e=t.match(/'([^']+)'/);e&&(n=e[1])}}if(!n)return void console.error("[add-goal] Missing match ID");const a=`goalScorersContainer-${n}`;"function"==typeof window.addEvent?window.addEvent(n,a):console.error("[add-goal] addEvent function not found")}),a.register("add-assist",function(e,t){t.preventDefault();let n=e.dataset.matchId;if(!n){const t=e.getAttribute("onclick");if(t){const e=t.match(/'([^']+)'/);e&&(n=e[1])}}if(!n)return void console.error("[add-assist] Missing match ID");const a=`assistProvidersContainer-${n}`;"function"==typeof window.addEvent?window.addEvent(n,a):console.error("[add-assist] addEvent function not found")}),a.register("add-yellow-card",function(e,t){t.preventDefault();let n=e.dataset.matchId;if(!n){const t=e.getAttribute("onclick");if(t){const e=t.match(/'([^']+)'/);e&&(n=e[1])}}if(!n)return void console.error("[add-yellow-card] Missing match ID");const a=`yellowCardsContainer-${n}`;"function"==typeof window.addEvent?window.addEvent(n,a):console.error("[add-yellow-card] addEvent function not found")}),a.register("add-red-card",function(e,t){t.preventDefault();let n=e.dataset.matchId;if(!n){const t=e.getAttribute("onclick");if(t){const e=t.match(/'([^']+)'/);e&&(n=e[1])}}if(!n)return void console.error("[add-red-card] Missing match ID");const a=`redCardsContainer-${n}`;"function"==typeof window.addEvent?window.addEvent(n,a):console.error("[add-red-card] addEvent function not found")}),a.register("remove-event",function(e,t){t.preventDefault(),"function"==typeof window.removeEvent?window.removeEvent(e):console.error("[remove-event] removeEvent function not found")}),a.register("remove-own-goal",function(e,t){t.preventDefault(),"function"==typeof window.removeEvent?window.removeEvent(e):console.error("[remove-own-goal] removeEvent function not found")}),a.register("rsvp-yes",function(e,t){t.preventDefault();const n=e.dataset.matchId,a=e.dataset.playerId;n?a?"function"==typeof updatePlayerRSVP?updatePlayerRSVP(a,n,"yes"):s(a,n,"yes"):"function"==typeof submitRSVP?submitRSVP(n,"yes"):console.error("[rsvp-yes] submitRSVP function not found"):console.error("[rsvp-yes] Missing match ID")}),a.register("rsvp-no",function(e,t){t.preventDefault();const n=e.dataset.matchId,a=e.dataset.playerId;n?a?"function"==typeof updatePlayerRSVP?updatePlayerRSVP(a,n,"no"):s(a,n,"no"):"function"==typeof submitRSVP?submitRSVP(n,"no"):console.error("[rsvp-no] submitRSVP function not found"):console.error("[rsvp-no] Missing match ID")}),a.register("rsvp-maybe",function(e,t){t.preventDefault();const n=e.dataset.matchId,a=e.dataset.playerId;n?a?"function"==typeof updatePlayerRSVP?updatePlayerRSVP(a,n,"maybe"):s(a,n,"maybe"):"function"==typeof submitRSVP?submitRSVP(n,"maybe"):console.error("[rsvp-maybe] submitRSVP function not found"):console.error("[rsvp-maybe] Missing match ID")}),a.register("rsvp-withdraw",function(e,t){t.preventDefault();const n=e.dataset.matchId,a=e.dataset.playerId;n?a?"function"==typeof updatePlayerRSVP?updatePlayerRSVP(a,n,"no_response"):s(a,n,"no_response"):"function"==typeof withdrawRSVP?withdrawRSVP(n):console.error("[rsvp-withdraw] withdrawRSVP function not found"):console.error("[rsvp-withdraw] Missing match ID")}),a.register("rsvp-request-sms",function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.playerName,o=e.dataset.phone;if(n)if(window.jQuery){const e=window.jQuery;try{e("#smsPlayerName").text(a||"Player"),e("#smsPlayerId").val(n),e("#smsPlayerPhone").val(o||""),o&&"function"==typeof formatPhoneNumber?e("#smsPlayerPhoneDisplay").text(formatPhoneNumber(o)):e("#smsPlayerPhoneDisplay").text(o||""),e("#smsMessage").val(""),e("#smsCharCount").text("0");const t=document.querySelector('[data-modal="send-sms"]');t&&ModalManager.showByElement(t)}catch(s){console.error("[rsvp-request-sms] Error opening modal:",s)}}else{const e=document.querySelector('[data-modal="send-sms"]');if(e&&window.bootstrap){const t=document.getElementById("smsPlayerName"),s=document.getElementById("smsPlayerId"),i=document.getElementById("smsPlayerPhone"),r=document.getElementById("smsMessage"),c=document.getElementById("smsCharCount");t&&(t.textContent=a||"Player"),s&&(s.value=n),i&&(i.value=o||""),r&&(r.value=""),c&&(c.textContent="0"),ModalManager.showByElement(e)}}else console.error("[rsvp-request-sms] Missing player ID")}),a.register("rsvp-request-discord-dm",function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.playerName,o=e.dataset.discordId;if(n)if(window.jQuery){const e=window.jQuery;try{e("#discordPlayerName").text(a||"Player"),e("#discordPlayerId").val(n),e("#discordId").val(o||""),e("#discordMessage").val(""),e("#discordCharCount").text("0");const t=document.querySelector('[data-modal="send-discord-dm"]');t&&ModalManager.showByElement(t)}catch(s){console.error("[rsvp-request-discord-dm] Error opening modal:",s)}}else{const e=document.querySelector('[data-modal="send-discord-dm"]');if(e&&window.bootstrap){const t=document.getElementById("discordPlayerName"),s=document.getElementById("discordPlayerId"),i=document.getElementById("discordId"),r=document.getElementById("discordMessage"),c=document.getElementById("discordCharCount");t&&(t.textContent=a||"Player"),s&&(s.value=n),i&&(i.value=o||""),r&&(r.value=""),c&&(c.textContent="0"),ModalManager.showByElement(e)}}else console.error("[rsvp-request-discord-dm] Missing player ID")}),a.register("rsvp-update-status",function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.matchId,o=e.dataset.response;n&&a&&o?s(n,a,o):console.error("[rsvp-update-status] Missing required data attributes")}),a.register("copy-subscription-url",async function(e,t){t.preventDefault();const n=document.getElementById("subscriptionUrl");if(n&&n.value)try{await navigator.clipboard.writeText(n.value),i("success","URL copied to clipboard");const t=e.innerHTML;e.innerHTML='<i class="ti ti-check me-1"></i>Copied!',setTimeout(()=>{e.innerHTML=t},2e3)}catch(a){n.select(),document.execCommand("copy"),i("success","URL copied to clipboard")}else i("warning","No subscription URL available")}),a.register("regenerate-subscription-token",async function(e,t){if(t.preventDefault(),confirm("Are you sure you want to regenerate your subscription URL?\n\nYour existing calendar subscriptions will stop working and you will need to re-subscribe with the new URL.")){r(!0);try{const e=await fetch("/api/calendar/subscription/regenerate",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to regenerate token");await e.json(),"undefined"!=typeof CalendarSubscription&&CalendarSubscription.loadSubscription&&await CalendarSubscription.loadSubscription(),i("success","Subscription URL regenerated successfully")}catch(n){console.error("[regenerate-subscription-token] Error:",n),i("error","Failed to regenerate subscription URL")}finally{r(!1)}}}),a.register("subscribe-webcal",function(e,t){t.preventDefault();const n=e.dataset.webcalUrl;n?window.location.href=n:i("warning","Subscription URL not available")}),a.register("subscribe-google",function(e,t){t.preventDefault();const n=e.dataset.feedUrl;if(!n)return void i("warning","Subscription URL not available");const a="https://calendar.google.com/calendar/r?cid="+encodeURIComponent(n);window.open(a,"_blank")}),a.register("update-calendar-preferences",async function(e,t){var n,a,o;const s={include_team_matches:(null==(n=document.getElementById("subIncludeMatches"))?void 0:n.checked)??!0,include_league_events:(null==(a=document.getElementById("subIncludeLeagueEvents"))?void 0:a.checked)??!0,include_ref_assignments:(null==(o=document.getElementById("subIncludeRefAssignments"))?void 0:o.checked)??!0};try{const e=await fetch("/api/calendar/subscription/preferences",{method:"PUT",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify(s)});if(!e.ok)throw new Error("Failed to update preferences");await e.json(),i("success","Preferences updated")}catch(r){console.error("[update-calendar-preferences] Error:",r),i("error","Failed to update preferences"),e.checked=!e.checked}}),a.register("verify-section-reviewed",function(e,t){window.ProfileVerification&&"function"==typeof window.ProfileVerification.handleCheckboxChange?window.ProfileVerification.handleCheckboxChange(e):console.error("[verify-section-reviewed] ProfileVerification not available")}),a.register("verify-profile",function(e,t){t.preventDefault();const n=e.dataset.playerId;if(!n)return void console.error("[verify-profile] Missing player ID");const a=document.querySelector("[data-profile-verify]"),o=(null==a?void 0:a.dataset.verifyUrl)||`/players/profile/${n}/verify`;window.location.href=o}),a.register("verify-profile-submit",function(e,t){if(window.ProfileVerification&&"function"==typeof window.ProfileVerification.areAllSectionsReviewed)if(window.ProfileVerification.areAllSectionsReviewed())window.Haptics&&window.Haptics.success();else{t.preventDefault();const e=window.ProfileVerification.getUncheckedSections();window.Haptics&&window.Haptics.error(),window.ProfileVerification.showIncompleteWarning(e)}else console.warn("[verify-profile-submit] ProfileVerification not available, allowing submission")}),a.register("change-per-page",function(e,t){const n=e.value,a=new URL(window.location);a.searchParams.set("per_page",n),a.searchParams.set("page","1"),window.location.href=a.toString()}),a.register("refresh-all-discord-status",function(e,t){t.preventDefault();const n=e;"undefined"!=typeof Swal?Swal.fire({title:"Refresh All Discord Status",text:"This will refresh Discord status for all players. This may take a moment. Continue?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, refresh all",cancelButtonText:"Cancel",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"#28c76f",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"}).then(e=>{var t;if(e.isConfirmed){const e=n.innerHTML;n.innerHTML='<i class="ti ti-loader ti-spin me-1"></i>Refreshing...',n.disabled=!0;const a=(null==(t=document.querySelector("meta[name=csrf-token]"))?void 0:t.getAttribute("content"))||"";fetch("/admin/refresh_all_discord_status",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to refresh status");Swal.fire({icon:"success",title:"Status Updated",text:`Refreshed Discord status for ${e.success_count} players`,timer:2e3,showConfirmButton:!1}).then(()=>{location.reload()})}).catch(e=>{Swal.fire({icon:"error",title:"Error",text:"Failed to refresh status: "+e.message,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"})}).finally(()=>{n.innerHTML=e,n.disabled=!1})}}):console.error("[refresh-all-discord-status] SweetAlert2 not available")}),a.register("refresh-unknown-discord-status",function(e,t){t.preventDefault();const n=e;"undefined"!=typeof Swal?Swal.fire({title:"Check Unknown Discord Status",text:"This will check Discord status for all players with unknown status. Continue?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, check unknown",cancelButtonText:"Cancel",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning"):"#ffab00",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"}).then(e=>{var t;if(e.isConfirmed){const e=n.innerHTML;n.innerHTML='<i class="ti ti-loader ti-spin me-1"></i>Checking...',n.disabled=!0;const a=(null==(t=document.querySelector("meta[name=csrf-token]"))?void 0:t.getAttribute("content"))||"";fetch("/admin/refresh_unknown_discord_status",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to check unknown status");Swal.fire({icon:"success",title:"Status Checked",text:`Checked Discord status for ${e.success_count} players with unknown status`,timer:2e3,showConfirmButton:!1}).then(()=>{location.reload()})}).catch(e=>{Swal.fire({icon:"error",title:"Error",text:"Failed to check unknown status: "+e.message,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"})}).finally(()=>{n.innerHTML=e,n.disabled=!1})}}):console.error("[refresh-unknown-discord-status] SweetAlert2 not available")}),a.register("refresh-player-status",function(e,t){var n;t.preventDefault();const a=e.dataset.playerId,o=e.dataset.playerName;if(!a)return void console.error("[refresh-player-status] Missing player ID");const s=e.innerHTML;e.innerHTML='<i class="ti ti-loader ti-spin me-1"></i><span>Checking...</span>',e.disabled=!0;const i=(null==(n=document.querySelector("meta[name=csrf-token]"))?void 0:n.getAttribute("content"))||"";fetch(`/teams/player/${a}/refresh-discord-status`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":i}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to refresh status");"undefined"!=typeof Swal?Swal.fire({icon:"success",title:"Status Updated",text:`Discord status refreshed for ${o}`,timer:2e3,showConfirmButton:!1}).then(()=>{location.reload()}):location.reload()}).catch(e=>{"undefined"!=typeof Swal?Swal.fire({icon:"error",title:"Error",text:"Failed to refresh status: "+e.message,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"}):console.error("[refresh-player-status] Error:",e)}).finally(()=>{e.innerHTML=s,e.disabled=!1})}),a.register("send-discord-dm",function(e,t){t.preventDefault();const n=e.dataset.discordId,a=e.dataset.playerName;if(!n)return void console.error("[send-discord-dm] Missing Discord ID");const o=document.getElementById("dmDiscordId"),s=document.querySelector("#discordDMModal .modal-title"),i=document.getElementById("dmMessage");o&&(o.value=n),s&&(s.textContent=`Send Discord DM to ${a}`);const r=`Hi ${a}! ðŸ‘‹\n\nWe noticed you haven't joined our ECS FC Discord server yet.\n\nJoin us to:\nâ€¢ Get match updates and announcements\nâ€¢ Connect with your teammates\nâ€¢ Participate in league discussions\n\nJoin here: https://discord.gg/weareecs\n\nSee you there!\n- ECS FC Admin Team`;i&&(i.value=r),document.getElementById("discordDMModal")&&ModalManager.show("discordDMModal")}),a.register("submit-discord-dm",function(e,t){var n,a,o;t.preventDefault();const s=null==(n=document.getElementById("dmDiscordId"))?void 0:n.value,i=null==(a=document.getElementById("dmMessage"))?void 0:a.value;if(!i||!i.trim())return void("undefined"!=typeof Swal&&Swal.fire({icon:"warning",title:"Message Required",text:"Please enter a message before sending",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning"):"#ffab00"}));const r=e.innerHTML;e.innerHTML='<i class="ti ti-loader ti-spin me-1"></i>Sending...',e.disabled=!0;const c=(null==(o=document.querySelector("meta[name=csrf-token]"))?void 0:o.getAttribute("content"))||"";fetch("/admin/send_discord_dm",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":c},body:JSON.stringify({discord_id:s,message:i})}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to send message");{const e=document.getElementById("discordDMModal");if(e&&window.bootstrap){const t=bootstrap.Modal.getInstance(e);t&&t.hide()}"undefined"!=typeof Swal&&Swal.fire({icon:"success",title:"Message Sent",text:"Discord message sent successfully!",timer:2e3,showConfirmButton:!1})}}).catch(e=>{"undefined"!=typeof Swal?Swal.fire({icon:"error",title:"Error",text:"Failed to send Discord message: "+e.message,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"}):console.error("[submit-discord-dm] Error:",e)}).finally(()=>{e.innerHTML=r,e.disabled=!1})}),a.register("assign-referee",function(e,t){var n,a;t.preventDefault();const o=null==(n=document.getElementById("matchId"))?void 0:n.value,s=null==(a=document.getElementById("refSelect"))?void 0:a.value;o&&s?"function"==typeof assignReferee?assignReferee(t):console.error("[assign-referee] assignReferee function not found"):console.error("[assign-referee] Missing match ID or referee ID")}),a.register("remove-referee",function(e,t){var n;t.preventDefault(),e.dataset.matchId||(null==(n=document.getElementById("matchId"))?void 0:n.value)?"function"==typeof removeReferee?removeReferee():console.error("[remove-referee] removeReferee function not found"):console.error("[remove-referee] Missing match ID")}),a.register("refresh-calendar",function(e,t){t.preventDefault(),"function"==typeof loadCalendarEvents&&"function"==typeof fetchAvailableReferees?(loadCalendarEvents(),window.calendarInstance?fetchAvailableReferees(window.calendarInstance.getDate()):fetchAvailableReferees(new Date)):"function"==typeof window.refreshCalendar?window.refreshCalendar():console.error("[refresh-calendar] No refresh function available")}),a.register("view-referee-profile",function(e,t){t.preventDefault();const n=e.dataset.refereeId;if(n)if("function"==typeof viewRefereeProfile)viewRefereeProfile(n);else{const t=e.dataset.profileUrl||`/admin/referee/${n}`;window.location.href=t}else console.error("[view-referee-profile] Missing referee ID")}),a.register("update-referee-status",function(e,t){t.preventDefault();const n=e.dataset.refereeId,a=e.dataset.status;n&&a?"function"==typeof updateRefereeStatus?updateRefereeStatus(n,a):console.error("[update-referee-status] updateRefereeStatus function not found"):console.error("[update-referee-status] Missing referee ID or status")}),a.register("approve-pool-player",function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.league;n&&a?"function"==typeof approvePlayer?approvePlayer(n,a):console.error("[approve-pool-player] approvePlayer function not found"):console.error("[approve-pool-player] Missing required data attributes")}),a.register("remove-pool-player",function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.league;n&&a?"function"==typeof removePlayer?removePlayer(n,a):console.error("[remove-pool-player] removePlayer function not found"):console.error("[remove-pool-player] Missing required data attributes")}),a.register("edit-pool-preferences",function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.league;n&&a?"function"==typeof openEditPreferencesModal?openEditPreferencesModal(n,a):console.error("[edit-pool-preferences] openEditPreferencesModal function not found"):console.error("[edit-pool-preferences] Missing required data attributes")}),a.register("view-pool-player-details",function(e,t){t.preventDefault();const n=e.dataset.playerId;n?"function"==typeof openPlayerDetailsModal?openPlayerDetailsModal(n):console.error("[view-pool-player-details] openPlayerDetailsModal function not found"):console.error("[view-pool-player-details] Missing player ID")}),a.register("add-player-to-league",function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.league;n&&a?"function"==typeof approvePlayer?approvePlayer(n,a):console.error("[add-player-to-league] approvePlayer function not found"):console.error("[add-player-to-league] Missing required data attributes")}),a.register("toggle-pool-view",function(e,t){t.preventDefault();const n=e.dataset.view,a=e.dataset.league,o=e.dataset.section;if(!n||!a||!o)return void console.error("[toggle-pool-view] Missing required data attributes");e.parentElement.querySelectorAll(".view-toggle").forEach(e=>e.classList.remove("active")),e.classList.add("active");const s=document.getElementById(`${o}-list-${a}`),i=document.getElementById(`${o}-grid-${a}`);"list"===n?(s&&s.classList.remove("u-hidden"),i&&i.classList.add("u-hidden")):(s&&s.classList.add("u-hidden"),i&&i.classList.remove("u-hidden"))}),a.register("filter-pool",function(e,t){const n=e.value.toLowerCase().trim(),a=e.dataset.league,o=e.dataset.section;a&&o?"function"==typeof filterPlayerCards?filterPlayerCards(a,o,n):document.querySelectorAll(`.player-card[data-league="${a}"][data-status="${o}"], .player-list-item[data-league="${a}"][data-status="${o}"]`).forEach(e=>{const t=(e.dataset.searchText||"").toLowerCase(),a=!n||t.includes(n);e.classList.toggle("u-hidden",!a)}):console.error("[filter-pool] Missing required data attributes")}),a.register("manage-league-pool",function(e,t){t.preventDefault();const n=e.dataset.league;n?"function"==typeof openLeagueManagementModal?openLeagueManagementModal(n):console.error("[manage-league-pool] openLeagueManagementModal function not found"):console.error("[manage-league-pool] Missing league identifier")}),a.register("save-pool-preferences",function(e,t){t.preventDefault(),"function"==typeof savePreferences?savePreferences():console.error("[save-pool-preferences] savePreferences function not found")}),a.register("pool-pagination",function(e,t){t.preventDefault();const n=parseInt(e.dataset.page),a=e.dataset.league,o=e.dataset.section;if(!n||!a||!o)return void console.error("[pool-pagination] Missing required data attributes");const s=`${a}-${o}`;"undefined"!=typeof paginationState&&paginationState[s]&&n!==paginationState[s].currentPage&&(paginationState[s].currentPage=n,"function"==typeof updatePagination&&updatePagination(a,o))}),a.register("add-to-pool",async function(e,t){t.preventDefault();const n=e.dataset.playerId;n?"function"==typeof addToPool?addToPool(n):console.error("[add-to-pool] addToPool function not found"):console.error("[add-to-pool] Missing player ID")}),a.register("reject-player",async function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.playerName;n?"function"==typeof rejectPlayer?rejectPlayer(n,a):console.error("[reject-player] rejectPlayer function not found"):console.error("[reject-player] Missing player ID")}),a.register("remove-player",async function(e,t){t.preventDefault();const n=e.dataset.playerId,a=e.dataset.playerName;n?"function"==typeof removeFromPool?removeFromPool(n,a):console.error("[remove-player] removeFromPool function not found"):console.error("[remove-player] Missing player ID")}),a.register("load-stats",async function(e,t){t.preventDefault(),"function"==typeof loadStatistics?loadStatistics():console.error("[load-stats] loadStatistics function not found")}),a.register("add-player",function(e,t){t.preventDefault(),"function"==typeof showAddPlayerModal?showAddPlayerModal():console.error("[add-player] showAddPlayerModal function not found")}),a.register("onboarding-create-profile",function(e,t){t.preventDefault();const n=document.getElementById("form_action");n&&(n.value="create_profile");const a=document.getElementById("modalCarouselControls");a&&window.bootstrap&&(bootstrap.Carousel.getInstance(a)||new bootstrap.Carousel(a)).next()}),a.register("onboarding-skip-profile",function(e,t){t.preventDefault();const n=document.getElementById("form_action"),a=document.getElementById("onboardingSlideModal"),o=a?a.querySelector("form.needs-validation"):null;n&&(n.value="skip_profile"),o&&o.submit()}),a.register("onboarding-next",function(e,t){if(t.preventDefault(),t.stopPropagation(),!window.OnboardingWizard)return void console.error("[onboarding-next] OnboardingWizard not initialized");const{form:n,formActionInput:a,croppedImageHiddenInput:o,carouselElement:s,bootstrapCarousel:i,totalSteps:r}=window.OnboardingWizard.getFormElements();if(window.OnboardingWizard.getCurrentStep()===r){if(a&&(a.value="update_profile"),window.cropper)try{const e=window.cropper.getCroppedCanvas();e&&(o.value=e.toDataURL("image/png"))}catch(c){console.error("[onboarding-next] Error getting cropped image:",c)}if(n&&n.checkValidity())n.submit();else{n.classList.add("was-validated");const e=n.querySelector(":invalid");e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"center"}))}}else{const e=s?s.querySelector(".carousel-item.active"):null,t=e?e.querySelectorAll("input[required], select[required], textarea[required]"):[];let n=!0;if(t.forEach(e=>{if(null!==e.offsetParent)if(e.checkValidity())e.classList.remove("is-invalid");else if(n=!1,e.classList.add("is-invalid"),!e.nextElementSibling||!e.nextElementSibling.classList.contains("invalid-feedback")){const t=document.createElement("div");t.className="invalid-feedback",t.textContent=e.validationMessage||"This field is required.",e.parentNode.insertBefore(t,e.nextSibling)}}),n)a&&(a.value=""),i&&i.next();else{const t=e?e.querySelector(".is-invalid"):null;t&&(t.focus(),t.scrollIntoView({behavior:"smooth",block:"center"}))}}}),a.register("onboarding-previous",function(e,t){t.preventDefault();const n=document.getElementById("modalCarouselControls");if(n&&window.bootstrap){const e=bootstrap.Carousel.getInstance(n);e&&e.prev()}}),a.register("onboarding-toggle-sms",function(e,t){window.OnboardingWizard&&"function"==typeof window.OnboardingWizard.handleSmsToggle?window.OnboardingWizard.handleSmsToggle(e):console.error("[onboarding-toggle-sms] SMS toggle handler not available")}),a.register("refresh-stats",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.refreshAll?await window.securityDashboard.refreshAll():console.error("[refresh-stats] SecurityDashboard instance not available")}),a.register("refresh-events",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.loadSecurityEvents?await window.securityDashboard.loadSecurityEvents():console.error("[refresh-events] SecurityDashboard instance not available")}),a.register("refresh-logs",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.loadSecurityLogs?await window.securityDashboard.loadSecurityLogs():console.error("[refresh-logs] SecurityDashboard instance not available")}),a.register("unban-ip",async function(e,t){t.preventDefault();const n=e.dataset.ip;n?window.securityDashboard&&"function"==typeof window.securityDashboard.unbanIP?await window.securityDashboard.unbanIP(n,e):console.error("[unban-ip] SecurityDashboard instance not available"):console.error("[unban-ip] Missing IP address")}),a.register("ban-ip-quick",async function(e,t){t.preventDefault();const n=e.dataset.ip,a=e.dataset.reason||"Security event";n?window.securityDashboard&&"function"==typeof window.securityDashboard.quickBanIP?await window.securityDashboard.quickBanIP(n,a):console.error("[ban-ip-quick] SecurityDashboard instance not available"):console.error("[ban-ip-quick] Missing IP address")}),a.register("ban-ip-confirm",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.banIP?await window.securityDashboard.banIP():console.error("[ban-ip-confirm] SecurityDashboard instance not available")}),a.register("clear-all-bans",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.clearAllBans?await window.securityDashboard.clearAllBans():"function"==typeof clearAllBans?await clearAllBans():console.error("[clear-all-bans] No clearAllBans function available")}),a.register("show-ban-ip-modal",function(e,t){t.preventDefault(),"function"==typeof showBanIpModal?showBanIpModal():window.bootstrap?document.getElementById("banIpModal")&&ModalManager.show("banIpModal"):console.error("[show-ban-ip-modal] No showBanIpModal function available")}),a.register("ban-ip",async function(e,t){t.preventDefault(),"function"==typeof banIp?await banIp():window.securityDashboard&&"function"==typeof window.securityDashboard.banIP?await window.securityDashboard.banIP():console.error("[ban-ip] No banIp function available")}),a.register("start-season-wizard",function(e,t){t.preventDefault(),"function"==typeof startSeasonWizard?startSeasonWizard():console.error("[start-season-wizard] startSeasonWizard function not found")}),a.register("show-existing-seasons",function(e,t){t.preventDefault(),"function"==typeof showExistingSeasons?showExistingSeasons():console.error("[show-existing-seasons] showExistingSeasons function not found")}),a.register("show-main-view",function(e,t){t.preventDefault(),"function"==typeof showMainView?showMainView():console.error("[show-main-view] showMainView function not found")}),a.register("next-step",function(e,t){t.preventDefault(),"function"==typeof nextStep?nextStep():console.error("[next-step] nextStep function not found")}),a.register("previous-step",function(e,t){t.preventDefault(),"function"==typeof previousStep?previousStep():console.error("[previous-step] previousStep function not found")}),a.register("create-season",function(e,t){t.preventDefault(),"function"==typeof createSeason?createSeason():console.error("[create-season] createSeason function not found")}),a.register("update-season-structure",function(e,t){"function"==typeof updateSeasonStructure?updateSeasonStructure():console.error("[update-season-structure] updateSeasonStructure function not found")}),a.register("apply-wizard-template",function(e,t){t.preventDefault();const n=e.dataset.templateType;n?"function"==typeof applyWizardTemplate?applyWizardTemplate(n):console.error("[apply-wizard-template] applyWizardTemplate function not found"):console.error("[apply-wizard-template] Missing template type")}),a.register("add-wizard-field",function(e,t){t.preventDefault(),"function"==typeof addWizardField?addWizardField():console.error("[add-wizard-field] addWizardField function not found")}),a.register("remove-wizard-field",function(e,t){t.preventDefault(),"function"==typeof removeWizardField?removeWizardField(e):console.error("[remove-wizard-field] removeWizardField function not found")}),a.register("set-active-season",function(e,t){t.preventDefault();const n=e.dataset.seasonId,a=e.dataset.seasonType;n&&a?"function"==typeof setActiveSeason?setActiveSeason(n,a):console.error("[set-active-season] setActiveSeason function not found"):console.error("[set-active-season] Missing season ID or type")}),a.register("confirm-delete-season",function(e,t){t.preventDefault();const n=e.dataset.seasonId,a=e.dataset.seasonName;n&&a?"function"==typeof confirmDeleteSeason?confirmDeleteSeason(n,a):console.error("[confirm-delete-season] confirmDeleteSeason function not found"):console.error("[confirm-delete-season] Missing season ID or name")}),a.register("recreate-discord-resources",function(e,t){t.preventDefault();const n=e.dataset.seasonId,a=e.dataset.seasonName;n&&a?"function"==typeof recreateDiscordResources?recreateDiscordResources(n,a):console.error("[recreate-discord-resources] recreateDiscordResources function not found"):console.error("[recreate-discord-resources] Missing season ID or name")}),a.register("toggle-settings",function(e,t){t.preventDefault(),"function"==typeof toggleScheduleSettings?toggleScheduleSettings():console.error("[toggle-settings] toggleScheduleSettings function not found")}),a.register("delete-schedule",function(e,t){t.preventDefault(),"function"==typeof deleteSchedule?deleteSchedule():console.error("[delete-schedule] deleteSchedule function not found")}),a.register("commit-schedule",function(e,t){t.preventDefault(),"function"==typeof commitSchedule?commitSchedule():console.error("[commit-schedule] commitSchedule function not found")}),a.register("select-for-swap",function(e,t){t.preventDefault();const n=parseInt(e.dataset.matchId),a=e.dataset.matchDesc;n&&a?"function"==typeof selectForSwap?selectForSwap(n,a):console.error("[select-for-swap] selectForSwap function not found"):console.error("[select-for-swap] Missing match ID or description")}),a.register("execute-swap",function(e,t){t.preventDefault(),"function"==typeof executeSwap?executeSwap():console.error("[execute-swap] executeSwap function not found")}),a.register("remove-from-swap",function(e,t){t.preventDefault();const n=parseInt(e.dataset.swapIndex);null!=n?"function"==typeof removeFromSwap?removeFromSwap(n):console.error("[remove-from-swap] removeFromSwap function not found"):console.error("[remove-from-swap] Missing swap index")}),a.register("remove-field",function(e,t){t.preventDefault(),"function"==typeof removeField?removeField(e):console.error("[remove-field] removeField function not found")}),a.register("add-field",function(e,t){t.preventDefault(),"function"==typeof addField?addField():console.error("[add-field] addField function not found")}),a.register("apply-template",function(e,t){t.preventDefault();const n=e.dataset.template;n?"function"==typeof applyTemplate?applyTemplate(n):console.error("[apply-template] applyTemplate function not found"):console.error("[apply-template] Missing template type")}),a.register("add-week-config",function(e,t){t.preventDefault(),"function"==typeof addWeekConfig?addWeekConfig():console.error("[add-week-config] addWeekConfig function not found")}),a.register("generate-default-weeks",function(e,t){t.preventDefault(),"function"==typeof generateDefaultWeeks?generateDefaultWeeks():console.error("[generate-default-weeks] generateDefaultWeeks function not found")}),a.register("clear-weeks",function(e,t){t.preventDefault(),"function"==typeof clearWeeks?clearWeeks():console.error("[clear-weeks] clearWeeks function not found")}),a.register("update-week-card",function(e,t){"function"==typeof updateWeekCard?updateWeekCard(e):console.error("[update-week-card] updateWeekCard function not found")}),a.register("remove-week-card",function(e,t){t.preventDefault(),"function"==typeof removeWeekCard?removeWeekCard(e):console.error("[remove-week-card] removeWeekCard function not found")}),a.register("close-toast",function(e,t){t.preventDefault(),e.parentElement&&e.parentElement.remove()}),a.register("toggle-platform",function(e,t){t.preventDefault();const n=e.dataset.platform;n?window.PassStudio&&"function"==typeof window.PassStudio.setPreviewPlatform?window.PassStudio.setPreviewPlatform(n):console.error("[toggle-platform] PassStudio.setPreviewPlatform not available"):console.error("[toggle-platform] Missing platform attribute")}),a.register("update-pass-style",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.updatePassStylePreview?window.PassStudio.updatePassStylePreview():console.error("[update-pass-style] PassStudio.updatePassStylePreview not available")}),a.register("apply-color-preset",function(e,t){t.preventDefault();const n=e.dataset.bg,a=e.dataset.fg,o=e.dataset.label;if(!n||!a||!o)return void console.error("[apply-color-preset] Missing color data attributes");const s=document.getElementById("background_color"),i=document.getElementById("foreground_color"),r=document.getElementById("label_color");s&&(s.value=n),i&&(i.value=a),r&&(r.value=o);const c=document.getElementById("background_color_text"),l=document.getElementById("foreground_color_text"),d=document.getElementById("label_color_text");c&&(c.value=n),l&&(l.value=a),d&&(d.value=o),window.PassStudio&&"function"==typeof window.PassStudio.updatePreviewFromForm&&window.PassStudio.updatePreviewFromForm(),window.PassStudio&&"function"==typeof window.PassStudio.markUnsaved&&window.PassStudio.markUnsaved()}),a.register("sync-color-input",function(e,t){const n=e.dataset.target;if(!n)return;const a=document.getElementById(n);if(a){if("color"===e.type){const t=document.getElementById(n+"_text");t&&(t.value=e.value)}else a.value=e.value;window.PassStudio&&"function"==typeof window.PassStudio.updatePreviewFromForm&&window.PassStudio.updatePreviewFromForm()}}),a.register("update-preview-field",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.updatePreviewFromForm&&window.PassStudio.updatePreviewFromForm()}),a.register("toggle-logo-visibility",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.toggleLogoVisibility&&window.PassStudio.toggleLogoVisibility()}),a.register("open-asset-cropper",function(e,t){t.preventDefault();const n=e.dataset.assetType;n?window.PassStudio&&"function"==typeof window.PassStudio.openAssetCropper?window.PassStudio.openAssetCropper(n):console.error("[open-asset-cropper] PassStudio.openAssetCropper not available"):console.error("[open-asset-cropper] Missing asset type")}),a.register("update-google-preview",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.updateGooglePreview&&window.PassStudio.updateGooglePreview()}),a.register("update-barcode-preview",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.updateBarcodePreview&&window.PassStudio.updateBarcodePreview()}),a.register("save-appearance",function(e,t){t.preventDefault(),window.PassStudio&&"function"==typeof window.PassStudio.saveAppearance?window.PassStudio.saveAppearance():console.error("[save-appearance] PassStudio.saveAppearance not available")}),a.register("initialize-defaults",function(e,t){t.preventDefault(),window.FieldsManager&&"function"==typeof window.FieldsManager.initializeDefaults?window.FieldsManager.initializeDefaults():console.error("[initialize-defaults] FieldsManager.initializeDefaults not available")}),a.register("add-field",function(e,t){t.preventDefault();const n=e.dataset.fieldType;n?window.FieldsManager&&"function"==typeof window.FieldsManager.openAddFieldModal?window.FieldsManager.openAddFieldModal(n):console.error("[add-field] FieldsManager.openAddFieldModal not available"):console.error("[add-field] Missing field type")}),a.register("create-field",function(e,t){t.preventDefault(),window.FieldsManager&&"function"==typeof window.FieldsManager.createField?window.FieldsManager.createField():console.error("[create-field] FieldsManager.createField not available")}),a.register("save-fields",function(e,t){t.preventDefault(),window.FieldsManager&&"function"==typeof window.FieldsManager.saveFields?window.FieldsManager.saveFields():console.error("[save-fields] FieldsManager.saveFields not available")}),a.register("reset-fields",function(e,t){t.preventDefault(),window.FieldsManager&&"function"==typeof window.FieldsManager.resetFields?window.FieldsManager.resetFields():console.error("[reset-fields] FieldsManager.resetFields not available")}),a.register("insert-variable",function(e,t){t.preventDefault();const n=e.dataset.variableName;n?window.FieldsManager&&"function"==typeof window.FieldsManager.insertVariableInAdd?window.FieldsManager.insertVariableInAdd(n):console.error("[insert-variable] FieldsManager.insertVariableInAdd not available"):console.error("[insert-variable] Missing variable name")}),a.register("refresh-approval-stats",function(e,t){t.preventDefault(),"function"==typeof window.refreshStats?window.refreshStats():console.error("[refresh-approval-stats] refreshStats function not found")}),a.register("show-player-details",function(e,t){t.preventDefault();const n=e.dataset.userId;n?"function"==typeof window.showPlayerDetails?window.showPlayerDetails(parseInt(n)):console.error("[show-player-details] showPlayerDetails function not found"):console.error("[show-player-details] Missing user ID")}),a.register("show-approval-modal",function(e,t){t.preventDefault();const n=e.dataset.userId;n?"function"==typeof window.showApprovalModal?window.showApprovalModal(parseInt(n)):console.error("[show-approval-modal] showApprovalModal function not found"):console.error("[show-approval-modal] Missing user ID")}),a.register("show-denial-modal",function(e,t){t.preventDefault();const n=e.dataset.userId;n?"function"==typeof window.showDenialModal?window.showDenialModal(parseInt(n)):console.error("[show-denial-modal] showDenialModal function not found"):console.error("[show-denial-modal] Missing user ID")}),a.register("approve-user",function(e,t){t.preventDefault(),"function"==typeof window.submitApproval?window.submitApproval():console.error("[approve-user] submitApproval function not found")}),a.register("deny-user",function(e,t){t.preventDefault(),"function"==typeof window.submitDenial?window.submitDenial():console.error("[deny-user] submitDenial function not found")}),window.EventDelegation=a,void 0!==t&&t.exports&&(t.exports=a),function(){const e=window.fetch,t=["POST","PUT","DELETE","PATCH"];window.fetch=function(n,a={}){const o=(a.method||"GET").toUpperCase();if(t.includes(o)){const e=function(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):null}();e&&(a.headers=a.headers||{},a.headers instanceof Headers?a.headers.has("X-CSRFToken")||a.headers.set("X-CSRFToken",e):a.headers["X-CSRFToken"]||a.headers["x-csrftoken"]||(a.headers["X-CSRFToken"]=e))}return e.call(window,n,a)},window.fetchWithCSRF=window.fetch,console.debug("[CSRF] Fetch wrapper initialized")}(),function(){const e={ROOT_EL:document.documentElement,LAYOUT_BREAKPOINT:1200,RESIZE_DELAY:200,_initialized:!1,_listeners:[],_resizeCallback:null,_resizeTimeout:null,menuPsScroll:null,mainMenu:null,isRtl:function(){var e,t;return"rtl"===(null==(e=document.querySelector("body"))?void 0:e.getAttribute("dir"))||"rtl"===(null==(t=document.querySelector("html"))?void 0:t.getAttribute("dir"))},isMobileDevice:function(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")},isSmallScreen:function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<this.LAYOUT_BREAKPOINT},isDarkStyle:function(){return"dark"===document.documentElement.getAttribute("data-style")||document.documentElement.classList.contains("dark-style")},isLightStyle:function(){return!this.isDarkStyle()},isCollapsed:function(){return this.isSmallScreen()?!document.documentElement.classList.contains("layout-menu-expanded"):document.documentElement.classList.contains("layout-menu-collapsed")},isFixed:function(){return document.documentElement.classList.contains("layout-menu-fixed")||document.documentElement.classList.contains("layout-menu-fixed-offcanvas")},isOffcanvas:function(){return document.documentElement.classList.contains("layout-menu-offcanvas")||document.documentElement.classList.contains("layout-menu-fixed-offcanvas")},isNavbarFixed:function(){return document.documentElement.classList.contains("layout-navbar-fixed")},isFooterFixed:function(){return document.documentElement.classList.contains("layout-footer-fixed")},isLayoutNavbarFull:function(){return!!document.querySelector(".layout-wrapper.layout-navbar-full")},getLayoutMenu:function(){return document.querySelector(".layout-menu, .c-sidebar")},getMenu:function(){const e=this.getLayoutMenu();return e?e.classList.contains("menu")?e:e.querySelector(".menu"):null},getLayoutNavbar:function(){return document.querySelector(".layout-navbar")},getLayoutFooter:function(){return document.querySelector(".content-footer")},_addClass:function(e,t=this.ROOT_EL){t&&(void 0!==t.length?t:[t]).forEach(t=>{t&&e.split(" ").forEach(e=>t.classList.add(e))})},_removeClass:function(e,t=this.ROOT_EL){t&&(void 0!==t.length?t:[t]).forEach(t=>{t&&e.split(" ").forEach(e=>t.classList.remove(e))})},_hasClass:function(e,t=this.ROOT_EL){let n=!1;return e.split(" ").forEach(e=>{t.classList.contains(e)&&(n=!0)}),n},setCollapsed:function(e,t=!0){this.isSmallScreen()?e?(this._removeClass("layout-menu-expanded"),document.body.classList.remove("sidebar-open")):(this._addClass("layout-menu-expanded"),document.body.classList.add("sidebar-open")):e?this._addClass("layout-menu-collapsed"):this._removeClass("layout-menu-collapsed"),this._triggerEvent("toggle")},toggleCollapsed:function(e=!0){this.setCollapsed(!this.isCollapsed(),e)},setNavbarFixed:function(e){e?this._addClass("layout-navbar-fixed"):this._removeClass("layout-navbar-fixed")},setFooterFixed:function(e){e?this._addClass("layout-footer-fixed"):this._removeClass("layout-footer-fixed")},scrollToActive:function(e=!1){const t=this.getLayoutMenu();if(!t)return;const n=t.querySelector("li.menu-item.active:not(.open), .c-sidebar__item.is-active");if(!n)return;const a=t.querySelector(".menu-inner, .c-sidebar__nav");if(!a)return;const o=n.getBoundingClientRect().top-a.getBoundingClientRect().top+a.scrollTop;if(o<.66*a.clientHeight)return;const s=o-a.clientHeight/2;e?a.scrollTo({top:s,behavior:"smooth"}):a.scrollTop=s},swipeIn:function(e,t){if("undefined"!=typeof Hammer&&"string"==typeof e){const n=document.querySelector(e);n&&new Hammer(n).on("panright",t)}},swipeOut:function(e,t){"undefined"!=typeof Hammer&&"string"==typeof e&&setTimeout(()=>{const n=document.querySelector(e);if(n){const e=new Hammer(n);e.get("pan").set({direction:Hammer.DIRECTION_ALL,threshold:250}),e.on("panleft",t)}},500)},initPasswordToggle:function(){document.querySelectorAll(".form-password-toggle i").forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();const n=e.closest(".form-password-toggle"),a=null==n?void 0:n.querySelector("input"),o=null==n?void 0:n.querySelector("i");a&&o&&("text"===a.type?(a.type="password",o.classList.replace("ti-eye","ti-eye-off")):(a.type="text",o.classList.replace("ti-eye-off","ti-eye")))})})},initCustomOptionCheck:function(){document.querySelectorAll(".custom-option .form-check-input").forEach(e=>{this.updateCustomOptionCheck(e),e.addEventListener("click",()=>this.updateCustomOptionCheck(e))})},updateCustomOptionCheck:function(e){var t,n,a;e.checked?("radio"===e.type&&(null==(t=e.closest(".row"))||t.querySelectorAll(".custom-option").forEach(e=>{e.classList.remove("checked")})),null==(n=e.closest(".custom-option"))||n.classList.add("checked")):null==(a=e.closest(".custom-option"))||a.classList.remove("checked")},initSpeechToText:function(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;e&&document.querySelectorAll(".speech-to-text i").forEach(t=>{let n=!1;t.addEventListener("click",function(){var a;const o=null==(a=t.closest(".input-group"))?void 0:a.querySelector(".form-control");if(!o)return;o.focus();const s=new e;s.onspeechstart=()=>{n=!0},s.onerror=()=>{n=!1},s.onresult=e=>{o.value=e.results[0][0].transcript},s.onspeechend=()=>{n=!1,s.stop()},n||s.start()})})},initNavbarDropdownScrollbar:function(){"undefined"!=typeof PerfectScrollbar&&document.querySelectorAll(".navbar-dropdown .scrollable-container").forEach(e=>{new PerfectScrollbar(e,{wheelPropagation:!1,suppressScrollX:!0})})},initSidebarToggle:function(){document.querySelectorAll('[data-bs-toggle="sidebar"]').forEach(e=>{e.addEventListener("click",function(){const t=e.getAttribute("data-target"),n=e.getAttribute("data-overlay"),a=document.querySelector(".app-overlay");document.querySelectorAll(t).forEach(e=>{e.classList.toggle("show"),n&&a&&(e.classList.contains("show")?a.classList.add("show"):a.classList.remove("show"),a.addEventListener("click",t=>{t.currentTarget.classList.remove("show"),e.classList.remove("show")}))})})})},on:function(e,t){const[n,...a]=e.split("."),o=a.join(".")||null;this._listeners.push({event:n,namespace:o,callback:t})},off:function(e){const[t,...n]=e.split("."),a=n.join(".")||null;this._listeners=this._listeners.filter(e=>!(e.event===t&&e.namespace===a))},_triggerEvent:function(e){window.dispatchEvent(new Event("layout"+e)),this._listeners.filter(t=>t.event===e).forEach(e=>e.callback.call(null))},update:function(){},setAutoUpdate:function(e){},init:function(){if(this._initialized)return;this._initialized=!0;const e=this;this._resizeCallback=function(){e._resizeTimeout&&clearTimeout(e._resizeTimeout),e._resizeTimeout=setTimeout(()=>{e._triggerEvent("resize")},e.RESIZE_DELAY)},window.addEventListener("resize",this._resizeCallback)},destroy:function(){this._initialized&&(this._initialized=!1,this._resizeCallback&&(window.removeEventListener("resize",this._resizeCallback),this._resizeCallback=null),this._listeners=[])}};e.init(),window.Helpers=e}();let c=(o(n=class{static init(e=document){e===document&&this._initialized||("undefined"!=typeof bootstrap&&void 0!==bootstrap.Modal?(this.log("Initializing Modal Manager..."),this.discoverModals(e),e===document&&(this.setupEventDelegation(),this.setupMutationObserver(),this._initialized=!0),this.log(`Initialized with ${this.modalInstances.size} modals`)):console.error("[ModalManager] Bootstrap not loaded. Cannot initialize modals."))}static discoverModals(e=document){e.querySelectorAll("[data-modal], .modal").forEach(e=>{if(e.id){if(this.modalInstances.has(e.id))return;try{let t=bootstrap.Modal.getInstance(e);t||(t=new bootstrap.Modal(e)),this.modalInstances.set(e.id,t),this.log(`Cached modal: ${e.id}`)}catch(t){console.error(`[ModalManager] Failed to initialize modal ${e.id}:`,t)}}else console.warn("[ModalManager] Found modal without ID. Modals should have unique IDs:",e)})}static setupEventDelegation(){"undefined"!=typeof EventDelegation?(EventDelegation.register("show-modal",(e,t)=>{const n=e.dataset.modalId;if(n){const t=this.parseOptionsFromElement(e);this.show(n,t)}else console.error('[ModalManager] data-action="show-modal" requires data-modal-id attribute')},{preventDefault:!0}),EventDelegation.register("hide-modal",(e,t)=>{const n=e.dataset.modalId;if(n)this.hide(n);else{const t=e.closest("[data-modal], .modal");t&&t.id&&this.hide(t.id)}},{preventDefault:!0}),EventDelegation.register("close-modal",(e,t)=>{const n=e.dataset.modalId;if(n)this.hide(n);else{const t=e.closest("[data-modal], .modal");t&&t.id&&this.hide(t.id)}},{preventDefault:!0}),EventDelegation.register("toggle-modal",(e,t)=>{const n=e.dataset.modalId;n?this.toggle(n):console.error('[ModalManager] data-action="toggle-modal" requires data-modal-id attribute')},{preventDefault:!0}),this.log("Event delegation registered via EventDelegation system")):(document.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,a=t.dataset.modalId;switch(n){case"show-modal":if(a){e.preventDefault();const n=this.parseOptionsFromElement(t);this.show(a,n)}else console.error('[ModalManager] data-action="show-modal" requires data-modal-id attribute');break;case"hide-modal":case"close-modal":if(e.preventDefault(),a)this.hide(a);else{const e=t.closest("[data-modal], .modal");e&&e.id&&this.hide(e.id)}break;case"toggle-modal":a?(e.preventDefault(),this.toggle(a)):console.error('[ModalManager] data-action="toggle-modal" requires data-modal-id attribute')}}),this.log("Event delegation registered via fallback click handler"))}static parseOptionsFromElement(e){const t={};return void 0!==e.dataset.backdrop&&(t.backdrop="false"!==e.dataset.backdrop&&e.dataset.backdrop),void 0!==e.dataset.keyboard&&(t.keyboard="true"===e.dataset.keyboard),void 0!==e.dataset.focus&&(t.focus="true"===e.dataset.focus),Object.keys(t).length>0?t:null}static setupMutationObserver(){new MutationObserver(e=>{e.forEach(e=>{e.removedNodes.forEach(e=>{var t,n;1===e.nodeType&&((null==(t=e.classList)?void 0:t.contains("modal"))||(null==(n=e.hasAttribute)?void 0:n.call(e,"data-modal")))&&e.id&&this.cleanup(e.id)})})}).observe(document.body,{childList:!0,subtree:!0})}static show(e,t=null){if(!e)return console.error("[ModalManager] show() requires a modal ID"),!1;this.log(`Showing modal: ${e}`);let n=this.modalInstances.get(e);if(!n){const o=document.getElementById(e);if(!o)return console.error(`[ModalManager] Modal element not found: ${e}`),!1;try{n=bootstrap.Modal.getInstance(o),n||(n=new bootstrap.Modal(o,t)),this.modalInstances.set(e,n),this.log(`Created and cached new modal: ${e}`)}catch(a){return console.error(`[ModalManager] Failed to initialize modal ${e}:`,a),!1}}try{return n.show(),!0}catch(a){return console.error(`[ModalManager] Failed to show modal ${e}:`,a),!1}}static hide(e){if(!e)return console.error("[ModalManager] hide() requires a modal ID"),!1;this.log(`Hiding modal: ${e}`);const t=this.modalInstances.get(e);if(!t){console.warn(`[ModalManager] Modal not found in cache: ${e}`);const t=document.getElementById(e);if(t){const a=bootstrap.Modal.getInstance(t);if(a)try{return a.hide(),!0}catch(n){return console.error(`[ModalManager] Failed to hide modal ${e}:`,n),!1}}return!1}try{return t.hide(),!0}catch(n){return console.error(`[ModalManager] Failed to hide modal ${e}:`,n),!1}}static toggle(e){if(!e)return console.error("[ModalManager] toggle() requires a modal ID"),!1;const t=this.modalInstances.get(e);if(!t)return this.show(e);try{return t.toggle(),!0}catch(n){return console.error(`[ModalManager] Failed to toggle modal ${e}:`,n),!1}}static getInstance(e){return this.modalInstances.get(e)||null}static cleanup(e){if(this.modalInstances.has(e)){this.log(`Cleaning up modal: ${e}`);try{this.modalInstances.get(e).dispose()}catch(t){console.warn(`[ModalManager] Error disposing modal ${e}:`,t)}this.modalInstances.delete(e)}}static cleanupAll(){this.log("Cleaning up all modals..."),this.modalInstances.forEach((e,t)=>{try{e.dispose()}catch(n){console.warn(`[ModalManager] Error disposing modal ${t}:`,n)}}),this.modalInstances.clear(),this.log("All modals cleaned up")}static reinit(e=document){this.log("Reinitializing Modal Manager..."),this.discoverModals(e)}static enableDebug(){this.DEBUG=!0,console.log("[ModalManager] Debug mode enabled")}static disableDebug(){this.DEBUG=!1}static log(...e){this.DEBUG&&console.log("[ModalManager]",...e)}},"modalInstances",new Map),o(n,"DEBUG",!0),o(n,"_initialized",!1),n);function l(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}void 0!==window.InitSystem?window.InitSystem.register("ModalManager",{priority:20,init:function(e){c.init(e)}}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>c.init()):c.init(),window.ModalManager=c,window.safeGetModal=function(e){return console.warn("[Deprecated] safeGetModal() is deprecated. Use ModalManager.getInstance() instead."),c.getInstance(e)},window.safeShowModal=function(e){return console.warn("[Deprecated] safeShowModal() is deprecated. Use ModalManager.show() instead."),c.show(e)};let d,u={colors:{primary:"#7C3AED",success:"#10B981",danger:"#EF4444",warning:"#F59E0B",info:"#3B82F6",secondary:"#64748B",light:"#FAFAFA",dark:"#18181B"},colors_label:{},colors_dark:{}};window.assetsPath=document.documentElement.getAttribute("data-assets-path"),window.templateName=document.documentElement.getAttribute("data-template"),window.rtlSupport=!0,document.addEventListener("DOMContentLoaded",function(){document.documentElement.setAttribute("data-content","wide"),u.colors={primary:l("--ecs-primary","#7C3AED"),success:l("--ecs-success","#10B981"),danger:l("--ecs-danger","#EF4444"),warning:l("--ecs-warning","#F59E0B"),info:l("--ecs-info","#3B82F6"),secondary:l("--ecs-secondary","#64748B"),light:l("--ecs-neutral-5","#FAFAFA"),dark:l("--ecs-neutral-90","#18181B")},u.colors_label={...u.colors},u.colors_dark={cardBg:l("--ecs-dark-bg-card","#18181B"),bodyBg:l("--ecs-dark-bg-body","#09090B"),headerBg:l("--ecs-dark-bg-elevated","#27272A")}}),function(){const e={sidebar:".c-sidebar",sidebarToggle:'[data-action="toggle-sidebar"]',submenuToggle:'[data-action="toggle-submenu"]',expandableItem:"[data-expandable]"},t={open:"is-open",collapsed:"layout-menu-collapsed"},n={collapsedKey:"sidebar-collapsed"},a={desktop:1200},o={isDesktop:window.innerWidth>=a.desktop,isSidebarOpen:!1,collapsedState:"true"===localStorage.getItem(n.collapsedKey)};let s=null;function i(){s=document.querySelector(e.sidebar),s?(o.isDesktop&&o.collapsedState&&document.body.classList.add(t.collapsed),document.addEventListener("click",r),document.addEventListener("click",c),s.addEventListener("keydown",p),function(){let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(w,150)})}(),s.hasAttribute("role")||s.setAttribute("role","navigation"),s.hasAttribute("aria-label")||s.setAttribute("aria-label","Main navigation"),o.isDesktop||s.setAttribute("aria-hidden","true"),s.querySelectorAll(e.submenuToggle).forEach(n=>{const a=n.closest(e.expandableItem),o=null==a?void 0:a.classList.contains(t.open);n.setAttribute("aria-expanded",o)}),console.log("Sidebar interactions initialized")):console.warn("Sidebar not found")}function r(n){var a;const s=n.target,i=null==(a=s.closest("[data-action]"))?void 0:a.getAttribute("data-action");if(i)switch(i){case"toggle-sidebar":case"toggle-menu":n.preventDefault(),l();break;case"close-menu":n.preventDefault(),o.isDesktop||m();break;case"toggle-submenu":n.preventDefault(),function(n){const a=n.closest(e.expandableItem);if(!a)return;const o=a.classList.toggle(t.open);n.setAttribute("aria-expanded",o),console.log("Submenu toggled:",o)}(s);break;case"no-active-season":n.preventDefault(),alert("No active Pub League season");break;case"navigate":case"navigate-home":o.isDesktop||m()}}function c(e){o.isDesktop||o.isSidebarOpen&&(s.contains(e.target)||m())}function l(){o.isDesktop?d():o.isSidebarOpen?m():u()}function d(){const a=document.body.classList.toggle(t.collapsed);o.collapsedState=a,localStorage.setItem(n.collapsedKey,a);const i=s.querySelector(e.sidebarToggle);i&&i.setAttribute("aria-label",a?"Expand navigation menu":"Collapse navigation menu"),console.log("Sidebar collapsed state:",a)}function u(){s.classList.add(t.open),o.isSidebarOpen=!0,document.documentElement.classList.add("layout-menu-expanded");const e=document.querySelector(".layout-overlay");e&&e.classList.add("show"),s.setAttribute("aria-hidden","false"),function(){const e=h();f=e[0],v=e[e.length-1],g=!0,null==f||f.focus(),document.addEventListener("keydown",y)}(),console.log("Sidebar opened")}function m(){s.classList.remove(t.open),o.isSidebarOpen=!1,document.documentElement.classList.remove("layout-menu-expanded");const e=document.querySelector(".layout-overlay");e&&e.classList.remove("show"),s.setAttribute("aria-hidden","true"),g=!1,document.removeEventListener("keydown",y),console.log("Sidebar closed")}function p(e){const{key:t,target:n}=e;if("Escape"!==t||o.isDesktop){if(n.matches("a, button"))switch(t){case"ArrowUp":e.preventDefault(),function(e){var t;const n=h(),a=n.indexOf(e),o=a>0?a-1:n.length-1;null==(t=n[o])||t.focus()}(n);break;case"ArrowDown":e.preventDefault(),function(e){var t;const n=h(),a=n.indexOf(e),o=a<n.length-1?a+1:0;null==(t=n[o])||t.focus()}(n);break;case"Home":e.preventDefault(),function(){var e;const t=h();null==(e=t[0])||e.focus()}();break;case"End":e.preventDefault(),function(){var e;const t=h();null==(e=t[t.length-1])||e.focus()}()}}else m()}function h(){return Array.from(s.querySelectorAll("a[href], button:not([disabled])")).filter(e=>!e.closest(".c-sidebar__link--disabled"))}let g=!1,f=null,v=null;function y(e){g&&"Tab"===e.key&&(e.shiftKey?document.activeElement===f&&(e.preventDefault(),null==v||v.focus()):document.activeElement===v&&(e.preventDefault(),null==f||f.focus()))}function w(){const e=o.isDesktop;o.isDesktop=window.innerWidth>=a.desktop,e&&!o.isDesktop&&(m(),document.body.classList.remove(t.collapsed)),!e&&o.isDesktop&&(m(),o.collapsedState&&document.body.classList.add(t.collapsed))}window.SidebarInteractions={open:u,close:m,toggle:l,collapse:()=>{o.isDesktop&&!o.collapsedState&&d()},expand:()=>{o.isDesktop&&o.collapsedState&&d()}},void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("sidebar-interactions",i,{priority:80,description:"Sidebar toggle, collapse, and mobile drawer interactions",reinitializable:!1}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()}();class m{constructor(){this.navbar=document.querySelector(".c-navbar-modern"),this.navbar?(this.activeDropdown=null,this.lastScrollTop=0,this.scrollThreshold=50,this.init()):console.warn("Modern navbar not found")}getCSRFToken(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const t=document.querySelector('input[name="csrf_token"]');if(t)return t.value;const n=document.cookie.split(";");for(const a of n){const[e,t]=a.trim().split("=");if("csrf_token"===e)return decodeURIComponent(t)}return""}init(){this.registerEventHandlers(),this.attachEventListeners(),this.initScrollTracking(),this.initSearch(),this.initNotifications(),this.initRoleImpersonation(),this.initTheme(),this.initPresence()}registerEventHandlers(){"undefined"!=typeof EventDelegation?(EventDelegation.register("toggle-menu",(e,t)=>{this.toggleMobileMenu()},{preventDefault:!0}),EventDelegation.register("toggle-dropdown",(e,t)=>{const n=e.dataset.dropdown;n&&this.toggleDropdown(n)},{preventDefault:!0}),EventDelegation.register("switch-theme",(e,t)=>{const n=e.dataset.theme;n&&this.switchTheme(n)},{preventDefault:!0}),EventDelegation.register("start-impersonation",(e,t)=>{this.startRoleImpersonation()},{preventDefault:!0}),EventDelegation.register("stop-impersonation",(e,t)=>{this.stopRoleImpersonation()},{preventDefault:!0}),EventDelegation.register("mark-read",(e,t)=>{const n=e.dataset.notificationId;n&&this.markNotificationRead(n)},{preventDefault:!0}),EventDelegation.register("mark-all-read",(e,t)=>{this.markAllNotificationsRead()},{preventDefault:!0}),EventDelegation.register("clear-all-notifications",(e,t)=>{this.clearAllNotifications()},{preventDefault:!0}),EventDelegation.register("dismiss-notification",(e,t)=>{const n=e.dataset.notificationId;n&&this.dismissNotification(n)},{preventDefault:!0,stopPropagation:!0}),EventDelegation.register("expand-notification",(e,t)=>{const n=e.dataset.notificationId;n&&this.toggleNotificationExpand(n)},{preventDefault:!0}),EventDelegation.register("logout",(e,t)=>{this.handleLogout()},{preventDefault:!0})):console.warn("[Navbar] EventDelegation not available, using fallback")}attachEventListeners(){document.addEventListener("keydown",this.handleKeyboard.bind(this)),document.addEventListener("click",this.handleOutsideClick.bind(this))}handleKeyboard(e){if("Escape"!==e.key||!this.activeDropdown)return!this.activeDropdown||"ArrowDown"!==e.key&&"ArrowUp"!==e.key?void 0:(e.preventDefault(),void this.navigateDropdown(e.key));this.closeDropdown(this.activeDropdown)}handleOutsideClick(e){if(!this.activeDropdown)return;const t=document.querySelector(`[data-dropdown-id="${this.activeDropdown}"]`),n=document.querySelector(`[data-dropdown="${this.activeDropdown}"]`);t&&!t.contains(e.target)&&n&&!n.contains(e.target)&&this.closeDropdown(this.activeDropdown)}toggleDropdown(e){const t=document.querySelector(`[data-dropdown-id="${e}"]`);t&&(this.activeDropdown&&this.activeDropdown!==e&&this.closeDropdown(this.activeDropdown),t.classList.contains("is-open")?this.closeDropdown(e):this.openDropdown(e))}openDropdown(e){const t=document.querySelector(`[data-dropdown-id="${e}"]`),n=document.querySelector(`[data-dropdown="${e}"]`);t&&(t.classList.add("is-open"),t.setAttribute("aria-hidden","false"),n&&(n.classList.add("is-active"),n.setAttribute("aria-expanded","true")),this.activeDropdown=e,this.staggerDropdownItems(t))}closeDropdown(e){const t=document.querySelector(`[data-dropdown-id="${e}"]`),n=document.querySelector(`[data-dropdown="${e}"]`);t&&(t.classList.remove("is-open"),t.setAttribute("aria-hidden","true"),n&&(n.classList.remove("is-active"),n.setAttribute("aria-expanded","false")),this.activeDropdown===e&&(this.activeDropdown=null))}staggerDropdownItems(e){e.querySelectorAll(".c-navbar-modern__dropdown-item").forEach((e,t)=>{e.style.opacity="0",e.style.transform="translateX(-8px)",setTimeout(()=>{e.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",e.style.opacity="1",e.style.transform="translateX(0)"},30*t)})}navigateDropdown(e){var t;const n=document.querySelector(`[data-dropdown-id="${this.activeDropdown}"]`);if(!n)return;const a=Array.from(n.querySelectorAll(".c-navbar-modern__dropdown-item:not([disabled])")),o=a.findIndex(e=>e===document.activeElement);let s;s="ArrowDown"===e?o<a.length-1?o+1:0:o>0?o-1:a.length-1,null==(t=a[s])||t.focus()}toggleMobileMenu(){const e=document.querySelector('[data-action="toggle-menu"]'),t=document.querySelector("[data-mobile-menu]");e&&t&&(e.classList.contains("is-open")?(e.classList.remove("is-open"),t.classList.remove("is-open"),document.body.style.overflow=""):(e.classList.add("is-open"),t.classList.add("is-open"),document.body.style.overflow="hidden"))}initScrollTracking(){let e=!1;window.addEventListener("scroll",()=>{e||(window.requestAnimationFrame(()=>{const t=window.pageYOffset||document.documentElement.scrollTop;t>this.scrollThreshold?this.navbar.classList.add("is-scrolled"):this.navbar.classList.remove("is-scrolled"),this.lastScrollTop=t,e=!1}),e=!0)})}initSearch(){const e=document.querySelector(".c-navbar-modern__search-input");if(!e)return;const t=e.closest("form");let n;t&&t.addEventListener("submit",e=>{e.preventDefault()}),e.addEventListener("input",e=>{clearTimeout(n);const t=e.target.value.trim();t.length>=2&&(n=setTimeout(()=>{this.performSearch(t)},300))}),e.addEventListener("focus",()=>{e.parentElement.classList.add("is-focused")}),e.addEventListener("blur",()=>{e.parentElement.classList.remove("is-focused")})}performSearch(e){"function"==typeof window.initializePlayerSearch&&console.log("Searching for:",e)}switchTheme(e){this.closeDropdown("theme");let t=e;"system"===e&&(t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");const n=document.documentElement,a=document.body;n.setAttribute("data-style",t),n.setAttribute("data-bs-theme",t),a.setAttribute("data-bs-theme",t),n.setAttribute("data-theme",t),"dark"===t?(n.classList.add("dark-style"),n.classList.remove("light-style")):(n.classList.add("light-style"),n.classList.remove("dark-style")),localStorage.setItem("theme",e),localStorage.setItem("templateCustomizer-skin",t);const o=document.querySelector('[data-role="theme-icon"]');if(o){const t={light:"ti-sun",dark:"ti-moon-stars",system:"ti-device-desktop"}[e]||"ti-moon-stars";o.className=`c-navbar-modern__theme-icon ti ${t}`}document.querySelectorAll('[data-action="switch-theme"]').forEach(t=>{t.dataset.theme===e?t.classList.add("is-active"):t.classList.remove("is-active")}),this.showToast(`Theme switched to ${e} mode`)}startRoleImpersonation(){const e=document.querySelectorAll('input[name="impersonate_roles"]:checked'),t=Array.from(e).map(e=>e.value);0!==t.length?fetch("/admin-panel/user-management/impersonate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({roles:t})}).then(e=>e.json()).then(e=>{if(e.success){const e=document.querySelector('[data-dropdown="impersonation"]');e&&e.classList.add("c-navbar-modern__impersonation-active");const n=null==e?void 0:e.querySelector(".c-navbar-modern__badge");n&&n.classList.remove("u-hidden");const a=document.getElementById("currentRoleStatus"),o=document.getElementById("activeImpersonationStatus"),s=document.getElementById("activeRolesList");a&&a.classList.add("u-hidden"),o&&(o.classList.remove("u-hidden"),s&&(s.innerHTML=t.map(e=>`<span class="c-role-status__role-tag">${e}</span>`).join(""))),this.closeDropdown("impersonation"),this.showToast("Role testing started","success"),setTimeout(()=>window.location.reload(),1e3)}else this.showToast(e.message||"Failed to start role testing","error")}).catch(e=>{console.error("Impersonation error:",e),this.showToast("An error occurred","error")}):this.showToast("Please select at least one role","warning")}stopRoleImpersonation(){fetch("/admin-panel/user-management/stop-impersonate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}}).then(e=>e.json()).then(e=>{e.success&&(this.showToast("Impersonation stopped","success"),setTimeout(()=>window.location.reload(),1e3))}).catch(e=>{console.error("Stop impersonation error:",e)})}async markNotificationRead(e){const t=document.querySelector(`[data-notification-id="${e}"]`);if(t){t.classList.remove("is-unread");try{const t=await fetch(`/api/notifications/${e}/read`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}}),n=await t.json();n.success&&this.updateNotificationBadge(n.unread_count)}catch(n){console.error("Mark notification read error:",n),t.classList.add("is-unread")}}}async markAllNotificationsRead(){document.querySelectorAll(".c-navbar-modern__notification.is-unread").forEach(e=>{e.classList.remove("is-unread")});try{const e=await fetch("/api/notifications/mark-all-read",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}});(await e.json()).success&&(this.updateNotificationBadge(0),this.showToast("All notifications marked as read","success"))}catch(e){console.error("Mark all read error:",e),this.loadNotifications()}}handleLogout(){const e=document.querySelector("#logout-form");e&&e.submit()}initNotifications(){this.loadNotifications(),setInterval(()=>this.refreshNotificationCount(),6e4)}async loadNotifications(){const e=document.getElementById("notifications-list");if(!e)return;const t=e.querySelector('[data-state="loading"]'),n=e.querySelector('[data-state="empty"]');try{const a=await fetch("/api/notifications?include_read=true&limit=10"),o=await a.json();t&&t.classList.add("u-hidden"),o.success&&o.notifications.length>0?(n&&n.classList.add("u-hidden"),e.querySelectorAll(".c-navbar-modern__notification").forEach(e=>e.remove()),o.notifications.forEach(t=>{const n=this.createNotificationElement(t);e.appendChild(n)}),this.updateNotificationBadge(o.unread_count)):(n&&n.classList.remove("u-hidden"),this.updateNotificationBadge(0))}catch(a){if(console.error("Error loading notifications:",a),t&&t.classList.add("u-hidden"),n){n.classList.remove("u-hidden");const e=n.querySelector("p");e&&(e.textContent="Failed to load notifications")}}}createNotificationElement(e){const t=document.createElement("div");t.className="c-navbar-modern__notification"+(e.is_read?"":" is-unread"),t.setAttribute("data-notification-id",e.id),t.setAttribute("role","menuitem"),t.setAttribute("tabindex","0");const n=e.icon_color?`text-${e.icon_color}`:"",a=e.message.length>80?e.message.substring(0,80)+"...":e.message,o=e.message.length>80;return t.innerHTML=`\n      <div class="c-navbar-modern__notification-main"\n           data-action="expand-notification"\n           data-notification-id="${e.id}">\n        <div class="c-navbar-modern__notification-icon ${n}">\n          <i class="${e.icon}"></i>\n        </div>\n        <div class="c-navbar-modern__notification-content">\n          <p class="c-navbar-modern__notification-title">${this.escapeHtml(e.title)}</p>\n          <p class="c-navbar-modern__notification-text">${this.escapeHtml(a)}</p>\n          ${o?'<span class="c-navbar-modern__notification-expand-hint">Click to read more</span>':""}\n        </div>\n        <span class="c-navbar-modern__notification-time">${e.time_ago}</span>\n      </div>\n      <div class="c-navbar-modern__notification-expanded u-hidden" data-expanded-content>\n        <p class="c-navbar-modern__notification-full-text">${this.escapeHtml(e.message)}</p>\n        <span class="c-navbar-modern__notification-date">${e.created_at||""}</span>\n      </div>\n      <button class="c-navbar-modern__notification-dismiss"\n              data-action="dismiss-notification"\n              data-notification-id="${e.id}"\n              aria-label="Dismiss notification"\n              title="Dismiss">\n        <i class="ti ti-x" aria-hidden="true"></i>\n      </button>\n    `,t}toggleNotificationExpand(e){const t=document.querySelector(`[data-notification-id="${e}"]`);if(!t)return;const n=t.querySelector("[data-expanded-content]");n&&(t.classList.contains("is-expanded")?(t.classList.remove("is-expanded"),n.classList.add("u-hidden")):(t.classList.add("is-expanded"),n.classList.remove("u-hidden"),t.classList.contains("is-unread")&&this.markNotificationRead(e)))}async dismissNotification(e){const t=document.querySelector(`[data-notification-id="${e}"]`);if(t){t.classList.add("is-dismissing");try{const n=await fetch(`/api/notifications/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}}),a=await n.json();a.success?setTimeout(()=>{t.remove(),this.updateNotificationBadge(a.unread_count);const e=document.getElementById("notifications-list");if(0===e.querySelectorAll(".c-navbar-modern__notification").length){const t=e.querySelector('[data-state="empty"]');t&&t.classList.remove("u-hidden")}},200):(t.classList.remove("is-dismissing"),this.showToast("Failed to dismiss notification","error"))}catch(n){console.error("Dismiss notification error:",n),t.classList.remove("is-dismissing"),this.showToast("Failed to dismiss notification","error")}}}async clearAllNotifications(){const e=document.getElementById("notifications-list"),t=e.querySelectorAll(".c-navbar-modern__notification");if(0!==t.length){if(confirm("Are you sure you want to clear all notifications?")){t.forEach(e=>e.classList.add("is-dismissing"));try{const n=await fetch("/api/notifications/clear-all",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}}),a=await n.json();a.success?setTimeout(()=>{t.forEach(e=>e.remove()),this.updateNotificationBadge(0);const n=e.querySelector('[data-state="empty"]');n&&n.classList.remove("u-hidden"),this.showToast(`Cleared ${a.deleted_count} notification${1!==a.deleted_count?"s":""}`,"success")},200):(t.forEach(e=>e.classList.remove("is-dismissing")),this.showToast("Failed to clear notifications","error"))}catch(n){console.error("Clear all notifications error:",n),t.forEach(e=>e.classList.remove("is-dismissing")),this.showToast("Failed to clear notifications","error")}}}else this.showToast("No notifications to clear","info")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async refreshNotificationCount(){try{const e=await fetch("/api/notifications/count"),t=await e.json();t.success&&this.updateNotificationBadge(t.count)}catch(e){console.error("Error refreshing notification count:",e)}}updateNotificationBadge(e){document.querySelectorAll('[data-badge="notification-count"]').forEach(t=>{e>0?(t.textContent=e>99?"99+":e,t.classList.remove("u-hidden")):t.classList.add("u-hidden")})}initRoleImpersonation(){if(!document.querySelector('[data-dropdown="impersonation"]'))return;this.loadImpersonationStatus();const e=document.querySelector('[data-action="refresh-roles"]');e&&e.addEventListener("click",()=>this.loadAvailableRoles()),document.querySelectorAll('input[name="impersonate_roles"]').forEach(e=>{e.addEventListener("change",()=>this.validateRoleSelection())});const t=document.querySelector('[data-action="clear-role-selection"]');t&&t.addEventListener("click",e=>{e.preventDefault(),this.clearRoleSelection()}),this.validateRoleSelection()}clearRoleSelection(){document.querySelectorAll('input[name="impersonate_roles"]').forEach(e=>{e.checked=!1}),this.validateRoleSelection()}async loadImpersonationStatus(){try{const e=await fetch("/api/role-impersonation/status");if(!e.ok)throw new Error("Failed to load status");const t=await e.json();this.updateImpersonationStatus(t)}catch(e){console.error("Error loading impersonation status:",e)}}async loadAvailableRoles(){const e=document.querySelector('[data-action="refresh-roles"]');if(e){e.classList.add("is-loading");const t=e.querySelector("i");t&&(t.style.animation="spin 1s linear infinite")}try{const e=await fetch("/api/role-impersonation/available-roles");if(!e.ok)throw new Error("Failed to load roles");const t=await e.json();this.showToast("Roles refreshed","success"),this.updateImpersonationStatus(t.current_impersonation)}catch(t){console.error("Error loading available roles:",t),this.showToast("Failed to refresh roles","error")}finally{if(e){e.classList.remove("is-loading");const t=e.querySelector("i");t&&(t.style.animation="")}}}updateImpersonationStatus(e){const t=e&&e.active||!1,n=document.getElementById("currentRoleStatus"),a=document.getElementById("activeImpersonationStatus"),o=document.getElementById("activeRolesList"),s=document.querySelector('[data-badge="impersonation"]');t&&e.roles&&e.roles.length>0?(n&&n.classList.add("u-hidden"),a&&(a.classList.remove("u-hidden"),o&&(o.innerHTML=e.roles.map(e=>`<span class="c-role-status__role-tag">${e}</span>`).join(""))),s&&s.classList.remove("u-hidden")):(n&&n.classList.remove("u-hidden"),a&&a.classList.add("u-hidden"),s&&s.classList.add("u-hidden"))}validateRoleSelection(){const e=document.querySelectorAll('input[name="impersonate_roles"]:checked'),t=document.getElementById("startImpersonationBtn"),n=document.getElementById("selectedRoleCount"),a=e.length;n&&(n.textContent=a),t&&(t.disabled=0===a)}initTheme(){const e=localStorage.getItem("theme")||"system";this.applyTheme(e,!1)}applyTheme(e,t=!0){let n=e;"system"===e&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");const a=document.documentElement,o=document.body;a.setAttribute("data-style",n),a.setAttribute("data-bs-theme",n),o.setAttribute("data-bs-theme",n),a.setAttribute("data-theme",n),"dark"===n?(a.classList.add("dark-style"),a.classList.remove("light-style")):(a.classList.add("light-style"),a.classList.remove("dark-style"));const s=document.querySelector('[data-role="theme-icon"]');if(s){const t={light:"ti-sun",dark:"ti-moon-stars",system:"ti-device-desktop"}[e]||"ti-sun";s.className=`ti ${t} c-navbar-modern__nav-icon`}document.querySelectorAll('[data-action="switch-theme"]').forEach(t=>{t.dataset.theme===e?t.classList.add("is-active"):t.classList.remove("is-active")}),t&&(localStorage.setItem("theme",e),localStorage.setItem("templateCustomizer-skin",n))}showToast(e,t="info"){"function"==typeof window.showToast?window.showToast(e,t):console.log(`[Toast ${t}]:`,e)}initPresence(){"undefined"!=typeof io?this.initPresenceSocket():this.checkPresence(),setInterval(()=>this.refreshPresence(),12e4),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&(this.refreshPresence(),this.presenceSocket&&!this.presenceSocket.connected&&this.presenceSocket.connect())})}initPresenceSocket(){if(void 0!==window.SocketManager)return console.log("[Navbar] Using SocketManager for presence"),window.SocketManager.isOptimisticallyConnected()&&(this.updateOnlineStatus(!0),console.debug("[Navbar] Optimistic online status (recently connected)")),this.presenceSocket=window.SocketManager.getSocket(),window.SocketManager.onConnect("Navbar",e=>{this.presenceSocket=e,this.updateOnlineStatus(!0),console.debug("Presence socket connected via SocketManager")}),window.SocketManager.onDisconnect("Navbar",e=>{this.updateOnlineStatus(!1),console.debug("Presence socket disconnected:",e)}),window.SocketManager.on("Navbar","authentication_success",e=>{this.updateOnlineStatus(!0),console.debug("Presence authenticated:",e.username)}),void window.SocketManager.on("Navbar","authentication_failed",()=>{this.updateOnlineStatus(!0)});if(window.socket)return console.log("[Navbar] Reusing existing socket (connected:",window.socket.connected,")"),this.presenceSocket=window.socket,window.socket.connected&&this.updateOnlineStatus(!0),void this.attachSocketListenersDirect(this.presenceSocket);try{console.log("[Navbar] Creating new socket connection (fallback)"),this.presenceSocket=io("/",{transports:["polling","websocket"],upgrade:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4,autoConnect:!0,withCredentials:!0}),window.socket=this.presenceSocket,this.attachSocketListenersDirect(this.presenceSocket)}catch(e){console.warn("Failed to initialize presence socket:",e),this.checkPresence()}}attachSocketListenersDirect(e){e.on("connect",()=>{this.updateOnlineStatus(!0),console.debug("Presence socket connected")}),e.on("disconnect",()=>{this.updateOnlineStatus(!1),console.debug("Presence socket disconnected")}),e.on("authentication_success",e=>{this.updateOnlineStatus(!0),console.debug("Presence authenticated:",e.username)}),e.on("authentication_failed",()=>{this.updateOnlineStatus(!0)}),e.on("connect_error",e=>{console.warn("Presence socket connection error:",e.message),this.updateOnlineStatus(!1)})}async checkPresence(){try{const e=await fetch("/api/notifications/presence"),t=await e.json();t.success&&this.updateOnlineStatus(t.online)}catch(e){}}async refreshPresence(){try{await fetch("/api/notifications/presence/refresh",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}})}catch(e){}}updateOnlineStatus(e){const t=this.navbar.querySelector(".c-navbar-modern__avatar-status");t&&(e?(t.classList.add("is-online"),t.classList.remove("is-offline"),t.setAttribute("aria-label","Online"),t.setAttribute("title","You are online")):(t.classList.remove("is-online"),t.classList.add("is-offline"),t.setAttribute("aria-label","Offline"),t.setAttribute("title","You appear offline")))}}function p(){document.querySelector(".c-navbar-modern")&&(window.navbarController=new m)}void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("navbar-modern",p,{priority:80,description:"Modern navbar controller (search, dropdowns, mobile menu)",reinitializable:!1}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):p(),void 0!==t&&t.exports&&(t.exports=m);class h{constructor(){this.themes=["light","dark","system"],this.variants=["modern"],this.currentTheme="light",this.currentVariant="modern",this.init()}init(){this.setupEventListeners(),this.setupSystemThemeDetection(),this.loadSavedVariant()}loadSavedVariant(){const e=localStorage.getItem("theme-variant")||"modern";this.currentVariant=this.variants.includes(e)?e:"modern"}loadSavedTheme(){const e=localStorage.getItem("template-style")||"light";this.setTheme(e,!1)}setTheme(e,t=!0){this.themes.includes(e)||(console.warn(`Invalid theme: ${e}. Using light instead.`),e="light"),console.log("Setting theme to:",e),this.currentTheme=e;const n=this.resolveSystemTheme(e);console.log("Effective theme:",n),document.documentElement.setAttribute("data-style",n),document.documentElement.setAttribute("data-theme",n),document.documentElement.className=document.documentElement.className.replace(/\b(light|dark)-style\b/g,""),document.documentElement.classList.add(`${n}-style`),this.updateThemeIcon(e),this.updateActiveMenuItem(e),t&&(localStorage.setItem("template-style",e),this.saveThemeToServer(e)),document.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:e,effectiveTheme:n}})),console.log("Theme applied successfully")}resolveSystemTheme(e){return"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e}setupEventListeners(){"undefined"!=typeof EventDelegation&&(EventDelegation.register("set-theme",(e,t)=>{const n=e.getAttribute("data-theme");n&&(console.log("Theme switching to (action):",n),this.setTheme(n),document.querySelectorAll('[data-action="set-theme"]').forEach(e=>{e.classList.remove("btn-primary"),e.classList.add("btn-outline-secondary")}),e.classList.remove("btn-outline-secondary"),e.classList.add("btn-primary"))},{preventDefault:!0}),EventDelegation.register("select-theme",(e,t)=>{const n=e.getAttribute("data-theme");if(n&&(console.log("Theme switching to:",n),this.setTheme(n),e.closest('[data-role="theme-dropdown-menu"]'))){const e=document.querySelector('[data-role="theme-dropdown-toggle"]');if(e&&window.bootstrap){const t=window.bootstrap.Dropdown.getInstance(e);t&&t.hide()}}},{preventDefault:!0})),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&"T"===e.key&&(e.preventDefault(),this.cycleTheme())})}setupSystemThemeDetection(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{"system"===this.currentTheme&&this.setTheme("system",!1)})}cycleTheme(){const e=(this.themes.indexOf(this.currentTheme)+1)%this.themes.length;this.setTheme(this.themes[e])}updateThemeIcon(e){const t=document.querySelector('[data-role="theme-icon"]');if(t){let n;switch(e){case"dark":n="ti-moon-stars";break;case"system":n="ti-device-desktop-analytics";break;default:n="ti-sun"}t.className=`ti ${n} ti-md`,t.setAttribute("data-role","theme-icon")}}updateActiveMenuItem(e){document.querySelectorAll("[data-theme]").forEach(e=>{e.classList.remove("active")});const t=document.querySelector(`[data-theme="${e}"]`);t&&t.classList.add("active")}saveThemeToServer(e){const t=document.querySelector('meta[name="csrf-token"]');t?fetch("/set-theme",{method:"POST",headers:{"Content-Type":"application/json","X-Csrftoken":t.getAttribute("content")},body:JSON.stringify({theme:e})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{e.success||console.error("Theme save failed:",e.message)}).catch(e=>{console.error("Failed to save theme to server:",e)}):console.warn("CSRF token not found, theme not saved to server")}getCurrentTheme(){return this.currentTheme}getEffectiveTheme(){return this.resolveSystemTheme(this.currentTheme)}setVariant(e,t=!0){this.variants.includes(e)||(console.warn(`Invalid variant: ${e}. Using modern instead.`),e="modern"),console.log("Setting variant to:",e),this.currentVariant=e,document.documentElement.setAttribute("data-theme-variant",e),document.documentElement.classList.remove("theme-modern"),document.documentElement.classList.add(`theme-${e}`),t&&(localStorage.setItem("theme-variant",e),this.saveVariantToServer(e)),document.dispatchEvent(new CustomEvent("variantChanged",{detail:{variant:e}})),t&&this.notifyAndReload(e),console.log("Variant applied successfully")}notifyAndReload(e){"undefined"!=typeof Swal?Swal.fire({title:"Applying Theme",text:`Switching to ${e} theme...`,icon:"info",timer:1500,timerProgressBar:!0,showConfirmButton:!1,allowOutsideClick:!1}).then(()=>{window.location.reload()}):window.location.reload()}saveVariantToServer(e){const t=document.querySelector('meta[name="csrf-token"]');t?fetch("/set-theme-variant",{method:"POST",headers:{"Content-Type":"application/json","X-Csrftoken":t.getAttribute("content")},body:JSON.stringify({variant:e})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{e.success||console.error("Variant save failed:",e.message)}).catch(e=>{console.error("Failed to save variant to server:",e)}):console.warn("CSRF token not found, variant not saved to server")}getCurrentVariant(){return this.currentVariant}isModern(){return"modern"===this.currentVariant}toggleVariant(){this.setVariant("modern")}}document.addEventListener("DOMContentLoaded",()=>{window.themeSwitcher=new h,window._themeNeedsSync&&(window.themeSwitcher.currentTheme=window._themeNeedsSync.theme,window.themeSwitcher.saveThemeToServer(window._themeNeedsSync.theme),window.themeSwitcher.updateThemeIcon(window._themeNeedsSync.theme),window.themeSwitcher.updateActiveMenuItem(window._themeNeedsSync.theme),delete window._themeNeedsSync),window._variantNeedsSync&&(window.themeSwitcher.currentVariant=window._variantNeedsSync.variant,window.themeSwitcher.saveVariantToServer(window._variantNeedsSync.variant),delete window._variantNeedsSync);const e=document.documentElement.getAttribute("data-style")||"light",t=document.documentElement.getAttribute("data-theme-variant")||"modern";window.themeSwitcher.currentTheme=e,window.themeSwitcher.currentVariant=t,window.themeSwitcher.updateThemeIcon(e),window.themeSwitcher.updateActiveMenuItem(e)}),window.SimpleThemeSwitcher=h,function(){class e{constructor(e){this.nav=e,this.activeDropdown=null,this.init()}init(){this.nav.addEventListener("keydown",this.handleKeyboard.bind(this)),document.addEventListener("click",this.handleOutsideClick.bind(this)),document.addEventListener("keydown",this.handleEscapeKey.bind(this)),this.registerActions()}registerActions(){"undefined"!=typeof EventDelegation&&(EventDelegation.register("toggle-dropdown",this.handleToggleDropdown.bind(this),{preventDefault:!0}),EventDelegation.register("navigate",this.handleNavigation.bind(this),{preventDefault:!1}),EventDelegation.register("close-dropdown",this.handleCloseDropdown.bind(this),{preventDefault:!0}))}handleToggleDropdown(e,t){this.toggleDropdown(e)}handleCloseDropdown(e,t){this.closeDropdown(e)}handleKeyboard(e){const t=e.target;"Enter"!==e.key&&" "!==e.key||"toggle-dropdown"!==t.dataset.action||(e.preventDefault(),this.toggleDropdown(t)),!this.activeDropdown||"ArrowDown"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),this.navigateDropdown(e.key))}handleEscapeKey(e){if("Escape"===e.key&&this.activeDropdown){this.closeAllDropdowns();const e=this.activeDropdown.previousElementSibling;e&&e.focus()}}handleOutsideClick(e){!this.nav.contains(e.target)&&this.activeDropdown&&this.closeAllDropdowns()}toggleDropdown(e){const t=e.closest("[data-dropdown]");if(!t)return;const n=t.querySelector(".c-admin-nav__dropdown");if(!n)return;const a=t.classList.contains("is-open");if(this.closeAllDropdowns(),a)this.closeDropdown(t);else{t.classList.add("is-open"),e.classList.add("is-open"),e.setAttribute("aria-expanded","true"),n.setAttribute("aria-hidden","false"),this.activeDropdown=n;const a=n.querySelector(".c-admin-nav__dropdown-item");a&&a.focus()}}closeDropdown(e){const t=e.closest("[data-dropdown]");if(!t)return;const n=t.querySelector('[data-action="toggle-dropdown"]'),a=t.querySelector(".c-admin-nav__dropdown");t.classList.remove("is-open"),n&&(n.classList.remove("is-open"),n.setAttribute("aria-expanded","false")),a&&a.setAttribute("aria-hidden","true"),this.activeDropdown===a&&(this.activeDropdown=null)}closeAllDropdowns(){this.nav.querySelectorAll("[data-dropdown].is-open").forEach(e=>this.closeDropdown(e))}navigateDropdown(e){if(!this.activeDropdown)return;const t=Array.from(this.activeDropdown.querySelectorAll(".c-admin-nav__dropdown-item:not(.is-disabled)")),n=t.indexOf(document.activeElement);let a;a="ArrowDown"===e?n<t.length-1?n+1:0:n>0?n-1:t.length-1,t[a].focus()}handleNavigation(e,t){e&&e.classList&&(this.nav.querySelectorAll(".c-admin-nav__link").forEach(e=>e.classList.remove("is-active")),e.classList.add("is-active"))}destroy(){this.nav.removeEventListener("keydown",this.handleKeyboard),document.removeEventListener("click",this.handleOutsideClick),document.removeEventListener("keydown",this.handleEscapeKey)}}function t(){if(!(document.querySelector('[data-controller="admin-nav"]')||document.querySelector(".c-admin-nav")||window.location.pathname.includes("/admin")))return;const t=document.querySelectorAll('[data-controller="admin-nav"]');if(0===t.length){const t=document.querySelector(".c-admin-nav");return void(t&&!t.hasAttribute("data-controller")&&(t.setAttribute("data-controller","admin-nav"),t.adminNavController=new e(t)))}t.forEach(t=>{t.adminNavController||(t.adminNavController=new e(t))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),window.AdminNavigationController=e,window.initAdminNavigation=t}(),function(){const e={activeModals:new Set,init(){"undefined"!=typeof EventDelegation&&(EventDelegation.register("modal-trigger",(e,t)=>{const n=e.dataset.modalTrigger;n&&this.open(n)},{preventDefault:!0}),EventDelegation.register("close-modal",(e,t)=>{const n=e.closest(".c-modal-modern");n&&this.close(n.id)},{preventDefault:!0})),document.addEventListener("click",e=>{const t=(n=e.target)instanceof Element?n:null;var n;if(t&&t.classList.contains("c-modal-modern__backdrop")){const e=Array.from(this.activeModals).pop();e&&this.close(e)}}),document.addEventListener("keydown",e=>{if("Escape"===e.key&&this.activeModals.size>0){const e=Array.from(this.activeModals).pop();this.close(e)}})},open(e){const t=document.getElementById(e),n=document.querySelector(`[data-modal-backdrop="${e}"]`);t&&(this.activeModals.add(e),n&&n.classList.add("is-open"),t.classList.add("is-open"),t.setAttribute("aria-hidden","false"),this.trapFocus(t),t.dispatchEvent(new CustomEvent("modal:opened",{detail:{id:e}})))},close(e){const t=document.getElementById(e),n=document.querySelector(`[data-modal-backdrop="${e}"]`);t&&(t.classList.add("is-closing"),setTimeout(()=>{t.classList.remove("is-open","is-closing"),t.setAttribute("aria-hidden","true"),n&&n.classList.remove("is-open"),this.activeModals.delete(e),t.dispatchEvent(new CustomEvent("modal:closed",{detail:{id:e}}))},300))},trapFocus(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),n=t[0],a=t[t.length-1];e.addEventListener("keydown",e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===n&&(a.focus(),e.preventDefault()):document.activeElement===a&&(n.focus(),e.preventDefault()))}),null==n||n.focus()}},t={container:null,toasts:new Map,idCounter:0,init(){this.container||(this.container=document.createElement("div"),this.container.className="c-toast-modern__container",document.body.appendChild(this.container)),"undefined"!=typeof EventDelegation&&EventDelegation.register("dismiss-toast",(e,t)=>{const n=e.dataset.toastId;n&&this.dismiss(n)})},show(e={}){const{type:t="info",title:n,message:a,duration:o=5e3,dismissible:s=!0,actions:i=[]}=e,r="toast-"+ ++this.idCounter,c=document.createElement("div");c.className=`c-toast-modern c-toast-modern--${t}`,c.id=r,c.setAttribute("role","alert"),c.setAttribute("aria-live","polite");const l={success:"âœ“",error:"Ã—",warning:"âš ",info:"â„¹"};return c.innerHTML=`\n        <div class="c-toast-modern__icon">${l[t]||l.info}</div>\n        <div class="c-toast-modern__content">\n          ${n?`<h4 class="c-toast-modern__title">${n}</h4>`:""}\n          ${a?`<p class="c-toast-modern__message">${a}</p>`:""}\n          ${i.length>0?`\n            <div class="c-toast-modern__actions">\n              ${i.map(e=>`\n                <button class="c-toast-modern__action" data-action="toast-action" data-callback="${e.callback}">\n                  ${e.label}\n                </button>\n              `).join("")}\n            </div>\n          `:""}\n        </div>\n        ${s?`\n          <button class="c-toast-modern__dismiss" data-action="dismiss-toast" data-toast-id="${r}" aria-label="Close">Ã—</button>\n        `:""}\n        ${o>0?`\n          <div class="c-toast-modern__progress">\n            <div class="c-toast-modern__progress-bar" data-duration="${o}"></div>\n          </div>\n        `:""}\n      `,this.container.appendChild(c),requestAnimationFrame(()=>{c.classList.add("is-visible")}),o>0&&setTimeout(()=>{this.dismiss(r)},o),this.toasts.set(r,c),r},dismiss(e){const t=this.toasts.get(e);t&&(t.classList.add("is-dismissing"),t.classList.remove("is-visible"),setTimeout(()=>{t.remove(),this.toasts.delete(e)},300))}},n={activeTooltip:null,tooltips:new Map,init(){const e=e=>e instanceof Element?e:null;document.addEventListener("mouseenter",t=>{const n=e(t.target);if(!n)return;const a=n.closest("[data-tooltip]");a&&this.show(a)},!0),document.addEventListener("mouseleave",t=>{const n=e(t.target);n&&n.closest("[data-tooltip]")&&this.hide()},!0),document.addEventListener("focus",t=>{const n=e(t.target);if(!n)return;const a=n.closest("[data-tooltip]");a&&this.show(a)},!0),document.addEventListener("blur",t=>{const n=e(t.target);n&&n.closest("[data-tooltip]")&&this.hide()},!0)},show(e){const t=e.dataset.tooltip,n=e.dataset.tooltipPosition||"top",a=e.dataset.tooltipVariant||"";if(!t)return;const o=document.createElement("div");o.className=`c-tooltip-modern c-tooltip-modern--${n} ${a?`c-tooltip-modern--${a}`:""}`,o.setAttribute("role","tooltip"),o.innerHTML=`\n        ${t}\n        <div class="c-tooltip-modern__arrow"></div>\n      `,e.appendChild(o),requestAnimationFrame(()=>{o.classList.add("is-visible")}),this.activeTooltip=o},hide(){this.activeTooltip&&(this.activeTooltip.classList.remove("is-visible"),setTimeout(()=>{var e;null==(e=this.activeTooltip)||e.remove(),this.activeTooltip=null},200))}},a={activeDropdown:null,init(){"undefined"!=typeof EventDelegation?EventDelegation.register("dropdown-trigger",(e,t)=>{const n=e.dataset.dropdownTrigger;n&&this.toggle(n)},{preventDefault:!0}):document.addEventListener("click",e=>{if(!(e.target instanceof Element))return;const t=e.target.closest("[data-dropdown-trigger]");if(t){e.preventDefault();const n=t.dataset.dropdownTrigger;this.toggle(n)}}),document.addEventListener("click",e=>{!e.target.closest(".c-dropdown-modern")&&this.activeDropdown&&this.close(this.activeDropdown)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.activeDropdown&&this.close(this.activeDropdown)})},toggle(e){const t=document.getElementById(e);t&&(t.classList.contains("is-open")?this.close(e):(this.activeDropdown&&this.close(this.activeDropdown),this.open(e)))},open(e){const t=document.getElementById(e);t&&(t.classList.add("is-open"),this.activeDropdown=e,t.dispatchEvent(new CustomEvent("dropdown:opened",{detail:{id:e}})))},close(e){const t=document.getElementById(e);t&&(t.classList.remove("is-open"),this.activeDropdown===e&&(this.activeDropdown=null),t.dispatchEvent(new CustomEvent("dropdown:closed",{detail:{id:e}})))}},o={init(){const e=e=>e instanceof Element?e:null;document.addEventListener("click",t=>{const n=e(t.target);if(!n)return;const a=n.closest(".c-table-modern__header--sortable");a&&this.sort(a)}),document.addEventListener("click",t=>{var n;const a=e(t.target);if(!a)return;const o=a.closest(".c-table-modern__pagination-button");if(o&&!o.disabled){const e=parseInt(o.dataset.page),t=null==(n=o.closest("[data-table-id]"))?void 0:n.dataset.tableId;t&&this.paginate(t,e)}})},sort(e){const t=e.closest(".c-table-modern"),n=e.dataset.sortColumn,a=e.dataset.sortDirection||"none";let o="asc";"asc"===a&&(o="desc"),"desc"===a&&(o="none"),t.querySelectorAll(".c-table-modern__header--sortable").forEach(e=>{e.classList.remove("c-table-modern__header--sorted-asc","c-table-modern__header--sorted-desc"),e.dataset.sortDirection="none"}),"none"!==o&&(e.classList.add(`c-table-modern__header--sorted-${o}`),e.dataset.sortDirection=o),t.dispatchEvent(new CustomEvent("table:sort",{detail:{column:n,direction:o}}))},paginate(e,t){const n=document.querySelector(`[data-table-id="${e}"]`);n&&n.dispatchEvent(new CustomEvent("table:paginate",{detail:{page:t}}))}},s={init(){const e=e=>e instanceof Element?e:null;document.addEventListener("blur",t=>{const n=e(t.target);if(!n)return;const a=n.closest(".c-form-modern__input");a&&this.validateField(a)},!0),document.addEventListener("submit",t=>{const n=e(t.target);if(!n)return;const a=n.closest("form[data-validate]");a&&(this.validateForm(a)||t.preventDefault())})},validateField(e){const t=e.checkValidity();return t?(e.classList.remove("is-invalid"),e.classList.add("is-valid"),this.clearError(e)):(e.classList.remove("is-valid"),e.classList.add("is-invalid"),this.showError(e,e.validationMessage)),t},validateForm(e){const t=e.querySelectorAll(".c-form-modern__input");let n=!0;return t.forEach(e=>{this.validateField(e)||(n=!1)}),n},showError(e,t){let n=e.parentElement.querySelector(".c-form-modern__feedback--invalid");n||(n=document.createElement("div"),n.className="c-form-modern__feedback c-form-modern__feedback--invalid",e.parentElement.appendChild(n)),n.textContent=t},clearError(e){const t=e.parentElement.querySelector(".c-form-modern__feedback--invalid");t&&t.remove()}};function i(){t.init(),n.init(),a.init(),o.init(),s.init(),console.log("Modern components initialized")}window.ModernComponents={Modal:e,Toast:t,Tooltip:n,Dropdown:a,Table:o,Form:s},void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("components-modern",i,{priority:70,description:"Modern UI components (toast, tooltip, dropdown, table, form)",reinitializable:!0}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()}(),function(){const e={device:{isMobile:!1,isTablet:!1,isDesktop:!1,isIOS:!1,isAndroid:!1,hasTouch:!1,hasMouse:!1},init:function(){this.detectDevice(),this.applyDeviceClasses(),this.fixIOSViewportHeight(),this.setupTouchFeedback(),this.enhanceModals(),this.enhanceFormControls(),this.enhanceTables(),this.enhanceNavigation(),this.improveScrolling(),this.monitorNetworkStatus(),this.attachEventListeners(),this.setupMutationObserver()},detectDevice:function(){this.device.hasTouch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,this.device.hasMouse=matchMedia("(hover: hover) and (pointer: fine)").matches;const e=window.innerWidth;this.device.isMobile=e<768,this.device.isTablet=e>=768&&e<992,this.device.isDesktop=e>=992;const t=navigator.userAgent.toLowerCase();this.device.isIOS=/iphone|ipad|ipod/.test(t),this.device.isAndroid=/android/.test(t)},applyDeviceClasses:function(){const e=document.body;e.classList.remove("mobile-device","tablet-device","desktop-device","ios-device","android-device","touch-device","mouse-device"),this.device.isMobile&&e.classList.add("mobile-device"),this.device.isTablet&&e.classList.add("tablet-device"),this.device.isDesktop&&e.classList.add("desktop-device"),this.device.isIOS&&e.classList.add("ios-device"),this.device.isAndroid&&e.classList.add("android-device"),this.device.hasTouch&&e.classList.add("touch-device"),this.device.hasMouse&&e.classList.add("mouse-device")},fixIOSViewportHeight:function(){const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)};e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(e,100)}),this.device.isIOS&&document.querySelectorAll("input, textarea, select").forEach(e=>{"checkbox"!==e.type&&"radio"!==e.type&&(e.addEventListener("focus",()=>{document.documentElement.classList.add("keyboard-visible")}),e.addEventListener("blur",()=>{document.documentElement.classList.remove("keyboard-visible")}))})},setupTouchFeedback:function(){this.device.hasTouch&&document.querySelectorAll("button, .btn, a.nav-link, .card-header").forEach(e=>{e.addEventListener("touchstart",function(){this.classList.add("touch-active")},{passive:!0}),e.addEventListener("touchend",function(){this.classList.remove("touch-active")},{passive:!0})})},enhanceModals:function(){document.querySelectorAll("[data-modal]").forEach(e=>{const t=e.querySelector("[data-modal-dialog]");this.device.isMobile&&!e.hasAttribute("data-no-bottom-sheet")&&t&&(t.classList.contains("modal-keep-centered")||t.classList.remove("modal-lg","modal-xl","modal-sm")),this.device.isMobile&&"true"===e.getAttribute("data-dismiss-on-swipe")&&this.setupModalSwipeDismiss(e),e.addEventListener("shown.bs.modal",()=>{window.Haptics&&window.Haptics.modalOpen(),this.device.isIOS&&document.body.classList.add("scroll-locked");const n=e.querySelector('input:not([type="hidden"]), button.btn-close, button:not(.close), [tabindex]:not([tabindex="-1"])');if(n&&setTimeout(()=>n.focus(),100),this.device.isIOS){const t=e.querySelector("[data-modal-body]");t&&t.classList.add("modal-body-scrollable")}if(this.device.isMobile){const n=e.querySelector("[data-modal-content]");n&&!t.classList.contains("modal-keep-centered")&&n.classList.add("modal-content-mobile")}this.handleModalKeyboard(e)}),e.addEventListener("hidden.bs.modal",()=>{window.Haptics&&window.Haptics.modalClose(),this.device.isIOS&&document.body.classList.remove("scroll-locked"),document.body.classList.remove("keyboard-open");const t=e.querySelector("[data-modal-body]");t&&t.classList.remove("modal-body-scrollable");const n=e.querySelector("[data-modal-content]");n&&n.classList.remove("modal-content-mobile"),this.cleanupModalBackdrops()}),e.querySelectorAll('.btn-close, [data-bs-dismiss="modal"]').forEach(e=>{e.addEventListener("click",()=>{window.Haptics&&window.Haptics.light()},{passive:!0})})})},setupModalSwipeDismiss:function(e){if(!this.device.isMobile)return;const t=e.querySelector("[data-modal-dialog]"),n=e.querySelector("[data-modal-header]");if(!t||!n)return;let a=0,o=0,s=!1;n.addEventListener("touchstart",e=>{a=e.touches[0].clientY,s=!0,t.classList.add("swiping")},{passive:!0}),n.addEventListener("touchmove",e=>{if(!s)return;o=e.touches[0].clientY;const n=o-a;n>0&&(e.preventDefault(),t.style.setProperty("--swipe-offset",`${n}px`),t.style.transform="translateY(var(--swipe-offset))",t.classList.add("transition-none"))}),n.addEventListener("touchend",n=>{s&&(s=!1,t.classList.remove("swiping"),o-a>100?(window.Haptics&&window.Haptics.light(),t.classList.remove("transition-none"),t.classList.add("swipe-animating","swipe-dismiss"),setTimeout(()=>{const n=bootstrap.Modal.getInstance(e);n&&n.hide(),t.classList.remove("swipe-animating","swipe-dismiss"),t.style.removeProperty("--swipe-offset"),t.style.removeProperty("transform")},300)):(t.classList.remove("transition-none"),t.classList.add("swipe-animating","swipe-reset"),setTimeout(()=>{t.classList.remove("swipe-animating","swipe-reset"),t.style.removeProperty("--swipe-offset"),t.style.removeProperty("transform")},300)),o=0)},{passive:!0})},handleModalKeyboard:function(e){this.device.isMobile&&e.querySelectorAll("input, textarea, select").forEach(t=>{t.addEventListener("focus",()=>{document.body.classList.add("keyboard-open"),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"center"})},300)}),t.addEventListener("blur",()=>{setTimeout(()=>{const t=document.activeElement;e.contains(t)&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName)||document.body.classList.remove("keyboard-open")},100)})})},enhanceFormControls:function(){if((this.device.isMobile||this.device.isTablet)&&document.querySelectorAll("[data-form-control], [data-form-select]").forEach(e=>{e.offsetHeight<44&&e.classList.add("form-control-touch-target"),!this.device.isIOS||"date"!==e.type&&"time"!==e.type&&"datetime-local"!==e.type||e.classList.add("form-control-ios-date")}),void 0!==$.fn&&void 0!==$.fn.select2)try{setTimeout(()=>{$(".select2-container").each(function(){const e=$(this).siblings("select");if(e.length){const t={theme:"bootstrap-5",width:"100%",dropdownParent:$(e).closest(".modal").length?$(e).closest(".modal"):$("body")};t.placeholder=e.data("placeholder")||(e.is("[multiple]")?"Select multiple options":"Select an option"),e.select2(t)}})},300)}catch(e){}},enhanceTables:function(){document.querySelectorAll("[data-table-responsive]").forEach(e=>{if(e.classList.add("table-responsive-touch"),this.device.isMobile&&!e.querySelector(".table-scroll-hint")&&e.scrollWidth>e.clientWidth){const t=document.createElement("div");t.className="table-scroll-hint",t.innerHTML='<small class="text-muted"><i class="ti ti-arrows-horizontal me-1"></i>swipe to see more</small>',e.parentNode.insertBefore(t,e.nextSibling),e.addEventListener("scroll",function(){this.scrollLeft>20&&t.classList.add("hidden")})}})},enhanceNavigation:function(){document.querySelectorAll("[data-tabs], .js-tabs").forEach(e=>{const t=e.querySelectorAll(".nav-link"),n=window.innerWidth<768,a=t.length>1,o=e.scrollWidth>e.clientWidth;if(n&&a&&o){if(e.classList.add("scrollable-tabs"),!e.nextElementSibling||!e.nextElementSibling.classList.contains("tabs-scroll-hint")){const t=document.createElement("div");t.className="tabs-scroll-hint",t.innerHTML='<small class="text-muted"><i class="ti ti-arrows-horizontal me-1"></i>swipe</small>',e.parentNode.insertBefore(t,e.nextSibling)}}else{const t=e.nextElementSibling;t&&t.classList.contains("tabs-scroll-hint")&&t.remove()}});const e=document.querySelector(".layout-menu");e&&(this.device.isMobile||this.device.isTablet)&&e.querySelectorAll(".menu-item").forEach(e=>{if(e.classList.contains("menu-item-has-children")){const t=e.querySelector(".menu-toggle");t&&t.classList.add("menu-toggle-touch")}const t=e.querySelector(".menu-link");t&&t.classList.add("menu-link-touch")})},improveScrolling:function(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.getAttribute("href").length>1&&e.addEventListener("click",function(e){const t=this.getAttribute("href");if("#"===t||!t)return;const n=document.querySelector(t);n&&(e.preventDefault(),n.scrollIntoView({behavior:"smooth",block:"start"}))})})},monitorNetworkStatus:function(){window.addEventListener("online",()=>{this.showNetworkStatus(!0)}),window.addEventListener("offline",()=>{this.showNetworkStatus(!1)})},showNetworkStatus:function(e){const t=document.createElement("div");t.className="network-status-indicator",e?(t.classList.add("online"),t.innerHTML='<i class="ti ti-wifi me-2"></i> Connected'):(t.classList.add("offline"),t.innerHTML='<i class="ti ti-wifi-off me-2"></i> Disconnected'),document.body.appendChild(t),setTimeout(()=>{t.classList.add("visible")},10),setTimeout(()=>{t.classList.remove("visible"),setTimeout(()=>{t.parentNode&&document.body.removeChild(t)},300)},3e3)},attachEventListeners:function(){let e;window.addEventListener("orientationchange",()=>{setTimeout(()=>{this.fixIOSViewportHeight(),this.enhanceNavigation(),document.dispatchEvent(new CustomEvent("app:orientationchange"))},200)}),window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{this.detectDevice(),this.applyDeviceClasses(),this.fixIOSViewportHeight(),this.enhanceNavigation(),this.enhanceTables(),document.dispatchEvent(new CustomEvent("app:resize"))},250)}),document.addEventListener("click",()=>{setTimeout(this.cleanupModalBackdrops.bind(this),300)}),this.device.isIOS&&window.addEventListener("scroll",()=>{document.body.scrollTop=document.body.scrollTop+1,document.body.scrollTop=document.body.scrollTop-1},{passive:!0})},cleanupModalBackdrops:function(){const e=document.querySelectorAll(".modal.show"),t=document.querySelectorAll(".modal-backdrop");0===e.length&&t.length>0&&(t.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),document.body.classList.remove("modal-open"),document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))},setupMutationObserver:function(){new MutationObserver(e=>{let t=!1;e.forEach(e=>{if(e.addedNodes.length)for(let n=0;n<e.addedNodes.length;n++){const a=e.addedNodes[n];if(1===a.nodeType){if(a.hasAttribute&&(a.hasAttribute("data-modal")||a.hasAttribute("data-form-control")||a.hasAttribute("data-form-select")||a.hasAttribute("data-tabs")||a.hasAttribute("data-table-responsive"))){t=!0;break}if(a.querySelector&&(a.querySelector("[data-modal]")||a.querySelector("[data-form-control]")||a.querySelector("[data-form-select]")||a.querySelector("[data-tabs], .js-tabs")||a.querySelector("[data-table-responsive]"))){t=!0;break}}}}),t&&setTimeout(()=>{this.enhanceNewElements()},100)}).observe(document.body,{childList:!0,subtree:!0})},enhanceNewElements:function(){this.setupTouchFeedback(),this.enhanceFormControls(),this.enhanceTables(),this.enhanceNavigation(),this.enhanceModals()}};window.ResponsiveSystem=e,void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("responsive-system",function(){e.init()},{priority:85,description:"Responsive system (mobile detection, touch feedback, form/table/modal enhancements)",reinitializable:!0}):document.addEventListener("DOMContentLoaded",function(){e.init()})}(),function(){function e(){"undefined"!=typeof feather&&(feather.replace(),new MutationObserver(function(e){let t=!1;e.forEach(function(e){e.addedNodes.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&(e.hasAttribute&&e.hasAttribute("data-feather")&&(t=!0),e.querySelector&&e.querySelector("[data-feather]")&&(t=!0))})}),t&&feather.replace()}).observe(document.body,{childList:!0,subtree:!0})),document.querySelectorAll(".c-match-history__date-group").forEach(function(e,t){const n=e.querySelector(".c-match-history__date-header");n&&(t>0&&e.classList.add("is-collapsed"),n.addEventListener("click",function(){e.classList.toggle("is-collapsed")}),n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.addEventListener("keydown",function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.classList.toggle("is-collapsed"))}))}),"undefined"!=typeof EventDelegation?EventDelegation.register("toggle-dropdown",t,{preventDefault:!0}):document.querySelectorAll('[data-action="toggle-dropdown"]').forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();const t=this.getAttribute("data-dropdown"),n=document.querySelector(`[data-dropdown-id="${t}"]`);if(n){document.querySelectorAll(".c-navbar-modern__dropdown.is-open").forEach(function(e){e!==n&&(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"))});const e=n.classList.toggle("is-open");n.setAttribute("aria-hidden",!e),this.setAttribute("aria-expanded",e)}})}),document.addEventListener("click",n)}function t(e,t){t.stopPropagation();const n=e.getAttribute("data-dropdown"),a=document.querySelector(`[data-dropdown-id="${n}"]`);if(a){document.querySelectorAll(".c-navbar-modern__dropdown.is-open").forEach(function(e){e!==a&&(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"))});const t=a.classList.toggle("is-open");a.setAttribute("aria-hidden",!t),e.setAttribute("aria-expanded",t)}}function n(e){e.target.closest(".c-navbar-modern__dropdown")||e.target.closest('[data-action="toggle-dropdown"]')||(document.querySelectorAll(".c-navbar-modern__dropdown.is-open").forEach(function(e){e.classList.remove("is-open"),e.setAttribute("aria-hidden","true")}),document.querySelectorAll('[data-action="toggle-dropdown"]').forEach(function(e){e.setAttribute("aria-expanded","false")}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e(),document.addEventListener("turbo:load",e),document.addEventListener("turbolinks:load",e)}(),function(e){const t={isTouchDevice:function(){return"ontouchstart"in e||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},isHammerLoaded:function(){return"undefined"!=typeof Hammer},setupModalSwipeDismiss:function(){this.isHammerLoaded()&&document.querySelectorAll(".modal.modal-bottom-sheet").forEach(t=>{const n=t.querySelector(".modal-dialog");if(!n)return;const a=new Hammer(n);a.get("swipe").set({direction:Hammer.DIRECTION_DOWN,threshold:50}),a.on("swipedown",n=>{if(n.center.y<100){const n=bootstrap.Modal.getInstance(t);n&&(e.Haptics&&e.Haptics.modalClose(),n.hide())}}),a.get("pan").set({direction:Hammer.DIRECTION_DOWN,threshold:0});let o=0;a.on("panstart",e=>{o=e.center.y,n.classList.add("transition-none")}),a.on("panmove",e=>{if(e.center.y>o&&e.center.y<100){const t=e.center.y-o;t>0&&t<200&&(n.style.transform=`translateY(${t}px)`)}}),a.on("panend",a=>{if(n.classList.remove("transition-none"),n.classList.add("transition-transform"),a.center.y-o>100){const n=bootstrap.Modal.getInstance(t);n&&(e.Haptics&&e.Haptics.modalClose(),n.hide())}else n.classList.add("translate-y-0"),n.style.transform=""})})},setupSidebarSwipe:function(){if(!this.isHammerLoaded())return;const t=document.getElementById("layout-menu");if(!t)return;const n=document.body,a=new Hammer(n);a.on("swiperight",a=>{a.center.x<50&&e.innerWidth<992&&(t.classList.contains("layout-menu-expanded")||(t.classList.add("layout-menu-expanded"),n.classList.add("layout-menu-expanded"),e.Haptics&&e.Haptics.menuOpen()))}),a.on("swipeleft",a=>{t.classList.contains("layout-menu-expanded")&&(t.classList.remove("layout-menu-expanded"),n.classList.remove("layout-menu-expanded"),e.Haptics&&e.Haptics.menuClose())})},setupPullToRefresh:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-pull-refresh="true"], .table-responsive').forEach(t=>{const n=new Hammer(t);n.get("pan").set({direction:Hammer.DIRECTION_DOWN,threshold:10});let a=0,o=!1,s=t.querySelector(".pull-refresh-indicator");s||(s=document.createElement("div"),s.className="pull-refresh-indicator position-absolute left-50 translate-middle-x d-flex align-items-center justify-content-center text-white opacity-0 z-index-1000",s.innerHTML='<i class="ti ti-refresh"></i>',s.style.top="-50px",s.style.width="40px",s.style.height="40px",s.style.background="var(--bs-primary)",s.style.borderRadius="50%",s.style.transition="opacity 0.3s, top 0.3s",t.classList.add("position-relative"),t.insertBefore(s,t.firstChild)),n.on("panstart",n=>{0!==t.scrollTop&&t!==e||(a=n.center.y,o=!0)}),n.on("panmove",e=>{if(!o)return;const t=e.center.y-a;if(t>0&&t<120){s.style.opacity=Math.min(t/80,1),s.style.top=`${-50+t}px`;const e=s.querySelector("i");e&&(e.style.transform=`rotate(${3*t}deg)`)}}),n.on("panend",n=>{if(o){if(n.center.y-a>80){e.Haptics&&e.Haptics.refresh(),s.style.top="10px";const n=s.querySelector("i");n&&n.classList.add("ti-spin");const a=new CustomEvent("mobile:pullrefresh",{detail:{container:t}});t.dispatchEvent(a),setTimeout(()=>{s.classList.add("opacity-0"),s.style.top="-50px",n&&n.classList.remove("ti-spin")},2e3)}else s.classList.add("opacity-0"),s.style.top="-50px";o=!1}})})},setupLongPress:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-long-press="true"], .card, .list-group-item').forEach(t=>{const n=new Hammer(t);n.get("press").set({time:500}),n.on("press",n=>{e.Haptics&&e.Haptics.longPress();const a=new CustomEvent("mobile:longpress",{detail:{element:t,event:n}});t.dispatchEvent(a),t.classList.add("long-press-active"),setTimeout(()=>{t.classList.remove("long-press-active")},200)})})},setupDoubleTap:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-double-tap="zoom"], .player-card img, .avatar-lg').forEach(t=>{const n=new Hammer(t);n.get("tap").set({taps:2,threshold:10,posThreshold:50});let a=!1;n.on("tap",n=>{2===n.tapCount&&(e.Haptics&&e.Haptics.doubleTap(),a?(t.classList.remove("z-index-1000"),t.classList.add("scale-1"),t.style.transform="",a=!1):(t.classList.add("transition-transform","z-index-1000"),t.style.transform="scale(2)",a=!0),setTimeout(()=>{a&&(t.classList.remove("z-index-1000"),t.classList.add("scale-1"),t.style.transform="",a=!1)},3e3))})})},setupSwipeActions:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-swipe-actions="true"]').forEach(t=>{if(t.closest("thead"))return;const n=new Hammer(t);n.get("swipe").set({threshold:50,velocity:.3});let a=!1,o=t.querySelector(".swipe-actions");if(!o){o=document.createElement("div"),o.className="swipe-actions position-absolute right-0 top-0 bottom-0 d-flex align-items-center gap-2 translate-x-100 transition-transform",o.style.padding="0 16px",o.style.background="var(--bs-danger)";const n=document.createElement("button");n.className="btn btn-sm btn-light",n.innerHTML='<i class="ti ti-trash"></i>',n.onclick=()=>{e.Haptics&&e.Haptics.delete();const n=new CustomEvent("mobile:swipedelete",{detail:{row:t}});t.dispatchEvent(n)},o.appendChild(n),t.classList.add("position-relative","overflow-hidden"),t.appendChild(o)}n.on("swipeleft",()=>{a||(o.classList.remove("translate-x-100"),o.classList.add("translate-x-0"),t.style.transform="translateX(-100px)",a=!0,e.Haptics&&e.Haptics.swipe())}),n.on("swiperight",()=>{a&&(o.classList.remove("translate-x-0"),o.classList.add("translate-x-100"),t.classList.add("translate-x-0"),t.style.transform="",a=!1,e.Haptics&&e.Haptics.swipe())}),document.addEventListener("click",e=>{a&&!t.contains(e.target)&&(o.classList.remove("translate-x-0"),o.classList.add("translate-x-100"),t.classList.add("translate-x-0"),t.style.transform="",a=!1)})})},setupPinchZoom:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-pinch-zoom="true"], .chart-container, img.zoomable').forEach(e=>{const t=new Hammer(e);t.get("pinch").set({enable:!0});let n=1;t.on("pinchstart",()=>{e.classList.add("transition-none")}),t.on("pinchmove",t=>{const a=Math.max(1,Math.min(n*t.scale,4));e.style.transform=`scale(${a})`}),t.on("pinchend",t=>{e.classList.remove("transition-none"),e.classList.add("transition-transform"),n=Math.max(1,Math.min(n*t.scale,4)),n>1&&setTimeout(()=>{e.classList.add("scale-1"),e.style.transform="",n=1},3e3)})})},setupSwipeNavigation:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-swipe-nav="true"], .nav-tabs').forEach(t=>{const n=new Hammer(t);n.get("swipe").set({threshold:30});const a=Array.from(t.querySelectorAll(".nav-link"));0!==a.length&&(n.on("swipeleft",()=>{const t=a.find(e=>e.classList.contains("active")),n=a.indexOf(t);n<a.length-1&&(a[n+1].click(),e.Haptics&&e.Haptics.swipe())}),n.on("swiperight",()=>{const t=a.find(e=>e.classList.contains("active")),n=a.indexOf(t);n>0&&(a[n-1].click(),e.Haptics&&e.Haptics.swipe())}))})},init:function(){this.isTouchDevice()?this.isHammerLoaded()?(this.setupModalSwipeDismiss(),this.setupSidebarSwipe(),this.setupPullToRefresh(),this.setupLongPress(),this.setupDoubleTap(),this.setupSwipeActions(),this.setupPinchZoom(),this.setupSwipeNavigation(),this.addGestureStyles(),console.log("MobileGestures: Initialized successfully")):console.warn("MobileGestures: Hammer.js not loaded, gesture support disabled"):console.log("MobileGestures: Not a touch device, skipping initialization")},addGestureStyles:function(){if(document.getElementById("mobile-gesture-styles"))return;const e=document.createElement("style");e.id="mobile-gesture-styles",e.textContent='\n        .long-press-active {\n          animation: long-press-pulse 0.2s ease;\n        }\n\n        @keyframes long-press-pulse {\n          0%, 100% { transform: scale(1); }\n          50% { transform: scale(0.95); }\n        }\n\n        .swipe-actions button {\n          touch-action: manipulation;\n        }\n\n        .pull-refresh-indicator .ti-spin {\n          animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n\n        /* Smooth transitions for swipe actions */\n        [data-swipe-actions="true"],\n        .table-responsive tr {\n          transition: transform 0.3s ease;\n        }\n      ',document.head.appendChild(e)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init(),e.MobileGestures=t}(window),function(e){const t={state:{isVisible:!1,keyboardHeight:0,activeInput:null,originalViewportHeight:e.innerHeight},isMobile:function(){return e.innerWidth<768},isIOS:function(){return/iPhone|iPad|iPod/.test(navigator.userAgent)},isAndroid:function(){return/Android/.test(navigator.userAgent)},detectKeyboard:function(){const t=e.innerHeight,n=this.state.originalViewportHeight-t;n>150?this.state.isVisible||(this.state.isVisible=!0,this.state.keyboardHeight=n,this.onKeyboardShow()):this.state.isVisible&&(this.state.isVisible=!1,this.state.keyboardHeight=0,this.onKeyboardHide())},onKeyboardShow:function(){document.documentElement.classList.add("keyboard-visible"),document.body.classList.add("keyboard-visible");const t=new CustomEvent("mobile:keyboardshow",{detail:{height:this.state.keyboardHeight}});e.dispatchEvent(t),this.adjustModalsForKeyboard(),this.adjustDropdownsForKeyboard(),console.log("Keyboard shown, height:",this.state.keyboardHeight)},onKeyboardHide:function(){document.documentElement.classList.remove("keyboard-visible"),document.body.classList.remove("keyboard-visible");const t=new CustomEvent("mobile:keyboardhide");e.dispatchEvent(t),this.resetModalAdjustments(),console.log("Keyboard hidden")},adjustModalsForKeyboard:function(){document.querySelectorAll("[data-modal].show").forEach(t=>{const n=t.querySelector("[data-modal-dialog]");if(!n)return;const a=e.innerHeight-this.state.keyboardHeight;if(n.offsetHeight>a&&n.classList.add("modal-keyboard-visible"),this.state.activeInput){const t=this.state.activeInput.getBoundingClientRect(),a=e.innerHeight-this.state.keyboardHeight;t.bottom>a&&n.classList.add("modal-keyboard-shift")}})},resetModalAdjustments:function(){document.querySelectorAll("[data-modal].show [data-modal-dialog]").forEach(e=>{e.classList.remove("modal-keyboard-visible","modal-keyboard-shift")})},adjustDropdownsForKeyboard:function(){document.querySelectorAll("[data-dropdown].show, [data-select-dropdown]").forEach(t=>{const n=t.getBoundingClientRect(),a=e.innerHeight-this.state.keyboardHeight;n.bottom>a&&t.classList.add("dropdown-above-keyboard")})},scrollInputIntoView:function(t){this.isMobile()&&setTimeout(()=>{const n=t.getBoundingClientRect(),a=e.innerHeight-this.state.keyboardHeight,o=n.bottom;if(o>a){const e=o-a+20;t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});const n=t.closest("[data-modal-body]");n&&(n.scrollTop+=e)}},300)},optimizeInputType:function(t){const n=t.type,a=t.name||"",o=t.id||"",s=t.placeholder||"";if(("email"===n||a.includes("email")||o.includes("email"))&&(t.type="email",t.autocomplete="email",t.inputMode="email"),(a.includes("phone")||a.includes("tel")||o.includes("phone"))&&(t.type="tel",t.autocomplete="tel",t.inputMode="tel"),("number"===n||a.includes("number")||s.includes("number"))&&(t.inputMode="numeric",t.pattern="[0-9]*"),(a.includes("url")||a.includes("website")||o.includes("url"))&&(t.type="url",t.autocomplete="url",t.inputMode="url"),("search"===n||a.includes("search")||o.includes("search"))&&(t.type="search"),(a.includes("username")||o.includes("username"))&&(t.autocomplete="username"),"password"===n&&(t.autocomplete="current-password"),this.isIOS()){const n=e.getComputedStyle(t).fontSize;parseInt(n)<16&&t.classList.add("ios-no-zoom")}},setupInputHandlers:function(){document.addEventListener("focusin",e=>{const t=e.target;["INPUT","TEXTAREA","SELECT"].includes(t.tagName)&&(this.state.activeInput=t,document.body.classList.add("input-focused"),this.scrollInputIntoView(t),setTimeout(()=>this.detectKeyboard(),100))},!0),document.addEventListener("focusout",e=>{this.state.activeInput=null,document.body.classList.remove("input-focused"),setTimeout(()=>this.detectKeyboard(),100)},!0),document.querySelectorAll("input, textarea").forEach(e=>{this.optimizeInputType(e)})},setupIOSFixes:function(){if(!this.isIOS())return;const t=()=>{const t=.01*e.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`)};t(),e.addEventListener("resize",t),e.addEventListener("focusout",()=>{setTimeout(()=>{e.scrollTo(0,0)},100)}),document.querySelectorAll('input[type="date"], input[type="datetime-local"], input[type="time"]').forEach(e=>{e.classList.add("ios-date-input")}),document.addEventListener("touchmove",e=>{this.state.isVisible&&this.state.activeInput&&(e.target.closest("[data-modal-body], [data-table-responsive], [data-scrollable]")||e.preventDefault())},{passive:!1})},setupAndroidFixes:function(){if(!this.isAndroid())return;let t;if(e.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{this.detectKeyboard()},100)}),this.state.isVisible&&this.state.activeInput){const e=document.querySelector('meta[name="viewport"]');if(e){const t=e.content;e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0",setTimeout(()=>{e.content=t},300)}}},setupFormValidation:function(){document.querySelectorAll("form").forEach(t=>{t.addEventListener("submit",n=>{const a=t.querySelector(":invalid");a&&(n.preventDefault(),a.focus(),this.scrollInputIntoView(a),e.Haptics&&e.Haptics.validationError())}),t.querySelectorAll("input, textarea, select").forEach(t=>{t.addEventListener("invalid",()=>{e.Haptics&&e.Haptics.validationError()}),t.addEventListener("input",()=>{t.validity.valid&&t.classList.contains("is-invalid")&&(t.classList.remove("is-invalid"),t.classList.add("is-valid"))})})})},setupMutationObserver:function(){new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{var t;1===e.nodeType&&(["INPUT","TEXTAREA","SELECT"].includes(e.tagName)&&this.optimizeInputType(e),null==(t=e.querySelectorAll)||t.call(e,"input, textarea, select").forEach(e=>{this.optimizeInputType(e)}))})})}).observe(document.body,{childList:!0,subtree:!0})},addKeyboardStyles:function(){if(document.getElementById("mobile-keyboard-styles"))return;const e=document.createElement("style");e.id="mobile-keyboard-styles",e.textContent="\n        /* Keyboard visible state */\n        body.keyboard-visible {\n          /* Optional: adjust fixed elements */\n        }\n\n        /* Input focused state */\n        body.input-focused .navbar-fixed-bottom,\n        body.input-focused .mobile-bottom-nav {\n          transform: translateY(100%);\n          transition: transform 0.3s ease;\n        }\n\n        /* Ensure inputs are visible above keyboard */\n        [data-form-control]:focus,\n        [data-form-select]:focus,\n        textarea:focus {\n          position: relative;\n          z-index: 10;\n        }\n\n        /* iOS-specific: fix 100vh with keyboard */\n        @supports (-webkit-touch-callout: none) {\n          [data-modal-dialog],\n          [data-full-height] {\n            height: calc(var(--vh, 1vh) * 100);\n          }\n        }\n\n        /* Smooth transitions for keyboard adjustments */\n        [data-modal-dialog] {\n          transition: transform 0.3s ease, max-height 0.3s ease;\n        }\n      ",document.head.appendChild(e)},init:function(){this.isMobile()?(this.setupInputHandlers(),this.setupFormValidation(),this.setupMutationObserver(),this.isIOS()&&this.setupIOSFixes(),this.isAndroid()&&this.setupAndroidFixes(),this.addKeyboardStyles(),e.addEventListener("orientationchange",()=>{setTimeout(()=>{this.state.originalViewportHeight=e.innerHeight,this.detectKeyboard()},200)}),console.log("MobileKeyboard: Initialized successfully")):console.log("MobileKeyboard: Not a mobile device, skipping initialization")}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init(),e.MobileKeyboard=t}(window),function(e){const t={isMobile:function(){return e.innerWidth<768},optimizeModals:function(){document.querySelectorAll("[data-modal]").forEach(e=>{if(this.isMobile()){const t=e.querySelector("[data-modal-dialog]");if(t){t.classList.contains("modal-lg")&&t.classList.add("mobile-optimized-modal");const n=e.querySelector("[data-modal-content]");n&&n.classList.add("mobile-modal-content")}}})},optimizeInputGroups:function(){document.querySelectorAll("[data-input-group]").forEach(e=>{this.isMobile()&&(e.querySelectorAll("select").forEach(e=>{e.classList.add("mobile-input-select")}),e.querySelectorAll('input[type="number"], input[placeholder*="Min"]').forEach(e=>{e.classList.add("mobile-input-number")}),e.querySelectorAll('[data-remove-btn], button[onclick*="remove"]').forEach(e=>{e.classList.add("mobile-remove-btn")}))})},setupSwipeToDelete:function(){e.Hammer&&this.isMobile()&&document.querySelectorAll('[data-input-group][id*="event-"], [data-event-entry]').forEach(t=>{const n=new Hammer(t);n.get("swipe").set({direction:Hammer.DIRECTION_LEFT,threshold:50});let a=t.querySelector(".swipe-delete-indicator");a||(a=document.createElement("div"),a.className="swipe-delete-indicator",a.innerHTML='<i class="ti ti-trash"></i> Swipe to delete',t.classList.add("swipe-container"),t.appendChild(a)),n.on("swipeleft",()=>{a.classList.add("swipe-visible"),t.classList.add("swipe-active"),e.Haptics&&e.Haptics.warning();const n=setTimeout(()=>{a.classList.remove("swipe-visible"),t.classList.remove("swipe-active")},3e3);a.onclick=()=>{clearTimeout(n),e.Haptics&&e.Haptics.delete();const a=t.querySelector('[data-remove-btn], button[onclick*="remove"]');a&&a.click()}}),n.on("swiperight",()=>{a.classList.remove("swipe-visible"),t.classList.remove("swipe-active")})})},optimizeSelect2:function(){this.isMobile()&&e.jQuery&&jQuery.fn.select2&&jQuery("select.select2").each(function(){const e=jQuery(this);e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.select2({width:"100%",dropdownAutoWidth:!0,dropdownCssClass:"mobile-select2-dropdown",containerCssClass:"mobile-select2-container",minimumResultsForSearch:10})})},makeCollapsible:function(){this.isMobile()&&document.querySelectorAll("[data-modal-body] .row, [data-form-section]").forEach(t=>{const n=t.querySelectorAll("[data-input-group]");if(n.length>3){const a=document.createElement("button");a.type="button",a.className="btn btn-link w-100 text-start mobile-collapse-toggle",a.innerHTML=`\n            <span class="fw-bold">${t.dataset.sectionTitle||"Show/Hide Section"}</span>\n            <i class="ti ti-chevron-down float-end"></i>\n          `;const o=document.createElement("div");for(o.className="mobile-collapse-content mobile-collapse-expanded";n.length>0;)o.appendChild(n[0]);t.insertBefore(a,t.firstChild),t.appendChild(o);let s=!1;a.onclick=()=>{s=!s;const t=a.querySelector("i");s?(o.classList.remove("mobile-collapse-expanded"),o.classList.add("mobile-collapse-collapsed"),t.classList.remove("ti-chevron-down"),t.classList.add("ti-chevron-right")):(o.classList.remove("mobile-collapse-collapsed"),o.classList.add("mobile-collapse-expanded"),t.classList.remove("ti-chevron-right"),t.classList.add("ti-chevron-down")),e.Haptics&&e.Haptics.light()}}})},optimizeDataTables:function(){this.isMobile()&&e.jQuery&&jQuery.fn.DataTable&&jQuery("[data-table], .js-data-table").each(function(){const e=jQuery(this);if(jQuery.fn.DataTable.isDataTable(e)){const t=e.DataTable();t.settings()[0].responsive=!0,t.columns([0,-1]).visible(!0),t.page.len(10).draw()}else e.DataTable({responsive:!0,pageLength:10,dom:'<"top"f>rt<"bottom"ip><"clear">',language:{search:"Filter:",lengthMenu:"Show _MENU_",info:"Page _PAGE_ of _PAGES_",infoEmpty:"No entries",infoFiltered:""}})})},addQuickActions:function(){},optimizeTextareas:function(){document.querySelectorAll("textarea").forEach(e=>{if(this.isMobile()){e.classList.add("mobile-textarea"),e.addEventListener("focus",()=>{e.classList.add("mobile-textarea-expanded")});const t=e.getAttribute("maxlength");if(t){let n=e.parentElement.querySelector(".char-counter");n||(n=document.createElement("div"),n.className="char-counter text-muted small",e.parentElement.appendChild(n));const a=()=>{const a=t-e.value.length;n.textContent=`${a} characters remaining`,a<20?n.classList.add("char-counter-warning"):n.classList.remove("char-counter-warning")};e.addEventListener("input",a),a()}}})},convertToFloatingLabels:function(){this.isMobile()&&document.querySelectorAll("[data-form-group]:not(.form-floating)").forEach(e=>{const t=e.querySelector("label"),n=e.querySelector("input, select, textarea");t&&n&&!n.closest("[data-input-group]")&&(e.classList.add("form-floating"),e.appendChild(t))})},setupMobileValidation:function(){document.querySelectorAll("form").forEach(t=>{t.addEventListener("submit",n=>{const a=t.querySelectorAll(":invalid");if(a.length>0){n.preventDefault();const t=a[0];t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus(),t.classList.add("shake-invalid"),setTimeout(()=>t.classList.remove("shake-invalid"),500),e.Haptics&&e.Haptics.validationError(),e.Swal&&Swal.fire({toast:!0,position:"top",icon:"error",title:"Please fill out all required fields",showConfirmButton:!1,timer:3e3})}}),t.querySelectorAll("input, select, textarea").forEach(t=>{t.addEventListener("blur",()=>{t.validity.valid?(t.classList.remove("is-invalid"),t.classList.add("is-valid")):t.value&&(t.classList.remove("is-valid"),t.classList.add("is-invalid"),e.Haptics&&e.Haptics.light())})})})},addMobileFormStyles:function(){if(document.getElementById("mobile-form-styles"))return;const e=document.createElement("style");e.id="mobile-form-styles",e.textContent='\n        /* Mobile modal optimization */\n        @media (max-width: 767.98px) {\n          .mobile-optimized-modal {\n            max-width: 100%;\n            margin: 0;\n          }\n\n          .mobile-optimized-modal [data-modal-content] {\n            border-radius: 16px 16px 0 0;\n          }\n\n          /* Input group stacking */\n          [data-input-group] {\n            flex-wrap: wrap;\n            gap: 8px;\n          }\n\n          [data-input-group] > * {\n            flex: 1 1 auto;\n            min-width: 0;\n          }\n\n          [data-input-group] [data-remove-btn],\n          [data-input-group] button[onclick*="remove"] {\n            flex: 0 0 44px;\n            min-width: 44px !important;\n            min-height: 44px !important;\n            padding: 0;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n          }\n\n          /* Select2 mobile */\n          .mobile-select2-dropdown {\n            font-size: 16px !important;\n          }\n\n          .mobile-select2-container .select2-selection {\n            min-height: 44px;\n            padding: 8px 12px;\n          }\n\n          /* Shake animation for validation */\n          @keyframes shake {\n            0%, 100% { transform: translateX(0); }\n            25% { transform: translateX(-10px); }\n            75% { transform: translateX(10px); }\n          }\n\n          .shake-invalid {\n            animation: shake 0.3s ease-in-out;\n            border-color: var(--bs-danger) !important;\n          }\n\n          /* Mobile form row stacking */\n          [data-modal-body] .row.g-2 {\n            row-gap: 16px !important;\n          }\n\n          [data-modal-body] .col-md-6,\n          [data-modal-body] .col-lg-6 {\n            width: 100%;\n          }\n\n          /* Sticky submit button spacing */\n          [data-modal-footer] {\n            padding-bottom: 0 !important;\n          }\n\n          /* Larger touch targets in modals */\n          [data-modal] .btn {\n            min-height: 48px;\n            font-size: 16px;\n            padding: 12px 24px;\n          }\n\n          [data-modal] .form-control,\n          [data-modal] .form-select {\n            min-height: 44px;\n            font-size: 16px;\n          }\n        }\n\n        /* Swipe delete indicator */\n        .swipe-delete-indicator {\n          font-size: 14px;\n          font-weight: 600;\n          cursor: pointer;\n        }\n\n        /* Entry transition for swipe */\n        [data-input-group],\n        [data-event-entry] {\n          transition: transform 0.3s ease;\n        }\n      ',document.head.appendChild(e)},init:function(){let t;this.addMobileFormStyles(),this.optimizeModals(),this.optimizeInputGroups(),this.optimizeSelect2(),this.optimizeDataTables(),this.optimizeTextareas(),this.setupMobileValidation(),this.isMobile()&&(this.setupSwipeToDelete(),this.addQuickActions()),document.addEventListener("shown.bs.modal",()=>{setTimeout(()=>{this.optimizeInputGroups(),this.setupSwipeToDelete(),this.addQuickActions()},100)}),e.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{this.isMobile()&&this.optimizeInputGroups()},250)}),console.log("MobileForms: Initialized successfully (refactored with CSS classes and stable selectors)")}};e.MobileForms=t,void 0!==e.InitSystem&&e.InitSystem.register?e.InitSystem.register("mobile-forms",function(){t.init()},{priority:60,description:"Mobile form optimizations (input groups, swipe, quick actions)",reinitializable:!0}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init()}(window),function(e){const t={isSupported:function(){return"vibrate"in navigator||"mozVibrate"in navigator||"webkitVibrate"in navigator},_vibrate:function(e){if(!this.isSupported())return!1;if(this.isDisabled())return!1;try{if(navigator.vibrate)return navigator.vibrate(e);if(navigator.mozVibrate)return navigator.mozVibrate(e);if(navigator.webkitVibrate)return navigator.webkitVibrate(e)}catch(t){return console.warn("Haptics error:",t),!1}},isDisabled:function(){return"true"===localStorage.getItem("haptics-disabled")},enable:function(){localStorage.removeItem("haptics-disabled")},disable:function(){localStorage.setItem("haptics-disabled","true")},toggle:function(){return this.isDisabled()?(this.enable(),!0):(this.disable(),!1)},stop:function(){this._vibrate(0)},light:function(){return this._vibrate(10)},medium:function(){return this._vibrate(20)},heavy:function(){return this._vibrate(30)},success:function(){return this._vibrate([10,50,10])},error:function(){return this._vibrate([30,100,30])},warning:function(){return this._vibrate([20,50,20])},notification:function(){return this._vibrate([10,30,10,30,10])},selection:function(){return this._vibrate(15)},deselection:function(){return this._vibrate([8,20,8])},swipe:function(){return this._vibrate(12)},longPress:function(){return this._vibrate(50)},doubleTap:function(){return this._vibrate([15,30,15])},drafted:function(){return this._vibrate([20,50,20,50,30])},invalidSelection:function(){return this._vibrate([40,60,40])},timeWarning:function(){return this._vibrate([25,100,25,100,25])},inputFocus:function(){return this._vibrate(8)},validationError:function(){return this._vibrate([25,50,25])},formSubmit:function(){return this._vibrate(18)},menuOpen:function(){return this._vibrate(15)},menuClose:function(){return this._vibrate(12)},modalOpen:function(){return this._vibrate([10,30,15])},modalClose:function(){return this._vibrate(15)},refresh:function(){return this._vibrate([15,50,15,50,20])},delete:function(){return this._vibrate([35,60,35])},archive:function(){return this._vibrate([12,40,12])},custom:function(e){return this._vibrate(e)},init:function(){this.isSupported()?(document.querySelectorAll('.btn:not([data-haptics="false"])').forEach(e=>{e.addEventListener("click",n=>{e.classList.contains("btn-success")?t.success():e.classList.contains("btn-danger")?t.warning():t.medium()},{passive:!0})}),document.querySelectorAll(".form-control, .form-select").forEach(e=>{e.addEventListener("focus",()=>{t.inputFocus()},{passive:!0}),e.addEventListener("invalid",()=>{t.validationError()})}),document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(e=>{e.addEventListener("change",()=>{e.checked?t.selection():t.deselection()},{passive:!0})}),document.querySelectorAll('.nav-link:not([data-haptics="false"])').forEach(e=>{e.addEventListener("click",()=>{t.light()},{passive:!0})}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("shown.bs.modal",()=>{t.modalOpen()}),e.addEventListener("hidden.bs.modal",()=>{t.modalClose()})}),console.log("Haptics: Initialized successfully")):console.log("Haptics: Vibration API not supported")}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init(),e.Haptics=t}(window),function(){const e={init:function(){this.processAllTables(),this.setupScrollTracking(),this.setupDataTables(),this.setupMutationObserver()},processAllTables:function(){document.querySelectorAll("table.mobile-card-table").forEach(e=>{this.processTable(e)}),document.querySelectorAll("[data-table-responsive] table").forEach(e=>{e.classList.contains("mobile-card-processed")||e.closest("[data-table-horizontal-mobile]")||this.processTable(e)}),document.querySelectorAll("table.table:not(.mobile-card-processed)").forEach(e=>{!e.closest("[data-table-responsive]")&&!e.closest("[data-table-horizontal-mobile]")&&window.innerWidth<992&&this.processTable(e)})},processTable:function(e){if(e.classList.contains("mobile-card-processed"))return;const t=e.querySelectorAll("thead th"),n=Array.from(t).map(e=>e.textContent.trim());e.querySelectorAll("tbody tr").forEach(e=>{e.querySelectorAll("td").forEach((e,t)=>{if(t<n.length&&!e.hasAttribute("data-label")&&e.setAttribute("data-label",n[t]),this.isCellWithOnlyActions(e)&&e.classList.add("table-actions"),this.isCellWithAvatar(e)&&e.classList.add("avatar-cell"),!e.textContent.trim()&&!e.querySelector("*")){const t=document.createElement("span");t.classList.add("empty-cell-placeholder"),t.innerText="â€”",e.appendChild(t)}})}),e.classList.add("mobile-card-processed")},isCellWithOnlyActions:function(e){const t=Array.from(e.children);return 0!==t.length&&t.every(e=>"BUTTON"===e.tagName||"A"===e.tagName&&e.classList.contains("btn")||e.hasAttribute("data-dropdown")||e.hasAttribute("data-btn-group"))},isCellWithAvatar:function(e){return null!==e.querySelector("[data-avatar]")||null!==e.querySelector("img[data-rounded-circle]")||null!==e.querySelector("img[data-avatar]")},setupScrollTracking:function(){document.querySelectorAll("[data-table-responsive-scroll]").forEach(e=>{e.addEventListener("scroll",function(){this.scrollLeft>10?this.classList.add("is-scrolled"):this.classList.remove("is-scrolled")})})},setupDataTables:function(){void 0!==$.fn.dataTable&&($.extend(!0,$.fn.dataTable.defaults,{responsive:!0,drawCallback:function(){this.hasClass("mobile-card-table")&&e.processTable(this[0])}}),$(".dataTable.mobile-card-table").each(function(){e.processTable(this)}))},setupMutationObserver:function(){new MutationObserver(e=>{let t=!1;e.forEach(e=>{if(e.addedNodes&&e.addedNodes.length)for(let n=0;n<e.addedNodes.length;n++){const a=e.addedNodes[n];if(1===a.nodeType){if(a.matches&&a.matches("table.mobile-card-table")){t=!0;break}if(a.querySelectorAll&&a.querySelectorAll("table.mobile-card-table").length){t=!0;break}}}}),t&&this.processAllTables()}).observe(document.body,{childList:!0,subtree:!0})}};window.ResponsiveTables=e,void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("responsive-tables",function(){e.init()},{priority:60,description:"Responsive table system (card view on mobile, data-labels)",reinitializable:!0}):document.addEventListener("DOMContentLoaded",function(){e.init()})}(),function(){const e={init:function(){this.ensureStylesheetLoaded(),this.enhanceButtons(),this.enhanceCards(),this.enhanceForms(),this.enhanceModals(),this.enhanceTables(),this.enhanceNavs(),this.setupResponsive(),this.setupDarkMode(),this.setupCustomBehaviors()},ensureStylesheetLoaded:function(){},enhanceButtons:function(){const e={"btn-primary":"ecs-btn ecs-btn-primary","btn-secondary":"ecs-btn ecs-btn-secondary","btn-success":"ecs-btn ecs-btn-success","btn-info":"ecs-btn ecs-btn-info","btn-warning":"ecs-btn ecs-btn-warning","btn-danger":"ecs-btn ecs-btn-danger","btn-dark":"ecs-btn ecs-btn-dark","btn-outline-primary":"ecs-btn ecs-btn-outline-primary","btn-outline-secondary":"ecs-btn ecs-btn-outline-secondary","btn-sm":"ecs-btn-sm","btn-lg":"ecs-btn-lg"},t=[".c-admin-nav",".c-mobile-nav",".c-modal",".c-btn-modern",".c-form-modern",".c-settings-tabs",".c-messages-inbox",".c-tabs",".c-schedule",".c-schedule-controls","[data-no-enhance]"].join(", ");document.querySelectorAll('button, [type="button"], [type="submit"], [role="button"]').forEach(n=>{if(!n.closest(t)&&!(n.classList.contains("c-tabs__item")||n.classList.contains("c-btn")||n.classList.contains("c-nav__item")||n.classList.contains("c-schedule-controls__btn")||n.classList.contains("ecs-btn"))){n.classList.add("ecs-btn");for(const[t,a]of Object.entries(e))n.classList.contains(t)&&a.split(" ").forEach(e=>{n.classList.contains(e)||n.classList.add(e)});n.querySelector('[data-icon], [class*="icon-"], [class*="ti-"], [class*="feather-"]')&&n.classList.add("ecs-btn-icon")}})},enhanceCards:function(){const e={card:"ecs-card","card-header":"ecs-card-header","card-body":"ecs-card-body","card-footer":"ecs-card-footer","card-title":"ecs-card-title","card-subtitle":"ecs-card-subtitle"},t={"bg-primary":"ecs-card-header-primary","bg-secondary":"ecs-card-header-secondary","bg-success":"ecs-card-header-success","bg-info":"ecs-card-header-info","bg-warning":"ecs-card-header-warning","bg-danger":"ecs-card-header-danger","bg-dark":"ecs-card-header-dark"};document.querySelectorAll('[data-component="card"], [data-role*="card"]').forEach(n=>{if(!n.classList.contains("ecs-card")){n.classList.add("ecs-card"),Object.entries(e).forEach(([e,t])=>{n.querySelectorAll(`[data-card-part="${e.replace("card-","")}"]`).forEach(e=>{e.classList.contains(t)||e.classList.add(t)})});const a=n.querySelector('[data-card-part="header"]');a&&Object.entries(t).forEach(([e,t])=>{a.classList.contains(e)&&!a.classList.contains(t)&&a.classList.add(t)})}})},enhanceForms:function(){Object.entries({"form-control":"ecs-form-control","form-select":"ecs-form-select","form-check":"ecs-form-check","form-check-input":"ecs-form-check-input","form-label":"ecs-form-label","form-text":"ecs-form-text","form-floating":"ecs-form-floating"}).forEach(([e,t])=>{document.querySelectorAll("[data-form-element], [data-input-type]").forEach(e=>{e.classList.contains(t)||e.classList.add(t)})}),document.querySelectorAll('[data-validation-state="valid"], [data-validation-state="invalid"]').forEach(e=>{"valid"===e.getAttribute("data-validation-state")?e.classList.add("ecs-is-valid"):"invalid"===e.getAttribute("data-validation-state")&&e.classList.add("ecs-is-invalid")})},enhanceModals:function(){Object.entries({modal:"ecs-modal","modal-dialog":"ecs-modal-dialog","modal-content":"ecs-modal-content","modal-header":"ecs-modal-header","modal-body":"ecs-modal-body","modal-footer":"ecs-modal-footer","modal-title":"ecs-modal-title","btn-close":"ecs-modal-close","modal-dialog-centered":"ecs-modal-dialog-centered","modal-dialog-scrollable":"ecs-modal-dialog-scrollable","modal-sm":"ecs-modal-sm","modal-lg":"ecs-modal-lg","modal-xl":"ecs-modal-xl"}).forEach(([e,t])=>{document.querySelectorAll(`[data-component="${e}"], [data-modal-part]`).forEach(e=>{e.closest(".c-modal")||e.classList.contains(t)||e.classList.add(t)})}),document.querySelectorAll('[data-component="modal"], [role="dialog"]').forEach(e=>{e.classList.contains("c-modal")||(e.id,e.addEventListener("show.bs.modal",function(){this.querySelectorAll("[data-form-element], [data-input-type]").forEach(e=>{e.classList.contains("form-control")?e.classList.add("ecs-form-control"):e.classList.contains("form-select")&&e.classList.add("ecs-form-select")}),this.querySelectorAll('button, [type="button"], [type="submit"], [role="button"]').forEach(e=>{e.classList.contains("ecs-btn")||e.classList.add("ecs-btn")})}))})},enhanceTables:function(){Object.entries({table:"ecs-table","table-hover":"ecs-table-hover","table-striped":"ecs-table-striped","table-sm":"ecs-table-sm"}).forEach(([e,t])=>{document.querySelectorAll('[data-component="table"], [role="table"]').forEach(e=>{e.classList.contains(t)||e.classList.add(t)})})},enhanceNavs:function(){Object.entries({nav:"ecs-nav","nav-link":"ecs-nav-link","nav-tabs":"ecs-nav-tabs","nav-pills":"ecs-nav-pills",active:"ecs-active"}).forEach(([e,t])=>{document.querySelectorAll('[data-component="nav"], [role="navigation"] > [role="tablist"]').forEach(e=>{e.classList.contains(t)||e.classList.add(t)})}),document.querySelectorAll('[data-component="tab-content"], [role="tabpanel"]').forEach(e=>{e.hasAttribute("data-component")?e.classList.add("ecs-tab-content"):e.hasAttribute("role")&&e.classList.add("ecs-tab-pane")})},setupResponsive:function(){const e=()=>{window.innerWidth<768&&(document.querySelectorAll('button, [type="button"], [type="submit"], [role="button"]').forEach(e=>{e.classList.contains("btn-sm")||e.classList.contains("ecs-btn-sm")||e.classList.add("touch-target")}),document.querySelectorAll('[data-form-element]:not([type="checkbox"]):not([type="radio"]), [data-input-type]:not([type="checkbox"]):not([type="radio"])').forEach(e=>{e.classList.contains("ios-input")||e.classList.add("ios-input")}))};e(),window.addEventListener("resize",e)},setupDarkMode:function(){const e=document.documentElement;new MutationObserver(t=>{t.forEach(t=>{if("attributes"===t.type&&("data-style"===t.attributeName||"data-bs-theme"===t.attributeName)){const t="dark"===e.getAttribute("data-style"),n="dark"===e.getAttribute("data-bs-theme"),a=t||n;this.applyDarkModeToContent(a)}})}).observe(e,{attributes:!0});const t="dark"===e.getAttribute("data-style"),n="dark"===e.getAttribute("data-bs-theme"),a=t||n;this.applyDarkModeToContent(a),document.querySelector(".dark-mode-toggle")||this.addDarkModeToggle()},applyDarkModeToContent:function(e){e?document.body.classList.add("dark-mode-body"):(document.body.classList.remove("dark-mode-body"),document.querySelectorAll(".dark-mode-applied").forEach(e=>{e.classList.remove("dark-mode-applied")}))},addDarkModeToggle:function(){},setupCustomBehaviors:function(){this.addRippleEffect(),this.improveKeyboardNavigation(),this.setupTransitions()},addRippleEffect:function(){document.querySelectorAll('button:not([data-bs-toggle="modal"]), [type="button"]:not([data-bs-toggle="modal"]), [type="submit"]:not([data-bs-toggle="modal"]), [role="button"]:not([data-bs-toggle="modal"])').forEach(e=>{e.addEventListener("click",function(e){if("modal"===this.getAttribute("data-bs-toggle")||this.classList.contains("edit-match-btn")||this.closest('[data-bs-toggle="modal"]'))return;const t=document.createElement("span");t.classList.add("waves-ripple");const n=this.getBoundingClientRect(),a=Math.max(n.width,n.height);t.style.setProperty("--ripple-size",`${a}px`),t.style.setProperty("--ripple-left",e.clientX-n.left-a/2+"px"),t.style.setProperty("--ripple-top",e.clientY-n.top-a/2+"px"),t.classList.add("transform-none"),this.appendChild(t),setTimeout(()=>{t.classList.add("waves-ripple-active")},10),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},600)})})},improveKeyboardNavigation:function(){document.querySelectorAll("a, button, input, select, textarea, [tabindex]").forEach(e=>{e.addEventListener("focus",function(){this.classList.add("ecs-focus")}),e.addEventListener("blur",function(){this.classList.remove("ecs-focus")})})},setupTransitions:function(){document.querySelectorAll('[data-ecs-animate="slide-in"]').forEach(e=>{e.classList.add("opacity-0","translate-y-20px","transition-smooth"),setTimeout(()=>{e.classList.remove("opacity-0","translate-y-20px"),e.classList.add("opacity-100","translate-y-0")},100)})}};window.ECSDesignSystem=e,void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("design-system",function(){e.init()},{priority:90,description:"ECS Design System (theme, colors, focus states)",reinitializable:!1}):document.addEventListener("DOMContentLoaded",function(){e.init()})}(),function(){const e={delete:{icon:"warning",confirmButtonText:"Delete",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Delete"},remove:{icon:"warning",confirmButtonText:"Remove",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Remove"},approve:{icon:"question",confirmButtonText:"Approve",confirmButtonColor:"#28a745",titlePrefix:"Confirm Approval"},reject:{icon:"warning",confirmButtonText:"Reject",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Rejection"},deny:{icon:"warning",confirmButtonText:"Deny",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Denial"},send:{icon:"question",confirmButtonText:"Send",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Send"},sync:{icon:"question",confirmButtonText:"Sync",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Sync"},refresh:{icon:"question",confirmButtonText:"Refresh",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Refresh"},reset:{icon:"warning",confirmButtonText:"Reset",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Reset"},clear:{icon:"warning",confirmButtonText:"Clear",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Clear"},cancel:{icon:"warning",confirmButtonText:"Yes, Cancel",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Cancellation"},disable:{icon:"warning",confirmButtonText:"Disable",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Disable"},enable:{icon:"question",confirmButtonText:"Enable",confirmButtonColor:"#28a745",titlePrefix:"Confirm Enable"},save:{icon:"question",confirmButtonText:"Save",confirmButtonColor:"#28a745",titlePrefix:"Confirm Save"},submit:{icon:"question",confirmButtonText:"Submit",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Submit"},unlink:{icon:"warning",confirmButtonText:"Unlink",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Unlink"},revoke:{icon:"warning",confirmButtonText:"Revoke",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Revoke"},retry:{icon:"question",confirmButtonText:"Retry",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Retry"},resend:{icon:"question",confirmButtonText:"Resend",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Resend"},duplicate:{icon:"question",confirmButtonText:"Duplicate",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Duplicate"},assign:{icon:"question",confirmButtonText:"Assign",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Assignment"},schedule:{icon:"question",confirmButtonText:"Schedule",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Schedule"},fetch:{icon:"question",confirmButtonText:"Fetch",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Fetch"}};function t(t){if(!t)return null;const n=t.toLowerCase();for(const[a,o]of Object.entries(e))if(n.includes(a))return a;return null}const n={confirm:function(n){if("undefined"==typeof Swal)return console.error("SweetAlert2 not loaded"),Promise.resolve({isConfirmed:confirm(n.text||n.title)});const a=function(t,n){const a=n?e[n]:{};return{icon:"question",showCancelButton:!0,confirmButtonText:"Confirm",cancelButtonText:"Cancel",confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",reverseButtons:!0,...a,...t,title:t.title||a.titlePrefix||"Confirm Action"}}(n,t(n.title)||t(n.text));return Swal.fire(a)},success:function(e,t){return Swal.fire({icon:"success",title:e,text:t,timer:2e3,showConfirmButton:!1})},error:function(e,t){return Swal.fire({icon:"error",title:e,text:t})},info:function(e,t){return Swal.fire({icon:"info",title:e,text:t})},warning:function(e,t){return Swal.fire({icon:"warning",title:e,text:t})}};Object.keys(e).forEach(e=>{n[e]=function(e,t={}){return this.confirm({text:e,...t})}}),window.SwalContextual=n,console.debug("[SwalContextual] Helper initialized")}(),function(){const e={conversations:"/api/messages",messages:e=>`/api/messages/${e}`,send:e=>`/api/messages/${e}`,unreadCount:"/api/messages/unread-count",searchUsers:"/api/messages/users/search",markRead:e=>`/api/messages/${e}/read`},t={enabled:!0,interval:3e4},n={animationDuration:250,typingDebounce:2e3,searchDebounce:300,maxMessageLength:2e3},a={isOpen:!1,currentView:"list",activeConversation:null,conversations:[],messages:[],unreadCount:0,onlineUsers:[],isTyping:!1,typingTimeout:null,searchQuery:"",searchResults:[],settings:{typingIndicators:!0,readReceipts:!0,maxMessageLength:2e3}};let o={};async function s(e,t={}){try{const n={"Content-Type":"application/json",...t.headers};t.method&&"GET"!==t.method&&(n["X-CSRFToken"]=function(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""}());const a=await fetch(e,{...t,headers:n});if(!a.ok)throw new Error(`HTTP ${a.status}`);return await a.json()}catch(n){throw console.error(`[ChatWidget] API Error: ${e}`,n),n}}async function i(){try{const t=await s(e.conversations);t.success&&(a.conversations=t.conversations||[],function(){if(!o.conversationList)return;if(0===a.conversations.length)return o.conversationList.innerHTML="",void(o.emptyState&&(o.emptyState.style.display="flex"));o.emptyState&&(o.emptyState.style.display="none");const e="/static/img/default_player.png",t=a.conversations.map(t=>{var n;const o=(null==(n=a.activeConversation)?void 0:n.id)===t.user.id,s=t.unread_count>0,i=t.user.is_online,r=t.user.avatar_url||e,l=c(t.user);return`\n        <div class="c-chat-widget__conversation ${o?"c-chat-widget__conversation--active":""} ${s?"c-chat-widget__conversation--unread":""}"\n             data-user-id="${t.user.id}"\n             data-user-name="${Y(t.user.name)}"\n             data-avatar="${r}"\n             data-online="${i}"\n             data-is-coach="${t.user.is_coach||!1}"\n             data-is-admin="${t.user.is_admin||!1}"\n             data-is-global-admin="${t.user.is_global_admin||!1}"\n             data-is-ref="${t.user.is_ref||!1}"\n             role="button"\n             tabindex="0">\n          <div class="c-chat-widget__conv-avatar ${i?"c-chat-widget__conv-avatar--online":""}">\n            <img src="${r}" alt="${Y(t.user.name)}" onerror="this.src='${e}'">\n          </div>\n          <div class="c-chat-widget__conv-content">\n            <div class="c-chat-widget__conv-header">\n              <span class="c-chat-widget__conv-name">${Y(t.user.name)}${l}</span>\n              <span class="c-chat-widget__conv-time">${t.last_message.time_ago}</span>\n            </div>\n            <div class="c-chat-widget__conv-preview">\n              ${t.last_message.sent_by_me?"You: ":""}${Y(t.last_message.content)}\n            </div>\n          </div>\n          ${s?`<div class="c-chat-widget__conv-badge">${t.unread_count}</div>`:""}\n        </div>\n      `}).join("");o.conversationList.innerHTML=t}())}catch(t){console.error("[ChatWidget] Failed to load conversations",t)}}async function r(){try{const t=await s(e.unreadCount);t.success&&(a.unreadCount=t.count,h())}catch(t){console.error("[ChatWidget] Failed to load unread count",t)}}function c(e){if(!e)return"";const t=[];return e.is_global_admin?t.push('<span class="c-chat-widget__role-badge c-chat-widget__role-badge--admin" title="Global Admin"><i class="ti ti-crown"></i></span>'):e.is_admin&&t.push('<span class="c-chat-widget__role-badge c-chat-widget__role-badge--admin" title="Admin"><i class="ti ti-shield-check"></i></span>'),e.is_coach&&t.push('<span class="c-chat-widget__role-badge c-chat-widget__role-badge--coach" title="Coach"><i class="ti ti-speakerphone"></i></span>'),e.is_ref&&t.push('<span class="c-chat-widget__role-badge c-chat-widget__role-badge--ref" title="Referee"><i class="ti ti-cards"></i></span>'),t.length>0?`<span class="c-chat-widget__role-badges">${t.join("")}</span>`:""}function l(){if(!o.messagesContainer)return;if(0===a.messages.length)return void(o.messagesContainer.innerHTML='\n        <div class="c-chat-widget__empty" style="padding: 24px;">\n          <i class="c-chat-widget__empty-icon ti ti-message-2"></i>\n          <div class="c-chat-widget__empty-text">No messages yet. Say hello!</div>\n        </div>\n      ');const e=Q(),t=a.messages.map(t=>{const n=t.sender_id===e;if(t.is_deleted)return`\n          <div class="c-chat-widget__message c-chat-widget__message--${n?"sent":"received"} c-chat-widget__message--deleted"\n               data-message-id="${t.id}">\n            <div class="c-chat-widget__message-bubble c-chat-widget__message-bubble--deleted">\n              <i class="ti ti-message-off" style="margin-right: 6px; opacity: 0.7;"></i>\n              ${n?"You unsent a message":"This message was unsent"}\n            </div>\n            <span class="c-chat-widget__message-time">\n              ${J(t.created_at)}\n            </span>\n          </div>\n        `;const a=function(e){if(!e)return e;let t=e;for(const[n,a]of Object.entries(m)){const e=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");t=t.replace(new RegExp(e,"g"),a)}return t}(Y(t.content));return`\n        <div class="c-chat-widget__message c-chat-widget__message--${n?"sent":"received"}"\n             data-message-id="${t.id}"\n             data-sender-id="${t.sender_id}">\n          <div class="c-chat-widget__message-actions">\n            <button class="c-chat-widget__message-action-btn" data-action="delete-menu" title="Delete message">\n              <i class="ti ti-trash"></i>\n            </button>\n          </div>\n          <div class="c-chat-widget__message-bubble">\n            ${a}\n          </div>\n          <span class="c-chat-widget__message-time">\n            ${J(t.created_at)}\n            ${n&&t.is_read?'<i class="ti ti-checks" style="margin-left: 4px; color: var(--cw-accent);"></i>':""}\n          </span>\n        </div>\n      `}).join("");o.messagesContainer.innerHTML=t}function d(e,t){t.stopPropagation();const n=e.closest(".c-chat-widget__message");n&&function(e,t){if("undefined"!=typeof Swal){const n={title:"Delete message?",icon:"question",showCancelButton:!0,confirmButtonColor:"var(--cw-danger, #ef4444)",cancelButtonColor:"var(--cw-text-secondary, #6b7280)",confirmButtonText:"Delete for me",cancelButtonText:"Cancel",customClass:{popup:"c-chat-widget-swal"}};t&&(n.showDenyButton=!0,n.denyButtonText="Unsend for everyone",n.denyButtonColor="var(--cw-accent, #7c3aed)"),Swal.fire(n).then(t=>{t.isConfirmed?u(e,"me"):t.isDenied&&u(e,"everyone")})}else confirm("Delete this message for yourself?")&&u(e,"me")}(parseInt(n.dataset.messageId),parseInt(n.dataset.senderId)===Q())}async function u(e,t){try{let n,o;"everyone"===t?(n=`/api/messages/message/${e}`,o="DELETE"):(n=`/api/messages/message/${e}/hide`,o="POST");const i=await s(n,{method:o});if(i.success){if("everyone"===t){const t=a.messages.findIndex(t=>t.id===e);-1!==t&&(a.messages[t].is_deleted=!0,a.messages[t].content=null)}else a.messages=a.messages.filter(t=>t.id!==e);l(),S(),Z("everyone"===t?"Message unsent":"Message deleted","success")}else Z(i.error||"Failed to delete message","error")}catch(n){console.error("[ChatWidget] Delete message error:",n),Z("Failed to delete message","error")}}const m={":)":"ðŸ˜Š",":-)":"ðŸ˜Š","=)":"ðŸ˜Š",":(":"ðŸ˜ž",":-(":"ðŸ˜ž","=(":"ðŸ˜ž",":D":"ðŸ˜ƒ",":-D":"ðŸ˜ƒ","=D":"ðŸ˜ƒ",";)":"ðŸ˜‰",";-)":"ðŸ˜‰",":P":"ðŸ˜›",":-P":"ðŸ˜›",":p":"ðŸ˜›",":O":"ðŸ˜®",":-O":"ðŸ˜®",":o":"ðŸ˜®","<3":"â¤ï¸","</3":"ðŸ’”",":*":"ðŸ˜˜",":-*":"ðŸ˜˜",":'(":"ðŸ˜¢",":')":"ðŸ˜‚",":fire:":"ðŸ”¥",":heart:":"â¤ï¸",":thumbsup:":"ðŸ‘",":thumbsdown:":"ðŸ‘Ž",":clap:":"ðŸ‘",":wave:":"ðŸ‘‹",":ok:":"ðŸ‘Œ",":100:":"ðŸ’¯",":star:":"â­",":sun:":"â˜€ï¸",":moon:":"ðŸŒ™",":soccer:":"âš½",":trophy:":"ðŸ†",":medal:":"ðŸ…",":crown:":"ðŸ‘‘",":check:":"âœ…",":x:":"âŒ",":warning:":"âš ï¸",":party:":"ðŸŽ‰",":confetti:":"ðŸŽŠ",xD:"ðŸ˜†",XD:"ðŸ˜†","B)":"ðŸ˜Ž","B-)":"ðŸ˜Ž","-_-":"ðŸ˜‘",":|":"ðŸ˜",":angry:":"ðŸ˜ ",">:(":"ðŸ˜ ",":thinking:":"ðŸ¤”",":shrug:":"ðŸ¤·",":pray:":"ðŸ™",":muscle:":"ðŸ’ª",":eyes:":"ðŸ‘€",":sweat:":"ðŸ˜…",":cool:":"ðŸ˜Ž",":lol:":"ðŸ˜‚",":rofl:":"ðŸ¤£"};function p(){if(!o.searchResults)return void console.warn("[ChatWidget] Search results element not found");if(0===a.searchResults.length)return console.log("[ChatWidget] No search results, hiding dropdown"),o.searchResults.classList.remove("is-visible"),void(o.searchResults.innerHTML="");console.log("[ChatWidget] Rendering",a.searchResults.length,"search results");const e="/static/img/default_player.png",t=a.searchResults.map(t=>{const n=t.avatar_url||e,a=c(t);return`\n        <div class="c-chat-widget__search-result"\n             data-user-id="${t.id}"\n             data-user-name="${Y(t.name)}"\n             data-avatar="${n}"\n             data-online="${t.is_online||!1}"\n             data-is-coach="${t.is_coach||!1}"\n             data-is-admin="${t.is_admin||!1}"\n             data-is-global-admin="${t.is_global_admin||!1}"\n             data-is-ref="${t.is_ref||!1}"\n             role="button"\n             tabindex="0">\n          <div class="c-chat-widget__search-result-avatar">\n            <img src="${n}" alt="${Y(t.name)}" onerror="this.src='${e}'">\n          </div>\n          <span class="c-chat-widget__search-result-name">${Y(t.name)}${a}</span>\n        </div>\n      `}).join("");o.searchResults.innerHTML=t,o.searchResults.classList.add("is-visible"),console.log("[ChatWidget] Search results dropdown visible")}function h(){if(!o.badge)return;a.unreadCount>0?(o.badge.textContent=a.unreadCount>99?"99+":a.unreadCount,o.badge.dataset.count=a.unreadCount,o.badge.style.display=""):(o.badge.style.display="none",o.badge.dataset.count="0");const e=document.querySelector('[data-badge="messages-count"]');e&&(e.textContent=a.unreadCount>99?"99+":a.unreadCount,e.classList.toggle("u-hidden",0===a.unreadCount))}function g(){if(!o.sendBtn||!o.composerInput)return;const e=o.composerInput.value.trim().length>0;o.sendBtn.disabled=!e}function f(){if(o.widget){if(a.isOpen=!0,o.widget.dataset.state="open",window.innerWidth<=767){const e=window.scrollY||window.pageYOffset||document.documentElement.scrollTop;document.body.dataset.chatScrollY=e,document.documentElement.classList.add("chat-widget-open"),document.body.classList.add("chat-widget-open"),document.body.style.top=`-${e}px`}i(),r(),O(),window.innerWidth>575&&o.searchInput&&setTimeout(()=>o.searchInput.focus(),n.animationDuration)}}function v(){if(o.widget){if(a.isOpen=!1,a.currentView="list",a.activeConversation=null,a.messages=[],o.widget.dataset.state="closed",o.widget.dataset.view="list",document.documentElement.classList.remove("chat-widget-open"),document.body.classList.remove("chat-widget-open"),document.body.style.top="",void 0!==document.body.dataset.chatScrollY){const e=parseInt(document.body.dataset.chatScrollY||"0",10);delete document.body.dataset.chatScrollY,window.scrollTo(0,e)}C()}}function y(){a.isOpen?v():f()}function w(t,i,d,u,m){a.currentView="chat",a.activeConversation={id:parseInt(t),name:i,avatar:d,isOnline:"true"===u||!0===u,roles:m||{}},o.widget&&(o.widget.dataset.view="chat");const p="/static/img/default_player.png";if(o.chatAvatar&&(o.chatAvatar.src=d||p,o.chatAvatar.onerror=function(){this.src=p}),o.chatName){const e=c(m);o.chatName.innerHTML=Y(i)+e}o.chatStatus&&(o.chatStatus.textContent=a.activeConversation.isOnline?"Online":"Offline",o.chatStatus.classList.toggle("c-chat-widget__chat-status--offline",!a.activeConversation.isOnline)),o.chatAvatarContainer&&o.chatAvatarContainer.classList.toggle("c-chat-widget__chat-avatar--online",a.activeConversation.isOnline),o.messagesContainer&&(o.messagesContainer.innerHTML='\n        <div style="display: flex; justify-content: center; padding: 40px;">\n          <div class="c-chat-widget__typing-dots">\n            <span class="c-chat-widget__typing-dot"></span>\n            <span class="c-chat-widget__typing-dot"></span>\n            <span class="c-chat-widget__typing-dot"></span>\n          </div>\n        </div>\n      '),async function(t){try{const n=await s(e.messages(t));n.success&&(a.messages=n.messages||[],a.settings={...a.settings,...n.settings},l(),S(),r())}catch(n){console.error("[ChatWidget] Failed to load messages",n)}}(t),o.composerInput&&setTimeout(()=>o.composerInput.focus(),n.animationDuration)}function b(){a.currentView="list",a.activeConversation=null,a.messages=[],o.widget&&(o.widget.dataset.view="list"),C(),i()}function S(){o.messagesContainer&&requestAnimationFrame(()=>{o.messagesContainer.scrollTop=o.messagesContainer.scrollHeight})}function E(e){e.preventDefault(),e.stopPropagation(),y()}function _(e){const t=e.target.closest(".c-chat-widget__conversation, .c-chat-widget__online-user, .c-chat-widget__search-result");t&&(w(t.dataset.userId,t.dataset.userName,t.dataset.avatar,t.dataset.online,{is_coach:"true"===t.dataset.isCoach,is_admin:"true"===t.dataset.isAdmin,is_global_admin:"true"===t.dataset.isGlobalAdmin,is_ref:"true"===t.dataset.isRef}),C())}function C(){a.searchQuery="",a.searchResults=[],o.searchInput&&(o.searchInput.value=""),o.searchResults&&(o.searchResults.classList.remove("is-visible"),o.searchResults.innerHTML="")}function k(e){e.preventDefault(),b()}function L(t){if(t.preventDefault(),!a.activeConversation||!o.composerInput)return;const n=o.composerInput.value.trim();n&&async function(t,n){try{const r=await s(e.send(t),{method:"POST",body:JSON.stringify({content:n})});return r.success&&(a.messages.push(r.message),l(),S(),o.composerInput&&(o.composerInput.value="",o.composerInput.style.height="auto",g()),i()),r}catch(r){throw console.error("[ChatWidget] Failed to send message",r),Z("Failed to send message","error"),r}}(a.activeConversation.id,n)}function T(e){if("Enter"===e.key&&!e.shiftKey)return e.preventDefault(),void L(e);a.activeConversation&&a.settings.typingIndicators&&(void 0!==window.SocketManager&&window.SocketManager.isConnected()||q&&q.connected)&&(a.isTyping||(a.isTyping=!0,void 0!==window.SocketManager?window.SocketManager.emit("typing_start",{recipient_id:a.activeConversation.id}):q&&q.emit("typing_start",{recipient_id:a.activeConversation.id})),clearTimeout(a.typingTimeout),a.typingTimeout=setTimeout(()=>{a.isTyping=!1,void 0!==window.SocketManager?window.SocketManager.emit("typing_stop",{recipient_id:a.activeConversation.id}):q&&q.emit("typing_stop",{recipient_id:a.activeConversation.id})},n.typingDebounce))}function D(){var e;g(),(e=o.composerInput)&&(e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px")}let I=null;function x(t){const o=t.target.value.trim();a.searchQuery=o,console.log("[ChatWidget] Search input:",o),clearTimeout(I),I=setTimeout(()=>{!async function(t){if(t.length<2)return a.searchResults=[],void p();console.log("[ChatWidget] Searching users for:",t);try{const n=await s(`${e.searchUsers}?q=${encodeURIComponent(t)}`);console.log("[ChatWidget] Search response:",n),n.success?(a.searchResults=n.users||[],p(),console.log("[ChatWidget] Found",a.searchResults.length,"users")):(console.warn("[ChatWidget] Search returned success=false:",n.error),a.searchResults=[],p())}catch(n){console.error("[ChatWidget] Failed to search users",n),a.searchResults=[],p()}}(o)},n.searchDebounce)}function A(){a.searchResults.length>0&&o.searchResults&&o.searchResults.classList.add("is-visible")}function M(){setTimeout(()=>{o.searchResults&&o.searchResults.classList.remove("is-visible")},200)}function P(e){"Escape"===e.key&&("chat"===a.currentView?b():a.isOpen&&v())}function $(e){o.widget&&a.isOpen&&(o.widget.contains(e.target)||window.innerWidth<=575||v())}let q=null;function B(){if(void 0!==window.SocketManager)return console.log("[ChatWidget] Using SocketManager"),q=window.SocketManager.getSocket(),window.SocketManager.onConnect("ChatWidget",function(e){q=e,console.log("[ChatWidget] Socket connected via SocketManager"),a.isOpen&&O()}),window.SocketManager.onDisconnect("ChatWidget",function(e){console.log("[ChatWidget] Socket disconnected:",e)}),void function(){if(void 0!==window.SocketManager)return window.SocketManager.on("ChatWidget","new_message",F),window.SocketManager.on("ChatWidget","dm_sent",H),window.SocketManager.on("ChatWidget","dm_error",j),window.SocketManager.on("ChatWidget","dm_unread_update",z),window.SocketManager.on("ChatWidget","message_deleted",R),window.SocketManager.on("ChatWidget","user_typing",U),window.SocketManager.on("ChatWidget","messages_read",V),window.SocketManager.on("ChatWidget","user_online",W),window.SocketManager.on("ChatWidget","user_offline",G),window.SocketManager.on("ChatWidget","online_users",K),void console.log("[ChatWidget] Socket listeners attached via SocketManager");N()}();if("undefined"==typeof io)return console.warn("[ChatWidget] Socket.IO not available, using polling"),void setInterval(r,t.interval);const e=()=>{window.socket&&window.socket.connected?(q=window.socket,N()):window.socket?(q=window.socket,q.once("connect",()=>{N()})):setTimeout(e,1e3)};e()}function N(){q&&(q.on("new_message",F),q.on("dm_sent",H),q.on("dm_error",j),q.on("dm_unread_update",z),q.on("message_deleted",R),q.on("user_typing",U),q.on("messages_read",V),q.on("user_online",W),q.on("user_offline",G),q.on("online_users",K),console.log("[ChatWidget] Socket listeners attached (direct)"))}function R(e){const t=e.message_id,n=e.deleted_for,o=a.messages.findIndex(e=>e.id===t);-1!==o&&"everyone"===n&&(a.messages[o].is_deleted=!0,a.messages[o].content=null,l())}function O(){void 0===window.SocketManager?q&&q.connected&&q.emit("join_messaging"):window.SocketManager.isConnected()&&window.SocketManager.emit("join_messaging")}function F(e){var t,n;a.unreadCount++,h(),a.activeConversation&&e.sender_id===a.activeConversation.id&&(a.messages.push(e),l(),S(),void 0!==window.SocketManager?window.SocketManager.emit("mark_dm_read",{sender_id:e.sender_id}):q&&q.emit("mark_dm_read",{sender_id:e.sender_id})),i(),a.isOpen||(t=e.sender_name,n=e.content,"Notification"in window&&"granted"===Notification.permission&&new Notification(t,{body:n.length>50?n.substring(0,50)+"...":n,icon:"/static/images/logo-icon.png",tag:"chat-message"}))}function H(e){var t;console.log("[ChatWidget] Message sent:",null==(t=e.message)?void 0:t.id)}function j(e){Z(e.error||"Failed to send message","error")}function z(e){a.unreadCount=e.count,h()}function U(e){a.activeConversation&&e.user_id===a.activeConversation.id&&(e.typing?o.typingIndicator&&(o.typingIndicator.style.display="flex",S()):o.typingIndicator&&(o.typingIndicator.style.display="none"))}function V(e){a.activeConversation&&e.reader_id===a.activeConversation.id&&(a.messages.forEach(t=>{t.sender_id!==e.reader_id&&(t.is_read=!0)}),l())}function W(e){var t;X(e.user_id,!0),(null==(t=a.activeConversation)?void 0:t.id)===e.user_id&&(a.activeConversation.isOnline=!0,o.chatStatus&&(o.chatStatus.textContent="Online",o.chatStatus.classList.remove("c-chat-widget__chat-status--offline")),o.chatAvatarContainer&&o.chatAvatarContainer.classList.add("c-chat-widget__chat-avatar--online"))}function G(e){var t;X(e.user_id,!1),(null==(t=a.activeConversation)?void 0:t.id)===e.user_id&&(a.activeConversation.isOnline=!1,o.chatStatus&&(o.chatStatus.textContent="Offline",o.chatStatus.classList.add("c-chat-widget__chat-status--offline")),o.chatAvatarContainer&&o.chatAvatarContainer.classList.remove("c-chat-widget__chat-avatar--online"))}function K(e){a.onlineUsers=e.users||[],function(e){if(!o.onlineList)return;const t=o.onlineList.closest(".c-chat-widget__online");if(!e||0===e.length)return void(t&&t.classList.add("u-hidden"));t&&t.classList.remove("u-hidden");const n="/static/img/default_player.png",a=e.slice(0,8).map(e=>{const t=e.avatar_url||n;return`\n        <div class="c-chat-widget__online-user"\n             data-user-id="${e.id}"\n             data-user-name="${Y(e.name)}"\n             data-avatar="${t}"\n             data-online="true"\n             role="button"\n             tabindex="0">\n          <div class="c-chat-widget__online-avatar">\n            <img src="${t}" alt="${Y(e.name)}" onerror="this.src='${n}'">\n          </div>\n          <span class="c-chat-widget__online-name">${Y(e.name.split(" ")[0])}</span>\n        </div>\n      `}).join("");o.onlineList.innerHTML=a}(a.onlineUsers)}function X(e,t){document.querySelectorAll(`[data-user-id="${e}"]`).forEach(e=>{e.dataset.online=t;const n=e.querySelector(".c-chat-widget__conv-avatar, .c-chat-widget__online-avatar");n&&n.classList.toggle("c-chat-widget__conv-avatar--online",t)})}function Y(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function J(e){if(!e)return"";const t=new Date(e),n=new Date,a=n-t;return a<864e5&&t.getDate()===n.getDate()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):a<1728e5?"Yesterday":a<6048e5?t.toLocaleDateString([],{weekday:"short"}):t.toLocaleDateString([],{month:"short",day:"numeric"})}function Q(){if(window.currentUserId)return parseInt(window.currentUserId);const e=document.querySelector('meta[name="user-id"]');if(e)return parseInt(e.content);const t=document.querySelector("[data-user-id]");return t?parseInt(t.dataset.userId):null}function Z(e,t="info"){"undefined"!=typeof Swal?Swal.fire({toast:!0,position:"top-end",icon:t,title:e,showConfirmButton:!1,timer:3e3,timerProgressBar:!0}):console.log(`[ChatWidget] ${t}: ${e}`)}function ee(){if(!o.widget)return;const e=document.querySelector(".mobile-bottom-nav, .c-mobile-nav, [data-mobile-nav]");if(e){const t=e.offsetHeight;document.documentElement.style.setProperty("--mobile-nav-height",`${t}px`)}}function te(){document.querySelector(".c-chat-widget")?(o={widget:document.querySelector(".c-chat-widget"),trigger:document.querySelector(".c-chat-widget__trigger"),badge:document.querySelector(".c-chat-widget__badge"),panel:document.querySelector(".c-chat-widget__panel"),listView:document.querySelector(".c-chat-widget__list-view"),searchInput:document.querySelector(".c-chat-widget__search-input"),searchResults:document.querySelector(".c-chat-widget__search-results"),onlineList:document.querySelector(".c-chat-widget__online-list"),conversationList:document.querySelector(".c-chat-widget__conversations"),emptyState:document.querySelector(".c-chat-widget__empty"),chatView:document.querySelector(".c-chat-widget__chat"),backBtn:document.querySelector(".c-chat-widget__back-btn"),chatAvatar:document.querySelector(".c-chat-widget__chat-avatar img"),chatAvatarContainer:document.querySelector(".c-chat-widget__chat-avatar"),chatName:document.querySelector(".c-chat-widget__chat-name"),chatStatus:document.querySelector(".c-chat-widget__chat-status"),messagesContainer:document.querySelector(".c-chat-widget__messages"),typingIndicator:document.querySelector(".c-chat-widget__typing"),composerInput:document.querySelector(".c-chat-widget__composer-input"),sendBtn:document.querySelector(".c-chat-widget__send-btn"),newChatBtn:document.querySelector('[data-action="new-chat"]'),openInboxBtn:document.querySelector('[data-action="open-inbox"]'),closeBtns:document.querySelectorAll('[data-action="close-widget"]')},"undefined"!=typeof EventDelegation&&EventDelegation.register("delete-menu",d,{preventDefault:!0}),o.trigger&&o.trigger.addEventListener("click",E),o.closeBtns&&o.closeBtns.forEach(e=>{e.addEventListener("click",v)}),o.conversationList&&o.conversationList.addEventListener("click",_),o.onlineList&&o.onlineList.addEventListener("click",_),o.searchResults&&o.searchResults.addEventListener("click",_),o.backBtn&&o.backBtn.addEventListener("click",k),o.sendBtn&&o.sendBtn.addEventListener("click",L),o.composerInput&&(o.composerInput.addEventListener("keydown",T),o.composerInput.addEventListener("input",D),o.composerInput.addEventListener("touchstart",function(e){this.style.pointerEvents="auto"},{passive:!0}),o.composerInput.addEventListener("click",function(e){e.stopPropagation(),this.focus()})),o.searchInput?(console.log("[ChatWidget] Search input found, binding events"),o.searchInput.addEventListener("input",x),o.searchInput.addEventListener("focus",A),o.searchInput.addEventListener("blur",M)):console.warn("[ChatWidget] Search input not found!"),document.addEventListener("keydown",P),document.addEventListener("click",$),window.addEventListener("resize",ee),o.openInboxBtn&&o.openInboxBtn.addEventListener("click",()=>{window.location.href="/messages"}),o.newChatBtn&&o.newChatBtn.addEventListener("click",()=>{"chat"===a.currentView&&b(),o.searchInput&&o.searchInput.focus()}),B(),ee(),r(),setInterval(r,t.interval),console.log("[ChatWidget] Initialized")):console.log("[ChatWidget] No widget element found, skipping initialization")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",te):te(),window.ChatWidget={open:f,close:v,toggle:y,openConversation:w,refresh:i,getUnreadCount:()=>a.unreadCount}}(),window.MessengerWidget=new class{constructor(){this.widget=null,this.currentUserId=null,this.currentUserName="",this.conversations=[],this.messages=[],this.onlineUsers=[],this.unreadCount=0,this.typingTimeout=null,this.socket=null,this.refreshIntervals={}}init(){this.widget=document.querySelector('[data-component="messenger-widget"]'),this.widget&&(this.bindEvents(),this.setupWebSocket(),this.loadOnlineUsers(),this.loadConversations(),this.loadUnreadCount(),this.refreshIntervals.online=setInterval(()=>this.loadOnlineUsers(),3e4),this.refreshIntervals.unread=setInterval(()=>this.loadUnreadCount(),6e4),console.log("[Messenger] Initialized"))}getCSRFToken(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""}bindEvents(){this.widget.addEventListener("click",e=>{const t=e.target.closest("[data-action]");t&&(e.preventDefault(),this.handleAction(t.dataset.action,t));const n=e.target.closest("[data-conversation-id]");if(n&&!t){e.preventDefault();const t=parseInt(n.dataset.conversationId,10);this.openConversation(t)}const a=e.target.closest("[data-online-user-id]");if(a&&!t){e.preventDefault();const t=parseInt(a.dataset.onlineUserId,10);this.openConversation(t)}});const e=this.widget.querySelector('[data-input="search"]');e&&e.addEventListener("input",e=>this.handleSearch(e.target.value));const t=this.widget.querySelector('[data-input="message"]');t&&(t.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage())}),t.addEventListener("input",()=>this.handleTyping()),t.addEventListener("input",()=>{t.style.height="auto",t.style.height=Math.min(t.scrollHeight,100)+"px"})),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.widget.classList.contains("is-chatting")&&this.showList()})}handleAction(e,t){var n;switch(e){case"back":this.showList();break;case"new-chat":this.focusSearch();break;case"send-message":this.sendMessage();break;case"delete-message":const e=null==(n=t.closest("[data-message-id]"))?void 0:n.dataset.messageId;e&&this.deleteMessage(parseInt(e,10));break;case"open-messages":window.location.href="/messages"}}setupWebSocket(){if("undefined"==typeof io)return;const e=()=>{window.socket&&window.socket.connected?(this.socket=window.socket,this.attachSocketListeners()):setTimeout(e,1e3)};e()}attachSocketListeners(){this.socket&&(this.socket.on("new_message",e=>this.handleNewMessage(e)),this.socket.on("user_typing",e=>this.handleTypingIndicator(e)),this.socket.on("messages_read",e=>this.handleMessagesRead(e)),this.socket.on("dm_sent",e=>{e.message&&this.appendMessage(e.message)}),this.socket.on("dm_error",e=>{this.showToast(e.error||"Failed to send message","error")}),this.socket.on("user_online",()=>this.loadOnlineUsers()),this.socket.on("user_offline",()=>this.loadOnlineUsers()),this.socket.on("message_deleted",e=>this.handleMessageDeleted(e)))}async loadOnlineUsers(){try{const e=await fetch("/api/notifications/presence/online-users?details=true&limit=8"),t=await e.json();t.success&&(this.onlineUsers=t.online_users||[],this.renderOnlineUsers(),this.updateOnlineCount(t.count||this.onlineUsers.length))}catch(e){console.warn("[Messenger] Failed to load online users:",e)}}renderOnlineUsers(){const e=this.widget.querySelector("[data-online-list]");e&&(e.innerHTML="",0!==this.onlineUsers.length?this.onlineUsers.forEach(t=>{const n=document.createElement("div");n.className="c-messenger__online-user",n.dataset.onlineUserId=t.id,n.title=`Chat with ${t.name}`;const a=t.avatar_url||"/static/img/default_player.png";n.innerHTML=`\n          <div class="c-messenger__online-avatar">\n            <img src="${a}" alt="${t.name}" class="c-messenger__online-avatar-img"\n                 onerror="this.src='/static/img/default_player.png'">\n            <span class="c-online-status c-online-status--sm is-online"></span>\n          </div>\n          <span class="c-messenger__online-name">${t.name.split(" ")[0]}</span>\n        `,e.appendChild(n)}):e.innerHTML='<span class="c-messenger__online-empty">No one online</span>')}updateOnlineCount(e){const t=this.widget.querySelector("[data-online-count]");t&&(t.textContent=e)}async loadConversations(){this.widget.querySelector("[data-conversation-list]");const e=this.widget.querySelector('[data-state="loading"]'),t=this.widget.querySelector('[data-state="empty"]');e&&e.classList.remove("u-hidden"),t&&t.classList.add("u-hidden");try{const t=await fetch("/api/messages"),n=await t.json();e&&e.classList.add("u-hidden"),n.success&&(this.conversations=n.conversations||[],this.renderConversations())}catch(n){console.error("[Messenger] Failed to load conversations:",n),e&&e.classList.add("u-hidden")}}renderConversations(){const e=this.widget.querySelector("[data-conversation-list]"),t=this.widget.querySelector('[data-state="empty"]');e&&(e.querySelectorAll(".c-messenger__conversation").forEach(e=>e.remove()),0!==this.conversations.length?(t&&t.classList.add("u-hidden"),this.conversations.forEach(t=>{const n=document.createElement("div");n.className="c-messenger__conversation",t.unread_count>0&&n.classList.add("is-unread"),n.dataset.conversationId=t.user.id;const a=t.user.avatar_url||"/static/img/default_player.png",o=t.user.is_online?"is-online":"is-offline",s=t.last_message?`${t.last_message.sent_by_me?"You: ":""}${t.last_message.content}`:"No messages yet";n.innerHTML=`\n          <div class="c-messenger__conversation-avatar">\n            <img src="${a}" alt="${t.user.name}"\n                 class="c-messenger__conversation-avatar-img"\n                 onerror="this.src='/static/img/default_player.png'">\n            <span class="c-online-status c-online-status--sm ${o}"\n                  data-online-status="${t.user.id}"></span>\n          </div>\n          <div class="c-messenger__conversation-body">\n            <p class="c-messenger__conversation-name">${t.user.name}</p>\n            <p class="c-messenger__conversation-preview">${this.escapeHtml(s)}</p>\n          </div>\n          <div class="c-messenger__conversation-meta">\n            ${t.last_message?`<span class="c-messenger__conversation-time">${t.last_message.time_ago}</span>`:""}\n            ${t.unread_count>0?`<span class="c-messenger__conversation-unread">${t.unread_count}</span>`:""}\n          </div>\n        `,e.appendChild(n)})):t&&t.classList.remove("u-hidden"))}async openConversation(e){var t;this.currentUserId=e,this.widget.classList.add("is-chatting");const n=this.onlineUsers.find(t=>t.id===e)||(null==(t=this.conversations.find(t=>t.user.id===e))?void 0:t.user);if(n){this.currentUserName=n.name;const e=this.widget.querySelector("[data-header-title] span");e&&(e.textContent=n.name)}await this.loadMessages(e);const a=this.widget.querySelector('[data-input="message"]');a&&a.focus()}async loadMessages(e){const t=this.widget.querySelector("[data-messages]");if(t){t.innerHTML='<div class="c-messenger__loading"><div class="c-messenger__loading-spinner"></div></div>';try{const n=await fetch(`/api/messages/${e}`),a=await n.json();a.success&&(this.messages=a.messages||[],this.renderMessages(t),this.scrollToBottom(t),this.loadUnreadCount())}catch(n){console.error("[Messenger] Failed to load messages:",n),t.innerHTML='<p class="c-messenger__empty">Failed to load messages</p>'}}}renderMessages(e){e&&(e.innerHTML="",0!==this.messages.length?this.messages.forEach(e=>this.appendMessage(e,!1)):e.innerHTML='\n          <div class="c-messenger__empty">\n            <i class="ti ti-message-2 c-messenger__empty-icon"></i>\n            <p class="c-messenger__empty-text">No messages yet. Say hello!</p>\n          </div>\n        ')}appendMessage(e,t=!0){const n=this.widget.querySelector("[data-messages]");if(!n)return;const a=n.querySelector(".c-messenger__empty");a&&a.remove();const o=e.sender_id!==this.currentUserId,s=document.createElement("div");s.className="c-messenger__message c-messenger__message--"+(o?"sent":"received"),s.dataset.messageId=e.id;const i=e.created_at?new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";s.innerHTML=`\n        <div class="c-messenger__message-content">${this.escapeHtml(e.content)}</div>\n        <div class="c-messenger__message-time">${i}</div>\n        ${o?'\n          <div class="c-messenger__message-actions">\n            <button class="c-messenger__message-action" data-action="delete-message" title="Delete">\n              <i class="ti ti-trash"></i>\n            </button>\n          </div>\n        ':""}\n      `,n.appendChild(s),t&&this.scrollToBottom(n)}async sendMessage(){const e=this.widget.querySelector('[data-input="message"]');if(!e||!this.currentUserId)return;const t=e.value.trim();if(t)if(e.value="",e.style.height="auto",e.focus(),this.socket&&this.socket.connected)this.socket.emit("send_dm",{recipient_id:this.currentUserId,content:t});else try{const e=await fetch(`/api/messages/${this.currentUserId}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({content:t})}),n=await e.json();n.success&&n.message?this.appendMessage(n.message):this.showToast(n.error||"Failed to send","error")}catch(n){this.showToast("Failed to send message","error")}}async deleteMessage(e){if(confirm("Delete this message?"))try{const t=await fetch(`/api/messages/message/${e}`,{method:"DELETE",headers:{"X-CSRFToken":this.getCSRFToken()}}),n=await t.json();if(n.success){const t=this.widget.querySelector(`[data-message-id="${e}"]`);t&&(t.classList.add("is-deleting"),setTimeout(()=>t.remove(),200))}else this.showToast(n.error||"Failed to delete","error")}catch(t){this.showToast("Failed to delete message","error")}}handleNewMessage(e){this.loadUnreadCount(),this.widget.classList.contains("is-chatting")&&this.currentUserId===e.sender_id?(this.appendMessage(e),this.markAsRead(e.id)):this.showToast(`${e.sender_name}: ${e.content.substring(0,50)}`,"info"),this.widget.classList.contains("is-chatting")||this.loadConversations()}handleMessageDeleted(e){const t=this.widget.querySelector(`[data-message-id="${e.message_id}"]`);t&&t.remove()}handleTypingIndicator(e){if(this.currentUserId!==e.user_id)return;const t=this.widget.querySelector("[data-messages]");let n=null==t?void 0:t.querySelector(".c-messenger__typing");e.typing?n||(n=document.createElement("div"),n.className="c-messenger__typing",n.innerHTML='\n            <span class="c-messenger__typing-dots">\n              <span class="c-messenger__typing-dot"></span>\n              <span class="c-messenger__typing-dot"></span>\n              <span class="c-messenger__typing-dot"></span>\n            </span>\n            <span>typing...</span>\n          ',t.appendChild(n),this.scrollToBottom(t)):n&&n.remove()}handleTyping(){this.socket&&this.currentUserId&&(this.typingTimeout&&clearTimeout(this.typingTimeout),this.socket.emit("typing_start",{recipient_id:this.currentUserId}),this.typingTimeout=setTimeout(()=>{this.socket.emit("typing_stop",{recipient_id:this.currentUserId})},2e3))}handleMessagesRead(e){}markAsRead(e){this.socket&&this.socket.connected&&this.socket.emit("mark_dm_read",{message_id:e})}async handleSearch(e){if(e.length<2)this.renderConversations();else try{const t=await fetch(`/api/messages/users/search?q=${encodeURIComponent(e)}`),n=await t.json();n.success&&n.users&&this.renderSearchResults(n.users)}catch(t){console.error("[Messenger] Search failed:",t)}}renderSearchResults(e){const t=this.widget.querySelector("[data-conversation-list]");t&&(t.querySelectorAll(".c-messenger__conversation").forEach(e=>e.remove()),e.forEach(e=>{const n=document.createElement("div");n.className="c-messenger__conversation",n.dataset.conversationId=e.id;const a=e.avatar_url||"/static/img/default_player.png";n.innerHTML=`\n          <div class="c-messenger__conversation-avatar">\n            <img src="${a}" alt="${e.name}"\n                 class="c-messenger__conversation-avatar-img"\n                 onerror="this.src='/static/img/default_player.png'">\n          </div>\n          <div class="c-messenger__conversation-body">\n            <p class="c-messenger__conversation-name">${e.name}</p>\n            <p class="c-messenger__conversation-preview">Click to start chatting</p>\n          </div>\n        `,t.appendChild(n)}))}focusSearch(){const e=this.widget.querySelector('[data-input="search"]');e&&(e.focus(),e.value="")}showList(){this.widget.classList.remove("is-chatting"),this.currentUserId=null,this.currentUserName="",this.loadConversations();const e=this.widget.querySelector("[data-header-title] span");e&&(e.textContent="Messages")}async loadUnreadCount(){try{const e=await fetch("/api/messages/unread-count"),t=await e.json();t.success&&this.updateBadge(t.count)}catch(e){console.warn("[Messenger] Failed to load unread count:",e)}}updateBadge(e){this.unreadCount=e;const t=this.widget.querySelector('[data-badge="unread"]');t&&(t.textContent=e>99?"99+":e,t.classList.toggle("u-hidden",0===e));const n=document.querySelector('[data-badge="messages-count"]');n&&(n.textContent=e>99?"99+":e,n.classList.toggle("u-hidden",0===e))}scrollToBottom(e){e&&(e.scrollTop=e.scrollHeight)}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}showToast(e,t="info"){"undefined"!=typeof Swal?Swal.fire({toast:!0,position:"top-end",icon:t,title:e,showConfirmButton:!1,timer:3e3}):console.log(`[${t}]`,e)}destroy(){Object.values(this.refreshIntervals).forEach(e=>{e&&clearInterval(e)})}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.MessengerWidget.init()}):window.MessengerWidget.init(),window.addEventListener("beforeunload",()=>{window.MessengerWidget.destroy()});class g{constructor(e={}){this.config={totalSteps:e.totalSteps||5,playerId:e.playerId||null,csrfToken:e.csrfToken||"",autoSaveUrl:e.autoSaveUrl||"",autoSaveDelay:e.autoSaveDelay||2e3},this.currentStep=1,this.autoSaveTimeout=null,this.lastSavedData=null,this.elements={form:document.getElementById("wizardForm"),progressBar:document.getElementById("progressBar"),currentStepInput:document.getElementById("currentStep"),prevBtn:document.getElementById("prevBtn"),nextBtn:document.getElementById("nextBtn"),confirmBtn:document.getElementById("confirmBtn"),saveIndicator:document.getElementById("saveIndicator"),swipeHint:document.getElementById("swipeHint"),steps:document.querySelectorAll("[data-step]"),stepIndicators:document.querySelectorAll("[data-step-indicator]"),editButtons:document.querySelectorAll("[data-goto-step]"),confirmCheckbox:document.getElementById("confirmCheck")},this.init()}init(){this.elements.form?(this.bindEvents(),this.updateUI(),this.initSwipeGestures(),this.elements.swipeHint&&setTimeout(()=>{this.elements.swipeHint.style.opacity="0.5"},3e3)):console.warn("Profile wizard form not found")}bindEvents(){this.elements.nextBtn&&this.elements.nextBtn.addEventListener("click",e=>{e.preventDefault(),this.next()}),this.elements.prevBtn&&this.elements.prevBtn.addEventListener("click",e=>{e.preventDefault(),this.prev()}),this.elements.stepIndicators.forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.stepIndicator);t<this.currentStep&&this.goToStep(t)})}),this.elements.editButtons.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=parseInt(e.dataset.gotoStep);this.goToStep(n)})}),this.elements.form.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("change",()=>{this.scheduleAutoSave(),this.currentStep===this.config.totalSteps&&this.populateReview()}),e.addEventListener("input",()=>{e.classList.remove("is-invalid","is-shaking")})}),this.elements.form.addEventListener("submit",e=>{this.validateFinalStep()||e.preventDefault()}),this.elements.confirmCheckbox&&this.elements.confirmCheckbox.addEventListener("change",()=>{this.updateConfirmButton()})}next(){this.currentStep>1&&!this.validateCurrentStep()?this.shakeInvalidFields():this.currentStep<this.config.totalSteps&&(this.currentStep++,this.updateUI(),this.currentStep===this.config.totalSteps&&this.populateReview())}prev(){this.currentStep>1&&(this.currentStep--,this.updateUI())}goToStep(e){e>=1&&e<=this.config.totalSteps&&(this.currentStep=e,this.updateUI(),this.currentStep===this.config.totalSteps&&this.populateReview())}updateUI(){this.elements.currentStepInput&&(this.elements.currentStepInput.value=this.currentStep),this.elements.steps.forEach(e=>{const t=parseInt(e.dataset.step);e.classList.toggle("c-wizard__step--active",t===this.currentStep)}),this.elements.stepIndicators.forEach(e=>{const t=parseInt(e.dataset.stepIndicator);e.classList.remove("c-wizard__progress-step--active","c-wizard__progress-step--completed"),t===this.currentStep?e.classList.add("c-wizard__progress-step--active"):t<this.currentStep&&e.classList.add("c-wizard__progress-step--completed")});const e=(this.currentStep-1)/(this.config.totalSteps-1)*80;this.elements.progressBar&&(this.elements.progressBar.style.width=e+"%"),this.updateNavigationButtons(),this.elements.form.scrollIntoView({behavior:"smooth",block:"start"})}updateNavigationButtons(){const{prevBtn:e,nextBtn:t,confirmBtn:n}=this.elements;1===this.currentStep?(e&&(e.disabled=!0),t&&(t.style.display="flex",t.querySelector("span").textContent="Get Started"),n&&(n.style.display="none")):this.currentStep===this.config.totalSteps?(e&&(e.disabled=!1),t&&(t.style.display="none"),n&&(n.style.display="flex",this.updateConfirmButton())):(e&&(e.disabled=!1),t&&(t.style.display="flex",t.querySelector("span").textContent="Continue"),n&&(n.style.display="none"))}updateConfirmButton(){this.elements.confirmBtn&&this.elements.confirmCheckbox&&(this.elements.confirmBtn.disabled=!this.elements.confirmCheckbox.checked)}validateCurrentStep(){const e=document.querySelector(`[data-step="${this.currentStep}"]`);if(!e)return!0;let t=!0;e.querySelectorAll("[required]").forEach(e=>{e.value.trim()?e.classList.remove("is-invalid"):(e.classList.add("is-invalid"),t=!1)});const n=e.querySelector("#email");return n&&n.value&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.value)||(n.classList.add("is-invalid"),t=!1)),t}validateFinalStep(){return!this.elements.confirmCheckbox||this.elements.confirmCheckbox.checked}shakeInvalidFields(){const e=document.querySelector(`[data-step="${this.currentStep}"]`);if(!e)return;const t=e.querySelectorAll(".is-invalid");t.forEach(e=>{e.classList.add("is-shaking"),setTimeout(()=>{e.classList.remove("is-shaking")},300)}),t.length&&t[0].focus()}populateReview(){document.querySelectorAll("[data-review]").forEach(e=>{var t;const n=e.dataset.review;let a="-";const o=this.elements.form.querySelector(`[data-field="${n}"]`);if(o)if("SELECT"===o.tagName)if(o.multiple){const e=Array.from(o.selectedOptions).map(e=>e.text);a=e.length>0?e.join(", "):"None selected"}else a=(null==(t=o.options[o.selectedIndex])?void 0:t.text)||"-";else if("TEXTAREA"===o.tagName)a=o.value.trim()||"No additional notes";else if("DIV"===o.tagName){const e=o.querySelectorAll('input[type="checkbox"]:checked'),t=Array.from(e).map(e=>e.value);a=t.length>0?t.join(", "):"None selected"}else a=o.value.trim()||"-";else{const e=this.elements.form.querySelectorAll(`input[name="${n}"]:checked`);e.length>0&&(a=Array.from(e).map(e=>e.value).join(", "))}e.textContent=a})}scheduleAutoSave(){this.config.autoSaveUrl&&(this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.autoSave()},this.config.autoSaveDelay))}async autoSave(){if(!this.config.autoSaveUrl)return;const e=new FormData(this.elements.form),t=Object.fromEntries(e.entries()),n=JSON.stringify(t);if(n!==this.lastSavedData)try{(await fetch(this.config.autoSaveUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.config.csrfToken},body:JSON.stringify(t)})).ok&&(this.lastSavedData=n,this.showSaveIndicator())}catch(a){console.warn("Auto-save failed:",a)}}showSaveIndicator(){this.elements.saveIndicator&&(this.elements.saveIndicator.classList.add("is-visible"),setTimeout(()=>{this.elements.saveIndicator.classList.remove("is-visible")},2e3))}initSwipeGestures(){if(!("ontouchstart"in window))return;let e=0,t=0;this.elements.form.addEventListener("touchstart",t=>{e=t.changedTouches[0].screenX},{passive:!0}),this.elements.form.addEventListener("touchend",n=>{t=n.changedTouches[0].screenX;const a=t-e;Math.abs(a)<50||(a>0?this.prev():this.next())},{passive:!0})}getCurrentStep(){return this.currentStep}}function f(e){return e?e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):e}void 0!==t&&t.exports&&(t.exports=g),function(){const e={init:function(){this.isVerificationPage()&&(this.setupSectionCheckboxes(),this.setupConfirmButton(),this.setupProgressIndicator(),this.setupHapticFeedback(),this.trackUserInteraction(),console.log("Profile verification system initialized"))},isVerificationPage:function(){return null!==document.querySelector('button[name="verify_profile"]')||null!==document.querySelector('[data-verification-page="true"]')},setupSectionCheckboxes:function(){0===document.querySelectorAll(".verification-section").length?this.createSectionCheckboxes():this.attachCheckboxListeners()},createSectionCheckboxes:function(){document.querySelectorAll(".card").forEach((e,t)=>{const n=e.querySelector(".card-header");if(!n)return;if(n.querySelector(".section-reviewed"))return;const a=n.querySelector("h5, h4, h3, .card-title");if(!a)return;const o=a.textContent.trim();if(this.shouldSkipSection(o))return;const s=document.createElement("div");s.className="form-check form-switch d-flex align-items-center ms-auto";const i=document.createElement("input");i.className="form-check-input section-reviewed",i.type="checkbox",i.id=`section-reviewed-${t}`,i.setAttribute("data-section",o.toLowerCase().replace(/\s+/g,"-")),i.setAttribute("data-verification-checkbox","section"),i.setAttribute("data-on-change","verify-section-reviewed");const r=document.createElement("label");r.className="form-check-label ms-2 verification-label",r.setAttribute("for",`section-reviewed-${t}`),r.textContent="Reviewed",s.appendChild(i),s.appendChild(r),n.classList.contains("d-flex")||n.classList.add("d-flex","justify-content-between","align-items-center"),n.appendChild(s),e.classList.add("verification-section")}),this.attachCheckboxListeners()},shouldSkipSection:function(e){return[/action/i,/button/i,/submit/i,/confirm/i].some(t=>t.test(e))},attachCheckboxListeners:function(){document.querySelectorAll(".section-reviewed").forEach(e=>{e.setAttribute("data-verification-initialized","true")})},handleCheckboxChange:function(e){window.Haptics&&(e.checked?window.Haptics.success():window.Haptics.light());const t=e.getAttribute("data-section"),n=e.checked;console.log(`Section "${t}" ${n?"checked":"unchecked"}`),this.updateProgress(),this.updateConfirmButton();const a=e.closest("[data-section-card]");a&&(e.checked?(a.classList.add("section-complete"),a.setAttribute("data-complete","true"),this.animateCardCheck(a)):(a.classList.remove("section-complete"),a.setAttribute("data-complete","false")))},animateCardCheck:function(e){e.classList.add("section-complete-animation"),e.classList.add("scale-down"),e.classList.remove("scale-normal"),setTimeout(()=>{e.classList.remove("scale-down"),e.classList.add("scale-normal")},150),setTimeout(()=>{e.classList.remove("section-complete-animation","scale-normal")},300)},setupConfirmButton:function(){const e=document.querySelector('button[name="verify_profile"]');e&&(e.disabled=!0,e.classList.add("disabled"),this.updateConfirmButton())},updateConfirmButton:function(){const e=document.querySelector('button[name="verify_profile"]');if(e)if(this.areAllSectionsReviewed()){if(e.disabled=!1,e.classList.remove("disabled"),e.classList.add("btn-success"),e.classList.remove("btn-secondary"),e.setAttribute("data-state","enabled"),!e.querySelector(".ti-check")){const t=document.createElement("i");t.className="ti ti-check me-2",e.prepend(t)}}else{e.disabled=!0,e.classList.add("disabled"),e.classList.remove("btn-success"),e.classList.add("btn-secondary"),e.setAttribute("data-state","disabled");const t=e.querySelector(".ti-check");t&&t.remove()}},areAllSectionsReviewed:function(){const e=document.querySelectorAll(".section-reviewed");return 0===e.length||Array.from(e).every(e=>e.checked)},getUncheckedSections:function(){const e=document.querySelectorAll(".section-reviewed:not(:checked)");return Array.from(e).map(e=>e.getAttribute("data-section").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase()))},setupProgressIndicator:function(){let e=document.getElementById("verification-progress");e||(e=this.createProgressIndicator()),this.updateProgress()},createProgressIndicator:function(){const e=document.createElement("div");e.id="verification-progress",e.className="alert alert-info sticky-top mb-4 verification-progress-container",e.setAttribute("data-progress-indicator","verification"),e.setAttribute("data-status","info");const t=document.createElement("strong");t.id="progress-text",t.textContent="0 of 0 sections reviewed";const n=document.createElement("p");n.className="mb-0 small mt-2",n.textContent="Please review each section and check the box before confirming.",e.appendChild(t),e.appendChild(n);const a=document.querySelector("[data-section-card]");return a&&a.parentNode&&a.parentNode.insertBefore(e,a),e},updateProgress:function(){const e=document.querySelectorAll(".section-reviewed"),t=document.querySelectorAll(".section-reviewed:checked").length,n=e.length,a=document.getElementById("progress-text");if(a){a.textContent=`${t} of ${n} sections reviewed`;const e=document.querySelector('[data-progress-indicator="verification"]');e&&(t===n&&n>0?(e.classList.remove("alert-info","alert-warning"),e.classList.add("alert-success"),e.setAttribute("data-status","success")):t>0?(e.classList.remove("alert-info","alert-success"),e.classList.add("alert-warning"),e.setAttribute("data-status","warning")):(e.classList.remove("alert-warning","alert-success"),e.classList.add("alert-info"),e.setAttribute("data-status","info")))}this.updateProgressBar(t,n)},updateProgressBar:function(e,t){let n=document.getElementById("verification-progress-bar");if(!n&&t>0){const e=document.querySelector('[data-progress-indicator="verification"]');if(e){const t=document.createElement("div");t.className="progress mt-2 verification-progress-bar-container",t.setAttribute("data-progress-container","verification"),n=document.createElement("div"),n.id="verification-progress-bar",n.className="progress-bar verification-progress-bar",n.role="progressbar",n.setAttribute("data-progress-bar","verification"),t.appendChild(n),e.appendChild(t)}}if(n&&t>0){const a=Math.round(e/t*100);n.style.width=a+"%",n.setAttribute("aria-valuenow",a),n.setAttribute("aria-valuemin","0"),n.setAttribute("aria-valuemax","100")}},showIncompleteWarning:function(e){const t=e.map(e=>`â€¢ ${e}`).join("<br>");"undefined"!=typeof Swal?Swal.fire({icon:"warning",title:"Review Required",html:`<p>Please review the following sections before confirming:</p><br>${t}`,confirmButtonText:"OK",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning"):"#ffc107"}):alert(`Please review the following sections:\n\n${e.join("\n")}`)},setupHapticFeedback:function(){},trackUserInteraction:function(){}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{e.init()}):e.init(),window.ProfileVerification=e}();class v{constructor(e){this.leagueName=e,this.socket=null,this.currentPlayerId=null,this.isConnected=!1,window.draftSystemInstance=this,this.init()}init(){console.log("ðŸŽ¯ [Draft] Initializing DraftSystemV2 for league:",this.leagueName),this.setupImageHandling(),this.setupEventListeners(),this.initializeSocket(),this.setupSearch(),this.setupTeamTabHighlighting(),console.log("ðŸŽ¯ [Draft] DraftSystemV2 initialization complete")}setupImageHandling(){document.querySelectorAll('[data-component="player-avatar-container"]').forEach(e=>{const t=e.querySelector(".player-avatar"),n=e.querySelector(".player-avatar-fallback");if(t&&n&&(n.classList.add("d-flex"),n.classList.remove("d-none"),t.classList.add("d-none"),t.classList.remove("d-block"),t.src&&""!==t.src)){const e=new Image;e.onload=()=>{t.classList.add("d-block"),t.classList.remove("d-none"),n.classList.add("d-none"),n.classList.remove("d-flex")},e.onerror=()=>{t.classList.add("d-none"),t.classList.remove("d-block"),n.classList.add("d-flex"),n.classList.remove("d-none")},e.src=t.src}}),document.querySelectorAll('[data-component="team-player"]').forEach(e=>{const t=e.querySelector(".team-player-avatar"),n=e.querySelector(".team-player-avatar-fallback");if(t&&n&&(n.classList.add("d-flex"),n.classList.remove("d-none"),t.classList.add("d-none"),t.classList.remove("d-block"),t.src&&""!==t.src)){const e=new Image;e.onload=()=>{t.classList.add("d-block"),t.classList.remove("d-none"),n.classList.add("d-none"),n.classList.remove("d-flex")},e.onerror=()=>{t.classList.add("d-none"),t.classList.remove("d-block"),n.classList.add("d-flex"),n.classList.remove("d-none")},e.src=t.src}})}smartCropImage(e){const t=e.naturalWidth/e.naturalHeight;let n="object-position-top-20";t>1.3?n="object-position-center-35":t>.9&&t<1.1?n="object-position-top-25":t<.7&&(n="object-position-top-15"),e.classList.add(n)}setupEventListeners(){const e=document.getElementById("playerSearch");document.addEventListener("keydown",t=>{"Escape"===t.key&&this.closeModals(),"/"!==t.key||t.target.matches("input, textarea")||(t.preventDefault(),e&&e.focus())})}initializeSocket(){try{if(void 0!==window.SocketManager)return console.log("ðŸ”Œ [Draft] Using SocketManager"),this.socket=window.SocketManager.getSocket(),window.SocketManager.onConnect("DraftSystem",e=>{console.log("ðŸ”Œ [Draft] Socket connected via SocketManager"),this.socket=e,this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})}),window.SocketManager.onDisconnect("DraftSystem",e=>{console.log("ðŸ”Œ [Draft] Socket disconnected:",e),this.isConnected=!1,this.updateConnectionStatus(!1)}),void this.setupSocketListenersViaManager();if(window.socket)return console.log("ðŸ”Œ [Draft] Reusing existing socket (connected:",window.socket.connected,")"),this.socket=window.socket,this.socket.connected&&(this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})),void this.setupSocketListeners();console.log("ðŸ”Œ [Draft] Creating new socket connection (fallback)"),this.socket=io("/",{transports:["polling","websocket"],upgrade:!0,timeout:1e4,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:3,withCredentials:!0}),window.socket=this.socket,this.socket.on("connect",()=>{this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})}),this.socket.on("disconnect",()=>{this.isConnected=!1,this.updateConnectionStatus(!1)}),this.socket.on("connect_error",e=>{this.updateConnectionStatus(!1,"Connection Error"),setTimeout(()=>{this.isConnected||this.tryFallbackConnection()},3e3)}),this.socket.on("joined_room",e=>{console.log("ðŸ  [Draft] Joined room:",e.room)}),this.socket.on("player_drafted_enhanced",e=>{this.hideDraftingIndicator(),this.handlePlayerDrafted(e)}),this.socket.on("player_removed_enhanced",e=>{this.handlePlayerRemoved(e)}),this.socket.on("user_drafting",e=>{e.username&&e.player_name&&this.showUserActivity(e.username,e.player_name,e.team_name)}),this.socket.on("error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Error: "+e.message,"error")}),this.socket.on("draft_error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Draft Error: "+e.message,"error")}),this.socket.on("player_details",e=>{this.handlePlayerDetails(e)})}catch(e){this.updateConnectionStatus(!1,"Failed to Connect")}}setupSocketListeners(){this.socket&&(this.socket.on("connect",()=>{console.log("ðŸ”Œ [Draft] Socket connected, joining draft room"),this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})}),this.socket.on("disconnect",()=>{this.isConnected=!1,this.updateConnectionStatus(!1)}),this.socket.on("joined_room",e=>{console.log("ðŸ  [Draft] Joined room:",e.room),this.hideLoading()}),this.socket.on("player_drafted_enhanced",e=>{this.hideDraftingIndicator(),this.handlePlayerDrafted(e)}),this.socket.on("player_removed_enhanced",e=>{this.handlePlayerRemoved(e)}),this.socket.on("user_drafting",e=>{e.username&&e.player_name&&this.showUserActivity(e.username,e.player_name,e.team_name)}),this.socket.on("error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Error: "+e.message,"error")}),this.socket.on("draft_error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Draft Error: "+e.message,"error")}),this.socket.on("player_details",e=>{this.handlePlayerDetails(e)}))}setupSocketListenersViaManager(){const e=window.SocketManager;e.on("DraftSystem","joined_room",e=>{console.log("ðŸ  [Draft] Joined room:",e.room),this.hideLoading()}),e.on("DraftSystem","player_drafted_enhanced",e=>{this.hideDraftingIndicator(),this.handlePlayerDrafted(e)}),e.on("DraftSystem","player_removed_enhanced",e=>{this.handlePlayerRemoved(e)}),e.on("DraftSystem","user_drafting",e=>{e.username&&e.player_name&&this.showUserActivity(e.username,e.player_name,e.team_name)}),e.on("DraftSystem","error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Error: "+e.message,"error")}),e.on("DraftSystem","draft_error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Draft Error: "+e.message,"error")}),e.on("DraftSystem","player_details",e=>{this.handlePlayerDetails(e)}),console.log("ðŸ”Œ [Draft] Socket listeners attached via SocketManager")}tryFallbackConnection(){try{this.socket&&this.socket.disconnect(),this.socket=io("/",{transports:["polling"],upgrade:!1,timeout:1e4,reconnection:!1,forceNew:!0}),this.socket.on("connect",()=>{this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})}),this.socket.on("connect_error",e=>{this.updateConnectionStatus(!1,"Using HTTP Fallback"),this.showToast("WebSocket connection failed. Using HTTP mode.","info")}),this.setupSocketEventListeners()}catch(e){this.updateConnectionStatus(!1,"HTTP Fallback Only")}}setupSocketEventListeners(){this.socket&&(this.socket.on("player_drafted_enhanced",e=>{this.hideDraftingIndicator(),this.handlePlayerDrafted(e)}),this.socket.on("player_removed_enhanced",e=>{this.handlePlayerRemoved(e)}),this.socket.on("user_drafting",e=>{e.username&&e.player_name&&this.showUserActivity(e.username,e.player_name,e.team_name)}),this.socket.on("remove_error",e=>{this.hideLoading(),this.showToast("Remove Error: "+e.message,"error")}),this.socket.on("error",e=>{this.showToast("Error: "+e.message,"error")}))}updateConnectionStatus(e,t=null){const n=document.getElementById("connectionStatus");n&&(e?(n.className="connection-status status-connected",n.innerHTML='<i class="ti ti-wifi me-1"></i>Connected'):(n.className="connection-status status-disconnected",n.innerHTML=`<i class="ti ti-wifi-off me-1"></i>${t||"Disconnected"}`))}setupSearch(){this.updatePlayerCounts()}handleSearch(e){const t=e.target.value.toLowerCase(),n=document.getElementById("available-players");if(!n)return;const a=Array.from(n.children);let o=0;a.forEach(e=>{const n=e.querySelector('[data-component="player-card"]');n&&((n.getAttribute("data-player-name")||"").includes(t)?(e.classList.remove("d-none"),e.classList.add("d-block"),o++):(e.classList.add("d-none"),e.classList.remove("d-block")))}),this.toggleEmptyState(0===o),this.updateAvailableCount(o)}handleFilter(e){const t=e.target.value.toLowerCase(),n=document.getElementById("available-players");if(!n)return;const a=Array.from(n.children);let o=0;a.forEach(e=>{const n=e.querySelector('[data-component="player-card"]');if(n){const a=n.getAttribute("data-position")||"";!t||a.includes(t)?(e.classList.remove("d-none"),e.classList.add("d-block"),o++):(e.classList.add("d-none"),e.classList.remove("d-block"))}}),this.toggleEmptyState(0===o),this.updateAvailableCount(o)}handleSort(e){const t=e.target.value,n=document.getElementById("available-players");if(!n)return;const a=Array.from(n.children);a.sort((e,n)=>{const a=e.querySelector('[data-component="player-card"]'),o=n.querySelector('[data-component="player-card"]');if(!a||!o)return 0;let s,i;switch(t){case"name":return s=a.getAttribute("data-player-name")||"",i=o.getAttribute("data-player-name")||"",s.localeCompare(i);case"experience":return s=parseInt(a.getAttribute("data-experience"))||0,i=parseInt(o.getAttribute("data-experience"))||0,i-s;case"attendance":return s=parseInt(a.getAttribute("data-attendance"))||0,i=parseInt(o.getAttribute("data-attendance"))||0,i-s;case"goals":return s=parseInt(a.getAttribute("data-goals"))||0,i=parseInt(o.getAttribute("data-goals"))||0,i-s;default:return 0}}),a.forEach(e=>{n.appendChild(e)}),Array.from(n.children).forEach(e=>{e.hasAttribute("data-component")&&"player-column"===e.getAttribute("data-component")&&!e.querySelector('[data-component="player-card"]')&&e.remove()})}showDraftModal(e,t){this.currentPlayerId=e;const n=[];if(document.querySelectorAll('#teamsAccordion [data-component="team-item"]').forEach(e=>{const t=e.querySelector('[data-component="team-toggle"]'),a=t.querySelector('[data-component="team-name"]').textContent.trim(),o=t.querySelector('[data-component="player-count"]').textContent.trim(),s=e.querySelector("[data-team-id]").getAttribute("data-team-id");n.push({text:`${a} (${o})`,value:s})}),window.Swal)Swal.fire({title:"Draft Player",html:`Select a team for <strong>${t}</strong>:`,input:"select",inputOptions:n.reduce((e,t)=>(e[t.value]=t.text,e),{}),inputPlaceholder:"Choose a team...",showCancelButton:!0,confirmButtonText:"Draft Player",cancelButtonText:"Cancel",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-secondary"},buttonsStyling:!1,inputValidator:e=>{if(!e)return"Please select a team!"}}).then(e=>{var t,a;if(e.isConfirmed){const o=e.value,s=(null==(a=null==(t=n.find(e=>e.value===o))?void 0:t.text)?void 0:a.split(" (")[0])||"Unknown Team";this.confirmDraft(o,s)}this.currentPlayerId=null});else{const e=prompt(`Select team ID for ${t}:`);e&&this.confirmDraft(e,"Selected Team")}}confirmDraft(e,t){var n;if(!this.currentPlayerId)return void this.showToast("No player selected","error");if(!this.socket||!this.isConnected)return void this.showToast("Not connected to server - cannot draft","error");const a=document.querySelector(`[data-player-id="${this.currentPlayerId}"]`),o=a&&(null==(n=a.querySelector(".fw-semibold"))?void 0:n.textContent)||"Player";this.showDraftingIndicator(o,t),this.socket.emit("draft_player_enhanced",{player_id:this.currentPlayerId,team_id:e,league_name:this.leagueName,player_name:o}),setTimeout(()=>{document.getElementById("currentDraftIndicator")&&(this.hideDraftingIndicator(),this.showToast("Draft timed out. Please refresh.","warning"))},1e4),this.currentPlayerId=null}showDraftingIndicator(e,t){this.hideDraftingIndicator();const n=document.createElement("div");n.id="currentDraftIndicator",n.className="drafting-indicator",n.innerHTML=`\n            <div class="d-flex align-items-center gap-3">\n                <div class="spinner-border spinner-border-sm text-primary" role="status">\n                    <span class="visually-hidden">Drafting...</span>\n                </div>\n                <div>\n                    <strong>Drafting ${e}</strong>\n                    <div class="small text-muted">to ${t}</div>\n                </div>\n            </div>\n        `,document.body.appendChild(n)}hideDraftingIndicator(){const e=document.getElementById("currentDraftIndicator");e&&(e.classList.add("animate-slide-out-right"),setTimeout(()=>e.remove(),300))}showUserActivity(e,t,n){if(!document.getElementById("draftActivity")){const e=document.createElement("div");e.id="draftActivity",e.className="draft-activity-container",document.body.appendChild(e)}const a=document.createElement("div");a.className="user-activity-toast",a.innerHTML=`\n            <i class="ti ti-user-check text-primary me-2"></i>\n            <div>\n                <strong>${e}</strong> is drafting <strong>${t}</strong>\n                ${n?`<div class="small text-muted">to ${n}</div>`:""}\n            </div>\n        `,document.getElementById("draftActivity").appendChild(a),setTimeout(()=>{a.classList.add("animate-fade-out"),setTimeout(()=>a.remove(),300)},5e3)}async fallbackDraftPlayer(e,t,n){var a;try{this.showLoading();const o=null==(a=document.querySelector("meta[name=csrf-token]"))?void 0:a.getAttribute("content"),s={"Content-Type":"application/json"};o&&(s["X-CSRFToken"]=o);const i=await fetch("/draft/api/draft-player",{method:"POST",headers:s,body:JSON.stringify({player_id:e,team_id:t,league_name:this.leagueName})});if(i.ok){const e=await i.json();this.handlePlayerDrafted(e),this.showToast(`${e.player.name} drafted to ${n}`,"success")}else{const e=await i.json();this.showToast(e.message||"Draft failed","error")}}catch(o){this.showToast("Draft failed - please try again","error")}finally{this.hideLoading(),this.currentPlayerId=null}}removePlayer(e,t){this.socket&&this.isConnected?(this.showLoading(),this.socket.emit("remove_player_enhanced",{player_id:e,team_id:t,league_name:this.leagueName})):this.showToast("Not connected to server","error")}handlePlayerDrafted(e){var t;this.hideLoading();const n=document.getElementById("available-players");if(n){const a=null==(t=n.querySelector(`[data-player-id="${e.player.id}"]`))?void 0:t.closest('[data-component="player-column"]');if(a){const e=a.offsetHeight;a.style.maxHeight=e+"px",a.classList.add("transition-smooth"),requestAnimationFrame(()=>{a.classList.add("opacity-0"),a.classList.add("scale-90"),a.style.transform="scale(0.8) translateY(-10px)",setTimeout(()=>{a.classList.add("max-h-0","mb-0-important","pt-0-important","pb-0-important","overflow-hidden"),a.style.maxHeight="0"},100)}),setTimeout(()=>{a.remove(),this.updatePlayerCounts()},400)}}this.addPlayerToTeam(e.player,e.team_id,e.team_name),this.showToast(`${e.player.name} drafted to ${e.team_name}`,"success")}addPlayerToTeam(e,t,n){const a=document.getElementById(`teamPlayers${t}`);if(!a)return;const o=document.createElement("div");o.className="col-md-6 col-lg-4",o.setAttribute("data-component","team-player-card"),o.setAttribute("data-player-id",e.id);const s=e.profile_picture_url||"/static/img/default_player.png";o.innerHTML=`\n            <div class="card border-0 shadow-sm position-relative"\n                 style="min-height: 120px; cursor: grab;"\n                 draggable="true"\n                 ondragstart="handleDragStart(event, ${e.id})"\n                 ondragend="handleDragEnd(event)">\n                ${e.is_ref?'\n                <div class="position-absolute top-0 start-0" style="z-index: 2;">\n                    <div class="bg-danger text-white" style="padding: 2px 4px; border-radius: 0 0 8px 0; font-size: 10px; font-weight: bold;" title="Referee">\n                        REF\n                    </div>\n                </div>\n                ':""}\n                <div class="card-body p-2">\n                    <div class="d-flex align-items-center mb-2">\n                        <img src="${s}"\n                             alt="${e.name}"\n                             class="rounded-circle me-2"\n                             style="width: 40px; height: 40px; object-fit: cover;"\n                             loading="lazy"\n                             onerror="this.src='/static/img/default_player.png';">\n                        <div class="flex-grow-1 min-width-0">\n                            <div class="fw-semibold text-truncate small">${e.name}</div>\n                            <div class="text-muted" style="font-size: 0.75rem;">\n                                ${f(e.favorite_position)||"Any"}\n                            </div>\n                        </div>\n                        <button class="btn btn-outline-danger btn-sm p-1"\n                                data-action="remove-player"\n                                data-player-id="${e.id}"\n                                data-team-id="${t}"\n                                data-player-name="${e.name}"\n                                data-team-name="${n}"\n                                title="Remove ${e.name}">\n                            <i class="ti ti-x" style="font-size: 0.75rem;"></i>\n                        </button>\n                    </div>\n                    <div class="d-flex justify-content-between text-center small">\n                        <div>\n                            <div class="fw-bold text-success">${e.career_goals||0}</div>\n                            <div class="text-muted" style="font-size: 0.7rem;">Goals</div>\n                        </div>\n                        <div>\n                            <div class="fw-bold text-info">${e.career_assists||0}</div>\n                            <div class="text-muted" style="font-size: 0.7rem;">Assists</div>\n                        </div>\n                        <div>\n                            <div class="fw-bold">\n                                <span class="text-warning">${e.career_yellow_cards||0}</span>/<span class="text-danger">${e.career_red_cards||0}</span>\n                            </div>\n                            <div class="text-muted" style="font-size: 0.7rem;">Cards</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,o.classList.add("draft-card-enter"),a.appendChild(o),setTimeout(()=>{o.classList.remove("draft-card-enter"),o.classList.add("draft-card-enter-active")},10),this.updateTeamCount(t)}updateTeamCount(e){const t=document.getElementById(`teamPlayers${e}`),n=document.getElementById(`teamCount${e}`);if(t&&n){const e=t.querySelectorAll(".draft-team-player-card").length;n.textContent=`${e} players`}}addPlayerToAvailable(e){const t=document.getElementById("available-players");if(!t)return;const n=document.createElement("div");n.className="col-xl-3 col-lg-4 col-md-6 col-sm-6",n.setAttribute("data-component","player-column");const a=e.profile_picture_url||"/static/img/default_player.png",o=e.experience_level||e.league_experience_seasons||"Unknown",s=f(e.favorite_position||e.position)||"Any",i=e.profile_picture_medium||e.profile_picture_webp||a,r=e.league_experience_seasons||0,c=e.attendance_estimate||75,l=e.expected_weeks_available||"All weeks";let d="secondary";"Veteran"===o?d="success":"Experienced"===o&&(d="warning");let u="muted",m="No data";null!=c&&(m=`${Math.round(c)}%`,u=c>=80?"success":c>=60?"warning":"danger"),n.innerHTML=`\n            <div id="player-${e.id}" class="card border-0 shadow-sm h-100"\n                 data-component="player-card"\n                 data-player-id="${e.id}"\n                 data-player-name="${e.name.toLowerCase()}"\n                 data-position="${s.toLowerCase()}"\n                 data-experience="${r}"\n                 data-attendance="${c}"\n                 data-goals="${e.career_goals||0}"\n                 draggable="true"\n                 ondragstart="handleDragStart(event, ${e.id})"\n                 ondragend="handleDragEnd(event)"\n                 style="cursor: grab; transition: all 0.2s ease; min-height: 320px;">\n\n                \x3c!-- Player Image Header --\x3e\n                <div class="position-relative overflow-hidden" style="height: 120px;">\n                    \x3c!-- Full Header Player Image --\x3e\n                    <img src="${i}"\n                         alt="${e.name}"\n                         class="player-face-crop"\n                         style="width: 100%; height: 100%; object-fit: cover; object-position: center 20%; display: block !important; visibility: visible !important; opacity: 1 !important;"\n                         loading="eager"\n                         onerror="// console.log('Image failed to load:', this.src); this.src='/static/img/default_player.png';"\n                         onload="// console.log('Image loaded successfully:', this.src); if(typeof smartCropImage === 'function') smartCropImage(this);">\n\n                    \x3c!-- Dark overlay for better text readability --\x3e\n                    <div class="position-absolute w-100 h-100" style="background: rgba(0,0,0,0.3); top: 0; left: 0;"></div>\n\n                    \x3c!-- Experience Badge - Small Corner Tag --\x3e\n                    <div class="position-absolute top-0 end-0" style="z-index: 2;">\n                        <div class="experience-corner-tag bg-${d}"\n                             title="${o}">\n                            <span class="experience-initial">\n                                ${o[0]||"N"}\n                            </span>\n                        </div>\n                    </div>\n\n                    \x3c!-- Player Name Overlay --\x3e\n                    <div class="position-absolute bottom-0 start-0 p-2" style="z-index: 2;">\n                        <h6 class="text-white fw-bold mb-0 text-shadow-sm">${e.name}</h6>\n                    </div>\n                </div>\n\n                \x3c!-- Player Info Body --\x3e\n                <div class="card-body p-3 text-center">\n                    \x3c!-- Position Badge --\x3e\n                    <div class="mb-2">\n                        ${"Any"!==s?`<span class="badge bg-primary rounded-pill">${s}</span>`:'<span class="badge bg-secondary rounded-pill">Any Position</span>'}\n                    </div>\n\n                    \x3c!-- Stats Row --\x3e\n                    <div class="row text-center mb-2 small">\n                        <div class="col-6">\n                            <div class="fw-bold text-success">${e.career_goals||0}</div>\n                            <div class="text-muted">Goals</div>\n                        </div>\n                        <div class="col-6">\n                            <div class="fw-bold text-info">${e.career_assists||0}</div>\n                            <div class="text-muted">Assists</div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Cards & Attendance --\x3e\n                    <div class="row text-center mb-3 small">\n                        <div class="col-6">\n                            <div class="fw-bold">\n                                <span class="text-warning">${e.career_yellow_cards||0}</span>/<span class="text-danger">${e.career_red_cards||0}</span>\n                            </div>\n                            <div class="text-muted">Y/R Cards</div>\n                        </div>\n                        <div class="col-6">\n                            <div class="fw-bold text-${u}">\n                                ${m}\n                            </div>\n                            <div class="text-muted">Attendance</div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Experience Info --\x3e\n                    <div class="small text-muted mb-2">\n                        ${r} season${1!==r?"s":""}\n                    </div>\n\n                    \x3c!-- Availability Info --\x3e\n                    ${"All weeks"!==l?`<div class="small text-info mb-3">\n                            <i class="ti ti-calendar-event me-1"></i><strong>Expected:</strong> ${l}\n                        </div>`:'<div class="small text-success mb-3">\n                            <i class="ti ti-calendar-check me-1"></i><strong>Available:</strong> All weeks\n                        </div>'}\n                </div>\n\n                \x3c!-- Action Buttons --\x3e\n                <div class="card-footer bg-transparent border-0 p-2">\n                    <div class="d-grid gap-1">\n                        <button class="btn btn-success btn-sm fw-bold"\n                                data-action="draft-player"\n                                data-player-id="${e.id}"\n                                data-player-name="${e.name}"\n                                style="background: linear-gradient(45deg, var(--ecs-success, #28a745), var(--ecs-success-light, #20c997));">\n                            <i class="ti ti-user-plus me-1"></i>Draft Player\n                        </button>\n                        <button class="btn btn-outline-info btn-sm"\n                                data-action="view-player-profile"\n                                data-player-id="${e.id}">\n                            <i class="ti ti-user me-1"></i>View Profile\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `,n.classList.add("draft-card-enter"),t.appendChild(n),Array.from(t.children).forEach(e=>{e.hasAttribute("data-component")&&"player-column"===e.getAttribute("data-component")&&!e.querySelector('[data-component="player-card"]')&&e.remove()}),setTimeout(()=>{const e=document.getElementById("sortPlayers");e&&e.value&&"default"!==e.value&&this.handleSort({target:e});const t=document.getElementById("searchPlayers"),a=document.getElementById("filterPosition");if(t&&t.value){const e=t.value.toLowerCase();(n.querySelector('[data-component="player-card"]').getAttribute("data-player-name")||"").includes(e)||n.classList.add("d-none")}if(a&&a.value){const e=a.value.toLowerCase(),t=n.querySelector('[data-component="player-card"]').getAttribute("data-position")||"";e&&!t.includes(e)&&n.classList.add("d-none")}},50),setTimeout(()=>{n.classList.remove("draft-card-enter"),n.classList.add("draft-card-enter-active")},10),this.updatePlayerCounts()}handlePlayerRemoved(e){this.hideLoading(),this.removePlayerFromTeam(e.player.id,e.team_id),this.addPlayerToAvailable(e.player),this.showToast(`${e.player.name} removed from ${e.team_name}`,"info")}removePlayerFromTeam(e,t){const n=document.querySelector(`#teamPlayers${t} [data-player-id="${e}"]`);n&&(n.classList.add("team-player-exit"),setTimeout(()=>{n.remove(),this.updateTeamCount(t)},300))}handlePlayerDetails(e){const t=document.getElementById("playerProfileContent");if(!t)return;const n=e.player,a=`\n            <div class="row">\n                <div class="col-md-4 text-center">\n                    <div class="player-avatar-container mx-auto mb-3" style="width: 120px; height: 120px;">\n                        <div class="player-avatar-fallback">\n                            ${n.name.substring(0,2).toUpperCase()}\n                        </div>\n                        ${n.profile_picture_url?`<img src="${n.profile_picture_url}" alt="${n.name}" class="player-avatar"\n                                  onload="this.classList.add('d-block'); this.classList.remove('d-none'); this.previousElementSibling.classList.add('d-none'); this.previousElementSibling.classList.remove('d-flex');"\n                                  onerror="this.classList.add('d-none'); this.classList.remove('d-block'); this.previousElementSibling.classList.add('d-flex'); this.previousElementSibling.classList.remove('d-none');">`:""}\n                    </div>\n                    <h4 class="fw-bold mb-2">${n.name}</h4>\n                    <div class="mb-3">\n                        ${n.favorite_position?`<span class="badge badge-position">${f(n.favorite_position)}</span>`:""}\n                        <span class="badge badge-${"Veteran"===n.experience_level?"veteran":"Experienced"===n.experience_level?"experienced":"new-player"}">\n                            ${n.experience_level}\n                        </span>\n                    </div>\n                </div>\n                <div class="col-md-8">\n                    <div class="row">\n                        <div class="col-sm-6 mb-3">\n                            <h6 class="text-muted mb-1">Career Stats</h6>\n                            <div class="d-flex gap-2 flex-wrap">\n                                <span class="stat-chip stat-goals">${n.career_goals}G</span>\n                                <span class="stat-chip stat-assists">${n.career_assists}A</span>\n                                <span class="stat-chip bg-warning text-dark">${n.career_yellow_cards}Y</span>\n                                <span class="stat-chip bg-danger">${n.career_red_cards}R</span>\n                                <span class="stat-chip stat-seasons">${n.league_experience_seasons}T</span>\n                            </div>\n                        </div>\n                        <div class="col-sm-6 mb-3">\n                            <h6 class="text-muted mb-1">Season Stats</h6>\n                            <div class="d-flex gap-2 flex-wrap">\n                                <span class="stat-chip stat-goals">${n.season_goals}G</span>\n                                <span class="stat-chip stat-assists">${n.season_assists}A</span>\n                                <span class="stat-chip bg-warning text-dark">${n.season_yellow_cards}Y</span>\n                                <span class="stat-chip bg-danger">${n.season_red_cards}R</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-sm-6 mb-3">\n                            <h6 class="text-muted mb-1">Attendance</h6>\n                            <div class="attendance-section">\n                                <div class="attendance-label">\n                                    <span>Rate</span>\n                                    <span class="fw-bold">${Math.round(n.attendance_estimate)}%</span>\n                                </div>\n                                <div class="attendance-bar">\n                                    <div class="attendance-fill attendance-${n.attendance_estimate>=80?"excellent":n.attendance_estimate>=60?"good":"poor"}"\n                                         style="width: ${n.attendance_estimate}%"></div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="col-sm-6 mb-3">\n                            <h6 class="text-muted mb-1">Reliability</h6>\n                            <div class="text-center">\n                                <div class="fs-4 fw-bold text-primary">${Math.round(n.reliability_score)}%</div>\n                                <small class="text-muted">Response Rate: ${Math.round(n.rsvp_response_rate)}%</small>\n                            </div>\n                        </div>\n                    </div>\n                    ${n.player_notes?`<div class="mb-3">\n                            <h6 class="text-muted mb-1">Player Notes</h6>\n                            <p class="mb-0">${n.player_notes}</p>\n                        </div>`:""}\n                    ${n.admin_notes?`<div class="mb-3">\n                            <h6 class="text-muted mb-1">Admin/Coach Notes</h6>\n                            <p class="mb-0">${n.admin_notes}</p>\n                        </div>`:""}\n                    ${n.expected_weeks_available&&"All weeks"!==n.expected_weeks_available?`<div class="mb-3">\n                            <h6 class="text-muted mb-1">Availability</h6>\n                            <p class="mb-0">${n.expected_weeks_available}</p>\n                        </div>`:""}\n                </div>\n            </div>\n            ${n.match_history&&n.match_history.length>0?`<hr>\n                <h6 class="text-muted mb-3">Recent Match History</h6>\n                <div class="table-responsive">\n                    <table class="table table-sm">\n                        <thead>\n                            <tr>\n                                <th>Date</th>\n                                <th>Goals</th>\n                                <th>Assists</th>\n                                <th>Cards</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${n.match_history.map(e=>`\n                                <tr>\n                                    <td>${e.date}</td>\n                                    <td>${e.goals}</td>\n                                    <td>${e.assists}</td>\n                                    <td>\n                                        ${e.yellow_cards?`<span class="badge bg-warning">${e.yellow_cards}Y</span>`:""}\n                                        ${e.red_cards?`<span class="badge bg-danger">${e.red_cards}R</span>`:""}\n                                    </td>\n                                </tr>\n                            `).join("")}\n                        </tbody>\n                    </table>\n                </div>`:""}\n        `;t.innerHTML=a}updatePlayerCounts(){const e=document.querySelectorAll('[data-component="player-item"]').length,t=document.getElementById("availableCount");t&&(t.textContent=e),document.querySelectorAll('[id^="teamCount"]').forEach(e=>{const t=e.id.replace("teamCount",""),n=document.querySelectorAll(`#teamPlayers${t} .draft-team-player-card`).length;e.textContent=`${n} players`})}updateAvailableCount(e){const t=document.getElementById("availableCount");t&&(t.textContent=e)}toggleEmptyState(e){const t=document.getElementById("emptyState"),n=document.getElementById("playersContainer");t&&(e?(t.classList.add("d-block"),t.classList.remove("d-none")):(t.classList.add("d-none"),t.classList.remove("d-block"))),n&&(e?(n.classList.add("d-none"),n.classList.remove("d-block")):(n.classList.add("d-block"),n.classList.remove("d-none")))}showLoading(){const e=document.querySelector('[data-component="draft-loading-overlay"]');e&&(e.classList.add("is-visible"),e.classList.remove("is-hidden"))}hideLoading(){const e=document.querySelector('[data-component="draft-loading-overlay"]');e&&(e.classList.add("is-hidden"),e.classList.remove("is-visible"))}showToast(e,t="info"){if(window.Swal){const n={success:"success",error:"error",warning:"warning",info:"info"};Swal.fire({title:e,icon:n[t]||"info",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}else window.showToast&&window.showToast(e,t)}closeModals(){document.querySelectorAll('[data-component="modal"][data-state="open"]').forEach(e=>{const t=bootstrap.Modal.getInstance(e);t&&t.hide()})}refreshDraft(){this.showLoading(),setTimeout(()=>{window.location.reload()},500)}viewPlayerProfile(e){this.socket&&this.isConnected?document.getElementById("playerProfileModal")&&(ModalManager.show("playerProfileModal"),this.socket.emit("get_player_details",{player_id:e})):this.showToast("Not connected to server","error")}handleDragStart(e,t){e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move",e.target.classList.add("opacity-50","dragging"),this.draggedPlayerId=t}handleDragEnd(e){e.target.classList.remove("opacity-50","dragging"),this.draggedPlayerId=null}handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move";const t=e.currentTarget;t.classList.add("drag-over"),"available-players"===t.id?t.classList.add("drag-over-available"):t.id&&t.id.startsWith("teamSection")?t.classList.add("drag-over-team"):t.classList.contains("team-drop-zone")&&t.classList.add("drag-over-team-zone")}handleDragLeave(e){e.currentTarget.classList.remove("drag-over","drag-over-available","drag-over-team","drag-over-team-zone")}handleDrop(e,t){var n,a;e.preventDefault();const o=e.currentTarget;o.classList.remove("drag-over","drag-over-available","drag-over-team","drag-over-team-zone");const s=e.dataTransfer.getData("text/plain")||this.draggedPlayerId;if(!s)return void this.showToast("No player data found","error");if(document.querySelector(`#teamPlayers${t} [data-player-id="${s}"]`))return void this.showToast("Player is already on this team","warning");const i=document.querySelector(`[data-player-id="${s}"]`);!i||null==(n=i.querySelector(".fw-semibold"))||n.textContent;let r=`Team ${t}`;if(o.classList.contains("team-drop-zone")){const e=o.querySelector('[data-component="team-name"]');r=e?e.textContent.trim():`Team ${t}`}else{const e=null==(a=document.querySelector(`#teamSection${t}`))?void 0:a.closest('[data-component="team-item"]'),n=e?e.querySelector('[data-component="team-name"]'):null;r=n?n.textContent.trim():`Team ${t}`}this.currentPlayerId=s,this.confirmDraft(t,r)}handleDropToAvailable(e){var t;e.preventDefault(),e.currentTarget.classList.remove("drag-over","drag-over-available","drag-over-team","drag-over-team-zone");const n=e.dataTransfer.getData("text/plain")||this.draggedPlayerId;if(!n)return void this.showToast("No player data found","error");if(document.querySelector(`#available-players [data-player-id="${n}"]`))return void this.showToast("Player is already in available pool","warning");const a=document.querySelector(`[data-player-id="${n}"]`),o=a?a.closest('[id^="teamPlayers"]'):null,s=o?o.id.replace("teamPlayers",""):null;if(!s)return void this.showToast("Could not determine current team","error");!a||null==(t=a.querySelector('[data-component="player-name"]'))||t.textContent;const i=document.querySelector(`#teamSection${s}`).closest('[data-component="team-item"]').querySelector('[data-component="team-name"]');i&&i.textContent.trim(),this.removePlayer(n,s)}async fetchPositionAnalysis(e){try{const t=await fetch(`/draft/api/${this.leagueName}/position-analysis/${e}`);return t.ok?await t.json():(console.error("Failed to fetch position analysis:",t.status),null)}catch(t){return console.error("Error fetching position analysis:",t),null}}async updatePositionHighlighting(e){if(!e)return void document.querySelectorAll('[data-component="player-card"]').forEach(e=>{e.classList.remove("highlight-strong","highlight-moderate");const t=e.querySelector('[data-component="position-fit-badge"]');t&&t.remove()});const t=await this.fetchPositionAnalysis(e);t&&t.player_fit_scores&&document.querySelectorAll('[data-component="player-card"]').forEach(e=>{const n=parseInt(e.dataset.playerId);if(!n)return;e.classList.remove("highlight-strong","highlight-moderate");const a=e.querySelector('[data-component="position-fit-badge"]');a&&a.remove();const o=t.player_fit_scores[n];if(o)if("strong"===o.fit_category){e.classList.add("highlight-strong");const t=document.createElement("span");t.className="badge-strong",t.setAttribute("data-component","position-fit-badge"),t.innerHTML='<i class="ti ti-star-filled me-1"></i>Position Fit',t.title=`${o.favorite_position} - Perfect match for team needs`,e.appendChild(t)}else if("moderate"===o.fit_category){e.classList.add("highlight-moderate");const t=document.createElement("span");t.className="badge-moderate",t.setAttribute("data-component","position-fit-badge"),t.innerHTML='<i class="ti ti-check me-1"></i>Can Play',t.title="Can play needed position",e.appendChild(t)}})}setupTeamTabHighlighting(){document.querySelectorAll('[data-bs-toggle="collapse"][data-team-id]').forEach(e=>{e.addEventListener("click",e=>{const t=parseInt(e.currentTarget.dataset.teamId);t&&setTimeout(()=>this.updatePositionHighlighting(t),100)})});const e=document.querySelector('[data-component="team-collapse"].show[data-team-id]');if(e){const t=parseInt(e.dataset.teamId);t&&this.updatePositionHighlighting(t)}}}void 0!==t&&t.exports&&(t.exports=v);class y{constructor(){this.csrfToken=null,this.init()}init(){this.setupEventListeners(),this.getCsrfToken(),this.initDragAndDrop(),console.log("Draft History Manager initialized")}getCsrfToken(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return void(this.csrfToken=e.getAttribute("content"));const t=document.cookie.split(";");for(let n of t){const[e,t]=n.trim().split("=");if("csrf_token"===e)return void(this.csrfToken=t)}console.warn("CSRF token not found")}setupEventListeners(){const e=document.getElementById("editDraftPickForm");e&&e.addEventListener("submit",e=>this.handleEditSubmit(e))}initDragAndDrop(){document.querySelectorAll(".sortable-draft-picks").forEach(e=>{const t=e.querySelectorAll(".sortable-item");t.forEach(n=>{const a=n.querySelector(".draggable-card");a.addEventListener("dragstart",t=>{n.classList.add("dragging"),e.classList.add("drag-active");const a=n.querySelector("h6").textContent,o=n.dataset.position;t.dataTransfer.setData("text/plain",n.dataset.pickId),t.dataTransfer.setData("application/x-player-name",a),t.dataTransfer.setData("application/x-current-pos",o),t.dataTransfer.effectAllowed="move";const s=n.cloneNode(!0);s.classList.add("drag-image-preview"),document.body.appendChild(s),t.dataTransfer.setDragImage(s,100,50),setTimeout(()=>{document.body.contains(s)&&document.body.removeChild(s)},0)}),a.addEventListener("dragend",a=>{n.classList.remove("dragging"),e.classList.remove("drag-active"),t.forEach(e=>e.classList.remove("drag-over"))}),n.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",n.classList.contains("dragging")||n.classList.add("drag-over")}),n.addEventListener("dragleave",e=>{n.contains(e.relatedTarget)||n.classList.remove("drag-over")}),n.addEventListener("drop",t=>{t.preventDefault(),n.classList.remove("drag-over"),e.classList.remove("drag-active");const a=t.dataTransfer.getData("text/plain"),o=t.dataTransfer.getData("application/x-player-name"),s=t.dataTransfer.getData("application/x-current-pos"),i=parseInt(n.dataset.position);a&&i&&(this.showAlert("info",`Moving ${o} from position #${s} to #${i}...`),this.handleDragDrop(a,i,o))})})})}async handleDragDrop(e,t,n="Player"){try{const n={"Content-Type":"application/json"};this.csrfToken&&(n["X-CSRFToken"]=this.csrfToken);const a=await fetch(`/admin/draft-history/edit/${e}`,{method:"POST",headers:n,body:JSON.stringify({position:t,mode:"smart"})}),o=await a.json();o.success?(this.showAlert("success",`Player moved to position #${t}`),this.reloadPage()):this.showAlert("error",o.message)}catch(a){this.showAlert("error","Failed to reorder draft pick"),console.error("Error reordering draft pick:",a)}}clearFilters(){const e=new URL(window.location);e.search="",window.location.href=e.toString()}editDraftPick(e,t,n,a){document.getElementById("editPickId").value=e,document.getElementById("editPlayerName").value=a,document.getElementById("editDraftPosition").value=t,document.getElementById("editNotes").value=n||"",ModalManager.show("editDraftPickModal")}async handleEditSubmit(e){e.preventDefault();const t=document.getElementById("editPickId").value,n=parseInt(document.getElementById("editDraftPosition").value),a=document.getElementById("editNotes").value.trim();let o="smart";document.getElementById("insertMode").checked?o="insert":document.getElementById("cascadingMode").checked?o="cascading":document.getElementById("absoluteMode").checked&&(o="absolute");try{const e={"Content-Type":"application/json"};this.csrfToken&&(e["X-CSRFToken"]=this.csrfToken);const s=await fetch(`/admin/draft-history/edit/${t}`,{method:"POST",headers:e,body:JSON.stringify({position:n,notes:a,mode:o})}),i=await s.json();i.success?(this.showAlert("success",i.message),bootstrap.Modal.getInstance(document.getElementById("editDraftPickModal")).hide(),this.reloadPage()):this.showAlert("error",i.message)}catch(s){this.showAlert("error","Failed to update draft pick"),console.error("Error updating draft pick:",s)}}async deleteDraftPick(e,t,n,a){if(confirm(`Are you sure you want to delete draft pick #${t} (${n} to ${a})?\n\nThis will adjust all subsequent draft positions and cannot be undone.`))try{const t={"Content-Type":"application/json"};this.csrfToken&&(t["X-CSRFToken"]=this.csrfToken);const n=await fetch(`/admin/draft-history/delete/${e}`,{method:"DELETE",headers:t}),a=await n.json();a.success?(this.showAlert("success",a.message),this.reloadPage()):this.showAlert("error",a.message)}catch(o){this.showAlert("error","Failed to delete draft pick"),console.error("Error deleting draft pick:",o)}}async normalizeDraftPositions(e,t,n,a){if(confirm(`Fix the draft order for ${n} - ${a}?\n\nThis will renumber all positions to run 1, 2, 3, 4... with no gaps. This action cannot be undone.`))try{const n={"Content-Type":"application/json"};this.csrfToken&&(n["X-CSRFToken"]=this.csrfToken);const a=await fetch("/admin/draft-history/normalize",{method:"POST",headers:n,body:JSON.stringify({season_id:e,league_id:t})}),o=await a.json();o.success?(this.showAlert("success",o.message),this.reloadPage()):this.showAlert("error",o.message)}catch(o){this.showAlert("error","Failed to normalize draft positions"),console.error("Error normalizing draft positions:",o)}}async clearSeasonLeague(e,t,n,a){if(confirm(`Are you sure you want to clear ALL draft picks for ${n} - ${a}?\n\nThis action cannot be undone.`))try{const n={"Content-Type":"application/json"};this.csrfToken&&(n["X-CSRFToken"]=this.csrfToken);const a=await fetch("/admin/draft-history/clear",{method:"POST",headers:n,body:JSON.stringify({season_id:e,league_id:t})}),o=await a.json();o.success?(this.showAlert("success",o.message),this.reloadPage()):this.showAlert("error",o.message)}catch(o){this.showAlert("error","Failed to clear draft history"),console.error("Error clearing draft history:",o)}}showAlert(e,t){let n,a;"success"===e?(n="alert-success",a="ti-check"):"info"===e?(n="alert-info",a="ti-info-circle"):(n="alert-danger",a="ti-x");const o=`\n            <div class="alert ${n} alert-dismissible fade show" role="alert">\n                <i class="ti ${a} me-2"></i>${t}\n                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n            </div>\n        `,s=document.querySelector(".container-xxl");s&&(s.insertAdjacentHTML("afterbegin",o),setTimeout(()=>{const e=s.querySelector(".alert");e&&e.remove()},5e3))}reloadPage(){setTimeout(()=>{window.location.reload()},1e3)}initTooltips(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)})}}document.addEventListener("DOMContentLoaded",function(){(document.querySelector(".sortable-draft-picks")||document.getElementById("editDraftPickForm"))&&(d=new y,d.initTooltips(),console.log("Draft History interface loaded successfully"))});class w{constructor(e,t,n){this.leagueName=e,this.teams=t,this.draftedPlayersByTeam=n,this.socket=null,this.currentDraggedPlayer=null,this.isConnected=!1,this.init()}init(){this.setupSocket(),this.setupEventListeners(),this.populateExistingPlayers(),this.setupSearch(),this.updateAllStats(),console.log("ðŸŸï¸ Pitch View System initialized")}setupSocket(){try{if(window.socket)return console.log("ðŸŸï¸ [PitchView] Reusing existing socket (connected:",window.socket.connected,")"),this.socket=window.socket,this.socket.connected&&(this.isConnected=!0,this.socket.emit("join_draft_room",{league_name:this.leagueName})),void this.setupSocketListeners();console.log("ðŸŸï¸ [PitchView] Creating new socket connection"),this.socket=io("/",{transports:["polling","websocket"],upgrade:!0,timeout:1e4,withCredentials:!0}),window.socket=this.socket,this.setupSocketListeners()}catch(e){console.error("Failed to initialize socket:",e)}}setupSocketListeners(){this.socket&&(this.socket.on("connect",()=>{console.log("âœ… Connected to draft system"),this.isConnected=!0,this.socket.emit("join_draft_room",{league_name:this.leagueName})}),this.socket.on("disconnect",()=>{console.log("âŒ Disconnected from draft system"),this.isConnected=!1}),this.socket.on("player_drafted_enhanced",e=>{console.log("ðŸŽ¯ Player drafted:",e),this.handlePlayerDrafted(e)}),this.socket.on("player_removed_enhanced",e=>{console.log("ðŸ”¥ Player removed:",e),this.handlePlayerRemoved(e)}),this.socket.on("player_position_updated",e=>{console.log("ðŸ“ Player position updated:",e),this.handlePlayerPositionUpdated(e)}),this.socket.on("error",e=>{console.error("âŒ Socket error:",e),this.showToast("Error: "+e.message,"error")}))}setupEventListeners(){const e=document.getElementById("playerSearchPitch");e&&e.addEventListener("input",this.handleSearch.bind(this));const t=document.getElementById("positionFilterPitch");t&&t.addEventListener("change",this.handlePositionFilter.bind(this)),document.addEventListener("shown.bs.tab",e=>{if(e.target.id.includes("team-")&&e.target.id.includes("-tab")){const t=e.target.getAttribute("data-team-id");this.onTeamTabSwitch(t)}}),this.setupDragAndDropEvents()}setupDragAndDropEvents(){const e=this;document.addEventListener("dragstart",function(t){const n=t.target.closest(".js-draggable-player");if(n){const a=n.dataset.playerId;t.dataTransfer.setData("text/plain",a),t.dataTransfer.effectAllowed="move",n.classList.add("dragging"),e.currentDraggedPlayer=a}}),document.addEventListener("dragend",function(t){const n=t.target.closest(".js-draggable-player");n&&(n.classList.remove("dragging"),e.currentDraggedPlayer=null)}),document.addEventListener("dragover",function(e){const t=e.target.closest(".js-position-drop-zone");t&&(e.preventDefault(),e.dataTransfer.dropEffect="move",t.classList.add("drag-over"))}),document.addEventListener("dragleave",function(e){const t=e.target.closest(".js-position-drop-zone");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-over")}),document.addEventListener("drop",function(t){const n=t.target.closest(".js-position-drop-zone");if(n){t.preventDefault(),n.classList.remove("drag-over");const a=n.dataset.position,o=n.dataset.teamId;(t.dataTransfer.getData("text/plain")||e.currentDraggedPlayer)&&a&&o&&e.handlePositionDrop(t,a,o)}})}setupSearch(){this.updateAvailablePlayerCount()}handleSearch(e){const t=e.target.value.toLowerCase(),n=document.querySelectorAll("#availablePlayersList .player-item");let a=0;n.forEach(e=>{const n=e.getAttribute("data-player-name")||"";!t||n.includes(t)?(e.classList.remove("d-none"),e.classList.add("d-flex"),a++):(e.classList.remove("d-flex"),e.classList.add("d-none"))}),this.updateAvailablePlayerCount(a)}handlePositionFilter(e){const t=e.target.value.toLowerCase(),n=document.querySelectorAll("#availablePlayersList .player-item");let a=0;n.forEach(e=>{const n=e.getAttribute("data-position")||"";!t||n.includes(t)?(e.classList.remove("d-none"),e.classList.add("d-flex"),a++):(e.classList.remove("d-flex"),e.classList.add("d-none"))}),this.updateAvailablePlayerCount(a)}populateExistingPlayers(){Object.keys(this.draftedPlayersByTeam).forEach(e=>{this.draftedPlayersByTeam[e].forEach(t=>{const n=t.current_position||"bench";this.addPlayerToPosition(t,n,e,!1)})})}onTeamTabSwitch(e){console.log(`Switched to team ${e}`)}addPlayerToPosition(e,t,n,a=!0){const o=document.getElementById(`position-${t}-${n}`);if(!o)return void console.error(`Position container not found: position-${t}-${n}`);this.removePlayerFromAllPositions(e.id,n);const s=this.createPositionedPlayerElement(e,t,n);o.appendChild(s),this.removePlayerFromAvailable(e.id),this.updatePositionStats(n),this.updateTeamCounts(),a&&this.socket&&this.isConnected&&this.socket.emit("update_player_position",{player_id:e.id,team_id:parseInt(n),position:t,league_name:this.leagueName}),console.log(`Added ${e.name} to ${t} position in team ${n}`)}createPositionedPlayerElement(e,t,n){const a=document.createElement("div");return a.className="positioned-player newly-added",a.setAttribute("data-player-id",e.id),a.setAttribute("data-player-name",e.name),a.setAttribute("data-position",t),a.setAttribute("draggable","true"),a.setAttribute("title",e.name),a.addEventListener("dragstart",t=>this.handlePositionedPlayerDragStart(t,e.id)),a.addEventListener("dragend",e=>this.handlePositionedPlayerDragEnd(e)),e.profile_picture_url&&"/static/img/default_player.png"!==e.profile_picture_url?a.innerHTML=`\n                <img src="${e.profile_picture_url}" alt="${e.name}"\n                     class="player-profile-img"\n                     onerror="this.classList.add('d-none'); this.nextElementSibling.classList.remove('d-none');">\n                <div class="player-initials d-none">${this.getPlayerInitials(e.name)}</div>\n                <button class="remove-btn" onclick="pitchViewInstance.removePlayerFromPosition(${e.id}, '${t}', ${n})" title="Remove ${e.name}">Ã—</button>\n            `:a.innerHTML=`\n                <div class="player-initials">${this.getPlayerInitials(e.name)}</div>\n                <button class="remove-btn" onclick="pitchViewInstance.removePlayerFromPosition(${e.id}, '${t}', ${n})" title="Remove ${e.name}">Ã—</button>\n            `,setTimeout(()=>{a.classList.remove("newly-added")},500),a}getPlayerInitials(e){return e.split(" ").map(e=>e.charAt(0).toUpperCase()).join("").substring(0,2)}removePlayerFromPosition(e,t,n){const a=document.getElementById(`position-${t}-${n}`);if(a){const t=a.querySelector(`[data-player-id="${e}"]`);t&&(t.classList.add("removing"),setTimeout(()=>{t.remove(),this.updatePositionStats(n)},300))}this.isPlayerInTeam(e,n)||this.addPlayerBackToAvailable(e)}removePlayerFromAllPositions(e,t){["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"].forEach(n=>{const a=document.getElementById(`position-${n}-${t}`);if(a){const t=a.querySelector(`[data-player-id="${e}"]`);t&&t.remove()}})}removePlayerFromAvailable(e){const t=document.querySelector(`#availablePlayersList [data-player-id="${e}"]`);t&&(t.classList.add("removing-from-list"),setTimeout(()=>{t.remove(),this.updateAvailablePlayerCount()},300))}addPlayerBackToAvailable(e){console.log(`Should add player ${e} back to available pool`)}isPlayerInTeam(e,t){return["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"].some(n=>{const a=document.getElementById(`position-${n}-${t}`);return a&&a.querySelector(`[data-player-id="${e}"]`)})}handlePlayerDragStart(e,t){this.currentDraggedPlayer=t,e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move",e.target.classList.add("dragging")}handlePlayerDragEnd(e){this.currentDraggedPlayer=null,e.target.classList.remove("dragging")}handlePositionedPlayerDragStart(e,t){this.currentDraggedPlayer=t,e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("positioned","true"),e.target.classList.add("dragging")}handlePositionedPlayerDragEnd(e){this.currentDraggedPlayer=null,e.target.classList.remove("dragging")}handlePositionDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move",e.currentTarget.classList.add("drag-over")}handlePositionDragLeave(e){e.currentTarget.classList.remove("drag-over")}handlePositionDrop(e,t,n){e.preventDefault();const a=e.currentTarget;a.classList.remove("drag-over");const o=e.dataTransfer.getData("text/plain"),s="true"===e.dataTransfer.getData("positioned");if(!o)return void this.showToast("No player data found","error");const i=a.querySelector(".position-players").children.length,r=this.getRecommendedMax(t);i>=r&&this.showPositionWarning(t,i+1,r),s?this.movePlayerBetweenPositions(o,t,n):this.draftPlayerToPosition(o,t,n),setTimeout(()=>this.updatePositionCapacity(t,n),100)}getRecommendedMax(e){return{gk:1,lb:1,cb:2,rb:1,lwb:1,rwb:1,cdm:2,cm:2,cam:1,lw:1,rw:1,st:2,bench:999}[e.toLowerCase()]||1}showPositionWarning(e,t,n){const a=e.toUpperCase(),o=document.createElement("div");o.className="position-warning-toast",o.innerHTML=`\n            <i class="ti ti-alert-triangle text-warning me-2"></i>\n            <div>\n                <strong>${a} Position Over Capacity</strong>\n                <div class="small text-muted">Current: ${t} | Recommended: ${n}</div>\n            </div>\n        `,document.body.appendChild(o),setTimeout(()=>{o.classList.add("toast-dismissing"),setTimeout(()=>o.remove(),300)},3e3)}updatePositionCapacity(e,t){const n=document.querySelector(`[data-position="${e}"][data-team-id="${t}"]`);if(!n)return;const a=n.querySelector(".capacity-indicator");if(!a)return;const o=n.querySelectorAll(".positioned-player").length,s=this.getRecommendedMax(e),i=a.querySelector(".current");i&&(i.textContent=o),a.classList.remove("at-capacity","over-capacity"),n.classList.remove("at-capacity","over-capacity"),o===s?(a.classList.add("at-capacity"),n.classList.add("at-capacity")):o>s&&(a.classList.add("over-capacity"),n.classList.add("over-capacity"))}movePlayerBetweenPositions(e,t,n){const a=["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"];let o=null;for(const s of a){const t=document.getElementById(`position-${s}-${n}`),a=null==t?void 0:t.querySelector(`[data-player-id="${e}"]`);if(a){o={id:e,name:a.getAttribute("data-player-name")},a.remove();break}}o?(this.addPlayerToPosition(o,t,n,!0),this.showToast(`Moved ${o.name} to ${t}`,"success")):this.showToast("Player not found","error")}draftPlayerToPosition(e,t,n){const a=document.querySelector(`#availablePlayersList [data-player-id="${e}"]`);a?(a.querySelector(".player-name").textContent,this.socket&&this.isConnected?(this.showLoading(),this.socket.emit("draft_player_enhanced",{player_id:parseInt(e),team_id:parseInt(n),league_name:this.leagueName,position:t})):this.showToast("Not connected to server","error")):this.showToast("Player not found in available list","error")}handlePlayerDrafted(e){this.hideLoading();const t=e.position||"bench";this.addPlayerToPosition(e.player,t,e.team_id,!1),this.showToast(`${e.player.name} drafted to ${e.team_name}`,"success")}handlePlayerRemoved(e){this.hideLoading(),this.removePlayerFromAllPositions(e.player.id,e.team_id),this.updatePositionStats(e.team_id),this.updateTeamCounts(),this.addPlayerToAvailableList(e.player),this.showToast(`${e.player.name} removed from team`,"info")}addPlayerToAvailableList(e){const t=document.getElementById("availablePlayersList");if(!t)return;if(t.querySelector(`[data-player-id="${e.id}"]`))return;const n=document.createElement("div");n.className="pitch-player-card js-draggable-player",n.setAttribute("data-player-id",e.id),n.setAttribute("data-player-name",(e.name||"").toLowerCase()),n.setAttribute("data-position",(e.favorite_position||e.position||"").toLowerCase()),n.setAttribute("draggable","true");const a=e.profile_picture_url||"/static/img/default_player.png",o=e.favorite_position||e.position||"Any",s=e.career_goals||0,i=e.career_assists||0;n.innerHTML=`\n            <div class="pitch-player-card__avatar">\n                <img src="${a}"\n                     alt="${e.name}" class="js-player-image"\n                     data-fallback="/static/img/default_player.png"\n                     onerror="this.src='/static/img/default_player.png'">\n            </div>\n            <div class="pitch-player-card__content">\n                <div class="pitch-player-card__header">\n                    <span class="pitch-player-card__name">${e.name}</span>\n                    <span class="pitch-player-card__position">${o}</span>\n                </div>\n                <div class="pitch-player-card__stats">\n                    <span class="pitch-player-card__stat pitch-player-card__stat--goals" title="Goals">\n                        <i class="ti ti-ball-football"></i> ${s}\n                    </span>\n                    <span class="pitch-player-card__stat pitch-player-card__stat--assists" title="Assists">\n                        <i class="ti ti-shoe"></i> ${i}\n                    </span>\n                </div>\n            </div>\n            <div class="pitch-player-card__drag-handle">\n                <i class="ti ti-grip-vertical"></i>\n            </div>\n        `,n.classList.add("newly-added"),t.insertBefore(n,t.firstChild),setTimeout(()=>{n.classList.remove("newly-added")},500),this.updateAvailablePlayerCount()}handlePlayerPositionUpdated(e){this.addPlayerToPosition(e.player,e.position,e.team_id,!1)}updatePositionStats(e){Object.entries({gk:["gk"],def:["lb","cb","rb","lwb","rwb"],mid:["cdm","cm","cam"],fwd:["lw","rw","st"],bench:["bench"]}).forEach(([t,n])=>{let a=0;n.forEach(t=>{const n=document.getElementById(`position-${t}-${e}`);n&&(a+=n.querySelectorAll(".positioned-player").length)});const o=document.getElementById(`${t}-count-${e}`);o&&(o.textContent=a)}),["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"].forEach(t=>{const n=document.getElementById(`position-${t}-${e}`);if(n){const e=n.querySelectorAll(".positioned-player").length,t=n.closest(".position-zone");if(t){const n=t.querySelector(".position-count");n&&(n.textContent=`(${e})`)}}})}updateAllStats(){this.teams.forEach(e=>{this.updatePositionStats(e.id)}),this.updateTeamCounts()}updateTeamCounts(){this.teams.forEach(e=>{const t=this.getTotalPlayersInTeam(e.id),n=document.getElementById(`teamPitchCount${e.id}`);n&&(n.textContent=t)})}getTotalPlayersInTeam(e){return["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"].reduce((t,n)=>{const a=document.getElementById(`position-${n}-${e}`);return t+(a?a.children.length:0)},0)}updateAvailablePlayerCount(e=null){null===e&&(e=document.querySelectorAll("#availablePlayersList .player-item:not(.d-none)").length);const t=document.getElementById("availablePlayerCount");t&&(t.textContent=e)}showLoading(){const e=document.getElementById("loadingOverlay");e&&(e.classList.remove("d-none"),e.classList.add("d-flex"))}hideLoading(){const e=document.getElementById("loadingOverlay");e&&(e.classList.remove("d-flex"),e.classList.add("d-none"))}showToast(e,t="info"){if(window.Swal){const n={success:"success",error:"error",warning:"warning",info:"info"};Swal.fire({title:e,icon:n[t]||"info",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}else console.log(`${t.toUpperCase()}: ${e}`)}}var b,S;void 0!==t&&t.exports&&(t.exports=w),function(){const e={CONFIG:{MOBILE_BREAKPOINT:768,TABLET_BREAKPOINT:992,TOAST_DURATION_MOBILE:3e3,TOAST_DURATION_DESKTOP:5e3,FETCH_TIMEOUT_MOBILE:1e4,FETCH_TIMEOUT_DESKTOP:3e4,DEBOUNCE_WAIT:250},_initialized:!1,_autoRefreshInterval:null,init:function(e){e=e||document,this._initialized&&e===document||(this.initMobileNavigation(e),this.initAdminNavToggle(e),this.initTouchGestures(e),this.initProgressiveLoading(e),this.initResponsiveTables(e),this.initNetworkMonitoring(),this.initAutoRefreshManagement(),this.initPerformanceMonitoring(),this.initDoubleTapPrevention(e),this.initSmoothScrolling(e),this.initIOSBouncePrevent(),e===document&&(this._initialized=!0))},initMobileNavigation:function(e){const t=(e=e||document).querySelectorAll("[data-nav-link], .navbar-nav .nav-link"),n=e.querySelector("[data-navbar-collapse], .navbar-collapse");t.forEach(e=>{"true"!==e.dataset.navEnhanced&&(e.dataset.navEnhanced="true",e.addEventListener("click",()=>{if(window.innerWidth<this.CONFIG.TABLET_BREAKPOINT&&n&&n.classList.contains("show")){const e=bootstrap.Collapse.getInstance(n);e&&e.hide()}}))})},initAdminNavToggle:function(e){const t=(e=e||document).querySelector('[data-action="toggle-mobile-nav"]'),n=e.querySelector("[data-nav-container]");t&&n&&"true"!==t.dataset.adminNavToggleEnhanced&&(t.dataset.adminNavToggleEnhanced="true",t.addEventListener("click",()=>{n.classList.contains("is-collapsed")?(n.classList.remove("is-collapsed"),t.setAttribute("aria-expanded","true")):(n.classList.add("is-collapsed"),t.setAttribute("aria-expanded","false"))}))},initTouchGestures:function(e){(e=e||document).querySelectorAll('[data-component="admin-card"]').forEach(e=>{if("true"===e.dataset.gesturesEnhanced)return;e.dataset.gesturesEnhanced="true";let t=0;e.addEventListener("touchstart",e=>{t=e.touches[0].clientY},{passive:!0}),e.addEventListener("touchend",n=>{const a=n.changedTouches[0].clientY,o=t-a;Math.abs(o)>50&&o>0&&e.click()},{passive:!0})})},initProgressiveLoading:function(e){if(e=e||document,"IntersectionObserver"in window){const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("loaded"),e.target.dataset.loaded="true",t.unobserve(e.target))})},{rootMargin:"50px"});e.querySelectorAll("[data-lazy-load]").forEach(e=>{"true"!==e.dataset.loaded&&t.observe(e)})}},initResponsiveTables:function(e){e=e||document;const t=this;function n(){e.querySelectorAll("[data-responsive-table], .table-responsive").forEach(e=>{const n="TABLE"===e.tagName?e:e.querySelector("table");if(n)if(window.innerWidth<t.CONFIG.MOBILE_BREAKPOINT){const e=n.querySelectorAll("th");n.querySelectorAll("tbody tr").forEach(t=>{t.querySelectorAll("td").forEach((t,n)=>{e[n]&&t.setAttribute("data-label",e[n].textContent)})}),window.innerWidth<576&&(n.classList.add("table-mobile-stack"),n.dataset.mobileStack="true")}else n.classList.remove("table-mobile-stack"),n.dataset.mobileStack="false"})}n(),window.addEventListener("resize",this.debounce(n,this.CONFIG.DEBOUNCE_WAIT))},initNetworkMonitoring:function(){if(this._networkMonitoringSetup)return;this._networkMonitoringSetup=!0;const e=this;function t(){const t=document.querySelector('[data-component="network-status"]');t&&(navigator.onLine?(t.classList.remove("c-admin-panel-base__network-status--offline"),t.classList.add("c-admin-panel-base__network-status--online"),t.dataset.status="online",t.title="Online"):(t.classList.remove("c-admin-panel-base__network-status--online"),t.classList.add("c-admin-panel-base__network-status--offline"),t.dataset.status="offline",t.title="Offline",e.showMobileToast("You are currently offline. Some features may not work.","warning")))}window.addEventListener("online",()=>{t(),e.showMobileToast("Connection restored","success")}),window.addEventListener("offline",t),t()},initAutoRefreshManagement:function(){if(this._autoRefreshSetup)return;this._autoRefreshSetup=!0;const e=this;function t(){window.innerWidth<e.CONFIG.MOBILE_BREAKPOINT&&e._autoRefreshInterval&&(clearInterval(e._autoRefreshInterval),console.log("Auto-refresh disabled on mobile for battery optimization"))}window.addEventListener("resize",this.debounce(t,this.CONFIG.DEBOUNCE_WAIT)),t()},initPerformanceMonitoring:function(){if(this._performanceMonitoringSetup)return;this._performanceMonitoringSetup=!0;const e=this;if("PerformanceObserver"in window){const n=new PerformanceObserver(t=>{t.getEntries().forEach(t=>{if("navigation"===t.entryType){const n=t.loadEventEnd-t.loadEventStart;console.log("Page load time:",n+"ms"),n>3e3&&window.innerWidth<e.CONFIG.MOBILE_BREAKPOINT&&console.warn("Slow page load detected on mobile")}})});try{n.observe({entryTypes:["navigation"]})}catch(t){console.log("Performance observer not fully supported")}}},initDoubleTapPrevention:function(e){(e=e||document).querySelectorAll('[data-action]:not([data-action="toggle-dropdown"]):not([data-action="navigate"]), button:not(.c-admin-nav__link):not(.c-admin-nav__dropdown-toggle), .c-btn:not(.c-admin-nav__link), input, select, textarea').forEach(e=>{"true"!==e.dataset.doubleTapPrevented&&(e.closest('[data-controller="admin-nav"]')||(e.dataset.doubleTapPrevented="true",e.addEventListener("touchend",function(e){this.disabled||(e.preventDefault(),this.click())},{passive:!1}),e.addEventListener("click",function(e){e.detail>1&&e.preventDefault()})))})},initSmoothScrolling:function(e){(e=e||document).querySelectorAll('a[href^="#"]').forEach(e=>{"true"!==e.dataset.smoothScrollEnhanced&&(e.dataset.smoothScrollEnhanced="true",e.addEventListener("click",function(e){const t=this.getAttribute("href");if(t&&"#"!==t){e.preventDefault();try{const e=document.querySelector(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}catch(n){console.debug("Invalid anchor selector:",t)}}}))})},initIOSBouncePrevent:function(){this._iosBouncePreventSetup||(this._iosBouncePreventSetup=!0,document.body.addEventListener("touchstart",function(e){e.target===document.body&&e.preventDefault()},{passive:!1}),document.body.addEventListener("touchend",function(e){e.target===document.body&&e.preventDefault()},{passive:!1}),document.body.addEventListener("touchmove",function(e){e.target===document.body&&e.preventDefault()},{passive:!1}))},debounce:function(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...a)},t)}},isMobile:function(){return window.innerWidth<this.CONFIG.MOBILE_BREAKPOINT},isTablet:function(){return window.innerWidth>=this.CONFIG.MOBILE_BREAKPOINT&&window.innerWidth<this.CONFIG.TABLET_BREAKPOINT},isDesktop:function(){return window.innerWidth>=this.CONFIG.TABLET_BREAKPOINT},showMobileToast:function(e,t){t=t||"info";const n=document.createElement("div");n.className=`toast align-items-center text-white bg-${t} border-0`,n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.dataset.toast=t,n.innerHTML=`\n                <div class="d-flex">\n                    <div class="toast-body">${e}</div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" data-action="close-toast" aria-label="Close"></button>\n                </div>\n            `;const a=document.querySelector('[data-component="toast-container"]');a&&(a.appendChild(n),new bootstrap.Toast(n,{autohide:!0,delay:this.isMobile()?this.CONFIG.TOAST_DURATION_MOBILE:this.CONFIG.TOAST_DURATION_DESKTOP}).show(),n.addEventListener("hidden.bs.toast",()=>{n.remove()}))},confirmAction:function(e,t,n){n=n||{};const a=e.toLowerCase();let o="Confirm",s="question",i="Confirm Action",r="#3085d6";a.includes("delete")||a.includes("remove")?(o="Delete",s="warning",i="Confirm Delete",r="#dc3545"):a.includes("sync")?(o="Sync",s="question",i="Confirm Sync"):a.includes("reset")?(o="Reset",s="warning",i="Confirm Reset",r="#dc3545"):a.includes("clear")?(o="Clear",s="warning",i="Confirm Clear",r="#dc3545"):a.includes("approve")?(o="Approve",s="question",i="Confirm Approval",r="#28a745"):a.includes("reject")||a.includes("deny")?(o="Reject",s="warning",i="Confirm Rejection",r="#dc3545"):a.includes("send")?(o="Send",s="question",i="Confirm Send"):a.includes("save")?(o="Save",s="question",i="Confirm Save",r="#28a745"):a.includes("cancel")?(o="Yes, Cancel",s="warning",i="Confirm Cancellation"):a.includes("disable")?(o="Disable",s="warning",i="Confirm Disable",r="#dc3545"):a.includes("enable")?(o="Enable",s="question",i="Confirm Enable",r="#28a745"):a.includes("continue")&&(o="Continue");const c=n.confirmText||o,l=n.cancelText||"Cancel",d=n.title||i,u=n.icon||s,m=n.confirmColor||r;this.isMobile()?confirm(e)&&t():"undefined"!=typeof Swal?Swal.fire({title:d,text:e,icon:u,showCancelButton:!0,confirmButtonText:c,cancelButtonText:l,confirmButtonColor:m,cancelButtonColor:"#6c757d",reverseButtons:!0}).then(e=>{e.isConfirmed&&t()}):confirm(e)&&t()},showLoading:function(e){e&&(e.classList.add("is-loading"),e.dataset.loading="true")},hideLoading:function(e){e&&(e.classList.remove("is-loading"),e.dataset.loading="false")},fetch:async function(e,t){t=t||{};const n=this,a=new AbortController,o=setTimeout(()=>a.abort(),n.isMobile()?n.CONFIG.FETCH_TIMEOUT_MOBILE:n.CONFIG.FETCH_TIMEOUT_DESKTOP);try{const n=await fetch(e,{...t,signal:a.signal});return clearTimeout(o),n}catch(s){throw clearTimeout(o),"AbortError"===s.name?n.showMobileToast("Request timed out. Please try again.","warning"):navigator.onLine||n.showMobileToast("No internet connection. Please check your network.","danger"),s}}};function t(){"serviceWorker"in navigator&&"caches"in window&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/static/js/service-worker.js").then(e=>{console.log("Service Worker registered:",e)}).catch(e=>{console.log("Service Worker registration failed:",e)})})}void 0!==window.InitSystem?window.InitSystem.register("AdminPanelBase",{priority:15,init:function(n){e.init(n),t()}}):document.addEventListener("DOMContentLoaded",function(){e.init(document),t()}),window.AdminPanel=e,window.AdminPanelBase=e}(),function(){function e(){document.querySelector('.admin-panel-dashboard, [data-page="admin-dashboard"]')&&("undefined"!=typeof EventDelegation?(EventDelegation.register("navigate",t),EventDelegation.register("open-navigation-settings",n,{preventDefault:!0}),EventDelegation.register("open-registration-settings",a,{preventDefault:!0}),EventDelegation.register("open-task-monitor",o,{preventDefault:!0}),EventDelegation.register("open-database-monitor",s,{preventDefault:!0}),EventDelegation.register("open-match-reports",i,{preventDefault:!0}),EventDelegation.register("generate-report",r,{preventDefault:!0})):console.warn("[AdminDashboard] EventDelegation not available, skipping handler registration"),function(){const e=window.location.pathname;document.querySelectorAll(".nav-pills .nav-link").forEach(t=>{e.includes(t.getAttribute("href"))&&t.classList.add("active")})}(),document.querySelectorAll('[data-action="navigate"]').forEach(e=>{e.style.cursor="pointer"}),console.log("[AdminDashboard] Initialized"))}function t(e){const t=e.dataset.url;t&&(window.location.href=t)}function n(){"undefined"!=typeof Swal?(Swal.fire({title:"Navigation Settings",html:'<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Loading navigation settings...</p></div>',showConfirmButton:!1,allowOutsideClick:!1}),fetch("/admin-panel/api/navigation-settings").then(e=>e.json()).then(e=>{e.success?function(e){const t=`\n      <div class="text-start">\n        <p class="text-info mb-3"><i class="ti ti-info-circle me-1"></i>Control which navigation items are visible to non-admin users. Admins can always see all navigation items.</p>\n\n        <div class="row">\n          <div class="col-md-6">\n            ${c("teamsNav","Teams Navigation","Team rosters and management for pl-premier, pl-classic roles",e.teams_navigation_enabled)}\n            ${c("storeNav","Store Navigation","League store for coaches and admins",e.store_navigation_enabled)}\n            ${c("matchesNav","Matches Navigation","Match schedules and results",e.matches_navigation_enabled)}\n            ${c("leaguesNav","Leagues Navigation","League standings and information",e.leagues_navigation_enabled)}\n          </div>\n          <div class="col-md-6">\n            ${c("draftsNav","Drafts Navigation","Draft system for coaches",e.drafts_navigation_enabled)}\n            ${c("playersNav","Players Navigation","Player profiles and statistics",e.players_navigation_enabled)}\n            ${c("messagingNav","Messaging Navigation","Communication tools",e.messaging_navigation_enabled)}\n            ${c("mobileFeaturesNav","Mobile Features Navigation","Mobile app integration",e.mobile_features_navigation_enabled)}\n          </div>\n        </div>\n      </div>\n    `;Swal.fire({title:"Navigation Settings",html:t,width:"800px",showCancelButton:!0,confirmButtonText:"Save Settings",cancelButtonText:"Cancel",showLoaderOnConfirm:!0,preConfirm:()=>function(){const e={teams_navigation_enabled:document.getElementById("teamsNav").checked,store_navigation_enabled:document.getElementById("storeNav").checked,matches_navigation_enabled:document.getElementById("matchesNav").checked,leagues_navigation_enabled:document.getElementById("leaguesNav").checked,drafts_navigation_enabled:document.getElementById("draftsNav").checked,players_navigation_enabled:document.getElementById("playersNav").checked,messaging_navigation_enabled:document.getElementById("messagingNav").checked,mobile_features_navigation_enabled:document.getElementById("mobileFeaturesNav").checked};return fetch("/admin-panel/api/navigation-settings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":l()},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message);return e})}(),allowOutsideClick:()=>!Swal.isLoading()}).then(e=>{e.isConfirmed&&Swal.fire({title:"Settings Saved!",text:"Navigation settings have been updated successfully. Changes will take effect immediately.",icon:"success"}).then(()=>{location.reload()})})}(e.settings):Swal.fire("Error",e.message||"Failed to load navigation settings","error")}).catch(e=>{console.error("Navigation settings error:",e),Swal.fire("Error","Failed to load navigation settings","error")})):alert("SweetAlert2 is required for this feature")}function a(){"undefined"!=typeof Swal?(Swal.fire({title:"Registration Settings",html:'<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Loading registration settings...</p></div>',showConfirmButton:!1,allowOutsideClick:!1}),fetch("/admin-panel/api/registration-settings").then(e=>e.json()).then(e=>{e.success?function(e,t){const n=t.map(t=>`<option value="${t.name}" ${e.default_user_role===t.name?"selected":""}>${t.name}</option>`).join(""),a=`\n      <div class="text-start">\n        <p class="text-info mb-3"><i class="ti ti-info-circle me-1"></i>Configure registration settings based on your actual onboarding flow. Discord OAuth is the primary login method.</p>\n\n        <div class="row">\n          <div class="col-md-6">\n            <h6 class="text-primary mb-3">Registration Control</h6>\n            ${c("registrationEnabled","Allow New Registration","Enable/disable new user registration",e.registration_enabled)}\n            ${c("waitlistEnabled","Enable Waitlist","Allow waitlist registration when full",e.waitlist_registration_enabled)}\n            ${c("adminApproval","Admin Approval Required","All new users need admin approval",e.admin_approval_required)}\n            ${c("discordOnly","Discord Only Login","Only Discord OAuth allowed (FIXED)",!0,!0)}\n\n            <div class="mb-3">\n              <label class="form-label">Default User Role</label>\n              <select class="form-select" id="defaultRole">\n                ${n}\n              </select>\n              <small class="text-muted">Role assigned to new registered users</small>\n            </div>\n          </div>\n          <div class="col-md-6">\n            <h6 class="text-primary mb-3">Registration Fields</h6>\n            ${c("requireRealName","Require Real Name","",e.require_real_name)}\n            ${c("requireEmail","Require Email","",e.require_email)}\n            ${c("requirePhone","Require Phone Number","",e.require_phone)}\n            ${c("requireLocation","Require Location","",e.require_location)}\n            ${c("requireJerseySize","Require Jersey Size","",e.require_jersey_size)}\n            ${c("requirePositions","Require Position Preferences","",e.require_position_preferences)}\n            ${c("requireAvailability","Require Availability Info","",e.require_availability)}\n            ${c("requireReferee","Require Referee Willingness","",e.require_referee_willingness)}\n          </div>\n        </div>\n        <div class="alert alert-info mt-3">\n          <small><i class="ti ti-info-circle me-1"></i>These settings reflect your real onboarding form fields. Discord OAuth is your primary authentication method.</small>\n        </div>\n      </div>\n    `;Swal.fire({title:"Registration Settings",html:a,width:"900px",showCancelButton:!0,confirmButtonText:"Save Settings",cancelButtonText:"Cancel",showLoaderOnConfirm:!0,preConfirm:()=>function(){const e={registration_enabled:document.getElementById("registrationEnabled").checked,waitlist_registration_enabled:document.getElementById("waitlistEnabled").checked,admin_approval_required:document.getElementById("adminApproval").checked,discord_only_login:!0,default_user_role:document.getElementById("defaultRole").value,require_real_name:document.getElementById("requireRealName").checked,require_email:document.getElementById("requireEmail").checked,require_phone:document.getElementById("requirePhone").checked,require_location:document.getElementById("requireLocation").checked,require_jersey_size:document.getElementById("requireJerseySize").checked,require_position_preferences:document.getElementById("requirePositions").checked,require_availability:document.getElementById("requireAvailability").checked,require_referee_willingness:document.getElementById("requireReferee").checked};return fetch("/admin-panel/api/registration-settings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":l()},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message);return e})}(),allowOutsideClick:()=>!Swal.isLoading()}).then(e=>{e.isConfirmed&&Swal.fire({title:"Settings Saved!",text:"Registration settings have been updated successfully. Changes will affect new registrations immediately.",icon:"success"})})}(e.settings,e.available_roles):Swal.fire("Error",e.message||"Failed to load registration settings","error")}).catch(e=>{console.error("Registration settings error:",e),Swal.fire("Error","Failed to load registration settings","error")})):alert("SweetAlert2 is required for this feature")}function o(){"undefined"!=typeof Swal?(Swal.fire({title:"Task Monitor",html:'<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Loading task information...</p></div>',width:"800px",showConfirmButton:!1,allowOutsideClick:!1}),fetch("/admin-panel/api/task-monitor").then(e=>e.json()).then(e=>{!function(e){let t="";e.tasks&&e.tasks.length>0?e.tasks.forEach(e=>{const n="active"===e.status?"success":"secondary";t+=`\n          <tr>\n            <td>${e.name}</td>\n            <td><span class="badge bg-${n}">${e.status}</span></td>\n            <td>${e.started||"-"}</td>\n            <td>${e.worker||"-"}</td>\n            <td class="text-truncate">${e.args||"-"}</td>\n          </tr>\n        `}):t='<tr><td colspan="5" class="text-center text-muted">No active tasks found</td></tr>';const n=`\n      <div class="text-start">\n        <div class="row mb-3">\n          <div class="col-md-4">\n            <div class="card bg-success text-white">\n              <div class="card-body text-center">\n                <h4>${e.active_count||0}</h4>\n                <small>Active Tasks</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-4">\n            <div class="card bg-warning text-white">\n              <div class="card-body text-center">\n                <h4>${e.scheduled_count||0}</h4>\n                <small>Scheduled Tasks</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-4">\n            <div class="card bg-info text-white">\n              <div class="card-body text-center">\n                <h4>${e.worker_count||0}</h4>\n                <small>Workers</small>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="table-responsive">\n          <table class="table table-sm">\n            <thead>\n              <tr>\n                <th>Task Name</th>\n                <th>Status</th>\n                <th>Started</th>\n                <th>Worker</th>\n                <th>Arguments</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${t}\n            </tbody>\n          </table>\n        </div>\n        ${e.message?`<div class="alert alert-info"><small>${e.message}</small></div>`:""}\n        <p class="text-muted mt-3"><small>Task monitoring shows real-time background processes and scheduled jobs.</small></p>\n      </div>\n    `;Swal.fire({title:"Task Monitor",html:n,width:"900px",confirmButtonText:"Close"})}(e)}).catch(e=>{console.error("Error loading task monitor:",e),Swal.fire("Error","Failed to load task monitor data","error")})):alert("SweetAlert2 is required for this feature")}function s(){"undefined"!=typeof Swal?(Swal.fire({title:"Database Monitor",html:'<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Loading system information...</p></div>',width:"900px",showConfirmButton:!1,allowOutsideClick:!1}),fetch("/admin-panel/api/system-status").then(e=>e.json()).then(e=>{!function(e){const t=`\n      <div class="text-start">\n        <div class="row mb-3">\n          <div class="col-md-3">\n            <div class="card bg-info text-white">\n              <div class="card-body text-center">\n                <h4>${e.system.cpu_percent}%</h4>\n                <small>CPU Usage</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-3">\n            <div class="card bg-success text-white">\n              <div class="card-body text-center">\n                <h4>${e.system.memory_percent}%</h4>\n                <small>Memory Usage</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-3">\n            <div class="card bg-primary text-white">\n              <div class="card-body text-center">\n                <h4>${e.services.database.response_time_ms}ms</h4>\n                <small>DB Response Time</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-3">\n            <div class="card bg-${"online"===e.services.redis.status?"success":"danger"} text-white">\n              <div class="card-body text-center">\n                <h4>${e.services.redis.response_time_ms}ms</h4>\n                <small>Redis Response</small>\n              </div>\n            </div>\n          </div>\n        </div>\n        <p class="text-muted mt-3"><small>Real-time system monitoring data updated at ${new Date(e.timestamp).toLocaleString()}.</small></p>\n      </div>\n    `;Swal.fire({title:"System Monitor",html:t,width:"900px",confirmButtonText:"Close"})}(e)}).catch(e=>{console.error("Error loading database monitor:",e),Swal.fire("Error","Failed to load system monitor data","error")})):alert("SweetAlert2 is required for this feature")}function i(){"undefined"!=typeof Swal?Swal.fire({title:"Match Reports",html:'\n        <div class="text-start">\n          <p class="text-info mb-3"><i class="ti ti-info-circle me-1"></i>Generate comprehensive match reports with various options.</p>\n          <div class="alert alert-warning">\n            <strong>Note:</strong> This feature is currently in development. Report generation will be available soon.\n          </div>\n        </div>\n      ',width:"600px",confirmButtonText:"Close"}):alert("SweetAlert2 is required for this feature")}function r(){console.log("Generate report functionality coming soon")}function c(e,t,n,a,o=!1){return`\n      <div class="mb-3">\n        <div class="form-check form-switch">\n          <input class="form-check-input" type="checkbox" id="${e}" ${a?"checked":""} ${o?"disabled":""}>\n          <label class="form-check-label" for="${e}">\n            <strong>${t}</strong>\n            ${n?`<br><small class="text-muted">${n}</small>`:""}\n          </label>\n        </div>\n      </div>\n    `}function l(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const t=document.querySelector('input[name="csrf_token"]');return t?t.value:(console.error("CSRF token not found"),"")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}(),function(){const e={botApiUrl:"http://localhost:5001/api/bot",recentLogs:null,commands:null,commandUsage:null,guildInfo:null};async function t(){(await Swal.fire({title:"Restart Discord Bot?",text:"This will temporarily disconnect the bot from Discord while it restarts.",icon:"warning",showCancelButton:!0,confirmButtonText:"Restart Bot"})).isConfirmed&&Swal.fire({title:"Restarting Bot...",text:"Please wait while the bot restarts",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading(),fetch(`${e.botApiUrl}/restart`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Restarted!","Discord bot restart has been initiated.","success"):Swal.fire("Error!",`Failed to restart bot: ${e.message||"Unknown error"}`,"error")}).catch(e=>{console.error("Error restarting bot:",e),Swal.fire("Error!","Failed to connect to bot API.","error")})}})}async function n(){Swal.fire({title:"Running Health Check...",text:"Checking bot connectivity and status",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading(),fetch(`${e.botApiUrl}/health-detailed`).then(e=>e.json()).then(e=>{if("online"===e.status){const t=`\n              <div class="text-start">\n                <p><strong>Status:</strong> ${e.status}</p>\n                <p><strong>Username:</strong> ${e.username||"Unknown"}</p>\n                <p><strong>Guild Count:</strong> ${e.guild_count||0}</p>\n                <p><strong>Latency:</strong> ${e.latency||"N/A"}ms</p>\n                ${e.memory_usage_mb?`<p><strong>Memory Usage:</strong> ${e.memory_usage_mb}MB</p>`:""}\n              </div>\n            `;Swal.fire({title:"Bot Health Check",html:t,icon:"success",confirmButtonText:"Close"})}else Swal.fire("Bot Offline",`Bot status: ${e.status}. ${e.details||""}`,"warning")}).catch(e=>{console.error("Error checking bot health:",e),Swal.fire("Connection Error","Failed to connect to bot API.","error")})}})}function a(){let t="";const n=e.recentLogs;n&&n.length>0?n.forEach(e=>{const n=new Date(e.timestamp).toLocaleString();t+=`[${n}] ${e.level}: ${e.message}\n`}):t="No recent logs available. Bot may not be connected to the API.",Swal.fire({title:"Discord Bot Logs",html:`\n        <div class="bot-logs-container" style="max-height: 400px; overflow-y: auto; text-align: left;">\n          <pre style="font-family: var(--font-mono); font-size: 0.875rem; white-space: pre-wrap;">${t}</pre>\n        </div>\n      `,showCancelButton:!0,confirmButtonText:"Refresh Logs",cancelButtonText:"Close",width:"700px"}).then(e=>{e.isConfirmed&&location.reload()})}async function o(){(await Swal.fire({title:"Sync Commands?",text:"This will synchronize all slash commands with Discord.",icon:"question",showCancelButton:!0,confirmButtonText:"Sync Commands"})).isConfirmed&&Swal.fire({title:"Syncing Commands...",text:"Please wait while commands are synchronized",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading(),fetch(`${e.botApiUrl}/sync-commands`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Synced!",`${e.commands_synced||"All"} commands have been synchronized with Discord.`,"success"):Swal.fire("Error!",`Failed to sync commands: ${e.message||"Unknown error"}`,"error")}).catch(e=>{console.error("Error syncing commands:",e),Swal.fire("Error!","Failed to connect to bot API.","error")})}})}function s(){const t=e.commands;let n="";const a={};t.forEach(e=>{a[e.category]||(a[e.category]=[]),a[e.category].push(e)}),Object.keys(a).forEach(e=>{n+=`\n        <div class="mb-4">\n          <h6 class="mb-2 text-primary">${e} Commands</h6>\n          <div class="table-responsive">\n            <table class="table table-sm table-hover">\n              <thead class="table-light">\n                <tr>\n                  <th>Command</th>\n                  <th>Description</th>\n                  <th>Permission</th>\n                </tr>\n              </thead>\n              <tbody>\n      `,a[e].forEach(e=>{const t="Public"===e.permission_level?"success":e.permission_level.includes("Admin")?"danger":"warning";n+=`\n          <tr>\n            <td><code>/${e.name}</code></td>\n            <td>${e.description}</td>\n            <td><span class="badge bg-${t}">${e.permission_level}</span></td>\n          </tr>\n        `}),n+="\n              </tbody>\n            </table>\n          </div>\n        </div>\n      "}),Swal.fire({title:"Discord Bot Commands",html:`\n        <div class="command-list-container" style="max-height: 500px; overflow-y: auto;">\n          ${n}\n        </div>\n      `,confirmButtonText:"Close",width:"800px"})}function i(){Swal.fire("Command Permissions","Command permissions management interface would appear here.","info")}function r(){const t=e.commandUsage;Swal.fire({title:"Command Usage Statistics",html:`\n        <div class="command-usage-stats" style="text-align: left;">\n          <div class="row mb-3">\n            <div class="col-md-6">\n              <div class="card bg-primary text-white">\n                <div class="card-body text-center">\n                  <h4>${t.commands_today||0}</h4>\n                  <small>Commands Today</small>\n                </div>\n              </div>\n            </div>\n            <div class="col-md-6">\n              <div class="card bg-info text-white">\n                <div class="card-body text-center">\n                  <h4>${t.commands_this_week||0}</h4>\n                  <small>Commands This Week</small>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class="row">\n            <div class="col-md-6">\n              <h6>Most Used Command</h6>\n              <p><code>/${t.most_used_command||"N/A"}</code></p>\n            </div>\n            <div class="col-md-6">\n              <h6>Average Response Time</h6>\n              <p>${t.avg_response_time||"N/A"}</p>\n            </div>\n          </div>\n        </div>\n      `,confirmButtonText:"Close",width:"700px"})}function c(){Swal.fire("Custom Commands","Custom commands management interface would appear here.","info")}function l(e,t){const n=e.dataset.guild;Swal.fire("Guild Management",`Guild management interface for ${n} would appear here.`,"info")}function d(t,n){const a=e.guildInfo;Swal.fire({title:`${a.name||"Guild"} Statistics`,html:`\n        <div class="guild-stats-container" style="text-align: left;">\n          <div class="row mb-3">\n            <div class="col-md-4">\n              <div class="card bg-primary text-white">\n                <div class="card-body text-center">\n                  <h4>${a.member_count||0}</h4>\n                  <small>Total Members</small>\n                </div>\n              </div>\n            </div>\n            <div class="col-md-4">\n              <div class="card bg-success text-white">\n                <div class="card-body text-center">\n                  <h4>${a.channel_count||0}</h4>\n                  <small>Channels</small>\n                </div>\n              </div>\n            </div>\n            <div class="col-md-4">\n              <div class="card bg-info text-white">\n                <div class="card-body text-center">\n                  <h4>${a.role_count||0}</h4>\n                  <small>Roles</small>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      `,confirmButtonText:"Close",width:"700px"})}function u(){Swal.fire({title:"Add Bot to Server",html:'\n        <div class="add-guild-container">\n          <p>To add the ECS FC Discord bot to another server, you need administrator permissions on that server.</p>\n          <div class="alert alert-info">\n            <i class="ti ti-info-circle me-2"></i>\n            Click the button below to authorize the bot for a new server.\n          </div>\n          <div class="mt-4">\n            <h6>Required Permissions:</h6>\n            <ul class="small" style="text-align: left;">\n              <li>Manage Roles</li>\n              <li>Send Messages</li>\n              <li>Read Message History</li>\n              <li>Manage Channels</li>\n              <li>Use Application Commands</li>\n            </ul>\n          </div>\n        </div>\n      ',showConfirmButton:!1,showCloseButton:!0})}async function m(){var t,n,a,o,s,i,r;const c={prefix:(null==(t=document.getElementById("botPrefix"))?void 0:t.value)||"!",default_role:(null==(n=document.getElementById("defaultRole"))?void 0:n.value)||"",activity_type:(null==(a=document.getElementById("activityType"))?void 0:a.value)||"playing",activity_text:(null==(o=document.getElementById("activityText"))?void 0:o.value)||"ECS FC League",auto_moderation:(null==(s=document.getElementById("autoModeration"))?void 0:s.checked)||!1,command_logging:(null==(i=document.getElementById("commandLogging"))?void 0:i.checked)||!1,welcome_messages:(null==(r=document.getElementById("welcomeMessages"))?void 0:r.checked)||!1};Swal.fire({title:"Saving Configuration...",text:"Please wait while the configuration is being saved",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}});try{const t=await fetch(`${e.botApiUrl}/config`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),n=await t.json();n.success?Swal.fire("Saved!","Bot configuration has been updated successfully.","success"):Swal.fire("Error!",`Failed to save configuration: ${n.error||"Unknown error"}`,"error")}catch(l){console.error("Error saving bot config:",l),Swal.fire("Error!","Failed to connect to bot API. Please check if the bot is running.","error")}}function p(){const e=document.getElementById("botPrefix"),t=document.getElementById("defaultRole"),n=document.getElementById("activityType"),a=document.getElementById("activityText"),o=document.getElementById("autoModeration"),s=document.getElementById("commandLogging"),i=document.getElementById("welcomeMessages");e&&(e.value="!"),t&&(t.value=""),n&&(n.value="playing"),a&&(a.value="ECS FC League"),o&&(o.checked=!0),s&&(s.checked=!0),i&&(i.checked=!0),Swal.fire("Reset!","Configuration has been reset to defaults.","info")}function h(){(document.querySelector('[data-page="admin-discord-bot"]')||document.querySelector(".admin-discord-bot")||window.location.pathname.includes("discord-bot"))&&(e.recentLogs=window.__BOT_RECENT_LOGS__||[],e.commands=window.__BOT_COMMANDS__||[],e.commandUsage=window.__BOT_COMMAND_USAGE__||{},e.guildInfo=window.__BOT_GUILD_INFO__||{},"undefined"!=typeof EventDelegation&&(EventDelegation.register("restart-bot",t,{preventDefault:!0}),EventDelegation.register("check-bot-health",n,{preventDefault:!0}),EventDelegation.register("view-bot-logs",a,{preventDefault:!0}),EventDelegation.register("sync-commands",o,{preventDefault:!0}),EventDelegation.register("view-commands",s,{preventDefault:!0}),EventDelegation.register("command-permissions",i,{preventDefault:!0}),EventDelegation.register("command-usage",r,{preventDefault:!0}),EventDelegation.register("custom-commands",c,{preventDefault:!0}),EventDelegation.register("manage-guild",l,{preventDefault:!0}),EventDelegation.register("guild-stats",d,{preventDefault:!0}),EventDelegation.register("add-guild",u,{preventDefault:!0}),EventDelegation.register("save-bot-config",m,{preventDefault:!0}),EventDelegation.register("reset-bot-config",p,{preventDefault:!0})),async function(){try{const t=await fetch(`${e.botApiUrl}/config`),n=await t.json();if(n.success&&n.config){const e=n.config,t=document.getElementById("botPrefix"),a=document.getElementById("defaultRole"),o=document.getElementById("activityType"),s=document.getElementById("activityText"),i=document.getElementById("autoModeration"),r=document.getElementById("commandLogging"),c=document.getElementById("welcomeMessages");t&&(t.value=e.prefix||"!"),a&&(a.value=e.default_role||""),o&&(o.value=e.activity_type||"playing"),s&&(s.value=e.activity_text||"ECS FC League"),i&&(i.checked=!1!==e.auto_moderation),r&&(r.checked=!1!==e.command_logging),c&&(c.checked=!1!==e.welcome_messages)}}catch(t){console.log("Could not load bot configuration:",t)}}(),console.log("Discord Bot Management initialized"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()}(),function(){let e,t,n,a=!0;function o(){(document.querySelector('[data-page="admin-performance"]')||document.querySelector(".admin-performance")||window.location.pathname.includes("performance"))&&(function(){const e=document.querySelector("[data-perf-data]");if(!e)return;const a=parseFloat(e.dataset.dbAvgQueryTime||0),o=parseInt(e.dataset.cacheActive||0),s=parseInt(e.dataset.cacheExpired||0),i=document.querySelector('[data-chart="query-performance"]');i&&(t=new Chart(i.getContext("2d"),{type:"line",data:{labels:["5min ago","4min ago","3min ago","2min ago","1min ago","Now"],datasets:[{label:"Avg Query Time (ms)",data:[1e3*a,1e3*a*.9,1e3*a*1.1,1e3*a*.8,1e3*a*1.2,1e3*a],borderColor:d("--color-primary")||"#0d6efd",backgroundColor:"rgba(13, 110, 253, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (ms)"}}},plugins:{legend:{display:!1}}}}));const r=document.querySelector('[data-chart="cache-usage"]');r&&(n=new Chart(r.getContext("2d"),{type:"doughnut",data:{labels:["Active","Expired"],datasets:[{data:[o,s],backgroundColor:[d("--color-success")||"#198754",d("--color-danger")||"#dc3545"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}))}(),"undefined"!=typeof EventDelegation&&(EventDelegation.register("toggle-auto-refresh",s,{preventDefault:!0}),EventDelegation.register("clear-cache",i,{preventDefault:!0})),r())}function s(){a=!a;const t=document.querySelector('[data-status="auto-refresh"]');a?(t&&(t.textContent="ON"),r()):(t&&(t.textContent="OFF"),clearInterval(e))}function i(e){if(!confirm("Are you sure you want to clear all cache?"))return e.preventDefault(),!1}function r(){e&&clearInterval(e),e=setInterval(c,3e4)}function c(){a&&fetch("/admin_panel/performance/api/metrics").then(e=>e.json()).then(e=>{if(e.success){const s=e.data;l("query-time",(1e3*s.database.avg_query_time).toFixed(1)+"ms"),l("slow-queries",s.database.slow_queries),l("cache-hits",s.cache.active_entries),l("cache-size",s.cache.cache_size_mb.toFixed(1)+"MB");const i=document.querySelector("[data-timestamp]");i&&(i.textContent=new Date(s.timestamp).toLocaleString()),function(e){const t=document.querySelector('[data-live-value="slow-queries"]');t&&(t.className="c-perf-realtime__value",e.database.slow_queries>5?t.classList.add("c-perf-realtime__value--danger"):e.database.slow_queries>2?t.classList.add("c-perf-realtime__value--warning"):t.classList.add("c-perf-realtime__value--success"));const n=document.querySelector('[data-live-value="cache-size"]');n&&(n.className="c-perf-realtime__value",e.cache.cache_size_mb>50?n.classList.add("c-perf-realtime__value--warning"):n.classList.add("c-perf-realtime__value--secondary"))}(s),t&&function(e){if(!t)return;const n=t.data.datasets[0].data;n.shift(),n.push(e),t.update()}(1e3*s.database.avg_query_time),n&&(a=s.cache.active_entries,o=s.cache.expired_entries,n&&(n.data.datasets[0].data=[a,o],n.update()))}var a,o}).catch(e=>{console.error("Error updating metrics:",e)})}function l(e,t){const n=document.querySelector(`[data-live-value="${e}"]`);n&&(n.textContent=t)}function d(e){const t=getComputedStyle(document.documentElement).getPropertyValue(e);return t?t.trim():null}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o()}(),function(){const e={dockerStatusContainer:"#dockerStatusContainer",taskManagementContainer:"#taskManagementContainer",toastContainer:"#toastContainer",roleSelect:"#role_id",permissionsSelect:"#permissions",currentPermissionsList:"#current-permissions-list",dockerLogsContent:"#dockerLogsContent",dockerLogsModalLabel:"#dockerLogsModalLabel",actions:{refreshContainers:"refresh-containers",openTaskManagement:"open-task-management",refreshTaskList:"refresh-task-list",cleanupOldTasks:"cleanup-old-tasks",loadTaskManagement:"load-task-management",showLogs:"show-logs",containerAction:"container-action",revokeTask:"revoke-task",viewTaskDetails:"view-task-details",removeTask:"remove-task",closeModal:"close-modal"}},t={dockerStatus:"/admin/docker-status",dockerLogs:"/admin/docker-logs/",dockerAction:"/admin/docker-",taskManagement:"/admin/task-management",taskDetails:"/admin/task-details/",revokeTask:"/admin/revoke-task/",removeTask:"/admin/remove-task/",cleanupTasks:"/admin/cleanup-tasks",rolePermissions:"/admin/role-permissions/"},n={init:function(e=document){console.log("[AdminDashboard] Initializing..."),this.initEventDelegation(e),this.initPermissionsTab(e),this.initDockerStatus(e),console.log("[AdminDashboard] Initialized")},initEventDelegation:function(t){t.addEventListener("click",t=>{var n;const a=t.target.closest("[data-action]");if(a)switch(a.dataset.action){case e.actions.refreshContainers:t.preventDefault(),this.handleRefreshContainers(a);break;case e.actions.openTaskManagement:t.preventDefault(),this.openTaskManagement();break;case e.actions.refreshTaskList:this.refreshTaskList();break;case e.actions.cleanupOldTasks:this.cleanupOldTasks();break;case e.actions.loadTaskManagement:this.loadTaskManagement();break;case e.actions.showLogs:this.showLogs(a.dataset.containerName);break;case e.actions.containerAction:this.containerAction(a.dataset.containerName,a.dataset.containerActionType,a);break;case e.actions.revokeTask:this.revokeTask(a.dataset.taskId);break;case e.actions.viewTaskDetails:this.viewTaskDetails(a.dataset.taskId);break;case e.actions.removeTask:this.removeTask(a.dataset.taskId);break;case e.actions.closeModal:(null==(n=window.ModernComponents)?void 0:n.Modal)&&a.dataset.modalId&&window.ModernComponents.Modal.close(a.dataset.modalId)}})},handleRefreshContainers:function(e){e.classList.add("is-loading"),e.disabled=!0,this.fetchDockerStatus().finally(()=>{e.classList.remove("is-loading"),e.disabled=!1})},initPermissionsTab:function(t){const n=t.querySelector(e.roleSelect),a=t.querySelector(e.permissionsSelect),o=t.querySelector(e.currentPermissionsList);a&&"undefined"!=typeof $&&$.fn.select2&&$(a).select2({theme:"bootstrap-5",placeholder:"Select permissions...",allowClear:!0,width:"100%"}),n&&n.addEventListener("change",()=>{const e=n.value;e?this.fetchRolePermissions(e,a,o):(o&&(o.innerHTML='<li class="c-permissions-list__item c-permissions-list__item--empty">Select a role to view permissions.</li>'),a&&($(a).hasClass("select2-hidden-accessible")?$(a).val([]).trigger("change"):Array.from(a.options).forEach(e=>e.selected=!1)))})},fetchRolePermissions:function(e,n,a){fetch(`${t.rolePermissions}${e}`).then(e=>e.json()).then(e=>{if(e.success){if(this.updateCurrentPermissionsList(e.permissions,a),n){const t=e.permissions.map(e=>e.id.toString());$(n).hasClass("select2-hidden-accessible")?$(n).val(t).trigger("change"):Array.from(n.options).forEach(e=>{e.selected=t.includes(e.value)})}}else a.innerHTML='<li class="c-permissions-list__item c-permissions-list__item--error">Error loading permissions</li>'}).catch(e=>{console.error("Error fetching role permissions:",e),a.innerHTML='<li class="c-permissions-list__item c-permissions-list__item--error">Error loading permissions</li>'})},updateCurrentPermissionsList:function(e,t){if(t)if(0===e.length)t.innerHTML='<li class="c-permissions-list__item c-permissions-list__item--empty">No permissions assigned.</li>';else{const n=e.map(e=>`<li class="c-permissions-list__item">${e.name}</li>`).join("");t.innerHTML=n}},initDockerStatus:function(t){t.querySelector(e.dockerStatusContainer)&&this.fetchDockerStatus()},fetchDockerStatus:async function(){const n=document.querySelector(e.dockerStatusContainer);if(n)try{const e=await fetch(t.dockerStatus),a=await e.json();a.success&&a.containers?this.renderContainers(a.containers):n.innerHTML=`\n                        <div class="col-12">\n                            <div class="c-empty-state c-empty-state--warning">\n                                <i class="ti ti-alert-triangle c-empty-state__icon"></i>\n                                <p class="c-empty-state__text">${a.error||"Unable to load container status"}</p>\n                            </div>\n                        </div>\n                    `}catch(a){console.error("Error fetching Docker status:",a),n.innerHTML='\n                    <div class="col-12">\n                        <div class="c-empty-state c-empty-state--error">\n                            <i class="ti ti-alert-circle c-empty-state__icon"></i>\n                            <p class="c-empty-state__text">Failed to load container status</p>\n                        </div>\n                    </div>\n                '}},renderContainers:function(t){const n=document.querySelector(e.dockerStatusContainer);if(!n)return;if(0===t.length)return void(n.innerHTML='\n                    <div class="col-12">\n                        <div class="c-empty-state">\n                            <i class="ti ti-info-circle c-empty-state__icon"></i>\n                            <p class="c-empty-state__text">No containers found</p>\n                        </div>\n                    </div>\n                ');const a=t.map(e=>{const t="running"===e.status?"success":"danger",n="running"===e.status?"ti-check":"ti-x";return`\n                    <div class="col-xl-4 col-lg-6 mb-3">\n                        <div class="c-container-card" data-component="container-card" data-container-name="${e.name}">\n                            <div class="c-container-card__header">\n                                <div class="c-container-card__info">\n                                    <h6 class="c-container-card__name">${e.name}</h6>\n                                    <small class="c-container-card__image">${e.image}</small>\n                                </div>\n                                <span class="c-badge c-badge--${t}">\n                                    <i class="ti ${n}"></i>\n                                    <span>${e.status}</span>\n                                </span>\n                            </div>\n\n                            <div class="c-container-card__body">\n                                <div class="c-container-card__stat">\n                                    <small class="c-container-card__stat-label">Uptime:</small>\n                                    <small class="c-container-card__stat-value">${e.uptime||"N/A"}</small>\n                                </div>\n                                <div class="c-container-card__stat">\n                                    <small class="c-container-card__stat-label">CPU:</small>\n                                    <small class="c-container-card__stat-value">${e.cpu_usage||"N/A"}</small>\n                                </div>\n                                <div class="c-container-card__stat">\n                                    <small class="c-container-card__stat-label">Memory:</small>\n                                    <small class="c-container-card__stat-value">${e.memory_usage||"N/A"}</small>\n                                </div>\n                            </div>\n\n                            <div class="c-container-card__actions">\n                                ${"running"===e.status?`<button class="btn btn-outline-warning btn-sm" data-action="container-action" data-container-name="${e.name}" data-container-action-type="restart">\n                                        <i class="ti ti-refresh"></i> <span>Restart</span>\n                                    </button>\n                                    <button class="btn btn-outline-danger btn-sm" data-action="container-action" data-container-name="${e.name}" data-container-action-type="stop">\n                                        <i class="ti ti-stop"></i> <span>Stop</span>\n                                    </button>`:`<button class="btn btn-outline-success btn-sm" data-action="container-action" data-container-name="${e.name}" data-container-action-type="start">\n                                        <i class="ti ti-play"></i> <span>Start</span>\n                                    </button>`}\n                                <button class="btn btn-outline-primary btn-sm" data-action="show-logs" data-container-name="${e.name}" title="View Logs">\n                                    <i class="ti ti-file-text"></i>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `}).join("");n.innerHTML=a},showLogs:async function(n){var a;const o=document.querySelector(e.dockerLogsContent),s=document.querySelector(e.dockerLogsModalLabel);s&&(s.textContent=`${n} - Logs`),o&&(o.textContent="Loading logs..."),(null==(a=window.ModernComponents)?void 0:a.Modal)&&window.ModernComponents.Modal.open("dockerLogsModal");try{const e=await fetch(`${t.dockerLogs}${n}`),a=await e.json();a.success?o&&(o.textContent=a.logs||"No logs available"):o&&(o.textContent=`Error: ${a.error||"Failed to load logs"}`)}catch(i){console.error("Error fetching logs:",i),o&&(o.textContent="Error loading logs")}},containerAction:async function(e,n,a){if(a){a.classList.add("is-loading"),a.disabled=!0;try{const o=await fetch(`${t.dockerAction}${n}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(o.ok)this.showComponentToast("success","Success",`Container ${n}ed successfully`),setTimeout(()=>this.fetchDockerStatus(),1e3);else{const e=await o.json();this.showComponentToast("error","Error",e.error||`Failed to ${n} container`),a.classList.remove("is-loading"),a.disabled=!1}}catch(o){console.error(`Error during ${n}:`,o),this.showComponentToast("error","Error",`Failed to ${n} container`),a.classList.remove("is-loading"),a.disabled=!1}}},openTaskManagement:function(){this.loadTaskManagement();const t=document.querySelector(e.taskManagementContainer);t&&t.scrollIntoView({behavior:"smooth"})},loadTaskManagement:function(){const t=document.querySelector(e.taskManagementContainer);t&&(t.innerHTML='\n                <div class="text-center py-4">\n                    <div class="c-loading-spinner" role="status"></div>\n                    <p class="c-loading-text">Loading task management...</p>\n                </div>\n            ',this.fetchTaskList())},fetchTaskList:async function(){const n=document.querySelector(e.taskManagementContainer);if(n)try{const e=await fetch(t.taskManagement),a=await e.json();a.success?this.renderTaskManagement(a):n.innerHTML=`\n                        <div class="alert alert-warning" role="alert">\n                            <i class="ti ti-alert-triangle me-2"></i>\n                            ${a.error||"Unable to load task management"}\n                        </div>\n                    `}catch(a){console.error("Error fetching task management:",a),n.innerHTML='\n                    <div class="alert alert-danger" role="alert">\n                        <i class="ti ti-alert-circle me-2"></i>\n                        Failed to load task management\n                    </div>\n                '}},renderTaskManagement:function(t){var n,a,o;const s=document.querySelector(e.taskManagementContainer);if(!s)return;const i=t.statistics||{},r=t.active_tasks||[],c=`\n                <div class="row mb-4">\n                    <div class="col-md-3">\n                        <div class="c-stat-card c-stat-card--primary">\n                            <div class="c-stat-card__value">${i.total_active||0}</div>\n                            <div class="c-stat-card__label">Active Tasks</div>\n                            <div class="c-stat-card__icon"><i class="ti ti-activity"></i></div>\n                        </div>\n                    </div>\n                    <div class="col-md-3">\n                        <div class="c-stat-card c-stat-card--success">\n                            <div class="c-stat-card__value">${(null==(n=i.by_status)?void 0:n.SUCCESS)||0}</div>\n                            <div class="c-stat-card__label">Completed</div>\n                            <div class="c-stat-card__icon"><i class="ti ti-check"></i></div>\n                        </div>\n                    </div>\n                    <div class="col-md-3">\n                        <div class="c-stat-card c-stat-card--danger">\n                            <div class="c-stat-card__value">${(null==(a=i.by_status)?void 0:a.FAILURE)||0}</div>\n                            <div class="c-stat-card__label">Failed</div>\n                            <div class="c-stat-card__icon"><i class="ti ti-x"></i></div>\n                        </div>\n                    </div>\n                    <div class="col-md-3">\n                        <div class="c-stat-card c-stat-card--warning">\n                            <div class="c-stat-card__value">${(null==(o=i.by_status)?void 0:o.PENDING)||0}</div>\n                            <div class="c-stat-card__label">Pending</div>\n                            <div class="c-stat-card__icon"><i class="ti ti-clock"></i></div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="c-table-wrapper">\n                    <table class="c-table c-table--hover c-table--striped">\n                        <thead class="c-table__head">\n                            <tr>\n                                <th class="c-table__header">Task ID</th>\n                                <th class="c-table__header">Type</th>\n                                <th class="c-table__header">User</th>\n                                <th class="c-table__header">Status</th>\n                                <th class="c-table__header">Progress</th>\n                                <th class="c-table__header">Created</th>\n                                <th class="c-table__header">Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody class="c-table__body">\n                            ${r.length>0?r.map(e=>this.renderTaskRow(e)).join(""):'<tr><td colspan="7" class="text-center c-text-muted py-4">No active tasks</td></tr>'}\n                        </tbody>\n                    </table>\n                </div>\n            `;s.innerHTML=c},renderTaskRow:function(e){const t=this.getStatusColor(e.celery_state||e.status);return`\n                <tr class="c-table__row ${"REVOKED"===e.celery_state?"is-muted":""}">\n                    <td class="c-table__cell" data-label="Task ID">\n                        <code class="c-code">${e.task_id.substring(0,8)}...</code>\n                        ${"REVOKED"===e.celery_state?'<small class="c-text-muted">CANCELLED</small>':""}\n                    </td>\n                    <td class="c-table__cell" data-label="Type">\n                        <span class="c-badge c-badge--secondary">${e.task_type||"unknown"}</span>\n                    </td>\n                    <td class="c-table__cell" data-label="User">${e.user_id||"N/A"}</td>\n                    <td class="c-table__cell" data-label="Status">\n                        <span class="c-badge c-badge--${t}">\n                            ${e.celery_state||e.status||"UNKNOWN"}\n                        </span>\n                    </td>\n                    <td class="c-table__cell" data-label="Progress">\n                        <div class="c-progress">\n                            <div class="c-progress__bar c-progress__bar--${t}"\n                                 role="progressbar"\n                                 aria-valuenow="${e.progress||0}"\n                                 aria-valuemin="0" aria-valuemax="100"\n                                 style="width: ${e.progress||0}%">\n                                ${e.progress||0}%\n                            </div>\n                        </div>\n                        ${e.stage?`<small class="c-text-muted">${e.stage}</small>`:""}\n                    </td>\n                    <td class="c-table__cell" data-label="Created">\n                        <small>${e.created_at?new Date(e.created_at).toLocaleString():"N/A"}</small>\n                    </td>\n                    <td class="c-table__cell" data-label="Actions">\n                        <div class="c-button-group c-button-group--sm">\n                            ${["PENDING","PROGRESS","STARTED"].includes(e.celery_state)?`<button class="btn btn-outline-danger btn-sm" data-action="revoke-task" data-task-id="${e.task_id}" title="DESTROY Task (Nuclear Option)">\n                                    <i class="ti ti-bomb"></i>\n                                </button>`:""}\n                            ${["REVOKED","FAILURE","SUCCESS"].includes(e.celery_state)?`<button class="btn btn-outline-secondary btn-sm" data-action="remove-task" data-task-id="${e.task_id}" title="Remove from List">\n                                    <i class="ti ti-trash"></i> <span>Clear</span>\n                                </button>`:""}\n                            <button class="btn btn-outline-primary btn-sm" data-action="view-task-details" data-task-id="${e.task_id}" title="View Details">\n                                <i class="ti ti-eye"></i>\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `},getStatusColor:function(e){return{SUCCESS:"success",FAILURE:"danger",PENDING:"warning",STARTED:"primary",PROGRESS:"primary",REVOKED:"dark"}[e]||"light"},revokeTask:async function(e){if((await Swal.fire({title:"DESTROY Task?",html:'\n                    <div class="text-start">\n                        <p class="text-warning"><strong>âš ï¸ WARNING: Nuclear Option</strong></p>\n                        <p>This will completely <strong>DESTROY</strong> the task:</p>\n                        <ul class="text-start">\n                            <li>Terminate the running process</li>\n                            <li>Remove all Redis data</li>\n                            <li>Purge from all tracking systems</li>\n                            <li>Cannot be undone</li>\n                        </ul>\n                        <p class="text-danger"><strong>Are you absolutely sure?</strong></p>\n                    </div>\n                ',icon:"warning",showCancelButton:!0,confirmButtonColor:this.getThemeColor("danger","#dc3545"),cancelButtonColor:this.getThemeColor("secondary","#6c757d"),confirmButtonText:"ðŸ’¥ DESTROY IT",cancelButtonText:"No, keep it",width:"500px"})).isConfirmed)try{const n=await fetch(`${t.revokeTask}${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCsrfToken()}}),a=await n.json();a.success?(Swal.fire({title:"DESTROYED! ðŸ’¥",text:"The task has been completely obliterated.",icon:"success",timer:3e3,showConfirmButton:!1}),setTimeout(()=>this.refreshTaskList(),1e3)):Swal.fire({title:"Error!",text:a.error||"Failed to destroy task",icon:"error"})}catch(n){console.error("Error destroying task:",n),Swal.fire({title:"Error!",text:"Failed to destroy task",icon:"error"})}},viewTaskDetails:async function(e){try{const n=await fetch(`${t.taskDetails}${e}`),a=await n.json();if(a.success){const e=a.task,t=`\n                        <div class="text-start">\n                            <p><strong>Task ID:</strong> <code>${e.task_id}</code></p>\n                            <p><strong>Type:</strong> <span class="c-badge c-badge--secondary">${e.task_type||"N/A"}</span></p>\n                            <p><strong>Status:</strong> <span class="c-badge c-badge--${this.getStatusColor(e.celery_state||e.status)}">${e.celery_state||e.status||"N/A"}</span></p>\n                            <p><strong>Progress:</strong> ${e.progress||0}%</p>\n                            <p><strong>Stage:</strong> ${e.stage||"N/A"}</p>\n                            <p><strong>Created:</strong> ${e.created_at?new Date(e.created_at).toLocaleString():"N/A"}</p>\n                            ${e.message?`<p><strong>Message:</strong> ${e.message}</p>`:""}\n                        </div>\n                    `;Swal.fire({title:"Task Details",html:t,icon:"info",width:"600px",confirmButtonText:"Close"})}else Swal.fire({title:"Error!",text:a.error||"Failed to load task details",icon:"error"})}catch(n){console.error("Error fetching task details:",n),Swal.fire({title:"Error!",text:"Failed to load task details",icon:"error"})}},removeTask:async function(e){if((await Swal.fire({title:"Remove Task?",text:"This will remove the task from the list. Are you sure?",icon:"question",showCancelButton:!0,confirmButtonColor:this.getThemeColor("secondary","#6c757d"),cancelButtonColor:this.getThemeColor("danger","#dc3545"),confirmButtonText:"Yes, remove it",cancelButtonText:"Cancel"})).isConfirmed)try{const n=await fetch(`${t.removeTask}${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCsrfToken()}}),a=await n.json();a.success?(Swal.fire({title:"Removed!",text:"The task has been removed from the list.",icon:"success",timer:2e3,showConfirmButton:!1}),setTimeout(()=>this.refreshTaskList(),500)):Swal.fire({title:"Error!",text:a.error||"Failed to remove task",icon:"error"})}catch(n){console.error("Error removing task:",n),Swal.fire({title:"Error!",text:"Failed to remove task",icon:"error"})}},cleanupOldTasks:async function(){if((await Swal.fire({title:"Cleanup Old Tasks?",html:'\n                    <div class="text-start">\n                        <p>This will remove:</p>\n                        <ul class="text-start">\n                            <li>TaskManager entries older than 24 hours</li>\n                            <li>Celery metadata older than 7 days</li>\n                            <li>Improves Redis performance</li>\n                        </ul>\n                        <p class="text-muted"><small>Recent tasks will be preserved</small></p>\n                    </div>\n                ',icon:"question",showCancelButton:!0,confirmButtonColor:this.getThemeColor("warning","#ffc107"),cancelButtonColor:this.getThemeColor("secondary","#6c757d"),confirmButtonText:"ðŸ§¹ Clean Up",cancelButtonText:"Cancel"})).isConfirmed)try{const e=await fetch(t.cleanupTasks,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCsrfToken()}}),n=await e.json();n.success?(Swal.fire({title:"Cleanup Complete! ðŸ§¹",html:`\n                            <div class="text-start">\n                                <p><strong>Cleaned up:</strong></p>\n                                <ul>\n                                    <li>Registry: ${n.registry_cleaned} tasks</li>\n                                    <li>Metadata: ${n.metadata_cleaned} keys</li>\n                                    <li><strong>Total: ${n.total_cleaned} items</strong></li>\n                                </ul>\n                            </div>\n                        `,icon:"success",timer:4e3,showConfirmButton:!1}),setTimeout(()=>this.refreshTaskList(),1e3)):Swal.fire({title:"Error!",text:n.error||"Failed to cleanup tasks",icon:"error"})}catch(e){console.error("Error cleaning up tasks:",e),Swal.fire({title:"Error!",text:"Failed to cleanup tasks",icon:"error"})}},refreshTaskList:function(){this.fetchTaskList()},getCsrfToken:function(){var e,t;return(null==(e=document.querySelector('input[name="csrf_token"]'))?void 0:e.value)||(null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.getAttribute("content"))||""},getThemeColor:function(e,t){return"undefined"!=typeof ECSTheme&&ECSTheme.getColor?ECSTheme.getColor(e):t},showComponentToast:function(e,t,n){var a;(null==(a=window.ModernComponents)?void 0:a.Toast)&&window.ModernComponents.Toast.show({type:e,title:t,message:n,duration:5e3})},showToast:function(t,n,a){const o=document.querySelector(e.toastContainer);if(!o)return;const s="toast-"+Date.now(),i=`\n                <div id="${s}" class="toast align-items-center border-0 bg-${a} text-white" role="alert" aria-live="assertive" aria-atomic="true">\n                    <div class="d-flex">\n                        <div class="toast-body">\n                            <strong>${t}:</strong> ${n}\n                        </div>\n                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                    </div>\n                </div>\n            `;o.insertAdjacentHTML("beforeend",i);const r=document.getElementById(s);r&&"undefined"!=typeof bootstrap&&(new bootstrap.Toast(r,{autohide:!0,delay:5e3}).show(),r.addEventListener("hidden.bs.toast",function(){r.remove()}))}};void 0!==window.InitSystem?window.InitSystem.register("AdminDashboard",{priority:50,init:function(e){n.init(e)}}):document.addEventListener("DOMContentLoaded",function(){n.init(document)}),window.AdminDashboard=n}(),function(){function e(e,t,n){const a=document.getElementById("edit_category_id"),o=document.getElementById("edit_category_name"),s=document.getElementById("edit_category_description");a&&(a.value=e),o&&(o.value=t),s&&(s.value=n||""),document.getElementById("editCategoryModal")&&ModalManager.show("editCategoryModal")}function t(e,t,n,a){Swal.fire({title:"Delete Category?",text:`Are you sure you want to delete "${t}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("info"):"#3085d6",confirmButtonText:"Yes, delete it!"}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=n;const o=document.createElement("input");o.type="hidden",o.name="csrf_token",o.value=a;const s=document.createElement("input");s.type="hidden",s.name="category_id",s.value=e,t.appendChild(o),t.appendChild(s),document.body.appendChild(t),t.submit()}})}function n(t){e(t.target.dataset.categoryId,t.target.dataset.categoryName,t.target.dataset.categoryDescription)}function a(e){t(e.target.dataset.categoryId,e.target.dataset.categoryName,e.target.dataset.deleteUrl,e.target.dataset.csrfToken)}function o(){document.getElementById("editCategoryModal")&&(console.log("[Message Categories] Initializing..."),"undefined"!=typeof EventDelegation?(EventDelegation.register("edit-category",n,{preventDefault:!0}),EventDelegation.register("delete-category",a,{preventDefault:!0})):console.error("[Message Categories] EventDelegation not available"),console.log("[Message Categories] Initialization complete"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o(),window.MessageCategories={version:"1.0.0",editCategory:e,deleteCategory:t,init:o}}(),function(){function e(e,t,n){const a=document.getElementById("view_template_title"),o=document.getElementById("view_template_content");a&&(a.textContent=t),o&&(o.textContent=n),document.getElementById("viewTemplateModal")&&ModalManager.show("viewTemplateModal")}function t(e,t,n,a,o,s,i){const r=document.getElementById("edit_template_id"),c=document.getElementById("edit_template_name"),l=document.getElementById("edit_template_description"),d=document.getElementById("edit_template_content"),u=document.getElementById("edit_channel_type"),m=document.getElementById("edit_usage_context"),p=document.getElementById("edit_template_active");r&&(r.value=e),c&&(c.value=t),l&&(l.value=n||""),d&&(d.value=a),u&&(u.value=o||""),m&&(m.value=s||""),p&&(p.checked=i),document.getElementById("editTemplateModal")&&ModalManager.show("editTemplateModal")}function n(e,t,n,a,o){const s=n?"deactivate":"activate",i=!n;Swal.fire({title:`${s.charAt(0).toUpperCase()+s.slice(1)} Template?`,text:`Are you sure you want to ${s} "${t}"?`,icon:"question",showCancelButton:!0,confirmButtonColor:i?getComputedStyle(document.documentElement).getPropertyValue("--ecs-success").trim()||"#198754":getComputedStyle(document.documentElement).getPropertyValue("--ecs-warning").trim()||"#ffc107",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):getComputedStyle(document.documentElement).getPropertyValue("--ecs-neutral-50").trim()||"#6c757d",confirmButtonText:`Yes, ${s} it!`}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=a;const n=document.createElement("input");n.type="hidden",n.name="csrf_token",n.value=o;const s=document.createElement("input");s.type="hidden",s.name="template_id",s.value=e,t.appendChild(n),t.appendChild(s),document.body.appendChild(t),t.submit()}})}function a(e,t,n,a){Swal.fire({title:"Delete Template?",text:`Are you sure you want to delete "${t}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):getComputedStyle(document.documentElement).getPropertyValue("--ecs-danger").trim()||"#dc3545",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("info"):getComputedStyle(document.documentElement).getPropertyValue("--ecs-info").trim()||"#0dcaf0",confirmButtonText:"Yes, delete it!"}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=n;const o=document.createElement("input");o.type="hidden",o.name="csrf_token",o.value=a;const s=document.createElement("input");s.type="hidden",s.name="template_id",s.value=e,t.appendChild(o),t.appendChild(s),document.body.appendChild(t),t.submit()}})}function o(e,t){const n=document.getElementById(t);if(!n)return;const a=n.selectionStart,o=n.selectionEnd,s=n.value;n.value=s.substring(0,a)+e+s.substring(o);const i=a+e.length;n.setSelectionRange(i,i),n.focus()}function s(e){window.history.back()}function i(t){t.target.dataset.templateId,e(0,t.target.dataset.templateName,t.target.dataset.templateContent)}function r(e){t(e.target.dataset.templateId,e.target.dataset.templateName,e.target.dataset.templateDescription,e.target.dataset.templateContent,e.target.dataset.templateChannel,e.target.dataset.templateContext,"true"===e.target.dataset.templateActive)}function c(e){n(e.target.dataset.templateId,e.target.dataset.templateName,"true"===e.target.dataset.templateActive,e.target.dataset.toggleUrl,e.target.dataset.csrfToken)}function l(e){a(e.target.dataset.templateId,e.target.dataset.templateName,e.target.dataset.deleteUrl,e.target.dataset.csrfToken)}function d(){(document.getElementById("viewTemplateModal")||document.getElementById("editTemplateModal"))&&(console.log("[Template Detail] Initializing..."),"undefined"!=typeof EventDelegation?(EventDelegation.register("go-back",s,{preventDefault:!0}),EventDelegation.register("view-template",i,{preventDefault:!0}),EventDelegation.register("edit-template",r,{preventDefault:!0}),EventDelegation.register("toggle-template",c,{preventDefault:!0}),EventDelegation.register("delete-template",l,{preventDefault:!0})):console.error("[Template Detail] EventDelegation not available"),document.addEventListener("click",function(e){const t=e.target.closest(".var-btn");if(!t)return;e.preventDefault();const n=t.dataset.var;let a=t.dataset.target||"template_content";const s=document.getElementById("editTemplateModal"),i=document.getElementById("createTemplateModal");s&&s.classList.contains("show")?a="edit_template_content":i&&i.classList.contains("show")&&(a="template_content"),o(n,a),t.classList.add("inserted"),setTimeout(()=>t.classList.remove("inserted"),300)}),console.log("[Template Detail] Initialization complete"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d(),window.MessageTemplateDetail={version:"1.1.0",viewTemplate:e,editTemplate:t,toggleTemplate:n,deleteTemplate:a,insertVariable:o,init:d}}(),function(){const e={baseUrl:window.CAMPAIGNS_BASE_URL||"/admin-panel",csrfToken:window.CAMPAIGNS_CSRF_TOKEN||""};async function t(t){try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}`),a=await n.json();a.success&&Swal.fire({title:a.campaign.name,html:`\n                        <div class="text-start">\n                            <p><strong>Title:</strong> ${a.campaign.title}</p>\n                            <p><strong>Body:</strong> ${a.campaign.body}</p>\n                            <p><strong>Target:</strong> ${a.campaign.target_type}</p>\n                            <p><strong>Status:</strong> ${a.campaign.status}</p>\n                        </div>\n                    `,width:600})}catch(n){Swal.fire("Error","Failed to load campaign details","error")}}async function n(t){try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}`);(await n.json()).success&&(window.location.href=`${e.baseUrl}/communication/campaigns/${t}/edit`)}catch(n){Swal.fire("Error","Failed to load campaign for editing","error")}}async function a(t,n){if((await Swal.fire({title:"Send Campaign Now?",text:`Send "${n}" to all targeted users immediately?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send it!",cancelButtonText:"Cancel"})).isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}/send`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken}}),a=await n.json();a.success?Swal.fire("Sent!",a.message,"success").then(()=>location.reload()):Swal.fire("Error",a.message,"error")}catch(a){Swal.fire("Error","Failed to send campaign","error")}}async function o(t,n){const a=await Swal.fire({title:"Schedule Campaign",html:'\n                <div class="text-start">\n                    <label class="form-label">Schedule Time</label>\n                    <input type="datetime-local" id="scheduleTime" class="form-control">\n                </div>\n            ',showCancelButton:!0,confirmButtonText:"Schedule",preConfirm:()=>{const e=document.getElementById("scheduleTime").value;return e?{scheduleTime:e}:(Swal.showValidationMessage("Please select a time"),!1)}});if(a.isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}/schedule`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken},body:JSON.stringify({scheduled_send_time:a.value.scheduleTime})}),o=await n.json();o.success?Swal.fire("Scheduled!",o.message,"success").then(()=>location.reload()):Swal.fire("Error",o.message,"error")}catch(o){Swal.fire("Error","Failed to schedule campaign","error")}}async function s(t,n){if((await Swal.fire({title:"Delete Campaign?",text:`Delete "${n}"? This cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken}}),a=await n.json();a.success?Swal.fire("Deleted!",a.message,"success").then(()=>location.reload()):Swal.fire("Error",a.message,"error")}catch(a){Swal.fire("Error","Failed to delete campaign","error")}}async function i(t,n){if((await Swal.fire({title:"Cancel Campaign?",text:`Cancel scheduled campaign "${n}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, cancel it!"})).isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}/cancel`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken}}),a=await n.json();a.success?Swal.fire("Cancelled!",a.message,"success").then(()=>location.reload()):Swal.fire("Error",a.message,"error")}catch(a){Swal.fire("Error","Failed to cancel campaign","error")}}async function r(t,n){if((await Swal.fire({title:"Duplicate Campaign?",text:`Create a copy of "${n}"?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, duplicate it!"})).isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}/duplicate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken}}),a=await n.json();a.success?Swal.fire("Duplicated!",a.message,"success").then(()=>location.reload()):Swal.fire("Error",a.message,"error")}catch(a){Swal.fire("Error","Failed to duplicate campaign","error")}}function c(){var e;const t=null==(e=document.getElementById("campaign_target_type"))?void 0:e.value;if(!t)return;["campaignTeamSelector","campaignLeagueSelector","campaignRoleSelector","campaignPoolSelector","campaignGroupSelector"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.add("d-none")});const n={team:"campaignTeamSelector",league:"campaignLeagueSelector",role:"campaignRoleSelector",pool:"campaignPoolSelector",group:"campaignGroupSelector"}[t];if(n){const e=document.getElementById(n);e&&e.classList.remove("d-none")}}function l(){var e;const t=null==(e=document.querySelector('input[name="send_type"]:checked'))?void 0:e.value,n=document.getElementById("campaignScheduleContainer");n&&("scheduled"===t?n.classList.remove("d-none"):n.classList.add("d-none"))}function d(e){window.history.back()}function u(e){t(e.target.dataset.campaignId)}function m(e){n(e.target.dataset.campaignId)}function p(e){a(e.target.dataset.campaignId,e.target.dataset.campaignName)}function h(e){o(e.target.dataset.campaignId,e.target.dataset.campaignName)}function g(e){s(e.target.dataset.campaignId,e.target.dataset.campaignName)}function f(e){i(e.target.dataset.campaignId,e.target.dataset.campaignName)}function v(e){r(e.target.dataset.campaignId,e.target.dataset.campaignName)}function y(){if(!document.querySelector('[data-action*="campaign"]'))return;console.log("[Push Campaigns] Initializing..."),"undefined"!=typeof EventDelegation?(EventDelegation.register("go-back",d,{preventDefault:!0}),EventDelegation.register("view-campaign",u,{preventDefault:!0}),EventDelegation.register("edit-campaign",m,{preventDefault:!0}),EventDelegation.register("send-campaign",p,{preventDefault:!0}),EventDelegation.register("schedule-campaign",h,{preventDefault:!0}),EventDelegation.register("delete-campaign",g,{preventDefault:!0}),EventDelegation.register("cancel-campaign",f,{preventDefault:!0}),EventDelegation.register("duplicate-campaign",v,{preventDefault:!0})):console.error("[Push Campaigns] EventDelegation not available");const e=document.getElementById("campaign_target_type");e&&(e.addEventListener("change",c),c()),document.querySelectorAll('input[name="send_type"]').forEach(e=>{e.addEventListener("change",l)}),l(),console.log("[Push Campaigns] Initialization complete")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y(),window.PushCampaigns={version:"1.0.0",viewCampaign:t,editCampaign:n,sendCampaign:a,scheduleCampaign:o,deleteCampaign:s,cancelCampaign:i,duplicateCampaign:r,init:y}}(),function(){const e={ENDPOINTS:{MESSAGE_DETAILS:"/admin-panel/communication/scheduled-messages/{id}/details",MESSAGE_UPDATE:"/admin-panel/communication/scheduled-messages/{id}/update"}};function t(){var e,t,n,a,o;const s=null==(e=document.getElementById("message_title"))?void 0:e.value,i=null==(t=document.getElementById("message_content"))?void 0:t.value,r=null==(n=document.getElementById("message_type"))?void 0:n.value,c=null==(a=document.getElementById("target_channel"))?void 0:a.value,l=null==(o=document.getElementById("schedule_date"))?void 0:o.value;if(!(s&&i&&r&&c))return void Swal.fire("Error","Please fill in all required fields before previewing","error");const d=document.getElementById("preview_title"),u=document.getElementById("preview_content"),m=document.getElementById("preview_type"),p=document.getElementById("preview_channel"),h=document.getElementById("preview_schedule");d&&(d.textContent=s),u&&(u.textContent=i),m&&(m.textContent=r),p&&(p.textContent=c),h&&(h.textContent=l||"Not set"),document.getElementById("messagePreviewModal")&&ModalManager.show("messagePreviewModal")}function n(t,n){const a=document.getElementById("message_details_title"),o=document.getElementById("message_details_content");a&&(a.textContent=`Details for "${n}"`),o&&(o.innerHTML='<div class="text-center"><div class="spinner-border" role="status"></div></div>'),document.getElementById("messageDetailsModal")&&ModalManager.show("messageDetailsModal");const s=e.ENDPOINTS.MESSAGE_DETAILS.replace("{id}",t);fetch(s).then(e=>e.json()).then(e=>{e.success&&o?o.innerHTML=e.html:o&&(o.innerHTML='<div class="alert alert-danger">Error loading message details</div>')}).catch(()=>{o&&(o.innerHTML='<div class="alert alert-danger">Error loading message details</div>')})}function a(t){const n=e.ENDPOINTS.MESSAGE_DETAILS.replace("{id}",t);fetch(n).then(e=>e.json()).then(n=>{if(n.success){const a=n.message,o=a.scheduled_send_time?a.scheduled_send_time.slice(0,16):"";Swal.fire({title:"Edit Scheduled Message",html:`\n                            <div class="text-start">\n                                <div class="mb-3">\n                                    <label class="form-label">Message Type</label>\n                                    <select id="editMessageType" class="form-select">\n                                        <option value="standard" ${"standard"===a.message_type?"selected":""}>Standard</option>\n                                        <option value="announcement" ${"announcement"===a.message_type?"selected":""}>Announcement</option>\n                                        <option value="reminder" ${"reminder"===a.message_type?"selected":""}>Reminder</option>\n                                        <option value="notification" ${"notification"===a.message_type?"selected":""}>Notification</option>\n                                        <option value="alert" ${"alert"===a.message_type?"selected":""}>Alert</option>\n                                    </select>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Scheduled Time <span class="text-danger">*</span></label>\n                                    <input type="datetime-local" id="editScheduledTime" class="form-control" value="${o}">\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Match ID</label>\n                                    <input type="text" class="form-control" value="${a.match_id||"N/A"}" disabled>\n                                    <small class="text-muted">Match ID cannot be changed</small>\n                                </div>\n                            </div>\n                        `,showCancelButton:!0,confirmButtonText:"Save Changes",cancelButtonText:"Cancel",preConfirm:()=>{var e,t;const n=null==(e=document.getElementById("editScheduledTime"))?void 0:e.value;return n?{message_type:null==(t=document.getElementById("editMessageType"))?void 0:t.value,scheduled_time:n}:(Swal.showValidationMessage("Scheduled time is required"),!1)}}).then(n=>{if(n.isConfirmed){const a=new FormData;a.append("message_type",n.value.message_type),a.append("scheduled_time",n.value.scheduled_time);const o=e.ENDPOINTS.MESSAGE_UPDATE.replace("{id}",t);fetch(o,{method:"POST",body:a}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Success",e.message,"success").then(()=>location.reload()):Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to update message","error"))}})}else Swal.fire("Error",n.message,"error")}).catch(()=>Swal.fire("Error","Failed to load message details","error"))}function o(e,t,n,a){Swal.fire({title:"Cancel Scheduled Message?",text:`Cancel the scheduled message "${t}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"var(--ecs-danger)",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):"#6c757d",confirmButtonText:"Yes, cancel it!"}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=n;const o=document.createElement("input");o.type="hidden",o.name="csrf_token",o.value=a;const s=document.createElement("input");s.type="hidden",s.name="message_id",s.value=e,t.appendChild(o),t.appendChild(s),document.body.appendChild(t),t.submit()}})}function s(e,t,n,a){Swal.fire({title:"Retry Scheduled Message?",text:`Retry sending the failed message "${t}"?`,icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"var(--ecs-success)",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):"#6c757d",confirmButtonText:"Yes, retry!"}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=n;const o=document.createElement("input");o.type="hidden",o.name="csrf_token",o.value=a;const s=document.createElement("input");s.type="hidden",s.name="message_id",s.value=e,t.appendChild(o),t.appendChild(s),document.body.appendChild(t),t.submit()}})}function i(e){window.history.back()}function r(e){t()}function c(e){n(e.target.dataset.messageId,e.target.dataset.title)}function l(e){a(e.target.dataset.messageId)}function d(e){o(e.target.dataset.messageId,e.target.dataset.title,e.target.dataset.cancelUrl,e.target.dataset.csrfToken)}function u(e){s(e.target.dataset.messageId,e.target.dataset.title,e.target.dataset.retryUrl,e.target.dataset.csrfToken)}function m(){(document.getElementById("messagePreviewModal")||document.getElementById("messageDetailsModal"))&&(console.log("[Scheduled Messages] Initializing..."),function(){const e=document.getElementById("is_recurring"),t=document.getElementById("recurrence_options"),n=document.getElementById("recurrence_pattern");e&&t&&(e.addEventListener("change",function(){this.checked?(t.classList.remove("u-hidden"),n&&(n.required=!0)):(t.classList.add("u-hidden"),n&&(n.required=!1))}),e.checked?(t.classList.remove("u-hidden"),n&&(n.required=!0)):(t.classList.add("u-hidden"),n&&(n.required=!1)))}(),document.querySelectorAll('input[name="queue_filter"]').forEach(e=>{e.addEventListener("change",function(){const e=this.id.replace("filter_","");document.querySelectorAll(".message-row").forEach(t=>{const n=t.dataset.status;"all"===e||n===e?t.classList.remove("u-hidden"):t.classList.add("u-hidden")})})}),function(){const e=document.getElementById("schedule_date");if(!e)return;const t=new Date,n=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}T${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`;e.min=n}(),"undefined"!=typeof EventDelegation?(EventDelegation.register("go-back",i,{preventDefault:!0}),EventDelegation.register("preview-message",r,{preventDefault:!0}),EventDelegation.register("view-scheduled-message",c,{preventDefault:!0}),EventDelegation.register("edit-scheduled-message",l,{preventDefault:!0}),EventDelegation.register("cancel-scheduled-message",d,{preventDefault:!0}),EventDelegation.register("retry-scheduled-message",u,{preventDefault:!0})):console.error("[Scheduled Messages] EventDelegation not available"),console.log("[Scheduled Messages] Initialization complete"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m(),window.ScheduledMessages={version:"1.0.0",previewMessage:t,viewScheduledMessage:n,editScheduledMessage:a,cancelScheduledMessage:o,retryScheduledMessage:s,init:m}}(),(document.getElementById("matchStatusChart")||document.getElementById("matchesPerWeekChart")||document.querySelector('[data-action^="generate-"][data-action*="report"]')||document.querySelector('[data-action^="export-"]'))&&(document.addEventListener("DOMContentLoaded",function(){!function(){const e=document.getElementById("matchStatusChart"),t=document.getElementById("matchesPerWeekChart");e&&new Chart(e.getContext("2d"),{type:"doughnut",data:{labels:["Completed","Upcoming","Live","Cancelled"],datasets:[{data:[parseInt(e.dataset.completed||0),parseInt(e.dataset.pending||0),parseInt(e.dataset.live||0),parseInt(e.dataset.cancelled||0)],backgroundColor:[getComputedStyle(document.documentElement).getPropertyValue("--color-success")||"#28a745",getComputedStyle(document.documentElement).getPropertyValue("--color-warning")||"#ffc107",getComputedStyle(document.documentElement).getPropertyValue("--color-primary")||"#007bff",getComputedStyle(document.documentElement).getPropertyValue("--color-danger")||"#dc3545"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),t&&new Chart(t.getContext("2d"),{type:"line",data:{labels:["Week 1","Week 2","Week 3","Week 4","Week 5","Week 6"],datasets:[{label:"Matches Played",data:[12,19,3,5,2,15],borderColor:getComputedStyle(document.documentElement).getPropertyValue("--color-primary")||"#007bff",backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}()}),EventDelegation.register("generate-match-report",function(e,t){!function(e=null){console.log("Generate match report:",e)}(e.dataset.matchId)},{preventDefault:!0}),EventDelegation.register("generate-league-report",function(e,t){console.log("Generate league report")},{preventDefault:!0}),EventDelegation.register("generate-team-report",function(e,t){!function(e=null){console.log("Generate team report:",e)}(e.dataset.teamId)},{preventDefault:!0}),EventDelegation.register("generate-custom-report",function(e,t){console.log("Generate custom report")},{preventDefault:!0}),EventDelegation.register("view-recent-matches",function(e,t){window.location.href="/admin-panel/matches/recent"},{preventDefault:!0}),EventDelegation.register("view-upcoming-matches",function(e,t){window.location.href="/admin-panel/matches/upcoming"},{preventDefault:!0}),EventDelegation.register("view-top-scorers",function(e,t){console.log("View top scorers")},{preventDefault:!0}),EventDelegation.register("view-league-standings",function(e,t){window.location.href="/admin-panel/match-operations/league-standings"},{preventDefault:!0}),EventDelegation.register("export-pdf",function(e,t){window.open("/admin/match-operations/reports/export?format=pdf","_blank")},{preventDefault:!0}),EventDelegation.register("export-excel",function(e,t){window.open("/admin/match-operations/reports/export?format=excel","_blank")},{preventDefault:!0}),EventDelegation.register("export-csv",function(e,t){window.open("/admin/match-operations/reports/export?format=csv","_blank")},{preventDefault:!0}),EventDelegation.register("schedule-report",function(e,t){console.log("Schedule report")},{preventDefault:!0}),EventDelegation.register("view-match-report",function(e,t){!function(e){window.location.href=`/admin/match-operations/match/${e}/report`}(e.dataset.matchId)},{preventDefault:!0}),EventDelegation.register("view-team-report",function(e,t){!function(e){window.location.href=`/admin/match-operations/team/${e}/report`}(e.dataset.teamId)},{preventDefault:!0}),EventDelegation.register("view-all-matches",function(e,t){window.location.href="/admin-panel/matches"},{preventDefault:!0})),function(){function e(){Swal.fire({title:"Create New Season",html:'\n      <div class="text-start">\n        <div class="mb-3">\n          <label class="form-label">Season Name <span class="text-danger">*</span></label>\n          <input type="text" id="seasonName" class="form-control" placeholder="e.g., Spring 2025" data-form-control>\n        </div>\n        <div class="mb-3">\n          <label class="form-label">Start Date</label>\n          <input type="date" id="seasonStartDate" class="form-control" data-form-control>\n        </div>\n        <div class="mb-3">\n          <label class="form-label">End Date</label>\n          <input type="date" id="seasonEndDate" class="form-control" data-form-control>\n        </div>\n        <div class="form-check">\n          <input type="checkbox" id="seasonIsCurrent" class="form-check-input">\n          <label class="form-check-label" for="seasonIsCurrent">Set as current season</label>\n        </div>\n      </div>\n    ',showCancelButton:!0,confirmButtonText:"Create Season",cancelButtonText:"Cancel",preConfirm:()=>{const e=document.getElementById("seasonName").value;return e?{name:e,start_date:document.getElementById("seasonStartDate").value,end_date:document.getElementById("seasonEndDate").value,is_current:document.getElementById("seasonIsCurrent").checked?"true":"false"}:(Swal.showValidationMessage("Season name is required"),!1)}}).then(e=>{e.isConfirmed&&function(e){var t;const n=new FormData;n.append("name",e.name),n.append("start_date",e.start_date),n.append("end_date",e.end_date),n.append("is_current",e.is_current);const a=(null==(t=document.querySelector("[data-create-season-url]"))?void 0:t.dataset.createSeasonUrl)||window.location.origin+"/admin-panel/match-operations/seasons/create";fetch(a,{method:"POST",body:n}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Success",e.message,"success").then(()=>location.reload()):Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to create season","error"))}(e.value)})}function t(e){fetch(`/admin-panel/match-operations/seasons/${e}/details`).then(e=>e.json()).then(t=>{t.success?function(e,t){Swal.fire({title:"Edit Season",html:`\n      <div class="text-start">\n        <div class="mb-3">\n          <label class="form-label">Season Name <span class="text-danger">*</span></label>\n          <input type="text" id="editSeasonName" class="form-control" value="${t.name}" data-form-control>\n        </div>\n        <div class="mb-3">\n          <label class="form-label">Start Date</label>\n          <input type="date" id="editSeasonStartDate" class="form-control" value="${t.start_date}" data-form-control>\n        </div>\n        <div class="mb-3">\n          <label class="form-label">End Date</label>\n          <input type="date" id="editSeasonEndDate" class="form-control" value="${t.end_date}" data-form-control>\n        </div>\n        <div class="form-check">\n          <input type="checkbox" id="editSeasonIsCurrent" class="form-check-input" ${t.is_current?"checked":""}>\n          <label class="form-check-label" for="editSeasonIsCurrent">Set as current season</label>\n        </div>\n      </div>\n    `,showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Save Changes",denyButtonText:"Delete Season",denyButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"var(--ecs-danger)",cancelButtonText:"Cancel",preConfirm:()=>{const e=document.getElementById("editSeasonName").value;return e?{name:e,start_date:document.getElementById("editSeasonStartDate").value,end_date:document.getElementById("editSeasonEndDate").value,is_current:document.getElementById("editSeasonIsCurrent").checked?"true":"false"}:(Swal.showValidationMessage("Season name is required"),!1)}}).then(n=>{n.isConfirmed?function(e,t){const n=new FormData;n.append("name",t.name),n.append("start_date",t.start_date),n.append("end_date",t.end_date),n.append("is_current",t.is_current),fetch(`/admin-panel/match-operations/seasons/${e}/update`,{method:"POST",body:n}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Success",e.message,"success").then(()=>location.reload()):Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to update season","error"))}(e,n.value):n.isDenied&&function(e,t){Swal.fire({title:"Delete Season?",text:`Are you sure you want to delete "${t}"? This cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"var(--ecs-danger)",cancelButtonText:"Cancel"}).then(t=>{t.isConfirmed&&function(e){fetch(`/admin-panel/match-operations/seasons/${e}/delete`,{method:"POST"}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Deleted",e.message,"success").then(()=>location.reload()):Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to delete season","error"))}(e)})}(e,t.name)})}(e,t.season):Swal.fire("Error",t.message,"error")}).catch(()=>Swal.fire("Error","Failed to load season details","error"))}function n(e){Swal.fire({title:"Set Current Season?",text:"This will make this season the active one for new leagues and matches.",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, set as current",cancelButtonText:"Cancel"}).then(t=>{t.isConfirmed&&function(e){var t;const n=(null==(t=document.querySelector("[data-set-current-season-url]"))?void 0:t.dataset.setCurrentSeasonUrl)||window.location.origin+"/admin-panel/match-operations/seasons/set-current";fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`season_id=${e}`}).then(e=>e.json()).then(e=>{e.success?Swal.fire({title:"Success",text:e.message,icon:"success"}).then(()=>{location.reload()}):Swal.fire({title:"Error",text:e.message,icon:"error"})}).catch(e=>{Swal.fire({title:"Error",text:"An error occurred while setting current season",icon:"error"})})}(e)})}(document.querySelector('[data-action="create-season"]')||document.querySelector('[data-action="view-season"]')||document.querySelector('[data-action="edit-season"]')||document.querySelector('[data-action="set-current-season"]')||document.querySelector("[data-create-season-url]"))&&(EventDelegation.register("create-season",function(t,n){e()},{preventDefault:!0}),EventDelegation.register("view-season",function(e,t){!function(e){fetch(`/admin-panel/match-operations/seasons/${e}/details`).then(e=>e.json()).then(e=>{if(e.success){const t=e.season;Swal.fire({title:t.name,html:`\n            <div class="text-start">\n              <p><strong>Start Date:</strong> ${t.start_date||"Not set"}</p>\n              <p><strong>End Date:</strong> ${t.end_date||"Not set"}</p>\n              <p><strong>Current Season:</strong> ${t.is_current?"Yes":"No"}</p>\n            </div>\n          `,icon:"info"})}else Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to load season details","error"))}(e.dataset.seasonId)},{preventDefault:!0}),EventDelegation.register("edit-season",function(e,n){t(e.dataset.seasonId)},{preventDefault:!0}),EventDelegation.register("set-current-season",function(e,t){n(e.dataset.seasonId)},{preventDefault:!0}))}(),b=window,S=document,"undefined"!=typeof InitSystem?(console.log("[App Init] Registering application components..."),InitSystem.register("page-loader",function(){setTimeout(function(){const e=S.getElementById("page-loader");e&&(e.classList.add("hidden"),setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},500))},800)},{priority:85,description:"Hide page loading animation",reinitializable:!1}),InitSystem.register("admin-utilities",function(e){const t=e||S;t.querySelectorAll("[data-width]").forEach(e=>{const t=e.dataset.width;t&&(e.style.width=t+"%")}),t.querySelectorAll("[data-theme-color]").forEach(e=>{const t=e.dataset.themeColor;t&&(e.style.backgroundColor=t)})},{priority:70,description:"Initialize admin utility helpers (progress bars, theme colors)",reinitializable:!0}),InitSystem.register("design-system-fixes",function(){if(!b.ECSDesignSystem)return;const e=ECSDesignSystem.setupCustomBehaviors;ECSDesignSystem.setupCustomBehaviors=function(){try{"function"==typeof e&&e.call(ECSDesignSystem)}catch(t){console.warn("[Design System Fix] Original setupCustomBehaviors failed, using safe version",t);try{"function"==typeof this.addRippleEffect&&this.addRippleEffect()}catch(n){console.warn("[Design System Fix] Error in addRippleEffect",n)}try{"function"==typeof this.improveKeyboardNavigation&&this.improveKeyboardNavigation()}catch(n){console.warn("[Design System Fix] Error in improveKeyboardNavigation",n)}try{"function"==typeof this.setupTransitions&&this.setupTransitions()}catch(n){console.warn("[Design System Fix] Error in setupTransitions",n)}}},setTimeout(function(){try{ECSDesignSystem.setupCustomBehaviors()}catch(e){console.error("[Design System Fix] Error in setupCustomBehaviors:",e)}},500)},{priority:30,description:"Apply design system CSS fixes and safe method overrides",reinitializable:!1}),InitSystem.register("dropdown-menu-fix",function(e){(e||S).querySelectorAll(".table").forEach(e=>{e.classList.add("user-management-table")}),b.location.href.includes("rsvp_status")&&S.body.classList.add("rsvp-status-page")},{priority:30,description:"Fix dropdown menu positioning and z-index issues",reinitializable:!0}),InitSystem.register("mobile-menu-fix",function(){const e=S.getElementById("layout-menu"),t=S.getElementById("close-icon");let n=S.querySelector(".layout-overlay");if(!n){const e=S.createElement("div");e.className="layout-overlay",S.body.appendChild(e),n=e}function a(){S.documentElement.classList.remove("layout-menu-expanded"),S.body.classList.remove("layout-menu-expanded"),e&&e.classList.remove("menu-open"),t&&t.classList.add("d-none")}function o(){S.documentElement.classList.contains("layout-menu-expanded")?a():(S.documentElement.classList.add("layout-menu-expanded"),S.body.classList.add("layout-menu-expanded"),e&&e.classList.add("menu-open"),t&&t.classList.remove("d-none"))}"undefined"!=typeof EventDelegation&&EventDelegation.register("toggle-mobile-menu",function(e,t){t.preventDefault(),o()},{preventDefault:!0}),"undefined"!=typeof EventDelegation&&EventDelegation.register("close-mobile-menu",function(e,t){t.preventDefault(),a()},{preventDefault:!0}),S.addEventListener("click",function(e){e.target.classList.contains("layout-overlay")&&S.documentElement.classList.contains("layout-menu-expanded")&&a()}),S.querySelectorAll(".menu-item a").forEach(e=>{e.removeAttribute("inert"),e.classList.add("pointer-events-auto")}),e&&(e.removeAttribute("inert"),e.classList.add("pointer-events-auto","user-select-auto","touch-action-auto")),(/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&(S.documentElement.classList.add("ios-device"),e&&e.classList.add("ios-overflow-scrolling"),S.querySelectorAll(".menu-link, .menu-toggle").forEach(e=>{e.addEventListener("touchstart",function(e){e.stopPropagation()},{passive:!0})}))},{priority:30,description:"Enhance mobile menu interactions and iOS compatibility",reinitializable:!1}),InitSystem.register("waitlist-register-focus",function(){const e=S.querySelector('a[href*="waitlist_discord_register"]');if(e&&(e.focus(),"undefined"!=typeof DiscordMembershipChecker)){const e=b.discordMembershipStatus;if(!0===e||"true"===e)return void console.log("[waitlist-register-focus] User already in Discord, skipping prompt");setTimeout(()=>{DiscordMembershipChecker.showJoinPrompt({title:"ðŸ’¡ Pro Tip: Join Discord First!",urgency:"info",showUrgentPopup:!0})},2e3)}},{priority:20,description:"Auto-focus Discord registration button and show membership prompts",reinitializable:!1}),console.log("[App Init] âœ… 7 components registered successfully"),console.log("[App Init] Run InitSystemDebug.printOrder() to view initialization order")):console.error("[App Init] InitSystem not loaded! Please include init-system.js before this file."),console.log("[Main Entry] All modules loaded successfully")}},function(){return t||(0,e[a(e)[0]])((t={exports:{}}).exports,t),t.exports});export default s();
//# sourceMappingURL=main-Bkx4snpk.js.map
