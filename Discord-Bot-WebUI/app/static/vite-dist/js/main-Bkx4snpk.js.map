{"version":3,"file":"main-Bkx4snpk.js","sources":["../../js/event-delegation.js","../../js/csrf-fetch.js","../../js/helpers-minimal.js","../../js/modal-manager.js","../../js/config.js","../../js/draft-history.js","../../js/sidebar-interactions.js","../../js/navbar-modern.js","../../js/simple-theme-switcher.js","../../js/admin-navigation.js","../../js/components-modern.js","../../js/responsive-system.js","../../js/ui-enhancements.js","../../js/mobile-gestures.js","../../js/mobile-keyboard.js","../../js/mobile-forms.js","../../js/mobile-haptics.js","../../js/responsive-tables.js","../../js/design-system.js","../../js/swal-contextual.js","../../js/chat-widget.js","../../js/messenger-widget.js","../../js/profile-wizard.js","../../js/draft-system.js","../../js/profile-verification.js","../../js/pitch-view.js","../../js/app-init-registration.js","../../js/admin-panel-base.js","../../js/admin-panel-dashboard.js","../../js/admin-panel-discord-bot.js","../../js/admin-panel-performance.js","../../js/admin/admin-dashboard.js","../../js/admin/message-categories.js","../../js/admin/message-template-detail.js","../../js/admin/push-campaigns.js","../../js/admin/scheduled-messages.js","../../js/match-operations/match-reports.js","../../js/match-operations/seasons.js","../../js/main-entry.js"],"sourcesContent":["/**\n * Centralized Event Delegation System\n *\n * Handles all interactive events for dynamic content across the application.\n * Uses event delegation to ensure event handlers work for elements added after page load\n * (via AJAX, HTMX, innerHTML, appendChild, etc.)\n *\n * @version 1.0.0\n * @author ECS Development Team\n * @date 2025-12-16\n *\n * USAGE:\n *\n * 1. In HTML, use data-action attributes:\n *    <button data-action=\"delete-match\" data-match-id=\"123\">Delete</button>\n *\n * 2. Register handler in JavaScript:\n *    EventDelegation.register('delete-match', function(element, event) {\n *        const matchId = element.dataset.matchId;\n *        // Handle delete\n *    });\n *\n * 3. Initialize (already done in this file):\n *    EventDelegation.init();\n */\n\nconst EventDelegation = {\n    // Handler registry - maps action names to handler functions\n    handlers: new Map(),\n\n    // Debug mode - set to true for verbose logging\n    debug: false,\n\n    // Statistics for monitoring\n    stats: {\n        handlersRegistered: 0,\n        eventsProcessed: 0,\n        errorsEncountered: 0\n    },\n\n    /**\n     * Register an action handler\n     *\n     * @param {string} action - Action name (from data-action attribute)\n     * @param {Function} handler - Handler function(element, event)\n     * @param {Object} options - Optional configuration\n     *   @param {boolean} options.preventDefault - Auto preventDefault (default: false)\n     *   @param {boolean} options.stopPropagation - Auto stopPropagation (default: false)\n     *\n     * @example\n     * EventDelegation.register('delete-item', function(element, e) {\n     *     const itemId = element.dataset.itemId;\n     *     deleteItem(itemId);\n     * });\n     */\n    register(action, handler, options = {}) {\n        if (typeof handler !== 'function') {\n            console.error(`[EventDelegation] Handler for action \"${action}\" must be a function`);\n            return;\n        }\n\n        // Wrap handler with options\n        const wrappedHandler = (element, event) => {\n            if (options.preventDefault) event.preventDefault();\n            if (options.stopPropagation) event.stopPropagation();\n            return handler(element, event);\n        };\n\n        this.handlers.set(action, wrappedHandler);\n        this.stats.handlersRegistered++;\n\n        if (this.debug) {\n            console.log(`[EventDelegation] Registered handler: ${action}`);\n        }\n    },\n\n    /**\n     * Unregister an action handler\n     *\n     * @param {string} action - Action name to unregister\n     */\n    unregister(action) {\n        if (this.handlers.has(action)) {\n            this.handlers.delete(action);\n            this.stats.handlersRegistered--;\n            if (this.debug) {\n                console.log(`[EventDelegation] Unregistered handler: ${action}`);\n            }\n        }\n    },\n\n    /**\n     * Check if an action is registered\n     *\n     * @param {string} action - Action name to check\n     * @returns {boolean}\n     */\n    isRegistered(action) {\n        return this.handlers.has(action);\n    },\n\n    /**\n     * Get all registered action names\n     *\n     * @returns {string[]} Array of action names\n     */\n    getRegisteredActions() {\n        return Array.from(this.handlers.keys());\n    },\n\n    /**\n     * Initialize event delegation system\n     * Sets up global event listeners on document\n     */\n    init() {\n        // Click events (most common)\n        // NOTE: Using bubble phase (false) to allow other handlers to also process events\n        document.addEventListener('click', this.handleClick.bind(this), false);\n\n        // Change events (for form inputs)\n        document.addEventListener('change', this.handleChange.bind(this), false);\n\n        // Input events (for real-time validation/search)\n        document.addEventListener('input', this.handleInput.bind(this), false);\n\n        // Submit events (for forms)\n        document.addEventListener('submit', this.handleSubmit.bind(this), false);\n\n        // Keydown events (for keyboard shortcuts)\n        document.addEventListener('keydown', this.handleKeydown.bind(this), false);\n\n        console.log('[EventDelegation] System initialized');\n        console.log(`[EventDelegation] Registered ${this.stats.handlersRegistered} handlers`);\n    },\n\n    /**\n     * Handle click events\n     * Delegates to registered action handlers based on data-action attribute\n     *\n     * @param {Event} e - Click event\n     */\n    handleClick(e) {\n        // Find element with data-action (check target and parents)\n        const actionElement = e.target.closest('[data-action]');\n        if (!actionElement) return;\n\n        const action = actionElement.dataset.action;\n        const handler = this.handlers.get(action);\n\n        if (handler) {\n            this.stats.eventsProcessed++;\n\n            if (this.debug) {\n                console.log(`[EventDelegation] Handling click action: ${action}`, {\n                    element: actionElement,\n                    data: actionElement.dataset\n                });\n            }\n\n            try {\n                handler(actionElement, e);\n            } catch (error) {\n                this.stats.errorsEncountered++;\n                console.error(`[EventDelegation] Error in handler \"${action}\":`, error);\n                this.handleError(action, error, actionElement);\n            }\n        } else {\n            if (this.debug) {\n                console.warn(`[EventDelegation] No handler registered for action: ${action}`);\n            }\n        }\n    },\n\n    /**\n     * Handle change events (for form inputs with data-on-change)\n     *\n     * @param {Event} e - Change event\n     */\n    handleChange(e) {\n        const target = e.target.closest('[data-on-change]');\n        if (!target) return;\n\n        const action = target.dataset.onChange;\n        const handler = this.handlers.get(action);\n\n        if (handler) {\n            this.stats.eventsProcessed++;\n\n            if (this.debug) {\n                console.log(`[EventDelegation] Handling change action: ${action}`, {\n                    element: target,\n                    value: target.value\n                });\n            }\n\n            try {\n                handler(target, e);\n            } catch (error) {\n                this.stats.errorsEncountered++;\n                console.error(`[EventDelegation] Error in handler \"${action}\":`, error);\n                this.handleError(action, error, target);\n            }\n        }\n    },\n\n    /**\n     * Handle input events (for real-time validation/search with data-on-input)\n     *\n     * @param {Event} e - Input event\n     */\n    handleInput(e) {\n        const target = e.target.closest('[data-on-input]');\n        if (!target) return;\n\n        const action = target.dataset.onInput;\n        const handler = this.handlers.get(action);\n\n        if (handler) {\n            this.stats.eventsProcessed++;\n\n            if (this.debug) {\n                console.log(`[EventDelegation] Handling input action: ${action}`, {\n                    element: target,\n                    value: target.value\n                });\n            }\n\n            try {\n                handler(target, e);\n            } catch (error) {\n                this.stats.errorsEncountered++;\n                console.error(`[EventDelegation] Error in handler \"${action}\":`, error);\n                this.handleError(action, error, target);\n            }\n        }\n    },\n\n    /**\n     * Handle submit events (for forms with data-on-submit)\n     *\n     * @param {Event} e - Submit event\n     */\n    handleSubmit(e) {\n        const form = e.target.closest('[data-on-submit]');\n        if (!form) return;\n\n        const action = form.dataset.onSubmit;\n        const handler = this.handlers.get(action);\n\n        if (handler) {\n            this.stats.eventsProcessed++;\n\n            if (this.debug) {\n                console.log(`[EventDelegation] Handling submit action: ${action}`, {\n                    form: form,\n                    data: new FormData(form)\n                });\n            }\n\n            try {\n                handler(form, e);\n            } catch (error) {\n                this.stats.errorsEncountered++;\n                console.error(`[EventDelegation] Error in handler \"${action}\":`, error);\n                this.handleError(action, error, form);\n            }\n        }\n    },\n\n    /**\n     * Handle keydown events (for keyboard shortcuts with data-on-keydown)\n     *\n     * @param {Event} e - Keydown event\n     */\n    handleKeydown(e) {\n        const target = e.target.closest('[data-on-keydown]');\n        if (!target) return;\n\n        const action = target.dataset.onKeydown;\n        const handler = this.handlers.get(action);\n\n        if (handler) {\n            this.stats.eventsProcessed++;\n\n            if (this.debug) {\n                console.log(`[EventDelegation] Handling keydown action: ${action}`, {\n                    element: target,\n                    key: e.key,\n                    code: e.code\n                });\n            }\n\n            try {\n                handler(target, e);\n            } catch (error) {\n                this.stats.errorsEncountered++;\n                console.error(`[EventDelegation] Error in handler \"${action}\":`, error);\n                this.handleError(action, error, target);\n            }\n        }\n    },\n\n    /**\n     * Handle errors in action handlers\n     * Can be overridden to customize error handling\n     *\n     * @param {string} action - Action name that errored\n     * @param {Error} error - The error object\n     * @param {HTMLElement} element - The element that triggered the action\n     */\n    handleError(action, error, element) {\n        // Default error handling - can be customized\n        console.error(`[EventDelegation] Action \"${action}\" failed:`, error);\n\n        // Optionally show user-facing error message\n        if (typeof showNotification === 'function') {\n            showNotification('Error', `Action failed: ${action}`, 'error');\n        }\n    },\n\n    /**\n     * Enable debug mode\n     */\n    enableDebug() {\n        this.debug = true;\n        console.log('[EventDelegation] Debug mode enabled');\n    },\n\n    /**\n     * Disable debug mode\n     */\n    disableDebug() {\n        this.debug = false;\n        console.log('[EventDelegation] Debug mode disabled');\n    },\n\n    /**\n     * Get system statistics\n     *\n     * @returns {Object} Statistics object\n     */\n    getStats() {\n        return {\n            ...this.stats,\n            registeredActions: this.handlers.size\n        };\n    },\n\n    /**\n     * Reset statistics\n     */\n    resetStats() {\n        this.stats.eventsProcessed = 0;\n        this.stats.errorsEncountered = 0;\n    }\n};\n\n// Initialize the system when DOM is ready\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', function() {\n        EventDelegation.init();\n    });\n} else {\n    // DOM already loaded\n    EventDelegation.init();\n}\n\n// ============================================================================\n// MATCH MANAGEMENT ACTIONS\n// ============================================================================\n\n/**\n * Show Task Info Action\n * Displays detailed information about a scheduled task\n */\nEventDelegation.register('show-task-info', function(element, e) {\n    e.preventDefault();\n\n    const taskId = element.dataset.taskId;\n    const taskType = element.dataset.taskType;\n    const taskDataStr = element.dataset.taskData;\n\n    if (!taskId || !taskType) {\n        console.error('[show-task-info] Missing required data attributes');\n        return;\n    }\n\n    let taskData;\n    try {\n        taskData = taskDataStr ? JSON.parse(taskDataStr) : {};\n    } catch (err) {\n        console.error('[show-task-info] Failed to parse task data:', err);\n        taskData = {};\n    }\n\n    if (typeof showTaskInfo === 'function') {\n        showTaskInfo(taskId, taskType, taskData);\n    } else {\n        console.error('[show-task-info] Function not found');\n    }\n});\n\n/**\n * Revoke Task Action\n * Cancels a scheduled task (thread creation, reporting, etc.)\n */\nEventDelegation.register('revoke-task', function(element, e) {\n    e.preventDefault();\n\n    const taskId = element.dataset.taskId;\n    const matchId = element.dataset.matchId;\n    const taskType = element.dataset.taskType;\n\n    if (!taskId || !matchId || !taskType) {\n        console.error('[revoke-task] Missing required data attributes');\n        return;\n    }\n\n    if (typeof revokeTask === 'function') {\n        revokeTask(taskId, matchId, taskType);\n    } else {\n        console.error('[revoke-task] Function not found');\n    }\n});\n\n/**\n * Reschedule Task Action\n * Re-schedules a task to run at a different time\n */\nEventDelegation.register('reschedule-task', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId;\n    const taskType = element.dataset.taskType;\n\n    if (!matchId || !taskType) {\n        console.error('[reschedule-task] Missing required data attributes');\n        return;\n    }\n\n    if (typeof rescheduleTask === 'function') {\n        rescheduleTask(matchId, taskType);\n    } else {\n        console.error('[reschedule-task] Function not found');\n    }\n});\n\n/**\n * Refresh Tasks Action\n * Manually refreshes task status for all matches\n */\nEventDelegation.register('refresh-tasks', function(element, e) {\n    e.preventDefault();\n\n    if (typeof loadAllTaskDetails === 'function') {\n        loadAllTaskDetails();\n    } else if (typeof refreshStatuses === 'function') {\n        refreshStatuses();\n    } else {\n        console.error('[refresh-tasks] No refresh function found');\n    }\n});\n\n/**\n * Toggle Historical Matches Action\n * Shows/hides historical matches section\n */\nEventDelegation.register('toggle-historical', function(element, e) {\n    e.preventDefault();\n\n    const targetId = element.dataset.target;\n    if (!targetId) {\n        console.error('[toggle-historical] Missing target ID');\n        return;\n    }\n\n    const target = document.querySelector(targetId);\n    if (target && window.bootstrap) {\n        const collapse = bootstrap.Collapse.getOrCreateInstance(target);\n        collapse.toggle();\n    }\n});\n\n/**\n * Schedule Match Action\n * Schedules all tasks for a match (thread + reporting)\n */\nEventDelegation.register('schedule-match', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId;\n\n    if (!matchId) {\n        console.error('[schedule-match] Missing match ID');\n        return;\n    }\n\n    if (typeof scheduleMatch === 'function') {\n        scheduleMatch(matchId);\n    } else {\n        console.error('[schedule-match] Function not found');\n    }\n});\n\n/**\n * Verify Match Action\n * Opens match verification modal/page\n */\nEventDelegation.register('verify-match', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId;\n\n    if (!matchId) {\n        console.error('[verify-match] Missing match ID');\n        return;\n    }\n\n    // Navigate to verification page or open modal\n    if (typeof verifyMatch === 'function') {\n        verifyMatch(matchId);\n    } else {\n        // Fallback: navigate to verification page\n        const verifyUrl = element.dataset.verifyUrl || `/admin/match_verification/${matchId}`;\n        window.location.href = verifyUrl;\n    }\n});\n\n/**\n * Edit Match Action\n * Opens match editing modal/page\n */\nEventDelegation.register('edit-match', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId;\n\n    if (!matchId) {\n        console.error('[edit-match] Missing match ID');\n        return;\n    }\n\n    if (typeof editMatch === 'function') {\n        editMatch(matchId);\n    } else {\n        console.error('[edit-match] Function not found');\n    }\n});\n\n// ============================================================================\n// DRAFT SYSTEM ACTIONS\n// ============================================================================\n\n/**\n * Draft Player Action\n * Shows modal to select team and draft player\n */\nEventDelegation.register('draft-player', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const playerName = element.dataset.playerName;\n\n    if (!playerId || !playerName) {\n        console.error('[draft-player] Missing required data attributes');\n        return;\n    }\n\n    // Call global function\n    if (typeof confirmDraftPlayer === 'function') {\n        confirmDraftPlayer(playerId, playerName);\n    } else if (window.draftSystemInstance && typeof window.draftSystemInstance.showDraftModal === 'function') {\n        window.draftSystemInstance.showDraftModal(playerId, playerName);\n    } else {\n        console.error('[draft-player] No draft function available');\n    }\n});\n\n/**\n * Remove Player Action\n * Removes player from team and returns to available pool\n */\nEventDelegation.register('remove-player', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const teamId = element.dataset.teamId;\n    const playerName = element.dataset.playerName;\n    const teamName = element.dataset.teamName;\n\n    if (!playerId || !teamId) {\n        console.error('[remove-player] Missing required data attributes');\n        return;\n    }\n\n    // Call global function\n    if (typeof confirmRemovePlayer === 'function') {\n        confirmRemovePlayer(playerId, teamId, playerName, teamName);\n    } else {\n        console.error('[remove-player] Function not found');\n    }\n});\n\n/**\n * View Player Profile Action\n * Opens modal with player details\n */\nEventDelegation.register('view-player-profile', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n\n    if (!playerId) {\n        console.error('[view-player-profile] Missing player ID');\n        return;\n    }\n\n    // Check for instance method first, then global\n    if (window.draftSystemInstance && typeof window.draftSystemInstance.openPlayerModal === 'function') {\n        window.draftSystemInstance.openPlayerModal(playerId);\n    } else if (typeof openPlayerModal === 'function') {\n        openPlayerModal(playerId);\n    } else {\n        console.error('[view-player-profile] No modal function available');\n    }\n});\n\n/**\n * Search Players Action (triggered by input event)\n * Filters available players by name\n */\nEventDelegation.register('search-players', function(element, e) {\n    const searchTerm = element.value.toLowerCase().trim();\n\n    if (window.draftSystemInstance && typeof window.draftSystemInstance.handleSearch === 'function') {\n        window.draftSystemInstance.handleSearch(e);\n    } else {\n        // Fallback: basic search implementation\n        const playerCards = document.querySelectorAll('[data-component=\"player-card\"]');\n        playerCards.forEach(card => {\n            const playerName = (card.dataset.playerName || '').toLowerCase();\n            const shouldShow = !searchTerm || playerName.includes(searchTerm);\n            card.closest('[data-component=\"player-column\"]')?.classList.toggle('d-none', !shouldShow);\n        });\n    }\n});\n\n/**\n * Filter Players by Position (triggered by change event)\n */\nEventDelegation.register('filter-position', function(element, e) {\n    if (window.draftSystemInstance && typeof window.draftSystemInstance.handleFilter === 'function') {\n        window.draftSystemInstance.handleFilter(e);\n    } else {\n        const position = element.value.toLowerCase();\n        const playerCards = document.querySelectorAll('[data-component=\"player-card\"]');\n        playerCards.forEach(card => {\n            const playerPosition = (card.dataset.position || '').toLowerCase();\n            const shouldShow = !position || playerPosition === position;\n            card.closest('[data-component=\"player-column\"]')?.classList.toggle('d-none', !shouldShow);\n        });\n    }\n});\n\n/**\n * Sort Players (triggered by change event)\n */\nEventDelegation.register('sort-players', function(element, e) {\n    if (window.draftSystemInstance && typeof window.draftSystemInstance.handleSort === 'function') {\n        window.draftSystemInstance.handleSort(e);\n    } else {\n        console.warn('[sort-players] Sort function not available');\n    }\n});\n\n// ============================================================================\n// MATCH REPORTING ACTIONS\n// ============================================================================\n\n/**\n * Edit Match Report Action\n * Opens modal to edit/create match report\n */\nEventDelegation.register('edit-match-report', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId;\n\n    if (!matchId) {\n        console.error('[edit-match-report] Missing match ID');\n        return;\n    }\n\n    // Call the global function that handles the edit button click\n    if (typeof handleEditButtonClick === 'function') {\n        handleEditButtonClick(matchId);\n    } else {\n        console.error('[edit-match-report] handleEditButtonClick function not found');\n    }\n});\n\n/**\n * Add Goal Action\n * Adds goal scorer to match report\n */\nEventDelegation.register('add-goal', function(element, e) {\n    e.preventDefault();\n\n    // Extract matchId from onclick attribute or data attribute\n    let matchId = element.dataset.matchId;\n    if (!matchId) {\n        const onclickAttr = element.getAttribute('onclick');\n        if (onclickAttr) {\n            const match = onclickAttr.match(/'([^']+)'/);\n            if (match) matchId = match[1];\n        }\n    }\n\n    if (!matchId) {\n        console.error('[add-goal] Missing match ID');\n        return;\n    }\n\n    const containerId = `goalScorersContainer-${matchId}`;\n\n    if (typeof window.addEvent === 'function') {\n        window.addEvent(matchId, containerId);\n    } else {\n        console.error('[add-goal] addEvent function not found');\n    }\n});\n\n/**\n * Add Assist Action\n * Adds assist provider to match report\n */\nEventDelegation.register('add-assist', function(element, e) {\n    e.preventDefault();\n\n    // Extract matchId from onclick attribute or data attribute\n    let matchId = element.dataset.matchId;\n    if (!matchId) {\n        const onclickAttr = element.getAttribute('onclick');\n        if (onclickAttr) {\n            const match = onclickAttr.match(/'([^']+)'/);\n            if (match) matchId = match[1];\n        }\n    }\n\n    if (!matchId) {\n        console.error('[add-assist] Missing match ID');\n        return;\n    }\n\n    const containerId = `assistProvidersContainer-${matchId}`;\n\n    if (typeof window.addEvent === 'function') {\n        window.addEvent(matchId, containerId);\n    } else {\n        console.error('[add-assist] addEvent function not found');\n    }\n});\n\n/**\n * Add Yellow Card Action\n * Adds yellow card to match report\n */\nEventDelegation.register('add-yellow-card', function(element, e) {\n    e.preventDefault();\n\n    // Extract matchId from onclick attribute or data attribute\n    let matchId = element.dataset.matchId;\n    if (!matchId) {\n        const onclickAttr = element.getAttribute('onclick');\n        if (onclickAttr) {\n            const match = onclickAttr.match(/'([^']+)'/);\n            if (match) matchId = match[1];\n        }\n    }\n\n    if (!matchId) {\n        console.error('[add-yellow-card] Missing match ID');\n        return;\n    }\n\n    const containerId = `yellowCardsContainer-${matchId}`;\n\n    if (typeof window.addEvent === 'function') {\n        window.addEvent(matchId, containerId);\n    } else {\n        console.error('[add-yellow-card] addEvent function not found');\n    }\n});\n\n/**\n * Add Red Card Action\n * Adds red card to match report\n */\nEventDelegation.register('add-red-card', function(element, e) {\n    e.preventDefault();\n\n    // Extract matchId from onclick attribute or data attribute\n    let matchId = element.dataset.matchId;\n    if (!matchId) {\n        const onclickAttr = element.getAttribute('onclick');\n        if (onclickAttr) {\n            const match = onclickAttr.match(/'([^']+)'/);\n            if (match) matchId = match[1];\n        }\n    }\n\n    if (!matchId) {\n        console.error('[add-red-card] Missing match ID');\n        return;\n    }\n\n    const containerId = `redCardsContainer-${matchId}`;\n\n    if (typeof window.addEvent === 'function') {\n        window.addEvent(matchId, containerId);\n    } else {\n        console.error('[add-red-card] addEvent function not found');\n    }\n});\n\n/**\n * Remove Event Action (Generic)\n * Removes any event entry (goal, assist, card) from match report\n */\nEventDelegation.register('remove-event', function(element, e) {\n    e.preventDefault();\n\n    if (typeof window.removeEvent === 'function') {\n        window.removeEvent(element);\n    } else {\n        console.error('[remove-event] removeEvent function not found');\n    }\n});\n\n/**\n * Remove Own Goal Action\n * Removes own goal from match report\n */\nEventDelegation.register('remove-own-goal', function(element, e) {\n    e.preventDefault();\n\n    if (typeof window.removeEvent === 'function') {\n        window.removeEvent(element);\n    } else {\n        console.error('[remove-own-goal] removeEvent function not found');\n    }\n});\n\n// ============================================================================\n// RSVP ACTIONS\n// ============================================================================\n\n/**\n * RSVP Yes Action\n * Player confirms attendance (admin can set for players)\n */\nEventDelegation.register('rsvp-yes', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId;\n    const playerId = element.dataset.playerId;\n\n    if (!matchId) {\n        console.error('[rsvp-yes] Missing match ID');\n        return;\n    }\n\n    // Admin update mode (has playerId) vs player self-RSVP\n    if (playerId) {\n        // Admin updating player RSVP\n        if (typeof updatePlayerRSVP === 'function') {\n            updatePlayerRSVP(playerId, matchId, 'yes');\n        } else {\n            // Fallback: trigger the update-rsvp-btn logic\n            const response = 'yes';\n            updateRSVPStatus(playerId, matchId, response);\n        }\n    } else {\n        // Player self-RSVP\n        if (typeof submitRSVP === 'function') {\n            submitRSVP(matchId, 'yes');\n        } else {\n            console.error('[rsvp-yes] submitRSVP function not found');\n        }\n    }\n});\n\n/**\n * RSVP No Action\n * Player confirms they cannot attend\n */\nEventDelegation.register('rsvp-no', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId;\n    const playerId = element.dataset.playerId;\n\n    if (!matchId) {\n        console.error('[rsvp-no] Missing match ID');\n        return;\n    }\n\n    if (playerId) {\n        if (typeof updatePlayerRSVP === 'function') {\n            updatePlayerRSVP(playerId, matchId, 'no');\n        } else {\n            updateRSVPStatus(playerId, matchId, 'no');\n        }\n    } else {\n        if (typeof submitRSVP === 'function') {\n            submitRSVP(matchId, 'no');\n        } else {\n            console.error('[rsvp-no] submitRSVP function not found');\n        }\n    }\n});\n\n/**\n * RSVP Maybe Action\n * Player is unsure about attendance\n */\nEventDelegation.register('rsvp-maybe', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId;\n    const playerId = element.dataset.playerId;\n\n    if (!matchId) {\n        console.error('[rsvp-maybe] Missing match ID');\n        return;\n    }\n\n    if (playerId) {\n        if (typeof updatePlayerRSVP === 'function') {\n            updatePlayerRSVP(playerId, matchId, 'maybe');\n        } else {\n            updateRSVPStatus(playerId, matchId, 'maybe');\n        }\n    } else {\n        if (typeof submitRSVP === 'function') {\n            submitRSVP(matchId, 'maybe');\n        } else {\n            console.error('[rsvp-maybe] submitRSVP function not found');\n        }\n    }\n});\n\n/**\n * Withdraw RSVP Action\n * Player cancels their RSVP\n */\nEventDelegation.register('rsvp-withdraw', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId;\n    const playerId = element.dataset.playerId;\n\n    if (!matchId) {\n        console.error('[rsvp-withdraw] Missing match ID');\n        return;\n    }\n\n    if (playerId) {\n        // Admin clearing player RSVP\n        if (typeof updatePlayerRSVP === 'function') {\n            updatePlayerRSVP(playerId, matchId, 'no_response');\n        } else {\n            updateRSVPStatus(playerId, matchId, 'no_response');\n        }\n    } else {\n        // Player withdrawing own RSVP\n        if (typeof withdrawRSVP === 'function') {\n            withdrawRSVP(matchId);\n        } else {\n            console.error('[rsvp-withdraw] withdrawRSVP function not found');\n        }\n    }\n});\n\n/**\n * Send SMS Action\n * Opens modal to send SMS to player\n */\nEventDelegation.register('rsvp-request-sms', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const playerName = element.dataset.playerName;\n    const phone = element.dataset.phone;\n\n    if (!playerId) {\n        console.error('[rsvp-request-sms] Missing player ID');\n        return;\n    }\n\n    // Use jQuery if available (legacy code uses it)\n    if (window.jQuery) {\n        const $ = window.jQuery;\n\n        try {\n            // Populate modal fields\n            $('#smsPlayerName').text(playerName || 'Player');\n            $('#smsPlayerId').val(playerId);\n            $('#smsPlayerPhone').val(phone || '');\n\n            // Format phone number for display\n            if (phone && typeof formatPhoneNumber === 'function') {\n                $('#smsPlayerPhoneDisplay').text(formatPhoneNumber(phone));\n            } else {\n                $('#smsPlayerPhoneDisplay').text(phone || '');\n            }\n\n            $('#smsMessage').val('');\n            $('#smsCharCount').text('0');\n\n            // Show modal\n            const smsModal = document.querySelector('[data-modal=\"send-sms\"]');\n            if (smsModal) {\n                ModalManager.showByElement(smsModal);\n            }\n        } catch (err) {\n            console.error('[rsvp-request-sms] Error opening modal:', err);\n        }\n    } else {\n        // Vanilla JS fallback\n        const smsModal = document.querySelector('[data-modal=\"send-sms\"]');\n        if (smsModal && window.bootstrap) {\n            // Set values directly\n            const playerNameEl = document.getElementById('smsPlayerName');\n            const playerIdEl = document.getElementById('smsPlayerId');\n            const playerPhoneEl = document.getElementById('smsPlayerPhone');\n            const messageEl = document.getElementById('smsMessage');\n            const charCountEl = document.getElementById('smsCharCount');\n\n            if (playerNameEl) playerNameEl.textContent = playerName || 'Player';\n            if (playerIdEl) playerIdEl.value = playerId;\n            if (playerPhoneEl) playerPhoneEl.value = phone || '';\n            if (messageEl) messageEl.value = '';\n            if (charCountEl) charCountEl.textContent = '0';\n\n            ModalManager.showByElement(smsModal);\n        }\n    }\n});\n\n/**\n * Send Discord DM Action\n * Opens modal to send Discord direct message\n */\nEventDelegation.register('rsvp-request-discord-dm', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const playerName = element.dataset.playerName;\n    const discordId = element.dataset.discordId;\n\n    if (!playerId) {\n        console.error('[rsvp-request-discord-dm] Missing player ID');\n        return;\n    }\n\n    // Use jQuery if available (legacy code uses it)\n    if (window.jQuery) {\n        const $ = window.jQuery;\n\n        try {\n            $('#discordPlayerName').text(playerName || 'Player');\n            $('#discordPlayerId').val(playerId);\n            $('#discordId').val(discordId || '');\n            $('#discordMessage').val('');\n            $('#discordCharCount').text('0');\n\n            const discordModal = document.querySelector('[data-modal=\"send-discord-dm\"]');\n            if (discordModal) {\n                ModalManager.showByElement(discordModal);\n            }\n        } catch (err) {\n            console.error('[rsvp-request-discord-dm] Error opening modal:', err);\n        }\n    } else {\n        // Vanilla JS fallback\n        const discordModal = document.querySelector('[data-modal=\"send-discord-dm\"]');\n        if (discordModal && window.bootstrap) {\n            const playerNameEl = document.getElementById('discordPlayerName');\n            const playerIdEl = document.getElementById('discordPlayerId');\n            const discordIdEl = document.getElementById('discordId');\n            const messageEl = document.getElementById('discordMessage');\n            const charCountEl = document.getElementById('discordCharCount');\n\n            if (playerNameEl) playerNameEl.textContent = playerName || 'Player';\n            if (playerIdEl) playerIdEl.value = playerId;\n            if (discordIdEl) discordIdEl.value = discordId || '';\n            if (messageEl) messageEl.value = '';\n            if (charCountEl) charCountEl.textContent = '0';\n\n            ModalManager.showByElement(discordModal);\n        }\n    }\n});\n\n/**\n * Update RSVP Status Action (Admin)\n * Admin manually updates player RSVP status\n * This is the main handler that triggers the update via AJAX\n */\nEventDelegation.register('rsvp-update-status', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const matchId = element.dataset.matchId;\n    const response = element.dataset.response;\n\n    if (!playerId || !matchId || !response) {\n        console.error('[rsvp-update-status] Missing required data attributes');\n        return;\n    }\n\n    updateRSVPStatus(playerId, matchId, response);\n});\n\n/**\n * Helper function to update RSVP status via AJAX\n * This replaces the inline logic from the jQuery handler\n */\nfunction updateRSVPStatus(playerId, matchId, response) {\n    // Use SweetAlert2 for confirmation\n    if (typeof Swal === 'undefined') {\n        console.error('[updateRSVPStatus] SweetAlert2 not available');\n        return;\n    }\n\n    Swal.fire({\n        title: 'Update RSVP Status?',\n        text: 'Are you sure you want to update this player\\'s RSVP status?',\n        icon: 'question',\n        showCancelButton: true,\n        confirmButtonText: 'Yes, update it',\n        cancelButtonText: 'Cancel',\n        confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('primary') : '#0d6efd',\n        customClass: {\n            confirmButton: 'swal-btn-confirm',\n            cancelButton: 'swal-btn-cancel'\n        },\n        buttonsStyling: false\n    }).then((result) => {\n        if (result.isConfirmed) {\n            const formData = new FormData();\n\n            // Get CSRF token\n            const csrfToken = document.querySelector('input[name=\"csrf_token\"]')?.value || '';\n\n            formData.append('csrf_token', csrfToken);\n            formData.append('player_id', playerId);\n            formData.append('match_id', matchId);\n            formData.append('response', response);\n\n            // Show loading state\n            Swal.fire({\n                title: 'Updating...',\n                allowOutsideClick: false,\n                didOpen: () => {\n                    Swal.showLoading();\n                }\n            });\n\n            // Make the AJAX request\n            fetch('/admin/update_rsvp', {\n                method: 'POST',\n                body: formData,\n                headers: {\n                    'X-Requested-With': 'XMLHttpRequest'\n                }\n            })\n            .then(function(response) {\n                if (!response.ok) {\n                    throw new Error('Network response was not ok');\n                }\n                return response.json();\n            })\n            .then(function(data) {\n                if (data.success) {\n                    Swal.fire({\n                        title: 'Success!',\n                        text: 'RSVP updated successfully.',\n                        icon: 'success',\n                        timer: 1500,\n                        showConfirmButton: false\n                    }).then(() => {\n                        window.location.reload();\n                    });\n                } else {\n                    Swal.fire({\n                        title: 'Error',\n                        text: data.message || 'Error updating RSVP.',\n                        icon: 'error'\n                    });\n                }\n            })\n            .catch(function(error) {\n                console.error('[updateRSVPStatus] Error:', error);\n                Swal.fire({\n                    title: 'Error',\n                    text: 'An error occurred while updating RSVP. Please try again.',\n                    icon: 'error'\n                });\n            });\n        }\n    });\n}\n\n// ============================================================================\n// CALENDAR SUBSCRIPTION ACTIONS\n// ============================================================================\n\n/**\n * Copy Subscription URL Action\n * Copies the calendar subscription URL to clipboard\n */\nEventDelegation.register('copy-subscription-url', async function(element, e) {\n    e.preventDefault();\n\n    const urlInput = document.getElementById('subscriptionUrl');\n    if (!urlInput || !urlInput.value) {\n        showCalendarToast('warning', 'No subscription URL available');\n        return;\n    }\n\n    try {\n        await navigator.clipboard.writeText(urlInput.value);\n        showCalendarToast('success', 'URL copied to clipboard');\n\n        // Visual feedback\n        const originalHtml = element.innerHTML;\n        element.innerHTML = '<i class=\"ti ti-check me-1\"></i>Copied!';\n        setTimeout(() => {\n            element.innerHTML = originalHtml;\n        }, 2000);\n    } catch (error) {\n        // Fallback for older browsers\n        urlInput.select();\n        document.execCommand('copy');\n        showCalendarToast('success', 'URL copied to clipboard');\n    }\n});\n\n/**\n * Regenerate Subscription Token Action\n * Regenerates the calendar subscription URL/token\n */\nEventDelegation.register('regenerate-subscription-token', async function(element, e) {\n    e.preventDefault();\n\n    if (!confirm('Are you sure you want to regenerate your subscription URL?\\n\\nYour existing calendar subscriptions will stop working and you will need to re-subscribe with the new URL.')) {\n        return;\n    }\n\n    setCalendarLoading(true);\n\n    try {\n        const response = await fetch('/api/calendar/subscription/regenerate', {\n            method: 'POST',\n            headers: {\n                'X-Requested-With': 'XMLHttpRequest',\n                'Content-Type': 'application/json'\n            }\n        });\n\n        if (!response.ok) {\n            throw new Error('Failed to regenerate token');\n        }\n\n        const data = await response.json();\n\n        // Update the calendar subscription state if CalendarSubscription module is available\n        if (typeof CalendarSubscription !== 'undefined' && CalendarSubscription.loadSubscription) {\n            await CalendarSubscription.loadSubscription();\n        }\n\n        showCalendarToast('success', 'Subscription URL regenerated successfully');\n\n    } catch (error) {\n        console.error('[regenerate-subscription-token] Error:', error);\n        showCalendarToast('error', 'Failed to regenerate subscription URL');\n    } finally {\n        setCalendarLoading(false);\n    }\n});\n\n/**\n * Subscribe via Webcal Action\n * Opens subscription in iOS/macOS Calendar app via webcal:// protocol\n */\nEventDelegation.register('subscribe-webcal', function(element, e) {\n    e.preventDefault();\n\n    const webcalUrl = element.dataset.webcalUrl;\n\n    if (webcalUrl) {\n        window.location.href = webcalUrl;\n    } else {\n        showCalendarToast('warning', 'Subscription URL not available');\n    }\n});\n\n/**\n * Subscribe via Google Calendar Action\n * Opens Google Calendar subscription page in new tab\n */\nEventDelegation.register('subscribe-google', function(element, e) {\n    e.preventDefault();\n\n    const feedUrl = element.dataset.feedUrl;\n\n    if (!feedUrl) {\n        showCalendarToast('warning', 'Subscription URL not available');\n        return;\n    }\n\n    // Google Calendar subscription URL\n    const googleUrl = 'https://calendar.google.com/calendar/r?cid=' + encodeURIComponent(feedUrl);\n    window.open(googleUrl, '_blank');\n});\n\n/**\n * Update Calendar Preferences Action\n * Updates subscription preferences (which events to include)\n * Triggered by change events on preference checkboxes\n */\nEventDelegation.register('update-calendar-preferences', async function(element, e) {\n    const preferences = {\n        include_team_matches: document.getElementById('subIncludeMatches')?.checked ?? true,\n        include_league_events: document.getElementById('subIncludeLeagueEvents')?.checked ?? true,\n        include_ref_assignments: document.getElementById('subIncludeRefAssignments')?.checked ?? true\n    };\n\n    try {\n        const response = await fetch('/api/calendar/subscription/preferences', {\n            method: 'PUT',\n            headers: {\n                'X-Requested-With': 'XMLHttpRequest',\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(preferences)\n        });\n\n        if (!response.ok) {\n            throw new Error('Failed to update preferences');\n        }\n\n        await response.json();\n        showCalendarToast('success', 'Preferences updated');\n\n    } catch (error) {\n        console.error('[update-calendar-preferences] Error:', error);\n        showCalendarToast('error', 'Failed to update preferences');\n\n        // Revert checkbox state\n        element.checked = !element.checked;\n    }\n});\n\n/**\n * Helper: Show calendar-specific toast notification\n * Uses existing toast system if available\n */\nfunction showCalendarToast(type, message) {\n    // Use existing toast system if available\n    if (typeof window.showToast === 'function') {\n        window.showToast(type, message);\n        return;\n    }\n\n    // Fallback to Toastify\n    if (typeof Toastify !== 'undefined') {\n        // Use ECSTheme colors with gradient variations for toast backgrounds\n        const successColor = (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('success') : '#198754';\n        const successLight = (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('success-light') : '#198754';\n        const dangerColor = (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : '#dc3545';\n        const dangerLight = (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger-light') : '#dc3545';\n        const warningColor = (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('warning') : '#ffc107';\n        const warningLight = (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('warning-light') : '#ffc107';\n        const infoColor = (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('info') : '#0dcaf0';\n        const infoLight = (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('info-light') : '#0dcaf0';\n        const bgColors = {\n            success: `linear-gradient(to right, ${successColor}, ${successLight})`,\n            error: `linear-gradient(to right, ${dangerColor}, ${dangerLight})`,\n            warning: `linear-gradient(to right, ${warningColor}, ${warningLight})`,\n            info: `linear-gradient(to right, ${infoColor}, ${infoLight})`\n        };\n\n        Toastify({\n            text: message,\n            duration: 3000,\n            gravity: 'top',\n            position: 'right',\n            style: { background: bgColors[type] || bgColors.info }\n        }).showToast();\n        return;\n    }\n\n    // Final fallback\n    console.log(`[${type}] ${message}`);\n}\n\n/**\n * Helper: Set loading state for calendar subscription\n */\nfunction setCalendarLoading(loading) {\n    const loadingIndicator = document.getElementById('subscriptionLoading');\n    const content = document.getElementById('subscriptionContent');\n\n    if (loadingIndicator) {\n        loadingIndicator.classList.toggle('is-hidden', !loading);\n    }\n    if (content) {\n        content.classList.toggle('is-hidden', loading);\n    }\n}\n\n// ============================================================================\n// PROFILE VERIFICATION ACTIONS\n// ============================================================================\n\n/**\n * Toggle Section Reviewed Checkbox Action\n * Handles when user checks/unchecks a profile section as reviewed\n * Updates progress indicator and confirm button state\n */\nEventDelegation.register('verify-section-reviewed', function(element, e) {\n    // This handler is triggered by the change event via data-on-change\n    // The ProfileVerification module will handle the actual logic\n    if (window.ProfileVerification && typeof window.ProfileVerification.handleCheckboxChange === 'function') {\n        window.ProfileVerification.handleCheckboxChange(element);\n    } else {\n        console.error('[verify-section-reviewed] ProfileVerification not available');\n    }\n});\n\n/**\n * Verify Profile Action\n * Navigates to the profile verification page where users review sections.\n * Used on the main profile page to start the verification flow.\n * The /verify route auto-detects mobile vs desktop and redirects appropriately.\n */\nEventDelegation.register('verify-profile', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n\n    if (!playerId) {\n        console.error('[verify-profile] Missing player ID');\n        return;\n    }\n\n    // Get verify URL from data element or construct it\n    // The /verify GET route handles mobile vs desktop detection\n    const verifyDataEl = document.querySelector('[data-profile-verify]');\n    const verifyUrl = verifyDataEl?.dataset.verifyUrl || `/players/profile/${playerId}/verify`;\n\n    // Navigate to verification page\n    window.location.href = verifyUrl;\n});\n\n/**\n * Verify Profile Submit Action (Form-based)\n * Submits the profile verification form\n * Validates that all sections have been reviewed before allowing submission\n */\nEventDelegation.register('verify-profile-submit', function(element, e) {\n    // Check if all sections are reviewed before allowing submission\n    if (window.ProfileVerification && typeof window.ProfileVerification.areAllSectionsReviewed === 'function') {\n        const allReviewed = window.ProfileVerification.areAllSectionsReviewed();\n\n        if (!allReviewed) {\n            e.preventDefault();\n\n            const uncheckedSections = window.ProfileVerification.getUncheckedSections();\n\n            // Haptic feedback for error\n            if (window.Haptics) {\n                window.Haptics.error();\n            }\n\n            // Show warning\n            window.ProfileVerification.showIncompleteWarning(uncheckedSections);\n        } else {\n            // All reviewed - allow form submission with success feedback\n            if (window.Haptics) {\n                window.Haptics.success();\n            }\n            // Form will submit naturally\n        }\n    } else {\n        // ProfileVerification not available - allow submission (backward compatibility)\n        console.warn('[verify-profile-submit] ProfileVerification not available, allowing submission');\n    }\n});\n\n// ============================================================================\n// DISCORD MANAGEMENT ACTIONS\n// ============================================================================\n\n/**\n * Change Per Page Action (triggered by change event)\n * Updates the number of items displayed per page\n */\nEventDelegation.register('change-per-page', function(element, e) {\n    const perPage = element.value;\n    const url = new URL(window.location);\n    url.searchParams.set('per_page', perPage);\n    url.searchParams.set('page', '1'); // Reset to first page\n    window.location.href = url.toString();\n});\n\n/**\n * Refresh All Discord Status Action\n * Refreshes Discord status for all players\n */\nEventDelegation.register('refresh-all-discord-status', function(element, e) {\n    e.preventDefault();\n\n    const btn = element;\n\n    if (typeof Swal === 'undefined') {\n        console.error('[refresh-all-discord-status] SweetAlert2 not available');\n        return;\n    }\n\n    Swal.fire({\n        title: 'Refresh All Discord Status',\n        text: 'This will refresh Discord status for all players. This may take a moment. Continue?',\n        icon: 'question',\n        showCancelButton: true,\n        confirmButtonText: 'Yes, refresh all',\n        cancelButtonText: 'Cancel',\n        confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('success') : '#28c76f',\n        cancelButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : '#ea5455'\n    }).then((result) => {\n        if (result.isConfirmed) {\n            // Show loading state\n            const originalText = btn.innerHTML;\n            btn.innerHTML = '<i class=\"ti ti-loader ti-spin me-1\"></i>Refreshing...';\n            btn.disabled = true;\n\n            // Get CSRF token\n            const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content') || '';\n\n            // Refresh all Discord status\n            fetch('/admin/refresh_all_discord_status', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-CSRFToken': csrfToken\n                }\n            }).then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    Swal.fire({\n                        icon: 'success',\n                        title: 'Status Updated',\n                        text: `Refreshed Discord status for ${data.success_count} players`,\n                        timer: 2000,\n                        showConfirmButton: false\n                    }).then(() => {\n                        location.reload();\n                    });\n                } else {\n                    throw new Error(data.message || 'Failed to refresh status');\n                }\n            }).catch(error => {\n                Swal.fire({\n                    icon: 'error',\n                    title: 'Error',\n                    text: 'Failed to refresh status: ' + error.message,\n                    confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : '#ea5455'\n                });\n            }).finally(() => {\n                btn.innerHTML = originalText;\n                btn.disabled = false;\n            });\n        }\n    });\n});\n\n/**\n * Refresh Unknown Discord Status Action\n * Checks Discord status for all players with unknown status\n */\nEventDelegation.register('refresh-unknown-discord-status', function(element, e) {\n    e.preventDefault();\n\n    const btn = element;\n\n    if (typeof Swal === 'undefined') {\n        console.error('[refresh-unknown-discord-status] SweetAlert2 not available');\n        return;\n    }\n\n    Swal.fire({\n        title: 'Check Unknown Discord Status',\n        text: 'This will check Discord status for all players with unknown status. Continue?',\n        icon: 'question',\n        showCancelButton: true,\n        confirmButtonText: 'Yes, check unknown',\n        cancelButtonText: 'Cancel',\n        confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('warning') : '#ffab00',\n        cancelButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : '#ea5455'\n    }).then((result) => {\n        if (result.isConfirmed) {\n            // Show loading state\n            const originalText = btn.innerHTML;\n            btn.innerHTML = '<i class=\"ti ti-loader ti-spin me-1\"></i>Checking...';\n            btn.disabled = true;\n\n            // Get CSRF token\n            const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content') || '';\n\n            // Check unknown Discord status\n            fetch('/admin/refresh_unknown_discord_status', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-CSRFToken': csrfToken\n                }\n            }).then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    Swal.fire({\n                        icon: 'success',\n                        title: 'Status Checked',\n                        text: `Checked Discord status for ${data.success_count} players with unknown status`,\n                        timer: 2000,\n                        showConfirmButton: false\n                    }).then(() => {\n                        location.reload();\n                    });\n                } else {\n                    throw new Error(data.message || 'Failed to check unknown status');\n                }\n            }).catch(error => {\n                Swal.fire({\n                    icon: 'error',\n                    title: 'Error',\n                    text: 'Failed to check unknown status: ' + error.message,\n                    confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : '#ea5455'\n                });\n            }).finally(() => {\n                btn.innerHTML = originalText;\n                btn.disabled = false;\n            });\n        }\n    });\n});\n\n/**\n * Refresh Player Status Action\n * Refreshes Discord status for individual player\n */\nEventDelegation.register('refresh-player-status', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const playerName = element.dataset.playerName;\n\n    if (!playerId) {\n        console.error('[refresh-player-status] Missing player ID');\n        return;\n    }\n\n    const originalText = element.innerHTML;\n    element.innerHTML = '<i class=\"ti ti-loader ti-spin me-1\"></i><span>Checking...</span>';\n    element.disabled = true;\n\n    // Get CSRF token\n    const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content') || '';\n\n    fetch(`/teams/player/${playerId}/refresh-discord-status`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n            'X-CSRFToken': csrfToken\n        }\n    }).then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            // Show success message and reload\n            if (typeof Swal !== 'undefined') {\n                Swal.fire({\n                    icon: 'success',\n                    title: 'Status Updated',\n                    text: `Discord status refreshed for ${playerName}`,\n                    timer: 2000,\n                    showConfirmButton: false\n                }).then(() => {\n                    location.reload();\n                });\n            } else {\n                location.reload();\n            }\n        } else {\n            throw new Error(data.message || 'Failed to refresh status');\n        }\n    }).catch(error => {\n        if (typeof Swal !== 'undefined') {\n            Swal.fire({\n                icon: 'error',\n                title: 'Error',\n                text: 'Failed to refresh status: ' + error.message,\n                confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : '#ea5455'\n            });\n        } else {\n            console.error('[refresh-player-status] Error:', error);\n        }\n    }).finally(() => {\n        element.innerHTML = originalText;\n        element.disabled = false;\n    });\n});\n\n/**\n * Send Discord DM Action\n * Opens modal to send Discord direct message\n */\nEventDelegation.register('send-discord-dm', function(element, e) {\n    e.preventDefault();\n\n    const discordId = element.dataset.discordId;\n    const playerName = element.dataset.playerName;\n\n    if (!discordId) {\n        console.error('[send-discord-dm] Missing Discord ID');\n        return;\n    }\n\n    const dmDiscordIdInput = document.getElementById('dmDiscordId');\n    const modalTitle = document.querySelector('#discordDMModal .modal-title');\n    const dmMessageTextarea = document.getElementById('dmMessage');\n\n    if (dmDiscordIdInput) dmDiscordIdInput.value = discordId;\n    if (modalTitle) modalTitle.textContent = `Send Discord DM to ${playerName}`;\n\n    // Set default message\n    const defaultMessage = `Hi ${playerName}! \n\nWe noticed you haven't joined our ECS FC Discord server yet.\n\nJoin us to:\n Get match updates and announcements\n Connect with your teammates\n Participate in league discussions\n\nJoin here: https://discord.gg/weareecs\n\nSee you there!\n- ECS FC Admin Team`;\n\n    if (dmMessageTextarea) dmMessageTextarea.value = defaultMessage;\n\n    // Show modal\n    const modalElement = document.getElementById('discordDMModal');\n    if (modalElement) {\n        ModalManager.show('discordDMModal');\n    }\n});\n\n/**\n * Submit Discord DM Action\n * Sends the Discord direct message\n */\nEventDelegation.register('submit-discord-dm', function(element, e) {\n    e.preventDefault();\n\n    const discordId = document.getElementById('dmDiscordId')?.value;\n    const message = document.getElementById('dmMessage')?.value;\n\n    if (!message || !message.trim()) {\n        if (typeof Swal !== 'undefined') {\n            Swal.fire({\n                icon: 'warning',\n                title: 'Message Required',\n                text: 'Please enter a message before sending',\n                confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('warning') : '#ffab00'\n            });\n        }\n        return;\n    }\n\n    const originalText = element.innerHTML;\n    element.innerHTML = '<i class=\"ti ti-loader ti-spin me-1\"></i>Sending...';\n    element.disabled = true;\n\n    // Get CSRF token\n    const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content') || '';\n\n    fetch('/admin/send_discord_dm', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n            'X-CSRFToken': csrfToken\n        },\n        body: JSON.stringify({\n            discord_id: discordId,\n            message: message\n        })\n    }).then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            const modalElement = document.getElementById('discordDMModal');\n            if (modalElement && window.bootstrap) {\n                const modalInstance = bootstrap.Modal.getInstance(modalElement);\n                if (modalInstance) modalInstance.hide();\n            }\n\n            if (typeof Swal !== 'undefined') {\n                Swal.fire({\n                    icon: 'success',\n                    title: 'Message Sent',\n                    text: 'Discord message sent successfully!',\n                    timer: 2000,\n                    showConfirmButton: false\n                });\n            }\n        } else {\n            throw new Error(data.message || 'Failed to send message');\n        }\n    }).catch(error => {\n        if (typeof Swal !== 'undefined') {\n            Swal.fire({\n                icon: 'error',\n                title: 'Error',\n                text: 'Failed to send Discord message: ' + error.message,\n                confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : '#ea5455'\n            });\n        } else {\n            console.error('[submit-discord-dm] Error:', error);\n        }\n    }).finally(() => {\n        element.innerHTML = originalText;\n        element.disabled = false;\n    });\n});\n\n// ============================================================================\n// REFEREE MANAGEMENT ACTIONS\n// ============================================================================\n\n/**\n * Assign Referee Action\n * Assigns a referee to a match via form submission\n */\nEventDelegation.register('assign-referee', function(element, e) {\n    e.preventDefault();\n\n    const matchId = document.getElementById('matchId')?.value;\n    const refId = document.getElementById('refSelect')?.value;\n\n    if (!matchId || !refId) {\n        console.error('[assign-referee] Missing match ID or referee ID');\n        return;\n    }\n\n    // Call global function if exists\n    if (typeof assignReferee === 'function') {\n        assignReferee(e);\n    } else {\n        console.error('[assign-referee] assignReferee function not found');\n    }\n});\n\n/**\n * Remove Referee Action\n * Removes a referee from a match\n */\nEventDelegation.register('remove-referee', function(element, e) {\n    e.preventDefault();\n\n    const matchId = element.dataset.matchId || document.getElementById('matchId')?.value;\n\n    if (!matchId) {\n        console.error('[remove-referee] Missing match ID');\n        return;\n    }\n\n    // Call global function if exists\n    if (typeof removeReferee === 'function') {\n        removeReferee();\n    } else {\n        console.error('[remove-referee] removeReferee function not found');\n    }\n});\n\n/**\n * Refresh Calendar Action\n * Reloads calendar events and available referees list\n */\nEventDelegation.register('refresh-calendar', function(element, e) {\n    e.preventDefault();\n\n    // Check for calendar-specific refresh function\n    if (typeof loadCalendarEvents === 'function' && typeof fetchAvailableReferees === 'function') {\n        loadCalendarEvents();\n        // Get calendar instance if available\n        if (window.calendarInstance) {\n            fetchAvailableReferees(window.calendarInstance.getDate());\n        } else {\n            fetchAvailableReferees(new Date());\n        }\n    } else if (typeof window.refreshCalendar === 'function') {\n        window.refreshCalendar();\n    } else {\n        console.error('[refresh-calendar] No refresh function available');\n    }\n});\n\n/**\n * View Referee Profile Action\n * Opens modal or page with referee details\n */\nEventDelegation.register('view-referee-profile', function(element, e) {\n    e.preventDefault();\n\n    const refereeId = element.dataset.refereeId;\n\n    if (!refereeId) {\n        console.error('[view-referee-profile] Missing referee ID');\n        return;\n    }\n\n    if (typeof viewRefereeProfile === 'function') {\n        viewRefereeProfile(refereeId);\n    } else {\n        // Fallback: navigate to referee profile page\n        const profileUrl = element.dataset.profileUrl || `/admin/referee/${refereeId}`;\n        window.location.href = profileUrl;\n    }\n});\n\n/**\n * Update Referee Status Action\n * Updates referee availability status\n */\nEventDelegation.register('update-referee-status', function(element, e) {\n    e.preventDefault();\n\n    const refereeId = element.dataset.refereeId;\n    const status = element.dataset.status;\n\n    if (!refereeId || !status) {\n        console.error('[update-referee-status] Missing referee ID or status');\n        return;\n    }\n\n    if (typeof updateRefereeStatus === 'function') {\n        updateRefereeStatus(refereeId, status);\n    } else {\n        console.error('[update-referee-status] updateRefereeStatus function not found');\n    }\n});\n\n// ============================================================================\n// SUBSTITUTE POOL MANAGEMENT ACTIONS\n// ============================================================================\n\n/**\n * Approve Pool Player Action\n * Adds a pending player to the active substitute pool\n */\nEventDelegation.register('approve-pool-player', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const league = element.dataset.league;\n\n    if (!playerId || !league) {\n        console.error('[approve-pool-player] Missing required data attributes');\n        return;\n    }\n\n    if (typeof approvePlayer === 'function') {\n        approvePlayer(playerId, league);\n    } else {\n        console.error('[approve-pool-player] approvePlayer function not found');\n    }\n});\n\n/**\n * Remove Pool Player Action\n * Removes a player from the active substitute pool\n */\nEventDelegation.register('remove-pool-player', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const league = element.dataset.league;\n\n    if (!playerId || !league) {\n        console.error('[remove-pool-player] Missing required data attributes');\n        return;\n    }\n\n    if (typeof removePlayer === 'function') {\n        removePlayer(playerId, league);\n    } else {\n        console.error('[remove-pool-player] removePlayer function not found');\n    }\n});\n\n/**\n * Edit Pool Preferences Action\n * Opens modal to edit player's substitute pool preferences\n */\nEventDelegation.register('edit-pool-preferences', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const league = element.dataset.league;\n\n    if (!playerId || !league) {\n        console.error('[edit-pool-preferences] Missing required data attributes');\n        return;\n    }\n\n    if (typeof openEditPreferencesModal === 'function') {\n        openEditPreferencesModal(playerId, league);\n    } else {\n        console.error('[edit-pool-preferences] openEditPreferencesModal function not found');\n    }\n});\n\n/**\n * View Pool Player Details Action\n * Opens modal with detailed player information\n */\nEventDelegation.register('view-pool-player-details', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n\n    if (!playerId) {\n        console.error('[view-pool-player-details] Missing player ID');\n        return;\n    }\n\n    if (typeof openPlayerDetailsModal === 'function') {\n        openPlayerDetailsModal(playerId);\n    } else {\n        console.error('[view-pool-player-details] openPlayerDetailsModal function not found');\n    }\n});\n\n/**\n * Add Player to League Action\n * Adds a player to a specific league's substitute pool (from search results)\n */\nEventDelegation.register('add-player-to-league', function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const league = element.dataset.league;\n\n    if (!playerId || !league) {\n        console.error('[add-player-to-league] Missing required data attributes');\n        return;\n    }\n\n    if (typeof approvePlayer === 'function') {\n        approvePlayer(playerId, league);\n    } else {\n        console.error('[add-player-to-league] approvePlayer function not found');\n    }\n});\n\n/**\n * Toggle Pool View Action\n * Switches between grid and list view for substitute pool\n */\nEventDelegation.register('toggle-pool-view', function(element, e) {\n    e.preventDefault();\n\n    const view = element.dataset.view;\n    const league = element.dataset.league;\n    const section = element.dataset.section;\n\n    if (!view || !league || !section) {\n        console.error('[toggle-pool-view] Missing required data attributes');\n        return;\n    }\n\n    // Update button states\n    const siblings = element.parentElement.querySelectorAll('.view-toggle');\n    siblings.forEach(btn => btn.classList.remove('active'));\n    element.classList.add('active');\n\n    // Show/hide views\n    const listView = document.getElementById(`${section}-list-${league}`);\n    const gridView = document.getElementById(`${section}-grid-${league}`);\n\n    if (view === 'list') {\n        if (listView) listView.classList.remove('u-hidden');\n        if (gridView) gridView.classList.add('u-hidden');\n    } else {\n        if (listView) listView.classList.add('u-hidden');\n        if (gridView) gridView.classList.remove('u-hidden');\n    }\n});\n\n/**\n * Filter Pool Action (triggered by input event)\n * Filters player cards by search text\n */\nEventDelegation.register('filter-pool', function(element, e) {\n    const filterText = element.value.toLowerCase().trim();\n    const league = element.dataset.league;\n    const section = element.dataset.section;\n\n    if (!league || !section) {\n        console.error('[filter-pool] Missing required data attributes');\n        return;\n    }\n\n    if (typeof filterPlayerCards === 'function') {\n        filterPlayerCards(league, section, filterText);\n    } else {\n        // Fallback implementation\n        const cards = document.querySelectorAll(\n            `.player-card[data-league=\"${league}\"][data-status=\"${section}\"], ` +\n            `.player-list-item[data-league=\"${league}\"][data-status=\"${section}\"]`\n        );\n\n        cards.forEach(card => {\n            const searchText = (card.dataset.searchText || '').toLowerCase();\n            const shouldShow = !filterText || searchText.includes(filterText);\n            card.classList.toggle('u-hidden', !shouldShow);\n        });\n    }\n});\n\n/**\n * Manage League Pool Action\n * Opens modal for league-specific pool management\n */\nEventDelegation.register('manage-league-pool', function(element, e) {\n    e.preventDefault();\n\n    const league = element.dataset.league;\n\n    if (!league) {\n        console.error('[manage-league-pool] Missing league identifier');\n        return;\n    }\n\n    if (typeof openLeagueManagementModal === 'function') {\n        openLeagueManagementModal(league);\n    } else {\n        console.error('[manage-league-pool] openLeagueManagementModal function not found');\n    }\n});\n\n/**\n * Save Pool Preferences Action\n * Saves edited preferences for a substitute pool player\n */\nEventDelegation.register('save-pool-preferences', function(element, e) {\n    e.preventDefault();\n\n    if (typeof savePreferences === 'function') {\n        savePreferences();\n    } else {\n        console.error('[save-pool-preferences] savePreferences function not found');\n    }\n});\n\n/**\n * Pagination Click Handler for Pool Pages\n * Handles page navigation for substitute pool pagination\n */\nEventDelegation.register('pool-pagination', function(element, e) {\n    e.preventDefault();\n\n    const page = parseInt(element.dataset.page);\n    const league = element.dataset.league;\n    const section = element.dataset.section;\n\n    if (!page || !league || !section) {\n        console.error('[pool-pagination] Missing required data attributes');\n        return;\n    }\n\n    const key = `${league}-${section}`;\n\n    if (typeof paginationState !== 'undefined' && paginationState[key]) {\n        if (page !== paginationState[key].currentPage) {\n            paginationState[key].currentPage = page;\n            if (typeof updatePagination === 'function') {\n                updatePagination(league, section);\n            }\n        }\n    }\n});\n\n/**\n * Add to Pool Action (Admin Panel variant)\n * Adds a player to substitute pool (admin panel version)\n */\nEventDelegation.register('add-to-pool', async function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n\n    if (!playerId) {\n        console.error('[add-to-pool] Missing player ID');\n        return;\n    }\n\n    // Check if addToPool function exists (from substitute_pool_detail.html)\n    if (typeof addToPool === 'function') {\n        addToPool(playerId);\n    } else {\n        console.error('[add-to-pool] addToPool function not found');\n    }\n});\n\n/**\n * Reject Player Action (Admin Panel)\n * Rejects a player from being added to substitute pool\n */\nEventDelegation.register('reject-player', async function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const playerName = element.dataset.playerName;\n\n    if (!playerId) {\n        console.error('[reject-player] Missing player ID');\n        return;\n    }\n\n    // Check if rejectPlayer function exists (from substitute_pool_detail.html)\n    if (typeof rejectPlayer === 'function') {\n        rejectPlayer(playerId, playerName);\n    } else {\n        console.error('[reject-player] rejectPlayer function not found');\n    }\n});\n\n/**\n * Remove Player Action (Admin Panel variant)\n * Removes player from pool (maps to remove-pool-player for compatibility)\n */\nEventDelegation.register('remove-player', async function(element, e) {\n    e.preventDefault();\n\n    const playerId = element.dataset.playerId;\n    const playerName = element.dataset.playerName;\n\n    if (!playerId) {\n        console.error('[remove-player] Missing player ID');\n        return;\n    }\n\n    // Check if removeFromPool function exists (from substitute_pool_detail.html)\n    if (typeof removeFromPool === 'function') {\n        removeFromPool(playerId, playerName);\n    } else {\n        console.error('[remove-player] removeFromPool function not found');\n    }\n});\n\n/**\n * Load Stats Action (Admin Panel)\n * Opens statistics modal for substitute pool\n */\nEventDelegation.register('load-stats', async function(element, e) {\n    e.preventDefault();\n\n    if (typeof loadStatistics === 'function') {\n        loadStatistics();\n    } else {\n        console.error('[load-stats] loadStatistics function not found');\n    }\n});\n\n/**\n * Add Player Action (Admin Panel)\n * Opens modal to add player to substitute pool\n */\nEventDelegation.register('add-player', function(element, e) {\n    e.preventDefault();\n\n    if (typeof showAddPlayerModal === 'function') {\n        showAddPlayerModal();\n    } else {\n        console.error('[add-player] showAddPlayerModal function not found');\n    }\n});\n\n// ============================================================================\n// ONBOARDING WIZARD ACTIONS\n// ============================================================================\n\n/**\n * Create Profile Action\n * User clicks \"Create Profile\" button on intro screen\n * Advances carousel to first step and sets form action\n */\nEventDelegation.register('onboarding-create-profile', function(element, e) {\n    e.preventDefault();\n\n    const formActionInput = document.getElementById('form_action');\n    if (formActionInput) formActionInput.value = 'create_profile';\n\n    // Get bootstrap carousel instance and advance to next slide\n    const carouselElement = document.getElementById('modalCarouselControls');\n    if (carouselElement && window.bootstrap) {\n        const bootstrapCarousel = bootstrap.Carousel.getInstance(carouselElement) ||\n                                 new bootstrap.Carousel(carouselElement);\n        bootstrapCarousel.next();\n    }\n});\n\n/**\n * Skip Profile Action\n * User clicks \"Skip for now\" button on intro screen\n * Submits form with skip_profile action\n */\nEventDelegation.register('onboarding-skip-profile', function(element, e) {\n    e.preventDefault();\n\n    const formActionInput = document.getElementById('form_action');\n    const modalElement = document.getElementById('onboardingSlideModal');\n    const form = modalElement ? modalElement.querySelector('form.needs-validation') : null;\n\n    if (formActionInput) formActionInput.value = 'skip_profile';\n    if (form) form.submit();\n});\n\n/**\n * Next/Save Button Action\n * Handles \"Next\" button clicks (validation + navigation) and \"Save and Finish\" on final step\n * Validates current step before advancing, or submits form on final step\n */\nEventDelegation.register('onboarding-next', function(element, e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (!window.OnboardingWizard) {\n        console.error('[onboarding-next] OnboardingWizard not initialized');\n        return;\n    }\n\n    const { form, formActionInput, croppedImageHiddenInput, carouselElement, bootstrapCarousel, totalSteps } =\n        window.OnboardingWizard.getFormElements();\n\n    const step = window.OnboardingWizard.getCurrentStep();\n\n    // Final step - save and finish\n    if (step === totalSteps) {\n        if (formActionInput) formActionInput.value = 'update_profile';\n\n        // Final check for any cropping\n        if (window.cropper) {\n            try {\n                const canvas = window.cropper.getCroppedCanvas();\n                if (canvas) {\n                    croppedImageHiddenInput.value = canvas.toDataURL('image/png');\n                }\n            } catch (err) {\n                console.error('[onboarding-next] Error getting cropped image:', err);\n            }\n        }\n\n        // Validate form\n        if (form && form.checkValidity()) {\n            form.submit();\n        } else {\n            form.classList.add('was-validated');\n\n            // Find first invalid input and focus it\n            const firstInvalid = form.querySelector(':invalid');\n            if (firstInvalid) {\n                firstInvalid.focus();\n                firstInvalid.scrollIntoView({\n                    behavior: 'smooth',\n                    block: 'center'\n                });\n            }\n        }\n    } else {\n        // Validate current step's required fields before moving to next\n        const activeItem = carouselElement ? carouselElement.querySelector('.carousel-item.active') : null;\n        const requiredFields = activeItem ? activeItem.querySelectorAll('input[required], select[required], textarea[required]') : [];\n        let isValid = true;\n\n        // Check if all required fields in current step are filled\n        requiredFields.forEach(field => {\n            // Skip hidden fields or fields that are part of hidden sections\n            if (field.offsetParent === null) return;\n\n            if (!field.checkValidity()) {\n                isValid = false;\n                field.classList.add('is-invalid');\n\n                // Add validation feedback if it doesn't exist\n                if (!field.nextElementSibling || !field.nextElementSibling.classList.contains('invalid-feedback')) {\n                    const feedback = document.createElement('div');\n                    feedback.className = 'invalid-feedback';\n                    feedback.textContent = field.validationMessage || 'This field is required.';\n                    field.parentNode.insertBefore(feedback, field.nextSibling);\n                }\n            } else {\n                field.classList.remove('is-invalid');\n            }\n        });\n\n        if (isValid) {\n            // Clear form action and manually move to next step\n            if (formActionInput) formActionInput.value = '';\n            if (bootstrapCarousel) {\n                bootstrapCarousel.next();\n            }\n        } else {\n            // Focus first invalid field\n            const firstInvalid = activeItem ? activeItem.querySelector('.is-invalid') : null;\n            if (firstInvalid) {\n                firstInvalid.focus();\n                firstInvalid.scrollIntoView({\n                    behavior: 'smooth',\n                    block: 'center'\n                });\n            }\n        }\n    }\n});\n\n/**\n * Previous Button Action\n * Navigates to previous step in onboarding carousel\n */\nEventDelegation.register('onboarding-previous', function(element, e) {\n    e.preventDefault();\n\n    const carouselElement = document.getElementById('modalCarouselControls');\n    if (carouselElement && window.bootstrap) {\n        const bootstrapCarousel = bootstrap.Carousel.getInstance(carouselElement);\n        if (bootstrapCarousel) bootstrapCarousel.prev();\n    }\n});\n\n/**\n * Toggle SMS Notifications Section\n * Shows/hides SMS opt-in section with animation when checkbox changes\n * Triggered by data-on-change attribute on SMS toggle checkbox\n */\nEventDelegation.register('onboarding-toggle-sms', function(element, e) {\n    // Element is the checkbox that was changed\n    if (window.OnboardingWizard && typeof window.OnboardingWizard.handleSmsToggle === 'function') {\n        window.OnboardingWizard.handleSmsToggle(element);\n    } else {\n        console.error('[onboarding-toggle-sms] SMS toggle handler not available');\n    }\n});\n\n// ============================================================================\n// SECURITY DASHBOARD ACTIONS\n// ============================================================================\n\n/**\n * Refresh Security Stats Action\n * Refreshes all security dashboard data (stats, events, logs)\n */\nEventDelegation.register('refresh-stats', async function(element, e) {\n    e.preventDefault();\n\n    if (window.securityDashboard && typeof window.securityDashboard.refreshAll === 'function') {\n        await window.securityDashboard.refreshAll();\n    } else {\n        console.error('[refresh-stats] SecurityDashboard instance not available');\n    }\n});\n\n/**\n * Refresh Security Events Action\n * Reloads recent security events list\n */\nEventDelegation.register('refresh-events', async function(element, e) {\n    e.preventDefault();\n\n    if (window.securityDashboard && typeof window.securityDashboard.loadSecurityEvents === 'function') {\n        await window.securityDashboard.loadSecurityEvents();\n    } else {\n        console.error('[refresh-events] SecurityDashboard instance not available');\n    }\n});\n\n/**\n * Refresh Security Logs Action\n * Reloads security logs display\n */\nEventDelegation.register('refresh-logs', async function(element, e) {\n    e.preventDefault();\n\n    if (window.securityDashboard && typeof window.securityDashboard.loadSecurityLogs === 'function') {\n        await window.securityDashboard.loadSecurityLogs();\n    } else {\n        console.error('[refresh-logs] SecurityDashboard instance not available');\n    }\n});\n\n/**\n * Unban IP Action\n * Removes an IP address from the blacklist\n */\nEventDelegation.register('unban-ip', async function(element, e) {\n    e.preventDefault();\n\n    const ip = element.dataset.ip;\n\n    if (!ip) {\n        console.error('[unban-ip] Missing IP address');\n        return;\n    }\n\n    if (window.securityDashboard && typeof window.securityDashboard.unbanIP === 'function') {\n        await window.securityDashboard.unbanIP(ip, element);\n    } else {\n        console.error('[unban-ip] SecurityDashboard instance not available');\n    }\n});\n\n/**\n * Quick Ban IP Action\n * Quickly bans an IP from the security events list\n */\nEventDelegation.register('ban-ip-quick', async function(element, e) {\n    e.preventDefault();\n\n    const ip = element.dataset.ip;\n    const reason = element.dataset.reason || 'Security event';\n\n    if (!ip) {\n        console.error('[ban-ip-quick] Missing IP address');\n        return;\n    }\n\n    if (window.securityDashboard && typeof window.securityDashboard.quickBanIP === 'function') {\n        await window.securityDashboard.quickBanIP(ip, reason);\n    } else {\n        console.error('[ban-ip-quick] SecurityDashboard instance not available');\n    }\n});\n\n/**\n * Ban IP Confirm Action\n * Confirms and submits the ban IP form from the modal\n */\nEventDelegation.register('ban-ip-confirm', async function(element, e) {\n    e.preventDefault();\n\n    if (window.securityDashboard && typeof window.securityDashboard.banIP === 'function') {\n        await window.securityDashboard.banIP();\n    } else {\n        console.error('[ban-ip-confirm] SecurityDashboard instance not available');\n    }\n});\n\n/**\n * Clear All Bans Action\n * Removes all IP addresses from the blacklist\n */\nEventDelegation.register('clear-all-bans', async function(element, e) {\n    e.preventDefault();\n\n    if (window.securityDashboard && typeof window.securityDashboard.clearAllBans === 'function') {\n        await window.securityDashboard.clearAllBans();\n    } else if (typeof clearAllBans === 'function') {\n        // Admin panel version\n        await clearAllBans();\n    } else {\n        console.error('[clear-all-bans] No clearAllBans function available');\n    }\n});\n\n/**\n * Show Ban IP Modal Action (Admin Panel)\n * Opens the modal to manually ban an IP address\n */\nEventDelegation.register('show-ban-ip-modal', function(element, e) {\n    e.preventDefault();\n\n    if (typeof showBanIpModal === 'function') {\n        showBanIpModal();\n    } else if (window.bootstrap) {\n        // Fallback: directly show the modal\n        const modalElement = document.getElementById('banIpModal');\n        if (modalElement) {\n            ModalManager.show('banIpModal');\n        }\n    } else {\n        console.error('[show-ban-ip-modal] No showBanIpModal function available');\n    }\n});\n\n/**\n * Ban IP Action (Admin Panel)\n * Submits the ban IP form from the admin panel modal\n */\nEventDelegation.register('ban-ip', async function(element, e) {\n    e.preventDefault();\n\n    if (typeof banIp === 'function') {\n        await banIp();\n    } else if (window.securityDashboard && typeof window.securityDashboard.banIP === 'function') {\n        await window.securityDashboard.banIP();\n    } else {\n        console.error('[ban-ip] No banIp function available');\n    }\n});\n\n// ============================================================================\n// AUTO SCHEDULE WIZARD ACTIONS\n// ============================================================================\n\n/**\n * Start Season Wizard Action\n * Opens the season builder wizard modal\n */\nEventDelegation.register('start-season-wizard', function(element, e) {\n    e.preventDefault();\n\n    if (typeof startSeasonWizard === 'function') {\n        startSeasonWizard();\n    } else {\n        console.error('[start-season-wizard] startSeasonWizard function not found');\n    }\n});\n\n/**\n * Show Existing Seasons Action\n * Displays the list of existing seasons\n */\nEventDelegation.register('show-existing-seasons', function(element, e) {\n    e.preventDefault();\n\n    if (typeof showExistingSeasons === 'function') {\n        showExistingSeasons();\n    } else {\n        console.error('[show-existing-seasons] showExistingSeasons function not found');\n    }\n});\n\n/**\n * Show Main View Action\n * Returns to main season builder view\n */\nEventDelegation.register('show-main-view', function(element, e) {\n    e.preventDefault();\n\n    if (typeof showMainView === 'function') {\n        showMainView();\n    } else {\n        console.error('[show-main-view] showMainView function not found');\n    }\n});\n\n/**\n * Next Step Action (Wizard Navigation)\n * Advances to the next step in the wizard\n */\nEventDelegation.register('next-step', function(element, e) {\n    e.preventDefault();\n\n    if (typeof nextStep === 'function') {\n        nextStep();\n    } else {\n        console.error('[next-step] nextStep function not found');\n    }\n});\n\n/**\n * Previous Step Action (Wizard Navigation)\n * Goes back to the previous step in the wizard\n */\nEventDelegation.register('previous-step', function(element, e) {\n    e.preventDefault();\n\n    if (typeof previousStep === 'function') {\n        previousStep();\n    } else {\n        console.error('[previous-step] previousStep function not found');\n    }\n});\n\n/**\n * Create Season Action\n * Submits the wizard and creates the season\n */\nEventDelegation.register('create-season', function(element, e) {\n    e.preventDefault();\n\n    if (typeof createSeason === 'function') {\n        createSeason();\n    } else {\n        console.error('[create-season] createSeason function not found');\n    }\n});\n\n/**\n * Update Season Structure Action\n * Updates season breakdown based on total weeks selection\n */\nEventDelegation.register('update-season-structure', function(element, e) {\n    if (typeof updateSeasonStructure === 'function') {\n        updateSeasonStructure();\n    } else {\n        console.error('[update-season-structure] updateSeasonStructure function not found');\n    }\n});\n\n/**\n * Apply Wizard Template Action\n * Applies a configuration template (standard, classic-practice, custom)\n */\nEventDelegation.register('apply-wizard-template', function(element, e) {\n    e.preventDefault();\n\n    const templateType = element.dataset.templateType;\n\n    if (!templateType) {\n        console.error('[apply-wizard-template] Missing template type');\n        return;\n    }\n\n    if (typeof applyWizardTemplate === 'function') {\n        applyWizardTemplate(templateType);\n    } else {\n        console.error('[apply-wizard-template] applyWizardTemplate function not found');\n    }\n});\n\n/**\n * Add Wizard Field Action\n * Adds a new field configuration row in the wizard\n */\nEventDelegation.register('add-wizard-field', function(element, e) {\n    e.preventDefault();\n\n    if (typeof addWizardField === 'function') {\n        addWizardField();\n    } else {\n        console.error('[add-wizard-field] addWizardField function not found');\n    }\n});\n\n/**\n * Remove Wizard Field Action\n * Removes a field configuration row from the wizard\n */\nEventDelegation.register('remove-wizard-field', function(element, e) {\n    e.preventDefault();\n\n    if (typeof removeWizardField === 'function') {\n        removeWizardField(element);\n    } else {\n        console.error('[remove-wizard-field] removeWizardField function not found');\n    }\n});\n\n/**\n * Set Active Season Action\n * Sets a season as the current active season\n */\nEventDelegation.register('set-active-season', function(element, e) {\n    e.preventDefault();\n\n    const seasonId = element.dataset.seasonId;\n    const seasonType = element.dataset.seasonType;\n\n    if (!seasonId || !seasonType) {\n        console.error('[set-active-season] Missing season ID or type');\n        return;\n    }\n\n    if (typeof setActiveSeason === 'function') {\n        setActiveSeason(seasonId, seasonType);\n    } else {\n        console.error('[set-active-season] setActiveSeason function not found');\n    }\n});\n\n/**\n * Confirm Delete Season Action\n * Shows confirmation dialog before deleting a season\n */\nEventDelegation.register('confirm-delete-season', function(element, e) {\n    e.preventDefault();\n\n    const seasonId = element.dataset.seasonId;\n    const seasonName = element.dataset.seasonName;\n\n    if (!seasonId || !seasonName) {\n        console.error('[confirm-delete-season] Missing season ID or name');\n        return;\n    }\n\n    if (typeof confirmDeleteSeason === 'function') {\n        confirmDeleteSeason(seasonId, seasonName);\n    } else {\n        console.error('[confirm-delete-season] confirmDeleteSeason function not found');\n    }\n});\n\n/**\n * Recreate Discord Resources Action\n * Recreates Discord channels and roles for a season\n */\nEventDelegation.register('recreate-discord-resources', function(element, e) {\n    e.preventDefault();\n\n    const seasonId = element.dataset.seasonId;\n    const seasonName = element.dataset.seasonName;\n\n    if (!seasonId || !seasonName) {\n        console.error('[recreate-discord-resources] Missing season ID or name');\n        return;\n    }\n\n    if (typeof recreateDiscordResources === 'function') {\n        recreateDiscordResources(seasonId, seasonName);\n    } else {\n        console.error('[recreate-discord-resources] recreateDiscordResources function not found');\n    }\n});\n\n/**\n * Toggle Settings Action (Schedule Preview)\n * Toggles visibility of schedule settings panel\n */\nEventDelegation.register('toggle-settings', function(element, e) {\n    e.preventDefault();\n\n    if (typeof toggleScheduleSettings === 'function') {\n        toggleScheduleSettings();\n    } else {\n        console.error('[toggle-settings] toggleScheduleSettings function not found');\n    }\n});\n\n/**\n * Delete Schedule Action (Schedule Preview)\n * Deletes the generated schedule\n */\nEventDelegation.register('delete-schedule', function(element, e) {\n    e.preventDefault();\n\n    if (typeof deleteSchedule === 'function') {\n        deleteSchedule();\n    } else {\n        console.error('[delete-schedule] deleteSchedule function not found');\n    }\n});\n\n/**\n * Commit Schedule Action (Schedule Preview)\n * Commits the schedule and creates matches\n */\nEventDelegation.register('commit-schedule', function(element, e) {\n    e.preventDefault();\n\n    if (typeof commitSchedule === 'function') {\n        commitSchedule();\n    } else {\n        console.error('[commit-schedule] commitSchedule function not found');\n    }\n});\n\n/**\n * Select for Swap Action (Schedule Preview)\n * Selects a match for team swapping\n */\nEventDelegation.register('select-for-swap', function(element, e) {\n    e.preventDefault();\n\n    const matchId = parseInt(element.dataset.matchId);\n    const matchDesc = element.dataset.matchDesc;\n\n    if (!matchId || !matchDesc) {\n        console.error('[select-for-swap] Missing match ID or description');\n        return;\n    }\n\n    if (typeof selectForSwap === 'function') {\n        selectForSwap(matchId, matchDesc);\n    } else {\n        console.error('[select-for-swap] selectForSwap function not found');\n    }\n});\n\n/**\n * Execute Swap Action (Schedule Preview)\n * Executes the team swap\n */\nEventDelegation.register('execute-swap', function(element, e) {\n    e.preventDefault();\n\n    if (typeof executeSwap === 'function') {\n        executeSwap();\n    } else {\n        console.error('[execute-swap] executeSwap function not found');\n    }\n});\n\n/**\n * Remove from Swap Action (Schedule Preview)\n * Removes a match from swap selection\n */\nEventDelegation.register('remove-from-swap', function(element, e) {\n    e.preventDefault();\n\n    const swapIndex = parseInt(element.dataset.swapIndex);\n\n    if (swapIndex === undefined || swapIndex === null) {\n        console.error('[remove-from-swap] Missing swap index');\n        return;\n    }\n\n    if (typeof removeFromSwap === 'function') {\n        removeFromSwap(swapIndex);\n    } else {\n        console.error('[remove-from-swap] removeFromSwap function not found');\n    }\n});\n\n/**\n * Remove Field Action (Config Page)\n * Removes a field from the configuration\n */\nEventDelegation.register('remove-field', function(element, e) {\n    e.preventDefault();\n\n    if (typeof removeField === 'function') {\n        removeField(element);\n    } else {\n        console.error('[remove-field] removeField function not found');\n    }\n});\n\n/**\n * Add Field Action (Config Page)\n * Adds a new field to the configuration\n */\nEventDelegation.register('add-field', function(element, e) {\n    e.preventDefault();\n\n    if (typeof addField === 'function') {\n        addField();\n    } else {\n        console.error('[add-field] addField function not found');\n    }\n});\n\n/**\n * Apply Template Action (Config Page)\n * Applies a configuration template\n */\nEventDelegation.register('apply-template', function(element, e) {\n    e.preventDefault();\n\n    const template = element.dataset.template;\n\n    if (!template) {\n        console.error('[apply-template] Missing template type');\n        return;\n    }\n\n    if (typeof applyTemplate === 'function') {\n        applyTemplate(template);\n    } else {\n        console.error('[apply-template] applyTemplate function not found');\n    }\n});\n\n/**\n * Add Week Config Action (Config Page)\n * Adds a new week configuration\n */\nEventDelegation.register('add-week-config', function(element, e) {\n    e.preventDefault();\n\n    if (typeof addWeekConfig === 'function') {\n        addWeekConfig();\n    } else {\n        console.error('[add-week-config] addWeekConfig function not found');\n    }\n});\n\n/**\n * Generate Default Weeks Action (Config Page)\n * Auto-generates default week configuration\n */\nEventDelegation.register('generate-default-weeks', function(element, e) {\n    e.preventDefault();\n\n    if (typeof generateDefaultWeeks === 'function') {\n        generateDefaultWeeks();\n    } else {\n        console.error('[generate-default-weeks] generateDefaultWeeks function not found');\n    }\n});\n\n/**\n * Clear Weeks Action (Config Page)\n * Clears all week configurations\n */\nEventDelegation.register('clear-weeks', function(element, e) {\n    e.preventDefault();\n\n    if (typeof clearWeeks === 'function') {\n        clearWeeks();\n    } else {\n        console.error('[clear-weeks] clearWeeks function not found');\n    }\n});\n\n/**\n * Update Week Card Action (Config Page)\n * Updates week type when dropdown changes\n */\nEventDelegation.register('update-week-card', function(element, e) {\n    if (typeof updateWeekCard === 'function') {\n        updateWeekCard(element);\n    } else {\n        console.error('[update-week-card] updateWeekCard function not found');\n    }\n});\n\n/**\n * Remove Week Card Action (Config Page)\n * Removes a week configuration\n */\nEventDelegation.register('remove-week-card', function(element, e) {\n    e.preventDefault();\n\n    if (typeof removeWeekCard === 'function') {\n        removeWeekCard(element);\n    } else {\n        console.error('[remove-week-card] removeWeekCard function not found');\n    }\n});\n\n/**\n * Close Toast Action\n * Closes/removes a toast notification\n */\nEventDelegation.register('close-toast', function(element, e) {\n    e.preventDefault();\n\n    // Remove the toast (parent element)\n    if (element.parentElement) {\n        element.parentElement.remove();\n    }\n});\n\n// ============================================================================\n// PASS STUDIO ACTIONS\n// ============================================================================\n\n/**\n * Platform Toggle Action\n * Switches between Apple and Google wallet preview\n */\nEventDelegation.register('toggle-platform', function(element, e) {\n    e.preventDefault();\n\n    const platform = element.dataset.platform;\n\n    if (!platform) {\n        console.error('[toggle-platform] Missing platform attribute');\n        return;\n    }\n\n    if (window.PassStudio && typeof window.PassStudio.setPreviewPlatform === 'function') {\n        window.PassStudio.setPreviewPlatform(platform);\n    } else {\n        console.error('[toggle-platform] PassStudio.setPreviewPlatform not available');\n    }\n});\n\n/**\n * Update Pass Style Action\n * Changes pass layout style (generic, storeCard, eventTicket)\n * Triggered by change event on radio buttons\n */\nEventDelegation.register('update-pass-style', function(element, e) {\n    if (window.PassStudio && typeof window.PassStudio.updatePassStylePreview === 'function') {\n        window.PassStudio.updatePassStylePreview();\n    } else {\n        console.error('[update-pass-style] PassStudio.updatePassStylePreview not available');\n    }\n});\n\n/**\n * Apply Color Preset Action\n * Applies predefined color schemes to the pass\n */\nEventDelegation.register('apply-color-preset', function(element, e) {\n    e.preventDefault();\n\n    const bg = element.dataset.bg;\n    const fg = element.dataset.fg;\n    const label = element.dataset.label;\n\n    if (!bg || !fg || !label) {\n        console.error('[apply-color-preset] Missing color data attributes');\n        return;\n    }\n\n    // Set color inputs\n    const bgColorInput = document.getElementById('background_color');\n    const fgColorInput = document.getElementById('foreground_color');\n    const labelColorInput = document.getElementById('label_color');\n\n    if (bgColorInput) bgColorInput.value = bg;\n    if (fgColorInput) fgColorInput.value = fg;\n    if (labelColorInput) labelColorInput.value = label;\n\n    // Set text inputs\n    const bgColorText = document.getElementById('background_color_text');\n    const fgColorText = document.getElementById('foreground_color_text');\n    const labelColorText = document.getElementById('label_color_text');\n\n    if (bgColorText) bgColorText.value = bg;\n    if (fgColorText) fgColorText.value = fg;\n    if (labelColorText) labelColorText.value = label;\n\n    // Update preview\n    if (window.PassStudio && typeof window.PassStudio.updatePreviewFromForm === 'function') {\n        window.PassStudio.updatePreviewFromForm();\n    }\n\n    // Mark unsaved\n    if (window.PassStudio && typeof window.PassStudio.markUnsaved === 'function') {\n        window.PassStudio.markUnsaved();\n    }\n});\n\n/**\n * Sync Color Input Action\n * Syncs color picker with text input and vice versa\n */\nEventDelegation.register('sync-color-input', function(element, e) {\n    const targetId = element.dataset.target;\n    if (!targetId) return;\n\n    const target = document.getElementById(targetId);\n    if (!target) return;\n\n    // Sync the values\n    if (element.type === 'color') {\n        // Color picker changed - update text input\n        const textInput = document.getElementById(targetId + '_text');\n        if (textInput) textInput.value = element.value;\n    } else {\n        // Text input changed - update color picker\n        target.value = element.value;\n    }\n\n    // Update preview\n    if (window.PassStudio && typeof window.PassStudio.updatePreviewFromForm === 'function') {\n        window.PassStudio.updatePreviewFromForm();\n    }\n});\n\n/**\n * Update Preview Field Action\n * Updates specific field in preview (e.g., logo text)\n */\nEventDelegation.register('update-preview-field', function(element, e) {\n    if (window.PassStudio && typeof window.PassStudio.updatePreviewFromForm === 'function') {\n        window.PassStudio.updatePreviewFromForm();\n    }\n});\n\n/**\n * Toggle Logo Visibility Action\n * Shows/hides logo in preview\n */\nEventDelegation.register('toggle-logo-visibility', function(element, e) {\n    if (window.PassStudio && typeof window.PassStudio.toggleLogoVisibility === 'function') {\n        window.PassStudio.toggleLogoVisibility();\n    }\n});\n\n/**\n * Open Asset Cropper Action\n * Opens modal to upload/crop pass assets\n */\nEventDelegation.register('open-asset-cropper', function(element, e) {\n    e.preventDefault();\n\n    const assetType = element.dataset.assetType;\n\n    if (!assetType) {\n        console.error('[open-asset-cropper] Missing asset type');\n        return;\n    }\n\n    if (window.PassStudio && typeof window.PassStudio.openAssetCropper === 'function') {\n        window.PassStudio.openAssetCropper(assetType);\n    } else {\n        console.error('[open-asset-cropper] PassStudio.openAssetCropper not available');\n    }\n});\n\n/**\n * Update Google Preview Action\n * Updates Google Wallet preview with URL changes\n */\nEventDelegation.register('update-google-preview', function(element, e) {\n    if (window.PassStudio && typeof window.PassStudio.updateGooglePreview === 'function') {\n        window.PassStudio.updateGooglePreview();\n    }\n});\n\n/**\n * Update Barcode Preview Action\n * Shows/hides barcode in preview\n */\nEventDelegation.register('update-barcode-preview', function(element, e) {\n    if (window.PassStudio && typeof window.PassStudio.updateBarcodePreview === 'function') {\n        window.PassStudio.updateBarcodePreview();\n    }\n});\n\n/**\n * Save Appearance Action\n * Saves appearance settings to server\n */\nEventDelegation.register('save-appearance', function(element, e) {\n    e.preventDefault();\n\n    if (window.PassStudio && typeof window.PassStudio.saveAppearance === 'function') {\n        window.PassStudio.saveAppearance();\n    } else {\n        console.error('[save-appearance] PassStudio.saveAppearance not available');\n    }\n});\n\n/**\n * Initialize Defaults Action\n * Loads default field configuration for pass\n */\nEventDelegation.register('initialize-defaults', function(element, e) {\n    e.preventDefault();\n\n    if (window.FieldsManager && typeof window.FieldsManager.initializeDefaults === 'function') {\n        window.FieldsManager.initializeDefaults();\n    } else {\n        console.error('[initialize-defaults] FieldsManager.initializeDefaults not available');\n    }\n});\n\n/**\n * Add Field Action\n * Opens modal to add new pass field\n */\nEventDelegation.register('add-field', function(element, e) {\n    e.preventDefault();\n\n    const fieldType = element.dataset.fieldType;\n\n    if (!fieldType) {\n        console.error('[add-field] Missing field type');\n        return;\n    }\n\n    if (window.FieldsManager && typeof window.FieldsManager.openAddFieldModal === 'function') {\n        window.FieldsManager.openAddFieldModal(fieldType);\n    } else {\n        console.error('[add-field] FieldsManager.openAddFieldModal not available');\n    }\n});\n\n/**\n * Create Field Action\n * Creates new field from modal data\n */\nEventDelegation.register('create-field', function(element, e) {\n    e.preventDefault();\n\n    if (window.FieldsManager && typeof window.FieldsManager.createField === 'function') {\n        window.FieldsManager.createField();\n    } else {\n        console.error('[create-field] FieldsManager.createField not available');\n    }\n});\n\n/**\n * Save Fields Action\n * Saves all field configurations to server\n */\nEventDelegation.register('save-fields', function(element, e) {\n    e.preventDefault();\n\n    if (window.FieldsManager && typeof window.FieldsManager.saveFields === 'function') {\n        window.FieldsManager.saveFields();\n    } else {\n        console.error('[save-fields] FieldsManager.saveFields not available');\n    }\n});\n\n/**\n * Reset Fields Action\n * Resets fields to last saved state\n */\nEventDelegation.register('reset-fields', function(element, e) {\n    e.preventDefault();\n\n    if (window.FieldsManager && typeof window.FieldsManager.resetFields === 'function') {\n        window.FieldsManager.resetFields();\n    } else {\n        console.error('[reset-fields] FieldsManager.resetFields not available');\n    }\n});\n\n/**\n * Insert Variable Action\n * Inserts template variable at cursor position\n */\nEventDelegation.register('insert-variable', function(element, e) {\n    e.preventDefault();\n\n    const variableName = element.dataset.variableName;\n\n    if (!variableName) {\n        console.error('[insert-variable] Missing variable name');\n        return;\n    }\n\n    if (window.FieldsManager && typeof window.FieldsManager.insertVariableInAdd === 'function') {\n        window.FieldsManager.insertVariableInAdd(variableName);\n    } else {\n        console.error('[insert-variable] FieldsManager.insertVariableInAdd not available');\n    }\n});\n\n// ============================================================================\n// USER APPROVAL MANAGEMENT ACTIONS\n// ============================================================================\n\n/**\n * Refresh Approval Stats Action\n * Manually refreshes user approval statistics display\n */\nEventDelegation.register('refresh-approval-stats', function(element, e) {\n    e.preventDefault();\n\n    if (typeof window.refreshStats === 'function') {\n        window.refreshStats();\n    } else {\n        console.error('[refresh-approval-stats] refreshStats function not found');\n    }\n});\n\n/**\n * Show Player Details Action\n * Opens modal showing detailed player information\n */\nEventDelegation.register('show-player-details', function(element, e) {\n    e.preventDefault();\n\n    const userId = element.dataset.userId;\n\n    if (!userId) {\n        console.error('[show-player-details] Missing user ID');\n        return;\n    }\n\n    if (typeof window.showPlayerDetails === 'function') {\n        window.showPlayerDetails(parseInt(userId));\n    } else {\n        console.error('[show-player-details] showPlayerDetails function not found');\n    }\n});\n\n/**\n * Show Approval Modal Action\n * Opens modal to approve a user and assign them to a league\n */\nEventDelegation.register('show-approval-modal', function(element, e) {\n    e.preventDefault();\n\n    const userId = element.dataset.userId;\n\n    if (!userId) {\n        console.error('[show-approval-modal] Missing user ID');\n        return;\n    }\n\n    if (typeof window.showApprovalModal === 'function') {\n        window.showApprovalModal(parseInt(userId));\n    } else {\n        console.error('[show-approval-modal] showApprovalModal function not found');\n    }\n});\n\n/**\n * Show Denial Modal Action\n * Opens modal to deny a user application\n */\nEventDelegation.register('show-denial-modal', function(element, e) {\n    e.preventDefault();\n\n    const userId = element.dataset.userId;\n\n    if (!userId) {\n        console.error('[show-denial-modal] Missing user ID');\n        return;\n    }\n\n    if (typeof window.showDenialModal === 'function') {\n        window.showDenialModal(parseInt(userId));\n    } else {\n        console.error('[show-denial-modal] showDenialModal function not found');\n    }\n});\n\n/**\n * Approve User Action\n * Submits user approval form\n */\nEventDelegation.register('approve-user', function(element, e) {\n    e.preventDefault();\n\n    if (typeof window.submitApproval === 'function') {\n        window.submitApproval();\n    } else {\n        console.error('[approve-user] submitApproval function not found');\n    }\n});\n\n/**\n * Deny User Action\n * Submits user denial form\n */\nEventDelegation.register('deny-user', function(element, e) {\n    e.preventDefault();\n\n    if (typeof window.submitDenial === 'function') {\n        window.submitDenial();\n    } else {\n        console.error('[deny-user] submitDenial function not found');\n    }\n});\n\n// Make globally available\nwindow.EventDelegation = EventDelegation;\n\n// Export for module systems\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = EventDelegation;\n}\n","/**\n * CSRF-Protected Fetch Utility\n *\n * Automatically adds CSRF token to all fetch requests with methods\n * that modify data (POST, PUT, DELETE, PATCH).\n *\n * Usage: Just use fetch() as normal - CSRF token is added automatically.\n *\n * The CSRF token is read from: <meta name=\"csrf-token\" content=\"...\">\n */\n\n(function() {\n    'use strict';\n\n    // Store the original fetch\n    const originalFetch = window.fetch;\n\n    // Methods that require CSRF protection\n    const CSRF_METHODS = ['POST', 'PUT', 'DELETE', 'PATCH'];\n\n    /**\n     * Get CSRF token from meta tag\n     */\n    function getCSRFToken() {\n        const meta = document.querySelector('meta[name=\"csrf-token\"]');\n        return meta ? meta.getAttribute('content') : null;\n    }\n\n    /**\n     * Enhanced fetch that automatically adds CSRF token\n     */\n    window.fetch = function(url, options = {}) {\n        // Determine the method (default is GET)\n        const method = (options.method || 'GET').toUpperCase();\n\n        // Only add CSRF token for methods that modify data\n        if (CSRF_METHODS.includes(method)) {\n            const csrfToken = getCSRFToken();\n\n            if (csrfToken) {\n                // Ensure headers object exists\n                options.headers = options.headers || {};\n\n                // Handle Headers object vs plain object\n                if (options.headers instanceof Headers) {\n                    if (!options.headers.has('X-CSRFToken')) {\n                        options.headers.set('X-CSRFToken', csrfToken);\n                    }\n                } else {\n                    // Plain object - only add if not already present\n                    if (!options.headers['X-CSRFToken'] && !options.headers['x-csrftoken']) {\n                        options.headers['X-CSRFToken'] = csrfToken;\n                    }\n                }\n            }\n        }\n\n        // Call the original fetch\n        return originalFetch.call(window, url, options);\n    };\n\n    // Also provide a named export for explicit usage\n    window.fetchWithCSRF = window.fetch;\n\n    console.debug('[CSRF] Fetch wrapper initialized');\n})();\n","/**\n * HELPERS MINIMAL\n * ================\n * Minimal replacement for Sneat/Vuexy helpers.js\n * Provides the same API but WITHOUT the problematic layout manipulation\n *\n * The original helpers.js injected inline styles that broke CSS Grid layouts.\n * This version provides the utility functions that main.js and other scripts need,\n * but removes all layout manipulation (_updateInlineStyle, update, etc.)\n */\n\n(function() {\n    'use strict';\n\n    const Helpers = {\n        // Root Element\n        ROOT_EL: document.documentElement,\n\n        // Large screens breakpoint (matches Bootstrap xl)\n        LAYOUT_BREAKPOINT: 1200,\n\n        // Resize delay in milliseconds\n        RESIZE_DELAY: 200,\n\n        // Internal state\n        _initialized: false,\n        _listeners: [],\n        _resizeCallback: null,\n        _resizeTimeout: null,\n        menuPsScroll: null,\n        mainMenu: null,\n\n        // *******************************************************************************\n        // * Tests / State Checks\n        // *******************************************************************************\n\n        isRtl: function() {\n            return document.querySelector('body')?.getAttribute('dir') === 'rtl' ||\n                   document.querySelector('html')?.getAttribute('dir') === 'rtl';\n        },\n\n        isMobileDevice: function() {\n            return typeof window.orientation !== 'undefined' ||\n                   navigator.userAgent.indexOf('IEMobile') !== -1;\n        },\n\n        isSmallScreen: function() {\n            return (window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth) < this.LAYOUT_BREAKPOINT;\n        },\n\n        isDarkStyle: function() {\n            return document.documentElement.getAttribute('data-style') === 'dark' ||\n                   document.documentElement.classList.contains('dark-style');\n        },\n\n        isLightStyle: function() {\n            return !this.isDarkStyle();\n        },\n\n        isCollapsed: function() {\n            if (this.isSmallScreen()) {\n                return !document.documentElement.classList.contains('layout-menu-expanded');\n            }\n            return document.documentElement.classList.contains('layout-menu-collapsed');\n        },\n\n        isFixed: function() {\n            return document.documentElement.classList.contains('layout-menu-fixed') ||\n                   document.documentElement.classList.contains('layout-menu-fixed-offcanvas');\n        },\n\n        isOffcanvas: function() {\n            return document.documentElement.classList.contains('layout-menu-offcanvas') ||\n                   document.documentElement.classList.contains('layout-menu-fixed-offcanvas');\n        },\n\n        isNavbarFixed: function() {\n            return document.documentElement.classList.contains('layout-navbar-fixed');\n        },\n\n        isFooterFixed: function() {\n            return document.documentElement.classList.contains('layout-footer-fixed');\n        },\n\n        isLayoutNavbarFull: function() {\n            return !!document.querySelector('.layout-wrapper.layout-navbar-full');\n        },\n\n        // *******************************************************************************\n        // * Getters\n        // *******************************************************************************\n\n        getLayoutMenu: function() {\n            return document.querySelector('.layout-menu, .c-sidebar');\n        },\n\n        getMenu: function() {\n            const layoutMenu = this.getLayoutMenu();\n            if (!layoutMenu) return null;\n            return layoutMenu.classList.contains('menu') ? layoutMenu : layoutMenu.querySelector('.menu');\n        },\n\n        getLayoutNavbar: function() {\n            return document.querySelector('.layout-navbar');\n        },\n\n        getLayoutFooter: function() {\n            return document.querySelector('.content-footer');\n        },\n\n        // *******************************************************************************\n        // * Class Helpers\n        // *******************************************************************************\n\n        _addClass: function(cls, el = this.ROOT_EL) {\n            if (!el) return;\n            const elements = el.length !== undefined ? el : [el];\n            elements.forEach(e => {\n                if (e) cls.split(' ').forEach(c => e.classList.add(c));\n            });\n        },\n\n        _removeClass: function(cls, el = this.ROOT_EL) {\n            if (!el) return;\n            const elements = el.length !== undefined ? el : [el];\n            elements.forEach(e => {\n                if (e) cls.split(' ').forEach(c => e.classList.remove(c));\n            });\n        },\n\n        _hasClass: function(cls, el = this.ROOT_EL) {\n            let result = false;\n            cls.split(' ').forEach(c => {\n                if (el.classList.contains(c)) result = true;\n            });\n            return result;\n        },\n\n        // *******************************************************************************\n        // * Sidebar / Menu Controls\n        // *******************************************************************************\n\n        setCollapsed: function(collapsed, animate = true) {\n            if (this.isSmallScreen()) {\n                if (collapsed) {\n                    this._removeClass('layout-menu-expanded');\n                    document.body.classList.remove('sidebar-open');\n                } else {\n                    this._addClass('layout-menu-expanded');\n                    document.body.classList.add('sidebar-open');\n                }\n            } else {\n                if (collapsed) {\n                    this._addClass('layout-menu-collapsed');\n                } else {\n                    this._removeClass('layout-menu-collapsed');\n                }\n            }\n            this._triggerEvent('toggle');\n        },\n\n        toggleCollapsed: function(animate = true) {\n            this.setCollapsed(!this.isCollapsed(), animate);\n        },\n\n        setNavbarFixed: function(fixed) {\n            if (fixed) {\n                this._addClass('layout-navbar-fixed');\n            } else {\n                this._removeClass('layout-navbar-fixed');\n            }\n        },\n\n        setFooterFixed: function(fixed) {\n            if (fixed) {\n                this._addClass('layout-footer-fixed');\n            } else {\n                this._removeClass('layout-footer-fixed');\n            }\n        },\n\n        // *******************************************************************************\n        // * Scroll Helpers\n        // *******************************************************************************\n\n        scrollToActive: function(animate = false) {\n            const layoutMenu = this.getLayoutMenu();\n            if (!layoutMenu) return;\n\n            const activeEl = layoutMenu.querySelector('li.menu-item.active:not(.open), .c-sidebar__item.is-active');\n            if (!activeEl) return;\n\n            const menuInner = layoutMenu.querySelector('.menu-inner, .c-sidebar__nav');\n            if (!menuInner) return;\n\n            // Only scroll if item is below 66% of menu height\n            const activeTop = activeEl.getBoundingClientRect().top - menuInner.getBoundingClientRect().top + menuInner.scrollTop;\n            if (activeTop < menuInner.clientHeight * 0.66) return;\n\n            const scrollTo = activeTop - menuInner.clientHeight / 2;\n            if (animate) {\n                menuInner.scrollTo({ top: scrollTo, behavior: 'smooth' });\n            } else {\n                menuInner.scrollTop = scrollTo;\n            }\n        },\n\n        // *******************************************************************************\n        // * Gesture Support (Mobile)\n        // *******************************************************************************\n\n        swipeIn: function(targetEl, callback) {\n            // Hammer.js gesture support - if available\n            if (typeof Hammer !== 'undefined' && typeof targetEl === 'string') {\n                const el = document.querySelector(targetEl);\n                if (el) {\n                    const hammer = new Hammer(el);\n                    hammer.on('panright', callback);\n                }\n            }\n        },\n\n        swipeOut: function(targetEl, callback) {\n            if (typeof Hammer !== 'undefined' && typeof targetEl === 'string') {\n                setTimeout(() => {\n                    const el = document.querySelector(targetEl);\n                    if (el) {\n                        const hammer = new Hammer(el);\n                        hammer.get('pan').set({ direction: Hammer.DIRECTION_ALL, threshold: 250 });\n                        hammer.on('panleft', callback);\n                    }\n                }, 500);\n            }\n        },\n\n        // *******************************************************************************\n        // * Form Helpers\n        // *******************************************************************************\n\n        initPasswordToggle: function() {\n            document.querySelectorAll('.form-password-toggle i').forEach(el => {\n                el.addEventListener('click', function(e) {\n                    e.preventDefault();\n                    const toggle = el.closest('.form-password-toggle');\n                    const input = toggle?.querySelector('input');\n                    const icon = toggle?.querySelector('i');\n                    if (input && icon) {\n                        if (input.type === 'text') {\n                            input.type = 'password';\n                            icon.classList.replace('ti-eye', 'ti-eye-off');\n                        } else {\n                            input.type = 'text';\n                            icon.classList.replace('ti-eye-off', 'ti-eye');\n                        }\n                    }\n                });\n            });\n        },\n\n        initCustomOptionCheck: function() {\n            document.querySelectorAll('.custom-option .form-check-input').forEach(el => {\n                this.updateCustomOptionCheck(el);\n                el.addEventListener('click', () => this.updateCustomOptionCheck(el));\n            });\n        },\n\n        updateCustomOptionCheck: function(el) {\n            if (el.checked) {\n                if (el.type === 'radio') {\n                    el.closest('.row')?.querySelectorAll('.custom-option').forEach(opt => {\n                        opt.classList.remove('checked');\n                    });\n                }\n                el.closest('.custom-option')?.classList.add('checked');\n            } else {\n                el.closest('.custom-option')?.classList.remove('checked');\n            }\n        },\n\n        initSpeechToText: function() {\n            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n            if (!SpeechRecognition) return;\n\n            document.querySelectorAll('.speech-to-text i').forEach(el => {\n                let listening = false;\n                el.addEventListener('click', function() {\n                    const input = el.closest('.input-group')?.querySelector('.form-control');\n                    if (!input) return;\n                    input.focus();\n\n                    const recognition = new SpeechRecognition();\n                    recognition.onspeechstart = () => { listening = true; };\n                    recognition.onerror = () => { listening = false; };\n                    recognition.onresult = (e) => { input.value = e.results[0][0].transcript; };\n                    recognition.onspeechend = () => { listening = false; recognition.stop(); };\n\n                    if (!listening) recognition.start();\n                });\n            });\n        },\n\n        // *******************************************************************************\n        // * Navbar Dropdown Scrollbar\n        // *******************************************************************************\n\n        initNavbarDropdownScrollbar: function() {\n            if (typeof PerfectScrollbar === 'undefined') return;\n\n            document.querySelectorAll('.navbar-dropdown .scrollable-container').forEach(el => {\n                new PerfectScrollbar(el, { wheelPropagation: false, suppressScrollX: true });\n            });\n        },\n\n        // *******************************************************************************\n        // * Sidebar Toggle (for apps)\n        // *******************************************************************************\n\n        initSidebarToggle: function() {\n            document.querySelectorAll('[data-bs-toggle=\"sidebar\"]').forEach(el => {\n                el.addEventListener('click', function() {\n                    const target = el.getAttribute('data-target');\n                    const overlay = el.getAttribute('data-overlay');\n                    const appOverlay = document.querySelector('.app-overlay');\n\n                    document.querySelectorAll(target).forEach(tel => {\n                        tel.classList.toggle('show');\n                        if (overlay && appOverlay) {\n                            if (tel.classList.contains('show')) {\n                                appOverlay.classList.add('show');\n                            } else {\n                                appOverlay.classList.remove('show');\n                            }\n                            appOverlay.addEventListener('click', (e) => {\n                                e.currentTarget.classList.remove('show');\n                                tel.classList.remove('show');\n                            });\n                        }\n                    });\n                });\n            });\n        },\n\n        // *******************************************************************************\n        // * Events\n        // *******************************************************************************\n\n        on: function(event, callback) {\n            const [eventName, ...namespaceParts] = event.split('.');\n            const namespace = namespaceParts.join('.') || null;\n            this._listeners.push({ event: eventName, namespace, callback });\n        },\n\n        off: function(event) {\n            const [eventName, ...namespaceParts] = event.split('.');\n            const namespace = namespaceParts.join('.') || null;\n            this._listeners = this._listeners.filter(l => !(l.event === eventName && l.namespace === namespace));\n        },\n\n        _triggerEvent: function(name) {\n            // Dispatch window event\n            window.dispatchEvent(new Event('layout' + name));\n            // Call registered listeners\n            this._listeners.filter(l => l.event === name).forEach(l => l.callback.call(null));\n        },\n\n        // *******************************************************************************\n        // * Update (NO-OP - Layout is CSS-only)\n        // *******************************************************************************\n\n        update: function() {\n            // NO-OP: Layout is handled by CSS Grid/Flexbox, not inline styles\n            // The original Helpers.update() injected problematic inline styles\n        },\n\n        setAutoUpdate: function(enable) {\n            // NO-OP: Auto-update was used for inline style injection\n        },\n\n        // *******************************************************************************\n        // * Initialization\n        // *******************************************************************************\n\n        init: function() {\n            if (this._initialized) return;\n            this._initialized = true;\n\n            // Bind window resize event\n            const self = this;\n            this._resizeCallback = function() {\n                if (self._resizeTimeout) clearTimeout(self._resizeTimeout);\n                self._resizeTimeout = setTimeout(() => {\n                    self._triggerEvent('resize');\n                }, self.RESIZE_DELAY);\n            };\n            window.addEventListener('resize', this._resizeCallback);\n        },\n\n        destroy: function() {\n            if (!this._initialized) return;\n            this._initialized = false;\n\n            if (this._resizeCallback) {\n                window.removeEventListener('resize', this._resizeCallback);\n                this._resizeCallback = null;\n            }\n            this._listeners = [];\n        }\n    };\n\n    // Initialize immediately\n    Helpers.init();\n\n    // Expose globally\n    window.Helpers = Helpers;\n\n})();\n","/**\n * Modal Manager - Centralized Bootstrap Modal Management\n * ========================================================\n *\n * Best Practice 2025: Single source of truth for all modal operations\n *\n * USAGE:\n * ------\n * 1. Declarative (no JavaScript needed):\n *    <button data-bs-toggle=\"modal\" data-bs-target=\"#myModal\">Show Modal</button>\n *\n * 2. Programmatic (simple one-liner):\n *    ModalManager.show('myModal');\n *\n * 3. With options:\n *    ModalManager.show('myModal', { backdrop: 'static', keyboard: false });\n *\n * 4. Event delegation (preferred):\n *    <button data-action=\"show-modal\" data-modal-id=\"myModal\">Show</button>\n *\n * FEATURES:\n * ---------\n * - Instance caching (prevents duplicate modal initializations)\n * - Safe initialization (handles timing issues)\n * - Auto-discovery of all modals on page\n * - Event delegation support via data-action attributes\n * - Memory cleanup\n * - InitSystem registration (priority 20)\n *\n * SELECTOR CONVENTION:\n * --------------------\n * - Uses data-modal attribute for modal identification\n * - Falls back to .modal class for backward compatibility\n * - Uses data-action=\"show-modal|hide-modal|toggle-modal\" for triggers\n *\n * @author ECS Discord Bot Team\n * @since 2025-12-17\n */\n\nclass ModalManager {\n    /**\n     * Modal instance cache - prevents duplicate initializations\n     * @private\n     */\n    static modalInstances = new Map();\n\n    /**\n     * Debug mode - set to true for debugging, false in production\n     * @private\n     */\n    static DEBUG = true;\n\n    /**\n     * Track initialization state\n     * @private\n     */\n    static _initialized = false;\n\n    /**\n     * Initialize the Modal Manager\n     * - Auto-discovers all modals on the page\n     * - Sets up event delegation for data-action triggers\n     * - Called automatically via InitSystem or DOMContentLoaded\n     *\n     * @param {Element} context - Optional context element (defaults to document)\n     */\n    static init(context = document) {\n        // For full document init, only run once\n        if (context === document && this._initialized) {\n            return;\n        }\n\n        if (typeof bootstrap === 'undefined' || typeof bootstrap.Modal === 'undefined') {\n            console.error('[ModalManager] Bootstrap not loaded. Cannot initialize modals.');\n            return;\n        }\n\n        this.log('Initializing Modal Manager...');\n\n        // Discover and cache all modals in context\n        this.discoverModals(context);\n\n        // Set up event delegation (only once for document)\n        if (context === document) {\n            this.setupEventDelegation();\n            this.setupMutationObserver();\n            this._initialized = true;\n        }\n\n        this.log(`Initialized with ${this.modalInstances.size} modals`);\n    }\n\n    /**\n     * Discover all modals in context and cache their instances\n     * Uses data-modal attribute first, falls back to .modal class\n     * @private\n     * @param {Element} context - Context element to search within\n     */\n    static discoverModals(context = document) {\n        // Query by data attribute first, then fall back to class\n        const modalElements = context.querySelectorAll('[data-modal], .modal');\n\n        modalElements.forEach(modalEl => {\n            if (modalEl.id) {\n                // Skip if already cached\n                if (this.modalInstances.has(modalEl.id)) {\n                    return;\n                }\n\n                try {\n                    // Check if modal already has a Bootstrap instance\n                    let instance = bootstrap.Modal.getInstance(modalEl);\n\n                    if (!instance) {\n                        // Create new instance if it doesn't exist\n                        instance = new bootstrap.Modal(modalEl);\n                    }\n\n                    this.modalInstances.set(modalEl.id, instance);\n                    this.log(`Cached modal: ${modalEl.id}`);\n                } catch (error) {\n                    console.error(`[ModalManager] Failed to initialize modal ${modalEl.id}:`, error);\n                }\n            } else {\n                console.warn('[ModalManager] Found modal without ID. Modals should have unique IDs:', modalEl);\n            }\n        });\n    }\n\n    /**\n     * Set up event delegation for data-action triggers\n     * Supports: show-modal, hide-modal, toggle-modal, close-modal\n     * Uses EventDelegation system if available\n     * @private\n     */\n    static setupEventDelegation() {\n        // Use EventDelegation if available\n        if (typeof EventDelegation !== 'undefined') {\n            // Show modal\n            EventDelegation.register('show-modal', (element, e) => {\n                const modalId = element.dataset.modalId;\n                if (modalId) {\n                    const options = this.parseOptionsFromElement(element);\n                    this.show(modalId, options);\n                } else {\n                    console.error('[ModalManager] data-action=\"show-modal\" requires data-modal-id attribute');\n                }\n            }, { preventDefault: true });\n\n            // Hide modal\n            EventDelegation.register('hide-modal', (element, e) => {\n                const modalId = element.dataset.modalId;\n                if (modalId) {\n                    this.hide(modalId);\n                } else {\n                    // Try to find the closest modal and close it\n                    const closestModal = element.closest('[data-modal], .modal');\n                    if (closestModal && closestModal.id) {\n                        this.hide(closestModal.id);\n                    }\n                }\n            }, { preventDefault: true });\n\n            // Close modal (alias for hide)\n            EventDelegation.register('close-modal', (element, e) => {\n                const modalId = element.dataset.modalId;\n                if (modalId) {\n                    this.hide(modalId);\n                } else {\n                    const closestModal = element.closest('[data-modal], .modal');\n                    if (closestModal && closestModal.id) {\n                        this.hide(closestModal.id);\n                    }\n                }\n            }, { preventDefault: true });\n\n            // Toggle modal\n            EventDelegation.register('toggle-modal', (element, e) => {\n                const modalId = element.dataset.modalId;\n                if (modalId) {\n                    this.toggle(modalId);\n                } else {\n                    console.error('[ModalManager] data-action=\"toggle-modal\" requires data-modal-id attribute');\n                }\n            }, { preventDefault: true });\n\n            this.log('Event delegation registered via EventDelegation system');\n        } else {\n            // Fallback: Use standard event delegation\n            document.addEventListener('click', (e) => {\n                const actionElement = e.target.closest('[data-action]');\n                if (!actionElement) return;\n\n                const action = actionElement.dataset.action;\n                const modalId = actionElement.dataset.modalId;\n\n                switch (action) {\n                    case 'show-modal':\n                        if (modalId) {\n                            e.preventDefault();\n                            const options = this.parseOptionsFromElement(actionElement);\n                            this.show(modalId, options);\n                        } else {\n                            console.error('[ModalManager] data-action=\"show-modal\" requires data-modal-id attribute');\n                        }\n                        break;\n\n                    case 'hide-modal':\n                    case 'close-modal':\n                        e.preventDefault();\n                        if (modalId) {\n                            this.hide(modalId);\n                        } else {\n                            // Try to find the closest modal and close it\n                            const closestModal = actionElement.closest('[data-modal], .modal');\n                            if (closestModal && closestModal.id) {\n                                this.hide(closestModal.id);\n                            }\n                        }\n                        break;\n\n                    case 'toggle-modal':\n                        if (modalId) {\n                            e.preventDefault();\n                            this.toggle(modalId);\n                        } else {\n                            console.error('[ModalManager] data-action=\"toggle-modal\" requires data-modal-id attribute');\n                        }\n                        break;\n                }\n            });\n\n            this.log('Event delegation registered via fallback click handler');\n        }\n    }\n\n    /**\n     * Parse modal options from data attributes\n     * @private\n     * @param {Element} element - Element to parse options from\n     * @returns {Object|null} Options object or null\n     */\n    static parseOptionsFromElement(element) {\n        const options = {};\n\n        if (element.dataset.backdrop !== undefined) {\n            options.backdrop = element.dataset.backdrop === 'false' ? false : element.dataset.backdrop;\n        }\n\n        if (element.dataset.keyboard !== undefined) {\n            options.keyboard = element.dataset.keyboard === 'true';\n        }\n\n        if (element.dataset.focus !== undefined) {\n            options.focus = element.dataset.focus === 'true';\n        }\n\n        return Object.keys(options).length > 0 ? options : null;\n    }\n\n    /**\n     * Set up MutationObserver to clean up modal instances when removed from DOM\n     * @private\n     */\n    static setupMutationObserver() {\n        const observer = new MutationObserver((mutations) => {\n            mutations.forEach((mutation) => {\n                mutation.removedNodes.forEach((node) => {\n                    if (node.nodeType === 1) {\n                        // Check if removed node is a modal\n                        const isModal = (node.classList?.contains('modal') || node.hasAttribute?.('data-modal'));\n                        if (isModal && node.id) {\n                            this.cleanup(node.id);\n                        }\n                    }\n                });\n            });\n        });\n\n        observer.observe(document.body, { childList: true, subtree: true });\n    }\n\n    /**\n     * Show a modal by ID\n     * @param {string} modalId - The ID of the modal to show (without # prefix)\n     * @param {Object} options - Bootstrap modal options (backdrop, keyboard, focus)\n     * @returns {boolean} - True if modal was shown successfully, false otherwise\n     */\n    static show(modalId, options = null) {\n        if (!modalId) {\n            console.error('[ModalManager] show() requires a modal ID');\n            return false;\n        }\n\n        this.log(`Showing modal: ${modalId}`);\n\n        // Get or create modal instance\n        let modal = this.modalInstances.get(modalId);\n\n        if (!modal) {\n            // Modal not in cache - try to find and initialize it\n            const modalElement = document.getElementById(modalId);\n\n            if (!modalElement) {\n                console.error(`[ModalManager] Modal element not found: ${modalId}`);\n                return false;\n            }\n\n            try {\n                // Check if Bootstrap already initialized it\n                modal = bootstrap.Modal.getInstance(modalElement);\n\n                if (!modal) {\n                    // Create new instance with options\n                    modal = new bootstrap.Modal(modalElement, options);\n                }\n\n                // Cache for future use\n                this.modalInstances.set(modalId, modal);\n                this.log(`Created and cached new modal: ${modalId}`);\n            } catch (error) {\n                console.error(`[ModalManager] Failed to initialize modal ${modalId}:`, error);\n                return false;\n            }\n        }\n\n        // Show the modal\n        try {\n            modal.show();\n            return true;\n        } catch (error) {\n            console.error(`[ModalManager] Failed to show modal ${modalId}:`, error);\n            return false;\n        }\n    }\n\n    /**\n     * Hide a modal by ID\n     * @param {string} modalId - The ID of the modal to hide (without # prefix)\n     * @returns {boolean} - True if modal was hidden successfully, false otherwise\n     */\n    static hide(modalId) {\n        if (!modalId) {\n            console.error('[ModalManager] hide() requires a modal ID');\n            return false;\n        }\n\n        this.log(`Hiding modal: ${modalId}`);\n\n        const modal = this.modalInstances.get(modalId);\n\n        if (!modal) {\n            console.warn(`[ModalManager] Modal not found in cache: ${modalId}`);\n\n            // Try to find it in DOM and get Bootstrap instance\n            const modalElement = document.getElementById(modalId);\n            if (modalElement) {\n                const instance = bootstrap.Modal.getInstance(modalElement);\n                if (instance) {\n                    try {\n                        instance.hide();\n                        return true;\n                    } catch (error) {\n                        console.error(`[ModalManager] Failed to hide modal ${modalId}:`, error);\n                        return false;\n                    }\n                }\n            }\n\n            return false;\n        }\n\n        try {\n            modal.hide();\n            return true;\n        } catch (error) {\n            console.error(`[ModalManager] Failed to hide modal ${modalId}:`, error);\n            return false;\n        }\n    }\n\n    /**\n     * Toggle a modal (show if hidden, hide if shown)\n     * @param {string} modalId - The ID of the modal to toggle\n     * @returns {boolean} - True if toggle was successful, false otherwise\n     */\n    static toggle(modalId) {\n        if (!modalId) {\n            console.error('[ModalManager] toggle() requires a modal ID');\n            return false;\n        }\n\n        const modal = this.modalInstances.get(modalId);\n\n        if (!modal) {\n            // Modal not in cache - just show it\n            return this.show(modalId);\n        }\n\n        try {\n            modal.toggle();\n            return true;\n        } catch (error) {\n            console.error(`[ModalManager] Failed to toggle modal ${modalId}:`, error);\n            return false;\n        }\n    }\n\n    /**\n     * Get a modal instance by ID\n     * @param {string} modalId - The ID of the modal\n     * @returns {bootstrap.Modal|null} - The Bootstrap modal instance or null\n     */\n    static getInstance(modalId) {\n        return this.modalInstances.get(modalId) || null;\n    }\n\n    /**\n     * Clean up a modal instance from cache\n     * @param {string} modalId - The ID of the modal to clean up\n     */\n    static cleanup(modalId) {\n        if (this.modalInstances.has(modalId)) {\n            this.log(`Cleaning up modal: ${modalId}`);\n\n            try {\n                const modal = this.modalInstances.get(modalId);\n                modal.dispose();\n            } catch (error) {\n                console.warn(`[ModalManager] Error disposing modal ${modalId}:`, error);\n            }\n\n            this.modalInstances.delete(modalId);\n        }\n    }\n\n    /**\n     * Clean up all modal instances\n     */\n    static cleanupAll() {\n        this.log('Cleaning up all modals...');\n\n        this.modalInstances.forEach((modal, modalId) => {\n            try {\n                modal.dispose();\n            } catch (error) {\n                console.warn(`[ModalManager] Error disposing modal ${modalId}:`, error);\n            }\n        });\n\n        this.modalInstances.clear();\n        this.log('All modals cleaned up');\n    }\n\n    /**\n     * Reinitialize - useful after dynamic content loading (HTMX, Turbo, AJAX)\n     * @param {Element} context - Optional context element (defaults to document)\n     */\n    static reinit(context = document) {\n        this.log('Reinitializing Modal Manager...');\n        this.discoverModals(context);\n    }\n\n    /**\n     * Enable debug logging\n     */\n    static enableDebug() {\n        this.DEBUG = true;\n        console.log('[ModalManager] Debug mode enabled');\n    }\n\n    /**\n     * Disable debug logging\n     */\n    static disableDebug() {\n        this.DEBUG = false;\n    }\n\n    /**\n     * Debug logging helper\n     * @private\n     */\n    static log(...args) {\n        if (this.DEBUG) {\n            console.log('[ModalManager]', ...args);\n        }\n    }\n}\n\n// Register with InitSystem if available\nif (typeof window.InitSystem !== 'undefined') {\n    window.InitSystem.register('ModalManager', {\n        priority: 20, // After responsive (10) and admin-base (15), before page-specific components\n        init: function(context) {\n            ModalManager.init(context);\n        }\n    });\n} else {\n    // Fallback to DOMContentLoaded\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', () => ModalManager.init());\n    } else {\n        ModalManager.init();\n    }\n}\n\n// Make ModalManager globally available\nwindow.ModalManager = ModalManager;\n\n// Backward compatibility: Maintain the old helper functions\nwindow.safeGetModal = function(modalId) {\n    console.warn('[Deprecated] safeGetModal() is deprecated. Use ModalManager.getInstance() instead.');\n    return ModalManager.getInstance(modalId);\n};\n\nwindow.safeShowModal = function(modalId) {\n    console.warn('[Deprecated] safeShowModal() is deprecated. Use ModalManager.show() instead.');\n    return ModalManager.show(modalId);\n};\n","'use strict';\n\n/**\n * ECS Theme Configuration\n * Colors are read from CSS variables defined in core/variables.css\n * This ensures JS and CSS stay in sync with the admin color customization\n */\n\n// Utility function to get CSS variable value\nfunction getCSSVariable(name, fallback) {\n  const value = getComputedStyle(document.documentElement).getPropertyValue(name).trim();\n  return value || fallback;\n}\n\n// Initialize colors from CSS variables (called after DOM ready)\nfunction initConfigColors() {\n  config.colors = {\n    primary: getCSSVariable('--ecs-primary', '#7C3AED'),\n    success: getCSSVariable('--ecs-success', '#10B981'),\n    danger: getCSSVariable('--ecs-danger', '#EF4444'),\n    warning: getCSSVariable('--ecs-warning', '#F59E0B'),\n    info: getCSSVariable('--ecs-info', '#3B82F6'),\n    secondary: getCSSVariable('--ecs-secondary', '#64748B'),\n    light: getCSSVariable('--ecs-neutral-5', '#FAFAFA'),\n    dark: getCSSVariable('--ecs-neutral-90', '#18181B'),\n  };\n\n  config.colors_label = { ...config.colors };\n\n  config.colors_dark = {\n    cardBg: getCSSVariable('--ecs-dark-bg-card', '#18181B'),\n    bodyBg: getCSSVariable('--ecs-dark-bg-body', '#09090B'),\n    headerBg: getCSSVariable('--ecs-dark-bg-elevated', '#27272A'),\n  };\n}\n\n// JS global variables - initial values (will be updated by initConfigColors)\nlet config = {\n  colors: {\n    primary: '#7C3AED',\n    success: '#10B981',\n    danger: '#EF4444',\n    warning: '#F59E0B',\n    info: '#3B82F6',\n    secondary: '#64748B',\n    light: '#FAFAFA',\n    dark: '#18181B',\n  },\n  colors_label: {\n    primary: '#7C3AED',\n    success: '#10B981',\n    danger: '#EF4444',\n    warning: '#F59E0B',\n    info: '#3B82F6',\n    secondary: '#64748B',\n    light: '#FAFAFA',\n    dark: '#18181B',\n  },\n  colors_dark: {\n    cardBg: '#18181B',\n    bodyBg: '#09090B',\n    headerBg: '#27272A',\n  },\n  enableMenuLocalStorage: true, // Enable menu state with local storage support\n\n  // Set contentWidth to 'wide'\n  contentWidth: 'wide',\n\n  // Additional configurations\n  layout: 'vertical',\n  layoutPadding: 20,\n  // Remove or adjust compactContentWidth if it affects layout\n  // compactContentWidth: 1200, // Optional: Remove or set to a higher value if necessary\n  navbar: {\n    type: 'fixed',\n    contentWidth: 'wide',\n    floating: false,\n    detached: false,\n    blur: false,\n  },\n  // If you have a footer configuration, ensure it is also set to 'wide'\n  footer: {\n    type: 'static', // or 'fixed' based on your needs\n    contentWidth: 'wide', // Ensure footer is also wide\n    detached: false,\n  },\n};\n\n// Paths and RTL support - Use window. to avoid TDZ issues when files are concatenated\nwindow.assetsPath = document.documentElement.getAttribute('data-assets-path');\nwindow.templateName = document.documentElement.getAttribute('data-template');\nwindow.rtlSupport = true; // set to true for RTL support, false otherwise.\n\n// Also expose as local variables for backwards compatibility\nvar assetsPath = window.assetsPath;\nvar templateName = window.templateName;\nvar rtlSupport = window.rtlSupport;\n\n// Set the default content layout to 'wide' and initialize colors from CSS variables\ndocument.addEventListener('DOMContentLoaded', function() {\n  document.documentElement.setAttribute('data-content', 'wide');\n  // Initialize colors from CSS variables after DOM is ready\n  initConfigColors();\n});\n","/**\n * Draft History Admin Interface\n * JavaScript functionality for managing draft order history\n */\n\nclass DraftHistoryManager {\n    constructor() {\n        this.csrfToken = null;\n        this.init();\n    }\n\n    init() {\n        this.setupEventListeners();\n        this.getCsrfToken();\n        this.initDragAndDrop();\n        console.log('Draft History Manager initialized');\n    }\n\n    // Get CSRF token from meta tag or cookie\n    getCsrfToken() {\n        // Try to get from meta tag first\n        const metaToken = document.querySelector('meta[name=\"csrf-token\"]');\n        if (metaToken) {\n            this.csrfToken = metaToken.getAttribute('content');\n            return;\n        }\n        \n        // Try to get from session cookie (fallback)\n        const cookies = document.cookie.split(';');\n        for (let cookie of cookies) {\n            const [name, value] = cookie.trim().split('=');\n            if (name === 'csrf_token') {\n                this.csrfToken = value;\n                return;\n            }\n        }\n        \n        console.warn('CSRF token not found');\n    }\n\n    setupEventListeners() {\n        // Edit form submission\n        const editForm = document.getElementById('editDraftPickForm');\n        if (editForm) {\n            editForm.addEventListener('submit', (e) => this.handleEditSubmit(e));\n        }\n    }\n\n    // Initialize drag and drop functionality\n    initDragAndDrop() {\n        const sortableContainers = document.querySelectorAll('.sortable-draft-picks');\n        \n        sortableContainers.forEach(container => {\n            const items = container.querySelectorAll('.sortable-item');\n            \n            items.forEach(item => {\n                const draggableCard = item.querySelector('.draggable-card');\n                \n                // Drag start\n                draggableCard.addEventListener('dragstart', (e) => {\n                    item.classList.add('dragging');\n                    container.classList.add('drag-active');\n                    \n                    // Store dragged player info for better UX\n                    const playerName = item.querySelector('h6').textContent;\n                    const currentPos = item.dataset.position;\n                    \n                    e.dataTransfer.setData('text/plain', item.dataset.pickId);\n                    e.dataTransfer.setData('application/x-player-name', playerName);\n                    e.dataTransfer.setData('application/x-current-pos', currentPos);\n                    e.dataTransfer.effectAllowed = 'move';\n                    \n                    // Create custom drag image with better visibility\n                    const dragImage = item.cloneNode(true);\n                    dragImage.classList.add('drag-image-preview');\n                    document.body.appendChild(dragImage);\n                    e.dataTransfer.setDragImage(dragImage, 100, 50);\n                    \n                    // Remove the temporary drag image after a brief delay\n                    setTimeout(() => {\n                        if (document.body.contains(dragImage)) {\n                            document.body.removeChild(dragImage);\n                        }\n                    }, 0);\n                });\n                \n                // Drag end\n                draggableCard.addEventListener('dragend', (e) => {\n                    item.classList.remove('dragging');\n                    container.classList.remove('drag-active');\n                    \n                    // Remove all drag-over classes\n                    items.forEach(i => i.classList.remove('drag-over'));\n                });\n                \n                // Drag over\n                item.addEventListener('dragover', (e) => {\n                    e.preventDefault();\n                    e.dataTransfer.dropEffect = 'move';\n                    \n                    if (!item.classList.contains('dragging')) {\n                        item.classList.add('drag-over');\n                    }\n                });\n                \n                // Drag leave\n                item.addEventListener('dragleave', (e) => {\n                    // Only remove drag-over if we're actually leaving this element\n                    if (!item.contains(e.relatedTarget)) {\n                        item.classList.remove('drag-over');\n                    }\n                });\n                \n                // Drop\n                item.addEventListener('drop', (e) => {\n                    e.preventDefault();\n                    item.classList.remove('drag-over');\n                    container.classList.remove('drag-active');\n                    \n                    const draggedPickId = e.dataTransfer.getData('text/plain');\n                    const playerName = e.dataTransfer.getData('application/x-player-name');\n                    const currentPos = e.dataTransfer.getData('application/x-current-pos');\n                    const targetPosition = parseInt(item.dataset.position);\n                    \n                    if (draggedPickId && targetPosition) {\n                        // Show immediate feedback\n                        this.showAlert('info', `Moving ${playerName} from position #${currentPos} to #${targetPosition}...`);\n                        this.handleDragDrop(draggedPickId, targetPosition, playerName);\n                    }\n                });\n            });\n        });\n    }\n\n    // Handle drag and drop reordering\n    async handleDragDrop(pickId, newPosition, playerName = 'Player') {\n        try {\n            const headers = {\n                'Content-Type': 'application/json',\n            };\n            \n            // Add CSRF token if available\n            if (this.csrfToken) {\n                headers['X-CSRFToken'] = this.csrfToken;\n            }\n            \n            const response = await fetch(`/admin/draft-history/edit/${pickId}`, {\n                method: 'POST',\n                headers: headers,\n                body: JSON.stringify({\n                    position: newPosition,\n                    mode: 'smart' // Use smart mode for drag and drop\n                })\n            });\n\n            const data = await response.json();\n            \n            if (data.success) {\n                this.showAlert('success', `Player moved to position #${newPosition}`);\n                this.reloadPage();\n            } else {\n                this.showAlert('error', data.message);\n            }\n        } catch (error) {\n            this.showAlert('error', 'Failed to reorder draft pick');\n            console.error('Error reordering draft pick:', error);\n        }\n    }\n\n    // Clear all filters\n    clearFilters() {\n        const currentUrl = new URL(window.location);\n        currentUrl.search = '';\n        window.location.href = currentUrl.toString();\n    }\n\n    // Show edit modal for a draft pick\n    editDraftPick(pickId, position, notes, playerName) {\n        document.getElementById('editPickId').value = pickId;\n        document.getElementById('editPlayerName').value = playerName;\n        document.getElementById('editDraftPosition').value = position;\n        document.getElementById('editNotes').value = notes || '';\n\n        ModalManager.show('editDraftPickModal');\n    }\n\n    // Handle edit form submission\n    async handleEditSubmit(e) {\n        e.preventDefault();\n        \n        const pickId = document.getElementById('editPickId').value;\n        const position = parseInt(document.getElementById('editDraftPosition').value);\n        const notes = document.getElementById('editNotes').value.trim();\n        \n        // Determine which mode is selected\n        let mode = 'smart'; // new default - smart reorder\n        if (document.getElementById('insertMode').checked) {\n            mode = 'insert';\n        } else if (document.getElementById('cascadingMode').checked) {\n            mode = 'cascading';\n        } else if (document.getElementById('absoluteMode').checked) {\n            mode = 'absolute';\n        }\n        \n        try {\n            const headers = {\n                'Content-Type': 'application/json',\n            };\n            \n            // Add CSRF token if available\n            if (this.csrfToken) {\n                headers['X-CSRFToken'] = this.csrfToken;\n            }\n            \n            const response = await fetch(`/admin/draft-history/edit/${pickId}`, {\n                method: 'POST',\n                headers: headers,\n                body: JSON.stringify({\n                    position: position,\n                    notes: notes,\n                    mode: mode\n                })\n            });\n\n            const data = await response.json();\n            \n            if (data.success) {\n                this.showAlert('success', data.message);\n                bootstrap.Modal.getInstance(document.getElementById('editDraftPickModal')).hide();\n                this.reloadPage();\n            } else {\n                this.showAlert('error', data.message);\n            }\n        } catch (error) {\n            this.showAlert('error', 'Failed to update draft pick');\n            console.error('Error updating draft pick:', error);\n        }\n    }\n\n    // Delete a draft pick\n    async deleteDraftPick(pickId, position, playerName, teamName) {\n        const confirmed = confirm(\n            `Are you sure you want to delete draft pick #${position} (${playerName} to ${teamName})?\\n\\n` +\n            'This will adjust all subsequent draft positions and cannot be undone.'\n        );\n\n        if (!confirmed) return;\n\n        try {\n            const headers = {\n                'Content-Type': 'application/json',\n            };\n            \n            // Add CSRF token if available\n            if (this.csrfToken) {\n                headers['X-CSRFToken'] = this.csrfToken;\n            }\n            \n            const response = await fetch(`/admin/draft-history/delete/${pickId}`, {\n                method: 'DELETE',\n                headers: headers\n            });\n\n            const data = await response.json();\n            \n            if (data.success) {\n                this.showAlert('success', data.message);\n                this.reloadPage();\n            } else {\n                this.showAlert('error', data.message);\n            }\n        } catch (error) {\n            this.showAlert('error', 'Failed to delete draft pick');\n            console.error('Error deleting draft pick:', error);\n        }\n    }\n\n    // Normalize draft positions for a season/league\n    async normalizeDraftPositions(seasonId, leagueId, seasonName, leagueName) {\n        const confirmed = confirm(\n            `Fix the draft order for ${seasonName} - ${leagueName}?\\n\\n` +\n            'This will renumber all positions to run 1, 2, 3, 4... with no gaps. This action cannot be undone.'\n        );\n\n        if (!confirmed) return;\n\n        try {\n            const headers = {\n                'Content-Type': 'application/json',\n            };\n            \n            // Add CSRF token if available\n            if (this.csrfToken) {\n                headers['X-CSRFToken'] = this.csrfToken;\n            }\n            \n            const response = await fetch('/admin/draft-history/normalize', {\n                method: 'POST',\n                headers: headers,\n                body: JSON.stringify({\n                    season_id: seasonId,\n                    league_id: leagueId\n                })\n            });\n\n            const data = await response.json();\n            \n            if (data.success) {\n                this.showAlert('success', data.message);\n                this.reloadPage();\n            } else {\n                this.showAlert('error', data.message);\n            }\n        } catch (error) {\n            this.showAlert('error', 'Failed to normalize draft positions');\n            console.error('Error normalizing draft positions:', error);\n        }\n    }\n\n    // Clear all draft picks for a season/league\n    async clearSeasonLeague(seasonId, leagueId, seasonName, leagueName) {\n        const confirmed = confirm(\n            `Are you sure you want to clear ALL draft picks for ${seasonName} - ${leagueName}?\\n\\n` +\n            'This action cannot be undone.'\n        );\n\n        if (!confirmed) return;\n\n        try {\n            const headers = {\n                'Content-Type': 'application/json',\n            };\n            \n            // Add CSRF token if available\n            if (this.csrfToken) {\n                headers['X-CSRFToken'] = this.csrfToken;\n            }\n            \n            const response = await fetch('/admin/draft-history/clear', {\n                method: 'POST',\n                headers: headers,\n                body: JSON.stringify({\n                    season_id: seasonId,\n                    league_id: leagueId\n                })\n            });\n\n            const data = await response.json();\n            \n            if (data.success) {\n                this.showAlert('success', data.message);\n                this.reloadPage();\n            } else {\n                this.showAlert('error', data.message);\n            }\n        } catch (error) {\n            this.showAlert('error', 'Failed to clear draft history');\n            console.error('Error clearing draft history:', error);\n        }\n    }\n\n    // Show alert message\n    showAlert(type, message) {\n        let alertClass, iconClass;\n        if (type === 'success') {\n            alertClass = 'alert-success';\n            iconClass = 'ti-check';\n        } else if (type === 'info') {\n            alertClass = 'alert-info';\n            iconClass = 'ti-info-circle';\n        } else {\n            alertClass = 'alert-danger';\n            iconClass = 'ti-x';\n        }\n        \n        const alertHtml = `\n            <div class=\"alert ${alertClass} alert-dismissible fade show\" role=\"alert\">\n                <i class=\"ti ${iconClass} me-2\"></i>${message}\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\" aria-label=\"Close\"></button>\n            </div>\n        `;\n        \n        const container = document.querySelector('.container-xxl');\n        if (container) {\n            container.insertAdjacentHTML('afterbegin', alertHtml);\n            \n            // Auto-dismiss after 5 seconds\n            setTimeout(() => {\n                const alert = container.querySelector('.alert');\n                if (alert) {\n                    alert.remove();\n                }\n            }, 5000);\n        }\n    }\n\n    // Reload the page with a slight delay\n    reloadPage() {\n        setTimeout(() => {\n            window.location.reload();\n        }, 1000);\n    }\n\n    // Initialize tooltips if available\n    initTooltips() {\n        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle=\"tooltip\"]'));\n        tooltipTriggerList.map(function (tooltipTriggerEl) {\n            return new bootstrap.Tooltip(tooltipTriggerEl);\n        });\n    }\n}\n\n// Global functions for template compatibility\nlet draftHistoryManager;\n\nfunction clearFilters() {\n    draftHistoryManager.clearFilters();\n}\n\nfunction editDraftPick(pickId, position, notes, playerName) {\n    draftHistoryManager.editDraftPick(pickId, position, notes, playerName);\n}\n\nfunction deleteDraftPick(pickId, position, playerName, teamName) {\n    draftHistoryManager.deleteDraftPick(pickId, position, playerName, teamName);\n}\n\nfunction normalizeDraftPositions(seasonId, leagueId, seasonName, leagueName) {\n    draftHistoryManager.normalizeDraftPositions(seasonId, leagueId, seasonName, leagueName);\n}\n\nfunction clearSeasonLeague(seasonId, leagueId, seasonName, leagueName) {\n    draftHistoryManager.clearSeasonLeague(seasonId, leagueId, seasonName, leagueName);\n}\n\n// Initialize when DOM is ready\ndocument.addEventListener('DOMContentLoaded', function() {\n    // Page guard - only run on draft history page\n    if (!document.querySelector('.sortable-draft-picks') && !document.getElementById('editDraftPickForm')) {\n        return; // Not on draft history page\n    }\n\n    draftHistoryManager = new DraftHistoryManager();\n\n    // Initialize tooltips\n    draftHistoryManager.initTooltips();\n\n    console.log('Draft History interface loaded successfully');\n});\n","/**\n * ============================================================================\n * SIDEBAR INTERACTIONS - MODERN EVENT DELEGATION\n * ============================================================================\n *\n * Handles all sidebar navigation interactions using event delegation.\n * Zero inline event handlers - all actions use data-action attributes.\n *\n * Features:\n * - Sidebar toggle (mobile & desktop)\n * - Submenu expansion/collapse\n * - Active state management\n * - Keyboard navigation support\n * - Touch-friendly interactions\n * - Accessibility (ARIA attributes)\n *\n * Architecture:\n * - Event delegation from document root\n * - Data-action attribute routing\n * - State classes (is-open, is-active)\n * - No direct DOM manipulation outside state classes\n * - Mobile-first responsive behavior\n *\n * ============================================================================\n */\n\n(function () {\n  'use strict';\n\n  /**\n   * Configuration\n   */\n  const CONFIG = {\n    selectors: {\n      sidebar: '.c-sidebar',\n      sidebarToggle: '[data-action=\"toggle-sidebar\"]',\n      submenuToggle: '[data-action=\"toggle-submenu\"]',\n      expandableItem: '[data-expandable]',\n      noActiveSeason: '[data-action=\"no-active-season\"]',\n    },\n    classes: {\n      open: 'is-open',\n      active: 'is-active',\n      collapsed: 'layout-menu-collapsed',\n    },\n    storage: {\n      collapsedKey: 'sidebar-collapsed',\n    },\n    breakpoints: {\n      desktop: 1200,\n    },\n  };\n\n  /**\n   * State management\n   */\n  const State = {\n    isDesktop: window.innerWidth >= CONFIG.breakpoints.desktop,\n    isSidebarOpen: false,\n    collapsedState: localStorage.getItem(CONFIG.storage.collapsedKey) === 'true',\n  };\n\n  /**\n   * DOM references (cached for performance)\n   */\n  let sidebar = null;\n\n  /**\n   * ============================================================================\n   * INITIALIZATION\n   * ============================================================================\n   */\n\n  function init() {\n    // Cache DOM references\n    sidebar = document.querySelector(CONFIG.selectors.sidebar);\n\n    if (!sidebar) {\n      console.warn('Sidebar not found');\n      return;\n    }\n\n    // Restore collapsed state on desktop\n    if (State.isDesktop && State.collapsedState) {\n      document.body.classList.add(CONFIG.classes.collapsed);\n    }\n\n    // Set up event delegation\n    setupEventDelegation();\n\n    // Set up keyboard navigation\n    setupKeyboardNavigation();\n\n    // Handle window resize\n    setupResizeHandler();\n\n    // Set initial ARIA attributes\n    setupAriaAttributes();\n\n    console.log('Sidebar interactions initialized');\n  }\n\n  /**\n   * ============================================================================\n   * EVENT DELEGATION\n   * ============================================================================\n   */\n\n  function setupEventDelegation() {\n    // Global click handler for all sidebar actions\n    document.addEventListener('click', handleClick);\n\n    // Close sidebar when clicking outside on mobile\n    document.addEventListener('click', handleOutsideClick);\n  }\n\n  function handleClick(event) {\n    const target = event.target;\n    const action = target.closest('[data-action]')?.getAttribute('data-action');\n\n    if (!action) return;\n\n    // Route to appropriate handler\n    switch (action) {\n      case 'toggle-sidebar':\n      case 'toggle-menu':\n        // Both toggle-sidebar (from sidebar) and toggle-menu (from navbar) do the same thing\n        event.preventDefault();\n        handleSidebarToggle();\n        break;\n\n      case 'close-menu':\n        // Close menu action (from overlay)\n        event.preventDefault();\n        if (!State.isDesktop) {\n          closeSidebar();\n        }\n        break;\n\n      case 'toggle-submenu':\n        event.preventDefault();\n        handleSubmenuToggle(target);\n        break;\n\n      case 'no-active-season':\n        event.preventDefault();\n        handleNoActiveSeason();\n        break;\n\n      case 'navigate':\n      case 'navigate-home':\n        // Allow default navigation\n        // Close sidebar on mobile after navigation\n        if (!State.isDesktop) {\n          closeSidebar();\n        }\n        break;\n    }\n  }\n\n  function handleOutsideClick(event) {\n    // Only on mobile\n    if (State.isDesktop) return;\n\n    // Only if sidebar is open\n    if (!State.isSidebarOpen) return;\n\n    // Check if click is outside sidebar\n    if (!sidebar.contains(event.target)) {\n      closeSidebar();\n    }\n  }\n\n  /**\n   * ============================================================================\n   * SIDEBAR TOGGLE\n   * ============================================================================\n   */\n\n  function handleSidebarToggle() {\n    if (State.isDesktop) {\n      // Desktop: Toggle collapsed state\n      toggleCollapsedState();\n    } else {\n      // Mobile: Toggle open/close\n      toggleMobileSidebar();\n    }\n  }\n\n  function toggleCollapsedState() {\n    const isCollapsed = document.body.classList.toggle(CONFIG.classes.collapsed);\n    State.collapsedState = isCollapsed;\n\n    // Save to localStorage\n    localStorage.setItem(CONFIG.storage.collapsedKey, isCollapsed);\n\n    // Update ARIA\n    const toggle = sidebar.querySelector(CONFIG.selectors.sidebarToggle);\n    if (toggle) {\n      toggle.setAttribute('aria-label', isCollapsed ? 'Expand navigation menu' : 'Collapse navigation menu');\n    }\n\n    console.log('Sidebar collapsed state:', isCollapsed);\n  }\n\n  function toggleMobileSidebar() {\n    if (State.isSidebarOpen) {\n      closeSidebar();\n    } else {\n      openSidebar();\n    }\n  }\n\n  function openSidebar() {\n    sidebar.classList.add(CONFIG.classes.open);\n    State.isSidebarOpen = true;\n\n    // Add layout-menu-expanded class to HTML for CSS compatibility with foundation.css\n    document.documentElement.classList.add('layout-menu-expanded');\n\n    // Show the existing overlay (from base.html)\n    const overlay = document.querySelector('.layout-overlay');\n    if (overlay) {\n      overlay.classList.add('show');\n    }\n\n    // Update ARIA\n    sidebar.setAttribute('aria-hidden', 'false');\n\n    // Trap focus in sidebar\n    trapFocus(sidebar);\n\n    console.log('Sidebar opened');\n  }\n\n  function closeSidebar() {\n    sidebar.classList.remove(CONFIG.classes.open);\n    State.isSidebarOpen = false;\n\n    // Remove layout-menu-expanded class from HTML\n    document.documentElement.classList.remove('layout-menu-expanded');\n\n    // Hide the existing overlay\n    const overlay = document.querySelector('.layout-overlay');\n    if (overlay) {\n      overlay.classList.remove('show');\n    }\n\n    // Update ARIA\n    sidebar.setAttribute('aria-hidden', 'true');\n\n    // Release focus trap\n    releaseFocus();\n\n    console.log('Sidebar closed');\n  }\n\n  /**\n   * ============================================================================\n   * SUBMENU TOGGLE\n   * ============================================================================\n   */\n\n  function handleSubmenuToggle(button) {\n    const item = button.closest(CONFIG.selectors.expandableItem);\n    if (!item) return;\n\n    const isOpen = item.classList.toggle(CONFIG.classes.open);\n\n    // Update ARIA\n    button.setAttribute('aria-expanded', isOpen);\n\n    // Close other submenus at the same level (optional - comment out for accordion behavior)\n    // closeOtherSubmenus(item);\n\n    console.log('Submenu toggled:', isOpen);\n  }\n\n  function closeOtherSubmenus(currentItem) {\n    const parent = currentItem.parentElement;\n    const siblings = Array.from(parent.children).filter(\n      child => child !== currentItem && child.matches(CONFIG.selectors.expandableItem)\n    );\n\n    siblings.forEach(sibling => {\n      sibling.classList.remove(CONFIG.classes.open);\n      const toggle = sibling.querySelector(CONFIG.selectors.submenuToggle);\n      if (toggle) {\n        toggle.setAttribute('aria-expanded', 'false');\n      }\n    });\n  }\n\n  /**\n   * ============================================================================\n   * SPECIAL ACTIONS\n   * ============================================================================\n   */\n\n  function handleNoActiveSeason() {\n    alert('No active Pub League season');\n  }\n\n  /**\n   * ============================================================================\n   * KEYBOARD NAVIGATION\n   * ============================================================================\n   */\n\n  function setupKeyboardNavigation() {\n    sidebar.addEventListener('keydown', handleKeyDown);\n  }\n\n  function handleKeyDown(event) {\n    const { key, target } = event;\n\n    // Escape closes sidebar on mobile\n    if (key === 'Escape' && !State.isDesktop) {\n      closeSidebar();\n      return;\n    }\n\n    // Only handle navigation within links and buttons\n    if (!target.matches('a, button')) return;\n\n    switch (key) {\n      case 'ArrowUp':\n        event.preventDefault();\n        focusPreviousItem(target);\n        break;\n\n      case 'ArrowDown':\n        event.preventDefault();\n        focusNextItem(target);\n        break;\n\n      case 'Home':\n        event.preventDefault();\n        focusFirstItem();\n        break;\n\n      case 'End':\n        event.preventDefault();\n        focusLastItem();\n        break;\n    }\n  }\n\n  function focusPreviousItem(currentElement) {\n    const focusable = getFocusableElements();\n    const currentIndex = focusable.indexOf(currentElement);\n    const previousIndex = currentIndex > 0 ? currentIndex - 1 : focusable.length - 1;\n    focusable[previousIndex]?.focus();\n  }\n\n  function focusNextItem(currentElement) {\n    const focusable = getFocusableElements();\n    const currentIndex = focusable.indexOf(currentElement);\n    const nextIndex = currentIndex < focusable.length - 1 ? currentIndex + 1 : 0;\n    focusable[nextIndex]?.focus();\n  }\n\n  function focusFirstItem() {\n    const focusable = getFocusableElements();\n    focusable[0]?.focus();\n  }\n\n  function focusLastItem() {\n    const focusable = getFocusableElements();\n    focusable[focusable.length - 1]?.focus();\n  }\n\n  function getFocusableElements() {\n    return Array.from(\n      sidebar.querySelectorAll('a[href], button:not([disabled])')\n    ).filter(el => !el.closest('.c-sidebar__link--disabled'));\n  }\n\n  /**\n   * ============================================================================\n   * ARIA ATTRIBUTES\n   * ============================================================================\n   */\n\n  function setupAriaAttributes() {\n    // Set sidebar role and label\n    if (!sidebar.hasAttribute('role')) {\n      sidebar.setAttribute('role', 'navigation');\n    }\n    if (!sidebar.hasAttribute('aria-label')) {\n      sidebar.setAttribute('aria-label', 'Main navigation');\n    }\n\n    // Set initial aria-hidden for mobile\n    if (!State.isDesktop) {\n      sidebar.setAttribute('aria-hidden', 'true');\n    }\n\n    // Set aria-expanded for all toggle buttons\n    const toggles = sidebar.querySelectorAll(CONFIG.selectors.submenuToggle);\n    toggles.forEach(toggle => {\n      const item = toggle.closest(CONFIG.selectors.expandableItem);\n      const isOpen = item?.classList.contains(CONFIG.classes.open);\n      toggle.setAttribute('aria-expanded', isOpen);\n    });\n  }\n\n  /**\n   * ============================================================================\n   * FOCUS TRAP (MOBILE)\n   * ============================================================================\n   */\n\n  let focusTrapActive = false;\n  let firstFocusableElement = null;\n  let lastFocusableElement = null;\n\n  function trapFocus(container) {\n    const focusableElements = getFocusableElements();\n    firstFocusableElement = focusableElements[0];\n    lastFocusableElement = focusableElements[focusableElements.length - 1];\n\n    focusTrapActive = true;\n\n    // Focus first element\n    firstFocusableElement?.focus();\n\n    // Handle tab key\n    document.addEventListener('keydown', handleFocusTrap);\n  }\n\n  function releaseFocus() {\n    focusTrapActive = false;\n    document.removeEventListener('keydown', handleFocusTrap);\n  }\n\n  function handleFocusTrap(event) {\n    if (!focusTrapActive || event.key !== 'Tab') return;\n\n    if (event.shiftKey) {\n      // Shift + Tab\n      if (document.activeElement === firstFocusableElement) {\n        event.preventDefault();\n        lastFocusableElement?.focus();\n      }\n    } else {\n      // Tab\n      if (document.activeElement === lastFocusableElement) {\n        event.preventDefault();\n        firstFocusableElement?.focus();\n      }\n    }\n  }\n\n  /**\n   * ============================================================================\n   * BACKDROP (MOBILE)\n   * ============================================================================\n   */\n\n  function createBackdrop() {\n    if (document.querySelector('.c-sidebar-backdrop')) return;\n\n    const backdrop = document.createElement('div');\n    backdrop.className = 'c-sidebar-backdrop';\n    backdrop.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.5);\n      z-index: ${parseInt(getComputedStyle(sidebar).zIndex) - 1};\n      transition: opacity 0.3s ease;\n    `;\n    document.body.appendChild(backdrop);\n\n    // Fade in\n    setTimeout(() => {\n      backdrop.style.opacity = '1';\n    }, 10);\n  }\n\n  function removeBackdrop() {\n    const backdrop = document.querySelector('.c-sidebar-backdrop');\n    if (!backdrop) return;\n\n    backdrop.style.opacity = '0';\n    setTimeout(() => {\n      backdrop.remove();\n    }, 300);\n  }\n\n  /**\n   * ============================================================================\n   * RESIZE HANDLER\n   * ============================================================================\n   */\n\n  function setupResizeHandler() {\n    let resizeTimeout;\n\n    window.addEventListener('resize', () => {\n      clearTimeout(resizeTimeout);\n      resizeTimeout = setTimeout(handleResize, 150);\n    });\n  }\n\n  function handleResize() {\n    const wasDesktop = State.isDesktop;\n    State.isDesktop = window.innerWidth >= CONFIG.breakpoints.desktop;\n\n    // Desktop to mobile transition\n    if (wasDesktop && !State.isDesktop) {\n      // Close mobile sidebar\n      closeSidebar();\n      // Remove collapsed class\n      document.body.classList.remove(CONFIG.classes.collapsed);\n    }\n\n    // Mobile to desktop transition\n    if (!wasDesktop && State.isDesktop) {\n      // Close mobile sidebar\n      closeSidebar();\n      // Restore collapsed state\n      if (State.collapsedState) {\n        document.body.classList.add(CONFIG.classes.collapsed);\n      }\n    }\n  }\n\n  /**\n   * ============================================================================\n   * PUBLIC API\n   * ============================================================================\n   */\n\n  window.SidebarInteractions = {\n    open: openSidebar,\n    close: closeSidebar,\n    toggle: handleSidebarToggle,\n    collapse: () => {\n      if (State.isDesktop && !State.collapsedState) {\n        toggleCollapsedState();\n      }\n    },\n    expand: () => {\n      if (State.isDesktop && State.collapsedState) {\n        toggleCollapsedState();\n      }\n    },\n  };\n\n  /**\n   * ============================================================================\n   * AUTO-INITIALIZE\n   * ============================================================================\n   */\n\n  // Register with InitSystem if available\n  if (typeof window.InitSystem !== 'undefined' && window.InitSystem.register) {\n    window.InitSystem.register('sidebar-interactions', init, {\n      priority: 80,\n      description: 'Sidebar toggle, collapse, and mobile drawer interactions',\n      reinitializable: false\n    });\n  } else {\n    // Fallback: Initialize on DOM ready\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', init);\n    } else {\n      init();\n    }\n  }\n})();\n","/**\n * ============================================================================\n * MODERN NAVBAR CONTROLLER - BEM ARCHITECTURE\n * ============================================================================\n *\n * Handles all navbar interactions with smooth animations and proper state management.\n * Uses EventDelegation for optimal performance and maintainability.\n *\n * Features:\n * - Dropdown management (theme, notifications, profile, impersonation)\n * - Search autocomplete integration\n * - Scroll state tracking\n * - Mobile menu toggle\n * - Keyboard navigation (Escape to close, Arrow keys for items)\n * - Outside click detection\n * - Badge animations\n * - Role impersonation management\n *\n * Architecture:\n * - Event delegation via EventDelegation system\n * - State management via classList and ARIA attributes\n * - No inline styles (all via CSS classes)\n * - BEM naming conventions\n * - Full accessibility support\n * - Proper cleanup on destroy\n *\n * ============================================================================\n */\n\nclass ModernNavbarController {\n  constructor() {\n    this.navbar = document.querySelector('.c-navbar-modern');\n    if (!this.navbar) {\n      console.warn('Modern navbar not found');\n      return;\n    }\n\n    this.activeDropdown = null;\n    this.lastScrollTop = 0;\n    this.scrollThreshold = 50;\n\n    this.init();\n  }\n\n  /**\n   * Get CSRF token from meta tag, input field, or cookie\n   */\n  getCSRFToken() {\n    // Try meta tag first\n    const csrfMeta = document.querySelector('meta[name=\"csrf-token\"]');\n    if (csrfMeta) {\n      return csrfMeta.getAttribute('content');\n    }\n\n    // Try hidden input field\n    const csrfInput = document.querySelector('input[name=\"csrf_token\"]');\n    if (csrfInput) {\n      return csrfInput.value;\n    }\n\n    // Try cookie\n    const cookies = document.cookie.split(';');\n    for (const cookie of cookies) {\n      const [name, value] = cookie.trim().split('=');\n      if (name === 'csrf_token') {\n        return decodeURIComponent(value);\n      }\n    }\n\n    return '';\n  }\n\n  init() {\n    this.registerEventHandlers();\n    this.attachEventListeners();\n    this.initScrollTracking();\n    this.initSearch();\n    this.initNotifications();\n    this.initRoleImpersonation();\n    this.initTheme();\n    this.initPresence();\n  }\n\n  /**\n   * Register all data-action handlers via EventDelegation\n   */\n  registerEventHandlers() {\n    if (typeof EventDelegation === 'undefined') {\n      console.warn('[Navbar] EventDelegation not available, using fallback');\n      return;\n    }\n\n    // Mobile menu toggle\n    EventDelegation.register('toggle-menu', (element, e) => {\n      this.toggleMobileMenu();\n    }, { preventDefault: true });\n\n    // Dropdown toggles\n    EventDelegation.register('toggle-dropdown', (element, e) => {\n      const dropdownId = element.dataset.dropdown;\n      if (dropdownId) {\n        this.toggleDropdown(dropdownId);\n      }\n    }, { preventDefault: true });\n\n    // Theme switcher\n    EventDelegation.register('switch-theme', (element, e) => {\n      const theme = element.dataset.theme;\n      if (theme) {\n        this.switchTheme(theme);\n      }\n    }, { preventDefault: true });\n\n    // Role impersonation\n    EventDelegation.register('start-impersonation', (element, e) => {\n      this.startRoleImpersonation();\n    }, { preventDefault: true });\n\n    EventDelegation.register('stop-impersonation', (element, e) => {\n      this.stopRoleImpersonation();\n    }, { preventDefault: true });\n\n    // Notification actions\n    EventDelegation.register('mark-read', (element, e) => {\n      const notificationId = element.dataset.notificationId;\n      if (notificationId) {\n        this.markNotificationRead(notificationId);\n      }\n    }, { preventDefault: true });\n\n    EventDelegation.register('mark-all-read', (element, e) => {\n      this.markAllNotificationsRead();\n    }, { preventDefault: true });\n\n    EventDelegation.register('clear-all-notifications', (element, e) => {\n      this.clearAllNotifications();\n    }, { preventDefault: true });\n\n    EventDelegation.register('dismiss-notification', (element, e) => {\n      const notificationId = element.dataset.notificationId;\n      if (notificationId) {\n        this.dismissNotification(notificationId);\n      }\n    }, { preventDefault: true, stopPropagation: true });\n\n    EventDelegation.register('expand-notification', (element, e) => {\n      const notificationId = element.dataset.notificationId;\n      if (notificationId) {\n        this.toggleNotificationExpand(notificationId);\n      }\n    }, { preventDefault: true });\n\n    // Logout\n    EventDelegation.register('logout', (element, e) => {\n      this.handleLogout();\n    }, { preventDefault: true });\n  }\n\n  /**\n   * Attach event listeners (non data-action events)\n   */\n  attachEventListeners() {\n    // Keyboard navigation\n    document.addEventListener('keydown', this.handleKeyboard.bind(this));\n\n    // Close dropdowns on outside click\n    document.addEventListener('click', this.handleOutsideClick.bind(this));\n  }\n\n  /**\n   * Handle keyboard navigation\n   */\n  handleKeyboard(e) {\n    // Escape key - close all dropdowns\n    if (e.key === 'Escape' && this.activeDropdown) {\n      this.closeDropdown(this.activeDropdown);\n      return;\n    }\n\n    // Arrow keys for dropdown navigation\n    if (this.activeDropdown && (e.key === 'ArrowDown' || e.key === 'ArrowUp')) {\n      e.preventDefault();\n      this.navigateDropdown(e.key);\n      return;\n    }\n  }\n\n  /**\n   * Close dropdown when clicking outside\n   */\n  handleOutsideClick(e) {\n    if (!this.activeDropdown) return;\n\n    const dropdown = document.querySelector(`[data-dropdown-id=\"${this.activeDropdown}\"]`);\n    const toggle = document.querySelector(`[data-dropdown=\"${this.activeDropdown}\"]`);\n\n    if (dropdown && !dropdown.contains(e.target) && toggle && !toggle.contains(e.target)) {\n      this.closeDropdown(this.activeDropdown);\n    }\n  }\n\n  /**\n   * Toggle dropdown open/closed\n   */\n  toggleDropdown(dropdownId) {\n    const dropdown = document.querySelector(`[data-dropdown-id=\"${dropdownId}\"]`);\n    if (!dropdown) return;\n\n    // Close other dropdowns first\n    if (this.activeDropdown && this.activeDropdown !== dropdownId) {\n      this.closeDropdown(this.activeDropdown);\n    }\n\n    const isOpen = dropdown.classList.contains('is-open');\n\n    if (isOpen) {\n      this.closeDropdown(dropdownId);\n    } else {\n      this.openDropdown(dropdownId);\n    }\n  }\n\n  /**\n   * Open a dropdown with animation\n   */\n  openDropdown(dropdownId) {\n    const dropdown = document.querySelector(`[data-dropdown-id=\"${dropdownId}\"]`);\n    const toggle = document.querySelector(`[data-dropdown=\"${dropdownId}\"]`);\n\n    if (!dropdown) return;\n\n    // Add open class for CSS animation\n    dropdown.classList.add('is-open');\n    dropdown.setAttribute('aria-hidden', 'false');\n\n    if (toggle) {\n      toggle.classList.add('is-active');\n      toggle.setAttribute('aria-expanded', 'true');\n    }\n\n    this.activeDropdown = dropdownId;\n\n    // Stagger animation for dropdown items\n    this.staggerDropdownItems(dropdown);\n  }\n\n  /**\n   * Close a dropdown\n   */\n  closeDropdown(dropdownId) {\n    const dropdown = document.querySelector(`[data-dropdown-id=\"${dropdownId}\"]`);\n    const toggle = document.querySelector(`[data-dropdown=\"${dropdownId}\"]`);\n\n    if (!dropdown) return;\n\n    dropdown.classList.remove('is-open');\n    dropdown.setAttribute('aria-hidden', 'true');\n\n    if (toggle) {\n      toggle.classList.remove('is-active');\n      toggle.setAttribute('aria-expanded', 'false');\n    }\n\n    if (this.activeDropdown === dropdownId) {\n      this.activeDropdown = null;\n    }\n  }\n\n  /**\n   * Stagger animation for dropdown items (smooth reveal)\n   */\n  staggerDropdownItems(dropdown) {\n    const items = dropdown.querySelectorAll('.c-navbar-modern__dropdown-item');\n\n    items.forEach((item, index) => {\n      item.style.opacity = '0';\n      item.style.transform = 'translateX(-8px)';\n\n      setTimeout(() => {\n        item.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';\n        item.style.opacity = '1';\n        item.style.transform = 'translateX(0)';\n      }, index * 30);\n    });\n  }\n\n  /**\n   * Navigate dropdown items with arrow keys\n   */\n  navigateDropdown(direction) {\n    const dropdown = document.querySelector(`[data-dropdown-id=\"${this.activeDropdown}\"]`);\n    if (!dropdown) return;\n\n    const items = Array.from(dropdown.querySelectorAll('.c-navbar-modern__dropdown-item:not([disabled])'));\n    const currentIndex = items.findIndex(item => item === document.activeElement);\n\n    let nextIndex;\n    if (direction === 'ArrowDown') {\n      nextIndex = currentIndex < items.length - 1 ? currentIndex + 1 : 0;\n    } else {\n      nextIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;\n    }\n\n    items[nextIndex]?.focus();\n  }\n\n  /**\n   * Toggle mobile menu\n   */\n  toggleMobileMenu() {\n    const toggle = document.querySelector('[data-action=\"toggle-menu\"]');\n    const menu = document.querySelector('[data-mobile-menu]');\n\n    if (!toggle || !menu) return;\n\n    const isOpen = toggle.classList.contains('is-open');\n\n    if (isOpen) {\n      toggle.classList.remove('is-open');\n      menu.classList.remove('is-open');\n      document.body.style.overflow = '';\n    } else {\n      toggle.classList.add('is-open');\n      menu.classList.add('is-open');\n      document.body.style.overflow = 'hidden';\n    }\n  }\n\n  /**\n   * Track scroll position and add shadow when scrolled\n   */\n  initScrollTracking() {\n    let ticking = false;\n\n    window.addEventListener('scroll', () => {\n      if (!ticking) {\n        window.requestAnimationFrame(() => {\n          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n\n          if (scrollTop > this.scrollThreshold) {\n            this.navbar.classList.add('is-scrolled');\n          } else {\n            this.navbar.classList.remove('is-scrolled');\n          }\n\n          this.lastScrollTop = scrollTop;\n          ticking = false;\n        });\n\n        ticking = true;\n      }\n    });\n  }\n\n  /**\n   * Initialize search functionality\n   */\n  initSearch() {\n    const searchInput = document.querySelector('.c-navbar-modern__search-input');\n    if (!searchInput) return;\n\n    // Prevent form submission\n    const form = searchInput.closest('form');\n    if (form) {\n      form.addEventListener('submit', (e) => {\n        e.preventDefault();\n      });\n    }\n\n    // Search input handling (integrate with autocomplete if available)\n    let searchTimeout;\n    searchInput.addEventListener('input', (e) => {\n      clearTimeout(searchTimeout);\n\n      const query = e.target.value.trim();\n\n      if (query.length >= 2) {\n        searchTimeout = setTimeout(() => {\n          this.performSearch(query);\n        }, 300);\n      }\n    });\n\n    // Focus animation\n    searchInput.addEventListener('focus', () => {\n      searchInput.parentElement.classList.add('is-focused');\n    });\n\n    searchInput.addEventListener('blur', () => {\n      searchInput.parentElement.classList.remove('is-focused');\n    });\n  }\n\n  /**\n   * Perform search (integrate with existing autocomplete)\n   */\n  performSearch(query) {\n    // This integrates with the existing player search autocomplete\n    // Trigger the existing search functionality\n    if (typeof window.initializePlayerSearch === 'function') {\n      // Use existing search function\n      console.log('Searching for:', query);\n    }\n  }\n\n  /**\n   * Switch theme (light/dark/system)\n   */\n  switchTheme(theme) {\n    // Close dropdown\n    this.closeDropdown('theme');\n\n    // Determine actual theme (handle system preference)\n    let actualTheme = theme;\n    if (theme === 'system') {\n      actualTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n    }\n\n    // Update all theme attributes that different CSS selectors may use\n    const html = document.documentElement;\n    const body = document.body;\n\n    // Set data-style attribute (used by our modern CSS)\n    html.setAttribute('data-style', actualTheme);\n\n    // Set data-bs-theme (Bootstrap 5.3+)\n    html.setAttribute('data-bs-theme', actualTheme);\n    body.setAttribute('data-bs-theme', actualTheme);\n\n    // Set data-theme (generic)\n    html.setAttribute('data-theme', actualTheme);\n\n    // Set Vuexy-specific class\n    if (actualTheme === 'dark') {\n      html.classList.add('dark-style');\n      html.classList.remove('light-style');\n    } else {\n      html.classList.add('light-style');\n      html.classList.remove('dark-style');\n    }\n\n    // Store preference\n    localStorage.setItem('theme', theme);\n    localStorage.setItem('templateCustomizer-skin', actualTheme);\n\n    // Update icon\n    const icon = document.querySelector('[data-role=\"theme-icon\"]');\n    if (icon) {\n      const iconClass = {\n        light: 'ti-sun',\n        dark: 'ti-moon-stars',\n        system: 'ti-device-desktop'\n      }[theme] || 'ti-moon-stars';\n\n      icon.className = `c-navbar-modern__theme-icon ti ${iconClass}`;\n    }\n\n    // Update active state in dropdown\n    const options = document.querySelectorAll('[data-action=\"switch-theme\"]');\n    options.forEach(option => {\n      if (option.dataset.theme === theme) {\n        option.classList.add('is-active');\n      } else {\n        option.classList.remove('is-active');\n      }\n    });\n\n    // Show toast notification\n    this.showToast(`Theme switched to ${theme} mode`);\n  }\n\n  /**\n   * Start role impersonation\n   */\n  startRoleImpersonation() {\n    // Get selected roles from checkboxes\n    const checkboxes = document.querySelectorAll('input[name=\"impersonate_roles\"]:checked');\n    const selectedRoles = Array.from(checkboxes).map(cb => cb.value);\n\n    if (selectedRoles.length === 0) {\n      this.showToast('Please select at least one role', 'warning');\n      return;\n    }\n\n    // Make API call to start impersonation\n    fetch('/admin-panel/user-management/impersonate', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': this.getCSRFToken(),\n      },\n      body: JSON.stringify({ roles: selectedRoles })\n    })\n    .then(response => response.json())\n    .then(data => {\n      if (data.success) {\n        // Update UI to show impersonation is active\n        const button = document.querySelector('[data-dropdown=\"impersonation\"]');\n        if (button) {\n          button.classList.add('c-navbar-modern__impersonation-active');\n        }\n\n        // Show badge\n        const badge = button?.querySelector('.c-navbar-modern__badge');\n        if (badge) {\n          badge.classList.remove('u-hidden');\n        }\n\n        // Hide normal status, show active status\n        const normalStatus = document.getElementById('currentRoleStatus');\n        const activeStatus = document.getElementById('activeImpersonationStatus');\n        const activeRolesList = document.getElementById('activeRolesList');\n\n        if (normalStatus) normalStatus.classList.add('u-hidden');\n        if (activeStatus) {\n          activeStatus.classList.remove('u-hidden');\n          if (activeRolesList) {\n            activeRolesList.innerHTML = selectedRoles.map(role =>\n              `<span class=\"c-role-status__role-tag\">${role}</span>`\n            ).join('');\n          }\n        }\n\n        this.closeDropdown('impersonation');\n        this.showToast('Role testing started', 'success');\n\n        // Reload page to apply new permissions\n        setTimeout(() => window.location.reload(), 1000);\n      } else {\n        this.showToast(data.message || 'Failed to start role testing', 'error');\n      }\n    })\n    .catch(error => {\n      console.error('Impersonation error:', error);\n      this.showToast('An error occurred', 'error');\n    });\n  }\n\n  /**\n   * Stop role impersonation\n   */\n  stopRoleImpersonation() {\n    fetch('/admin-panel/user-management/stop-impersonate', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': this.getCSRFToken(),\n      }\n    })\n    .then(response => response.json())\n    .then(data => {\n      if (data.success) {\n        this.showToast('Impersonation stopped', 'success');\n        setTimeout(() => window.location.reload(), 1000);\n      }\n    })\n    .catch(error => {\n      console.error('Stop impersonation error:', error);\n    });\n  }\n\n  /**\n   * Mark notification as read\n   */\n  async markNotificationRead(notificationId) {\n    const notification = document.querySelector(`[data-notification-id=\"${notificationId}\"]`);\n    if (!notification) return;\n\n    // Optimistically update UI\n    notification.classList.remove('is-unread');\n\n    try {\n      const response = await fetch(`/api/notifications/${notificationId}/read`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': this.getCSRFToken(),\n        }\n      });\n\n      const data = await response.json();\n      if (data.success) {\n        this.updateNotificationBadge(data.unread_count);\n      }\n    } catch (error) {\n      console.error('Mark notification read error:', error);\n      // Revert on error\n      notification.classList.add('is-unread');\n    }\n  }\n\n  /**\n   * Mark all notifications as read\n   */\n  async markAllNotificationsRead() {\n    const notifications = document.querySelectorAll('.c-navbar-modern__notification.is-unread');\n\n    // Optimistically update UI\n    notifications.forEach(notification => {\n      notification.classList.remove('is-unread');\n    });\n\n    try {\n      const response = await fetch('/api/notifications/mark-all-read', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': this.getCSRFToken(),\n        }\n      });\n\n      const data = await response.json();\n      if (data.success) {\n        this.updateNotificationBadge(0);\n        this.showToast('All notifications marked as read', 'success');\n      }\n    } catch (error) {\n      console.error('Mark all read error:', error);\n      // Revert - reload notifications\n      this.loadNotifications();\n    }\n  }\n\n  /**\n   * Handle logout\n   */\n  handleLogout() {\n    const form = document.querySelector('#logout-form');\n    if (form) {\n      form.submit();\n    }\n  }\n\n  /**\n   * Initialize notifications\n   */\n  initNotifications() {\n    // Load notifications on page load\n    this.loadNotifications();\n\n    // Refresh notification count periodically (every 60 seconds)\n    setInterval(() => this.refreshNotificationCount(), 60000);\n  }\n\n  /**\n   * Load notifications from API\n   */\n  async loadNotifications() {\n    const container = document.getElementById('notifications-list');\n    if (!container) return;\n\n    const loadingEl = container.querySelector('[data-state=\"loading\"]');\n    const emptyEl = container.querySelector('[data-state=\"empty\"]');\n\n    try {\n      const response = await fetch('/api/notifications?include_read=true&limit=10');\n      const data = await response.json();\n\n      // Hide loading\n      if (loadingEl) loadingEl.classList.add('u-hidden');\n\n      if (data.success && data.notifications.length > 0) {\n        // Hide empty state\n        if (emptyEl) emptyEl.classList.add('u-hidden');\n\n        // Remove existing notifications (but keep loading/empty elements)\n        container.querySelectorAll('.c-navbar-modern__notification').forEach(el => el.remove());\n\n        // Render notifications\n        data.notifications.forEach(notification => {\n          const notifEl = this.createNotificationElement(notification);\n          container.appendChild(notifEl);\n        });\n\n        // Update badge count\n        this.updateNotificationBadge(data.unread_count);\n      } else {\n        // Show empty state\n        if (emptyEl) emptyEl.classList.remove('u-hidden');\n        this.updateNotificationBadge(0);\n      }\n    } catch (error) {\n      console.error('Error loading notifications:', error);\n      if (loadingEl) loadingEl.classList.add('u-hidden');\n      if (emptyEl) {\n        emptyEl.classList.remove('u-hidden');\n        const emptyText = emptyEl.querySelector('p');\n        if (emptyText) emptyText.textContent = 'Failed to load notifications';\n      }\n    }\n  }\n\n  /**\n   * Create a notification DOM element with dismiss button and expandable details\n   */\n  createNotificationElement(notification) {\n    const div = document.createElement('div');\n    div.className = `c-navbar-modern__notification${notification.is_read ? '' : ' is-unread'}`;\n    div.setAttribute('data-notification-id', notification.id);\n    div.setAttribute('role', 'menuitem');\n    div.setAttribute('tabindex', '0');\n\n    // Icon color class\n    const colorClass = notification.icon_color ? `text-${notification.icon_color}` : '';\n\n    // Truncate long messages\n    const truncatedMessage = notification.message.length > 80\n      ? notification.message.substring(0, 80) + '...'\n      : notification.message;\n    const hasMore = notification.message.length > 80;\n\n    div.innerHTML = `\n      <div class=\"c-navbar-modern__notification-main\"\n           data-action=\"expand-notification\"\n           data-notification-id=\"${notification.id}\">\n        <div class=\"c-navbar-modern__notification-icon ${colorClass}\">\n          <i class=\"${notification.icon}\"></i>\n        </div>\n        <div class=\"c-navbar-modern__notification-content\">\n          <p class=\"c-navbar-modern__notification-title\">${this.escapeHtml(notification.title)}</p>\n          <p class=\"c-navbar-modern__notification-text\">${this.escapeHtml(truncatedMessage)}</p>\n          ${hasMore ? '<span class=\"c-navbar-modern__notification-expand-hint\">Click to read more</span>' : ''}\n        </div>\n        <span class=\"c-navbar-modern__notification-time\">${notification.time_ago}</span>\n      </div>\n      <div class=\"c-navbar-modern__notification-expanded u-hidden\" data-expanded-content>\n        <p class=\"c-navbar-modern__notification-full-text\">${this.escapeHtml(notification.message)}</p>\n        <span class=\"c-navbar-modern__notification-date\">${notification.created_at || ''}</span>\n      </div>\n      <button class=\"c-navbar-modern__notification-dismiss\"\n              data-action=\"dismiss-notification\"\n              data-notification-id=\"${notification.id}\"\n              aria-label=\"Dismiss notification\"\n              title=\"Dismiss\">\n        <i class=\"ti ti-x\" aria-hidden=\"true\"></i>\n      </button>\n    `;\n\n    return div;\n  }\n\n  /**\n   * Toggle notification expansion to show full content\n   */\n  toggleNotificationExpand(notificationId) {\n    const notification = document.querySelector(`[data-notification-id=\"${notificationId}\"]`);\n    if (!notification) return;\n\n    const expandedContent = notification.querySelector('[data-expanded-content]');\n    if (!expandedContent) return;\n\n    const isExpanded = notification.classList.contains('is-expanded');\n\n    if (isExpanded) {\n      notification.classList.remove('is-expanded');\n      expandedContent.classList.add('u-hidden');\n    } else {\n      notification.classList.add('is-expanded');\n      expandedContent.classList.remove('u-hidden');\n\n      // Mark as read when expanded\n      const notifElement = notification;\n      if (notifElement.classList.contains('is-unread')) {\n        this.markNotificationRead(notificationId);\n      }\n    }\n  }\n\n  /**\n   * Dismiss (delete) a single notification\n   */\n  async dismissNotification(notificationId) {\n    const notification = document.querySelector(`[data-notification-id=\"${notificationId}\"]`);\n    if (!notification) return;\n\n    // Optimistically remove with animation\n    notification.classList.add('is-dismissing');\n\n    try {\n      const response = await fetch(`/api/notifications/${notificationId}`, {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': this.getCSRFToken(),\n        }\n      });\n\n      const data = await response.json();\n\n      if (data.success) {\n        // Remove from DOM after animation\n        setTimeout(() => {\n          notification.remove();\n          this.updateNotificationBadge(data.unread_count);\n\n          // Show empty state if no more notifications\n          const container = document.getElementById('notifications-list');\n          const remaining = container.querySelectorAll('.c-navbar-modern__notification');\n          if (remaining.length === 0) {\n            const emptyEl = container.querySelector('[data-state=\"empty\"]');\n            if (emptyEl) emptyEl.classList.remove('u-hidden');\n          }\n        }, 200);\n      } else {\n        // Revert animation on failure\n        notification.classList.remove('is-dismissing');\n        this.showToast('Failed to dismiss notification', 'error');\n      }\n    } catch (error) {\n      console.error('Dismiss notification error:', error);\n      notification.classList.remove('is-dismissing');\n      this.showToast('Failed to dismiss notification', 'error');\n    }\n  }\n\n  /**\n   * Clear all notifications\n   */\n  async clearAllNotifications() {\n    const container = document.getElementById('notifications-list');\n    const notifications = container.querySelectorAll('.c-navbar-modern__notification');\n\n    if (notifications.length === 0) {\n      this.showToast('No notifications to clear', 'info');\n      return;\n    }\n\n    // Confirm with user\n    if (!confirm('Are you sure you want to clear all notifications?')) {\n      return;\n    }\n\n    // Optimistically fade out all\n    notifications.forEach(n => n.classList.add('is-dismissing'));\n\n    try {\n      const response = await fetch('/api/notifications/clear-all', {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': this.getCSRFToken(),\n        }\n      });\n\n      const data = await response.json();\n\n      if (data.success) {\n        // Remove all from DOM\n        setTimeout(() => {\n          notifications.forEach(n => n.remove());\n          this.updateNotificationBadge(0);\n\n          // Show empty state\n          const emptyEl = container.querySelector('[data-state=\"empty\"]');\n          if (emptyEl) emptyEl.classList.remove('u-hidden');\n\n          this.showToast(`Cleared ${data.deleted_count} notification${data.deleted_count !== 1 ? 's' : ''}`, 'success');\n        }, 200);\n      } else {\n        // Revert on failure\n        notifications.forEach(n => n.classList.remove('is-dismissing'));\n        this.showToast('Failed to clear notifications', 'error');\n      }\n    } catch (error) {\n      console.error('Clear all notifications error:', error);\n      notifications.forEach(n => n.classList.remove('is-dismissing'));\n      this.showToast('Failed to clear notifications', 'error');\n    }\n  }\n\n  /**\n   * Escape HTML to prevent XSS\n   */\n  escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  /**\n   * Refresh notification count only (lightweight)\n   */\n  async refreshNotificationCount() {\n    try {\n      const response = await fetch('/api/notifications/count');\n      const data = await response.json();\n      if (data.success) {\n        this.updateNotificationBadge(data.count);\n      }\n    } catch (error) {\n      console.error('Error refreshing notification count:', error);\n    }\n  }\n\n  /**\n   * Update notification badge display\n   */\n  updateNotificationBadge(count) {\n    const badges = document.querySelectorAll('[data-badge=\"notification-count\"]');\n    badges.forEach(badge => {\n      if (count > 0) {\n        badge.textContent = count > 99 ? '99+' : count;\n        badge.classList.remove('u-hidden');\n      } else {\n        badge.classList.add('u-hidden');\n      }\n    });\n  }\n\n  /**\n   * Initialize role impersonation (if available)\n   */\n  initRoleImpersonation() {\n    if (!document.querySelector('[data-dropdown=\"impersonation\"]')) {\n      return;\n    }\n\n    // Load current status\n    this.loadImpersonationStatus();\n\n    // Attach refresh button listener\n    const refreshBtn = document.querySelector('[data-action=\"refresh-roles\"]');\n    if (refreshBtn) {\n      refreshBtn.addEventListener('click', () => this.loadAvailableRoles());\n    }\n\n    // Attach checkbox change listeners\n    const checkboxes = document.querySelectorAll('input[name=\"impersonate_roles\"]');\n    checkboxes.forEach(checkbox => {\n      checkbox.addEventListener('change', () => this.validateRoleSelection());\n    });\n\n    // Attach clear selection listener\n    const clearBtn = document.querySelector('[data-action=\"clear-role-selection\"]');\n    if (clearBtn) {\n      clearBtn.addEventListener('click', (e) => {\n        e.preventDefault();\n        this.clearRoleSelection();\n      });\n    }\n\n    // Initial validation\n    this.validateRoleSelection();\n  }\n\n  /**\n   * Clear all role selections\n   */\n  clearRoleSelection() {\n    const checkboxes = document.querySelectorAll('input[name=\"impersonate_roles\"]');\n    checkboxes.forEach(checkbox => {\n      checkbox.checked = false;\n    });\n    this.validateRoleSelection();\n  }\n\n  /**\n   * Load impersonation status\n   */\n  async loadImpersonationStatus() {\n    try {\n      const response = await fetch('/api/role-impersonation/status');\n      if (!response.ok) throw new Error('Failed to load status');\n\n      const data = await response.json();\n      this.updateImpersonationStatus(data);\n    } catch (error) {\n      console.error('Error loading impersonation status:', error);\n    }\n  }\n\n  /**\n   * Load available roles (refresh from server)\n   */\n  async loadAvailableRoles() {\n    const refreshBtn = document.querySelector('[data-action=\"refresh-roles\"]');\n    if (refreshBtn) {\n      refreshBtn.classList.add('is-loading');\n      const icon = refreshBtn.querySelector('i');\n      if (icon) icon.style.animation = 'spin 1s linear infinite';\n    }\n\n    try {\n      const response = await fetch('/api/role-impersonation/available-roles');\n      if (!response.ok) throw new Error('Failed to load roles');\n\n      const data = await response.json();\n      this.showToast('Roles refreshed', 'success');\n      this.updateImpersonationStatus(data.current_impersonation);\n    } catch (error) {\n      console.error('Error loading available roles:', error);\n      this.showToast('Failed to refresh roles', 'error');\n    } finally {\n      if (refreshBtn) {\n        refreshBtn.classList.remove('is-loading');\n        const icon = refreshBtn.querySelector('i');\n        if (icon) icon.style.animation = '';\n      }\n    }\n  }\n\n  /**\n   * Update impersonation status display\n   */\n  updateImpersonationStatus(data) {\n    const isActive = data && data.active || false;\n    const normalStatus = document.getElementById('currentRoleStatus');\n    const activeStatus = document.getElementById('activeImpersonationStatus');\n    const activeRolesList = document.getElementById('activeRolesList');\n    const badge = document.querySelector('[data-badge=\"impersonation\"]');\n\n    if (isActive && data.roles && data.roles.length > 0) {\n      // Hide normal status, show active status\n      if (normalStatus) normalStatus.classList.add('u-hidden');\n      if (activeStatus) {\n        activeStatus.classList.remove('u-hidden');\n        if (activeRolesList) {\n          activeRolesList.innerHTML = data.roles.map(role =>\n            `<span class=\"c-role-status__role-tag\">${role}</span>`\n          ).join('');\n        }\n      }\n\n      // Show badge\n      if (badge) badge.classList.remove('u-hidden');\n    } else {\n      // Show normal status, hide active status\n      if (normalStatus) normalStatus.classList.remove('u-hidden');\n      if (activeStatus) activeStatus.classList.add('u-hidden');\n\n      // Hide badge\n      if (badge) badge.classList.add('u-hidden');\n    }\n  }\n\n  /**\n   * Validate role selection (checkbox-based)\n   */\n  validateRoleSelection() {\n    const checkboxes = document.querySelectorAll('input[name=\"impersonate_roles\"]:checked');\n    const startBtn = document.getElementById('startImpersonationBtn');\n    const countDisplay = document.getElementById('selectedRoleCount');\n\n    const selectedCount = checkboxes.length;\n\n    // Update count display\n    if (countDisplay) {\n      countDisplay.textContent = selectedCount;\n    }\n\n    // Enable/disable start button\n    if (startBtn) {\n      startBtn.disabled = selectedCount === 0;\n    }\n  }\n\n  /**\n   * Initialize theme\n   */\n  initTheme() {\n    // Load saved theme preference\n    const savedTheme = localStorage.getItem('theme') || 'system';\n    this.applyTheme(savedTheme, false);\n  }\n\n  /**\n   * Apply theme\n   */\n  applyTheme(theme, save = true) {\n    // Determine actual theme (handle system preference)\n    let actualTheme = theme;\n    if (theme === 'system') {\n      actualTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n    }\n\n    // Update all theme attributes\n    const html = document.documentElement;\n    const body = document.body;\n\n    html.setAttribute('data-style', actualTheme);\n    html.setAttribute('data-bs-theme', actualTheme);\n    body.setAttribute('data-bs-theme', actualTheme);\n    html.setAttribute('data-theme', actualTheme);\n\n    // Update Vuexy-specific class\n    if (actualTheme === 'dark') {\n      html.classList.add('dark-style');\n      html.classList.remove('light-style');\n    } else {\n      html.classList.add('light-style');\n      html.classList.remove('dark-style');\n    }\n\n    // Update icon\n    const icon = document.querySelector('[data-role=\"theme-icon\"]');\n    if (icon) {\n      const iconClass = {\n        light: 'ti-sun',\n        dark: 'ti-moon-stars',\n        system: 'ti-device-desktop'\n      }[theme] || 'ti-sun';\n\n      icon.className = `ti ${iconClass} c-navbar-modern__nav-icon`;\n    }\n\n    // Update active state in dropdown\n    const options = document.querySelectorAll('[data-action=\"switch-theme\"]');\n    options.forEach(option => {\n      if (option.dataset.theme === theme) {\n        option.classList.add('is-active');\n      } else {\n        option.classList.remove('is-active');\n      }\n    });\n\n    // Store preference\n    if (save) {\n      localStorage.setItem('theme', theme);\n      localStorage.setItem('templateCustomizer-skin', actualTheme);\n    }\n  }\n\n  /**\n   * Show toast notification\n   */\n  showToast(message, type = 'info') {\n    // Integrate with existing toast system if available\n    if (typeof window.showToast === 'function') {\n      window.showToast(message, type);\n    } else {\n      console.log(`[Toast ${type}]:`, message);\n    }\n  }\n\n  // =========================================================================\n  // PRESENCE / ONLINE STATUS\n  // =========================================================================\n\n  /**\n   * Initialize presence tracking\n   * Shows real online status based on WebSocket connection\n   */\n  initPresence() {\n    // Initialize WebSocket connection for presence if socket.io is available\n    if (typeof io !== 'undefined') {\n      this.initPresenceSocket();\n    } else {\n      // Fall back to API-only presence checking\n      this.checkPresence();\n    }\n\n    // Refresh presence periodically (every 2 minutes)\n    // This keeps the user showing as online while the page is open\n    setInterval(() => this.refreshPresence(), 120000);\n\n    // Also refresh presence when page becomes visible again\n    document.addEventListener('visibilitychange', () => {\n      if (document.visibilityState === 'visible') {\n        this.refreshPresence();\n        // Reconnect socket if disconnected\n        if (this.presenceSocket && !this.presenceSocket.connected) {\n          this.presenceSocket.connect();\n        }\n      }\n    });\n  }\n\n  /**\n   * Initialize WebSocket connection for presence tracking\n   * Uses SocketManager for unified socket management across all components\n   */\n  initPresenceSocket() {\n    // Use SocketManager if available (preferred method)\n    if (typeof window.SocketManager !== 'undefined') {\n      console.log('[Navbar] Using SocketManager for presence');\n\n      // Optimistic UI: Show \"online\" immediately if we were recently connected\n      // This prevents status flicker during page navigation\n      if (window.SocketManager.isOptimisticallyConnected()) {\n        this.updateOnlineStatus(true);\n        console.debug('[Navbar] Optimistic online status (recently connected)');\n      }\n\n      // Get socket reference\n      this.presenceSocket = window.SocketManager.getSocket();\n\n      // Register connect callback - fires immediately if already connected\n      window.SocketManager.onConnect('Navbar', (socket) => {\n        this.presenceSocket = socket;\n        this.updateOnlineStatus(true);\n        console.debug('Presence socket connected via SocketManager');\n      });\n\n      // Register disconnect callback (delayed by SocketManager for optimistic UI)\n      window.SocketManager.onDisconnect('Navbar', (reason) => {\n        this.updateOnlineStatus(false);\n        console.debug('Presence socket disconnected:', reason);\n      });\n\n      // Register event listeners via SocketManager\n      window.SocketManager.on('Navbar', 'authentication_success', (data) => {\n        this.updateOnlineStatus(true);\n        console.debug('Presence authenticated:', data.username);\n      });\n\n      window.SocketManager.on('Navbar', 'authentication_failed', () => {\n        // Still connected but not authenticated - show as online anyway\n        this.updateOnlineStatus(true);\n      });\n\n      return;\n    }\n\n    // Fallback: Use existing global socket if available\n    if (window.socket) {\n      console.log('[Navbar] Reusing existing socket (connected:', window.socket.connected, ')');\n      this.presenceSocket = window.socket;\n      if (window.socket.connected) {\n        this.updateOnlineStatus(true);\n      }\n      this.attachSocketListenersDirect(this.presenceSocket);\n      return;\n    }\n\n    // Fallback: Create new socket connection for presence\n    try {\n      console.log('[Navbar] Creating new socket connection (fallback)');\n      this.presenceSocket = io('/', {\n        transports: ['polling', 'websocket'],\n        upgrade: true,\n        reconnection: true,\n        reconnectionAttempts: 5,\n        reconnectionDelay: 1000,\n        reconnectionDelayMax: 5000,\n        timeout: 20000,\n        autoConnect: true,\n        withCredentials: true\n      });\n\n      // Store globally so other components can use it\n      window.socket = this.presenceSocket;\n\n      this.attachSocketListenersDirect(this.presenceSocket);\n\n    } catch (error) {\n      console.warn('Failed to initialize presence socket:', error);\n      this.checkPresence();\n    }\n  }\n\n  /**\n   * Attach event listeners directly to socket (fallback when SocketManager not available)\n   */\n  attachSocketListenersDirect(socket) {\n    socket.on('connect', () => {\n      this.updateOnlineStatus(true);\n      console.debug('Presence socket connected');\n    });\n\n    socket.on('disconnect', () => {\n      this.updateOnlineStatus(false);\n      console.debug('Presence socket disconnected');\n    });\n\n    socket.on('authentication_success', (data) => {\n      this.updateOnlineStatus(true);\n      console.debug('Presence authenticated:', data.username);\n    });\n\n    socket.on('authentication_failed', () => {\n      this.updateOnlineStatus(true);\n    });\n\n    socket.on('connect_error', (error) => {\n      console.warn('Presence socket connection error:', error.message);\n      this.updateOnlineStatus(false);\n    });\n  }\n\n  /**\n   * Check current presence status from server\n   */\n  async checkPresence() {\n    try {\n      const response = await fetch('/api/notifications/presence');\n      const data = await response.json();\n\n      if (data.success) {\n        this.updateOnlineStatus(data.online);\n      }\n    } catch (error) {\n      // Don't log error - presence check is non-critical\n      // User will still appear online if WebSocket is connected\n    }\n  }\n\n  /**\n   * Refresh presence TTL (keep showing as online)\n   */\n  async refreshPresence() {\n    try {\n      await fetch('/api/notifications/presence/refresh', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': this.getCSRFToken(),\n        }\n      });\n    } catch (error) {\n      // Silent fail - non-critical operation\n    }\n  }\n\n  /**\n   * Update the online status indicator in the navbar\n   */\n  updateOnlineStatus(isOnline) {\n    const statusIndicator = this.navbar.querySelector('.c-navbar-modern__avatar-status');\n    if (!statusIndicator) return;\n\n    if (isOnline) {\n      statusIndicator.classList.add('is-online');\n      statusIndicator.classList.remove('is-offline');\n      statusIndicator.setAttribute('aria-label', 'Online');\n      statusIndicator.setAttribute('title', 'You are online');\n    } else {\n      statusIndicator.classList.remove('is-online');\n      statusIndicator.classList.add('is-offline');\n      statusIndicator.setAttribute('aria-label', 'Offline');\n      statusIndicator.setAttribute('title', 'You appear offline');\n    }\n  }\n}\n\n// Initialize function\nfunction initNavbar() {\n  // Only initialize if navbar exists on page\n  if (document.querySelector('.c-navbar-modern')) {\n    window.navbarController = new ModernNavbarController();\n  }\n}\n\n// Register with InitSystem if available\nif (typeof window.InitSystem !== 'undefined' && window.InitSystem.register) {\n  window.InitSystem.register('navbar-modern', initNavbar, {\n    priority: 80,\n    description: 'Modern navbar controller (search, dropdowns, mobile menu)',\n    reinitializable: false\n  });\n} else {\n  // Fallback: Initialize when DOM is ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initNavbar);\n  } else {\n    initNavbar();\n  }\n}\n\n// Export for module usage\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = ModernNavbarController;\n}\n","/**\n * Simple Theme Switcher - Replaces TemplateCustomizer\n * Handles light/dark/system theme switching without vendor dependencies\n *\n * This replaces the bloated TemplateCustomizer with a lightweight solution\n * that only handles what we actually need: theme switching.\n *\n * @version 1.1.0\n * @updated 2025-12-26 - Refactored to use EventDelegation\n */\n\nclass SimpleThemeSwitcher {\n  constructor() {\n    this.themes = ['light', 'dark', 'system'];\n    this.variants = ['modern'];\n    this.currentTheme = 'light';\n    this.currentVariant = 'modern';\n    this.init();\n  }\n\n  init() {\n    // Don't load theme here - it's handled in DOMContentLoaded to prevent FOUC\n    this.setupEventListeners();\n    this.setupSystemThemeDetection();\n    this.loadSavedVariant();\n  }\n\n  /**\n   * Load variant from localStorage\n   */\n  loadSavedVariant() {\n    const savedVariant = localStorage.getItem('theme-variant') || 'modern';\n    this.currentVariant = this.variants.includes(savedVariant) ? savedVariant : 'modern';\n  }\n\n  /**\n   * Load theme from localStorage or default to light\n   */\n  loadSavedTheme() {\n    // Use consistent localStorage key with template\n    const savedTheme = localStorage.getItem('template-style') || 'light';\n    this.setTheme(savedTheme, false); // Don't save again on load\n  }\n\n  /**\n   * Set the active theme\n   * @param {string} theme - 'light', 'dark', or 'system'\n   * @param {boolean} save - Whether to save to localStorage and server\n   */\n  setTheme(theme, save = true) {\n    if (!this.themes.includes(theme)) {\n      console.warn(`Invalid theme: ${theme}. Using light instead.`);\n      theme = 'light';\n    }\n\n    console.log('Setting theme to:', theme); // Debug log\n    this.currentTheme = theme;\n\n    // Determine actual theme to apply (resolve 'system' to light/dark)\n    const effectiveTheme = this.resolveSystemTheme(theme);\n    console.log('Effective theme:', effectiveTheme); // Debug log\n\n    // Apply theme to document - update both attributes for compatibility\n    document.documentElement.setAttribute('data-style', effectiveTheme);\n    document.documentElement.setAttribute('data-theme', effectiveTheme);\n\n    // Also update the class for CSS targeting\n    document.documentElement.className = document.documentElement.className.replace(/\\b(light|dark)-style\\b/g, '');\n    document.documentElement.classList.add(`${effectiveTheme}-style`);\n\n    // Update theme switcher UI\n    this.updateThemeIcon(theme);\n    this.updateActiveMenuItem(theme);\n\n    if (save) {\n      // Save to localStorage with consistent key\n      localStorage.setItem('template-style', theme);\n\n      // Save to server\n      this.saveThemeToServer(theme);\n    }\n\n    // Dispatch custom event for other components\n    document.dispatchEvent(new CustomEvent('themeChanged', {\n      detail: { theme: theme, effectiveTheme: effectiveTheme }\n    }));\n\n    console.log('Theme applied successfully'); // Debug log\n  }\n\n  /**\n   * Resolve 'system' theme to actual light/dark based on user's OS preference\n   */\n  resolveSystemTheme(theme) {\n    if (theme === 'system') {\n      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n    }\n    return theme;\n  }\n\n  /**\n   * Setup event listeners for theme switching\n   */\n  setupEventListeners() {\n    // Register EventDelegation handlers for theme switching\n    if (typeof EventDelegation !== 'undefined') {\n      // Handle settings page theme buttons (data-action=\"set-theme\")\n      EventDelegation.register('set-theme', (element, e) => {\n        const theme = element.getAttribute('data-theme');\n        if (theme) {\n          console.log('Theme switching to (action):', theme);\n          this.setTheme(theme);\n\n          // Update button states in settings page\n          document.querySelectorAll('[data-action=\"set-theme\"]').forEach(btn => {\n            btn.classList.remove('btn-primary');\n            btn.classList.add('btn-outline-secondary');\n          });\n          element.classList.remove('btn-outline-secondary');\n          element.classList.add('btn-primary');\n        }\n      }, { preventDefault: true });\n\n      // Handle navbar dropdown theme options (data-action=\"select-theme\")\n      EventDelegation.register('select-theme', (element, e) => {\n        const theme = element.getAttribute('data-theme');\n        if (theme) {\n          console.log('Theme switching to:', theme);\n          this.setTheme(theme);\n\n          // Close dropdown manually if needed\n          const dropdown = element.closest('[data-role=\"theme-dropdown-menu\"]');\n          if (dropdown) {\n            const toggle = document.querySelector('[data-role=\"theme-dropdown-toggle\"]');\n            if (toggle && window.bootstrap) {\n              const dropdownInstance = window.bootstrap.Dropdown.getInstance(toggle);\n              if (dropdownInstance) {\n                dropdownInstance.hide();\n              }\n            }\n          }\n        }\n      }, { preventDefault: true });\n    }\n\n    // Handle keyboard shortcuts (optional)\n    document.addEventListener('keydown', (e) => {\n      // Ctrl/Cmd + Shift + T for theme switching\n      if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'T') {\n        e.preventDefault();\n        this.cycleTheme();\n      }\n    });\n  }\n\n  /**\n   * Setup system theme detection\n   */\n  setupSystemThemeDetection() {\n    // Listen for system theme changes\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    mediaQuery.addEventListener('change', () => {\n      // Only update if current theme is 'system'\n      if (this.currentTheme === 'system') {\n        this.setTheme('system', false); // Don't save, just update display\n      }\n    });\n  }\n\n  /**\n   * Cycle through themes (for keyboard shortcut)\n   */\n  cycleTheme() {\n    const currentIndex = this.themes.indexOf(this.currentTheme);\n    const nextIndex = (currentIndex + 1) % this.themes.length;\n    this.setTheme(this.themes[nextIndex]);\n  }\n\n  /**\n   * Update the theme switcher icon\n   */\n  updateThemeIcon(theme) {\n    const icon = document.querySelector('[data-role=\"theme-icon\"]');\n    if (icon) {\n      let iconClass;\n      switch (theme) {\n        case 'dark':\n          iconClass = 'ti-moon-stars';\n          break;\n        case 'system':\n          iconClass = 'ti-device-desktop-analytics';\n          break;\n        default:\n          iconClass = 'ti-sun';\n      }\n      icon.className = `ti ${iconClass} ti-md`;\n      icon.setAttribute('data-role', 'theme-icon');\n    }\n  }\n\n  /**\n   * Update active state in dropdown menu\n   */\n  updateActiveMenuItem(theme) {\n    // Remove active class from all theme menu items\n    document.querySelectorAll('[data-theme]').forEach(item => {\n      item.classList.remove('active');\n    });\n\n    // Add active class to current theme\n    const activeItem = document.querySelector(`[data-theme=\"${theme}\"]`);\n    if (activeItem) {\n      activeItem.classList.add('active');\n    }\n  }\n\n  /**\n   * Save theme preference to server\n   */\n  saveThemeToServer(theme) {\n    const csrfToken = document.querySelector('meta[name=\"csrf-token\"]');\n    if (!csrfToken) {\n      console.warn('CSRF token not found, theme not saved to server');\n      return;\n    }\n\n    fetch('/set-theme', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Csrftoken': csrfToken.getAttribute('content')\n      },\n      body: JSON.stringify({ theme: theme })\n    }).then(response => {\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      return response.json();\n    }).then(data => {\n      if (!data.success) {\n        console.error('Theme save failed:', data.message);\n      }\n    }).catch(error => {\n      console.error('Failed to save theme to server:', error);\n    });\n  }\n\n  /**\n   * Get current theme\n   */\n  getCurrentTheme() {\n    return this.currentTheme;\n  }\n\n  /**\n   * Get effective theme (resolves system theme)\n   */\n  getEffectiveTheme() {\n    return this.resolveSystemTheme(this.currentTheme);\n  }\n\n  // ========================================================================\n  // THEME VARIANT METHODS (Modern Only)\n  // ========================================================================\n\n  /**\n   * Set the theme variant (modern only)\n   * @param {string} variant - 'modern'\n   * @param {boolean} save - Whether to save to localStorage and server\n   */\n  setVariant(variant, save = true) {\n    if (!this.variants.includes(variant)) {\n      console.warn(`Invalid variant: ${variant}. Using modern instead.`);\n      variant = 'modern';\n    }\n\n    console.log('Setting variant to:', variant);\n    this.currentVariant = variant;\n\n    // Apply variant to document\n    document.documentElement.setAttribute('data-theme-variant', variant);\n\n    // Update variant class (modern only)\n    document.documentElement.classList.remove('theme-modern');\n    document.documentElement.classList.add(`theme-${variant}`);\n\n    if (save) {\n      // Save to localStorage\n      localStorage.setItem('theme-variant', variant);\n\n      // Save to server\n      this.saveVariantToServer(variant);\n    }\n\n    // Dispatch custom event for other components\n    document.dispatchEvent(new CustomEvent('variantChanged', {\n      detail: { variant: variant }\n    }));\n\n    // If switching to modern, we need to reload to load the CSS files\n    // (since they're conditionally loaded server-side)\n    if (save) {\n      // Show a brief notification then reload\n      this.notifyAndReload(variant);\n    }\n\n    console.log('Variant applied successfully');\n  }\n\n  /**\n   * Show notification and reload page to apply variant CSS\n   */\n  notifyAndReload(variant) {\n    // Use SweetAlert2 if available, otherwise just reload\n    if (typeof Swal !== 'undefined') {\n      Swal.fire({\n        title: 'Applying Theme',\n        text: `Switching to ${variant} theme...`,\n        icon: 'info',\n        timer: 1500,\n        timerProgressBar: true,\n        showConfirmButton: false,\n        allowOutsideClick: false\n      }).then(() => {\n        window.location.reload();\n      });\n    } else {\n      window.location.reload();\n    }\n  }\n\n  /**\n   * Save variant preference to server\n   */\n  saveVariantToServer(variant) {\n    const csrfToken = document.querySelector('meta[name=\"csrf-token\"]');\n    if (!csrfToken) {\n      console.warn('CSRF token not found, variant not saved to server');\n      return;\n    }\n\n    fetch('/set-theme-variant', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Csrftoken': csrfToken.getAttribute('content')\n      },\n      body: JSON.stringify({ variant: variant })\n    }).then(response => {\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      return response.json();\n    }).then(data => {\n      if (!data.success) {\n        console.error('Variant save failed:', data.message);\n      }\n    }).catch(error => {\n      console.error('Failed to save variant to server:', error);\n    });\n  }\n\n  /**\n   * Get current variant\n   */\n  getCurrentVariant() {\n    return this.currentVariant;\n  }\n\n  /**\n   * Check if modern theme is active\n   */\n  isModern() {\n    return this.currentVariant === 'modern';\n  }\n\n  /**\n   * Toggle between modern variants (currently only 'modern' is available)\n   */\n  toggleVariant() {\n    // Only modern variant is available\n    this.setVariant('modern');\n  }\n}\n\n// Initialize theme switcher when DOM is ready\ndocument.addEventListener('DOMContentLoaded', () => {\n  // Create global instance\n  window.themeSwitcher = new SimpleThemeSwitcher();\n\n  // Check if theme sync is needed (set by early script)\n  if (window._themeNeedsSync) {\n    // Theme was already applied at top of page, just sync to server\n    window.themeSwitcher.currentTheme = window._themeNeedsSync.theme;\n    window.themeSwitcher.saveThemeToServer(window._themeNeedsSync.theme);\n    window.themeSwitcher.updateThemeIcon(window._themeNeedsSync.theme);\n    window.themeSwitcher.updateActiveMenuItem(window._themeNeedsSync.theme);\n    delete window._themeNeedsSync; // Clean up\n  }\n\n  // Check if variant sync is needed (set by early script)\n  if (window._variantNeedsSync) {\n    window.themeSwitcher.currentVariant = window._variantNeedsSync.variant;\n    window.themeSwitcher.saveVariantToServer(window._variantNeedsSync.variant);\n    delete window._variantNeedsSync; // Clean up\n  }\n\n  // Get current theme (already set by early script)\n  const currentTheme = document.documentElement.getAttribute('data-style') || 'light';\n  const currentVariant = document.documentElement.getAttribute('data-theme-variant') || 'modern';\n\n  // Just update the UI to match what's already applied\n  window.themeSwitcher.currentTheme = currentTheme;\n  window.themeSwitcher.currentVariant = currentVariant;\n  window.themeSwitcher.updateThemeIcon(currentTheme);\n  window.themeSwitcher.updateActiveMenuItem(currentTheme);\n\n  // No need to call setTheme() - theme is already applied correctly\n});\n\n// Expose for debugging\nwindow.SimpleThemeSwitcher = SimpleThemeSwitcher;\n","/**\n * ============================================================================\n * ADMIN NAVIGATION CONTROLLER\n * ============================================================================\n *\n * Modern, production-ready navigation controller following architectural standards:\n * - Event delegation (single listener on container)\n * - Data-* attribute hooks (no binding to styling classes)\n * - State-driven via CSS classes (is-open, is-active)\n * - No inline styles or event handlers\n * - Accessible keyboard navigation\n * - Mobile-friendly touch interactions\n *\n * Dependencies: None (vanilla JS)\n *\n * ============================================================================\n */\n\n(function() {\n  'use strict';\n\n  /**\n   * Admin Navigation Controller\n   * Handles all navigation interactions via event delegation\n   */\n  class AdminNavigationController {\n    constructor(element) {\n      this.nav = element;\n      this.activeDropdown = null;\n      this.init();\n    }\n\n    /**\n     * Initialize the controller\n     */\n    init() {\n      // Keyboard navigation\n      this.nav.addEventListener('keydown', this.handleKeyboard.bind(this));\n\n      // Close dropdowns when clicking outside\n      document.addEventListener('click', this.handleOutsideClick.bind(this));\n\n      // Close dropdowns on escape key\n      document.addEventListener('keydown', this.handleEscapeKey.bind(this));\n\n      // Register actions with EventDelegation\n      this.registerActions();\n    }\n\n    /**\n     * Register actions with EventDelegation\n     */\n    registerActions() {\n      if (typeof EventDelegation !== 'undefined') {\n        EventDelegation.register('toggle-dropdown', this.handleToggleDropdown.bind(this), { preventDefault: true });\n        EventDelegation.register('navigate', this.handleNavigation.bind(this), { preventDefault: false });\n        EventDelegation.register('close-dropdown', this.handleCloseDropdown.bind(this), { preventDefault: true });\n      }\n    }\n\n    /**\n     * Handle toggle dropdown action\n     * @param {Element} element - The element that was clicked (from EventDelegation)\n     * @param {Event} e - The click event\n     */\n    handleToggleDropdown(element, e) {\n      this.toggleDropdown(element);\n    }\n\n    /**\n     * Handle close dropdown action\n     * @param {Element} element - The element that was clicked (from EventDelegation)\n     * @param {Event} e - The click event\n     */\n    handleCloseDropdown(element, e) {\n      this.closeDropdown(element);\n    }\n\n    /**\n     * Handle keyboard navigation\n     * @param {KeyboardEvent} e - Keyboard event\n     */\n    handleKeyboard(e) {\n      const target = e.target;\n\n      // Enter or Space on dropdown toggle\n      if ((e.key === 'Enter' || e.key === ' ') &&\n          target.dataset.action === 'toggle-dropdown') {\n        e.preventDefault();\n        this.toggleDropdown(target);\n      }\n\n      // Arrow keys in dropdown\n      if (this.activeDropdown && (e.key === 'ArrowDown' || e.key === 'ArrowUp')) {\n        e.preventDefault();\n        this.navigateDropdown(e.key);\n      }\n    }\n\n    /**\n     * Handle escape key to close dropdowns\n     * @param {KeyboardEvent} e - Keyboard event\n     */\n    handleEscapeKey(e) {\n      if (e.key === 'Escape' && this.activeDropdown) {\n        this.closeAllDropdowns();\n        // Return focus to the toggle button\n        const toggle = this.activeDropdown.previousElementSibling;\n        if (toggle) toggle.focus();\n      }\n    }\n\n    /**\n     * Handle clicks outside nav to close dropdowns\n     * @param {Event} e - Click event\n     */\n    handleOutsideClick(e) {\n      if (!this.nav.contains(e.target) && this.activeDropdown) {\n        this.closeAllDropdowns();\n      }\n    }\n\n    /**\n     * Toggle dropdown menu\n     * @param {HTMLElement} toggle - The dropdown toggle button\n     */\n    toggleDropdown(toggle) {\n      const dropdownItem = toggle.closest('[data-dropdown]');\n      if (!dropdownItem) return;\n\n      const dropdown = dropdownItem.querySelector('.c-admin-nav__dropdown');\n      if (!dropdown) return;\n\n      const isOpen = dropdownItem.classList.contains('is-open');\n\n      // Close all other dropdowns first\n      this.closeAllDropdowns();\n\n      if (!isOpen) {\n        // Open this dropdown\n        dropdownItem.classList.add('is-open');\n        toggle.classList.add('is-open');\n        toggle.setAttribute('aria-expanded', 'true');\n        dropdown.setAttribute('aria-hidden', 'false');\n\n        this.activeDropdown = dropdown;\n\n        // Focus first dropdown item for keyboard navigation\n        const firstItem = dropdown.querySelector('.c-admin-nav__dropdown-item');\n        if (firstItem) firstItem.focus();\n      } else {\n        // Close this dropdown\n        this.closeDropdown(dropdownItem);\n      }\n    }\n\n    /**\n     * Close specific dropdown\n     * @param {HTMLElement} element - Dropdown item or toggle\n     */\n    closeDropdown(element) {\n      const dropdownItem = element.closest('[data-dropdown]');\n      if (!dropdownItem) return;\n\n      const toggle = dropdownItem.querySelector('[data-action=\"toggle-dropdown\"]');\n      const dropdown = dropdownItem.querySelector('.c-admin-nav__dropdown');\n\n      dropdownItem.classList.remove('is-open');\n      if (toggle) {\n        toggle.classList.remove('is-open');\n        toggle.setAttribute('aria-expanded', 'false');\n      }\n      if (dropdown) {\n        dropdown.setAttribute('aria-hidden', 'true');\n      }\n\n      if (this.activeDropdown === dropdown) {\n        this.activeDropdown = null;\n      }\n    }\n\n    /**\n     * Close all dropdowns\n     */\n    closeAllDropdowns() {\n      const openDropdowns = this.nav.querySelectorAll('[data-dropdown].is-open');\n      openDropdowns.forEach(item => this.closeDropdown(item));\n    }\n\n    /**\n     * Navigate within dropdown using arrow keys\n     * @param {string} direction - 'ArrowUp' or 'ArrowDown'\n     */\n    navigateDropdown(direction) {\n      if (!this.activeDropdown) return;\n\n      const items = Array.from(\n        this.activeDropdown.querySelectorAll('.c-admin-nav__dropdown-item:not(.is-disabled)')\n      );\n\n      const currentIndex = items.indexOf(document.activeElement);\n\n      let nextIndex;\n      if (direction === 'ArrowDown') {\n        nextIndex = currentIndex < items.length - 1 ? currentIndex + 1 : 0;\n      } else {\n        nextIndex = currentIndex > 0 ? currentIndex - 1 : items.length - 1;\n      }\n\n      items[nextIndex].focus();\n    }\n\n    /**\n     * Handle navigation (could add analytics here)\n     * @param {Event} e - Click event\n     * @param {HTMLElement} link - The clicked link\n     */\n    handleNavigation(element, e) {\n      // EventDelegation passes (element, event) - element is the clicked link\n      if (!element || !element.classList) return;\n\n      // Remove active state from all links\n      const allLinks = this.nav.querySelectorAll('.c-admin-nav__link');\n      allLinks.forEach(l => l.classList.remove('is-active'));\n\n      // Add active state to clicked link\n      element.classList.add('is-active');\n    }\n\n    /**\n     * Destroy the controller\n     */\n    destroy() {\n      this.nav.removeEventListener('keydown', this.handleKeyboard);\n      document.removeEventListener('click', this.handleOutsideClick);\n      document.removeEventListener('keydown', this.handleEscapeKey);\n    }\n  }\n\n  /**\n   * Auto-initialize all admin navigation components\n   */\n  function initAdminNavigation() {\n    // Page guard: only run on admin pages\n    const isAdminPage = document.querySelector('[data-controller=\"admin-nav\"]') ||\n                        document.querySelector('.c-admin-nav') ||\n                        window.location.pathname.includes('/admin');\n\n    if (!isAdminPage) {\n      return;\n    }\n\n    const navElements = document.querySelectorAll('[data-controller=\"admin-nav\"]');\n\n    if (navElements.length === 0) {\n      // Try fallback to class selector\n      const altNav = document.querySelector('.c-admin-nav');\n      if (altNav && !altNav.hasAttribute('data-controller')) {\n        altNav.setAttribute('data-controller', 'admin-nav');\n        altNav.adminNavController = new AdminNavigationController(altNav);\n      }\n      return;\n    }\n\n    navElements.forEach(nav => {\n      // Avoid double initialization\n      if (nav.adminNavController) return;\n\n      // Create and attach controller\n      nav.adminNavController = new AdminNavigationController(nav);\n    });\n  }\n\n  /**\n   * Initialize on DOM ready\n   */\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initAdminNavigation);\n  } else {\n    initAdminNavigation();\n  }\n\n  /**\n   * Re-initialize on dynamic content updates (HTMX, Turbo, etc.)\n   * Uncomment if using HTMX or Turbo:\n   */\n  // document.body.addEventListener('htmx:afterSwap', initAdminNavigation);\n  // document.addEventListener('turbo:load', initAdminNavigation);\n\n  /**\n   * Export for manual initialization if needed\n   */\n  window.AdminNavigationController = AdminNavigationController;\n  window.initAdminNavigation = initAdminNavigation;\n\n})();\n\n/**\n * ============================================================================\n * USAGE NOTES\n * ============================================================================\n *\n * AUTOMATIC INITIALIZATION:\n * - Runs automatically on DOMContentLoaded\n * - Finds all elements with data-controller=\"admin-nav\"\n * - Creates controller instance for each\n *\n * MANUAL INITIALIZATION:\n * window.initAdminNavigation(); // Re-init all\n *\n * const nav = document.querySelector('.c-admin-nav');\n * nav.adminNavController = new AdminNavigationController(nav);\n *\n * DESTROY:\n * nav.adminNavController.destroy();\n * nav.adminNavController = null;\n *\n * REQUIRED HTML STRUCTURE:\n * <nav class=\"c-admin-nav\" data-controller=\"admin-nav\">\n *   <ul class=\"c-admin-nav__list\">\n *     <li class=\"c-admin-nav__item\" data-dropdown>\n *       <button class=\"c-admin-nav__link c-admin-nav__dropdown-toggle\"\n *               data-action=\"toggle-dropdown\">\n *         Menu\n *       </button>\n *       <ul class=\"c-admin-nav__dropdown\">...</ul>\n *     </li>\n *   </ul>\n * </nav>\n *\n * DATA ATTRIBUTES:\n * - data-controller=\"admin-nav\" - Marks nav container (required)\n * - data-action=\"toggle-dropdown\" - Toggle dropdown\n * - data-action=\"navigate\" - Track navigation\n * - data-dropdown - Marks dropdown parent\n *\n * STATE CLASSES (CSS DRIVEN):\n * - is-open - Dropdown is open\n * - is-active - Nav item is active\n * - is-disabled - Nav item is disabled\n *\n * EVENTS:\n * Controller handles all events via delegation\n * No inline onclick or event handlers needed\n *\n * ============================================================================\n */\n","/**\n * ============================================================================\n * MODERN COMPONENTS CONTROLLER - ATHLETIC PRECISION\n * ============================================================================\n *\n * Unified JavaScript controller for all modern components\n * - Event delegation architecture\n * - Data-attribute based hooks\n * - No direct element binding\n * - Modular initialization\n * - Performance optimized\n *\n * Components handled:\n * - Modals\n * - Toasts\n * - Tooltips\n * - Dropdowns\n * - Tables (sorting, pagination)\n * - Forms (validation)\n *\n * ============================================================================\n */\n\n(function() {\n  'use strict';\n\n  /**\n   * ============================================================================\n   * MODAL CONTROLLER\n   * ============================================================================\n   */\n  const ModalController = {\n    activeModals: new Set(),\n\n    init() {\n      // Helper to safely get element from event target\n      const getElement = (target) => target instanceof Element ? target : null;\n\n      // Register modal triggers via EventDelegation\n      if (typeof EventDelegation !== 'undefined') {\n        EventDelegation.register('modal-trigger', (element, e) => {\n          const modalId = element.dataset.modalTrigger;\n          if (modalId) {\n            this.open(modalId);\n          }\n        }, { preventDefault: true });\n\n        EventDelegation.register('close-modal', (element, e) => {\n          const modal = element.closest('.c-modal-modern');\n          if (modal) this.close(modal.id);\n        }, { preventDefault: true });\n      }\n\n      // Close on backdrop click\n      document.addEventListener('click', (e) => {\n        const el = getElement(e.target);\n        if (!el) return;\n        if (el.classList.contains('c-modal-modern__backdrop')) {\n          const openModal = Array.from(this.activeModals).pop();\n          if (openModal) this.close(openModal);\n        }\n      });\n\n      // Close on Escape key\n      document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape' && this.activeModals.size > 0) {\n          const topModal = Array.from(this.activeModals).pop();\n          this.close(topModal);\n        }\n      });\n    },\n\n    open(modalId) {\n      const modal = document.getElementById(modalId);\n      const backdrop = document.querySelector(`[data-modal-backdrop=\"${modalId}\"]`);\n\n      if (!modal) return;\n\n      // Add to active stack\n      this.activeModals.add(modalId);\n\n      // Show backdrop\n      if (backdrop) {\n        backdrop.classList.add('is-open');\n      }\n\n      // Show modal\n      modal.classList.add('is-open');\n      modal.setAttribute('aria-hidden', 'false');\n\n      // Focus trap\n      this.trapFocus(modal);\n\n      // Emit custom event\n      modal.dispatchEvent(new CustomEvent('modal:opened', { detail: { id: modalId } }));\n    },\n\n    close(modalId) {\n      const modal = document.getElementById(modalId);\n      const backdrop = document.querySelector(`[data-modal-backdrop=\"${modalId}\"]`);\n\n      if (!modal) return;\n\n      // Add closing state for animation\n      modal.classList.add('is-closing');\n\n      setTimeout(() => {\n        modal.classList.remove('is-open', 'is-closing');\n        modal.setAttribute('aria-hidden', 'true');\n\n        if (backdrop) {\n          backdrop.classList.remove('is-open');\n        }\n\n        // Remove from active stack\n        this.activeModals.delete(modalId);\n\n        // Emit custom event\n        modal.dispatchEvent(new CustomEvent('modal:closed', { detail: { id: modalId } }));\n      }, 300);\n    },\n\n    trapFocus(modal) {\n      const focusableElements = modal.querySelectorAll(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n      );\n      const firstElement = focusableElements[0];\n      const lastElement = focusableElements[focusableElements.length - 1];\n\n      const handleTabKey = (e) => {\n        if (e.key !== 'Tab') return;\n\n        if (e.shiftKey) {\n          if (document.activeElement === firstElement) {\n            lastElement.focus();\n            e.preventDefault();\n          }\n        } else {\n          if (document.activeElement === lastElement) {\n            firstElement.focus();\n            e.preventDefault();\n          }\n        }\n      };\n\n      modal.addEventListener('keydown', handleTabKey);\n      firstElement?.focus();\n    }\n  };\n\n  /**\n   * ============================================================================\n   * TOAST CONTROLLER\n   * ============================================================================\n   */\n  const ToastController = {\n    container: null,\n    toasts: new Map(),\n    idCounter: 0,\n\n    init() {\n      // Create toast container if doesn't exist\n      if (!this.container) {\n        this.container = document.createElement('div');\n        this.container.className = 'c-toast-modern__container';\n        document.body.appendChild(this.container);\n      }\n\n      // Register dismiss action via EventDelegation\n      if (typeof EventDelegation !== 'undefined') {\n        EventDelegation.register('dismiss-toast', (element, e) => {\n          const toastId = element.dataset.toastId;\n          if (toastId) {\n            this.dismiss(toastId);\n          }\n        });\n      }\n    },\n\n    show(options = {}) {\n      const {\n        type = 'info',\n        title,\n        message,\n        duration = 5000,\n        dismissible = true,\n        actions = []\n      } = options;\n\n      const toastId = `toast-${++this.idCounter}`;\n\n      const toast = document.createElement('div');\n      toast.className = `c-toast-modern c-toast-modern--${type}`;\n      toast.id = toastId;\n      toast.setAttribute('role', 'alert');\n      toast.setAttribute('aria-live', 'polite');\n\n      // Icon mapping\n      const icons = {\n        success: '',\n        error: '',\n        warning: '',\n        info: ''\n      };\n\n      toast.innerHTML = `\n        <div class=\"c-toast-modern__icon\">${icons[type] || icons.info}</div>\n        <div class=\"c-toast-modern__content\">\n          ${title ? `<h4 class=\"c-toast-modern__title\">${title}</h4>` : ''}\n          ${message ? `<p class=\"c-toast-modern__message\">${message}</p>` : ''}\n          ${actions.length > 0 ? `\n            <div class=\"c-toast-modern__actions\">\n              ${actions.map(action => `\n                <button class=\"c-toast-modern__action\" data-action=\"toast-action\" data-callback=\"${action.callback}\">\n                  ${action.label}\n                </button>\n              `).join('')}\n            </div>\n          ` : ''}\n        </div>\n        ${dismissible ? `\n          <button class=\"c-toast-modern__dismiss\" data-action=\"dismiss-toast\" data-toast-id=\"${toastId}\" aria-label=\"Close\"></button>\n        ` : ''}\n        ${duration > 0 ? `\n          <div class=\"c-toast-modern__progress\">\n            <div class=\"c-toast-modern__progress-bar\" data-duration=\"${duration}\"></div>\n          </div>\n        ` : ''}\n      `;\n\n      this.container.appendChild(toast);\n\n      // Trigger animation\n      requestAnimationFrame(() => {\n        toast.classList.add('is-visible');\n      });\n\n      // Auto-dismiss\n      if (duration > 0) {\n        setTimeout(() => {\n          this.dismiss(toastId);\n        }, duration);\n      }\n\n      this.toasts.set(toastId, toast);\n      return toastId;\n    },\n\n    dismiss(toastId) {\n      const toast = this.toasts.get(toastId);\n      if (!toast) return;\n\n      toast.classList.add('is-dismissing');\n      toast.classList.remove('is-visible');\n\n      setTimeout(() => {\n        toast.remove();\n        this.toasts.delete(toastId);\n      }, 300);\n    }\n  };\n\n  /**\n   * ============================================================================\n   * TOOLTIP CONTROLLER\n   * ============================================================================\n   */\n  const TooltipController = {\n    activeTooltip: null,\n    tooltips: new Map(),\n\n    init() {\n      // Helper to safely get element from event target\n      const getElement = (target) => target instanceof Element ? target : null;\n\n      // Find all elements with data-tooltip\n      document.addEventListener('mouseenter', (e) => {\n        const el = getElement(e.target);\n        if (!el) return;\n        const trigger = el.closest('[data-tooltip]');\n        if (trigger) {\n          this.show(trigger);\n        }\n      }, true);\n\n      document.addEventListener('mouseleave', (e) => {\n        const el = getElement(e.target);\n        if (!el) return;\n        const trigger = el.closest('[data-tooltip]');\n        if (trigger) {\n          this.hide();\n        }\n      }, true);\n\n      // Keyboard support\n      document.addEventListener('focus', (e) => {\n        const el = getElement(e.target);\n        if (!el) return;\n        const trigger = el.closest('[data-tooltip]');\n        if (trigger) {\n          this.show(trigger);\n        }\n      }, true);\n\n      document.addEventListener('blur', (e) => {\n        const el = getElement(e.target);\n        if (!el) return;\n        const trigger = el.closest('[data-tooltip]');\n        if (trigger) {\n          this.hide();\n        }\n      }, true);\n    },\n\n    show(trigger) {\n      const content = trigger.dataset.tooltip;\n      const position = trigger.dataset.tooltipPosition || 'top';\n      const variant = trigger.dataset.tooltipVariant || '';\n\n      if (!content) return;\n\n      // Create tooltip\n      const tooltip = document.createElement('div');\n      tooltip.className = `c-tooltip-modern c-tooltip-modern--${position} ${variant ? `c-tooltip-modern--${variant}` : ''}`;\n      tooltip.setAttribute('role', 'tooltip');\n      tooltip.innerHTML = `\n        ${content}\n        <div class=\"c-tooltip-modern__arrow\"></div>\n      `;\n\n      // Position tooltip\n      trigger.appendChild(tooltip);\n\n      // Show with animation\n      requestAnimationFrame(() => {\n        tooltip.classList.add('is-visible');\n      });\n\n      this.activeTooltip = tooltip;\n    },\n\n    hide() {\n      if (this.activeTooltip) {\n        this.activeTooltip.classList.remove('is-visible');\n        setTimeout(() => {\n          this.activeTooltip?.remove();\n          this.activeTooltip = null;\n        }, 200);\n      }\n    }\n  };\n\n  /**\n   * ============================================================================\n   * DROPDOWN CONTROLLER\n   * ============================================================================\n   */\n  const DropdownController = {\n    activeDropdown: null,\n\n    init() {\n      // Register dropdown trigger via EventDelegation\n      if (typeof EventDelegation !== 'undefined') {\n        EventDelegation.register('dropdown-trigger', (element, e) => {\n          const dropdownId = element.dataset.dropdownTrigger;\n          if (dropdownId) {\n            this.toggle(dropdownId);\n          }\n        }, { preventDefault: true });\n      } else {\n        // Fallback\n        document.addEventListener('click', (e) => {\n          if (!(e.target instanceof Element)) return;\n\n          const trigger = e.target.closest('[data-dropdown-trigger]');\n          if (trigger) {\n            e.preventDefault();\n            const dropdownId = trigger.dataset.dropdownTrigger;\n            this.toggle(dropdownId);\n          }\n        });\n      }\n\n      // Close if clicking outside\n      document.addEventListener('click', (e) => {\n        if (!e.target.closest('.c-dropdown-modern') && this.activeDropdown) {\n          this.close(this.activeDropdown);\n        }\n      });\n\n      // Keyboard navigation\n      document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape' && this.activeDropdown) {\n          this.close(this.activeDropdown);\n        }\n      });\n    },\n\n    toggle(dropdownId) {\n      const dropdown = document.getElementById(dropdownId);\n      if (!dropdown) return;\n\n      if (dropdown.classList.contains('is-open')) {\n        this.close(dropdownId);\n      } else {\n        // Close any open dropdown\n        if (this.activeDropdown) {\n          this.close(this.activeDropdown);\n        }\n        this.open(dropdownId);\n      }\n    },\n\n    open(dropdownId) {\n      const dropdown = document.getElementById(dropdownId);\n      if (!dropdown) return;\n\n      dropdown.classList.add('is-open');\n      this.activeDropdown = dropdownId;\n\n      // Emit event\n      dropdown.dispatchEvent(new CustomEvent('dropdown:opened', { detail: { id: dropdownId } }));\n    },\n\n    close(dropdownId) {\n      const dropdown = document.getElementById(dropdownId);\n      if (!dropdown) return;\n\n      dropdown.classList.remove('is-open');\n      if (this.activeDropdown === dropdownId) {\n        this.activeDropdown = null;\n      }\n\n      // Emit event\n      dropdown.dispatchEvent(new CustomEvent('dropdown:closed', { detail: { id: dropdownId } }));\n    }\n  };\n\n  /**\n   * ============================================================================\n   * TABLE CONTROLLER\n   * ============================================================================\n   */\n  const TableController = {\n    init() {\n      // Helper to safely get element from event target\n      const getElement = (target) => target instanceof Element ? target : null;\n\n      // Sortable columns\n      document.addEventListener('click', (e) => {\n        const el = getElement(e.target);\n        if (!el) return;\n        const header = el.closest('.c-table-modern__header--sortable');\n        if (header) {\n          this.sort(header);\n        }\n      });\n\n      // Pagination\n      document.addEventListener('click', (e) => {\n        const el = getElement(e.target);\n        if (!el) return;\n        const paginationBtn = el.closest('.c-table-modern__pagination-button');\n        if (paginationBtn && !paginationBtn.disabled) {\n          const page = parseInt(paginationBtn.dataset.page);\n          const tableId = paginationBtn.closest('[data-table-id]')?.dataset.tableId;\n          if (tableId) {\n            this.paginate(tableId, page);\n          }\n        }\n      });\n    },\n\n    sort(header) {\n      const table = header.closest('.c-table-modern');\n      const column = header.dataset.sortColumn;\n      const currentDirection = header.dataset.sortDirection || 'none';\n\n      // Determine new direction\n      let newDirection = 'asc';\n      if (currentDirection === 'asc') newDirection = 'desc';\n      if (currentDirection === 'desc') newDirection = 'none';\n\n      // Remove sorting from other headers\n      table.querySelectorAll('.c-table-modern__header--sortable').forEach(h => {\n        h.classList.remove('c-table-modern__header--sorted-asc', 'c-table-modern__header--sorted-desc');\n        h.dataset.sortDirection = 'none';\n      });\n\n      // Apply new sorting\n      if (newDirection !== 'none') {\n        header.classList.add(`c-table-modern__header--sorted-${newDirection}`);\n        header.dataset.sortDirection = newDirection;\n      }\n\n      // Emit event for external handling\n      table.dispatchEvent(new CustomEvent('table:sort', {\n        detail: { column, direction: newDirection }\n      }));\n    },\n\n    paginate(tableId, page) {\n      const table = document.querySelector(`[data-table-id=\"${tableId}\"]`);\n      if (!table) return;\n\n      // Emit event for external handling\n      table.dispatchEvent(new CustomEvent('table:paginate', {\n        detail: { page }\n      }));\n    }\n  };\n\n  /**\n   * ============================================================================\n   * FORM VALIDATION CONTROLLER\n   * ============================================================================\n   */\n  const FormController = {\n    init() {\n      // Helper to safely get element from event target\n      const getElement = (target) => target instanceof Element ? target : null;\n\n      // Real-time validation\n      document.addEventListener('blur', (e) => {\n        const el = getElement(e.target);\n        if (!el) return;\n        const input = el.closest('.c-form-modern__input');\n        if (input) {\n          this.validateField(input);\n        }\n      }, true);\n\n      // Form submission\n      document.addEventListener('submit', (e) => {\n        const el = getElement(e.target);\n        if (!el) return;\n        const form = el.closest('form[data-validate]');\n        if (form) {\n          if (!this.validateForm(form)) {\n            e.preventDefault();\n          }\n        }\n      });\n    },\n\n    validateField(input) {\n      const isValid = input.checkValidity();\n\n      if (isValid) {\n        input.classList.remove('is-invalid');\n        input.classList.add('is-valid');\n        this.clearError(input);\n      } else {\n        input.classList.remove('is-valid');\n        input.classList.add('is-invalid');\n        this.showError(input, input.validationMessage);\n      }\n\n      return isValid;\n    },\n\n    validateForm(form) {\n      const inputs = form.querySelectorAll('.c-form-modern__input');\n      let isValid = true;\n\n      inputs.forEach(input => {\n        if (!this.validateField(input)) {\n          isValid = false;\n        }\n      });\n\n      return isValid;\n    },\n\n    showError(input, message) {\n      let feedback = input.parentElement.querySelector('.c-form-modern__feedback--invalid');\n\n      if (!feedback) {\n        feedback = document.createElement('div');\n        feedback.className = 'c-form-modern__feedback c-form-modern__feedback--invalid';\n        input.parentElement.appendChild(feedback);\n      }\n\n      feedback.textContent = message;\n    },\n\n    clearError(input) {\n      const feedback = input.parentElement.querySelector('.c-form-modern__feedback--invalid');\n      if (feedback) {\n        feedback.remove();\n      }\n    }\n  };\n\n  /**\n   * ============================================================================\n   * INITIALIZATION\n   * ============================================================================\n   */\n  function init() {\n    // NOTE: ModalController is DISABLED to prevent conflicts with ModalManager\n    // ModalManager (modal-manager.js) handles all Bootstrap modals (.modal class)\n    // ModalController was designed for .c-modal-modern class which is not used in templates\n    // Keeping the controller code for reference but not initializing it\n    // ModalController.init();\n    ToastController.init();\n    TooltipController.init();\n    DropdownController.init();\n    TableController.init();\n    FormController.init();\n\n    console.log('Modern components initialized');\n  }\n\n  // Expose API for external use\n  window.ModernComponents = {\n    Modal: ModalController,\n    Toast: ToastController,\n    Tooltip: TooltipController,\n    Dropdown: DropdownController,\n    Table: TableController,\n    Form: FormController\n  };\n\n  // Register with InitSystem if available\n  if (typeof window.InitSystem !== 'undefined' && window.InitSystem.register) {\n    window.InitSystem.register('components-modern', init, {\n      priority: 70,\n      description: 'Modern UI components (toast, tooltip, dropdown, table, form)',\n      reinitializable: true\n    });\n  } else {\n    // Fallback: Initialize on DOM ready\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', init);\n    } else {\n      init();\n    }\n  }\n\n})();\n","/**\n * ECS Soccer League Responsive System\n *\n * A comprehensive responsive management system that handles device detection,\n * responsive behavior, and UI enhancements across all screen sizes and devices.\n *\n * REFACTORED: All inline style manipulations replaced with CSS class-based approach\n * for better maintainability, performance, and separation of concerns.\n *\n * @version 1.0.2\n * @updated 2025-12-26 - Code review for EventDelegation (no changes needed)\n */\n(function () {\n  'use strict';\n\n  // Main responsive system controller\n  const ResponsiveSystem = {\n    // Device detection states\n    device: {\n      isMobile: false,\n      isTablet: false,\n      isDesktop: false,\n      isIOS: false,\n      isAndroid: false,\n      hasTouch: false,\n      hasMouse: false\n    },\n\n    /**\n     * Initialize the responsive system\n     */\n    init: function () {\n      this.detectDevice();\n      this.applyDeviceClasses();\n      this.fixIOSViewportHeight();\n      this.setupTouchFeedback();\n      this.enhanceModals();\n      this.enhanceFormControls();\n      this.enhanceTables();\n      this.enhanceNavigation();\n      this.improveScrolling();\n      this.monitorNetworkStatus();\n      this.attachEventListeners();\n      this.setupMutationObserver();\n\n      // Log initialization\n      // console.log('ResponsiveSystem initialized', this.device);\n    },\n\n    /**\n     * Detect device capabilities and properties\n     */\n    detectDevice: function () {\n      // Touch capability detection\n      this.device.hasTouch = ('ontouchstart' in window) ||\n        (navigator.maxTouchPoints > 0) ||\n        (navigator.msMaxTouchPoints > 0);\n\n      // Mouse capability detection\n      this.device.hasMouse = matchMedia('(hover: hover) and (pointer: fine)').matches;\n\n      // Screen size detection\n      const screenWidth = window.innerWidth;\n      this.device.isMobile = screenWidth < 768;\n      this.device.isTablet = screenWidth >= 768 && screenWidth < 992;\n      this.device.isDesktop = screenWidth >= 992;\n\n      // OS detection\n      const userAgent = navigator.userAgent.toLowerCase();\n      this.device.isIOS = /iphone|ipad|ipod/.test(userAgent);\n      this.device.isAndroid = /android/.test(userAgent);\n    },\n\n    /**\n     * Apply device-specific classes to the body element\n     */\n    applyDeviceClasses: function () {\n      const body = document.body;\n\n      // Remove existing classes to prevent duplicates\n      body.classList.remove(\n        'mobile-device', 'tablet-device', 'desktop-device',\n        'ios-device', 'android-device', 'touch-device', 'mouse-device'\n      );\n\n      // Add device type classes\n      if (this.device.isMobile) body.classList.add('mobile-device');\n      if (this.device.isTablet) body.classList.add('tablet-device');\n      if (this.device.isDesktop) body.classList.add('desktop-device');\n\n      // Add OS type classes\n      if (this.device.isIOS) body.classList.add('ios-device');\n      if (this.device.isAndroid) body.classList.add('android-device');\n\n      // Add input type classes\n      if (this.device.hasTouch) body.classList.add('touch-device');\n      if (this.device.hasMouse) body.classList.add('mouse-device');\n    },\n\n    /**\n     * Fix iOS 100vh issue with CSS custom property\n     * REFACTORED: Using CSS custom property instead of inline styles\n     */\n    fixIOSViewportHeight: function () {\n      const setVh = () => {\n        const vh = window.innerHeight * 0.01;\n        // CSS custom property - this is acceptable as it's dynamic viewport calculation\n        document.documentElement.style.setProperty('--vh', `${vh}px`);\n      };\n\n      // Set initially and on viewport changes\n      setVh();\n      window.addEventListener('resize', setVh);\n      window.addEventListener('orientationchange', () => {\n        // Wait for orientation change to complete before setting new height\n        setTimeout(setVh, 100);\n      });\n\n      // Special handling for iOS keyboard\n      if (this.device.isIOS) {\n        const inputs = document.querySelectorAll('input, textarea, select');\n        inputs.forEach(input => {\n          // Skip checkboxes and radio buttons - they don't need keyboard\n          if (input.type === 'checkbox' || input.type === 'radio') {\n            return;\n          }\n\n          // Add class when keyboard is visible\n          input.addEventListener('focus', () => {\n            document.documentElement.classList.add('keyboard-visible');\n          });\n\n          // Remove class when keyboard is hidden\n          input.addEventListener('blur', () => {\n            document.documentElement.classList.remove('keyboard-visible');\n          });\n        });\n      }\n    },\n\n    /**\n     * Set up touch feedback for interactive elements\n     */\n    setupTouchFeedback: function () {\n      if (this.device.hasTouch) {\n        const touchElements = document.querySelectorAll('button, .btn, a.nav-link, .card-header');\n\n        touchElements.forEach(el => {\n          // Use opacity change instead of transform for feedback\n          el.addEventListener('touchstart', function () {\n            this.classList.add('touch-active');\n\n            // Add haptic feedback for buttons (handled by mobile-haptics.js auto-init)\n            // Individual haptic calls are in mobile-haptics.js, so no need to duplicate here\n          }, { passive: true });\n\n          el.addEventListener('touchend', function () {\n            this.classList.remove('touch-active');\n          }, { passive: true });\n        });\n      }\n    },\n\n    /**\n     * Enhance modal behavior on mobile devices\n     * REFACTORED: Replaced inline styles with CSS classes\n     */\n    enhanceModals: function () {\n      const modals = document.querySelectorAll('[data-modal]');\n\n      modals.forEach(modal => {\n        const modalDialog = modal.querySelector('[data-modal-dialog]');\n\n        // Auto-convert modals to bottom sheets on mobile (unless explicitly disabled)\n        if (this.device.isMobile && !modal.hasAttribute('data-no-bottom-sheet') && modalDialog) {\n          // Don't convert if modal-keep-centered class is present\n          if (!modalDialog.classList.contains('modal-keep-centered')) {\n            // Remove any size classes that would interfere\n            modalDialog.classList.remove('modal-lg', 'modal-xl', 'modal-sm');\n          }\n        }\n\n        // Setup swipe-to-dismiss on mobile bottom sheets\n        if (this.device.isMobile && modal.getAttribute('data-dismiss-on-swipe') === 'true') {\n          this.setupModalSwipeDismiss(modal);\n        }\n\n        // Focus management and scrolling improvements\n        modal.addEventListener('shown.bs.modal', () => {\n          // Haptic feedback when modal opens\n          if (window.Haptics) {\n            window.Haptics.modalOpen();\n          }\n\n          // Prevent body scroll on iOS\n          // REFACTORED: Using CSS class instead of inline styles\n          if (this.device.isIOS) {\n            document.body.classList.add('scroll-locked');\n          }\n\n          // Focus first interactive element\n          const focusable = modal.querySelector('input:not([type=\"hidden\"]), button.btn-close, button:not(.close), [tabindex]:not([tabindex=\"-1\"])');\n          if (focusable) {\n            setTimeout(() => focusable.focus(), 100);\n          }\n\n          // iOS-specific modal fixes\n          // REFACTORED: Using CSS class instead of inline styles\n          if (this.device.isIOS) {\n            const modalBody = modal.querySelector('[data-modal-body]');\n            if (modalBody) {\n              modalBody.classList.add('modal-body-scrollable');\n            }\n          }\n\n          // Mobile optimization for bottom sheets\n          // REFACTORED: Using CSS class instead of inline styles\n          if (this.device.isMobile) {\n            const modalContent = modal.querySelector('[data-modal-content]');\n            if (modalContent && !modalDialog.classList.contains('modal-keep-centered')) {\n              modalContent.classList.add('modal-content-mobile');\n            }\n          }\n\n          // Handle keyboard open state\n          this.handleModalKeyboard(modal);\n        });\n\n        // Cleanup when modal is closed\n        modal.addEventListener('hidden.bs.modal', () => {\n          // Haptic feedback when modal closes\n          if (window.Haptics) {\n            window.Haptics.modalClose();\n          }\n\n          // Restore body scroll on iOS\n          // REFACTORED: Using CSS class removal instead of inline style removal\n          if (this.device.isIOS) {\n            document.body.classList.remove('scroll-locked');\n          }\n\n          // Remove keyboard open class\n          document.body.classList.remove('keyboard-open');\n\n          // Cleanup modal body scrollable class\n          const modalBody = modal.querySelector('[data-modal-body]');\n          if (modalBody) {\n            modalBody.classList.remove('modal-body-scrollable');\n          }\n\n          // Cleanup modal content mobile class\n          const modalContent = modal.querySelector('[data-modal-content]');\n          if (modalContent) {\n            modalContent.classList.remove('modal-content-mobile');\n          }\n\n          this.cleanupModalBackdrops();\n        });\n\n        // Add haptic feedback to close buttons\n        const closeButtons = modal.querySelectorAll('.btn-close, [data-bs-dismiss=\"modal\"]');\n        closeButtons.forEach(btn => {\n          btn.addEventListener('click', () => {\n            if (window.Haptics) {\n              window.Haptics.light();\n            }\n          }, { passive: true });\n        });\n      });\n    },\n\n    /**\n     * Setup swipe-to-dismiss functionality for mobile modals\n     * REFACTORED: Replaced inline styles with CSS classes\n     */\n    setupModalSwipeDismiss: function (modal) {\n      if (!this.device.isMobile) return;\n\n      const modalDialog = modal.querySelector('[data-modal-dialog]');\n      const modalHeader = modal.querySelector('[data-modal-header]');\n\n      if (!modalDialog || !modalHeader) return;\n\n      let startY = 0;\n      let currentY = 0;\n      let isDragging = false;\n\n      // Touch start\n      modalHeader.addEventListener('touchstart', (e) => {\n        startY = e.touches[0].clientY;\n        isDragging = true;\n        modalDialog.classList.add('swiping');\n      }, { passive: true });\n\n      // Touch move\n      modalHeader.addEventListener('touchmove', (e) => {\n        if (!isDragging) return;\n\n        currentY = e.touches[0].clientY;\n        const deltaY = currentY - startY;\n\n        // Only allow downward swipe\n        // REFACTORED: Using CSS custom property for dynamic transform\n        if (deltaY > 0) {\n          e.preventDefault();\n          // Use CSS custom property for dynamic transform value\n          modalDialog.style.setProperty('--swipe-offset', `${deltaY}px`);\n          modalDialog.style.transform = `translateY(var(--swipe-offset))`;\n          modalDialog.classList.add('transition-none');\n        }\n      });\n\n      // Touch end\n      modalHeader.addEventListener('touchend', (e) => {\n        if (!isDragging) return;\n\n        isDragging = false;\n        modalDialog.classList.remove('swiping');\n\n        const deltaY = currentY - startY;\n        const threshold = 100; // Pixels to swipe before dismissing\n\n        if (deltaY > threshold) {\n          // Dismiss modal\n          if (window.Haptics) {\n            window.Haptics.light();\n          }\n\n          // Animate out\n          // REFACTORED: Using CSS classes for animation\n          modalDialog.classList.remove('transition-none');\n          modalDialog.classList.add('swipe-animating', 'swipe-dismiss');\n\n          setTimeout(() => {\n            const bsModal = bootstrap.Modal.getInstance(modal);\n            if (bsModal) {\n              bsModal.hide();\n            }\n            // Reset transform\n            // REFACTORED: Using CSS classes instead of inline styles\n            modalDialog.classList.remove('swipe-animating', 'swipe-dismiss');\n            modalDialog.style.removeProperty('--swipe-offset');\n            modalDialog.style.removeProperty('transform');\n          }, 300);\n        } else {\n          // Snap back\n          // REFACTORED: Using CSS classes for animation\n          modalDialog.classList.remove('transition-none');\n          modalDialog.classList.add('swipe-animating', 'swipe-reset');\n\n          setTimeout(() => {\n            modalDialog.classList.remove('swipe-animating', 'swipe-reset');\n            modalDialog.style.removeProperty('--swipe-offset');\n            modalDialog.style.removeProperty('transform');\n          }, 300);\n        }\n\n        currentY = 0;\n      }, { passive: true });\n    },\n\n    /**\n     * Handle keyboard open/close for modals\n     */\n    handleModalKeyboard: function (modal) {\n      if (!this.device.isMobile) return;\n\n      const inputs = modal.querySelectorAll('input, textarea, select');\n\n      inputs.forEach(input => {\n        input.addEventListener('focus', () => {\n          document.body.classList.add('keyboard-open');\n\n          // Scroll input into view\n          setTimeout(() => {\n            input.scrollIntoView({ behavior: 'smooth', block: 'center' });\n          }, 300);\n        });\n\n        input.addEventListener('blur', () => {\n          // Check if another input in the same modal has focus\n          setTimeout(() => {\n            const activeElement = document.activeElement;\n            const isInputFocused = modal.contains(activeElement) &&\n                                   (activeElement.tagName === 'INPUT' ||\n                                    activeElement.tagName === 'TEXTAREA' ||\n                                    activeElement.tagName === 'SELECT');\n\n            if (!isInputFocused) {\n              document.body.classList.remove('keyboard-open');\n            }\n          }, 100);\n        });\n      });\n    },\n\n    /**\n     * Enhance form controls for better mobile experience\n     * REFACTORED: Replaced inline styles with CSS classes\n     */\n    enhanceFormControls: function () {\n      // Enhance standard form controls\n      if (this.device.isMobile || this.device.isTablet) {\n        const formControls = document.querySelectorAll('[data-form-control], [data-form-select]');\n        formControls.forEach(control => {\n          // Ensure minimum touch target size\n          // REFACTORED: Using CSS class instead of inline style\n          if (control.offsetHeight < 44) {\n            control.classList.add('form-control-touch-target');\n          }\n\n          // iOS date input fixes\n          // REFACTORED: Using CSS class instead of inline styles\n          if (this.device.isIOS && (control.type === 'date' || control.type === 'time' || control.type === 'datetime-local')) {\n            control.classList.add('form-control-ios-date');\n          }\n        });\n      }\n\n      // Enhance Select2 if available\n      if (typeof $.fn !== 'undefined' && typeof $.fn.select2 !== 'undefined') {\n        try {\n          setTimeout(() => {\n            $('.select2-container').each(function () {\n              const selectElement = $(this).siblings('select');\n              if (selectElement.length) {\n                // Configure Select2 with mobile-friendly options\n                const config = {\n                  theme: 'bootstrap-5',\n                  width: '100%',\n                  // Set dropdown to modal if in modal context\n                  dropdownParent: $(selectElement).closest('.modal').length ?\n                    $(selectElement).closest('.modal') : $('body')\n                };\n\n                // Set appropriate placeholder\n                config.placeholder = selectElement.data('placeholder') ||\n                  (selectElement.is('[multiple]') ? 'Select multiple options' : 'Select an option');\n\n                // Initialize Select2\n                selectElement.select2(config);\n              }\n            });\n          }, 300);\n        } catch (e) {\n          // console.warn('Error enhancing Select2:', e);\n        }\n      }\n    },\n\n    /**\n     * Enhance tables for better mobile experience\n     * REFACTORED: Replaced inline styles with CSS classes\n     */\n    enhanceTables: function () {\n      const tables = document.querySelectorAll('[data-table-responsive]');\n\n      tables.forEach(table => {\n        // Ensure touch scrolling works well\n        // REFACTORED: Using CSS class instead of inline style\n        table.classList.add('table-responsive-touch');\n\n        // Add faded edge indicators for scrollable tables on mobile\n        if (this.device.isMobile && !table.querySelector('.table-scroll-hint')) {\n          const tableWidth = table.scrollWidth;\n          const containerWidth = table.clientWidth;\n\n          if (tableWidth > containerWidth) {\n            // Add scroll hint indicator\n            const scrollHint = document.createElement('div');\n            scrollHint.className = 'table-scroll-hint';\n            scrollHint.innerHTML = '<small class=\"text-muted\"><i class=\"ti ti-arrows-horizontal me-1\"></i>swipe to see more</small>';\n\n            table.parentNode.insertBefore(scrollHint, table.nextSibling);\n\n            // Hide hint when user has scrolled\n            // REFACTORED: Using CSS classes instead of inline styles\n            table.addEventListener('scroll', function() {\n              if (this.scrollLeft > 20) {\n                scrollHint.classList.add('hidden');\n              }\n            });\n          }\n        }\n      });\n    },\n\n    /**\n     * Enhance navigation elements for touch devices\n     * REFACTORED: Replaced inline styles with CSS classes\n     */\n    enhanceNavigation: function () {\n      // Make tabs scrollable on mobile\n      const tabContainers = document.querySelectorAll('[data-tabs], .js-tabs');\n\n      tabContainers.forEach(container => {\n        // Check prerequisites first\n        const tabs = container.querySelectorAll('.nav-link');\n        const isOnMobile = window.innerWidth < 768;\n        const hasMultipleTabs = tabs.length > 1;\n        const hasOverflow = container.scrollWidth > container.clientWidth;\n\n        // Only show on mobile with multiple tabs that actually overflow\n        if (isOnMobile && hasMultipleTabs && hasOverflow) {\n          // Apply scrolling styles\n          // REFACTORED: Using CSS class instead of inline styles\n          container.classList.add('scrollable-tabs');\n\n          // Add scroll indicator if not present\n          if (!container.nextElementSibling || !container.nextElementSibling.classList.contains('tabs-scroll-hint')) {\n            const scrollHint = document.createElement('div');\n            scrollHint.className = 'tabs-scroll-hint';\n            scrollHint.innerHTML = '<small class=\"text-muted\"><i class=\"ti ti-arrows-horizontal me-1\"></i>swipe</small>';\n\n            container.parentNode.insertBefore(scrollHint, container.nextSibling);\n          }\n        } else {\n          // Remove any existing swipe hints on desktop or single tabs\n          const existingHint = container.nextElementSibling;\n          if (existingHint && existingHint.classList.contains('tabs-scroll-hint')) {\n            existingHint.remove();\n          }\n        }\n      });\n\n      // Enhance sidebar menu on mobile\n      const sidebarMenu = document.querySelector('.layout-menu');\n      if (sidebarMenu && (this.device.isMobile || this.device.isTablet)) {\n        const menuItems = sidebarMenu.querySelectorAll('.menu-item');\n\n        menuItems.forEach(item => {\n          // Make dropdown toggles more touch-friendly\n          // REFACTORED: Using CSS class instead of inline style\n          if (item.classList.contains('menu-item-has-children')) {\n            const toggle = item.querySelector('.menu-toggle');\n            if (toggle) {\n              toggle.classList.add('menu-toggle-touch');\n            }\n          }\n\n          // Make all menu links more touch-friendly\n          // REFACTORED: Using CSS class instead of inline style\n          const link = item.querySelector('.menu-link');\n          if (link) {\n            link.classList.add('menu-link-touch');\n          }\n        });\n      }\n    },\n\n    /**\n     * Improve scrolling behavior site-wide\n     */\n    improveScrolling: function () {\n      // Enable smooth scrolling for anchor links\n      document.querySelectorAll('a[href^=\"#\"]').forEach(anchor => {\n        if (anchor.getAttribute('href').length > 1) {\n          anchor.addEventListener('click', function(e) {\n            const targetId = this.getAttribute('href');\n            if (targetId === '#' || !targetId) return;\n\n            const targetElement = document.querySelector(targetId);\n            if (targetElement) {\n              e.preventDefault();\n\n              // Scroll smoothly to target\n              targetElement.scrollIntoView({\n                behavior: 'smooth',\n                block: 'start'\n              });\n            }\n          });\n        }\n      });\n    },\n\n    /**\n     * Monitor network status and display notifications\n     */\n    monitorNetworkStatus: function () {\n      window.addEventListener('online', () => {\n        this.showNetworkStatus(true);\n      });\n\n      window.addEventListener('offline', () => {\n        this.showNetworkStatus(false);\n      });\n    },\n\n    /**\n     * Show network status toast notification\n     * REFACTORED: Replaced inline styles with CSS classes\n     */\n    showNetworkStatus: function (isOnline) {\n      const statusDiv = document.createElement('div');\n      statusDiv.className = 'network-status-indicator';\n\n      if (isOnline) {\n        statusDiv.classList.add('online');\n        statusDiv.innerHTML = '<i class=\"ti ti-wifi me-2\"></i> Connected';\n      } else {\n        statusDiv.classList.add('offline');\n        statusDiv.innerHTML = '<i class=\"ti ti-wifi-off me-2\"></i> Disconnected';\n      }\n\n      document.body.appendChild(statusDiv);\n\n      // Animate in\n      // REFACTORED: Using CSS class instead of inline style\n      setTimeout(() => {\n        statusDiv.classList.add('visible');\n      }, 10);\n\n      // Hide after delay\n      setTimeout(() => {\n        statusDiv.classList.remove('visible');\n\n        setTimeout(() => {\n          if (statusDiv.parentNode) {\n            document.body.removeChild(statusDiv);\n          }\n        }, 300);\n      }, 3000);\n    },\n\n    /**\n     * Attach global event listeners\n     */\n    attachEventListeners: function () {\n      // Handle orientation changes\n      window.addEventListener('orientationchange', () => {\n        // Run after orientation change completes\n        setTimeout(() => {\n          this.fixIOSViewportHeight();\n          this.enhanceNavigation();\n\n          // Dispatch custom event for other components\n          document.dispatchEvent(new CustomEvent('app:orientationchange'));\n        }, 200);\n      });\n\n      // Handle resize (debounced)\n      let resizeTimer;\n      window.addEventListener('resize', () => {\n        clearTimeout(resizeTimer);\n        resizeTimer = setTimeout(() => {\n          // Update device detection and classes\n          this.detectDevice();\n          this.applyDeviceClasses();\n          this.fixIOSViewportHeight();\n\n          // Re-enhance components after resize\n          this.enhanceNavigation();\n          this.enhanceTables();\n\n          // Notify other components\n          document.dispatchEvent(new CustomEvent('app:resize'));\n        }, 250);\n      });\n\n      // Fix modal backdrop issues (keep this - non-action click listener)\n      document.addEventListener('click', () => {\n        setTimeout(this.cleanupModalBackdrops.bind(this), 300);\n      });\n\n      // Fix iOS tab bar hiding issue\n      if (this.device.isIOS) {\n        window.addEventListener('scroll', () => {\n          // Force address bar to show/hide properly\n          document.body.scrollTop = document.body.scrollTop + 1;\n          document.body.scrollTop = document.body.scrollTop - 1;\n        }, { passive: true });\n      }\n    },\n\n    /**\n     * Clean up any stray modal backdrops\n     * REFACTORED: Using removeProperty instead of direct style manipulation\n     */\n    cleanupModalBackdrops: function () {\n      const openModals = document.querySelectorAll('.modal.show');\n      const modalBackdrops = document.querySelectorAll('.modal-backdrop');\n\n      // If there are no open modals but we have backdrops, clean them up\n      if (openModals.length === 0 && modalBackdrops.length > 0) {\n        modalBackdrops.forEach(backdrop => {\n          if (backdrop.parentNode) {\n            backdrop.parentNode.removeChild(backdrop);\n          }\n        });\n\n        // Fix body classes and styles\n        // REFACTORED: Using removeProperty instead of setting empty string\n        document.body.classList.remove('modal-open');\n        document.body.style.removeProperty('overflow');\n        document.body.style.removeProperty('padding-right');\n      }\n    },\n\n    /**\n     * Set up observer to watch for dynamically added elements\n     */\n    setupMutationObserver: function () {\n      // Create MutationObserver instance\n      const observer = new MutationObserver((mutations) => {\n        let shouldEnhance = false;\n\n        // Check if we need to enhance elements\n        mutations.forEach(mutation => {\n          if (mutation.addedNodes.length) {\n            // Look for meaningful DOM changes that would require enhancement\n            for (let i = 0; i < mutation.addedNodes.length; i++) {\n              const node = mutation.addedNodes[i];\n              if (node.nodeType === 1) { // Only element nodes\n                if (\n                  node.hasAttribute && (\n                    node.hasAttribute('data-modal') ||\n                    node.hasAttribute('data-form-control') ||\n                    node.hasAttribute('data-form-select') ||\n                    node.hasAttribute('data-tabs') ||\n                    node.hasAttribute('data-table-responsive')\n                  )\n                ) {\n                  shouldEnhance = true;\n                  break;\n                }\n\n                // Check if added node contains elements we care about\n                if (\n                  node.querySelector && (\n                    node.querySelector('[data-modal]') ||\n                    node.querySelector('[data-form-control]') ||\n                    node.querySelector('[data-form-select]') ||\n                    node.querySelector('[data-tabs], .js-tabs') ||\n                    node.querySelector('[data-table-responsive]')\n                  )\n                ) {\n                  shouldEnhance = true;\n                  break;\n                }\n              }\n            }\n          }\n        });\n\n        // Enhance new elements if needed\n        if (shouldEnhance) {\n          setTimeout(() => {\n            this.enhanceNewElements();\n          }, 100);\n        }\n      });\n\n      // Start observing the document\n      observer.observe(document.body, {\n        childList: true,\n        subtree: true\n      });\n    },\n\n    /**\n     * Enhance dynamically added elements\n     */\n    enhanceNewElements: function () {\n      this.setupTouchFeedback();\n      this.enhanceFormControls();\n      this.enhanceTables();\n      this.enhanceNavigation();\n      this.enhanceModals();\n    }\n  };\n\n  // Make available globally\n  window.ResponsiveSystem = ResponsiveSystem;\n\n  // Register with InitSystem if available\n  if (typeof window.InitSystem !== 'undefined' && window.InitSystem.register) {\n    window.InitSystem.register('responsive-system', function() {\n      ResponsiveSystem.init();\n    }, {\n      priority: 85,\n      description: 'Responsive system (mobile detection, touch feedback, form/table/modal enhancements)',\n      reinitializable: true\n    });\n  } else {\n    // Fallback: Initialize when DOM is ready\n    document.addEventListener('DOMContentLoaded', function () {\n      ResponsiveSystem.init();\n    });\n  }\n})();\n","/**\n * UI Enhancements - Additional JavaScript for UI fixes\n */\n\n(function() {\n    'use strict';\n\n    /**\n     * Initialize all UI enhancements when DOM is ready\n     */\n    function init() {\n        initFeatherIcons();\n        initMatchHistoryCollapse();\n        registerDropdownActions();\n    }\n\n    /**\n     * Initialize Feather Icons\n     * Re-runs feather.replace() to ensure all icons are rendered\n     */\n    function initFeatherIcons() {\n        if (typeof feather !== 'undefined') {\n            // Initial replace\n            feather.replace();\n\n            // Also watch for dynamic content\n            const observer = new MutationObserver(function(mutations) {\n                let hasNewFeatherIcons = false;\n                mutations.forEach(function(mutation) {\n                    mutation.addedNodes.forEach(function(node) {\n                        if (node.nodeType === Node.ELEMENT_NODE) {\n                            if (node.hasAttribute && node.hasAttribute('data-feather')) {\n                                hasNewFeatherIcons = true;\n                            }\n                            if (node.querySelector && node.querySelector('[data-feather]')) {\n                                hasNewFeatherIcons = true;\n                            }\n                        }\n                    });\n                });\n                if (hasNewFeatherIcons) {\n                    feather.replace();\n                }\n            });\n\n            observer.observe(document.body, {\n                childList: true,\n                subtree: true\n            });\n        }\n    }\n\n    /**\n     * Initialize Match History Collapsible Weeks\n     */\n    function initMatchHistoryCollapse() {\n        const dateGroups = document.querySelectorAll('.c-match-history__date-group');\n\n        dateGroups.forEach(function(group, index) {\n            const header = group.querySelector('.c-match-history__date-header');\n\n            if (header) {\n                // Collapse all groups except the first one by default\n                if (index > 0) {\n                    group.classList.add('is-collapsed');\n                }\n\n                header.addEventListener('click', function() {\n                    group.classList.toggle('is-collapsed');\n                });\n\n                // Make header keyboard accessible\n                header.setAttribute('role', 'button');\n                header.setAttribute('tabindex', '0');\n                header.addEventListener('keydown', function(e) {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                        e.preventDefault();\n                        group.classList.toggle('is-collapsed');\n                    }\n                });\n            }\n        });\n    }\n\n    /**\n     * Register dropdown actions with EventDelegation\n     */\n    function registerDropdownActions() {\n        if (typeof EventDelegation !== 'undefined') {\n            EventDelegation.register('toggle-dropdown', handleToggleDropdown, { preventDefault: true });\n        } else {\n            // Fallback: direct event listeners if EventDelegation not available\n            initDropdownFallback();\n        }\n\n        // Close dropdowns when clicking outside\n        document.addEventListener('click', handleOutsideClick);\n    }\n\n    /**\n     * Handle dropdown toggle action\n     * @param {Element} element - The element that was clicked (from EventDelegation)\n     * @param {Event} e - The click event\n     */\n    function handleToggleDropdown(element, e) {\n        e.stopPropagation();\n\n        const dropdownId = element.getAttribute('data-dropdown');\n        const dropdown = document.querySelector(`[data-dropdown-id=\"${dropdownId}\"]`);\n\n        if (dropdown) {\n            // Close all other dropdowns\n            document.querySelectorAll('.c-navbar-modern__dropdown.is-open').forEach(function(d) {\n                if (d !== dropdown) {\n                    d.classList.remove('is-open');\n                    d.setAttribute('aria-hidden', 'true');\n                }\n            });\n\n            // Toggle this dropdown\n            const isOpen = dropdown.classList.toggle('is-open');\n            dropdown.setAttribute('aria-hidden', !isOpen);\n            element.setAttribute('aria-expanded', isOpen);\n        }\n    }\n\n    /**\n     * Fallback dropdown initialization (if EventDelegation not available)\n     */\n    function initDropdownFallback() {\n        document.querySelectorAll('[data-action=\"toggle-dropdown\"]').forEach(function(btn) {\n            btn.addEventListener('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                const dropdownId = this.getAttribute('data-dropdown');\n                const dropdown = document.querySelector(`[data-dropdown-id=\"${dropdownId}\"]`);\n\n                if (dropdown) {\n                    // Close all other dropdowns\n                    document.querySelectorAll('.c-navbar-modern__dropdown.is-open').forEach(function(d) {\n                        if (d !== dropdown) {\n                            d.classList.remove('is-open');\n                            d.setAttribute('aria-hidden', 'true');\n                        }\n                    });\n\n                    // Toggle this dropdown\n                    const isOpen = dropdown.classList.toggle('is-open');\n                    dropdown.setAttribute('aria-hidden', !isOpen);\n                    this.setAttribute('aria-expanded', isOpen);\n                }\n            });\n        });\n    }\n\n    /**\n     * Handle clicks outside dropdowns\n     */\n    function handleOutsideClick(e) {\n        if (!e.target.closest('.c-navbar-modern__dropdown') &&\n            !e.target.closest('[data-action=\"toggle-dropdown\"]')) {\n            document.querySelectorAll('.c-navbar-modern__dropdown.is-open').forEach(function(d) {\n                d.classList.remove('is-open');\n                d.setAttribute('aria-hidden', 'true');\n            });\n            document.querySelectorAll('[data-action=\"toggle-dropdown\"]').forEach(function(btn) {\n                btn.setAttribute('aria-expanded', 'false');\n            });\n        }\n    }\n\n    // Initialize on DOM ready\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        init();\n    }\n\n    // Re-initialize after turbo/ajax page loads\n    document.addEventListener('turbo:load', init);\n    document.addEventListener('turbolinks:load', init);\n\n})();\n","/**\n * Mobile Gestures - Touch Interaction Handler\n *\n * Provides comprehensive gesture support using Hammer.js for mobile interactions.\n * Handles swipe, long-press, double-tap, pinch-to-zoom, and pull-to-refresh.\n *\n * Dependencies: Hammer.js (already loaded in helpers.js)\n * Usage: Automatically initializes on DOMContentLoaded\n *\n * @version 1.0.1\n * @updated 2025-12-26 - Code review for EventDelegation (no changes needed - uses Hammer.js)\n */\n\n(function (window) {\n  'use strict';\n\n  /**\n   * Mobile Gestures Controller\n   */\n  const MobileGestures = {\n    /**\n     * Check if device supports touch\n     * @returns {boolean}\n     */\n    isTouchDevice: function () {\n      return ('ontouchstart' in window) ||\n        (navigator.maxTouchPoints > 0) ||\n        (navigator.msMaxTouchPoints > 0);\n    },\n\n    /**\n     * Check if Hammer.js is loaded\n     * @returns {boolean}\n     */\n    isHammerLoaded: function () {\n      return typeof Hammer !== 'undefined';\n    },\n\n    /**\n     * Swipe to dismiss modal (swipe down on bottom sheets)\n     */\n    setupModalSwipeDismiss: function () {\n      if (!this.isHammerLoaded()) return;\n\n      document.querySelectorAll('.modal.modal-bottom-sheet').forEach(modal => {\n        const modalDialog = modal.querySelector('.modal-dialog');\n        if (!modalDialog) return;\n\n        const hammer = new Hammer(modalDialog);\n        hammer.get('swipe').set({ direction: Hammer.DIRECTION_DOWN, threshold: 50 });\n\n        hammer.on('swipedown', (ev) => {\n          // Only dismiss if swiping from near the top (drag handle area)\n          if (ev.center.y < 100) {\n            const bootstrapModal = bootstrap.Modal.getInstance(modal);\n            if (bootstrapModal) {\n              if (window.Haptics) window.Haptics.modalClose();\n              bootstrapModal.hide();\n            }\n          }\n        });\n\n        // Visual feedback during pan (drag)\n        hammer.get('pan').set({ direction: Hammer.DIRECTION_DOWN, threshold: 0 });\n        let startY = 0;\n\n        hammer.on('panstart', (ev) => {\n          startY = ev.center.y;\n          // REFACTORED: Using utility classes for transitions\n          modalDialog.classList.add('transition-none');\n        });\n\n        hammer.on('panmove', (ev) => {\n          if (ev.center.y > startY && ev.center.y < 100) {\n            const deltaY = ev.center.y - startY;\n            if (deltaY > 0 && deltaY < 200) {\n              // Note: Dynamic transform value, kept as inline style\n              modalDialog.style.transform = `translateY(${deltaY}px)`;\n            }\n          }\n        });\n\n        hammer.on('panend', (ev) => {\n          // REFACTORED: Using utility classes for transitions\n          modalDialog.classList.remove('transition-none');\n          modalDialog.classList.add('transition-transform');\n          const deltaY = ev.center.y - startY;\n\n          if (deltaY > 100) {\n            // Threshold reached, dismiss modal\n            const bootstrapModal = bootstrap.Modal.getInstance(modal);\n            if (bootstrapModal) {\n              if (window.Haptics) window.Haptics.modalClose();\n              bootstrapModal.hide();\n            }\n          } else {\n            // Snap back - REFACTORED: Using utility classes\n            modalDialog.classList.add('translate-y-0');\n            modalDialog.style.transform = '';\n          }\n        });\n      });\n    },\n\n    /**\n     * Swipe to open/close sidebar\n     */\n    setupSidebarSwipe: function () {\n      if (!this.isHammerLoaded()) return;\n\n      const sidebar = document.getElementById('layout-menu');\n      if (!sidebar) return;\n\n      const body = document.body;\n      const hammer = new Hammer(body);\n\n      // Swipe right from left edge to open\n      hammer.on('swiperight', (ev) => {\n        if (ev.center.x < 50 && window.innerWidth < 992) {\n          // Near left edge\n          if (!sidebar.classList.contains('layout-menu-expanded')) {\n            sidebar.classList.add('layout-menu-expanded');\n            body.classList.add('layout-menu-expanded');\n            if (window.Haptics) window.Haptics.menuOpen();\n          }\n        }\n      });\n\n      // Swipe left to close sidebar\n      hammer.on('swipeleft', (ev) => {\n        if (sidebar.classList.contains('layout-menu-expanded')) {\n          sidebar.classList.remove('layout-menu-expanded');\n          body.classList.remove('layout-menu-expanded');\n          if (window.Haptics) window.Haptics.menuClose();\n        }\n      });\n    },\n\n    /**\n     * Pull-to-refresh on tables and lists\n     */\n    setupPullToRefresh: function () {\n      if (!this.isHammerLoaded()) return;\n\n      document.querySelectorAll('[data-pull-refresh=\"true\"], .table-responsive').forEach(container => {\n        const hammer = new Hammer(container);\n        hammer.get('pan').set({ direction: Hammer.DIRECTION_DOWN, threshold: 10 });\n\n        let startY = 0;\n        let isPulling = false;\n        let refreshThreshold = 80;\n\n        // Create refresh indicator - REFACTORED: Using utility classes\n        let refreshIndicator = container.querySelector('.pull-refresh-indicator');\n        if (!refreshIndicator) {\n          refreshIndicator = document.createElement('div');\n          refreshIndicator.className = 'pull-refresh-indicator position-absolute left-50 translate-middle-x d-flex align-items-center justify-content-center text-white opacity-0 z-index-1000';\n          refreshIndicator.innerHTML = '<i class=\"ti ti-refresh\"></i>';\n          // Note: top, width, height, background, borderRadius, transition use specific values, kept as inline styles\n          refreshIndicator.style.top = '-50px';\n          refreshIndicator.style.width = '40px';\n          refreshIndicator.style.height = '40px';\n          refreshIndicator.style.background = 'var(--bs-primary)';\n          refreshIndicator.style.borderRadius = '50%';\n          refreshIndicator.style.transition = 'opacity 0.3s, top 0.3s';\n          container.classList.add('position-relative');\n          container.insertBefore(refreshIndicator, container.firstChild);\n        }\n\n        hammer.on('panstart', (ev) => {\n          // Only allow pull-to-refresh at scroll position 0\n          if (container.scrollTop === 0 || container === window) {\n            startY = ev.center.y;\n            isPulling = true;\n          }\n        });\n\n        hammer.on('panmove', (ev) => {\n          if (!isPulling) return;\n\n          const deltaY = ev.center.y - startY;\n          if (deltaY > 0 && deltaY < refreshThreshold * 1.5) {\n            // Show indicator - Note: Dynamic opacity and top values, kept as inline styles\n            refreshIndicator.style.opacity = Math.min(deltaY / refreshThreshold, 1);\n            refreshIndicator.style.top = `${-50 + deltaY}px`;\n\n            // Rotate icon - Note: Dynamic rotation value, kept as inline style\n            const icon = refreshIndicator.querySelector('i');\n            if (icon) {\n              icon.style.transform = `rotate(${deltaY * 3}deg)`;\n            }\n          }\n        });\n\n        hammer.on('panend', (ev) => {\n          if (!isPulling) return;\n\n          const deltaY = ev.center.y - startY;\n\n          if (deltaY > refreshThreshold) {\n            // Trigger refresh\n            if (window.Haptics) window.Haptics.refresh();\n\n            refreshIndicator.style.top = '10px';\n            const icon = refreshIndicator.querySelector('i');\n            if (icon) {\n              icon.classList.add('ti-spin');\n            }\n\n            // Dispatch custom event for refresh\n            const refreshEvent = new CustomEvent('mobile:pullrefresh', {\n              detail: { container: container }\n            });\n            container.dispatchEvent(refreshEvent);\n\n            // Auto-hide after 2 seconds (or listen for custom event)\n            setTimeout(() => {\n              // REFACTORED: Using utility classes for opacity\n              refreshIndicator.classList.add('opacity-0');\n              refreshIndicator.style.top = '-50px';\n              if (icon) icon.classList.remove('ti-spin');\n            }, 2000);\n          } else {\n            // Snap back - REFACTORED: Using utility classes for opacity\n            refreshIndicator.classList.add('opacity-0');\n            refreshIndicator.style.top = '-50px';\n          }\n\n          isPulling = false;\n        });\n      });\n    },\n\n    /**\n     * Long-press for context menus\n     */\n    setupLongPress: function () {\n      if (!this.isHammerLoaded()) return;\n\n      document.querySelectorAll('[data-long-press=\"true\"], .card, .list-group-item').forEach(element => {\n        const hammer = new Hammer(element);\n        hammer.get('press').set({ time: 500 }); // 500ms for long press\n\n        hammer.on('press', (ev) => {\n          if (window.Haptics) window.Haptics.longPress();\n\n          // Dispatch custom event\n          const longPressEvent = new CustomEvent('mobile:longpress', {\n            detail: { element: element, event: ev }\n          });\n          element.dispatchEvent(longPressEvent);\n\n          // Visual feedback\n          element.classList.add('long-press-active');\n          setTimeout(() => {\n            element.classList.remove('long-press-active');\n          }, 200);\n        });\n      });\n    },\n\n    /**\n     * Double-tap to zoom (images, player cards)\n     */\n    setupDoubleTap: function () {\n      if (!this.isHammerLoaded()) return;\n\n      document.querySelectorAll('[data-double-tap=\"zoom\"], .player-card img, .avatar-lg').forEach(element => {\n        const hammer = new Hammer(element);\n        hammer.get('tap').set({ taps: 2, threshold: 10, posThreshold: 50 });\n\n        let isZoomed = false;\n\n        hammer.on('tap', (ev) => {\n          if (ev.tapCount === 2) {\n            if (window.Haptics) window.Haptics.doubleTap();\n\n            if (!isZoomed) {\n              // Zoom in - REFACTORED: Using utility classes\n              element.classList.add('transition-transform', 'z-index-1000');\n              // Note: Dynamic scale value, kept as inline style\n              element.style.transform = 'scale(2)';\n              isZoomed = true;\n            } else {\n              // Zoom out - REFACTORED: Using utility classes\n              element.classList.remove('z-index-1000');\n              element.classList.add('scale-1');\n              element.style.transform = '';\n              isZoomed = false;\n            }\n\n            // Reset after 3 seconds - REFACTORED: Using utility classes\n            setTimeout(() => {\n              if (isZoomed) {\n                element.classList.remove('z-index-1000');\n                element.classList.add('scale-1');\n                element.style.transform = '';\n                isZoomed = false;\n              }\n            }, 3000);\n          }\n        });\n      });\n    },\n\n    /**\n     * Swipe actions on table/list rows (edit, delete, archive)\n     */\n    setupSwipeActions: function () {\n      if (!this.isHammerLoaded()) return;\n\n      document.querySelectorAll('[data-swipe-actions=\"true\"]').forEach(row => {\n        if (row.closest('thead')) return; // Skip header rows\n\n        const hammer = new Hammer(row);\n        hammer.get('swipe').set({ threshold: 50, velocity: 0.3 });\n\n        let actionsRevealed = false;\n\n        // Create action buttons container if not exists - REFACTORED: Using utility classes\n        let actionsContainer = row.querySelector('.swipe-actions');\n        if (!actionsContainer) {\n          actionsContainer = document.createElement('div');\n          actionsContainer.className = 'swipe-actions position-absolute right-0 top-0 bottom-0 d-flex align-items-center gap-2 translate-x-100 transition-transform';\n          // Note: padding, background use specific values, kept as inline styles\n          actionsContainer.style.padding = '0 16px';\n          actionsContainer.style.background = 'var(--bs-danger)';\n\n          // Add default actions (can be customized with data attributes)\n          const deleteBtn = document.createElement('button');\n          deleteBtn.className = 'btn btn-sm btn-light';\n          deleteBtn.innerHTML = '<i class=\"ti ti-trash\"></i>';\n          deleteBtn.onclick = () => {\n            if (window.Haptics) window.Haptics.delete();\n            const deleteEvent = new CustomEvent('mobile:swipedelete', { detail: { row } });\n            row.dispatchEvent(deleteEvent);\n          };\n          actionsContainer.appendChild(deleteBtn);\n\n          row.classList.add('position-relative', 'overflow-hidden');\n          row.appendChild(actionsContainer);\n        }\n\n        hammer.on('swipeleft', () => {\n          if (!actionsRevealed) {\n            // REFACTORED: Using utility classes\n            actionsContainer.classList.remove('translate-x-100');\n            actionsContainer.classList.add('translate-x-0');\n            // Note: Dynamic translate value, kept as inline style\n            row.style.transform = 'translateX(-100px)';\n            actionsRevealed = true;\n            if (window.Haptics) window.Haptics.swipe();\n          }\n        });\n\n        hammer.on('swiperight', () => {\n          if (actionsRevealed) {\n            // REFACTORED: Using utility classes\n            actionsContainer.classList.remove('translate-x-0');\n            actionsContainer.classList.add('translate-x-100');\n            row.classList.add('translate-x-0');\n            row.style.transform = '';\n            actionsRevealed = false;\n            if (window.Haptics) window.Haptics.swipe();\n          }\n        });\n\n        // Close on tap outside (keep this - non-action click listener)\n        // REFACTORED: Using utility classes\n        document.addEventListener('click', (e) => {\n          if (actionsRevealed && !row.contains(e.target)) {\n            actionsContainer.classList.remove('translate-x-0');\n            actionsContainer.classList.add('translate-x-100');\n            row.classList.add('translate-x-0');\n            row.style.transform = '';\n            actionsRevealed = false;\n          }\n        });\n      });\n    },\n\n    /**\n     * Pinch to zoom (images, charts)\n     */\n    setupPinchZoom: function () {\n      if (!this.isHammerLoaded()) return;\n\n      document.querySelectorAll('[data-pinch-zoom=\"true\"], .chart-container, img.zoomable').forEach(element => {\n        const hammer = new Hammer(element);\n        hammer.get('pinch').set({ enable: true });\n\n        let lastScale = 1;\n\n        hammer.on('pinchstart', () => {\n          // REFACTORED: Using utility classes\n          element.classList.add('transition-none');\n        });\n\n        hammer.on('pinchmove', (ev) => {\n          const scale = Math.max(1, Math.min(lastScale * ev.scale, 4)); // 1x to 4x\n          // Note: Dynamic scale value, kept as inline style\n          element.style.transform = `scale(${scale})`;\n        });\n\n        hammer.on('pinchend', (ev) => {\n          // REFACTORED: Using utility classes\n          element.classList.remove('transition-none');\n          element.classList.add('transition-transform');\n          lastScale = Math.max(1, Math.min(lastScale * ev.scale, 4));\n\n          // Reset to 1x after 3 seconds if zoomed - REFACTORED: Using utility classes\n          if (lastScale > 1) {\n            setTimeout(() => {\n              element.classList.add('scale-1');\n              element.style.transform = '';\n              lastScale = 1;\n            }, 3000);\n          }\n        });\n      });\n    },\n\n    /**\n     * Swipe navigation between tabs/pages\n     */\n    setupSwipeNavigation: function () {\n      if (!this.isHammerLoaded()) return;\n\n      document.querySelectorAll('[data-swipe-nav=\"true\"], .nav-tabs').forEach(nav => {\n        const hammer = new Hammer(nav);\n        hammer.get('swipe').set({ threshold: 30 });\n\n        const tabs = Array.from(nav.querySelectorAll('.nav-link'));\n        if (tabs.length === 0) return;\n\n        hammer.on('swipeleft', () => {\n          const activeTab = tabs.find(tab => tab.classList.contains('active'));\n          const activeIndex = tabs.indexOf(activeTab);\n          if (activeIndex < tabs.length - 1) {\n            tabs[activeIndex + 1].click();\n            if (window.Haptics) window.Haptics.swipe();\n          }\n        });\n\n        hammer.on('swiperight', () => {\n          const activeTab = tabs.find(tab => tab.classList.contains('active'));\n          const activeIndex = tabs.indexOf(activeTab);\n          if (activeIndex > 0) {\n            tabs[activeIndex - 1].click();\n            if (window.Haptics) window.Haptics.swipe();\n          }\n        });\n      });\n    },\n\n    /**\n     * Initialize all gesture handlers\n     */\n    init: function () {\n      if (!this.isTouchDevice()) {\n        console.log('MobileGestures: Not a touch device, skipping initialization');\n        return;\n      }\n\n      if (!this.isHammerLoaded()) {\n        console.warn('MobileGestures: Hammer.js not loaded, gesture support disabled');\n        return;\n      }\n\n      // Setup all gesture handlers\n      this.setupModalSwipeDismiss();\n      this.setupSidebarSwipe();\n      this.setupPullToRefresh();\n      this.setupLongPress();\n      this.setupDoubleTap();\n      this.setupSwipeActions();\n      this.setupPinchZoom();\n      this.setupSwipeNavigation();\n\n      // Add CSS for visual feedback\n      this.addGestureStyles();\n\n      console.log('MobileGestures: Initialized successfully');\n    },\n\n    /**\n     * Add CSS for gesture visual feedback\n     */\n    addGestureStyles: function () {\n      if (document.getElementById('mobile-gesture-styles')) return;\n\n      const style = document.createElement('style');\n      style.id = 'mobile-gesture-styles';\n      style.textContent = `\n        .long-press-active {\n          animation: long-press-pulse 0.2s ease;\n        }\n\n        @keyframes long-press-pulse {\n          0%, 100% { transform: scale(1); }\n          50% { transform: scale(0.95); }\n        }\n\n        .swipe-actions button {\n          touch-action: manipulation;\n        }\n\n        .pull-refresh-indicator .ti-spin {\n          animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n\n        /* Smooth transitions for swipe actions */\n        [data-swipe-actions=\"true\"],\n        .table-responsive tr {\n          transition: transform 0.3s ease;\n        }\n      `;\n      document.head.appendChild(style);\n    }\n  };\n\n  // Auto-initialize\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => MobileGestures.init());\n  } else {\n    MobileGestures.init();\n  }\n\n  // Expose globally\n  window.MobileGestures = MobileGestures;\n\n})(window);\n","/**\n * Mobile Keyboard - Soft Keyboard Handler\n *\n * Handles mobile keyboard interactions, viewport adjustments, and input optimization.\n * Addresses common issues: iOS keyboard overlap, Android soft keyboard, scroll-into-view.\n *\n * Features:\n * - Keyboard show/hide detection\n * - Automatic scroll input into view\n * - Dropdown positioning aware of keyboard\n * - Input type optimization\n * - iOS-specific fixes\n *\n * REFACTORED: All inline style manipulations replaced with CSS classes\n */\n\n(function (window) {\n  'use strict';\n\n  /**\n   * Mobile Keyboard Controller\n   */\n  const MobileKeyboard = {\n    /**\n     * Current keyboard state\n     */\n    state: {\n      isVisible: false,\n      keyboardHeight: 0,\n      activeInput: null,\n      originalViewportHeight: window.innerHeight\n    },\n\n    /**\n     * Check if device is mobile\n     * @returns {boolean}\n     */\n    isMobile: function () {\n      return window.innerWidth < 768;\n    },\n\n    /**\n     * Check if device is iOS\n     * @returns {boolean}\n     */\n    isIOS: function () {\n      return /iPhone|iPad|iPod/.test(navigator.userAgent);\n    },\n\n    /**\n     * Check if device is Android\n     * @returns {boolean}\n     */\n    isAndroid: function () {\n      return /Android/.test(navigator.userAgent);\n    },\n\n    /**\n     * Detect keyboard visibility by viewport height change\n     */\n    detectKeyboard: function () {\n      const currentHeight = window.innerHeight;\n      const heightDiff = this.state.originalViewportHeight - currentHeight;\n\n      // Keyboard is considered visible if viewport shrinks by more than 150px\n      if (heightDiff > 150) {\n        if (!this.state.isVisible) {\n          this.state.isVisible = true;\n          this.state.keyboardHeight = heightDiff;\n          this.onKeyboardShow();\n        }\n      } else {\n        if (this.state.isVisible) {\n          this.state.isVisible = false;\n          this.state.keyboardHeight = 0;\n          this.onKeyboardHide();\n        }\n      }\n    },\n\n    /**\n     * Called when keyboard is shown\n     */\n    onKeyboardShow: function () {\n      document.documentElement.classList.add('keyboard-visible');\n      document.body.classList.add('keyboard-visible');\n\n      // Dispatch custom event\n      const event = new CustomEvent('mobile:keyboardshow', {\n        detail: { height: this.state.keyboardHeight }\n      });\n      window.dispatchEvent(event);\n\n      // Adjust modals\n      this.adjustModalsForKeyboard();\n\n      // Adjust dropdowns\n      this.adjustDropdownsForKeyboard();\n\n      console.log('Keyboard shown, height:', this.state.keyboardHeight);\n    },\n\n    /**\n     * Called when keyboard is hidden\n     */\n    onKeyboardHide: function () {\n      document.documentElement.classList.remove('keyboard-visible');\n      document.body.classList.remove('keyboard-visible');\n\n      // Dispatch custom event\n      const event = new CustomEvent('mobile:keyboardhide');\n      window.dispatchEvent(event);\n\n      // Reset modal adjustments\n      this.resetModalAdjustments();\n\n      console.log('Keyboard hidden');\n    },\n\n    /**\n     * Adjust modal position when keyboard is visible\n     * REFACTORED: Using CSS classes instead of inline styles\n     */\n    adjustModalsForKeyboard: function () {\n      document.querySelectorAll('[data-modal].show').forEach(modal => {\n        const modalDialog = modal.querySelector('[data-modal-dialog]');\n        if (!modalDialog) return;\n\n        // Calculate available space\n        const availableHeight = window.innerHeight - this.state.keyboardHeight;\n        const modalHeight = modalDialog.offsetHeight;\n\n        if (modalHeight > availableHeight) {\n          // Modal is taller than available space, make it scrollable\n          modalDialog.classList.add('modal-keyboard-visible');\n        }\n\n        // Move modal up if keyboard would cover active input\n        if (this.state.activeInput) {\n          const inputRect = this.state.activeInput.getBoundingClientRect();\n          const keyboardTop = window.innerHeight - this.state.keyboardHeight;\n\n          if (inputRect.bottom > keyboardTop) {\n            modalDialog.classList.add('modal-keyboard-shift');\n          }\n        }\n      });\n    },\n\n    /**\n     * Reset modal adjustments after keyboard hide\n     * REFACTORED: Using CSS classes instead of inline styles\n     */\n    resetModalAdjustments: function () {\n      document.querySelectorAll('[data-modal].show [data-modal-dialog]').forEach(modalDialog => {\n        modalDialog.classList.remove('modal-keyboard-visible', 'modal-keyboard-shift');\n      });\n    },\n\n    /**\n     * Adjust dropdown position to avoid keyboard\n     * REFACTORED: Using CSS classes instead of inline styles\n     */\n    adjustDropdownsForKeyboard: function () {\n      document.querySelectorAll('[data-dropdown].show, [data-select-dropdown]').forEach(dropdown => {\n        const rect = dropdown.getBoundingClientRect();\n        const keyboardTop = window.innerHeight - this.state.keyboardHeight;\n\n        if (rect.bottom > keyboardTop) {\n          // Dropdown would be covered by keyboard, position it above\n          dropdown.classList.add('dropdown-above-keyboard');\n        }\n      });\n    },\n\n    /**\n     * Scroll input into view when focused\n     * @param {HTMLElement} input\n     */\n    scrollInputIntoView: function (input) {\n      if (!this.isMobile()) return;\n\n      // Wait for keyboard to appear (iOS delay)\n      setTimeout(() => {\n        const rect = input.getBoundingClientRect();\n        const keyboardTop = window.innerHeight - this.state.keyboardHeight;\n        const inputBottom = rect.bottom;\n\n        // Check if input is covered by keyboard\n        if (inputBottom > keyboardTop) {\n          // Calculate scroll amount\n          const scrollAmount = inputBottom - keyboardTop + 20;\n\n          // Scroll the input into view\n          input.scrollIntoView({\n            behavior: 'smooth',\n            block: 'center',\n            inline: 'nearest'\n          });\n\n          // Additional scroll if in modal\n          const modal = input.closest('[data-modal-body]');\n          if (modal) {\n            modal.scrollTop += scrollAmount;\n          }\n        }\n      }, 300); // Delay to let keyboard animation complete\n    },\n\n    /**\n     * Optimize input types for better mobile keyboards\n     * REFACTORED: Using CSS class for iOS font size fix\n     * @param {HTMLElement} input\n     */\n    optimizeInputType: function (input) {\n      const type = input.type;\n      const name = input.name || '';\n      const id = input.id || '';\n      const placeholder = input.placeholder || '';\n\n      // Email inputs\n      if (type === 'email' || name.includes('email') || id.includes('email')) {\n        input.type = 'email';\n        input.autocomplete = 'email';\n        input.inputMode = 'email';\n      }\n\n      // Phone inputs\n      if (name.includes('phone') || name.includes('tel') || id.includes('phone')) {\n        input.type = 'tel';\n        input.autocomplete = 'tel';\n        input.inputMode = 'tel';\n      }\n\n      // Number inputs\n      if (type === 'number' || name.includes('number') || placeholder.includes('number')) {\n        input.inputMode = 'numeric';\n        input.pattern = '[0-9]*'; // iOS numeric keyboard\n      }\n\n      // URL inputs\n      if (name.includes('url') || name.includes('website') || id.includes('url')) {\n        input.type = 'url';\n        input.autocomplete = 'url';\n        input.inputMode = 'url';\n      }\n\n      // Search inputs\n      if (type === 'search' || name.includes('search') || id.includes('search')) {\n        input.type = 'search';\n      }\n\n      // Username/password\n      if (name.includes('username') || id.includes('username')) {\n        input.autocomplete = 'username';\n      }\n\n      if (type === 'password') {\n        input.autocomplete = 'current-password';\n      }\n\n      // Prevent iOS zoom on focus (16px minimum)\n      // REFACTORED: Using CSS class instead of inline style\n      if (this.isIOS()) {\n        const fontSize = window.getComputedStyle(input).fontSize;\n        if (parseInt(fontSize) < 16) {\n          input.classList.add('ios-no-zoom');\n        }\n      }\n    },\n\n    /**\n     * Setup input focus handlers\n     */\n    setupInputHandlers: function () {\n      // Focus event for all inputs\n      document.addEventListener('focusin', (e) => {\n        const input = e.target;\n\n        // Only handle form inputs\n        if (!['INPUT', 'TEXTAREA', 'SELECT'].includes(input.tagName)) return;\n\n        this.state.activeInput = input;\n\n        // Add focused class to body for CSS styling\n        document.body.classList.add('input-focused');\n\n        // Scroll input into view\n        this.scrollInputIntoView(input);\n\n        // Trigger keyboard detection\n        setTimeout(() => this.detectKeyboard(), 100);\n\n      }, true);\n\n      // Blur event\n      document.addEventListener('focusout', (e) => {\n        this.state.activeInput = null;\n        document.body.classList.remove('input-focused');\n\n        // Check if keyboard is hiding\n        setTimeout(() => this.detectKeyboard(), 100);\n      }, true);\n\n      // Optimize all existing inputs\n      document.querySelectorAll('input, textarea').forEach(input => {\n        this.optimizeInputType(input);\n      });\n    },\n\n    /**\n     * iOS-specific fixes\n     * REFACTORED: Using CSS classes and custom properties instead of inline styles\n     */\n    setupIOSFixes: function () {\n      if (!this.isIOS()) return;\n\n      // Fix for iOS viewport height with keyboard\n      const setVH = () => {\n        const vh = window.innerHeight * 0.01;\n        document.documentElement.style.setProperty('--vh', `${vh}px`);\n      };\n\n      setVH();\n      window.addEventListener('resize', setVH);\n\n      // Fix for iOS scroll position after keyboard hide\n      window.addEventListener('focusout', () => {\n        setTimeout(() => {\n          window.scrollTo(0, 0);\n        }, 100);\n      });\n\n      // Fix for iOS date inputs\n      // REFACTORED: Using CSS class instead of inline styles\n      document.querySelectorAll('input[type=\"date\"], input[type=\"datetime-local\"], input[type=\"time\"]').forEach(input => {\n        input.classList.add('ios-date-input');\n      });\n\n      // Prevent rubber band scrolling when keyboard is open\n      document.addEventListener('touchmove', (e) => {\n        if (this.state.isVisible && this.state.activeInput) {\n          const scrollable = e.target.closest('[data-modal-body], [data-table-responsive], [data-scrollable]');\n          if (!scrollable) {\n            e.preventDefault();\n          }\n        }\n      }, { passive: false });\n    },\n\n    /**\n     * Android-specific fixes\n     */\n    setupAndroidFixes: function () {\n      if (!this.isAndroid()) return;\n\n      // Android soft keyboard detection via resize\n      let resizeTimeout;\n      window.addEventListener('resize', () => {\n        clearTimeout(resizeTimeout);\n        resizeTimeout = setTimeout(() => {\n          this.detectKeyboard();\n        }, 100);\n      });\n\n      // Fix for Android keyboard not pushing content up\n      if (this.state.isVisible && this.state.activeInput) {\n        const metaViewport = document.querySelector('meta[name=\"viewport\"]');\n        if (metaViewport) {\n          // Temporarily adjust viewport to force resize\n          const originalContent = metaViewport.content;\n          metaViewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0';\n          setTimeout(() => {\n            metaViewport.content = originalContent;\n          }, 300);\n        }\n      }\n    },\n\n    /**\n     * Setup form validation with keyboard awareness\n     */\n    setupFormValidation: function () {\n      document.querySelectorAll('form').forEach(form => {\n        form.addEventListener('submit', (e) => {\n          // Find first invalid input\n          const firstInvalid = form.querySelector(':invalid');\n\n          if (firstInvalid) {\n            e.preventDefault();\n\n            // Focus and scroll to first invalid input\n            firstInvalid.focus();\n            this.scrollInputIntoView(firstInvalid);\n\n            // Haptic feedback if available\n            if (window.Haptics) {\n              window.Haptics.validationError();\n            }\n          }\n        });\n\n        // Real-time validation\n        form.querySelectorAll('input, textarea, select').forEach(input => {\n          input.addEventListener('invalid', () => {\n            if (window.Haptics) {\n              window.Haptics.validationError();\n            }\n          });\n\n          input.addEventListener('input', () => {\n            if (input.validity.valid && input.classList.contains('is-invalid')) {\n              input.classList.remove('is-invalid');\n              input.classList.add('is-valid');\n            }\n          });\n        });\n      });\n    },\n\n    /**\n     * Setup mutation observer for dynamically added inputs\n     */\n    setupMutationObserver: function () {\n      const observer = new MutationObserver((mutations) => {\n        mutations.forEach(mutation => {\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeType === 1) { // Element node\n              // Check if added node is an input\n              if (['INPUT', 'TEXTAREA', 'SELECT'].includes(node.tagName)) {\n                this.optimizeInputType(node);\n              }\n\n              // Check for inputs within added node\n              node.querySelectorAll?.('input, textarea, select').forEach(input => {\n                this.optimizeInputType(input);\n              });\n            }\n          });\n        });\n      });\n\n      observer.observe(document.body, {\n        childList: true,\n        subtree: true\n      });\n    },\n\n    /**\n     * Add CSS for keyboard-aware styling\n     * NOTE: Core styles moved to mobile-utils.css, keeping minimal dynamic styles\n     */\n    addKeyboardStyles: function () {\n      if (document.getElementById('mobile-keyboard-styles')) return;\n\n      const style = document.createElement('style');\n      style.id = 'mobile-keyboard-styles';\n      style.textContent = `\n        /* Keyboard visible state */\n        body.keyboard-visible {\n          /* Optional: adjust fixed elements */\n        }\n\n        /* Input focused state */\n        body.input-focused .navbar-fixed-bottom,\n        body.input-focused .mobile-bottom-nav {\n          transform: translateY(100%);\n          transition: transform 0.3s ease;\n        }\n\n        /* Ensure inputs are visible above keyboard */\n        [data-form-control]:focus,\n        [data-form-select]:focus,\n        textarea:focus {\n          position: relative;\n          z-index: 10;\n        }\n\n        /* iOS-specific: fix 100vh with keyboard */\n        @supports (-webkit-touch-callout: none) {\n          [data-modal-dialog],\n          [data-full-height] {\n            height: calc(var(--vh, 1vh) * 100);\n          }\n        }\n\n        /* Smooth transitions for keyboard adjustments */\n        [data-modal-dialog] {\n          transition: transform 0.3s ease, max-height 0.3s ease;\n        }\n      `;\n      document.head.appendChild(style);\n    },\n\n    /**\n     * Initialize keyboard handler\n     */\n    init: function () {\n      if (!this.isMobile()) {\n        console.log('MobileKeyboard: Not a mobile device, skipping initialization');\n        return;\n      }\n\n      // Setup handlers\n      this.setupInputHandlers();\n      this.setupFormValidation();\n      this.setupMutationObserver();\n\n      // Platform-specific fixes\n      if (this.isIOS()) {\n        this.setupIOSFixes();\n      }\n\n      if (this.isAndroid()) {\n        this.setupAndroidFixes();\n      }\n\n      // Add styles\n      this.addKeyboardStyles();\n\n      // Update viewport height on orientation change\n      window.addEventListener('orientationchange', () => {\n        setTimeout(() => {\n          this.state.originalViewportHeight = window.innerHeight;\n          this.detectKeyboard();\n        }, 200);\n      });\n\n      console.log('MobileKeyboard: Initialized successfully');\n    }\n  };\n\n  // Auto-initialize\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => MobileKeyboard.init());\n  } else {\n    MobileKeyboard.init();\n  }\n\n  // Expose globally\n  window.MobileKeyboard = MobileKeyboard;\n\n})(window);\n","/**\n * Mobile Forms Enhancement\n *\n * Optimizes forms, modals, and input groups for mobile devices.\n * Handles match reporting, RSVP management, and other complex forms.\n *\n * Features:\n * - Dynamic modal sizing based on device\n * - Input group optimization for touch\n * - Swipe-to-delete for repeated entries\n * - Form field collapsing/expanding\n * - Better select dropdown handling\n *\n * REFACTORED: All inline style manipulations replaced with CSS classes\n * REFACTORED: All styling class selectors replaced with stable behavioral hooks\n */\n\n(function (window) {\n  'use strict';\n\n  const MobileForms = {\n    /**\n     * Check if device is mobile\n     */\n    isMobile: function () {\n      return window.innerWidth < 768;\n    },\n\n    /**\n     * Optimize modal sizes for mobile\n     */\n    optimizeModals: function () {\n      document.querySelectorAll('[data-modal]').forEach(modal => {\n        if (this.isMobile()) {\n          // Convert large modals to full-screen on mobile\n          const modalDialog = modal.querySelector('[data-modal-dialog]');\n          if (modalDialog) {\n            // If modal-lg, make it responsive\n            if (modalDialog.classList.contains('modal-lg')) {\n              modalDialog.classList.add('mobile-optimized-modal');\n            }\n\n            // Adjust modal content max-height with CSS class\n            const modalContent = modal.querySelector('[data-modal-content]');\n            if (modalContent) {\n              modalContent.classList.add('mobile-modal-content');\n            }\n          }\n        }\n      });\n    },\n\n    /**\n     * Optimize input groups for touch (match reporting events)\n     */\n    optimizeInputGroups: function () {\n      document.querySelectorAll('[data-input-group]').forEach(group => {\n        if (this.isMobile()) {\n          // Make select dropdowns full-width on mobile\n          const selects = group.querySelectorAll('select');\n          selects.forEach(select => {\n            select.classList.add('mobile-input-select');\n          });\n\n          // Make minute inputs larger on mobile\n          const inputs = group.querySelectorAll('input[type=\"number\"], input[placeholder*=\"Min\"]');\n          inputs.forEach(input => {\n            input.classList.add('mobile-input-number');\n          });\n\n          // Make remove buttons larger for touch\n          const removeButtons = group.querySelectorAll('[data-remove-btn], button[onclick*=\"remove\"]');\n          removeButtons.forEach(btn => {\n            btn.classList.add('mobile-remove-btn');\n          });\n        }\n      });\n    },\n\n    /**\n     * Add swipe-to-delete for input groups\n     */\n    setupSwipeToDelete: function () {\n      if (!window.Hammer || !this.isMobile()) return;\n\n      document.querySelectorAll('[data-input-group][id*=\"event-\"], [data-event-entry]').forEach(entry => {\n        const hammer = new Hammer(entry);\n        hammer.get('swipe').set({ direction: Hammer.DIRECTION_LEFT, threshold: 50 });\n\n        let deleteIndicator = entry.querySelector('.swipe-delete-indicator');\n        if (!deleteIndicator) {\n          deleteIndicator = document.createElement('div');\n          deleteIndicator.className = 'swipe-delete-indicator';\n          deleteIndicator.innerHTML = '<i class=\"ti ti-trash\"></i> Swipe to delete';\n\n          // Apply CSS classes instead of inline styles\n          entry.classList.add('swipe-container');\n          entry.appendChild(deleteIndicator);\n        }\n\n        hammer.on('swipeleft', () => {\n          // Show delete indicator\n          deleteIndicator.classList.add('swipe-visible');\n          entry.classList.add('swipe-active');\n\n          if (window.Haptics) window.Haptics.warning();\n\n          // Auto-hide after 3 seconds or on tap\n          const hideTimeout = setTimeout(() => {\n            deleteIndicator.classList.remove('swipe-visible');\n            entry.classList.remove('swipe-active');\n          }, 3000);\n\n          // Tap to confirm delete\n          deleteIndicator.onclick = () => {\n            clearTimeout(hideTimeout);\n\n            if (window.Haptics) window.Haptics.delete();\n\n            // Find and click the remove button\n            const removeBtn = entry.querySelector('[data-remove-btn], button[onclick*=\"remove\"]');\n            if (removeBtn) {\n              removeBtn.click();\n            }\n          };\n        });\n\n        hammer.on('swiperight', () => {\n          // Hide delete indicator\n          deleteIndicator.classList.remove('swipe-visible');\n          entry.classList.remove('swipe-active');\n        });\n      });\n    },\n\n    /**\n     * Optimize select2 dropdowns for mobile\n     */\n    optimizeSelect2: function () {\n      if (!this.isMobile()) return;\n\n      // Configure Select2 for mobile\n      if (window.jQuery && jQuery.fn.select2) {\n        jQuery('select.select2').each(function () {\n          const $select = jQuery(this);\n\n          // Reconfigure with mobile options\n          if ($select.hasClass('select2-hidden-accessible')) {\n            $select.select2('destroy');\n          }\n\n          $select.select2({\n            width: '100%',\n            dropdownAutoWidth: true,\n            dropdownCssClass: 'mobile-select2-dropdown',\n            containerCssClass: 'mobile-select2-container',\n            minimumResultsForSearch: 10 // Show search only for long lists\n          });\n        });\n      }\n    },\n\n    /**\n     * Make form sections collapsible on mobile\n     */\n    makeCollapsible: function () {\n      if (!this.isMobile()) return;\n\n      // Find form sections with multiple input groups\n      document.querySelectorAll('[data-modal-body] .row, [data-form-section]').forEach(section => {\n        const inputGroups = section.querySelectorAll('[data-input-group]');\n\n        if (inputGroups.length > 3) {\n          // Create collapsible header\n          const header = document.createElement('button');\n          header.type = 'button';\n          header.className = 'btn btn-link w-100 text-start mobile-collapse-toggle';\n          header.innerHTML = `\n            <span class=\"fw-bold\">${section.dataset.sectionTitle || 'Show/Hide Section'}</span>\n            <i class=\"ti ti-chevron-down float-end\"></i>\n          `;\n\n          const content = document.createElement('div');\n          content.className = 'mobile-collapse-content mobile-collapse-expanded';\n\n          // Move input groups to content\n          while (inputGroups.length > 0) {\n            content.appendChild(inputGroups[0]);\n          }\n\n          section.insertBefore(header, section.firstChild);\n          section.appendChild(content);\n\n          // Toggle handler\n          let isCollapsed = false;\n          header.onclick = () => {\n            isCollapsed = !isCollapsed;\n            const icon = header.querySelector('i');\n\n            if (isCollapsed) {\n              content.classList.remove('mobile-collapse-expanded');\n              content.classList.add('mobile-collapse-collapsed');\n              icon.classList.remove('ti-chevron-down');\n              icon.classList.add('ti-chevron-right');\n            } else {\n              content.classList.remove('mobile-collapse-collapsed');\n              content.classList.add('mobile-collapse-expanded');\n              icon.classList.remove('ti-chevron-right');\n              icon.classList.add('ti-chevron-down');\n            }\n\n            if (window.Haptics) window.Haptics.light();\n          };\n        }\n      });\n    },\n\n    /**\n     * Optimize DataTables for mobile\n     */\n    optimizeDataTables: function () {\n      if (!this.isMobile()) return;\n\n      if (window.jQuery && jQuery.fn.DataTable) {\n        jQuery('[data-table], .js-data-table').each(function () {\n          const $table = jQuery(this);\n\n          // Check if already initialized\n          if (jQuery.fn.DataTable.isDataTable($table)) {\n            const dt = $table.DataTable();\n\n            // Update responsive settings\n            dt.settings()[0].responsive = true;\n\n            // Hide specific columns on mobile\n            dt.columns([0, -1]).visible(true); // Keep first and last columns (name and actions)\n\n            // Adjust page length\n            dt.page.len(10).draw();\n          } else {\n            // Initialize with mobile settings\n            $table.DataTable({\n              responsive: true,\n              pageLength: 10,\n              dom: '<\"top\"f>rt<\"bottom\"ip><\"clear\">',\n              language: {\n                search: 'Filter:',\n                lengthMenu: 'Show _MENU_',\n                info: 'Page _PAGE_ of _PAGES_',\n                infoEmpty: 'No entries',\n                infoFiltered: ''\n              }\n            });\n          }\n        });\n      }\n    },\n\n    /**\n     * Add quick action buttons for mobile\n     */\n    addQuickActions: function () {\n      // DISABLED: This function was creating duplicate submit buttons with inline styles\n      // Mobile modal buttons are now styled purely via CSS in mobile-modals.css\n      // This provides single source of truth and eliminates duplicate green submit button\n      // If haptic feedback is needed, it should be added to existing submit button click handlers\n      return;\n    },\n\n    /**\n     * Improve textarea handling on mobile\n     */\n    optimizeTextareas: function () {\n      document.querySelectorAll('textarea').forEach(textarea => {\n        if (this.isMobile()) {\n          // Add CSS class for minimum height\n          textarea.classList.add('mobile-textarea');\n\n          // Auto-expand on focus\n          textarea.addEventListener('focus', () => {\n            textarea.classList.add('mobile-textarea-expanded');\n          });\n\n          // Character count if needed\n          const maxLength = textarea.getAttribute('maxlength');\n          if (maxLength) {\n            let counter = textarea.parentElement.querySelector('.char-counter');\n            if (!counter) {\n              counter = document.createElement('div');\n              counter.className = 'char-counter text-muted small';\n              textarea.parentElement.appendChild(counter);\n            }\n\n            const updateCounter = () => {\n              const remaining = maxLength - textarea.value.length;\n              counter.textContent = `${remaining} characters remaining`;\n\n              // Toggle warning class based on remaining characters\n              if (remaining < 20) {\n                counter.classList.add('char-counter-warning');\n              } else {\n                counter.classList.remove('char-counter-warning');\n              }\n            };\n\n            textarea.addEventListener('input', updateCounter);\n            updateCounter();\n          }\n        }\n      });\n    },\n\n    /**\n     * Add floating labels for better mobile UX\n     */\n    convertToFloatingLabels: function () {\n      if (!this.isMobile()) return;\n\n      document.querySelectorAll('[data-form-group]:not(.form-floating)').forEach(group => {\n        const label = group.querySelector('label');\n        const input = group.querySelector('input, select, textarea');\n\n        if (label && input && !input.closest('[data-input-group]')) {\n          // Convert to floating label\n          group.classList.add('form-floating');\n          group.appendChild(label); // Move label after input\n        }\n      });\n    },\n\n    /**\n     * Setup form validation with mobile feedback\n     */\n    setupMobileValidation: function () {\n      document.querySelectorAll('form').forEach(form => {\n        form.addEventListener('submit', (e) => {\n          const invalidFields = form.querySelectorAll(':invalid');\n\n          if (invalidFields.length > 0) {\n            e.preventDefault();\n\n            // Show first error\n            const firstInvalid = invalidFields[0];\n            firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });\n            firstInvalid.focus();\n\n            // Visual feedback with CSS class\n            firstInvalid.classList.add('shake-invalid');\n            setTimeout(() => firstInvalid.classList.remove('shake-invalid'), 500);\n\n            // Haptic feedback\n            if (window.Haptics) window.Haptics.validationError();\n\n            // Show toast\n            if (window.Swal) {\n              Swal.fire({\n                toast: true,\n                position: 'top',\n                icon: 'error',\n                title: 'Please fill out all required fields',\n                showConfirmButton: false,\n                timer: 3000\n              });\n            }\n          }\n        });\n\n        // Real-time validation feedback\n        form.querySelectorAll('input, select, textarea').forEach(field => {\n          field.addEventListener('blur', () => {\n            if (field.validity.valid) {\n              field.classList.remove('is-invalid');\n              field.classList.add('is-valid');\n            } else if (field.value) {\n              field.classList.remove('is-valid');\n              field.classList.add('is-invalid');\n              if (window.Haptics) window.Haptics.light();\n            }\n          });\n        });\n      });\n    },\n\n    /**\n     * Add CSS for mobile form enhancements\n     */\n    addMobileFormStyles: function () {\n      if (document.getElementById('mobile-form-styles')) return;\n\n      const style = document.createElement('style');\n      style.id = 'mobile-form-styles';\n      style.textContent = `\n        /* Mobile modal optimization */\n        @media (max-width: 767.98px) {\n          .mobile-optimized-modal {\n            max-width: 100%;\n            margin: 0;\n          }\n\n          .mobile-optimized-modal [data-modal-content] {\n            border-radius: 16px 16px 0 0;\n          }\n\n          /* Input group stacking */\n          [data-input-group] {\n            flex-wrap: wrap;\n            gap: 8px;\n          }\n\n          [data-input-group] > * {\n            flex: 1 1 auto;\n            min-width: 0;\n          }\n\n          [data-input-group] [data-remove-btn],\n          [data-input-group] button[onclick*=\"remove\"] {\n            flex: 0 0 44px;\n            min-width: 44px !important;\n            min-height: 44px !important;\n            padding: 0;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n          }\n\n          /* Select2 mobile */\n          .mobile-select2-dropdown {\n            font-size: 16px !important;\n          }\n\n          .mobile-select2-container .select2-selection {\n            min-height: 44px;\n            padding: 8px 12px;\n          }\n\n          /* Shake animation for validation */\n          @keyframes shake {\n            0%, 100% { transform: translateX(0); }\n            25% { transform: translateX(-10px); }\n            75% { transform: translateX(10px); }\n          }\n\n          .shake-invalid {\n            animation: shake 0.3s ease-in-out;\n            border-color: var(--bs-danger) !important;\n          }\n\n          /* Mobile form row stacking */\n          [data-modal-body] .row.g-2 {\n            row-gap: 16px !important;\n          }\n\n          [data-modal-body] .col-md-6,\n          [data-modal-body] .col-lg-6 {\n            width: 100%;\n          }\n\n          /* Sticky submit button spacing */\n          [data-modal-footer] {\n            padding-bottom: 0 !important;\n          }\n\n          /* Larger touch targets in modals */\n          [data-modal] .btn {\n            min-height: 48px;\n            font-size: 16px;\n            padding: 12px 24px;\n          }\n\n          [data-modal] .form-control,\n          [data-modal] .form-select {\n            min-height: 44px;\n            font-size: 16px;\n          }\n        }\n\n        /* Swipe delete indicator */\n        .swipe-delete-indicator {\n          font-size: 14px;\n          font-weight: 600;\n          cursor: pointer;\n        }\n\n        /* Entry transition for swipe */\n        [data-input-group],\n        [data-event-entry] {\n          transition: transform 0.3s ease;\n        }\n      `;\n      document.head.appendChild(style);\n    },\n\n    /**\n     * Initialize all mobile form enhancements\n     */\n    init: function () {\n      // Add styles first\n      this.addMobileFormStyles();\n\n      // Run optimizations\n      this.optimizeModals();\n      this.optimizeInputGroups();\n      this.optimizeSelect2();\n      this.optimizeDataTables();\n      this.optimizeTextareas();\n      this.setupMobileValidation();\n\n      if (this.isMobile()) {\n        this.setupSwipeToDelete();\n        this.addQuickActions();\n        // this.makeCollapsible(); // Optional: enable if needed\n        // this.convertToFloatingLabels(); // Optional: enable if needed\n      }\n\n      // Re-run on modal shown\n      document.addEventListener('shown.bs.modal', () => {\n        setTimeout(() => {\n          this.optimizeInputGroups();\n          this.setupSwipeToDelete();\n          this.addQuickActions();\n        }, 100);\n      });\n\n      // Re-run on window resize\n      let resizeTimeout;\n      window.addEventListener('resize', () => {\n        clearTimeout(resizeTimeout);\n        resizeTimeout = setTimeout(() => {\n          if (this.isMobile()) {\n            this.optimizeInputGroups();\n          }\n        }, 250);\n      });\n\n      console.log('MobileForms: Initialized successfully (refactored with CSS classes and stable selectors)');\n    }\n  };\n\n  // Expose globally\n  window.MobileForms = MobileForms;\n\n  // Register with InitSystem if available\n  if (typeof window.InitSystem !== 'undefined' && window.InitSystem.register) {\n    window.InitSystem.register('mobile-forms', function() {\n      MobileForms.init();\n    }, {\n      priority: 60,\n      description: 'Mobile form optimizations (input groups, swipe, quick actions)',\n      reinitializable: true\n    });\n  } else {\n    // Fallback: Auto-initialize\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => MobileForms.init());\n    } else {\n      MobileForms.init();\n    }\n  }\n\n})(window);\n","/**\n * Mobile Haptics - Vibration API Wrapper\n *\n * Provides tactile feedback for mobile user interactions using the Vibration API.\n * Enhances UX by confirming actions, indicating errors, and providing feedback.\n *\n * Browser Support:\n * - Chrome Android 32+\n * - Firefox Android 79+\n * - Safari iOS 13+ (limited)\n * - Gracefully degrades on unsupported devices\n */\n\n(function (window) {\n  'use strict';\n\n  /**\n   * Haptics controller with various vibration patterns\n   */\n  const Haptics = {\n    /**\n     * Check if Vibration API is supported\n     * @returns {boolean}\n     */\n    isSupported: function () {\n      return 'vibrate' in navigator || 'mozVibrate' in navigator || 'webkitVibrate' in navigator;\n    },\n\n    /**\n     * Normalize vibration method across browsers\n     * @private\n     */\n    _vibrate: function (pattern) {\n      if (!this.isSupported()) {\n        return false;\n      }\n\n      // Check if vibration is enabled in settings (could be stored in localStorage)\n      if (this.isDisabled()) {\n        return false;\n      }\n\n      try {\n        if (navigator.vibrate) {\n          return navigator.vibrate(pattern);\n        } else if (navigator.mozVibrate) {\n          return navigator.mozVibrate(pattern);\n        } else if (navigator.webkitVibrate) {\n          return navigator.webkitVibrate(pattern);\n        }\n      } catch (e) {\n        console.warn('Haptics error:', e);\n        return false;\n      }\n    },\n\n    /**\n     * Check if haptics is disabled by user preference\n     * @returns {boolean}\n     */\n    isDisabled: function () {\n      return localStorage.getItem('haptics-disabled') === 'true';\n    },\n\n    /**\n     * Enable haptic feedback\n     */\n    enable: function () {\n      localStorage.removeItem('haptics-disabled');\n    },\n\n    /**\n     * Disable haptic feedback\n     */\n    disable: function () {\n      localStorage.setItem('haptics-disabled', 'true');\n    },\n\n    /**\n     * Toggle haptic feedback on/off\n     * @returns {boolean} New state (true = enabled)\n     */\n    toggle: function () {\n      if (this.isDisabled()) {\n        this.enable();\n        return true;\n      } else {\n        this.disable();\n        return false;\n      }\n    },\n\n    /**\n     * Stop any ongoing vibration\n     */\n    stop: function () {\n      this._vibrate(0);\n    },\n\n    /* ===== Intensity Levels ===== */\n\n    /**\n     * Light haptic feedback (10ms)\n     * Use for: hover states, selections, minor interactions\n     */\n    light: function () {\n      return this._vibrate(10);\n    },\n\n    /**\n     * Medium haptic feedback (20ms)\n     * Use for: button taps, form submissions, standard interactions\n     */\n    medium: function () {\n      return this._vibrate(20);\n    },\n\n    /**\n     * Heavy haptic feedback (30ms)\n     * Use for: important actions, confirmations, alerts\n     */\n    heavy: function () {\n      return this._vibrate(30);\n    },\n\n    /* ===== Notification Patterns ===== */\n\n    /**\n     * Success pattern (short-pause-short)\n     * Use for: successful submissions, confirmations, completions\n     */\n    success: function () {\n      return this._vibrate([10, 50, 10]);\n    },\n\n    /**\n     * Error pattern (long-pause-long)\n     * Use for: validation errors, failed actions, warnings\n     */\n    error: function () {\n      return this._vibrate([30, 100, 30]);\n    },\n\n    /**\n     * Warning pattern (medium-pause-medium)\n     * Use for: caution messages, important notices\n     */\n    warning: function () {\n      return this._vibrate([20, 50, 20]);\n    },\n\n    /**\n     * Notification pattern (short pulses)\n     * Use for: new messages, alerts, reminders\n     */\n    notification: function () {\n      return this._vibrate([10, 30, 10, 30, 10]);\n    },\n\n    /* ===== Interaction Patterns ===== */\n\n    /**\n     * Selection pattern (single short pulse)\n     * Use for: selecting items, toggling checkboxes, radio buttons\n     */\n    selection: function () {\n      return this._vibrate(15);\n    },\n\n    /**\n     * Deselection pattern (two very short pulses)\n     * Use for: deselecting items, clearing selections\n     */\n    deselection: function () {\n      return this._vibrate([8, 20, 8]);\n    },\n\n    /**\n     * Swipe pattern (quick pulse)\n     * Use for: swipe gestures, page transitions\n     */\n    swipe: function () {\n      return this._vibrate(12);\n    },\n\n    /**\n     * Long press pattern (sustained vibration)\n     * Use for: indicating long press is detected, context menus\n     */\n    longPress: function () {\n      return this._vibrate(50);\n    },\n\n    /**\n     * Double tap pattern (two short pulses)\n     * Use for: double tap gestures, quick actions\n     */\n    doubleTap: function () {\n      return this._vibrate([15, 30, 15]);\n    },\n\n    /* ===== Draft-Specific Patterns ===== */\n\n    /**\n     * Player drafted pattern (celebratory)\n     * Use for: successful draft picks\n     */\n    drafted: function () {\n      return this._vibrate([20, 50, 20, 50, 30]);\n    },\n\n    /**\n     * Invalid selection pattern (rejection)\n     * Use for: trying to draft ineligible players\n     */\n    invalidSelection: function () {\n      return this._vibrate([40, 60, 40]);\n    },\n\n    /**\n     * Time warning pattern (urgent)\n     * Use for: draft timer running low\n     */\n    timeWarning: function () {\n      return this._vibrate([25, 100, 25, 100, 25]);\n    },\n\n    /* ===== Form Patterns ===== */\n\n    /**\n     * Input focus pattern (subtle)\n     * Use for: focusing form inputs\n     */\n    inputFocus: function () {\n      return this._vibrate(8);\n    },\n\n    /**\n     * Input validation error pattern\n     * Use for: real-time validation errors\n     */\n    validationError: function () {\n      return this._vibrate([25, 50, 25]);\n    },\n\n    /**\n     * Form submission pattern\n     * Use for: form submit button taps\n     */\n    formSubmit: function () {\n      return this._vibrate(18);\n    },\n\n    /* ===== Navigation Patterns ===== */\n\n    /**\n     * Menu open pattern\n     * Use for: opening sidebar, dropdowns\n     */\n    menuOpen: function () {\n      return this._vibrate(15);\n    },\n\n    /**\n     * Menu close pattern\n     * Use for: closing sidebar, dropdowns\n     */\n    menuClose: function () {\n      return this._vibrate(12);\n    },\n\n    /**\n     * Modal open pattern\n     * Use for: opening modals, bottom sheets\n     */\n    modalOpen: function () {\n      return this._vibrate([10, 30, 15]);\n    },\n\n    /**\n     * Modal close pattern\n     * Use for: closing modals, bottom sheets\n     */\n    modalClose: function () {\n      return this._vibrate(15);\n    },\n\n    /* ===== Table/List Patterns ===== */\n\n    /**\n     * Refresh pattern (pull-to-refresh)\n     * Use for: refresh actions, data reloads\n     */\n    refresh: function () {\n      return this._vibrate([15, 50, 15, 50, 20]);\n    },\n\n    /**\n     * Delete pattern (destructive action)\n     * Use for: swipe-to-delete, item removal\n     */\n    delete: function () {\n      return this._vibrate([35, 60, 35]);\n    },\n\n    /**\n     * Archive pattern\n     * Use for: archiving items\n     */\n    archive: function () {\n      return this._vibrate([12, 40, 12]);\n    },\n\n    /* ===== Custom Pattern ===== */\n\n    /**\n     * Play a custom vibration pattern\n     * @param {number|number[]} pattern - Duration or array of [vibrate, pause, vibrate, ...]\n     * @returns {boolean} Success\n     */\n    custom: function (pattern) {\n      return this._vibrate(pattern);\n    }\n  };\n\n  /**\n   * Initialize haptics with event listeners\n   */\n  Haptics.init = function () {\n    if (!this.isSupported()) {\n      console.log('Haptics: Vibration API not supported');\n      return;\n    }\n\n    // Auto-add haptic feedback to common elements\n    // Note: Module-level DOMContentLoaded ensures this runs after DOM is ready\n\n    // Buttons\n    document.querySelectorAll('.btn:not([data-haptics=\"false\"])').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        // Check button type for appropriate feedback\n        if (btn.classList.contains('btn-success')) {\n          Haptics.success();\n        } else if (btn.classList.contains('btn-danger')) {\n          Haptics.warning();\n        } else {\n          Haptics.medium();\n        }\n      }, { passive: true });\n    });\n\n    // Form inputs\n    document.querySelectorAll('.form-control, .form-select').forEach(input => {\n      input.addEventListener('focus', () => {\n        Haptics.inputFocus();\n      }, { passive: true });\n\n      input.addEventListener('invalid', () => {\n        Haptics.validationError();\n      });\n    });\n\n    // Checkboxes and radios\n    document.querySelectorAll('input[type=\"checkbox\"], input[type=\"radio\"]').forEach(input => {\n      input.addEventListener('change', () => {\n        if (input.checked) {\n          Haptics.selection();\n        } else {\n          Haptics.deselection();\n        }\n      }, { passive: true });\n    });\n\n    // Nav links\n    document.querySelectorAll('.nav-link:not([data-haptics=\"false\"])').forEach(link => {\n      link.addEventListener('click', () => {\n        Haptics.light();\n      }, { passive: true });\n    });\n\n    // Modal events\n    document.querySelectorAll('.modal').forEach(modal => {\n      modal.addEventListener('shown.bs.modal', () => {\n        Haptics.modalOpen();\n      });\n\n      modal.addEventListener('hidden.bs.modal', () => {\n        Haptics.modalClose();\n      });\n    });\n\n    console.log('Haptics: Initialized successfully');\n  };\n\n  // Auto-initialize\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => Haptics.init());\n  } else {\n    Haptics.init();\n  }\n\n  // Expose globally\n  window.Haptics = Haptics;\n\n})(window);\n","/**\n * Responsive Tables JS\n * \n * Adds data-label attributes to table cells and handles responsive behavior\n * Automatically transforms all tables with .mobile-card-table class\n */\n\n(function() {\n  'use strict';\n  \n  const ResponsiveTables = {\n    /**\n     * Initialize responsive tables functionality\n     */\n    init: function() {\n      // Initialize tables when DOM is ready\n      this.processAllTables();\n      this.setupScrollTracking();\n      this.setupDataTables();\n      this.setupMutationObserver();\n    },\n    \n    /**\n     * Process all tables (prioritize .mobile-card-table, then all .table-responsive tables)\n     */\n    processAllTables: function() {\n      // First process tables with explicit mobile-card-table class\n      const mobileCardTables = document.querySelectorAll('table.mobile-card-table');\n      mobileCardTables.forEach(table => {\n        this.processTable(table);\n      });\n\n      // Then process all tables within .table-responsive containers\n      const responsiveTables = document.querySelectorAll('[data-table-responsive] table');\n      responsiveTables.forEach(table => {\n        // Skip if already processed or if it's within a horizontal-mobile table\n        if (!table.classList.contains('mobile-card-processed') &&\n            !table.closest('[data-table-horizontal-mobile]')) {\n          this.processTable(table);\n        }\n      });\n\n      // Process any standalone .table elements not in .table-responsive (fallback)\n      const standaloneTables = document.querySelectorAll('table.table:not(.mobile-card-processed)');\n      standaloneTables.forEach(table => {\n        // Only process if not already in a .table-responsive container\n        if (!table.closest('[data-table-responsive]') &&\n            !table.closest('[data-table-horizontal-mobile]') &&\n            window.innerWidth < 992) {\n          this.processTable(table);\n        }\n      });\n    },\n    \n    /**\n     * Process a single table by adding data-label attributes\n     * @param {HTMLElement} table - The table element to process\n     */\n    processTable: function(table) {\n      // Skip if table has already been processed\n      if (table.classList.contains('mobile-card-processed')) {\n        return;\n      }\n      \n      // Get header text values\n      const headerCells = table.querySelectorAll('thead th');\n      const headerTexts = Array.from(headerCells).map(th => th.textContent.trim());\n      \n      // Add data-label attributes to all body cells\n      const rows = table.querySelectorAll('tbody tr');\n      rows.forEach(row => {\n        const cells = row.querySelectorAll('td');\n        cells.forEach((cell, index) => {\n          // Only add data-label if we have a corresponding header and no existing data-label\n          if (index < headerTexts.length && !cell.hasAttribute('data-label')) {\n            cell.setAttribute('data-label', headerTexts[index]);\n          }\n          \n          // Special handling for cells containing only action buttons\n          if (this.isCellWithOnlyActions(cell)) {\n            cell.classList.add('table-actions');\n          }\n          \n          // Special handling for cells with avatars\n          if (this.isCellWithAvatar(cell)) {\n            cell.classList.add('avatar-cell');\n          }\n          \n          // Make sure empty cells still show their labels\n          if (!cell.textContent.trim() && !cell.querySelector('*')) {\n            const placeholder = document.createElement('span');\n            placeholder.classList.add('empty-cell-placeholder');\n            placeholder.innerText = \"\";\n            cell.appendChild(placeholder);\n          }\n        });\n      });\n      \n      // Mark table as processed\n      table.classList.add('mobile-card-processed');\n    },\n    \n    /**\n     * Check if a cell contains only action buttons\n     * @param {HTMLElement} cell - The table cell to check\n     * @return {boolean} True if cell contains only action buttons\n     */\n    isCellWithOnlyActions: function(cell) {\n      // Get direct children\n      const children = Array.from(cell.children);\n      \n      // If no children, not an action cell\n      if (children.length === 0) {\n        return false;\n      }\n      \n      // Check if all children are buttons or links with button classes\n      return children.every(child => {\n        return (\n          child.tagName === 'BUTTON' ||\n          child.tagName === 'A' && child.classList.contains('btn') ||\n          child.hasAttribute('data-dropdown') ||\n          child.hasAttribute('data-btn-group')\n        );\n      });\n    },\n    \n    /**\n     * Check if a cell contains an avatar\n     * @param {HTMLElement} cell - The table cell to check\n     * @return {boolean} True if cell contains an avatar\n     */\n    isCellWithAvatar: function(cell) {\n      return (\n        cell.querySelector('[data-avatar]') !== null ||\n        cell.querySelector('img[data-rounded-circle]') !== null ||\n        cell.querySelector('img[data-avatar]') !== null\n      );\n    },\n    \n    /**\n     * Track scrolling on table-responsive-scroll elements\n     */\n    setupScrollTracking: function() {\n      const scrollTables = document.querySelectorAll('[data-table-responsive-scroll]');\n\n      scrollTables.forEach(tableWrapper => {\n        tableWrapper.addEventListener('scroll', function() {\n          if (this.scrollLeft > 10) {\n            this.classList.add('is-scrolled');\n          } else {\n            this.classList.remove('is-scrolled');\n          }\n        });\n      });\n    },\n    \n    /**\n     * Setup DataTables compatibility\n     */\n    setupDataTables: function() {\n      // Only proceed if DataTables is available\n      if (typeof $.fn.dataTable !== 'undefined') {\n        // Default DataTables setup for mobile\n        $.extend(true, $.fn.dataTable.defaults, {\n          responsive: true,\n          drawCallback: function() {\n            // Ensure mobile card processing on DataTables\n            if (this.hasClass('mobile-card-table')) {\n              ResponsiveTables.processTable(this[0]);\n            }\n          }\n        });\n        \n        // Process any existing DataTables\n        $('.dataTable.mobile-card-table').each(function() {\n          ResponsiveTables.processTable(this);\n        });\n      }\n    },\n    \n    /**\n     * Setup MutationObserver to detect and process newly added tables\n     */\n    setupMutationObserver: function() {\n      // Create observer instance\n      const observer = new MutationObserver((mutations) => {\n        let shouldProcess = false;\n        \n        mutations.forEach(mutation => {\n          // Check for added nodes\n          if (mutation.addedNodes && mutation.addedNodes.length) {\n            for (let i = 0; i < mutation.addedNodes.length; i++) {\n              const node = mutation.addedNodes[i];\n              \n              // Check if node is an element\n              if (node.nodeType === 1) {\n                // Check if it's a table with our class\n                if (node.matches && node.matches('table.mobile-card-table')) {\n                  shouldProcess = true;\n                  break;\n                }\n                \n                // Check if it contains tables with our class\n                if (node.querySelectorAll && node.querySelectorAll('table.mobile-card-table').length) {\n                  shouldProcess = true;\n                  break;\n                }\n              }\n            }\n          }\n        });\n        \n        // Process tables if needed\n        if (shouldProcess) {\n          this.processAllTables();\n        }\n      });\n      \n      // Start observing document body\n      observer.observe(document.body, {\n        childList: true,\n        subtree: true\n      });\n    }\n  };\n  \n  // Make available globally\n  window.ResponsiveTables = ResponsiveTables;\n\n  // Register with InitSystem if available\n  if (typeof window.InitSystem !== 'undefined' && window.InitSystem.register) {\n    window.InitSystem.register('responsive-tables', function() {\n      ResponsiveTables.init();\n    }, {\n      priority: 60,\n      description: 'Responsive table system (card view on mobile, data-labels)',\n      reinitializable: true\n    });\n  } else {\n    // Fallback: Initialize when document is ready\n    document.addEventListener('DOMContentLoaded', function() {\n      ResponsiveTables.init();\n    });\n  }\n})();\n","/**\n * ECS Soccer League Design System Helper\n *\n * This script helps enforce consistent application of the design system\n * across all templates by:\n * 1. Converting Bootstrap classes to design system classes\n * 2. Adding responsive behaviors to components\n * 3. Providing helper functions for common UI patterns\n */\n\n(function() {\n  'use strict';\n\n  // Main design system helper\n  const ECSDesignSystem = {\n    // Initialize the design system\n    init: function() {\n      // Add the design system stylesheet to the page\n      this.ensureStylesheetLoaded();\n\n      // Apply consistent styling to standard components\n      this.enhanceButtons();\n      this.enhanceCards();\n      this.enhanceForms();\n      this.enhanceModals();\n      this.enhanceTables();\n      this.enhanceNavs();\n\n      // Set up responsive behaviors\n      this.setupResponsive();\n\n      // Set up dark mode\n      this.setupDarkMode();\n\n      // Add any custom behaviors\n      this.setupCustomBehaviors();\n    },\n\n    // Ensure the ECS CSS architecture is loaded\n    ensureStylesheetLoaded: function() {\n      // DISABLED: These CSS files don't exist in the project\n      // Commenting out to prevent 404 errors\n      /*\n      // Load core CSS if not already present\n      if (!document.getElementById('ecs-core-stylesheet')) {\n        const coreLink = document.createElement('link');\n        coreLink.id = 'ecs-core-stylesheet';\n        coreLink.rel = 'stylesheet';\n        coreLink.href = '/static/css/ecs-core.css';\n        document.head.appendChild(coreLink);\n      }\n\n      // Load components CSS if not already present\n      if (!document.getElementById('ecs-components-stylesheet')) {\n        const componentsLink = document.createElement('link');\n        componentsLink.id = 'ecs-components-stylesheet';\n        componentsLink.rel = 'stylesheet';\n        componentsLink.href = '/static/css/ecs-components.css';\n        document.head.appendChild(componentsLink);\n      }\n\n      // Load utilities CSS if not already present\n      if (!document.getElementById('ecs-utilities-stylesheet')) {\n        const utilitiesLink = document.createElement('link');\n        utilitiesLink.id = 'ecs-utilities-stylesheet';\n        utilitiesLink.rel = 'stylesheet';\n        utilitiesLink.href = '/static/css/ecs-utilities.css';\n        document.head.appendChild(utilitiesLink);\n      }\n      */\n    },\n\n    // Add consistent styling to buttons\n    enhanceButtons: function() {\n      // Map Bootstrap button classes to design system classes\n      const btnClassMap = {\n        'btn-primary': 'ecs-btn ecs-btn-primary',\n        'btn-secondary': 'ecs-btn ecs-btn-secondary',\n        'btn-success': 'ecs-btn ecs-btn-success',\n        'btn-info': 'ecs-btn ecs-btn-info',\n        'btn-warning': 'ecs-btn ecs-btn-warning',\n        'btn-danger': 'ecs-btn ecs-btn-danger',\n        'btn-dark': 'ecs-btn ecs-btn-dark',\n        'btn-outline-primary': 'ecs-btn ecs-btn-outline-primary',\n        'btn-outline-secondary': 'ecs-btn ecs-btn-outline-secondary',\n        'btn-sm': 'ecs-btn-sm',\n        'btn-lg': 'ecs-btn-lg'\n      };\n\n      // Selectors to exclude from button enhancement (BEM components with their own styling)\n      const excludeSelectors = [\n        '.c-admin-nav',         // Admin navigation component\n        '.c-mobile-nav',        // Mobile navigation component\n        '.c-modal',             // BEM modal components\n        '.c-btn-modern',        // BEM button components\n        '.c-form-modern',       // BEM form components\n        '.c-settings-tabs',     // Settings tabs component\n        '.c-messages-inbox',    // Messages inbox component\n        '.c-tabs',              // BEM tabs component\n        '.c-schedule',          // Team schedule accordion\n        '.c-schedule-controls', // Schedule expand/collapse controls\n        '[data-no-enhance]'     // Explicit opt-out attribute\n      ];\n      const excludeSelector = excludeSelectors.join(', ');\n\n      // Apply design system classes to buttons\n      document.querySelectorAll('button, [type=\"button\"], [type=\"submit\"], [role=\"button\"]').forEach(button => {\n        // Skip buttons inside excluded components\n        if (button.closest(excludeSelector)) {\n          return;\n        }\n\n        // Skip BEM component buttons that have their own styling\n        if (button.classList.contains('c-tabs__item') ||\n            button.classList.contains('c-btn') ||\n            button.classList.contains('c-nav__item') ||\n            button.classList.contains('c-schedule-controls__btn')) {\n          return;\n        }\n\n        if (!button.classList.contains('ecs-btn')) {\n          button.classList.add('ecs-btn');\n\n          // Add appropriate design system classes\n          for (const [bootstrapClass, ecsClass] of Object.entries(btnClassMap)) {\n            if (button.classList.contains(bootstrapClass)) {\n              // Add our classes\n              ecsClass.split(' ').forEach(cls => {\n                if (!button.classList.contains(cls)) {\n                  button.classList.add(cls);\n                }\n              });\n            }\n          }\n\n          // Add icon wrapper if button has an icon\n          if (button.querySelector('[data-icon], [class*=\"icon-\"], [class*=\"ti-\"], [class*=\"feather-\"]')) {\n            button.classList.add('ecs-btn-icon');\n          }\n        }\n      });\n    },\n\n    // Add consistent styling to cards\n    enhanceCards: function() {\n      // Map Bootstrap card classes to design system classes\n      const cardClassMap = {\n        'card': 'ecs-card',\n        'card-header': 'ecs-card-header',\n        'card-body': 'ecs-card-body',\n        'card-footer': 'ecs-card-footer',\n        'card-title': 'ecs-card-title',\n        'card-subtitle': 'ecs-card-subtitle'\n      };\n\n      // Header color mappings\n      const headerColorMap = {\n        'bg-primary': 'ecs-card-header-primary',\n        'bg-secondary': 'ecs-card-header-secondary',\n        'bg-success': 'ecs-card-header-success',\n        'bg-info': 'ecs-card-header-info',\n        'bg-warning': 'ecs-card-header-warning',\n        'bg-danger': 'ecs-card-header-danger',\n        'bg-dark': 'ecs-card-header-dark'\n      };\n\n      // Apply design system classes to cards\n      document.querySelectorAll('[data-component=\"card\"], [data-role*=\"card\"]').forEach(card => {\n        if (!card.classList.contains('ecs-card')) {\n          card.classList.add('ecs-card');\n\n          // Process card components\n          Object.entries(cardClassMap).forEach(([bootstrapClass, ecsClass]) => {\n            card.querySelectorAll(`[data-card-part=\"${bootstrapClass.replace('card-', '')}\"]`).forEach(element => {\n              if (!element.classList.contains(ecsClass)) {\n                element.classList.add(ecsClass);\n              }\n            });\n          });\n\n          // Process card header colors\n          const cardHeader = card.querySelector('[data-card-part=\"header\"]');\n          if (cardHeader) {\n            Object.entries(headerColorMap).forEach(([bootstrapClass, ecsClass]) => {\n              if (cardHeader.classList.contains(bootstrapClass) && !cardHeader.classList.contains(ecsClass)) {\n                cardHeader.classList.add(ecsClass);\n              }\n            });\n          }\n        }\n      });\n    },\n\n    // Add consistent styling to forms\n    enhanceForms: function() {\n      // Map Bootstrap form classes to design system classes\n      const formClassMap = {\n        'form-control': 'ecs-form-control',\n        'form-select': 'ecs-form-select',\n        'form-check': 'ecs-form-check',\n        'form-check-input': 'ecs-form-check-input',\n        'form-label': 'ecs-form-label',\n        'form-text': 'ecs-form-text',\n        'form-floating': 'ecs-form-floating'\n      };\n\n      // Apply design system classes to form elements\n      Object.entries(formClassMap).forEach(([bootstrapClass, ecsClass]) => {\n        document.querySelectorAll(`[data-form-element], [data-input-type]`).forEach(element => {\n          if (!element.classList.contains(ecsClass)) {\n            element.classList.add(ecsClass);\n          }\n        });\n      });\n\n      // Handle validation states\n      document.querySelectorAll('[data-validation-state=\"valid\"], [data-validation-state=\"invalid\"]').forEach(field => {\n        if (field.getAttribute('data-validation-state') === 'valid') {\n          field.classList.add('ecs-is-valid');\n        } else if (field.getAttribute('data-validation-state') === 'invalid') {\n          field.classList.add('ecs-is-invalid');\n        }\n      });\n    },\n\n    // Add consistent styling to modals\n    enhanceModals: function() {\n      // Skip BEM modals - they have their own styling\n      const bemModalSelector = '.c-modal';\n\n      // Map Bootstrap modal classes to design system classes\n      const modalClassMap = {\n        'modal': 'ecs-modal',\n        'modal-dialog': 'ecs-modal-dialog',\n        'modal-content': 'ecs-modal-content',\n        'modal-header': 'ecs-modal-header',\n        'modal-body': 'ecs-modal-body',\n        'modal-footer': 'ecs-modal-footer',\n        'modal-title': 'ecs-modal-title',\n        'btn-close': 'ecs-modal-close',\n        'modal-dialog-centered': 'ecs-modal-dialog-centered',\n        'modal-dialog-scrollable': 'ecs-modal-dialog-scrollable',\n        'modal-sm': 'ecs-modal-sm',\n        'modal-lg': 'ecs-modal-lg',\n        'modal-xl': 'ecs-modal-xl'\n      };\n\n      // Apply design system classes to modals (skip BEM modals)\n      Object.entries(modalClassMap).forEach(([bootstrapClass, ecsClass]) => {\n        document.querySelectorAll(`[data-component=\"${bootstrapClass}\"], [data-modal-part]`).forEach(element => {\n          // Skip if this is a BEM modal\n          if (element.closest(bemModalSelector)) return;\n          if (!element.classList.contains(ecsClass)) {\n            element.classList.add(ecsClass);\n          }\n        });\n      });\n\n      // Apply consistent behavior to all modals (skip BEM modals)\n      document.querySelectorAll('[data-component=\"modal\"], [role=\"dialog\"]').forEach(modal => {\n        // Skip BEM modals - they use their own system\n        if (modal.classList.contains('c-modal')) return;\n\n        const modalId = modal.id;\n\n        // Handle modal opening - apply design system styles\n        modal.addEventListener('show.bs.modal', function() {\n          // Enhance any form elements inside the modal\n          this.querySelectorAll('[data-form-element], [data-input-type]').forEach(input => {\n            if (input.classList.contains('form-control')) {\n              input.classList.add('ecs-form-control');\n            } else if (input.classList.contains('form-select')) {\n              input.classList.add('ecs-form-select');\n            }\n          });\n\n          // Enhance buttons inside the modal\n          this.querySelectorAll('button, [type=\"button\"], [type=\"submit\"], [role=\"button\"]').forEach(button => {\n            if (!button.classList.contains('ecs-btn')) {\n              button.classList.add('ecs-btn');\n            }\n          });\n        });\n      });\n    },\n\n    // Add consistent styling to tables\n    enhanceTables: function() {\n      // Map Bootstrap table classes to design system classes\n      const tableClassMap = {\n        'table': 'ecs-table',\n        'table-hover': 'ecs-table-hover',\n        'table-striped': 'ecs-table-striped',\n        'table-sm': 'ecs-table-sm'\n      };\n\n      // Apply design system classes to tables\n      Object.entries(tableClassMap).forEach(([bootstrapClass, ecsClass]) => {\n        document.querySelectorAll('[data-component=\"table\"], [role=\"table\"]').forEach(element => {\n          if (!element.classList.contains(ecsClass)) {\n            element.classList.add(ecsClass);\n          }\n        });\n      });\n    },\n\n    // Add consistent styling to navs and tabs\n    enhanceNavs: function() {\n      // Map Bootstrap nav classes to design system classes\n      const navClassMap = {\n        'nav': 'ecs-nav',\n        'nav-link': 'ecs-nav-link',\n        'nav-tabs': 'ecs-nav-tabs',\n        'nav-pills': 'ecs-nav-pills',\n        'active': 'ecs-active'\n      };\n\n      // Apply design system classes to navs\n      Object.entries(navClassMap).forEach(([bootstrapClass, ecsClass]) => {\n        document.querySelectorAll('[data-component=\"nav\"], [role=\"navigation\"] > [role=\"tablist\"]').forEach(element => {\n          if (!element.classList.contains(ecsClass)) {\n            element.classList.add(ecsClass);\n          }\n        });\n      });\n\n      // Ensure tab content has proper design system styling\n      document.querySelectorAll('[data-component=\"tab-content\"], [role=\"tabpanel\"]').forEach(element => {\n        if (element.hasAttribute('data-component')) {\n          element.classList.add('ecs-tab-content');\n        } else if (element.hasAttribute('role')) {\n          element.classList.add('ecs-tab-pane');\n        }\n      });\n    },\n\n    // Set up responsive behaviors\n    setupResponsive: function() {\n      // Adjust elements based on screen size\n      const adjustForScreenSize = () => {\n        const isMobile = window.innerWidth < 768;\n\n        // Adjust buttons on mobile\n        if (isMobile) {\n          document.querySelectorAll('button, [type=\"button\"], [type=\"submit\"], [role=\"button\"]').forEach(button => {\n            // Make sure mobile buttons have adequate touch targets\n            if (!button.classList.contains('btn-sm') && !button.classList.contains('ecs-btn-sm')) {\n              button.classList.add('touch-target');\n            }\n          });\n\n          // Make sure form controls have adequate size on mobile\n          // Exclude checkboxes and radio buttons (they don't trigger iOS zoom)\n          document.querySelectorAll('[data-form-element]:not([type=\"checkbox\"]):not([type=\"radio\"]), [data-input-type]:not([type=\"checkbox\"]):not([type=\"radio\"])').forEach(input => {\n            if (!input.classList.contains('ios-input')) {\n              input.classList.add('ios-input');\n            }\n          });\n        }\n      };\n\n      // Adjust on page load and resize\n      adjustForScreenSize();\n      window.addEventListener('resize', adjustForScreenSize);\n    },\n\n    // Set up dark mode\n    setupDarkMode: function() {\n      // Watch for changes to BOTH data-style and data-bs-theme attributes on the html element\n      const htmlElement = document.documentElement;\n\n      // Create an observer to monitor changes to theme attributes\n      const observer = new MutationObserver((mutations) => {\n        mutations.forEach((mutation) => {\n          if (mutation.type === 'attributes' &&\n              (mutation.attributeName === 'data-style' || mutation.attributeName === 'data-bs-theme')) {\n            const isDarkStyle = htmlElement.getAttribute('data-style') === 'dark';\n            const isDarkBsTheme = htmlElement.getAttribute('data-bs-theme') === 'dark';\n            const isDark = isDarkStyle || isDarkBsTheme;\n            this.applyDarkModeToContent(isDark);\n          }\n        });\n      });\n\n      // Start observing the html element for changes to theme attributes\n      observer.observe(htmlElement, { attributes: true });\n\n      // Initial application based on current state\n      const isDarkStyle = htmlElement.getAttribute('data-style') === 'dark';\n      const isDarkBsTheme = htmlElement.getAttribute('data-bs-theme') === 'dark';\n      const isDark = isDarkStyle || isDarkBsTheme;\n      this.applyDarkModeToContent(isDark);\n\n      // Add dark mode toggle functionality if it doesn't exist\n      if (!document.querySelector('.dark-mode-toggle')) {\n        this.addDarkModeToggle();\n      }\n    },\n\n    // Apply dark mode to content areas\n    // UPDATED: Minimal intervention - let Bootstrap CSS variables handle dark mode\n    // Templates now use var(--bs-*) variables which automatically adapt\n    applyDarkModeToContent: function(isDark) {\n      // Only add/remove marker class for CSS targeting - no inline styles\n      // This allows CSS-based dark mode to work without JavaScript conflicts\n      if (isDark) {\n        document.body.classList.add('dark-mode-body');\n      } else {\n        document.body.classList.remove('dark-mode-body');\n\n        // Clean up any legacy dark-mode-applied classes from previous state\n        document.querySelectorAll('.dark-mode-applied').forEach(element => {\n          element.classList.remove('dark-mode-applied');\n        });\n      }\n    },\n\n    // Add dark mode toggle if it doesn't exist\n    addDarkModeToggle: function() {\n      // DISABLED: Don't add the toggle at all since there's already one in the navbar.html\n      return;\n\n      /*\n      // The following code is kept for reference only but is completely commented out\n      // to prevent JavaScript syntax errors\n\n      const existingToggle = document.querySelector('.style-switcher-toggle');\n      if (existingToggle) {\n        return; // Don't duplicate if it already exists\n      }\n\n      const navbar = document.querySelector('.navbar-nav');\n      if (navbar) {\n        const toggleItem = document.createElement('li');\n        toggleItem.className = 'nav-item dark-mode-toggle';\n\n        // Check current theme and adjust icon accordingly\n        const currentTheme = document.documentElement.getAttribute('data-style') || 'light';\n        const icon = currentTheme === 'dark' ? 'ti ti-sun' : 'ti ti-moon-stars';\n\n        toggleItem.innerHTML = `\n          <a class=\"nav-link style-switcher-toggle\" href=\"javascript:void(0);\" title=\"Toggle Dark Mode\">\n            <i class=\"${icon}\"></i>\n          </a>\n        `;\n        navbar.prepend(toggleItem);\n\n        // Add click event to toggle dark mode\n        toggleItem.querySelector('a').addEventListener('click', () => {\n          const html = document.documentElement;\n          const currentStyle = html.getAttribute('data-style') || 'light';\n          const newStyle = currentStyle === 'dark' ? 'light' : 'dark';\n\n          // Update icon\n          const iconElement = toggleItem.querySelector('i');\n          if (iconElement) {\n            iconElement.className = newStyle === 'dark' ? 'ti ti-sun' : 'ti ti-moon-stars';\n          }\n\n          // Set theme\n          html.setAttribute('data-style', newStyle);\n\n          // Persist selection\n          localStorage.setItem('template-style', newStyle);\n\n          // Apply dark mode immediately to ensure all content areas are updated\n          this.applyDarkModeToContent(newStyle === 'dark');\n\n          // Make an AJAX request to store theme preference server-side\n          fetch('/set-theme', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'X-CSRFToken': document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content')\n            },\n            body: JSON.stringify({ theme: newStyle })\n          }).catch(error => // console.error('Error saving theme preference:', error));\n        });\n      }\n      */\n    },\n\n    // Set up custom behaviors for the design system\n    setupCustomBehaviors: function() {\n      // Add ripple effect to buttons for better feedback\n      this.addRippleEffect();\n\n      // Improve keyboard navigation\n      this.improveKeyboardNavigation();\n\n      // Add support for custom transitions\n      this.setupTransitions();\n    },\n\n    // Add ripple effect to buttons - Modified to prevent button scaling issues\n    addRippleEffect: function() {\n      // Only apply ripple effect to non-modal buttons to prevent conflicts\n      document.querySelectorAll('button:not([data-bs-toggle=\"modal\"]), [type=\"button\"]:not([data-bs-toggle=\"modal\"]), [type=\"submit\"]:not([data-bs-toggle=\"modal\"]), [role=\"button\"]:not([data-bs-toggle=\"modal\"])').forEach(button => {\n        button.addEventListener('click', function(e) {\n          // Skip if this is a modal button\n          if (this.getAttribute('data-bs-toggle') === 'modal' ||\n              this.classList.contains('edit-match-btn') ||\n              this.closest('[data-bs-toggle=\"modal\"]')) {\n            return;\n          }\n\n          const ripple = document.createElement('span');\n          ripple.classList.add('waves-ripple');\n\n          const rect = this.getBoundingClientRect();\n          const size = Math.max(rect.width, rect.height);\n\n          // Set custom properties for ripple positioning\n          ripple.style.setProperty('--ripple-size', `${size}px`);\n          ripple.style.setProperty('--ripple-left', `${e.clientX - rect.left - size / 2}px`);\n          ripple.style.setProperty('--ripple-top', `${e.clientY - rect.top - size / 2}px`);\n\n          // Add transform-none class to prevent button scaling\n          ripple.classList.add('transform-none');\n\n          this.appendChild(ripple);\n\n          // Trigger animation by adding active class\n          setTimeout(() => {\n            ripple.classList.add('waves-ripple-active');\n          }, 10);\n\n          setTimeout(() => {\n            if (ripple.parentNode) {\n              ripple.parentNode.removeChild(ripple);\n            }\n          }, 600);\n        });\n      });\n\n      // console.log('Ripple effect added with scaling fix');\n    },\n\n    // Improve keyboard navigation for better accessibility\n    improveKeyboardNavigation: function() {\n      // Add focus styles to interactive elements\n      document.querySelectorAll('a, button, input, select, textarea, [tabindex]').forEach(element => {\n        element.addEventListener('focus', function() {\n          this.classList.add('ecs-focus');\n        });\n\n        element.addEventListener('blur', function() {\n          this.classList.remove('ecs-focus');\n        });\n      });\n    },\n\n    // Set up custom transitions\n    setupTransitions: function() {\n      // Add slide-in animation for elements with data-ecs-animate=\"slide-in\"\n      document.querySelectorAll('[data-ecs-animate=\"slide-in\"]').forEach(element => {\n        // Add initial state classes (opacity 0, translate down 20px)\n        element.classList.add('opacity-0', 'translate-y-20px', 'transition-smooth');\n\n        // Trigger animation after a short delay\n        setTimeout(() => {\n          // Add final state classes (opacity 1, translate to normal position)\n          element.classList.remove('opacity-0', 'translate-y-20px');\n          element.classList.add('opacity-100', 'translate-y-0');\n        }, 100);\n      });\n    }\n  };\n\n  // Make available globally\n  window.ECSDesignSystem = ECSDesignSystem;\n\n  // Register with InitSystem if available\n  if (typeof window.InitSystem !== 'undefined' && window.InitSystem.register) {\n    window.InitSystem.register('design-system', function() {\n      ECSDesignSystem.init();\n    }, {\n      priority: 90,\n      description: 'ECS Design System (theme, colors, focus states)',\n      reinitializable: false\n    });\n  } else {\n    // Fallback: Initialize on DOM ready\n    document.addEventListener('DOMContentLoaded', function() {\n      ECSDesignSystem.init();\n    });\n  }\n})();\n","/**\n * SweetAlert2 Contextual Helper\n *\n * Extends Swal.fire with smart contextual defaults for button text,\n * icons, and colors based on the action being performed.\n *\n * Usage:\n *   // Instead of Swal.fire({...})\n *   SwalContextual.confirm({\n *       title: 'Delete Item',\n *       text: 'Are you sure you want to delete this item?'\n *   }).then(result => { ... });\n *\n *   // Or use the shorthand methods:\n *   SwalContextual.delete('Are you sure?').then(...)\n *   SwalContextual.approve('Approve this user?').then(...)\n */\n\n(function() {\n    'use strict';\n\n    // Action configurations with smart defaults\n    const ACTION_CONFIGS = {\n        delete: {\n            icon: 'warning',\n            confirmButtonText: 'Delete',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Delete'\n        },\n        remove: {\n            icon: 'warning',\n            confirmButtonText: 'Remove',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Remove'\n        },\n        approve: {\n            icon: 'question',\n            confirmButtonText: 'Approve',\n            confirmButtonColor: '#28a745',\n            titlePrefix: 'Confirm Approval'\n        },\n        reject: {\n            icon: 'warning',\n            confirmButtonText: 'Reject',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Rejection'\n        },\n        deny: {\n            icon: 'warning',\n            confirmButtonText: 'Deny',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Denial'\n        },\n        send: {\n            icon: 'question',\n            confirmButtonText: 'Send',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Send'\n        },\n        sync: {\n            icon: 'question',\n            confirmButtonText: 'Sync',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Sync'\n        },\n        refresh: {\n            icon: 'question',\n            confirmButtonText: 'Refresh',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Refresh'\n        },\n        reset: {\n            icon: 'warning',\n            confirmButtonText: 'Reset',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Reset'\n        },\n        clear: {\n            icon: 'warning',\n            confirmButtonText: 'Clear',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Clear'\n        },\n        cancel: {\n            icon: 'warning',\n            confirmButtonText: 'Yes, Cancel',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Cancellation'\n        },\n        disable: {\n            icon: 'warning',\n            confirmButtonText: 'Disable',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Disable'\n        },\n        enable: {\n            icon: 'question',\n            confirmButtonText: 'Enable',\n            confirmButtonColor: '#28a745',\n            titlePrefix: 'Confirm Enable'\n        },\n        save: {\n            icon: 'question',\n            confirmButtonText: 'Save',\n            confirmButtonColor: '#28a745',\n            titlePrefix: 'Confirm Save'\n        },\n        submit: {\n            icon: 'question',\n            confirmButtonText: 'Submit',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Submit'\n        },\n        unlink: {\n            icon: 'warning',\n            confirmButtonText: 'Unlink',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Unlink'\n        },\n        revoke: {\n            icon: 'warning',\n            confirmButtonText: 'Revoke',\n            confirmButtonColor: '#dc3545',\n            titlePrefix: 'Confirm Revoke'\n        },\n        retry: {\n            icon: 'question',\n            confirmButtonText: 'Retry',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Retry'\n        },\n        resend: {\n            icon: 'question',\n            confirmButtonText: 'Resend',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Resend'\n        },\n        duplicate: {\n            icon: 'question',\n            confirmButtonText: 'Duplicate',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Duplicate'\n        },\n        assign: {\n            icon: 'question',\n            confirmButtonText: 'Assign',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Assignment'\n        },\n        schedule: {\n            icon: 'question',\n            confirmButtonText: 'Schedule',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Schedule'\n        },\n        fetch: {\n            icon: 'question',\n            confirmButtonText: 'Fetch',\n            confirmButtonColor: '#3085d6',\n            titlePrefix: 'Confirm Fetch'\n        }\n    };\n\n    /**\n     * Detect action type from text\n     */\n    function detectAction(text) {\n        if (!text) return null;\n        const lowerText = text.toLowerCase();\n\n        // Check each action keyword\n        for (const [action, config] of Object.entries(ACTION_CONFIGS)) {\n            if (lowerText.includes(action)) {\n                return action;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Build configuration with smart defaults\n     */\n    function buildConfig(options, action) {\n        const actionConfig = action ? ACTION_CONFIGS[action] : {};\n        const defaults = {\n            icon: 'question',\n            showCancelButton: true,\n            confirmButtonText: 'Confirm',\n            cancelButtonText: 'Cancel',\n            confirmButtonColor: '#3085d6',\n            cancelButtonColor: '#6c757d',\n            reverseButtons: true\n        };\n\n        // Merge: defaults < actionConfig < user options\n        return {\n            ...defaults,\n            ...actionConfig,\n            ...options,\n            // Ensure title has prefix if not provided\n            title: options.title || (actionConfig.titlePrefix || 'Confirm Action')\n        };\n    }\n\n    /**\n     * SwalContextual API\n     */\n    const SwalContextual = {\n        /**\n         * Smart confirmation dialog that auto-detects action type\n         * @param {Object} options - SweetAlert2 options\n         * @returns {Promise} SweetAlert2 promise\n         */\n        confirm: function(options) {\n            if (typeof Swal === 'undefined') {\n                console.error('SweetAlert2 not loaded');\n                return Promise.resolve({ isConfirmed: confirm(options.text || options.title) });\n            }\n\n            // Detect action from title or text\n            const detectedAction = detectAction(options.title) || detectAction(options.text);\n            const config = buildConfig(options, detectedAction);\n\n            return Swal.fire(config);\n        },\n\n        /**\n         * Success notification\n         */\n        success: function(title, text) {\n            return Swal.fire({\n                icon: 'success',\n                title: title,\n                text: text,\n                timer: 2000,\n                showConfirmButton: false\n            });\n        },\n\n        /**\n         * Error notification\n         */\n        error: function(title, text) {\n            return Swal.fire({\n                icon: 'error',\n                title: title,\n                text: text\n            });\n        },\n\n        /**\n         * Info notification\n         */\n        info: function(title, text) {\n            return Swal.fire({\n                icon: 'info',\n                title: title,\n                text: text\n            });\n        },\n\n        /**\n         * Warning notification\n         */\n        warning: function(title, text) {\n            return Swal.fire({\n                icon: 'warning',\n                title: title,\n                text: text\n            });\n        }\n    };\n\n    // Create shorthand methods for common actions\n    Object.keys(ACTION_CONFIGS).forEach(action => {\n        SwalContextual[action] = function(text, options = {}) {\n            return this.confirm({\n                text: text,\n                ...options\n            });\n        };\n    });\n\n    // Expose globally\n    window.SwalContextual = SwalContextual;\n\n    console.debug('[SwalContextual] Helper initialized');\n})();\n","/**\n * ==========================================================================\n * CHAT WIDGET - Floating Messenger Component\n * ==========================================================================\n *\n * Facebook Messenger-inspired floating chat widget with:\n * - Conversation list view\n * - Active chat view\n * - Real-time WebSocket updates\n * - Mobile-first responsive design\n * - Smart positioning\n *\n * CSS: /static/css/components/c-chat-widget.css\n * Uses BEM naming: .c-chat-widget__*\n *\n * @requires Socket.IO (for real-time messaging)\n * @requires /api/messages endpoints\n */\n\n(function() {\n  'use strict';\n\n  // ============================================================================\n  // CONFIGURATION\n  // ============================================================================\n\n  const CONFIG = {\n    api: {\n      conversations: '/api/messages',\n      messages: (userId) => `/api/messages/${userId}`,\n      send: (userId) => `/api/messages/${userId}`,\n      unreadCount: '/api/messages/unread-count',\n      searchUsers: '/api/messages/users/search',\n      markRead: (msgId) => `/api/messages/${msgId}/read`\n    },\n    polling: {\n      enabled: true,\n      interval: 30000\n    },\n    ui: {\n      animationDuration: 250,\n      typingDebounce: 2000,\n      searchDebounce: 300,\n      maxMessageLength: 2000\n    }\n  };\n\n  // ============================================================================\n  // STATE\n  // ============================================================================\n\n  const state = {\n    isOpen: false,\n    currentView: 'list', // 'list' | 'chat'\n    activeConversation: null,\n    conversations: [],\n    messages: [],\n    unreadCount: 0,\n    onlineUsers: [],\n    isTyping: false,\n    typingTimeout: null,\n    searchQuery: '',\n    searchResults: [],\n    settings: {\n      typingIndicators: true,\n      readReceipts: true,\n      maxMessageLength: 2000\n    }\n  };\n\n  // ============================================================================\n  // DOM ELEMENTS\n  // ============================================================================\n\n  let elements = {};\n\n  function cacheElements() {\n    elements = {\n      widget: document.querySelector('.c-chat-widget'),\n      trigger: document.querySelector('.c-chat-widget__trigger'),\n      badge: document.querySelector('.c-chat-widget__badge'),\n      panel: document.querySelector('.c-chat-widget__panel'),\n\n      // List view\n      listView: document.querySelector('.c-chat-widget__list-view'),\n      searchInput: document.querySelector('.c-chat-widget__search-input'),\n      searchResults: document.querySelector('.c-chat-widget__search-results'),\n      onlineList: document.querySelector('.c-chat-widget__online-list'),\n      conversationList: document.querySelector('.c-chat-widget__conversations'),\n      emptyState: document.querySelector('.c-chat-widget__empty'),\n\n      // Chat view\n      chatView: document.querySelector('.c-chat-widget__chat'),\n      backBtn: document.querySelector('.c-chat-widget__back-btn'),\n      chatAvatar: document.querySelector('.c-chat-widget__chat-avatar img'),\n      chatAvatarContainer: document.querySelector('.c-chat-widget__chat-avatar'),\n      chatName: document.querySelector('.c-chat-widget__chat-name'),\n      chatStatus: document.querySelector('.c-chat-widget__chat-status'),\n      messagesContainer: document.querySelector('.c-chat-widget__messages'),\n      typingIndicator: document.querySelector('.c-chat-widget__typing'),\n      composerInput: document.querySelector('.c-chat-widget__composer-input'),\n      sendBtn: document.querySelector('.c-chat-widget__send-btn'),\n\n      // Header buttons\n      newChatBtn: document.querySelector('[data-action=\"new-chat\"]'),\n      openInboxBtn: document.querySelector('[data-action=\"open-inbox\"]'),\n      closeBtns: document.querySelectorAll('[data-action=\"close-widget\"]')\n    };\n  }\n\n  // ============================================================================\n  // API FUNCTIONS\n  // ============================================================================\n\n  function getCSRFToken() {\n    const meta = document.querySelector('meta[name=\"csrf-token\"]');\n    return meta ? meta.getAttribute('content') : '';\n  }\n\n  async function fetchJSON(url, options = {}) {\n    try {\n      const headers = {\n        'Content-Type': 'application/json',\n        ...options.headers\n      };\n\n      // Add CSRF token for non-GET requests\n      if (options.method && options.method !== 'GET') {\n        headers['X-CSRFToken'] = getCSRFToken();\n      }\n\n      const response = await fetch(url, { ...options, headers });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error(`[ChatWidget] API Error: ${url}`, error);\n      throw error;\n    }\n  }\n\n  async function loadConversations() {\n    try {\n      const data = await fetchJSON(CONFIG.api.conversations);\n      if (data.success) {\n        state.conversations = data.conversations || [];\n        renderConversations();\n      }\n    } catch (error) {\n      console.error('[ChatWidget] Failed to load conversations', error);\n    }\n  }\n\n  async function loadMessages(userId) {\n    try {\n      const data = await fetchJSON(CONFIG.api.messages(userId));\n      if (data.success) {\n        state.messages = data.messages || [];\n        state.settings = { ...state.settings, ...data.settings };\n        renderMessages();\n        scrollToBottom();\n\n        // Update unread count after reading messages\n        loadUnreadCount();\n      }\n    } catch (error) {\n      console.error('[ChatWidget] Failed to load messages', error);\n    }\n  }\n\n  async function sendMessage(userId, content) {\n    try {\n      const data = await fetchJSON(CONFIG.api.send(userId), {\n        method: 'POST',\n        body: JSON.stringify({ content })\n      });\n\n      if (data.success) {\n        // Add message to local state\n        state.messages.push(data.message);\n        renderMessages();\n        scrollToBottom();\n\n        // Clear input\n        if (elements.composerInput) {\n          elements.composerInput.value = '';\n          elements.composerInput.style.height = 'auto';\n          updateSendButton();\n        }\n\n        // Update conversation list\n        loadConversations();\n      }\n\n      return data;\n    } catch (error) {\n      console.error('[ChatWidget] Failed to send message', error);\n      showToast('Failed to send message', 'error');\n      throw error;\n    }\n  }\n\n  async function loadUnreadCount() {\n    try {\n      const data = await fetchJSON(CONFIG.api.unreadCount);\n      if (data.success) {\n        state.unreadCount = data.count;\n        updateBadge();\n      }\n    } catch (error) {\n      console.error('[ChatWidget] Failed to load unread count', error);\n    }\n  }\n\n  async function searchUsers(query) {\n    if (query.length < 2) {\n      state.searchResults = [];\n      renderSearchResults();\n      return;\n    }\n\n    console.log('[ChatWidget] Searching users for:', query);\n\n    try {\n      const data = await fetchJSON(`${CONFIG.api.searchUsers}?q=${encodeURIComponent(query)}`);\n      console.log('[ChatWidget] Search response:', data);\n\n      if (data.success) {\n        state.searchResults = data.users || [];\n        renderSearchResults();\n        console.log('[ChatWidget] Found', state.searchResults.length, 'users');\n      } else {\n        console.warn('[ChatWidget] Search returned success=false:', data.error);\n        state.searchResults = [];\n        renderSearchResults();\n      }\n    } catch (error) {\n      console.error('[ChatWidget] Failed to search users', error);\n      state.searchResults = [];\n      renderSearchResults();\n    }\n  }\n\n  // ============================================================================\n  // RENDER FUNCTIONS\n  // ============================================================================\n\n  /**\n   * Generate role badge HTML for a user\n   * @param {Object} user - User object with role flags\n   * @returns {string} HTML string with badge icons\n   */\n  function renderRoleBadges(user) {\n    if (!user) return '';\n\n    const badges = [];\n\n    // Global Admin - Crown icon (highest priority)\n    if (user.is_global_admin) {\n      badges.push('<span class=\"c-chat-widget__role-badge c-chat-widget__role-badge--admin\" title=\"Global Admin\"><i class=\"ti ti-crown\"></i></span>');\n    }\n    // Pub League Admin - Shield icon\n    else if (user.is_admin) {\n      badges.push('<span class=\"c-chat-widget__role-badge c-chat-widget__role-badge--admin\" title=\"Admin\"><i class=\"ti ti-shield-check\"></i></span>');\n    }\n\n    // Coach - Whistle icon\n    if (user.is_coach) {\n      badges.push('<span class=\"c-chat-widget__role-badge c-chat-widget__role-badge--coach\" title=\"Coach\"><i class=\"ti ti-speakerphone\"></i></span>');\n    }\n\n    // Referee - Cards icon\n    if (user.is_ref) {\n      badges.push('<span class=\"c-chat-widget__role-badge c-chat-widget__role-badge--ref\" title=\"Referee\"><i class=\"ti ti-cards\"></i></span>');\n    }\n\n    return badges.length > 0 ? `<span class=\"c-chat-widget__role-badges\">${badges.join('')}</span>` : '';\n  }\n\n  function renderConversations() {\n    if (!elements.conversationList) return;\n\n    if (state.conversations.length === 0) {\n      elements.conversationList.innerHTML = '';\n      if (elements.emptyState) {\n        elements.emptyState.style.display = 'flex';\n      }\n      return;\n    }\n\n    if (elements.emptyState) {\n      elements.emptyState.style.display = 'none';\n    }\n\n    const defaultAvatar = '/static/img/default_player.png';\n\n    const html = state.conversations.map(conv => {\n      const isActive = state.activeConversation?.id === conv.user.id;\n      const isUnread = conv.unread_count > 0;\n      const isOnline = conv.user.is_online;\n      const avatarUrl = conv.user.avatar_url || defaultAvatar;\n      const roleBadges = renderRoleBadges(conv.user);\n\n      return `\n        <div class=\"c-chat-widget__conversation ${isActive ? 'c-chat-widget__conversation--active' : ''} ${isUnread ? 'c-chat-widget__conversation--unread' : ''}\"\n             data-user-id=\"${conv.user.id}\"\n             data-user-name=\"${escapeHtml(conv.user.name)}\"\n             data-avatar=\"${avatarUrl}\"\n             data-online=\"${isOnline}\"\n             data-is-coach=\"${conv.user.is_coach || false}\"\n             data-is-admin=\"${conv.user.is_admin || false}\"\n             data-is-global-admin=\"${conv.user.is_global_admin || false}\"\n             data-is-ref=\"${conv.user.is_ref || false}\"\n             role=\"button\"\n             tabindex=\"0\">\n          <div class=\"c-chat-widget__conv-avatar ${isOnline ? 'c-chat-widget__conv-avatar--online' : ''}\">\n            <img src=\"${avatarUrl}\" alt=\"${escapeHtml(conv.user.name)}\" onerror=\"this.src='${defaultAvatar}'\">\n          </div>\n          <div class=\"c-chat-widget__conv-content\">\n            <div class=\"c-chat-widget__conv-header\">\n              <span class=\"c-chat-widget__conv-name\">${escapeHtml(conv.user.name)}${roleBadges}</span>\n              <span class=\"c-chat-widget__conv-time\">${conv.last_message.time_ago}</span>\n            </div>\n            <div class=\"c-chat-widget__conv-preview\">\n              ${conv.last_message.sent_by_me ? 'You: ' : ''}${escapeHtml(conv.last_message.content)}\n            </div>\n          </div>\n          ${isUnread ? `<div class=\"c-chat-widget__conv-badge\">${conv.unread_count}</div>` : ''}\n        </div>\n      `;\n    }).join('');\n\n    elements.conversationList.innerHTML = html;\n  }\n\n  function renderMessages() {\n    if (!elements.messagesContainer) return;\n\n    if (state.messages.length === 0) {\n      elements.messagesContainer.innerHTML = `\n        <div class=\"c-chat-widget__empty\" style=\"padding: 24px;\">\n          <i class=\"c-chat-widget__empty-icon ti ti-message-2\"></i>\n          <div class=\"c-chat-widget__empty-text\">No messages yet. Say hello!</div>\n        </div>\n      `;\n      return;\n    }\n\n    const currentUserId = getCurrentUserId();\n\n    const html = state.messages.map(msg => {\n      const isSent = msg.sender_id === currentUserId;\n      const isDeleted = msg.is_deleted;\n\n      // Deleted message placeholder\n      if (isDeleted) {\n        return `\n          <div class=\"c-chat-widget__message c-chat-widget__message--${isSent ? 'sent' : 'received'} c-chat-widget__message--deleted\"\n               data-message-id=\"${msg.id}\">\n            <div class=\"c-chat-widget__message-bubble c-chat-widget__message-bubble--deleted\">\n              <i class=\"ti ti-message-off\" style=\"margin-right: 6px; opacity: 0.7;\"></i>\n              ${isSent ? 'You unsent a message' : 'This message was unsent'}\n            </div>\n            <span class=\"c-chat-widget__message-time\">\n              ${formatMessageTime(msg.created_at)}\n            </span>\n          </div>\n        `;\n      }\n\n      // Convert emoji shortcodes\n      const contentWithEmojis = convertEmojiShortcodes(escapeHtml(msg.content));\n\n      return `\n        <div class=\"c-chat-widget__message c-chat-widget__message--${isSent ? 'sent' : 'received'}\"\n             data-message-id=\"${msg.id}\"\n             data-sender-id=\"${msg.sender_id}\">\n          <div class=\"c-chat-widget__message-actions\">\n            <button class=\"c-chat-widget__message-action-btn\" data-action=\"delete-menu\" title=\"Delete message\">\n              <i class=\"ti ti-trash\"></i>\n            </button>\n          </div>\n          <div class=\"c-chat-widget__message-bubble\">\n            ${contentWithEmojis}\n          </div>\n          <span class=\"c-chat-widget__message-time\">\n            ${formatMessageTime(msg.created_at)}\n            ${isSent && msg.is_read ? '<i class=\"ti ti-checks\" style=\"margin-left: 4px; color: var(--cw-accent);\"></i>' : ''}\n          </span>\n        </div>\n      `;\n    }).join('');\n\n    elements.messagesContainer.innerHTML = html;\n  }\n\n  function handleDeleteMenuClick(element, e) {\n    e.stopPropagation();\n\n    const messageEl = element.closest('.c-chat-widget__message');\n    if (!messageEl) return;\n\n    const messageId = parseInt(messageEl.dataset.messageId);\n    const senderId = parseInt(messageEl.dataset.senderId);\n    const currentUserId = getCurrentUserId();\n    const isSent = senderId === currentUserId;\n\n    showDeleteConfirmation(messageId, isSent);\n  }\n\n  function showDeleteConfirmation(messageId, isSent) {\n    // Use SweetAlert2 if available\n    if (typeof Swal !== 'undefined') {\n      const options = {\n        title: 'Delete message?',\n        icon: 'question',\n        showCancelButton: true,\n        confirmButtonColor: 'var(--cw-danger, #ef4444)',\n        cancelButtonColor: 'var(--cw-text-secondary, #6b7280)',\n        confirmButtonText: 'Delete for me',\n        cancelButtonText: 'Cancel',\n        customClass: {\n          popup: 'c-chat-widget-swal'\n        }\n      };\n\n      // Add \"Unsend for everyone\" option if user sent the message\n      if (isSent) {\n        options.showDenyButton = true;\n        options.denyButtonText = 'Unsend for everyone';\n        options.denyButtonColor = 'var(--cw-accent, #7c3aed)';\n      }\n\n      Swal.fire(options).then((result) => {\n        if (result.isConfirmed) {\n          // Delete for me only\n          deleteMessage(messageId, 'me');\n        } else if (result.isDenied) {\n          // Unsend for everyone\n          deleteMessage(messageId, 'everyone');\n        }\n      });\n    } else {\n      // Fallback to simple confirm\n      if (confirm('Delete this message for yourself?')) {\n        deleteMessage(messageId, 'me');\n      }\n    }\n  }\n\n  async function deleteMessage(messageId, deleteFor) {\n    try {\n      let url, method;\n\n      if (deleteFor === 'everyone') {\n        url = `/api/messages/message/${messageId}`;\n        method = 'DELETE';\n      } else {\n        url = `/api/messages/message/${messageId}/hide`;\n        method = 'POST';\n      }\n\n      const response = await fetchJSON(url, { method });\n\n      if (response.success) {\n        if (deleteFor === 'everyone') {\n          // Update message in local state to show as deleted\n          const msgIndex = state.messages.findIndex(m => m.id === messageId);\n          if (msgIndex !== -1) {\n            state.messages[msgIndex].is_deleted = true;\n            state.messages[msgIndex].content = null;\n          }\n        } else {\n          // Remove from local state (hidden for me)\n          state.messages = state.messages.filter(m => m.id !== messageId);\n        }\n\n        renderMessages();\n        scrollToBottom();\n        showToast(deleteFor === 'everyone' ? 'Message unsent' : 'Message deleted', 'success');\n      } else {\n        showToast(response.error || 'Failed to delete message', 'error');\n      }\n    } catch (error) {\n      console.error('[ChatWidget] Delete message error:', error);\n      showToast('Failed to delete message', 'error');\n    }\n  }\n\n  // Emoji shortcode conversion\n  const EMOJI_MAP = {\n    ':)': '', ':-)': '', '=)': '',\n    ':(': '', ':-(': '', '=(': '',\n    ':D': '', ':-D': '', '=D': '',\n    ';)': '', ';-)': '',\n    ':P': '', ':-P': '', ':p': '',\n    ':O': '', ':-O': '', ':o': '',\n    '<3': '', '</3': '',\n    ':*': '', ':-*': '',\n    \":'(\": '', \":')\": '',\n    ':fire:': '', ':heart:': '', ':thumbsup:': '', ':thumbsdown:': '',\n    ':clap:': '', ':wave:': '', ':ok:': '', ':100:': '',\n    ':star:': '', ':sun:': '', ':moon:': '', ':soccer:': '',\n    ':trophy:': '', ':medal:': '', ':crown:': '',\n    ':check:': '', ':x:': '', ':warning:': '',\n    ':party:': '', ':confetti:': '',\n    'xD': '', 'XD': '',\n    'B)': '', 'B-)': '',\n    '-_-': '', ':|': '',\n    ':angry:': '', '>:(': '',\n    ':thinking:': '', ':shrug:': '',\n    ':pray:': '', ':muscle:': '',\n    ':eyes:': '', ':sweat:': '',\n    ':cool:': '', ':lol:': '', ':rofl:': ''\n  };\n\n  function convertEmojiShortcodes(text) {\n    if (!text) return text;\n\n    let result = text;\n    for (const [shortcode, emoji] of Object.entries(EMOJI_MAP)) {\n      // Escape special regex characters in the shortcode\n      const escaped = shortcode.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n      result = result.replace(new RegExp(escaped, 'g'), emoji);\n    }\n    return result;\n  }\n\n  function renderSearchResults() {\n    if (!elements.searchResults) {\n      console.warn('[ChatWidget] Search results element not found');\n      return;\n    }\n\n    if (state.searchResults.length === 0) {\n      console.log('[ChatWidget] No search results, hiding dropdown');\n      elements.searchResults.classList.remove('is-visible');\n      elements.searchResults.innerHTML = '';\n      return;\n    }\n\n    console.log('[ChatWidget] Rendering', state.searchResults.length, 'search results');\n    const defaultAvatar = '/static/img/default_player.png';\n\n    const html = state.searchResults.map(user => {\n      const avatarUrl = user.avatar_url || defaultAvatar;\n      const roleBadges = renderRoleBadges(user);\n      return `\n        <div class=\"c-chat-widget__search-result\"\n             data-user-id=\"${user.id}\"\n             data-user-name=\"${escapeHtml(user.name)}\"\n             data-avatar=\"${avatarUrl}\"\n             data-online=\"${user.is_online || false}\"\n             data-is-coach=\"${user.is_coach || false}\"\n             data-is-admin=\"${user.is_admin || false}\"\n             data-is-global-admin=\"${user.is_global_admin || false}\"\n             data-is-ref=\"${user.is_ref || false}\"\n             role=\"button\"\n             tabindex=\"0\">\n          <div class=\"c-chat-widget__search-result-avatar\">\n            <img src=\"${avatarUrl}\" alt=\"${escapeHtml(user.name)}\" onerror=\"this.src='${defaultAvatar}'\">\n          </div>\n          <span class=\"c-chat-widget__search-result-name\">${escapeHtml(user.name)}${roleBadges}</span>\n        </div>\n      `;\n    }).join('');\n\n    elements.searchResults.innerHTML = html;\n    elements.searchResults.classList.add('is-visible');\n    console.log('[ChatWidget] Search results dropdown visible');\n  }\n\n  function renderOnlineUsers(users) {\n    if (!elements.onlineList) return;\n\n    const onlineSection = elements.onlineList.closest('.c-chat-widget__online');\n\n    if (!users || users.length === 0) {\n      if (onlineSection) onlineSection.classList.add('u-hidden');\n      return;\n    }\n\n    if (onlineSection) onlineSection.classList.remove('u-hidden');\n\n    const defaultAvatar = '/static/img/default_player.png';\n\n    const html = users.slice(0, 8).map(user => {\n      const avatarUrl = user.avatar_url || defaultAvatar;\n      return `\n        <div class=\"c-chat-widget__online-user\"\n             data-user-id=\"${user.id}\"\n             data-user-name=\"${escapeHtml(user.name)}\"\n             data-avatar=\"${avatarUrl}\"\n             data-online=\"true\"\n             role=\"button\"\n             tabindex=\"0\">\n          <div class=\"c-chat-widget__online-avatar\">\n            <img src=\"${avatarUrl}\" alt=\"${escapeHtml(user.name)}\" onerror=\"this.src='${defaultAvatar}'\">\n          </div>\n          <span class=\"c-chat-widget__online-name\">${escapeHtml(user.name.split(' ')[0])}</span>\n        </div>\n      `;\n    }).join('');\n\n    elements.onlineList.innerHTML = html;\n  }\n\n  function updateBadge() {\n    if (!elements.badge) return;\n\n    if (state.unreadCount > 0) {\n      elements.badge.textContent = state.unreadCount > 99 ? '99+' : state.unreadCount;\n      elements.badge.dataset.count = state.unreadCount;\n      elements.badge.style.display = '';\n    } else {\n      elements.badge.style.display = 'none';\n      elements.badge.dataset.count = '0';\n    }\n\n    // Also update navbar badge if it exists\n    const navbarBadge = document.querySelector('[data-badge=\"messages-count\"]');\n    if (navbarBadge) {\n      navbarBadge.textContent = state.unreadCount > 99 ? '99+' : state.unreadCount;\n      navbarBadge.classList.toggle('u-hidden', state.unreadCount === 0);\n    }\n  }\n\n  function updateSendButton() {\n    if (!elements.sendBtn || !elements.composerInput) return;\n\n    const hasContent = elements.composerInput.value.trim().length > 0;\n    elements.sendBtn.disabled = !hasContent;\n  }\n\n  // ============================================================================\n  // VIEW MANAGEMENT\n  // ============================================================================\n\n  function openWidget() {\n    if (!elements.widget) return;\n\n    state.isOpen = true;\n    elements.widget.dataset.state = 'open';\n\n    // Lock body scroll on mobile - cross-browser compatible approach\n    if (window.innerWidth <= 767) {\n      // Save scroll position\n      const scrollY = window.scrollY || window.pageYOffset || document.documentElement.scrollTop;\n      document.body.dataset.chatScrollY = scrollY;\n\n      // Add class for CSS-based scroll lock\n      document.documentElement.classList.add('chat-widget-open');\n      document.body.classList.add('chat-widget-open');\n\n      // iOS Safari fix: set body top to preserve visual scroll position\n      document.body.style.top = `-${scrollY}px`;\n    }\n\n    // Load initial data\n    loadConversations();\n    loadUnreadCount();\n\n    // Join messaging room\n    joinMessagingRoom();\n\n    // Focus search on desktop\n    if (window.innerWidth > 575 && elements.searchInput) {\n      setTimeout(() => elements.searchInput.focus(), CONFIG.ui.animationDuration);\n    }\n  }\n\n  function closeWidget() {\n    if (!elements.widget) return;\n\n    state.isOpen = false;\n    state.currentView = 'list';\n    state.activeConversation = null;\n    state.messages = [];\n    elements.widget.dataset.state = 'closed';\n    elements.widget.dataset.view = 'list';\n\n    // Unlock body scroll on mobile - cross-browser compatible\n    document.documentElement.classList.remove('chat-widget-open');\n    document.body.classList.remove('chat-widget-open');\n    document.body.style.top = '';\n\n    if (document.body.dataset.chatScrollY !== undefined) {\n      const scrollY = parseInt(document.body.dataset.chatScrollY || '0', 10);\n      delete document.body.dataset.chatScrollY;\n      // Restore scroll position after removing fixed positioning\n      window.scrollTo(0, scrollY);\n    }\n\n    // Clear search state\n    clearSearch();\n  }\n\n  function toggleWidget() {\n    if (state.isOpen) {\n      closeWidget();\n    } else {\n      openWidget();\n    }\n  }\n\n  function openConversation(userId, userName, avatarUrl, isOnline, roleInfo) {\n    state.currentView = 'chat';\n    state.activeConversation = {\n      id: parseInt(userId),\n      name: userName,\n      avatar: avatarUrl,\n      isOnline: isOnline === 'true' || isOnline === true,\n      roles: roleInfo || {}\n    };\n\n    if (elements.widget) {\n      elements.widget.dataset.view = 'chat';\n    }\n\n    // Update chat header\n    const defaultAvatar = '/static/img/default_player.png';\n\n    if (elements.chatAvatar) {\n      elements.chatAvatar.src = avatarUrl || defaultAvatar;\n      elements.chatAvatar.onerror = function() { this.src = defaultAvatar; };\n    }\n    if (elements.chatName) {\n      // Display name with role badges\n      const roleBadges = renderRoleBadges(roleInfo);\n      elements.chatName.innerHTML = escapeHtml(userName) + roleBadges;\n    }\n    if (elements.chatStatus) {\n      elements.chatStatus.textContent = state.activeConversation.isOnline ? 'Online' : 'Offline';\n      elements.chatStatus.classList.toggle('c-chat-widget__chat-status--offline', !state.activeConversation.isOnline);\n    }\n\n    // Update avatar online status\n    if (elements.chatAvatarContainer) {\n      elements.chatAvatarContainer.classList.toggle('c-chat-widget__chat-avatar--online', state.activeConversation.isOnline);\n    }\n\n    // Clear messages and show loading\n    if (elements.messagesContainer) {\n      elements.messagesContainer.innerHTML = `\n        <div style=\"display: flex; justify-content: center; padding: 40px;\">\n          <div class=\"c-chat-widget__typing-dots\">\n            <span class=\"c-chat-widget__typing-dot\"></span>\n            <span class=\"c-chat-widget__typing-dot\"></span>\n            <span class=\"c-chat-widget__typing-dot\"></span>\n          </div>\n        </div>\n      `;\n    }\n\n    // Load messages\n    loadMessages(userId);\n\n    // Focus composer\n    if (elements.composerInput) {\n      setTimeout(() => elements.composerInput.focus(), CONFIG.ui.animationDuration);\n    }\n  }\n\n  function closeConversation() {\n    state.currentView = 'list';\n    state.activeConversation = null;\n    state.messages = [];\n\n    if (elements.widget) {\n      elements.widget.dataset.view = 'list';\n    }\n\n    // Clear search state when going back\n    clearSearch();\n\n    // Refresh conversations\n    loadConversations();\n  }\n\n  function scrollToBottom() {\n    if (elements.messagesContainer) {\n      requestAnimationFrame(() => {\n        elements.messagesContainer.scrollTop = elements.messagesContainer.scrollHeight;\n      });\n    }\n  }\n\n  // ============================================================================\n  // EVENT HANDLERS\n  // ============================================================================\n\n  function handleTriggerClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    toggleWidget();\n  }\n\n  function handleConversationClick(e) {\n    const conversation = e.target.closest('.c-chat-widget__conversation, .c-chat-widget__online-user, .c-chat-widget__search-result');\n    if (!conversation) return;\n\n    const userId = conversation.dataset.userId;\n    const userName = conversation.dataset.userName;\n    const avatarUrl = conversation.dataset.avatar;\n    const isOnline = conversation.dataset.online;\n\n    // Get role info from data attributes (or from state for conversations)\n    const roleInfo = {\n      is_coach: conversation.dataset.isCoach === 'true',\n      is_admin: conversation.dataset.isAdmin === 'true',\n      is_global_admin: conversation.dataset.isGlobalAdmin === 'true',\n      is_ref: conversation.dataset.isRef === 'true'\n    };\n\n    openConversation(userId, userName, avatarUrl, isOnline, roleInfo);\n\n    // Clear search state completely\n    clearSearch();\n  }\n\n  function clearSearch() {\n    state.searchQuery = '';\n    state.searchResults = [];\n    if (elements.searchInput) {\n      elements.searchInput.value = '';\n    }\n    if (elements.searchResults) {\n      elements.searchResults.classList.remove('is-visible');\n      elements.searchResults.innerHTML = '';\n    }\n  }\n\n  function handleBackClick(e) {\n    e.preventDefault();\n    closeConversation();\n  }\n\n  function handleSendClick(e) {\n    e.preventDefault();\n    if (!state.activeConversation || !elements.composerInput) return;\n\n    const content = elements.composerInput.value.trim();\n    if (!content) return;\n\n    sendMessage(state.activeConversation.id, content);\n  }\n\n  function handleComposerKeydown(e) {\n    // Send on Enter (without Shift)\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendClick(e);\n      return;\n    }\n\n    // Emit typing indicator\n    emitTypingStart();\n  }\n\n  function handleComposerInput() {\n    updateSendButton();\n    autoResizeTextarea(elements.composerInput);\n  }\n\n  let searchDebounceTimer = null;\n  function handleSearchInput(e) {\n    const query = e.target.value.trim();\n    state.searchQuery = query;\n    console.log('[ChatWidget] Search input:', query);\n\n    clearTimeout(searchDebounceTimer);\n    searchDebounceTimer = setTimeout(() => {\n      searchUsers(query);\n    }, CONFIG.ui.searchDebounce);\n  }\n\n  function handleSearchFocus() {\n    if (state.searchResults.length > 0 && elements.searchResults) {\n      elements.searchResults.classList.add('is-visible');\n    }\n  }\n\n  function handleSearchBlur() {\n    // Delay hiding to allow click on results\n    setTimeout(() => {\n      if (elements.searchResults) {\n        elements.searchResults.classList.remove('is-visible');\n      }\n    }, 200);\n  }\n\n  function handleKeydown(e) {\n    // Close on Escape\n    if (e.key === 'Escape') {\n      if (state.currentView === 'chat') {\n        closeConversation();\n      } else if (state.isOpen) {\n        closeWidget();\n      }\n    }\n  }\n\n  function handleClickOutside(e) {\n    if (!elements.widget || !state.isOpen) return;\n\n    // Don't close if clicking inside widget\n    if (elements.widget.contains(e.target)) return;\n\n    // Don't close on mobile (full screen)\n    if (window.innerWidth <= 575) return;\n\n    closeWidget();\n  }\n\n  // ============================================================================\n  // WEBSOCKET INTEGRATION\n  // ============================================================================\n\n  let socket = null;\n\n  function initWebSocket() {\n    // Use SocketManager if available (preferred method)\n    if (typeof window.SocketManager !== 'undefined') {\n      console.log('[ChatWidget] Using SocketManager');\n\n      // Get socket reference\n      socket = window.SocketManager.getSocket();\n\n      // Register connect callback - fires immediately if already connected\n      window.SocketManager.onConnect('ChatWidget', function(connectedSocket) {\n        socket = connectedSocket;\n        console.log('[ChatWidget] Socket connected via SocketManager');\n        // Join messaging room when connected\n        if (state.isOpen) {\n          joinMessagingRoom();\n        }\n      });\n\n      // Register disconnect callback\n      window.SocketManager.onDisconnect('ChatWidget', function(reason) {\n        console.log('[ChatWidget] Socket disconnected:', reason);\n      });\n\n      // Attach event listeners via SocketManager\n      attachSocketListeners();\n      return;\n    }\n\n    // Fallback: Check if Socket.IO is available\n    if (typeof io === 'undefined') {\n      console.warn('[ChatWidget] Socket.IO not available, using polling');\n      if (CONFIG.polling.enabled) {\n        setInterval(loadUnreadCount, CONFIG.polling.interval);\n      }\n      return;\n    }\n\n    // Fallback: Use existing socket or create new one\n    const checkSocket = () => {\n      if (window.socket && window.socket.connected) {\n        socket = window.socket;\n        attachSocketListenersDirect();\n      } else if (window.socket) {\n        // Socket exists but not connected - wait for connect event\n        socket = window.socket;\n        socket.once('connect', () => {\n          attachSocketListenersDirect();\n        });\n      } else {\n        // Try again in a second\n        setTimeout(checkSocket, 1000);\n      }\n    };\n\n    checkSocket();\n  }\n\n  function attachSocketListeners() {\n    // Use SocketManager for event registration (handles reconnects properly)\n    if (typeof window.SocketManager !== 'undefined') {\n      // Message events\n      window.SocketManager.on('ChatWidget', 'new_message', handleNewMessage);\n      window.SocketManager.on('ChatWidget', 'dm_sent', handleMessageSent);\n      window.SocketManager.on('ChatWidget', 'dm_error', handleMessageError);\n      window.SocketManager.on('ChatWidget', 'dm_unread_update', handleUnreadUpdate);\n      window.SocketManager.on('ChatWidget', 'message_deleted', handleMessageDeleted);\n\n      // Typing events\n      window.SocketManager.on('ChatWidget', 'user_typing', handleUserTyping);\n\n      // Read receipts\n      window.SocketManager.on('ChatWidget', 'messages_read', handleMessagesRead);\n\n      // Presence events\n      window.SocketManager.on('ChatWidget', 'user_online', handleUserOnline);\n      window.SocketManager.on('ChatWidget', 'user_offline', handleUserOffline);\n      window.SocketManager.on('ChatWidget', 'online_users', handleOnlineUsers);\n\n      console.log('[ChatWidget] Socket listeners attached via SocketManager');\n      return;\n    }\n\n    // Fallback to direct attachment\n    attachSocketListenersDirect();\n  }\n\n  function attachSocketListenersDirect() {\n    if (!socket) return;\n\n    // Message events\n    socket.on('new_message', handleNewMessage);\n    socket.on('dm_sent', handleMessageSent);\n    socket.on('dm_error', handleMessageError);\n    socket.on('dm_unread_update', handleUnreadUpdate);\n    socket.on('message_deleted', handleMessageDeleted);\n\n    // Typing events\n    socket.on('user_typing', handleUserTyping);\n\n    // Read receipts\n    socket.on('messages_read', handleMessagesRead);\n\n    // Presence events\n    socket.on('user_online', handleUserOnline);\n    socket.on('user_offline', handleUserOffline);\n    socket.on('online_users', handleOnlineUsers);\n\n    console.log('[ChatWidget] Socket listeners attached (direct)');\n  }\n\n  function handleMessageDeleted(data) {\n    const messageId = data.message_id;\n    const deletedFor = data.deleted_for;\n\n    // Find message in local state\n    const msgIndex = state.messages.findIndex(m => m.id === messageId);\n\n    if (msgIndex !== -1) {\n      if (deletedFor === 'everyone') {\n        // Mark as unsent (show placeholder)\n        state.messages[msgIndex].is_deleted = true;\n        state.messages[msgIndex].content = null;\n        renderMessages();\n      }\n      // Note: 'delete for me' by the other user doesn't affect our view\n    }\n  }\n\n  function joinMessagingRoom() {\n    // Use SocketManager if available\n    if (typeof window.SocketManager !== 'undefined') {\n      if (window.SocketManager.isConnected()) {\n        window.SocketManager.emit('join_messaging');\n      }\n      return;\n    }\n\n    // Fallback\n    if (socket && socket.connected) {\n      socket.emit('join_messaging');\n    }\n  }\n\n  function handleNewMessage(message) {\n    // Update unread count\n    state.unreadCount++;\n    updateBadge();\n\n    // If in active conversation with sender, add message\n    if (state.activeConversation && message.sender_id === state.activeConversation.id) {\n      state.messages.push(message);\n      renderMessages();\n      scrollToBottom();\n\n      // Mark as read\n      if (typeof window.SocketManager !== 'undefined') {\n        window.SocketManager.emit('mark_dm_read', { sender_id: message.sender_id });\n      } else if (socket) {\n        socket.emit('mark_dm_read', { sender_id: message.sender_id });\n      }\n    }\n\n    // Refresh conversation list\n    loadConversations();\n\n    // Show notification if widget is closed\n    if (!state.isOpen) {\n      showNotification(message.sender_name, message.content);\n    }\n  }\n\n  function handleMessageSent(data) {\n    // Message already added locally, just confirm\n    console.log('[ChatWidget] Message sent:', data.message?.id);\n  }\n\n  function handleMessageError(data) {\n    showToast(data.error || 'Failed to send message', 'error');\n  }\n\n  function handleUnreadUpdate(data) {\n    state.unreadCount = data.count;\n    updateBadge();\n  }\n\n  function handleUserTyping(data) {\n    if (!state.activeConversation || data.user_id !== state.activeConversation.id) return;\n\n    if (data.typing) {\n      showTypingIndicator();\n    } else {\n      hideTypingIndicator();\n    }\n  }\n\n  function handleMessagesRead(data) {\n    // Update read receipts in UI\n    if (state.activeConversation && data.reader_id === state.activeConversation.id) {\n      state.messages.forEach(msg => {\n        if (msg.sender_id !== data.reader_id) {\n          msg.is_read = true;\n        }\n      });\n      renderMessages();\n    }\n  }\n\n  function handleUserOnline(data) {\n    // Update online status in conversation list\n    updateUserOnlineStatus(data.user_id, true);\n\n    // Update active conversation\n    if (state.activeConversation?.id === data.user_id) {\n      state.activeConversation.isOnline = true;\n      if (elements.chatStatus) {\n        elements.chatStatus.textContent = 'Online';\n        elements.chatStatus.classList.remove('c-chat-widget__chat-status--offline');\n      }\n      if (elements.chatAvatarContainer) {\n        elements.chatAvatarContainer.classList.add('c-chat-widget__chat-avatar--online');\n      }\n    }\n  }\n\n  function handleUserOffline(data) {\n    updateUserOnlineStatus(data.user_id, false);\n\n    if (state.activeConversation?.id === data.user_id) {\n      state.activeConversation.isOnline = false;\n      if (elements.chatStatus) {\n        elements.chatStatus.textContent = 'Offline';\n        elements.chatStatus.classList.add('c-chat-widget__chat-status--offline');\n      }\n      if (elements.chatAvatarContainer) {\n        elements.chatAvatarContainer.classList.remove('c-chat-widget__chat-avatar--online');\n      }\n    }\n  }\n\n  function handleOnlineUsers(data) {\n    state.onlineUsers = data.users || [];\n    renderOnlineUsers(state.onlineUsers);\n  }\n\n  function updateUserOnlineStatus(userId, isOnline) {\n    const convElements = document.querySelectorAll(`[data-user-id=\"${userId}\"]`);\n    convElements.forEach(el => {\n      el.dataset.online = isOnline;\n      const avatar = el.querySelector('.c-chat-widget__conv-avatar, .c-chat-widget__online-avatar');\n      if (avatar) {\n        avatar.classList.toggle('c-chat-widget__conv-avatar--online', isOnline);\n      }\n    });\n  }\n\n  // ============================================================================\n  // TYPING INDICATOR\n  // ============================================================================\n\n  function emitTypingStart() {\n    if (!state.activeConversation || !state.settings.typingIndicators) return;\n\n    // Check if we can emit\n    const canEmit = (typeof window.SocketManager !== 'undefined' && window.SocketManager.isConnected()) ||\n                    (socket && socket.connected);\n    if (!canEmit) return;\n\n    if (!state.isTyping) {\n      state.isTyping = true;\n      if (typeof window.SocketManager !== 'undefined') {\n        window.SocketManager.emit('typing_start', { recipient_id: state.activeConversation.id });\n      } else if (socket) {\n        socket.emit('typing_start', { recipient_id: state.activeConversation.id });\n      }\n    }\n\n    // Reset timeout\n    clearTimeout(state.typingTimeout);\n    state.typingTimeout = setTimeout(() => {\n      state.isTyping = false;\n      if (typeof window.SocketManager !== 'undefined') {\n        window.SocketManager.emit('typing_stop', { recipient_id: state.activeConversation.id });\n      } else if (socket) {\n        socket.emit('typing_stop', { recipient_id: state.activeConversation.id });\n      }\n    }, CONFIG.ui.typingDebounce);\n  }\n\n  function showTypingIndicator() {\n    if (elements.typingIndicator) {\n      elements.typingIndicator.style.display = 'flex';\n      scrollToBottom();\n    }\n  }\n\n  function hideTypingIndicator() {\n    if (elements.typingIndicator) {\n      elements.typingIndicator.style.display = 'none';\n    }\n  }\n\n  // ============================================================================\n  // UTILITIES\n  // ============================================================================\n\n  function escapeHtml(text) {\n    if (!text) return '';\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  function formatMessageTime(isoString) {\n    if (!isoString) return '';\n\n    const date = new Date(isoString);\n    const now = new Date();\n    const diff = now - date;\n\n    // Today: show time\n    if (diff < 86400000 && date.getDate() === now.getDate()) {\n      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    }\n\n    // Yesterday\n    if (diff < 172800000) {\n      return 'Yesterday';\n    }\n\n    // This week: show day name\n    if (diff < 604800000) {\n      return date.toLocaleDateString([], { weekday: 'short' });\n    }\n\n    // Older: show date\n    return date.toLocaleDateString([], { month: 'short', day: 'numeric' });\n  }\n\n  function getCurrentUserId() {\n    // Try to get from global or meta tag\n    if (window.currentUserId) return parseInt(window.currentUserId);\n\n    const meta = document.querySelector('meta[name=\"user-id\"]');\n    if (meta) return parseInt(meta.content);\n\n    // Try from session data\n    const sessionData = document.querySelector('[data-user-id]');\n    if (sessionData) return parseInt(sessionData.dataset.userId);\n\n    return null;\n  }\n\n  function autoResizeTextarea(textarea) {\n    if (!textarea) return;\n\n    textarea.style.height = 'auto';\n    textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';\n  }\n\n  function showToast(message, type = 'info') {\n    // Use SweetAlert2 if available, otherwise console\n    if (typeof Swal !== 'undefined') {\n      Swal.fire({\n        toast: true,\n        position: 'top-end',\n        icon: type,\n        title: message,\n        showConfirmButton: false,\n        timer: 3000,\n        timerProgressBar: true\n      });\n    } else {\n      console.log(`[ChatWidget] ${type}: ${message}`);\n    }\n  }\n\n  function showNotification(title, body) {\n    // Browser notification if permitted\n    if ('Notification' in window && Notification.permission === 'granted') {\n      new Notification(title, {\n        body: body.length > 50 ? body.substring(0, 50) + '...' : body,\n        icon: '/static/images/logo-icon.png',\n        tag: 'chat-message'\n      });\n    }\n  }\n\n  // ============================================================================\n  // SMART POSITIONING\n  // ============================================================================\n\n  function updatePosition() {\n    if (!elements.widget) return;\n\n    // Check for mobile bottom nav\n    const mobileNav = document.querySelector('.mobile-bottom-nav, .c-mobile-nav, [data-mobile-nav]');\n    if (mobileNav) {\n      const navHeight = mobileNav.offsetHeight;\n      document.documentElement.style.setProperty('--mobile-nav-height', `${navHeight}px`);\n    }\n  }\n\n  // ============================================================================\n  // EVENT DELEGATION REGISTRATION\n  // ============================================================================\n\n  function registerEventHandlers() {\n    // Register delete-menu action via EventDelegation\n    if (typeof EventDelegation !== 'undefined') {\n      EventDelegation.register('delete-menu', handleDeleteMenuClick, {\n        preventDefault: true\n      });\n    }\n  }\n\n  // ============================================================================\n  // INITIALIZATION\n  // ============================================================================\n\n  function bindEvents() {\n    // Trigger button\n    if (elements.trigger) {\n      elements.trigger.addEventListener('click', handleTriggerClick);\n    }\n\n    // Close buttons (both list view and chat view)\n    if (elements.closeBtns) {\n      elements.closeBtns.forEach(btn => {\n        btn.addEventListener('click', closeWidget);\n      });\n    }\n\n    // Conversation clicks (event delegation)\n    if (elements.conversationList) {\n      elements.conversationList.addEventListener('click', handleConversationClick);\n    }\n    if (elements.onlineList) {\n      elements.onlineList.addEventListener('click', handleConversationClick);\n    }\n    if (elements.searchResults) {\n      elements.searchResults.addEventListener('click', handleConversationClick);\n    }\n\n    // Back button\n    if (elements.backBtn) {\n      elements.backBtn.addEventListener('click', handleBackClick);\n    }\n\n    // Send button\n    if (elements.sendBtn) {\n      elements.sendBtn.addEventListener('click', handleSendClick);\n    }\n\n    // Composer\n    if (elements.composerInput) {\n      elements.composerInput.addEventListener('keydown', handleComposerKeydown);\n      elements.composerInput.addEventListener('input', handleComposerInput);\n\n      // iOS Safari fix: ensure textarea is focusable on tap\n      elements.composerInput.addEventListener('touchstart', function(e) {\n        // Don't prevent default - allow normal touch behavior\n        // Just ensure element can receive focus\n        this.style.pointerEvents = 'auto';\n      }, { passive: true });\n\n      // Ensure focus works on click (fallback for all browsers)\n      elements.composerInput.addEventListener('click', function(e) {\n        e.stopPropagation();\n        this.focus();\n      });\n    }\n\n    // Search\n    if (elements.searchInput) {\n      console.log('[ChatWidget] Search input found, binding events');\n      elements.searchInput.addEventListener('input', handleSearchInput);\n      elements.searchInput.addEventListener('focus', handleSearchFocus);\n      elements.searchInput.addEventListener('blur', handleSearchBlur);\n    } else {\n      console.warn('[ChatWidget] Search input not found!');\n    }\n\n    // Global events\n    document.addEventListener('keydown', handleKeydown);\n    document.addEventListener('click', handleClickOutside);\n\n    // Window resize\n    window.addEventListener('resize', updatePosition);\n\n    // Open inbox button\n    if (elements.openInboxBtn) {\n      elements.openInboxBtn.addEventListener('click', () => {\n        window.location.href = '/messages';\n      });\n    }\n\n    // New chat button (focus search)\n    if (elements.newChatBtn) {\n      elements.newChatBtn.addEventListener('click', () => {\n        if (state.currentView === 'chat') {\n          closeConversation();\n        }\n        if (elements.searchInput) {\n          elements.searchInput.focus();\n        }\n      });\n    }\n  }\n\n  function init() {\n    // Page guard - only initialize if chat widget exists on page\n    // This must be checked after DOMContentLoaded when the element exists\n    if (!document.querySelector('.c-chat-widget')) {\n      console.log('[ChatWidget] No widget element found, skipping initialization');\n      return;\n    }\n\n    cacheElements();\n    registerEventHandlers();\n    bindEvents();\n    initWebSocket();\n    updatePosition();\n\n    // Load initial unread count\n    loadUnreadCount();\n\n    // Polling fallback\n    if (CONFIG.polling.enabled) {\n      setInterval(loadUnreadCount, CONFIG.polling.interval);\n    }\n\n    console.log('[ChatWidget] Initialized');\n  }\n\n  // Initialize when DOM is ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n\n  // Expose to global for external access\n  window.ChatWidget = {\n    open: openWidget,\n    close: closeWidget,\n    toggle: toggleWidget,\n    openConversation: openConversation,\n    refresh: loadConversations,\n    getUnreadCount: () => state.unreadCount\n  };\n\n})();\n","/**\n * ============================================================================\n * MESSENGER WIDGET - Unified Sidebar Messaging Component\n * ============================================================================\n *\n * Facebook Messenger-style sidebar widget combining:\n * - Online users display\n * - Conversation list\n * - Real-time chat interface\n * - User search\n * - Message management (read, send, delete)\n *\n * Dependencies:\n * - Socket.IO (for real-time features)\n * - Bootstrap 5 (optional, for modals)\n *\n * ============================================================================\n */\n\n(function() {\n  'use strict';\n\n  class MessengerWidget {\n    constructor() {\n      this.widget = null;\n      this.currentUserId = null;\n      this.currentUserName = '';\n      this.conversations = [];\n      this.messages = [];\n      this.onlineUsers = [];\n      this.unreadCount = 0;\n      this.typingTimeout = null;\n      this.socket = null;\n      this.refreshIntervals = {};\n    }\n\n    /**\n     * Initialize the messenger widget\n     */\n    init() {\n      this.widget = document.querySelector('[data-component=\"messenger-widget\"]');\n      if (!this.widget) return;\n\n      this.bindEvents();\n      this.setupWebSocket();\n      this.loadOnlineUsers();\n      this.loadConversations();\n      this.loadUnreadCount();\n\n      // Set up periodic refreshes\n      this.refreshIntervals.online = setInterval(() => this.loadOnlineUsers(), 30000);\n      this.refreshIntervals.unread = setInterval(() => this.loadUnreadCount(), 60000);\n\n      console.log('[Messenger] Initialized');\n    }\n\n    /**\n     * Get CSRF token\n     */\n    getCSRFToken() {\n      const meta = document.querySelector('meta[name=\"csrf-token\"]');\n      return meta ? meta.getAttribute('content') : '';\n    }\n\n    /**\n     * Bind DOM events using event delegation\n     */\n    bindEvents() {\n      // Event delegation for all actions\n      this.widget.addEventListener('click', (e) => {\n        const action = e.target.closest('[data-action]');\n        if (action) {\n          e.preventDefault();\n          this.handleAction(action.dataset.action, action);\n        }\n\n        // Conversation click\n        const conv = e.target.closest('[data-conversation-id]');\n        if (conv && !action) {\n          e.preventDefault();\n          const userId = parseInt(conv.dataset.conversationId, 10);\n          this.openConversation(userId);\n        }\n\n        // Online user click\n        const onlineUser = e.target.closest('[data-online-user-id]');\n        if (onlineUser && !action) {\n          e.preventDefault();\n          const userId = parseInt(onlineUser.dataset.onlineUserId, 10);\n          this.openConversation(userId);\n        }\n      });\n\n      // Search input\n      const searchInput = this.widget.querySelector('[data-input=\"search\"]');\n      if (searchInput) {\n        searchInput.addEventListener('input', (e) => this.handleSearch(e.target.value));\n      }\n\n      // Message input\n      const msgInput = this.widget.querySelector('[data-input=\"message\"]');\n      if (msgInput) {\n        msgInput.addEventListener('keydown', (e) => {\n          if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            this.sendMessage();\n          }\n        });\n        msgInput.addEventListener('input', () => this.handleTyping());\n\n        // Auto-resize textarea\n        msgInput.addEventListener('input', () => {\n          msgInput.style.height = 'auto';\n          msgInput.style.height = Math.min(msgInput.scrollHeight, 100) + 'px';\n        });\n      }\n\n      // Close on escape when chatting\n      document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape' && this.widget.classList.contains('is-chatting')) {\n          this.showList();\n        }\n      });\n    }\n\n    /**\n     * Handle action buttons\n     */\n    handleAction(action, element) {\n      switch (action) {\n        case 'back':\n          this.showList();\n          break;\n        case 'new-chat':\n          this.focusSearch();\n          break;\n        case 'send-message':\n          this.sendMessage();\n          break;\n        case 'delete-message':\n          const msgId = element.closest('[data-message-id]')?.dataset.messageId;\n          if (msgId) this.deleteMessage(parseInt(msgId, 10));\n          break;\n        case 'open-messages':\n          window.location.href = '/messages';\n          break;\n      }\n    }\n\n    /**\n     * Setup WebSocket connection\n     */\n    setupWebSocket() {\n      if (typeof io === 'undefined') return;\n\n      const checkSocket = () => {\n        if (window.socket && window.socket.connected) {\n          this.socket = window.socket;\n          this.attachSocketListeners();\n        } else {\n          setTimeout(checkSocket, 1000);\n        }\n      };\n      checkSocket();\n    }\n\n    /**\n     * Attach WebSocket event listeners\n     */\n    attachSocketListeners() {\n      if (!this.socket) return;\n\n      this.socket.on('new_message', (data) => this.handleNewMessage(data));\n      this.socket.on('user_typing', (data) => this.handleTypingIndicator(data));\n      this.socket.on('messages_read', (data) => this.handleMessagesRead(data));\n      this.socket.on('dm_sent', (data) => {\n        if (data.message) this.appendMessage(data.message);\n      });\n      this.socket.on('dm_error', (data) => {\n        this.showToast(data.error || 'Failed to send message', 'error');\n      });\n      this.socket.on('user_online', () => this.loadOnlineUsers());\n      this.socket.on('user_offline', () => this.loadOnlineUsers());\n      this.socket.on('message_deleted', (data) => this.handleMessageDeleted(data));\n    }\n\n    // ========================================================================\n    // ONLINE USERS\n    // ========================================================================\n\n    /**\n     * Load online users\n     */\n    async loadOnlineUsers() {\n      try {\n        const response = await fetch('/api/notifications/presence/online-users?details=true&limit=8');\n        const data = await response.json();\n\n        if (data.success) {\n          this.onlineUsers = data.online_users || [];\n          this.renderOnlineUsers();\n          this.updateOnlineCount(data.count || this.onlineUsers.length);\n        }\n      } catch (error) {\n        console.warn('[Messenger] Failed to load online users:', error);\n      }\n    }\n\n    /**\n     * Render online users\n     */\n    renderOnlineUsers() {\n      const list = this.widget.querySelector('[data-online-list]');\n      if (!list) return;\n\n      list.innerHTML = '';\n\n      if (this.onlineUsers.length === 0) {\n        list.innerHTML = '<span class=\"c-messenger__online-empty\">No one online</span>';\n        return;\n      }\n\n      this.onlineUsers.forEach(user => {\n        const el = document.createElement('div');\n        el.className = 'c-messenger__online-user';\n        el.dataset.onlineUserId = user.id;\n        el.title = `Chat with ${user.name}`;\n\n        const avatarUrl = user.avatar_url || '/static/img/default_player.png';\n\n        el.innerHTML = `\n          <div class=\"c-messenger__online-avatar\">\n            <img src=\"${avatarUrl}\" alt=\"${user.name}\" class=\"c-messenger__online-avatar-img\"\n                 onerror=\"this.src='/static/img/default_player.png'\">\n            <span class=\"c-online-status c-online-status--sm is-online\"></span>\n          </div>\n          <span class=\"c-messenger__online-name\">${user.name.split(' ')[0]}</span>\n        `;\n\n        list.appendChild(el);\n      });\n    }\n\n    /**\n     * Update online count display\n     */\n    updateOnlineCount(count) {\n      const countEl = this.widget.querySelector('[data-online-count]');\n      if (countEl) {\n        countEl.textContent = count;\n      }\n    }\n\n    // ========================================================================\n    // CONVERSATIONS\n    // ========================================================================\n\n    /**\n     * Load conversations list\n     */\n    async loadConversations() {\n      const list = this.widget.querySelector('[data-conversation-list]');\n      const loading = this.widget.querySelector('[data-state=\"loading\"]');\n      const empty = this.widget.querySelector('[data-state=\"empty\"]');\n\n      if (loading) loading.classList.remove('u-hidden');\n      if (empty) empty.classList.add('u-hidden');\n\n      try {\n        const response = await fetch('/api/messages');\n        const data = await response.json();\n\n        if (loading) loading.classList.add('u-hidden');\n\n        if (data.success) {\n          this.conversations = data.conversations || [];\n          this.renderConversations();\n        }\n      } catch (error) {\n        console.error('[Messenger] Failed to load conversations:', error);\n        if (loading) loading.classList.add('u-hidden');\n      }\n    }\n\n    /**\n     * Render conversations list\n     */\n    renderConversations() {\n      const list = this.widget.querySelector('[data-conversation-list]');\n      const empty = this.widget.querySelector('[data-state=\"empty\"]');\n      if (!list) return;\n\n      // Clear existing\n      const items = list.querySelectorAll('.c-messenger__conversation');\n      items.forEach(item => item.remove());\n\n      if (this.conversations.length === 0) {\n        if (empty) empty.classList.remove('u-hidden');\n        return;\n      }\n\n      if (empty) empty.classList.add('u-hidden');\n\n      this.conversations.forEach(conv => {\n        const item = document.createElement('div');\n        item.className = 'c-messenger__conversation';\n        if (conv.unread_count > 0) item.classList.add('is-unread');\n        item.dataset.conversationId = conv.user.id;\n\n        const avatarUrl = conv.user.avatar_url || '/static/img/default_player.png';\n        const onlineClass = conv.user.is_online ? 'is-online' : 'is-offline';\n        const preview = conv.last_message\n          ? `${conv.last_message.sent_by_me ? 'You: ' : ''}${conv.last_message.content}`\n          : 'No messages yet';\n\n        item.innerHTML = `\n          <div class=\"c-messenger__conversation-avatar\">\n            <img src=\"${avatarUrl}\" alt=\"${conv.user.name}\"\n                 class=\"c-messenger__conversation-avatar-img\"\n                 onerror=\"this.src='/static/img/default_player.png'\">\n            <span class=\"c-online-status c-online-status--sm ${onlineClass}\"\n                  data-online-status=\"${conv.user.id}\"></span>\n          </div>\n          <div class=\"c-messenger__conversation-body\">\n            <p class=\"c-messenger__conversation-name\">${conv.user.name}</p>\n            <p class=\"c-messenger__conversation-preview\">${this.escapeHtml(preview)}</p>\n          </div>\n          <div class=\"c-messenger__conversation-meta\">\n            ${conv.last_message ? `<span class=\"c-messenger__conversation-time\">${conv.last_message.time_ago}</span>` : ''}\n            ${conv.unread_count > 0 ? `<span class=\"c-messenger__conversation-unread\">${conv.unread_count}</span>` : ''}\n          </div>\n        `;\n\n        list.appendChild(item);\n      });\n    }\n\n    /**\n     * Open a conversation\n     */\n    async openConversation(userId) {\n      this.currentUserId = userId;\n      this.widget.classList.add('is-chatting');\n\n      // Update header\n      const user = this.onlineUsers.find(u => u.id === userId)\n        || this.conversations.find(c => c.user.id === userId)?.user;\n\n      if (user) {\n        this.currentUserName = user.name;\n        const headerTitle = this.widget.querySelector('[data-header-title] span');\n        if (headerTitle) headerTitle.textContent = user.name;\n      }\n\n      // Load messages\n      await this.loadMessages(userId);\n\n      // Focus input\n      const input = this.widget.querySelector('[data-input=\"message\"]');\n      if (input) input.focus();\n    }\n\n    // ========================================================================\n    // MESSAGES\n    // ========================================================================\n\n    /**\n     * Load messages for a conversation\n     */\n    async loadMessages(userId) {\n      const container = this.widget.querySelector('[data-messages]');\n      if (!container) return;\n\n      container.innerHTML = '<div class=\"c-messenger__loading\"><div class=\"c-messenger__loading-spinner\"></div></div>';\n\n      try {\n        const response = await fetch(`/api/messages/${userId}`);\n        const data = await response.json();\n\n        if (data.success) {\n          this.messages = data.messages || [];\n          this.renderMessages(container);\n          this.scrollToBottom(container);\n          this.loadUnreadCount();\n        }\n      } catch (error) {\n        console.error('[Messenger] Failed to load messages:', error);\n        container.innerHTML = '<p class=\"c-messenger__empty\">Failed to load messages</p>';\n      }\n    }\n\n    /**\n     * Render messages\n     */\n    renderMessages(container) {\n      if (!container) return;\n      container.innerHTML = '';\n\n      if (this.messages.length === 0) {\n        container.innerHTML = `\n          <div class=\"c-messenger__empty\">\n            <i class=\"ti ti-message-2 c-messenger__empty-icon\"></i>\n            <p class=\"c-messenger__empty-text\">No messages yet. Say hello!</p>\n          </div>\n        `;\n        return;\n      }\n\n      this.messages.forEach(msg => this.appendMessage(msg, false));\n    }\n\n    /**\n     * Append a message to the chat\n     */\n    appendMessage(msg, scroll = true) {\n      const container = this.widget.querySelector('[data-messages]');\n      if (!container) return;\n\n      // Remove empty state\n      const empty = container.querySelector('.c-messenger__empty');\n      if (empty) empty.remove();\n\n      const isSent = msg.sender_id !== this.currentUserId;\n      const bubble = document.createElement('div');\n      bubble.className = `c-messenger__message c-messenger__message--${isSent ? 'sent' : 'received'}`;\n      bubble.dataset.messageId = msg.id;\n\n      const timeStr = msg.created_at\n        ? new Date(msg.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n        : '';\n\n      bubble.innerHTML = `\n        <div class=\"c-messenger__message-content\">${this.escapeHtml(msg.content)}</div>\n        <div class=\"c-messenger__message-time\">${timeStr}</div>\n        ${isSent ? `\n          <div class=\"c-messenger__message-actions\">\n            <button class=\"c-messenger__message-action\" data-action=\"delete-message\" title=\"Delete\">\n              <i class=\"ti ti-trash\"></i>\n            </button>\n          </div>\n        ` : ''}\n      `;\n\n      container.appendChild(bubble);\n\n      if (scroll) this.scrollToBottom(container);\n    }\n\n    /**\n     * Send a message\n     */\n    async sendMessage() {\n      const input = this.widget.querySelector('[data-input=\"message\"]');\n      if (!input || !this.currentUserId) return;\n\n      const content = input.value.trim();\n      if (!content) return;\n\n      input.value = '';\n      input.style.height = 'auto';\n      input.focus();\n\n      if (this.socket && this.socket.connected) {\n        this.socket.emit('send_dm', {\n          recipient_id: this.currentUserId,\n          content: content\n        });\n      } else {\n        // HTTP fallback\n        try {\n          const response = await fetch(`/api/messages/${this.currentUserId}`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'X-CSRFToken': this.getCSRFToken()\n            },\n            body: JSON.stringify({ content })\n          });\n          const data = await response.json();\n          if (data.success && data.message) {\n            this.appendMessage(data.message);\n          } else {\n            this.showToast(data.error || 'Failed to send', 'error');\n          }\n        } catch (error) {\n          this.showToast('Failed to send message', 'error');\n        }\n      }\n    }\n\n    /**\n     * Delete a message\n     */\n    async deleteMessage(messageId) {\n      if (!confirm('Delete this message?')) return;\n\n      try {\n        const response = await fetch(`/api/messages/message/${messageId}`, {\n          method: 'DELETE',\n          headers: {\n            'X-CSRFToken': this.getCSRFToken()\n          }\n        });\n        const data = await response.json();\n\n        if (data.success) {\n          const msgEl = this.widget.querySelector(`[data-message-id=\"${messageId}\"]`);\n          if (msgEl) {\n            msgEl.classList.add('is-deleting');\n            setTimeout(() => msgEl.remove(), 200);\n          }\n        } else {\n          this.showToast(data.error || 'Failed to delete', 'error');\n        }\n      } catch (error) {\n        this.showToast('Failed to delete message', 'error');\n      }\n    }\n\n    /**\n     * Handle incoming message\n     */\n    handleNewMessage(data) {\n      this.loadUnreadCount();\n\n      if (this.widget.classList.contains('is-chatting') && this.currentUserId === data.sender_id) {\n        this.appendMessage(data);\n        this.markAsRead(data.id);\n      } else {\n        this.showToast(`${data.sender_name}: ${data.content.substring(0, 50)}`, 'info');\n      }\n\n      if (!this.widget.classList.contains('is-chatting')) {\n        this.loadConversations();\n      }\n    }\n\n    /**\n     * Handle message deleted event\n     */\n    handleMessageDeleted(data) {\n      const msgEl = this.widget.querySelector(`[data-message-id=\"${data.message_id}\"]`);\n      if (msgEl) msgEl.remove();\n    }\n\n    /**\n     * Handle typing indicator\n     */\n    handleTypingIndicator(data) {\n      if (this.currentUserId !== data.user_id) return;\n\n      const container = this.widget.querySelector('[data-messages]');\n      let typingEl = container?.querySelector('.c-messenger__typing');\n\n      if (data.typing) {\n        if (!typingEl) {\n          typingEl = document.createElement('div');\n          typingEl.className = 'c-messenger__typing';\n          typingEl.innerHTML = `\n            <span class=\"c-messenger__typing-dots\">\n              <span class=\"c-messenger__typing-dot\"></span>\n              <span class=\"c-messenger__typing-dot\"></span>\n              <span class=\"c-messenger__typing-dot\"></span>\n            </span>\n            <span>typing...</span>\n          `;\n          container.appendChild(typingEl);\n          this.scrollToBottom(container);\n        }\n      } else {\n        if (typingEl) typingEl.remove();\n      }\n    }\n\n    /**\n     * Handle typing (send indicator)\n     */\n    handleTyping() {\n      if (!this.socket || !this.currentUserId) return;\n\n      if (this.typingTimeout) clearTimeout(this.typingTimeout);\n\n      this.socket.emit('typing_start', { recipient_id: this.currentUserId });\n\n      this.typingTimeout = setTimeout(() => {\n        this.socket.emit('typing_stop', { recipient_id: this.currentUserId });\n      }, 2000);\n    }\n\n    /**\n     * Handle messages read notification\n     */\n    handleMessagesRead(data) {\n      // Could add read receipts visual\n    }\n\n    /**\n     * Mark message as read\n     */\n    markAsRead(messageId) {\n      if (this.socket && this.socket.connected) {\n        this.socket.emit('mark_dm_read', { message_id: messageId });\n      }\n    }\n\n    // ========================================================================\n    // SEARCH\n    // ========================================================================\n\n    /**\n     * Handle search input\n     */\n    async handleSearch(query) {\n      if (query.length < 2) {\n        this.renderConversations();\n        return;\n      }\n\n      try {\n        const response = await fetch(`/api/messages/users/search?q=${encodeURIComponent(query)}`);\n        const data = await response.json();\n\n        if (data.success && data.users) {\n          this.renderSearchResults(data.users);\n        }\n      } catch (error) {\n        console.error('[Messenger] Search failed:', error);\n      }\n    }\n\n    /**\n     * Render search results\n     */\n    renderSearchResults(users) {\n      const list = this.widget.querySelector('[data-conversation-list]');\n      if (!list) return;\n\n      const items = list.querySelectorAll('.c-messenger__conversation');\n      items.forEach(item => item.remove());\n\n      users.forEach(user => {\n        const item = document.createElement('div');\n        item.className = 'c-messenger__conversation';\n        item.dataset.conversationId = user.id;\n\n        const avatarUrl = user.avatar_url || '/static/img/default_player.png';\n\n        item.innerHTML = `\n          <div class=\"c-messenger__conversation-avatar\">\n            <img src=\"${avatarUrl}\" alt=\"${user.name}\"\n                 class=\"c-messenger__conversation-avatar-img\"\n                 onerror=\"this.src='/static/img/default_player.png'\">\n          </div>\n          <div class=\"c-messenger__conversation-body\">\n            <p class=\"c-messenger__conversation-name\">${user.name}</p>\n            <p class=\"c-messenger__conversation-preview\">Click to start chatting</p>\n          </div>\n        `;\n\n        list.appendChild(item);\n      });\n    }\n\n    /**\n     * Focus search input\n     */\n    focusSearch() {\n      const input = this.widget.querySelector('[data-input=\"search\"]');\n      if (input) {\n        input.focus();\n        input.value = '';\n      }\n    }\n\n    // ========================================================================\n    // UI HELPERS\n    // ========================================================================\n\n    /**\n     * Show conversation list (exit chat view)\n     */\n    showList() {\n      this.widget.classList.remove('is-chatting');\n      this.currentUserId = null;\n      this.currentUserName = '';\n      this.loadConversations();\n\n      // Reset header\n      const headerTitle = this.widget.querySelector('[data-header-title] span');\n      if (headerTitle) headerTitle.textContent = 'Messages';\n    }\n\n    /**\n     * Load unread count\n     */\n    async loadUnreadCount() {\n      try {\n        const response = await fetch('/api/messages/unread-count');\n        const data = await response.json();\n        if (data.success) {\n          this.updateBadge(data.count);\n        }\n      } catch (error) {\n        console.warn('[Messenger] Failed to load unread count:', error);\n      }\n    }\n\n    /**\n     * Update badge count\n     */\n    updateBadge(count) {\n      this.unreadCount = count;\n\n      const badge = this.widget.querySelector('[data-badge=\"unread\"]');\n      if (badge) {\n        badge.textContent = count > 99 ? '99+' : count;\n        badge.classList.toggle('u-hidden', count === 0);\n      }\n\n      // Update navbar badge too\n      const navBadge = document.querySelector('[data-badge=\"messages-count\"]');\n      if (navBadge) {\n        navBadge.textContent = count > 99 ? '99+' : count;\n        navBadge.classList.toggle('u-hidden', count === 0);\n      }\n    }\n\n    /**\n     * Scroll to bottom of container\n     */\n    scrollToBottom(container) {\n      if (container) {\n        container.scrollTop = container.scrollHeight;\n      }\n    }\n\n    /**\n     * Escape HTML\n     */\n    escapeHtml(text) {\n      const div = document.createElement('div');\n      div.textContent = text;\n      return div.innerHTML;\n    }\n\n    /**\n     * Show toast notification\n     */\n    showToast(message, type = 'info') {\n      if (typeof Swal !== 'undefined') {\n        Swal.fire({\n          toast: true,\n          position: 'top-end',\n          icon: type,\n          title: message,\n          showConfirmButton: false,\n          timer: 3000\n        });\n      } else {\n        console.log(`[${type}]`, message);\n      }\n    }\n\n    /**\n     * Cleanup on destroy\n     */\n    destroy() {\n      Object.values(this.refreshIntervals).forEach(interval => {\n        if (interval) clearInterval(interval);\n      });\n    }\n  }\n\n  // Initialize\n  window.MessengerWidget = new MessengerWidget();\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      window.MessengerWidget.init();\n    });\n  } else {\n    window.MessengerWidget.init();\n  }\n\n  // Cleanup on page unload\n  window.addEventListener('beforeunload', () => {\n    window.MessengerWidget.destroy();\n  });\n\n})();\n","/**\n * Profile Wizard - 5-Step Verification Wizard\n * Handles step progression, validation, review population, auto-save, and touch gestures\n */\n\nclass ProfileWizard {\n    constructor(config = {}) {\n        this.config = {\n            totalSteps: config.totalSteps || 5,\n            playerId: config.playerId || null,\n            csrfToken: config.csrfToken || '',\n            autoSaveUrl: config.autoSaveUrl || '',\n            autoSaveDelay: config.autoSaveDelay || 2000\n        };\n\n        this.currentStep = 1;\n        this.autoSaveTimeout = null;\n        this.lastSavedData = null;\n\n        // Cache DOM elements\n        this.elements = {\n            form: document.getElementById('wizardForm'),\n            progressBar: document.getElementById('progressBar'),\n            currentStepInput: document.getElementById('currentStep'),\n            prevBtn: document.getElementById('prevBtn'),\n            nextBtn: document.getElementById('nextBtn'),\n            confirmBtn: document.getElementById('confirmBtn'),\n            saveIndicator: document.getElementById('saveIndicator'),\n            swipeHint: document.getElementById('swipeHint'),\n            steps: document.querySelectorAll('[data-step]'),\n            stepIndicators: document.querySelectorAll('[data-step-indicator]'),\n            editButtons: document.querySelectorAll('[data-goto-step]'),\n            confirmCheckbox: document.getElementById('confirmCheck')\n        };\n\n        this.init();\n    }\n\n    /**\n     * Initialize the wizard\n     */\n    init() {\n        if (!this.elements.form) {\n            console.warn('Profile wizard form not found');\n            return;\n        }\n\n        this.bindEvents();\n        this.updateUI();\n        this.initSwipeGestures();\n\n        // Hide swipe hint after first interaction\n        if (this.elements.swipeHint) {\n            setTimeout(() => {\n                this.elements.swipeHint.style.opacity = '0.5';\n            }, 3000);\n        }\n    }\n\n    /**\n     * Bind event handlers\n     */\n    bindEvents() {\n        // Navigation buttons\n        if (this.elements.nextBtn) {\n            this.elements.nextBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this.next();\n            });\n        }\n\n        if (this.elements.prevBtn) {\n            this.elements.prevBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this.prev();\n            });\n        }\n\n        // Clicking on completed step indicators\n        this.elements.stepIndicators.forEach(indicator => {\n            indicator.addEventListener('click', () => {\n                const stepNum = parseInt(indicator.dataset.stepIndicator);\n                if (stepNum < this.currentStep) {\n                    this.goToStep(stepNum);\n                }\n            });\n        });\n\n        // Edit buttons in review section\n        this.elements.editButtons.forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                e.preventDefault();\n                const stepNum = parseInt(btn.dataset.gotoStep);\n                this.goToStep(stepNum);\n            });\n        });\n\n        // Form field changes - auto-save and review update\n        const formFields = this.elements.form.querySelectorAll('input, select, textarea');\n        formFields.forEach(field => {\n            field.addEventListener('change', () => {\n                this.scheduleAutoSave();\n                if (this.currentStep === this.config.totalSteps) {\n                    this.populateReview();\n                }\n            });\n\n            field.addEventListener('input', () => {\n                // Remove invalid state when user starts typing\n                field.classList.remove('is-invalid', 'is-shaking');\n            });\n        });\n\n        // Form submission\n        this.elements.form.addEventListener('submit', (e) => {\n            if (!this.validateFinalStep()) {\n                e.preventDefault();\n            }\n        });\n\n        // Confirm checkbox validation\n        if (this.elements.confirmCheckbox) {\n            this.elements.confirmCheckbox.addEventListener('change', () => {\n                this.updateConfirmButton();\n            });\n        }\n    }\n\n    /**\n     * Go to next step\n     */\n    next() {\n        // Step 1 (welcome) has no validation\n        if (this.currentStep > 1 && !this.validateCurrentStep()) {\n            this.shakeInvalidFields();\n            return;\n        }\n\n        if (this.currentStep < this.config.totalSteps) {\n            this.currentStep++;\n            this.updateUI();\n\n            // Populate review on entering last step\n            if (this.currentStep === this.config.totalSteps) {\n                this.populateReview();\n            }\n        }\n    }\n\n    /**\n     * Go to previous step\n     */\n    prev() {\n        if (this.currentStep > 1) {\n            this.currentStep--;\n            this.updateUI();\n        }\n    }\n\n    /**\n     * Go to specific step\n     */\n    goToStep(step) {\n        if (step >= 1 && step <= this.config.totalSteps) {\n            this.currentStep = step;\n            this.updateUI();\n\n            if (this.currentStep === this.config.totalSteps) {\n                this.populateReview();\n            }\n        }\n    }\n\n    /**\n     * Update UI based on current step\n     */\n    updateUI() {\n        // Update hidden input\n        if (this.elements.currentStepInput) {\n            this.elements.currentStepInput.value = this.currentStep;\n        }\n\n        // Update step content visibility\n        this.elements.steps.forEach(step => {\n            const stepNum = parseInt(step.dataset.step);\n            step.classList.toggle('c-wizard__step--active', stepNum === this.currentStep);\n        });\n\n        // Update step indicators\n        this.elements.stepIndicators.forEach(indicator => {\n            const stepNum = parseInt(indicator.dataset.stepIndicator);\n            indicator.classList.remove('c-wizard__progress-step--active', 'c-wizard__progress-step--completed');\n\n            if (stepNum === this.currentStep) {\n                indicator.classList.add('c-wizard__progress-step--active');\n            } else if (stepNum < this.currentStep) {\n                indicator.classList.add('c-wizard__progress-step--completed');\n            }\n        });\n\n        // Update progress bar (0% at step 1, 100% at step 5)\n        const progress = ((this.currentStep - 1) / (this.config.totalSteps - 1)) * 80; // 80% is full width between first and last\n        if (this.elements.progressBar) {\n            this.elements.progressBar.style.width = progress + '%';\n        }\n\n        // Update navigation buttons\n        this.updateNavigationButtons();\n\n        // Scroll to top smoothly\n        this.elements.form.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n\n    /**\n     * Update navigation button visibility and states\n     */\n    updateNavigationButtons() {\n        const { prevBtn, nextBtn, confirmBtn } = this.elements;\n\n        if (this.currentStep === 1) {\n            // First step: hide back, show next\n            if (prevBtn) prevBtn.disabled = true;\n            if (nextBtn) {\n                nextBtn.style.display = 'flex';\n                nextBtn.querySelector('span').textContent = 'Get Started';\n            }\n            if (confirmBtn) confirmBtn.style.display = 'none';\n        } else if (this.currentStep === this.config.totalSteps) {\n            // Last step: show back, hide next, show confirm\n            if (prevBtn) prevBtn.disabled = false;\n            if (nextBtn) nextBtn.style.display = 'none';\n            if (confirmBtn) {\n                confirmBtn.style.display = 'flex';\n                this.updateConfirmButton();\n            }\n        } else {\n            // Middle steps: show back and next\n            if (prevBtn) prevBtn.disabled = false;\n            if (nextBtn) {\n                nextBtn.style.display = 'flex';\n                nextBtn.querySelector('span').textContent = 'Continue';\n            }\n            if (confirmBtn) confirmBtn.style.display = 'none';\n        }\n    }\n\n    /**\n     * Update confirm button state based on checkbox\n     */\n    updateConfirmButton() {\n        if (this.elements.confirmBtn && this.elements.confirmCheckbox) {\n            this.elements.confirmBtn.disabled = !this.elements.confirmCheckbox.checked;\n        }\n    }\n\n    /**\n     * Validate the current step's required fields\n     */\n    validateCurrentStep() {\n        const currentStepEl = document.querySelector(`[data-step=\"${this.currentStep}\"]`);\n        if (!currentStepEl) return true;\n\n        let isValid = true;\n        const requiredFields = currentStepEl.querySelectorAll('[required]');\n\n        requiredFields.forEach(field => {\n            const value = field.value.trim();\n            if (!value) {\n                field.classList.add('is-invalid');\n                isValid = false;\n            } else {\n                field.classList.remove('is-invalid');\n            }\n        });\n\n        // Email validation for contact step\n        const emailField = currentStepEl.querySelector('#email');\n        if (emailField && emailField.value) {\n            const emailPattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            if (!emailPattern.test(emailField.value)) {\n                emailField.classList.add('is-invalid');\n                isValid = false;\n            }\n        }\n\n        return isValid;\n    }\n\n    /**\n     * Validate final step (confirmation checkbox)\n     */\n    validateFinalStep() {\n        if (!this.elements.confirmCheckbox) return true;\n        return this.elements.confirmCheckbox.checked;\n    }\n\n    /**\n     * Apply shake animation to invalid fields\n     */\n    shakeInvalidFields() {\n        const currentStepEl = document.querySelector(`[data-step=\"${this.currentStep}\"]`);\n        if (!currentStepEl) return;\n\n        const invalidFields = currentStepEl.querySelectorAll('.is-invalid');\n        invalidFields.forEach(field => {\n            field.classList.add('is-shaking');\n            setTimeout(() => {\n                field.classList.remove('is-shaking');\n            }, 300);\n        });\n\n        // Focus first invalid field\n        if (invalidFields.length) {\n            invalidFields[0].focus();\n        }\n    }\n\n    /**\n     * Populate the review section with current form values\n     */\n    populateReview() {\n        const reviewElements = document.querySelectorAll('[data-review]');\n\n        reviewElements.forEach(el => {\n            const fieldName = el.dataset.review;\n            let displayValue = '-';\n\n            // First try to find a direct field (input, select, textarea)\n            const field = this.elements.form.querySelector(`[data-field=\"${fieldName}\"]`);\n\n            if (field) {\n                if (field.tagName === 'SELECT') {\n                    if (field.multiple) {\n                        // Multi-select dropdown\n                        const selected = Array.from(field.selectedOptions).map(opt => opt.text);\n                        displayValue = selected.length > 0 ? selected.join(', ') : 'None selected';\n                    } else {\n                        // Single select\n                        displayValue = field.options[field.selectedIndex]?.text || '-';\n                    }\n                } else if (field.tagName === 'TEXTAREA') {\n                    displayValue = field.value.trim() || 'No additional notes';\n                } else if (field.tagName === 'DIV') {\n                    // Checkbox group container\n                    const checkedBoxes = field.querySelectorAll('input[type=\"checkbox\"]:checked');\n                    const values = Array.from(checkedBoxes).map(cb => cb.value);\n                    displayValue = values.length > 0 ? values.join(', ') : 'None selected';\n                } else {\n                    displayValue = field.value.trim() || '-';\n                }\n            } else {\n                // Try to find checkbox group by name\n                const checkboxes = this.elements.form.querySelectorAll(`input[name=\"${fieldName}\"]:checked`);\n                if (checkboxes.length > 0) {\n                    const values = Array.from(checkboxes).map(cb => cb.value);\n                    displayValue = values.join(', ');\n                }\n            }\n\n            el.textContent = displayValue;\n        });\n    }\n\n    /**\n     * Schedule auto-save with debounce\n     */\n    scheduleAutoSave() {\n        if (!this.config.autoSaveUrl) return;\n\n        if (this.autoSaveTimeout) {\n            clearTimeout(this.autoSaveTimeout);\n        }\n\n        this.autoSaveTimeout = setTimeout(() => {\n            this.autoSave();\n        }, this.config.autoSaveDelay);\n    }\n\n    /**\n     * Perform auto-save\n     */\n    async autoSave() {\n        if (!this.config.autoSaveUrl) return;\n\n        const formData = new FormData(this.elements.form);\n        const data = Object.fromEntries(formData.entries());\n\n        // Check if data actually changed\n        const dataString = JSON.stringify(data);\n        if (dataString === this.lastSavedData) return;\n\n        try {\n            const response = await fetch(this.config.autoSaveUrl, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-CSRFToken': this.config.csrfToken\n                },\n                body: JSON.stringify(data)\n            });\n\n            if (response.ok) {\n                this.lastSavedData = dataString;\n                this.showSaveIndicator();\n            }\n        } catch (error) {\n            console.warn('Auto-save failed:', error);\n        }\n    }\n\n    /**\n     * Show save indicator briefly\n     */\n    showSaveIndicator() {\n        if (!this.elements.saveIndicator) return;\n\n        this.elements.saveIndicator.classList.add('is-visible');\n\n        setTimeout(() => {\n            this.elements.saveIndicator.classList.remove('is-visible');\n        }, 2000);\n    }\n\n    /**\n     * Initialize touch/swipe gestures for mobile navigation\n     */\n    initSwipeGestures() {\n        if (!('ontouchstart' in window)) return;\n\n        let touchStartX = 0;\n        let touchEndX = 0;\n        const minSwipeDistance = 50;\n\n        this.elements.form.addEventListener('touchstart', (e) => {\n            touchStartX = e.changedTouches[0].screenX;\n        }, { passive: true });\n\n        this.elements.form.addEventListener('touchend', (e) => {\n            touchEndX = e.changedTouches[0].screenX;\n            const swipeDistance = touchEndX - touchStartX;\n\n            if (Math.abs(swipeDistance) < minSwipeDistance) return;\n\n            if (swipeDistance > 0) {\n                // Swipe right - go to previous step\n                this.prev();\n            } else {\n                // Swipe left - go to next step\n                this.next();\n            }\n        }, { passive: true });\n    }\n\n    /**\n     * Get current step number\n     */\n    getCurrentStep() {\n        return this.currentStep;\n    }\n}\n\n// Export for module usage\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = ProfileWizard;\n}\n","/**\n * Draft System v2 - Simplified and Optimized\n * Clean implementation matching ECS UI patterns\n *\n * REFACTORED: All .style.* manipulations replaced with CSS classes\n * - Replaced 69 inline style manipulations with utility classes\n * - Improved maintainability and consistency\n * - Better performance with CSS class toggling\n * - Easier theming and customization\n */\n\n// Global utility function for formatting position names\nfunction formatPosition(position) {\n    if (!position) return position;\n    return position.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n}\n\nclass DraftSystemV2 {\n    constructor(leagueName) {\n        this.leagueName = leagueName;\n        this.socket = null;\n        this.currentPlayerId = null;\n        this.isConnected = false;\n\n        // Expose instance globally for event delegation\n        window.draftSystemInstance = this;\n\n        this.init();\n    }\n\n    init() {\n        console.log(' [Draft] Initializing DraftSystemV2 for league:', this.leagueName);\n        this.setupImageHandling();\n        this.setupEventListeners();\n        this.initializeSocket();\n        this.setupSearch();\n        this.setupTeamTabHighlighting();\n        console.log(' [Draft] DraftSystemV2 initialization complete');\n    }\n\n    setupImageHandling() {\n        // Handle all player images on page load\n        // Refactored: Using d-flex/d-none/d-block classes instead of style.display\n        document.querySelectorAll('[data-component=\"player-avatar-container\"]').forEach(container => {\n            const img = container.querySelector('.player-avatar');\n            const fallback = container.querySelector('.player-avatar-fallback');\n\n            if (img && fallback) {\n                // Show fallback by default\n                fallback.classList.add('d-flex');\n                fallback.classList.remove('d-none');\n                img.classList.add('d-none');\n                img.classList.remove('d-block');\n\n                // Test if image loads\n                if (img.src && img.src !== '') {\n                    const testImg = new Image();\n                    testImg.onload = () => {\n                        img.classList.add('d-block');\n                        img.classList.remove('d-none');\n                        fallback.classList.add('d-none');\n                        fallback.classList.remove('d-flex');\n                    };\n                    testImg.onerror = () => {\n                        img.classList.add('d-none');\n                        img.classList.remove('d-block');\n                        fallback.classList.add('d-flex');\n                        fallback.classList.remove('d-none');\n                    };\n                    testImg.src = img.src;\n                }\n            }\n        });\n\n        // Handle team player images\n        document.querySelectorAll('[data-component=\"team-player\"]').forEach(player => {\n            const img = player.querySelector('.team-player-avatar');\n            const fallback = player.querySelector('.team-player-avatar-fallback');\n\n            if (img && fallback) {\n                fallback.classList.add('d-flex');\n                fallback.classList.remove('d-none');\n                img.classList.add('d-none');\n                img.classList.remove('d-block');\n\n                if (img.src && img.src !== '') {\n                    const testImg = new Image();\n                    testImg.onload = () => {\n                        img.classList.add('d-block');\n                        img.classList.remove('d-none');\n                        fallback.classList.add('d-none');\n                        fallback.classList.remove('d-flex');\n                    };\n                    testImg.onerror = () => {\n                        img.classList.add('d-none');\n                        img.classList.remove('d-block');\n                        fallback.classList.add('d-flex');\n                        fallback.classList.remove('d-none');\n                    };\n                    testImg.src = img.src;\n                }\n            }\n        });\n    }\n\n    // Smart image cropping function\n    smartCropImage(img) {\n        // Get the natural dimensions of the image\n        const naturalWidth = img.naturalWidth;\n        const naturalHeight = img.naturalHeight;\n        const aspectRatio = naturalWidth / naturalHeight;\n\n        // Determine the best object-position based on aspect ratio\n        // Refactored: Using object-position utility classes instead of inline styles\n        let positionClass = 'object-position-top-20'; // Default for portraits\n\n        if (aspectRatio > 1.3) {\n            // Wide/landscape image - center more\n            positionClass = 'object-position-center-35';\n        } else if (aspectRatio > 0.9 && aspectRatio < 1.1) {\n            // Square-ish image - slightly higher than center\n            positionClass = 'object-position-top-25';\n        } else if (aspectRatio < 0.7) {\n            // Very tall portrait - focus on upper portion where face likely is\n            positionClass = 'object-position-top-15';\n        }\n\n        // Apply the smart positioning class\n        img.classList.add(positionClass);\n\n        // console.log(`Smart crop applied: ${img.alt} (${naturalWidth}x${naturalHeight}, ratio: ${aspectRatio.toFixed(2)}) -> ${positionClass}`);\n    }\n\n    setupEventListeners() {\n        // Event delegation now handles search/filter/sort via data-on-input and data-on-change\n        // No individual event listeners needed - delegation system will call:\n        // - this.handleSearch() via 'search-players' action\n        // - this.handleFilter() via 'filter-position' action\n        // - this.handleSort() via 'sort-players' action\n\n        // Keyboard shortcuts (keep as-is, not suitable for data-action pattern)\n        const searchInput = document.getElementById('playerSearch');\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape') {\n                this.closeModals();\n            }\n            if (e.key === '/' && !e.target.matches('input, textarea')) {\n                e.preventDefault();\n                if (searchInput) searchInput.focus();\n            }\n        });\n    }\n\n    initializeSocket() {\n        try {\n            // Use SocketManager if available (preferred method)\n            if (typeof window.SocketManager !== 'undefined') {\n                console.log(' [Draft] Using SocketManager');\n\n                // Get socket reference\n                this.socket = window.SocketManager.getSocket();\n\n                // Register connect callback - fires immediately if already connected\n                window.SocketManager.onConnect('DraftSystem', (socket) => {\n                    console.log(' [Draft] Socket connected via SocketManager');\n                    this.socket = socket;\n                    this.isConnected = true;\n                    this.updateConnectionStatus(true);\n                    this.socket.emit('join_draft_room', { league_name: this.leagueName });\n                });\n\n                // Register disconnect callback\n                window.SocketManager.onDisconnect('DraftSystem', (reason) => {\n                    console.log(' [Draft] Socket disconnected:', reason);\n                    this.isConnected = false;\n                    this.updateConnectionStatus(false);\n                });\n\n                // Register event listeners via SocketManager\n                this.setupSocketListenersViaManager();\n                return;\n            }\n\n            // Fallback: Reuse existing global socket if available\n            if (window.socket) {\n                console.log(' [Draft] Reusing existing socket (connected:', window.socket.connected, ')');\n                this.socket = window.socket;\n\n                // If already connected, join room immediately\n                if (this.socket.connected) {\n                    this.isConnected = true;\n                    this.updateConnectionStatus(true);\n                    this.socket.emit('join_draft_room', { league_name: this.leagueName });\n                }\n                // Set up listeners regardless - they'll fire when connected\n                this.setupSocketListeners();\n                return;\n            }\n\n            console.log(' [Draft] Creating new socket connection (fallback)');\n            this.socket = io('/', {\n                transports: ['polling', 'websocket'],\n                upgrade: true,\n                timeout: 10000,\n                reconnection: true,\n                reconnectionDelay: 1000,\n                reconnectionAttempts: 3,\n                withCredentials: true\n            });\n\n            // Store globally so other components can reuse\n            window.socket = this.socket;\n\n            this.socket.on('connect', () => {\n                this.isConnected = true;\n                this.updateConnectionStatus(true);\n                this.socket.emit('join_draft_room', { league_name: this.leagueName });\n            });\n\n            this.socket.on('disconnect', () => {\n                this.isConnected = false;\n                this.updateConnectionStatus(false);\n            });\n\n            this.socket.on('connect_error', (error) => {\n                this.updateConnectionStatus(false, 'Connection Error');\n                setTimeout(() => {\n                    if (!this.isConnected) {\n                        this.tryFallbackConnection();\n                    }\n                }, 3000);\n            });\n\n            this.socket.on('joined_room', (data) => {\n                console.log(' [Draft] Joined room:', data.room);\n            });\n\n            this.socket.on('player_drafted_enhanced', (data) => {\n                this.hideDraftingIndicator();\n                this.handlePlayerDrafted(data);\n            });\n\n            this.socket.on('player_removed_enhanced', (data) => {\n                this.handlePlayerRemoved(data);\n            });\n\n            this.socket.on('user_drafting', (data) => {\n                if (data.username && data.player_name) {\n                    this.showUserActivity(data.username, data.player_name, data.team_name);\n                }\n            });\n\n            this.socket.on('error', (data) => {\n                this.hideDraftingIndicator();\n                this.hideLoading();\n                this.showToast('Error: ' + data.message, 'error');\n            });\n\n            this.socket.on('draft_error', (data) => {\n                this.hideDraftingIndicator();\n                this.hideLoading();\n                this.showToast('Draft Error: ' + data.message, 'error');\n            });\n\n            this.socket.on('player_details', (data) => {\n                this.handlePlayerDetails(data);\n            });\n\n        } catch (error) {\n            // console.error('Failed to initialize socket:', error);\n            this.updateConnectionStatus(false, 'Failed to Connect');\n        }\n    }\n\n    /**\n     * Set up draft-specific socket listeners (used when reusing existing socket)\n     */\n    setupSocketListeners() {\n        if (!this.socket) return;\n\n        // Handle connect event (for when reusing a socket that's still connecting)\n        this.socket.on('connect', () => {\n            console.log(' [Draft] Socket connected, joining draft room');\n            this.isConnected = true;\n            this.updateConnectionStatus(true);\n            this.socket.emit('join_draft_room', { league_name: this.leagueName });\n        });\n\n        this.socket.on('disconnect', () => {\n            this.isConnected = false;\n            this.updateConnectionStatus(false);\n        });\n\n        this.socket.on('joined_room', (data) => {\n            console.log(' [Draft] Joined room:', data.room);\n            // Hide loading overlay after successfully joining the draft room\n            this.hideLoading();\n        });\n\n        this.socket.on('player_drafted_enhanced', (data) => {\n            // console.log(' Received player_drafted_enhanced event:', data);\n            this.hideDraftingIndicator();\n            this.handlePlayerDrafted(data);\n        });\n\n        this.socket.on('player_removed_enhanced', (data) => {\n            // console.log(' Received player_removed_enhanced event:', data);\n            this.handlePlayerRemoved(data);\n        });\n\n        this.socket.on('user_drafting', (data) => {\n            if (data.username && data.player_name) {\n                this.showUserActivity(data.username, data.player_name, data.team_name);\n            }\n        });\n\n        this.socket.on('error', (data) => {\n            // console.error(' Received error event:', data);\n            this.hideDraftingIndicator();\n            this.hideLoading();\n            this.showToast('Error: ' + data.message, 'error');\n        });\n\n        this.socket.on('draft_error', (data) => {\n            // console.error(' Received draft_error event:', data);\n            this.hideDraftingIndicator();\n            this.hideLoading();\n            this.showToast('Draft Error: ' + data.message, 'error');\n        });\n\n        this.socket.on('player_details', (data) => {\n            this.handlePlayerDetails(data);\n        });\n    }\n\n    setupSocketListenersViaManager() {\n        // Use SocketManager for event registration (handles reconnects properly)\n        const SM = window.SocketManager;\n\n        SM.on('DraftSystem', 'joined_room', (data) => {\n            console.log(' [Draft] Joined room:', data.room);\n            this.hideLoading();\n        });\n\n        SM.on('DraftSystem', 'player_drafted_enhanced', (data) => {\n            this.hideDraftingIndicator();\n            this.handlePlayerDrafted(data);\n        });\n\n        SM.on('DraftSystem', 'player_removed_enhanced', (data) => {\n            this.handlePlayerRemoved(data);\n        });\n\n        SM.on('DraftSystem', 'user_drafting', (data) => {\n            if (data.username && data.player_name) {\n                this.showUserActivity(data.username, data.player_name, data.team_name);\n            }\n        });\n\n        SM.on('DraftSystem', 'error', (data) => {\n            this.hideDraftingIndicator();\n            this.hideLoading();\n            this.showToast('Error: ' + data.message, 'error');\n        });\n\n        SM.on('DraftSystem', 'draft_error', (data) => {\n            this.hideDraftingIndicator();\n            this.hideLoading();\n            this.showToast('Draft Error: ' + data.message, 'error');\n        });\n\n        SM.on('DraftSystem', 'player_details', (data) => {\n            this.handlePlayerDetails(data);\n        });\n\n        console.log(' [Draft] Socket listeners attached via SocketManager');\n    }\n\n    tryFallbackConnection() {\n        try {\n            // console.log(' Trying alternative connection method...');\n            if (this.socket) {\n                this.socket.disconnect();\n            }\n\n            // Try with minimal configuration on default namespace\n            this.socket = io('/', {\n                transports: ['polling'], // Only polling\n                upgrade: false,\n                timeout: 10000,\n                reconnection: false,\n                forceNew: true\n            });\n\n            this.socket.on('connect', () => {\n                // console.log(' Alternative connection successful!');\n                this.isConnected = true;\n                this.updateConnectionStatus(true);\n                this.socket.emit('join_draft_room', { league_name: this.leagueName });\n            });\n\n            this.socket.on('connect_error', (error) => {\n                // console.error(' Alternative connection also failed:', error);\n                this.updateConnectionStatus(false, 'Using HTTP Fallback');\n                this.showToast('WebSocket connection failed. Using HTTP mode.', 'info');\n            });\n\n            // Set up other event listeners again\n            this.setupSocketEventListeners();\n\n        } catch (error) {\n            // console.error('Alternative connection failed:', error);\n            this.updateConnectionStatus(false, 'HTTP Fallback Only');\n        }\n    }\n\n    setupSocketEventListeners() {\n        if (!this.socket) return;\n\n        this.socket.on('player_drafted_enhanced', (data) => {\n            this.hideDraftingIndicator(); // Phase 5: Hide status indicator\n            this.handlePlayerDrafted(data);\n        });\n\n        this.socket.on('player_removed_enhanced', (data) => {\n            this.handlePlayerRemoved(data);\n        });\n\n        // Phase 5: Multi-user awareness\n        this.socket.on('user_drafting', (data) => {\n            if (data.username && data.player_name) {\n                this.showUserActivity(data.username, data.player_name, data.team_name);\n            }\n        });\n\n        this.socket.on('remove_error', (data) => {\n            // console.error(' Received remove_error event:', data);\n            this.hideLoading(); // Hide loading overlay on error\n            this.showToast('Remove Error: ' + data.message, 'error');\n        });\n\n        this.socket.on('error', (data) => {\n            this.showToast('Error: ' + data.message, 'error');\n        });\n    }\n\n    updateConnectionStatus(connected, message = null) {\n        const statusElement = document.getElementById('connectionStatus');\n        if (statusElement) {\n            if (connected) {\n                statusElement.className = 'connection-status status-connected';\n                statusElement.innerHTML = '<i class=\"ti ti-wifi me-1\"></i>Connected';\n            } else {\n                statusElement.className = 'connection-status status-disconnected';\n                statusElement.innerHTML = `<i class=\"ti ti-wifi-off me-1\"></i>${message || 'Disconnected'}`;\n            }\n        }\n    }\n\n    setupSearch() {\n        // Initial state\n        this.updatePlayerCounts();\n    }\n\n    handleSearch(event) {\n        const searchTerm = event.target.value.toLowerCase();\n        const container = document.getElementById('available-players');\n        if (!container) return;\n\n        const playerColumns = Array.from(container.children);\n        let visibleCount = 0;\n\n        // Refactored: Using d-block/d-none classes instead of style.display\n        playerColumns.forEach(column => {\n            const playerCard = column.querySelector('[data-component=\"player-card\"]');\n            if (playerCard) {\n                const playerName = playerCard.getAttribute('data-player-name') || '';\n                const shouldShow = playerName.includes(searchTerm);\n\n                if (shouldShow) {\n                    column.classList.remove('d-none');\n                    column.classList.add('d-block');\n                    visibleCount++;\n                } else {\n                    column.classList.add('d-none');\n                    column.classList.remove('d-block');\n                }\n            }\n        });\n\n        this.toggleEmptyState(visibleCount === 0);\n        this.updateAvailableCount(visibleCount);\n    }\n\n    handleFilter(event) {\n        const position = event.target.value.toLowerCase();\n        const container = document.getElementById('available-players');\n        if (!container) return;\n\n        const playerColumns = Array.from(container.children);\n        let visibleCount = 0;\n\n        // Refactored: Using d-block/d-none classes instead of style.display\n        playerColumns.forEach(column => {\n            const playerCard = column.querySelector('[data-component=\"player-card\"]');\n            if (playerCard) {\n                const playerPosition = playerCard.getAttribute('data-position') || '';\n                const shouldShow = !position || playerPosition.includes(position);\n\n                if (shouldShow) {\n                    column.classList.remove('d-none');\n                    column.classList.add('d-block');\n                    visibleCount++;\n                } else {\n                    column.classList.add('d-none');\n                    column.classList.remove('d-block');\n                }\n            }\n        });\n\n        this.toggleEmptyState(visibleCount === 0);\n        this.updateAvailableCount(visibleCount);\n    }\n\n    handleSort(event) {\n        const sortBy = event.target.value;\n        const container = document.getElementById('available-players');\n        if (!container) return;\n\n        const players = Array.from(container.children); // Get all column divs that contain player cards\n\n        players.sort((a, b) => {\n            // Get the player card element within each column div\n            const cardA = a.querySelector('[data-component=\"player-card\"]');\n            const cardB = b.querySelector('[data-component=\"player-card\"]');\n\n            if (!cardA || !cardB) return 0;\n\n            let aValue, bValue;\n\n            switch (sortBy) {\n                case 'name':\n                    aValue = cardA.getAttribute('data-player-name') || '';\n                    bValue = cardB.getAttribute('data-player-name') || '';\n                    return aValue.localeCompare(bValue);\n\n                case 'experience':\n                    aValue = parseInt(cardA.getAttribute('data-experience')) || 0;\n                    bValue = parseInt(cardB.getAttribute('data-experience')) || 0;\n                    return bValue - aValue;\n\n                case 'attendance':\n                    aValue = parseInt(cardA.getAttribute('data-attendance')) || 0;\n                    bValue = parseInt(cardB.getAttribute('data-attendance')) || 0;\n                    return bValue - aValue;\n\n                case 'goals':\n                    aValue = parseInt(cardA.getAttribute('data-goals')) || 0;\n                    bValue = parseInt(cardB.getAttribute('data-goals')) || 0;\n                    return bValue - aValue;\n\n                default:\n                    return 0;\n            }\n        });\n\n        // Clear the container and re-add in sorted order\n        players.forEach(player => {\n            container.appendChild(player);\n        });\n\n        // Clean up any empty column divs that might exist\n        Array.from(container.children).forEach(child => {\n            if (child.hasAttribute('data-component') && child.getAttribute('data-component') === 'player-column' && !child.querySelector('[data-component=\"player-card\"]')) {\n                child.remove();\n            }\n        });\n    }\n\n    showDraftModal(playerId, playerName) {\n        this.currentPlayerId = playerId;\n\n        // Get teams data for SweetAlert options\n        const teams = [];\n        document.querySelectorAll('#teamsAccordion [data-component=\"team-item\"]').forEach(item => {\n            const button = item.querySelector('[data-component=\"team-toggle\"]');\n            const teamName = button.querySelector('[data-component=\"team-name\"]').textContent.trim();\n            const playerCount = button.querySelector('[data-component=\"player-count\"]').textContent.trim();\n            const teamId = item.querySelector('[data-team-id]').getAttribute('data-team-id');\n\n            teams.push({\n                text: `${teamName} (${playerCount})`,\n                value: teamId\n            });\n        });\n\n        if (window.Swal) {\n            Swal.fire({\n                title: 'Draft Player',\n                html: `Select a team for <strong>${playerName}</strong>:`,\n                input: 'select',\n                inputOptions: teams.reduce((obj, team) => {\n                    obj[team.value] = team.text;\n                    return obj;\n                }, {}),\n                inputPlaceholder: 'Choose a team...',\n                showCancelButton: true,\n                confirmButtonText: 'Draft Player',\n                cancelButtonText: 'Cancel',\n                customClass: {\n                    confirmButton: 'btn btn-primary',\n                    cancelButton: 'btn btn-secondary'\n                },\n                buttonsStyling: false,\n                inputValidator: (value) => {\n                    if (!value) {\n                        return 'Please select a team!';\n                    }\n                }\n            }).then((result) => {\n                if (result.isConfirmed) {\n                    const teamId = result.value;\n                    const teamName = teams.find(t => t.value === teamId)?.text?.split(' (')[0] || 'Unknown Team';\n                    this.confirmDraft(teamId, teamName);\n                }\n                this.currentPlayerId = null;\n            });\n        } else {\n            // Fallback to standard modal if SweetAlert2 not available\n            const teamId = prompt(`Select team ID for ${playerName}:`);\n            if (teamId) {\n                this.confirmDraft(teamId, 'Selected Team');\n            }\n        }\n    }\n\n    confirmDraft(teamId, teamName) {\n        if (!this.currentPlayerId) {\n            this.showToast('No player selected', 'error');\n            return;\n        }\n\n        if (!this.socket || !this.isConnected) {\n            this.showToast('Not connected to server - cannot draft', 'error');\n            return;\n        }\n\n        // Get player name for the status indicator\n        const playerCard = document.querySelector(`[data-player-id=\"${this.currentPlayerId}\"]`);\n        const playerName = playerCard ? (playerCard.querySelector('.fw-semibold')?.textContent || 'Player') : 'Player';\n\n        // Phase 5: Show detailed drafting indicator\n        this.showDraftingIndicator(playerName, teamName);\n\n        this.socket.emit('draft_player_enhanced', {\n            player_id: this.currentPlayerId,\n            team_id: teamId,\n            league_name: this.leagueName,\n            player_name: playerName  // Include for multi-user awareness\n        });\n\n        // Set a timeout to hide indicator if no response is received\n        setTimeout(() => {\n            if (document.getElementById('currentDraftIndicator')) {\n                this.hideDraftingIndicator();\n                this.showToast('Draft timed out. Please refresh.', 'warning');\n            }\n        }, 10000); // 10 second timeout\n\n        this.currentPlayerId = null;\n    }\n\n    // Phase 5: Draft Operation Status Indicators\n\n    showDraftingIndicator(playerName, teamName) {\n        // Remove any existing indicator\n        this.hideDraftingIndicator();\n\n        const indicator = document.createElement('div');\n        indicator.id = 'currentDraftIndicator';\n        indicator.className = 'drafting-indicator';\n        indicator.innerHTML = `\n            <div class=\"d-flex align-items-center gap-3\">\n                <div class=\"spinner-border spinner-border-sm text-primary\" role=\"status\">\n                    <span class=\"visually-hidden\">Drafting...</span>\n                </div>\n                <div>\n                    <strong>Drafting ${playerName}</strong>\n                    <div class=\"small text-muted\">to ${teamName}</div>\n                </div>\n            </div>\n        `;\n        document.body.appendChild(indicator);\n    }\n\n    hideDraftingIndicator() {\n        const indicator = document.getElementById('currentDraftIndicator');\n        if (indicator) {\n            // Refactored: Using animation class instead of inline style\n            indicator.classList.add('animate-slide-out-right');\n            setTimeout(() => indicator.remove(), 300);\n        }\n    }\n\n    showUserActivity(username, playerName, teamName) {\n        const activityContainer = document.getElementById('draftActivity');\n        if (!activityContainer) {\n            // Create container if it doesn't exist\n            const container = document.createElement('div');\n            container.id = 'draftActivity';\n            container.className = 'draft-activity-container';\n            document.body.appendChild(container);\n        }\n\n        const activity = document.createElement('div');\n        activity.className = 'user-activity-toast';\n        activity.innerHTML = `\n            <i class=\"ti ti-user-check text-primary me-2\"></i>\n            <div>\n                <strong>${username}</strong> is drafting <strong>${playerName}</strong>\n                ${teamName ? `<div class=\"small text-muted\">to ${teamName}</div>` : ''}\n            </div>\n        `;\n\n        document.getElementById('draftActivity').appendChild(activity);\n\n        // Auto-remove after 5 seconds\n        // Refactored: Using animation class instead of inline style\n        setTimeout(() => {\n            activity.classList.add('animate-fade-out');\n            setTimeout(() => activity.remove(), 300);\n        }, 5000);\n    }\n\n    async fallbackDraftPlayer(playerId, teamId, teamName) {\n        try {\n            // console.log(` HTTP Fallback: Drafting player ${playerId} to team ${teamId}`);\n            this.showLoading();\n\n            // Get CSRF token\n            const csrfToken = document.querySelector('meta[name=csrf-token]')?.getAttribute('content');\n            const headers = {\n                'Content-Type': 'application/json'\n            };\n\n            if (csrfToken) {\n                headers['X-CSRFToken'] = csrfToken;\n            }\n\n            const response = await fetch('/draft/api/draft-player', {\n                method: 'POST',\n                headers: headers,\n                body: JSON.stringify({\n                    player_id: playerId,\n                    team_id: teamId,\n                    league_name: this.leagueName\n                })\n            });\n\n            if (response.ok) {\n                const data = await response.json();\n                // Manually update the UI since we don't have socket updates\n                this.handlePlayerDrafted(data);\n                this.showToast(`${data.player.name} drafted to ${teamName}`, 'success');\n            } else {\n                const error = await response.json();\n                this.showToast(error.message || 'Draft failed', 'error');\n            }\n        } catch (error) {\n            // console.error('Fallback draft failed:', error);\n            this.showToast('Draft failed - please try again', 'error');\n        } finally {\n            this.hideLoading();\n            this.currentPlayerId = null;\n        }\n    }\n\n    removePlayer(playerId, teamId) {\n        if (!this.socket || !this.isConnected) {\n            this.showToast('Not connected to server', 'error');\n            return;\n        }\n\n        this.showLoading();\n        this.socket.emit('remove_player_enhanced', {\n            player_id: playerId,\n            team_id: teamId,\n            league_name: this.leagueName\n        });\n    }\n\n    handlePlayerDrafted(data) {\n        this.hideLoading();\n\n        // Remove from available players - specifically target the available pool\n        const availableContainer = document.getElementById('available-players');\n        if (availableContainer) {\n            const playerColumn = availableContainer.querySelector(`[data-player-id=\"${data.player.id}\"]`)?.closest('[data-component=\"player-column\"]');\n            if (playerColumn) {\n                // Refactored: Using CSS classes for enhanced animation\n                // Set initial height for smooth collapse\n                const currentHeight = playerColumn.offsetHeight;\n                playerColumn.style.maxHeight = currentHeight + 'px';\n\n                // Add transition class\n                playerColumn.classList.add('transition-smooth');\n\n                // Apply exit animation classes\n                requestAnimationFrame(() => {\n                    playerColumn.classList.add('opacity-0');\n                    playerColumn.classList.add('scale-90');\n                    playerColumn.style.transform = 'scale(0.8) translateY(-10px)';\n\n                    // Start the collapse animation\n                    setTimeout(() => {\n                        playerColumn.classList.add('max-h-0', 'mb-0-important', 'pt-0-important', 'pb-0-important', 'overflow-hidden');\n                        playerColumn.style.maxHeight = '0';\n                    }, 100);\n                });\n\n                // Remove after animation completes\n                setTimeout(() => {\n                    playerColumn.remove();\n                    this.updatePlayerCounts();\n                }, 400);\n            }\n        }\n\n        // Add to team\n        this.addPlayerToTeam(data.player, data.team_id, data.team_name);\n        this.showToast(`${data.player.name} drafted to ${data.team_name}`, 'success');\n    }\n\n    addPlayerToTeam(player, teamId, teamName) {\n        const teamSection = document.getElementById(`teamPlayers${teamId}`);\n        if (!teamSection) {\n            // console.error(`Team section not found for team ${teamId}`);\n            return;\n        }\n\n        // Create the player card HTML\n        const playerCard = document.createElement('div');\n        playerCard.className = 'col-md-6 col-lg-4';\n        playerCard.setAttribute('data-component', 'team-player-card');\n        playerCard.setAttribute('data-player-id', player.id);\n\n        const profilePictureUrl = player.profile_picture_url || '/static/img/default_player.png';\n\n        playerCard.innerHTML = `\n            <div class=\"card border-0 shadow-sm position-relative\"\n                 style=\"min-height: 120px; cursor: grab;\"\n                 draggable=\"true\"\n                 ondragstart=\"handleDragStart(event, ${player.id})\"\n                 ondragend=\"handleDragEnd(event)\">\n                ${player.is_ref ? `\n                <div class=\"position-absolute top-0 start-0\" style=\"z-index: 2;\">\n                    <div class=\"bg-danger text-white\" style=\"padding: 2px 4px; border-radius: 0 0 8px 0; font-size: 10px; font-weight: bold;\" title=\"Referee\">\n                        REF\n                    </div>\n                </div>\n                ` : ''}\n                <div class=\"card-body p-2\">\n                    <div class=\"d-flex align-items-center mb-2\">\n                        <img src=\"${profilePictureUrl}\"\n                             alt=\"${player.name}\"\n                             class=\"rounded-circle me-2\"\n                             style=\"width: 40px; height: 40px; object-fit: cover;\"\n                             loading=\"lazy\"\n                             onerror=\"this.src='/static/img/default_player.png';\">\n                        <div class=\"flex-grow-1 min-width-0\">\n                            <div class=\"fw-semibold text-truncate small\">${player.name}</div>\n                            <div class=\"text-muted\" style=\"font-size: 0.75rem;\">\n                                ${formatPosition(player.favorite_position) || 'Any'}\n                            </div>\n                        </div>\n                        <button class=\"btn btn-outline-danger btn-sm p-1\"\n                                data-action=\"remove-player\"\n                                data-player-id=\"${player.id}\"\n                                data-team-id=\"${teamId}\"\n                                data-player-name=\"${player.name}\"\n                                data-team-name=\"${teamName}\"\n                                title=\"Remove ${player.name}\">\n                            <i class=\"ti ti-x\" style=\"font-size: 0.75rem;\"></i>\n                        </button>\n                    </div>\n                    <div class=\"d-flex justify-content-between text-center small\">\n                        <div>\n                            <div class=\"fw-bold text-success\">${player.career_goals || 0}</div>\n                            <div class=\"text-muted\" style=\"font-size: 0.7rem;\">Goals</div>\n                        </div>\n                        <div>\n                            <div class=\"fw-bold text-info\">${player.career_assists || 0}</div>\n                            <div class=\"text-muted\" style=\"font-size: 0.7rem;\">Assists</div>\n                        </div>\n                        <div>\n                            <div class=\"fw-bold\">\n                                <span class=\"text-warning\">${player.career_yellow_cards || 0}</span>/<span class=\"text-danger\">${player.career_red_cards || 0}</span>\n                            </div>\n                            <div class=\"text-muted\" style=\"font-size: 0.7rem;\">Cards</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        // Refactored: Using CSS classes for animation instead of inline styles\n        playerCard.classList.add('draft-card-enter');\n        teamSection.appendChild(playerCard);\n\n        // Animate in\n        setTimeout(() => {\n            playerCard.classList.remove('draft-card-enter');\n            playerCard.classList.add('draft-card-enter-active');\n        }, 10);\n\n        // Update team count\n        this.updateTeamCount(teamId);\n    }\n\n    updateTeamCount(teamId) {\n        const teamSection = document.getElementById(`teamPlayers${teamId}`);\n        const teamCountBadge = document.getElementById(`teamCount${teamId}`);\n\n        if (teamSection && teamCountBadge) {\n            // Count ONLY the player card elements, not buttons inside them\n            const playerCount = teamSection.querySelectorAll('.draft-team-player-card').length;\n            teamCountBadge.textContent = `${playerCount} players`;\n            // console.log(`Updated team ${teamId} count to ${playerCount} players`);\n        }\n    }\n\n    addPlayerToAvailable(player) {\n        const availableContainer = document.getElementById('available-players');\n        if (!availableContainer) {\n            // console.error('Available players container not found');\n            return;\n        }\n\n        // Create the player card HTML for available players\n        const playerCard = document.createElement('div');\n        playerCard.className = 'col-xl-3 col-lg-4 col-md-6 col-sm-6';\n        playerCard.setAttribute('data-component', 'player-column');\n\n        const profilePictureUrl = player.profile_picture_url || '/static/img/default_player.png';\n        const experienceLevel = player.experience_level || player.league_experience_seasons || 'Unknown';\n        const position = formatPosition(player.favorite_position || player.position) || 'Any';\n\n        // Get enhanced player data\n        const mediumPictureUrl = player.profile_picture_medium || player.profile_picture_webp || profilePictureUrl;\n        const experienceSeasons = player.league_experience_seasons || 0;\n        const attendanceEstimate = player.attendance_estimate || 75;\n        const expectedAvailability = player.expected_weeks_available || 'All weeks';\n\n        // Get experience badge color\n        let experienceBadgeColor = 'secondary';\n        if (experienceLevel === 'Veteran') experienceBadgeColor = 'success';\n        else if (experienceLevel === 'Experienced') experienceBadgeColor = 'warning';\n\n        // Get attendance color and display\n        let attendanceColor = 'muted';\n        let attendanceDisplay = 'No data';\n        if (attendanceEstimate !== null && attendanceEstimate !== undefined) {\n            attendanceDisplay = `${Math.round(attendanceEstimate)}%`;\n            if (attendanceEstimate >= 80) attendanceColor = 'success';\n            else if (attendanceEstimate >= 60) attendanceColor = 'warning';\n            else attendanceColor = 'danger';\n        }\n\n        playerCard.innerHTML = `\n            <div id=\"player-${player.id}\" class=\"card border-0 shadow-sm h-100\"\n                 data-component=\"player-card\"\n                 data-player-id=\"${player.id}\"\n                 data-player-name=\"${player.name.toLowerCase()}\"\n                 data-position=\"${position.toLowerCase()}\"\n                 data-experience=\"${experienceSeasons}\"\n                 data-attendance=\"${attendanceEstimate}\"\n                 data-goals=\"${player.career_goals || 0}\"\n                 draggable=\"true\"\n                 ondragstart=\"handleDragStart(event, ${player.id})\"\n                 ondragend=\"handleDragEnd(event)\"\n                 style=\"cursor: grab; transition: all 0.2s ease; min-height: 320px;\">\n\n                <!-- Player Image Header -->\n                <div class=\"position-relative overflow-hidden\" style=\"height: 120px;\">\n                    <!-- Full Header Player Image -->\n                    <img src=\"${mediumPictureUrl}\"\n                         alt=\"${player.name}\"\n                         class=\"player-face-crop\"\n                         style=\"width: 100%; height: 100%; object-fit: cover; object-position: center 20%; display: block !important; visibility: visible !important; opacity: 1 !important;\"\n                         loading=\"eager\"\n                         onerror=\"// console.log('Image failed to load:', this.src); this.src='/static/img/default_player.png';\"\n                         onload=\"// console.log('Image loaded successfully:', this.src); if(typeof smartCropImage === 'function') smartCropImage(this);\">\n\n                    <!-- Dark overlay for better text readability -->\n                    <div class=\"position-absolute w-100 h-100\" style=\"background: rgba(0,0,0,0.3); top: 0; left: 0;\"></div>\n\n                    <!-- Experience Badge - Small Corner Tag -->\n                    <div class=\"position-absolute top-0 end-0\" style=\"z-index: 2;\">\n                        <div class=\"experience-corner-tag bg-${experienceBadgeColor}\"\n                             title=\"${experienceLevel}\">\n                            <span class=\"experience-initial\">\n                                ${experienceLevel[0] || 'N'}\n                            </span>\n                        </div>\n                    </div>\n\n                    <!-- Player Name Overlay -->\n                    <div class=\"position-absolute bottom-0 start-0 p-2\" style=\"z-index: 2;\">\n                        <h6 class=\"text-white fw-bold mb-0 text-shadow-sm\">${player.name}</h6>\n                    </div>\n                </div>\n\n                <!-- Player Info Body -->\n                <div class=\"card-body p-3 text-center\">\n                    <!-- Position Badge -->\n                    <div class=\"mb-2\">\n                        ${position !== 'Any' ?\n                            `<span class=\"badge bg-primary rounded-pill\">${position}</span>` :\n                            `<span class=\"badge bg-secondary rounded-pill\">Any Position</span>`\n                        }\n                    </div>\n\n                    <!-- Stats Row -->\n                    <div class=\"row text-center mb-2 small\">\n                        <div class=\"col-6\">\n                            <div class=\"fw-bold text-success\">${player.career_goals || 0}</div>\n                            <div class=\"text-muted\">Goals</div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"fw-bold text-info\">${player.career_assists || 0}</div>\n                            <div class=\"text-muted\">Assists</div>\n                        </div>\n                    </div>\n\n                    <!-- Cards & Attendance -->\n                    <div class=\"row text-center mb-3 small\">\n                        <div class=\"col-6\">\n                            <div class=\"fw-bold\">\n                                <span class=\"text-warning\">${player.career_yellow_cards || 0}</span>/<span class=\"text-danger\">${player.career_red_cards || 0}</span>\n                            </div>\n                            <div class=\"text-muted\">Y/R Cards</div>\n                        </div>\n                        <div class=\"col-6\">\n                            <div class=\"fw-bold text-${attendanceColor}\">\n                                ${attendanceDisplay}\n                            </div>\n                            <div class=\"text-muted\">Attendance</div>\n                        </div>\n                    </div>\n\n                    <!-- Experience Info -->\n                    <div class=\"small text-muted mb-2\">\n                        ${experienceSeasons} season${experienceSeasons !== 1 ? 's' : ''}\n                    </div>\n\n                    <!-- Availability Info -->\n                    ${expectedAvailability !== 'All weeks' ?\n                        `<div class=\"small text-info mb-3\">\n                            <i class=\"ti ti-calendar-event me-1\"></i><strong>Expected:</strong> ${expectedAvailability}\n                        </div>` :\n                        `<div class=\"small text-success mb-3\">\n                            <i class=\"ti ti-calendar-check me-1\"></i><strong>Available:</strong> All weeks\n                        </div>`\n                    }\n                </div>\n\n                <!-- Action Buttons -->\n                <div class=\"card-footer bg-transparent border-0 p-2\">\n                    <div class=\"d-grid gap-1\">\n                        <button class=\"btn btn-success btn-sm fw-bold\"\n                                data-action=\"draft-player\"\n                                data-player-id=\"${player.id}\"\n                                data-player-name=\"${player.name}\"\n                                style=\"background: linear-gradient(45deg, var(--ecs-success, #28a745), var(--ecs-success-light, #20c997));\">\n                            <i class=\"ti ti-user-plus me-1\"></i>Draft Player\n                        </button>\n                        <button class=\"btn btn-outline-info btn-sm\"\n                                data-action=\"view-player-profile\"\n                                data-player-id=\"${player.id}\">\n                            <i class=\"ti ti-user me-1\"></i>View Profile\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        // Refactored: Using CSS classes for animation instead of inline styles\n        playerCard.classList.add('draft-card-enter');\n        availableContainer.appendChild(playerCard);\n\n        // Clean up any empty column divs that might have been created\n        Array.from(availableContainer.children).forEach(child => {\n            if (child.hasAttribute('data-component') && child.getAttribute('data-component') === 'player-column' && !child.querySelector('[data-component=\"player-card\"]')) {\n                child.remove();\n            }\n        });\n\n        // Force a micro-delay to ensure DOM is ready, then apply sorting and filtering\n        setTimeout(() => {\n            // Apply current sorting if active\n            const sortSelect = document.getElementById('sortPlayers');\n            if (sortSelect && sortSelect.value && sortSelect.value !== 'default') {\n                this.handleSort({ target: sortSelect });\n            }\n\n            // Apply current filters - Refactored: Using d-none class\n            const searchInput = document.getElementById('searchPlayers');\n            const positionFilter = document.getElementById('filterPosition');\n\n            if (searchInput && searchInput.value) {\n                const searchTerm = searchInput.value.toLowerCase();\n                const cardElement = playerCard.querySelector('[data-component=\"player-card\"]');\n                const playerName = cardElement.getAttribute('data-player-name') || '';\n                if (!playerName.includes(searchTerm)) {\n                    playerCard.classList.add('d-none');\n                }\n            }\n\n            if (positionFilter && positionFilter.value) {\n                const filterPosition = positionFilter.value.toLowerCase();\n                const cardElement = playerCard.querySelector('[data-component=\"player-card\"]');\n                const playerPosition = cardElement.getAttribute('data-position') || '';\n                if (filterPosition && !playerPosition.includes(filterPosition)) {\n                    playerCard.classList.add('d-none');\n                }\n            }\n        }, 50);\n\n        // Animate in\n        setTimeout(() => {\n            playerCard.classList.remove('draft-card-enter');\n            playerCard.classList.add('draft-card-enter-active');\n        }, 10);\n\n        // Update available player count\n        this.updatePlayerCounts();\n    }\n\n    handlePlayerRemoved(data) {\n        this.hideLoading();\n\n        // Remove from team\n        this.removePlayerFromTeam(data.player.id, data.team_id);\n\n        // Add back to available players\n        this.addPlayerToAvailable(data.player);\n\n        this.showToast(`${data.player.name} removed from ${data.team_name}`, 'info');\n    }\n\n    removePlayerFromTeam(playerId, teamId) {\n        const playerCard = document.querySelector(`#teamPlayers${teamId} [data-player-id=\"${playerId}\"]`);\n        if (playerCard) {\n            // Refactored: Using CSS classes instead of inline styles\n            playerCard.classList.add('team-player-exit');\n            setTimeout(() => {\n                playerCard.remove();\n                this.updateTeamCount(teamId);\n            }, 300);\n        }\n    }\n\n    handlePlayerDetails(data) {\n        const modalContent = document.getElementById('playerProfileContent');\n        if (!modalContent) return;\n\n        const player = data.player;\n\n        // Create detailed player profile HTML\n        // Note: Image display logic in HTML uses inline handlers for onload/onerror\n        const profileHtml = `\n            <div class=\"row\">\n                <div class=\"col-md-4 text-center\">\n                    <div class=\"player-avatar-container mx-auto mb-3\" style=\"width: 120px; height: 120px;\">\n                        <div class=\"player-avatar-fallback\">\n                            ${player.name.substring(0, 2).toUpperCase()}\n                        </div>\n                        ${player.profile_picture_url ?\n                            `<img src=\"${player.profile_picture_url}\" alt=\"${player.name}\" class=\"player-avatar\"\n                                  onload=\"this.classList.add('d-block'); this.classList.remove('d-none'); this.previousElementSibling.classList.add('d-none'); this.previousElementSibling.classList.remove('d-flex');\"\n                                  onerror=\"this.classList.add('d-none'); this.classList.remove('d-block'); this.previousElementSibling.classList.add('d-flex'); this.previousElementSibling.classList.remove('d-none');\">`\n                            : ''\n                        }\n                    </div>\n                    <h4 class=\"fw-bold mb-2\">${player.name}</h4>\n                    <div class=\"mb-3\">\n                        ${player.favorite_position ?\n                            `<span class=\"badge badge-position\">${formatPosition(player.favorite_position)}</span>`\n                            : ''\n                        }\n                        <span class=\"badge badge-${player.experience_level === 'Veteran' ? 'veteran' :\n                            player.experience_level === 'Experienced' ? 'experienced' : 'new-player'}\">\n                            ${player.experience_level}\n                        </span>\n                    </div>\n                </div>\n                <div class=\"col-md-8\">\n                    <div class=\"row\">\n                        <div class=\"col-sm-6 mb-3\">\n                            <h6 class=\"text-muted mb-1\">Career Stats</h6>\n                            <div class=\"d-flex gap-2 flex-wrap\">\n                                <span class=\"stat-chip stat-goals\">${player.career_goals}G</span>\n                                <span class=\"stat-chip stat-assists\">${player.career_assists}A</span>\n                                <span class=\"stat-chip bg-warning text-dark\">${player.career_yellow_cards}Y</span>\n                                <span class=\"stat-chip bg-danger\">${player.career_red_cards}R</span>\n                                <span class=\"stat-chip stat-seasons\">${player.league_experience_seasons}T</span>\n                            </div>\n                        </div>\n                        <div class=\"col-sm-6 mb-3\">\n                            <h6 class=\"text-muted mb-1\">Season Stats</h6>\n                            <div class=\"d-flex gap-2 flex-wrap\">\n                                <span class=\"stat-chip stat-goals\">${player.season_goals}G</span>\n                                <span class=\"stat-chip stat-assists\">${player.season_assists}A</span>\n                                <span class=\"stat-chip bg-warning text-dark\">${player.season_yellow_cards}Y</span>\n                                <span class=\"stat-chip bg-danger\">${player.season_red_cards}R</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-sm-6 mb-3\">\n                            <h6 class=\"text-muted mb-1\">Attendance</h6>\n                            <div class=\"attendance-section\">\n                                <div class=\"attendance-label\">\n                                    <span>Rate</span>\n                                    <span class=\"fw-bold\">${Math.round(player.attendance_estimate)}%</span>\n                                </div>\n                                <div class=\"attendance-bar\">\n                                    <div class=\"attendance-fill attendance-${player.attendance_estimate >= 80 ? 'excellent' :\n                                        player.attendance_estimate >= 60 ? 'good' : 'poor'}\"\n                                         style=\"width: ${player.attendance_estimate}%\"></div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-sm-6 mb-3\">\n                            <h6 class=\"text-muted mb-1\">Reliability</h6>\n                            <div class=\"text-center\">\n                                <div class=\"fs-4 fw-bold text-primary\">${Math.round(player.reliability_score)}%</div>\n                                <small class=\"text-muted\">Response Rate: ${Math.round(player.rsvp_response_rate)}%</small>\n                            </div>\n                        </div>\n                    </div>\n                    ${player.player_notes ?\n                        `<div class=\"mb-3\">\n                            <h6 class=\"text-muted mb-1\">Player Notes</h6>\n                            <p class=\"mb-0\">${player.player_notes}</p>\n                        </div>`\n                        : ''\n                    }\n                    ${player.admin_notes ?\n                        `<div class=\"mb-3\">\n                            <h6 class=\"text-muted mb-1\">Admin/Coach Notes</h6>\n                            <p class=\"mb-0\">${player.admin_notes}</p>\n                        </div>`\n                        : ''\n                    }\n                    ${player.expected_weeks_available && player.expected_weeks_available !== 'All weeks' ?\n                        `<div class=\"mb-3\">\n                            <h6 class=\"text-muted mb-1\">Availability</h6>\n                            <p class=\"mb-0\">${player.expected_weeks_available}</p>\n                        </div>`\n                        : ''\n                    }\n                </div>\n            </div>\n            ${player.match_history && player.match_history.length > 0 ?\n                `<hr>\n                <h6 class=\"text-muted mb-3\">Recent Match History</h6>\n                <div class=\"table-responsive\">\n                    <table class=\"table table-sm\">\n                        <thead>\n                            <tr>\n                                <th>Date</th>\n                                <th>Goals</th>\n                                <th>Assists</th>\n                                <th>Cards</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${player.match_history.map(match => `\n                                <tr>\n                                    <td>${match.date}</td>\n                                    <td>${match.goals}</td>\n                                    <td>${match.assists}</td>\n                                    <td>\n                                        ${match.yellow_cards ? `<span class=\"badge bg-warning\">${match.yellow_cards}Y</span>` : ''}\n                                        ${match.red_cards ? `<span class=\"badge bg-danger\">${match.red_cards}R</span>` : ''}\n                                    </td>\n                                </tr>\n                            `).join('')}\n                        </tbody>\n                    </table>\n                </div>`\n                : ''\n            }\n        `;\n\n        modalContent.innerHTML = profileHtml;\n    }\n\n    updatePlayerCounts() {\n        // Update available count\n        const availableCount = document.querySelectorAll('[data-component=\"player-item\"]').length;\n        const countElement = document.getElementById('availableCount');\n        if (countElement) {\n            countElement.textContent = availableCount;\n        }\n\n        // Update team counts - use .draft-team-player-card to avoid counting buttons\n        document.querySelectorAll('[id^=\"teamCount\"]').forEach(counter => {\n            const teamId = counter.id.replace('teamCount', '');\n            const playerCount = document.querySelectorAll(`#teamPlayers${teamId} .draft-team-player-card`).length;\n            counter.textContent = `${playerCount} players`;\n        });\n    }\n\n    updateAvailableCount(count) {\n        const countElement = document.getElementById('availableCount');\n        if (countElement) {\n            countElement.textContent = count;\n        }\n    }\n\n    toggleEmptyState(show) {\n        const emptyState = document.getElementById('emptyState');\n        const playersContainer = document.getElementById('playersContainer');\n\n        // Refactored: Using d-block/d-none classes instead of inline style.display\n        if (emptyState) {\n            if (show) {\n                emptyState.classList.add('d-block');\n                emptyState.classList.remove('d-none');\n            } else {\n                emptyState.classList.add('d-none');\n                emptyState.classList.remove('d-block');\n            }\n        }\n        if (playersContainer) {\n            if (show) {\n                playersContainer.classList.add('d-none');\n                playersContainer.classList.remove('d-block');\n            } else {\n                playersContainer.classList.add('d-block');\n                playersContainer.classList.remove('d-none');\n            }\n        }\n    }\n\n    showLoading() {\n        const overlay = document.querySelector('[data-component=\"draft-loading-overlay\"]');\n        if (overlay) {\n            overlay.classList.add('is-visible');\n            overlay.classList.remove('is-hidden');\n        }\n    }\n\n    hideLoading() {\n        const overlay = document.querySelector('[data-component=\"draft-loading-overlay\"]');\n        if (overlay) {\n            overlay.classList.add('is-hidden');\n            overlay.classList.remove('is-visible');\n        }\n    }\n\n    showToast(message, type = 'info') {\n        // Use SweetAlert2 for notifications\n        if (window.Swal) {\n            const iconMap = {\n                'success': 'success',\n                'error': 'error',\n                'warning': 'warning',\n                'info': 'info'\n            };\n\n            Swal.fire({\n                title: message,\n                icon: iconMap[type] || 'info',\n                toast: true,\n                position: 'top-end',\n                showConfirmButton: false,\n                timer: 3000,\n                timerProgressBar: true\n            });\n        } else if (window.showToast) {\n            // Fallback to existing toast system\n            window.showToast(message, type);\n        } else {\n            // console.log(`${type.toUpperCase()}: ${message}`);\n        }\n    }\n\n    closeModals() {\n        const modals = document.querySelectorAll('[data-component=\"modal\"][data-state=\"open\"]');\n        modals.forEach(modal => {\n            const bsModal = bootstrap.Modal.getInstance(modal);\n            if (bsModal) bsModal.hide();\n        });\n    }\n\n    refreshDraft() {\n        this.showLoading();\n        setTimeout(() => {\n            window.location.reload();\n        }, 500);\n    }\n\n    viewPlayerProfile(playerId) {\n        if (!this.socket || !this.isConnected) {\n            this.showToast('Not connected to server', 'error');\n            return;\n        }\n\n        // Show modal\n        const modal = document.getElementById('playerProfileModal');\n        if (modal) {\n            ModalManager.show('playerProfileModal');\n\n            // Request player details via socket\n            this.socket.emit('get_player_details', { player_id: playerId });\n        }\n    }\n\n    // Drag and Drop functionality\n    handleDragStart(event, playerId) {\n        event.dataTransfer.setData('text/plain', playerId);\n        event.dataTransfer.effectAllowed = 'move';\n\n        // Refactored: Using CSS classes for visual feedback instead of inline styles\n        event.target.classList.add('opacity-50', 'dragging');\n\n        // Store the player ID for later use\n        this.draggedPlayerId = playerId;\n    }\n\n    handleDragEnd(event) {\n        // Refactored: Using CSS classes instead of inline styles\n        event.target.classList.remove('opacity-50', 'dragging');\n\n        // Clear stored player ID\n        this.draggedPlayerId = null;\n    }\n\n    handleDragOver(event) {\n        event.preventDefault();\n        event.dataTransfer.dropEffect = 'move';\n\n        // Add visual feedback to drop zone\n        const dropZone = event.currentTarget;\n        dropZone.classList.add('drag-over');\n\n        // Refactored: Using CSS classes for different drop zone states\n        if (dropZone.id === 'available-players') {\n            dropZone.classList.add('drag-over-available');\n        } else if (dropZone.id && dropZone.id.startsWith('teamSection')) {\n            dropZone.classList.add('drag-over-team');\n        } else if (dropZone.classList.contains('team-drop-zone')) {\n            dropZone.classList.add('drag-over-team-zone');\n        }\n    }\n\n    handleDragLeave(event) {\n        // Remove visual feedback from drop zone\n        const dropZone = event.currentTarget;\n\n        // Refactored: Remove all drag-over classes\n        dropZone.classList.remove('drag-over', 'drag-over-available', 'drag-over-team', 'drag-over-team-zone');\n    }\n\n    handleDrop(event, teamId) {\n        event.preventDefault();\n\n        // Refactored: Remove all drag-over classes\n        const dropZone = event.currentTarget;\n        dropZone.classList.remove('drag-over', 'drag-over-available', 'drag-over-team', 'drag-over-team-zone');\n\n        // Get the dragged player ID\n        const playerId = event.dataTransfer.getData('text/plain') || this.draggedPlayerId;\n\n        if (!playerId) {\n            this.showToast('No player data found', 'error');\n            return;\n        }\n\n        // Check if player is already on this team\n        const existingPlayerInTeam = document.querySelector(`#teamPlayers${teamId} [data-player-id=\"${playerId}\"]`);\n        if (existingPlayerInTeam) {\n            this.showToast('Player is already on this team', 'warning');\n            return;\n        }\n\n        // Get player info\n        const playerCard = document.querySelector(`[data-player-id=\"${playerId}\"]`);\n        const playerName = playerCard ? (playerCard.querySelector('.fw-semibold')?.textContent || 'Unknown Player') : 'Unknown Player';\n\n        // Get team name from the drop zone\n        let teamName = `Team ${teamId}`;\n        if (dropZone.classList.contains('team-drop-zone')) {\n            // We're dropping on the team accordion item\n            const teamNameElement = dropZone.querySelector('[data-component=\"team-name\"]');\n            teamName = teamNameElement ? teamNameElement.textContent.trim() : `Team ${teamId}`;\n        } else {\n            // We're dropping on the team section or other element\n            const teamAccordion = document.querySelector(`#teamSection${teamId}`)?.closest('[data-component=\"team-item\"]');\n            const teamNameElement = teamAccordion ? teamAccordion.querySelector('[data-component=\"team-name\"]') : null;\n            teamName = teamNameElement ? teamNameElement.textContent.trim() : `Team ${teamId}`;\n        }\n\n        // Draft the player directly (no confirmation needed for drag/drop)\n        this.currentPlayerId = playerId;\n        this.confirmDraft(teamId, teamName);\n    }\n\n    handleDropToAvailable(event) {\n        event.preventDefault();\n\n        // Refactored: Remove all drag-over classes\n        const dropZone = event.currentTarget;\n        dropZone.classList.remove('drag-over', 'drag-over-available', 'drag-over-team', 'drag-over-team-zone');\n\n        // Get the dragged player ID\n        const playerId = event.dataTransfer.getData('text/plain') || this.draggedPlayerId;\n\n        if (!playerId) {\n            this.showToast('No player data found', 'error');\n            return;\n        }\n\n        // Check if player is already in available pool\n        const existingPlayerInAvailable = document.querySelector(`#available-players [data-player-id=\"${playerId}\"]`);\n        if (existingPlayerInAvailable) {\n            this.showToast('Player is already in available pool', 'warning');\n            return;\n        }\n\n        // Find which team the player is currently on\n        const currentPlayerCard = document.querySelector(`[data-player-id=\"${playerId}\"]`);\n        const teamSection = currentPlayerCard ? currentPlayerCard.closest('[id^=\"teamPlayers\"]') : null;\n        const teamId = teamSection ? teamSection.id.replace('teamPlayers', '') : null;\n\n        if (!teamId) {\n            this.showToast('Could not determine current team', 'error');\n            return;\n        }\n\n        // Get player and team names\n        const playerName = currentPlayerCard ? (currentPlayerCard.querySelector('[data-component=\"player-name\"]')?.textContent || 'Unknown Player') : 'Unknown Player';\n        const teamNameElement = document.querySelector(`#teamSection${teamId}`).closest('[data-component=\"team-item\"]').querySelector('[data-component=\"team-name\"]');\n        const teamName = teamNameElement ? teamNameElement.textContent.trim() : `Team ${teamId}`;\n\n        // Remove player from team (send to backend)\n        this.removePlayer(playerId, teamId);\n    }\n\n    // ===== Position Highlighting System =====\n\n    async fetchPositionAnalysis(teamId) {\n        /**\n         * Fetch position analysis from backend API\n         */\n        try {\n            const response = await fetch(`/draft/api/${this.leagueName}/position-analysis/${teamId}`);\n            if (response.ok) {\n                return await response.json();\n            } else {\n                console.error('Failed to fetch position analysis:', response.status);\n                return null;\n            }\n        } catch (error) {\n            console.error('Error fetching position analysis:', error);\n            return null;\n        }\n    }\n\n    async updatePositionHighlighting(activeTeamId) {\n        /**\n         * Update player highlighting based on position fit for active team\n         */\n        if (!activeTeamId) {\n            // Clear all highlighting if no team selected\n            document.querySelectorAll('[data-component=\"player-card\"]').forEach(card => {\n                card.classList.remove('highlight-strong', 'highlight-moderate');\n                const badge = card.querySelector('[data-component=\"position-fit-badge\"]');\n                if (badge) badge.remove();\n            });\n            return;\n        }\n\n        // Fetch position analysis for this team\n        const analysis = await this.fetchPositionAnalysis(activeTeamId);\n        if (!analysis || !analysis.player_fit_scores) {\n            return;\n        }\n\n        // Apply highlighting to player cards\n        document.querySelectorAll('[data-component=\"player-card\"]').forEach(card => {\n            const playerId = parseInt(card.dataset.playerId);\n            if (!playerId) return;\n\n            // Remove existing highlighting\n            card.classList.remove('highlight-strong', 'highlight-moderate');\n            const existingBadge = card.querySelector('[data-component=\"position-fit-badge\"]');\n            if (existingBadge) existingBadge.remove();\n\n            // Get fit score for this player\n            const fitData = analysis.player_fit_scores[playerId];\n            if (!fitData) return;\n\n            // Apply highlighting based on fit category\n            if (fitData.fit_category === 'strong') {\n                card.classList.add('highlight-strong');\n                // Add badge\n                const badge = document.createElement('span');\n                badge.className = 'badge-strong';\n                badge.setAttribute('data-component', 'position-fit-badge');\n                badge.innerHTML = '<i class=\"ti ti-star-filled me-1\"></i>Position Fit';\n                badge.title = `${fitData.favorite_position} - Perfect match for team needs`;\n                card.appendChild(badge);\n            } else if (fitData.fit_category === 'moderate') {\n                card.classList.add('highlight-moderate');\n                // Add badge\n                const badge = document.createElement('span');\n                badge.className = 'badge-moderate';\n                badge.setAttribute('data-component', 'position-fit-badge');\n                badge.innerHTML = '<i class=\"ti ti-check me-1\"></i>Can Play';\n                badge.title = 'Can play needed position';\n                card.appendChild(badge);\n            }\n        });\n    }\n\n    setupTeamTabHighlighting() {\n        /**\n         * Set up event listeners for team tabs to trigger position highlighting\n         */\n        // Find all team tabs/sections\n        const teamTabs = document.querySelectorAll('[data-bs-toggle=\"collapse\"][data-team-id]');\n        teamTabs.forEach(tab => {\n            tab.addEventListener('click', (e) => {\n                const teamId = parseInt(e.currentTarget.dataset.teamId);\n                if (teamId) {\n                    // Delay slightly to allow accordion to open\n                    setTimeout(() => this.updatePositionHighlighting(teamId), 100);\n                }\n            });\n        });\n\n        // Also check if a team accordion is already open on page load\n        const openAccordion = document.querySelector('[data-component=\"team-collapse\"].show[data-team-id]');\n        if (openAccordion) {\n            const teamId = parseInt(openAccordion.dataset.teamId);\n            if (teamId) {\n                this.updatePositionHighlighting(teamId);\n            }\n        }\n    }\n}\n\n// Global instance\nlet draftSystemInstance = null;\n\n// Initialize function\nfunction initializeDraftSystem(leagueName) {\n    draftSystemInstance = new DraftSystemV2(leagueName);\n    return draftSystemInstance;\n}\n\n// Global functions for template compatibility\nfunction showDraftModal(playerId, playerName) {\n    if (draftSystemInstance) {\n        draftSystemInstance.showDraftModal(playerId, playerName);\n    }\n}\n\nfunction confirmDraftPlayer(playerId, playerName) {\n    if (draftSystemInstance) {\n        draftSystemInstance.showDraftModal(playerId, playerName);\n    }\n}\n\nfunction confirmRemovePlayer(playerId, teamId, playerName, teamName) {\n    if (!draftSystemInstance) return;\n\n    if (window.Swal) {\n        Swal.fire({\n            title: 'Remove Player',\n            text: `Remove ${playerName} from ${teamName}?`,\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonText: 'Yes, Remove Player',\n            cancelButtonText: 'Cancel',\n            customClass: {\n                confirmButton: 'btn btn-danger',\n                cancelButton: 'btn btn-secondary'\n            },\n            buttonsStyling: false\n        }).then((result) => {\n            if (result.isConfirmed) {\n                draftSystemInstance.removePlayer(playerId, teamId);\n            }\n        });\n    } else {\n        // Fallback\n        if (confirm(`Remove ${playerName} from ${teamName}?`)) {\n            draftSystemInstance.removePlayer(playerId, teamId);\n        }\n    }\n}\n\nfunction confirmDraft(teamId, teamName) {\n    if (draftSystemInstance) {\n        draftSystemInstance.confirmDraft(teamId, teamName);\n    }\n}\n\nfunction removePlayer(playerId, teamId) {\n    if (draftSystemInstance) {\n        draftSystemInstance.removePlayer(playerId, teamId);\n    }\n}\n\nfunction refreshDraft() {\n    if (draftSystemInstance) {\n        draftSystemInstance.refreshDraft();\n    }\n}\n\nfunction viewPlayerProfile(playerId) {\n    if (draftSystemInstance) {\n        draftSystemInstance.viewPlayerProfile(playerId);\n    }\n}\n\nfunction handleDragStart(event, playerId) {\n    if (draftSystemInstance) {\n        draftSystemInstance.handleDragStart(event, playerId);\n    }\n}\n\nfunction handleDragEnd(event) {\n    if (draftSystemInstance) {\n        draftSystemInstance.handleDragEnd(event);\n    }\n}\n\nfunction handleDragOver(event) {\n    if (draftSystemInstance) {\n        draftSystemInstance.handleDragOver(event);\n    }\n}\n\nfunction handleDragLeave(event) {\n    if (draftSystemInstance) {\n        draftSystemInstance.handleDragLeave(event);\n    }\n}\n\nfunction handleDrop(event, teamId) {\n    if (draftSystemInstance) {\n        draftSystemInstance.handleDrop(event, teamId);\n    }\n}\n\nfunction handleDropToAvailable(event) {\n    if (draftSystemInstance) {\n        draftSystemInstance.handleDropToAvailable(event);\n    }\n}\n\n// Global smartCropImage function for template compatibility\nfunction smartCropImage(img) {\n    if (draftSystemInstance) {\n        draftSystemInstance.smartCropImage(img);\n    }\n}\n\n// Export for module use\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = DraftSystemV2;\n}\n","/**\n * Profile Verification JavaScript\n * Ensures users review all sections before confirming profile\n * Implements section-by-section checkbox tracking\n */\n\n(function() {\n  'use strict';\n\n  const ProfileVerification = {\n    /**\n     * Initialize profile verification system\n     */\n    init: function() {\n      // Only run on profile verification pages\n      if (!this.isVerificationPage()) {\n        return;\n      }\n\n      this.setupSectionCheckboxes();\n      this.setupConfirmButton();\n      this.setupProgressIndicator();\n      this.setupHapticFeedback();\n      this.trackUserInteraction();\n\n      console.log('Profile verification system initialized');\n    },\n\n    /**\n     * Check if current page is a verification page\n     */\n    isVerificationPage: function() {\n      return document.querySelector('button[name=\"verify_profile\"]') !== null ||\n             document.querySelector('[data-verification-page=\"true\"]') !== null;\n    },\n\n    /**\n     * Setup section review checkboxes\n     */\n    setupSectionCheckboxes: function() {\n      const sections = document.querySelectorAll('.verification-section');\n\n      if (sections.length === 0) {\n        // Sections don't exist yet - create them\n        this.createSectionCheckboxes();\n      } else {\n        // Sections exist - just setup listeners\n        this.attachCheckboxListeners();\n      }\n    },\n\n    /**\n     * Create section checkboxes if they don't exist\n     */\n    createSectionCheckboxes: function() {\n      // Find all cards that should have checkboxes\n      const cards = document.querySelectorAll('.card');\n\n      cards.forEach((card, index) => {\n        const cardHeader = card.querySelector('.card-header');\n\n        if (!cardHeader) return;\n\n        // Don't add checkbox if card already has one\n        if (cardHeader.querySelector('.section-reviewed')) return;\n\n        // Get section name from card title\n        const cardTitle = cardHeader.querySelector('h5, h4, h3, .card-title');\n        if (!cardTitle) return;\n\n        const sectionName = cardTitle.textContent.trim();\n\n        // Skip if this is not a data section (e.g., actions, buttons)\n        if (this.shouldSkipSection(sectionName)) return;\n\n        // Create checkbox container\n        const checkboxContainer = document.createElement('div');\n        checkboxContainer.className = 'form-check form-switch d-flex align-items-center ms-auto';\n\n        // Create checkbox input\n        const checkbox = document.createElement('input');\n        checkbox.className = 'form-check-input section-reviewed';\n        checkbox.type = 'checkbox';\n        checkbox.id = `section-reviewed-${index}`;\n        checkbox.setAttribute('data-section', sectionName.toLowerCase().replace(/\\s+/g, '-'));\n        checkbox.setAttribute('data-verification-checkbox', 'section');\n        checkbox.setAttribute('data-on-change', 'verify-section-reviewed');\n\n        // Create label\n        const label = document.createElement('label');\n        label.className = 'form-check-label ms-2 verification-label';\n        label.setAttribute('for', `section-reviewed-${index}`);\n        label.textContent = 'Reviewed';\n\n        // Append elements\n        checkboxContainer.appendChild(checkbox);\n        checkboxContainer.appendChild(label);\n\n        // Make card header flex if not already\n        if (!cardHeader.classList.contains('d-flex')) {\n          cardHeader.classList.add('d-flex', 'justify-content-between', 'align-items-center');\n        }\n\n        cardHeader.appendChild(checkboxContainer);\n\n        // Mark card as verification section\n        card.classList.add('verification-section');\n      });\n\n      // Attach listeners to newly created checkboxes\n      this.attachCheckboxListeners();\n    },\n\n    /**\n     * Check if section should be skipped\n     */\n    shouldSkipSection: function(sectionName) {\n      const skipPatterns = [\n        /action/i,\n        /button/i,\n        /submit/i,\n        /confirm/i\n      ];\n\n      return skipPatterns.some(pattern => pattern.test(sectionName));\n    },\n\n    /**\n     * Attach event listeners to checkboxes\n     * NOTE: Now using centralized event delegation system\n     * Checkboxes use data-on-change=\"verify-section-reviewed\" attribute\n     */\n    attachCheckboxListeners: function() {\n      // Event listeners are now handled by the centralized event delegation system\n      // Checkboxes should have data-on-change=\"verify-section-reviewed\" attribute\n      // The event delegation system will call handleCheckboxChange() when triggered\n\n      // Haptic feedback is now handled by CSS :active pseudo-class or can be\n      // added to the event delegation handler if needed\n\n      // Mark checkboxes as initialized\n      const checkboxes = document.querySelectorAll('.section-reviewed');\n      checkboxes.forEach(checkbox => {\n        checkbox.setAttribute('data-verification-initialized', 'true');\n      });\n    },\n\n    /**\n     * Handle checkbox change event\n     */\n    handleCheckboxChange: function(checkbox) {\n      // Haptic feedback\n      if (window.Haptics) {\n        if (checkbox.checked) {\n          window.Haptics.success();\n        } else {\n          window.Haptics.light();\n        }\n      }\n\n      // Track for analytics\n      const sectionName = checkbox.getAttribute('data-section');\n      const isChecked = checkbox.checked;\n      console.log(`Section \"${sectionName}\" ${isChecked ? 'checked' : 'unchecked'}`);\n\n      // Update progress\n      this.updateProgress();\n\n      // Check if all sections are reviewed\n      this.updateConfirmButton();\n\n      // Visual feedback on parent card\n      const card = checkbox.closest('[data-section-card]');\n      if (card) {\n        if (checkbox.checked) {\n          card.classList.add('section-complete');\n          card.setAttribute('data-complete', 'true');\n          this.animateCardCheck(card);\n        } else {\n          card.classList.remove('section-complete');\n          card.setAttribute('data-complete', 'false');\n        }\n      }\n    },\n\n    /**\n     * Animate card when section is checked\n     */\n    animateCardCheck: function(card) {\n      // Add animation class\n      card.classList.add('section-complete-animation');\n\n      // Scale down\n      card.classList.add('scale-down');\n      card.classList.remove('scale-normal');\n\n      setTimeout(() => {\n        // Scale back to normal\n        card.classList.remove('scale-down');\n        card.classList.add('scale-normal');\n      }, 150);\n\n      setTimeout(() => {\n        // Clean up animation classes\n        card.classList.remove('section-complete-animation', 'scale-normal');\n      }, 300);\n    },\n\n    /**\n     * Setup confirm button behavior\n     * NOTE: Now using centralized event delegation system\n     * Button uses data-action=\"verify-profile-submit\" attribute\n     */\n    setupConfirmButton: function() {\n      const confirmButton = document.querySelector('button[name=\"verify_profile\"]');\n\n      if (!confirmButton) return;\n\n      // Initially disable the button\n      confirmButton.disabled = true;\n      confirmButton.classList.add('disabled');\n\n      // Click handler is now handled by the centralized event delegation system\n      // The button should have data-action=\"verify-profile-submit\" attribute\n      // The event delegation system will check if all sections are reviewed\n\n      // Initial state check\n      this.updateConfirmButton();\n    },\n\n    /**\n     * Update confirm button state\n     */\n    updateConfirmButton: function() {\n      const confirmButton = document.querySelector('button[name=\"verify_profile\"]');\n\n      if (!confirmButton) return;\n\n      const allReviewed = this.areAllSectionsReviewed();\n\n      if (allReviewed) {\n        confirmButton.disabled = false;\n        confirmButton.classList.remove('disabled');\n        confirmButton.classList.add('btn-success');\n        confirmButton.classList.remove('btn-secondary');\n        confirmButton.setAttribute('data-state', 'enabled');\n\n        // Add checkmark icon if not present\n        if (!confirmButton.querySelector('.ti-check')) {\n          const icon = document.createElement('i');\n          icon.className = 'ti ti-check me-2';\n          confirmButton.prepend(icon);\n        }\n      } else {\n        confirmButton.disabled = true;\n        confirmButton.classList.add('disabled');\n        confirmButton.classList.remove('btn-success');\n        confirmButton.classList.add('btn-secondary');\n        confirmButton.setAttribute('data-state', 'disabled');\n\n        // Remove checkmark icon\n        const icon = confirmButton.querySelector('.ti-check');\n        if (icon) {\n          icon.remove();\n        }\n      }\n    },\n\n    /**\n     * Check if all sections are reviewed\n     */\n    areAllSectionsReviewed: function() {\n      const checkboxes = document.querySelectorAll('.section-reviewed');\n\n      if (checkboxes.length === 0) {\n        // No checkboxes - allow confirm (backward compatibility)\n        return true;\n      }\n\n      return Array.from(checkboxes).every(cb => cb.checked);\n    },\n\n    /**\n     * Get list of unchecked sections\n     */\n    getUncheckedSections: function() {\n      const checkboxes = document.querySelectorAll('.section-reviewed:not(:checked)');\n\n      return Array.from(checkboxes).map(cb => {\n        const sectionName = cb.getAttribute('data-section');\n        return sectionName.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n      });\n    },\n\n    /**\n     * Setup progress indicator\n     */\n    setupProgressIndicator: function() {\n      // Check if progress indicator already exists\n      let progressContainer = document.getElementById('verification-progress');\n\n      if (!progressContainer) {\n        // Create progress indicator\n        progressContainer = this.createProgressIndicator();\n      }\n\n      // Update progress\n      this.updateProgress();\n    },\n\n    /**\n     * Create progress indicator element\n     */\n    createProgressIndicator: function() {\n      const container = document.createElement('div');\n      container.id = 'verification-progress';\n      container.className = 'alert alert-info sticky-top mb-4 verification-progress-container';\n      container.setAttribute('data-progress-indicator', 'verification');\n      container.setAttribute('data-status', 'info');\n\n      const progressText = document.createElement('strong');\n      progressText.id = 'progress-text';\n      progressText.textContent = '0 of 0 sections reviewed';\n\n      const helpText = document.createElement('p');\n      helpText.className = 'mb-0 small mt-2';\n      helpText.textContent = 'Please review each section and check the box before confirming.';\n\n      container.appendChild(progressText);\n      container.appendChild(helpText);\n\n      // Find the first card and insert before it\n      const firstCard = document.querySelector('[data-section-card]');\n      if (firstCard && firstCard.parentNode) {\n        firstCard.parentNode.insertBefore(container, firstCard);\n      }\n\n      return container;\n    },\n\n    /**\n     * Update progress indicator\n     */\n    updateProgress: function() {\n      const checkboxes = document.querySelectorAll('.section-reviewed');\n      const checkedCount = document.querySelectorAll('.section-reviewed:checked').length;\n      const totalCount = checkboxes.length;\n\n      const progressText = document.getElementById('progress-text');\n\n      if (progressText) {\n        progressText.textContent = `${checkedCount} of ${totalCount} sections reviewed`;\n\n        // Update alert class based on progress\n        const progressContainer = document.querySelector('[data-progress-indicator=\"verification\"]');\n        if (progressContainer) {\n          if (checkedCount === totalCount && totalCount > 0) {\n            progressContainer.classList.remove('alert-info', 'alert-warning');\n            progressContainer.classList.add('alert-success');\n            progressContainer.setAttribute('data-status', 'success');\n          } else if (checkedCount > 0) {\n            progressContainer.classList.remove('alert-info', 'alert-success');\n            progressContainer.classList.add('alert-warning');\n            progressContainer.setAttribute('data-status', 'warning');\n          } else {\n            progressContainer.classList.remove('alert-warning', 'alert-success');\n            progressContainer.classList.add('alert-info');\n            progressContainer.setAttribute('data-status', 'info');\n          }\n        }\n      }\n\n      // Update progress bar if it exists\n      this.updateProgressBar(checkedCount, totalCount);\n    },\n\n    /**\n     * Update progress bar\n     */\n    updateProgressBar: function(checkedCount, totalCount) {\n      let progressBar = document.getElementById('verification-progress-bar');\n\n      if (!progressBar && totalCount > 0) {\n        // Create progress bar\n        const progressContainer = document.querySelector('[data-progress-indicator=\"verification\"]');\n        if (progressContainer) {\n          const progressBarContainer = document.createElement('div');\n          progressBarContainer.className = 'progress mt-2 verification-progress-bar-container';\n          progressBarContainer.setAttribute('data-progress-container', 'verification');\n\n          progressBar = document.createElement('div');\n          progressBar.id = 'verification-progress-bar';\n          progressBar.className = 'progress-bar verification-progress-bar';\n          progressBar.role = 'progressbar';\n          progressBar.setAttribute('data-progress-bar', 'verification');\n\n          progressBarContainer.appendChild(progressBar);\n          progressContainer.appendChild(progressBarContainer);\n        }\n      }\n\n      if (progressBar && totalCount > 0) {\n        const percentage = Math.round((checkedCount / totalCount) * 100);\n        progressBar.style.width = percentage + '%';\n        progressBar.setAttribute('aria-valuenow', percentage);\n        progressBar.setAttribute('aria-valuemin', '0');\n        progressBar.setAttribute('aria-valuemax', '100');\n      }\n    },\n\n    /**\n     * Show warning for incomplete verification\n     */\n    showIncompleteWarning: function(uncheckedSections) {\n      const sectionList = uncheckedSections.map(s => ` ${s}`).join('<br>');\n\n      if (typeof Swal !== 'undefined') {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Review Required',\n          html: `<p>Please review the following sections before confirming:</p><br>${sectionList}`,\n          confirmButtonText: 'OK',\n          confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('warning') : '#ffc107'\n        });\n      } else {\n        alert(`Please review the following sections:\\n\\n${uncheckedSections.join('\\n')}`);\n      }\n    },\n\n    /**\n     * Setup haptic feedback\n     */\n    setupHapticFeedback: function() {\n      // Haptic feedback already handled in checkbox listeners\n      // This is a placeholder for additional haptic features\n    },\n\n    /**\n     * Track user interaction for analytics\n     * NOTE: Now using centralized event delegation system\n     * Analytics tracking is handled in handleCheckboxChange()\n     */\n    trackUserInteraction: function() {\n      // Tracking is now handled within handleCheckboxChange()\n      // which is called by the event delegation system\n      // No separate event listeners needed\n    }\n  };\n\n  // Initialize when DOM is ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      ProfileVerification.init();\n    });\n  } else {\n    ProfileVerification.init();\n  }\n\n  // Export for external access\n  window.ProfileVerification = ProfileVerification;\n\n})();\n","/**\n * Soccer Pitch View System\n * Visual drafting interface with position-based player placement\n *\n * REFACTORED: Eliminated all inline style manipulations in favor of CSS classes\n */\n\nclass PitchViewSystem {\n    constructor(leagueName, teams, draftedPlayersByTeam) {\n        this.leagueName = leagueName;\n        this.teams = teams;\n        this.draftedPlayersByTeam = draftedPlayersByTeam;\n        this.socket = null;\n        this.currentDraggedPlayer = null;\n        this.isConnected = false;\n\n        this.init();\n    }\n\n    init() {\n        this.setupSocket();\n        this.setupEventListeners();\n        this.populateExistingPlayers();\n        this.setupSearch();\n        this.updateAllStats();\n\n        console.log(' Pitch View System initialized');\n    }\n\n    setupSocket() {\n        try {\n            // Reuse existing global socket if available (from navbar presence)\n            // Check if socket EXISTS (not just connected) - it may still be connecting\n            if (window.socket) {\n                console.log(' [PitchView] Reusing existing socket (connected:', window.socket.connected, ')');\n                this.socket = window.socket;\n\n                // If already connected, join room immediately\n                if (this.socket.connected) {\n                    this.isConnected = true;\n                    this.socket.emit('join_draft_room', { league_name: this.leagueName });\n                }\n                // Set up listeners regardless - connect handler will join room when connected\n                this.setupSocketListeners();\n                return;\n            }\n\n            // Create new socket if none exists\n            console.log(' [PitchView] Creating new socket connection');\n            this.socket = io('/', {\n                // Use polling first to establish sticky session cookie with multiple workers\n                transports: ['polling', 'websocket'],\n                upgrade: true,\n                timeout: 10000,\n                withCredentials: true\n            });\n\n            // Store globally for other components to reuse\n            window.socket = this.socket;\n\n            this.setupSocketListeners();\n\n        } catch (error) {\n            console.error('Failed to initialize socket:', error);\n        }\n    }\n\n    setupSocketListeners() {\n        if (!this.socket) return;\n\n        this.socket.on('connect', () => {\n            console.log(' Connected to draft system');\n            this.isConnected = true;\n            this.socket.emit('join_draft_room', { league_name: this.leagueName });\n        });\n\n        this.socket.on('disconnect', () => {\n            console.log(' Disconnected from draft system');\n            this.isConnected = false;\n        });\n\n        this.socket.on('player_drafted_enhanced', (data) => {\n            console.log(' Player drafted:', data);\n            this.handlePlayerDrafted(data);\n        });\n\n        this.socket.on('player_removed_enhanced', (data) => {\n            console.log(' Player removed:', data);\n            this.handlePlayerRemoved(data);\n        });\n\n        this.socket.on('player_position_updated', (data) => {\n            console.log(' Player position updated:', data);\n            this.handlePlayerPositionUpdated(data);\n        });\n\n        this.socket.on('error', (data) => {\n            console.error(' Socket error:', data);\n            this.showToast('Error: ' + data.message, 'error');\n        });\n    }\n\n    setupEventListeners() {\n        // Search functionality\n        const searchInput = document.getElementById('playerSearchPitch');\n        if (searchInput) {\n            searchInput.addEventListener('input', this.handleSearch.bind(this));\n        }\n\n        // Position filter\n        const positionFilter = document.getElementById('positionFilterPitch');\n        if (positionFilter) {\n            positionFilter.addEventListener('change', this.handlePositionFilter.bind(this));\n        }\n\n        // Team tab switching\n        document.addEventListener('shown.bs.tab', (event) => {\n            if (event.target.id.includes('team-') && event.target.id.includes('-tab')) {\n                const teamId = event.target.getAttribute('data-team-id');\n                this.onTeamTabSwitch(teamId);\n            }\n        });\n\n        // Setup drag and drop event delegation\n        this.setupDragAndDropEvents();\n    }\n\n    setupDragAndDropEvents() {\n        const self = this;\n\n        // Drag start on available player cards\n        document.addEventListener('dragstart', function(e) {\n            const playerCard = e.target.closest('.js-draggable-player');\n            if (playerCard) {\n                const playerId = playerCard.dataset.playerId;\n                e.dataTransfer.setData('text/plain', playerId);\n                e.dataTransfer.effectAllowed = 'move';\n                playerCard.classList.add('dragging');\n                self.currentDraggedPlayer = playerId;\n            }\n        });\n\n        // Drag end\n        document.addEventListener('dragend', function(e) {\n            const playerCard = e.target.closest('.js-draggable-player');\n            if (playerCard) {\n                playerCard.classList.remove('dragging');\n                self.currentDraggedPlayer = null;\n            }\n        });\n\n        // Drag over position zones\n        document.addEventListener('dragover', function(e) {\n            const dropZone = e.target.closest('.js-position-drop-zone');\n            if (dropZone) {\n                e.preventDefault();\n                e.dataTransfer.dropEffect = 'move';\n                dropZone.classList.add('drag-over');\n            }\n        });\n\n        // Drag leave position zones\n        document.addEventListener('dragleave', function(e) {\n            const dropZone = e.target.closest('.js-position-drop-zone');\n            if (dropZone && !dropZone.contains(e.relatedTarget)) {\n                dropZone.classList.remove('drag-over');\n            }\n        });\n\n        // Drop on position zones\n        document.addEventListener('drop', function(e) {\n            const dropZone = e.target.closest('.js-position-drop-zone');\n            if (dropZone) {\n                e.preventDefault();\n                dropZone.classList.remove('drag-over');\n\n                const position = dropZone.dataset.position;\n                const teamId = dropZone.dataset.teamId;\n                const playerId = e.dataTransfer.getData('text/plain') || self.currentDraggedPlayer;\n\n                if (playerId && position && teamId) {\n                    self.handlePositionDrop(e, position, teamId);\n                }\n            }\n        });\n    }\n\n    setupSearch() {\n        // Initialize search state\n        this.updateAvailablePlayerCount();\n    }\n\n    handleSearch(event) {\n        const searchTerm = event.target.value.toLowerCase();\n        const playerItems = document.querySelectorAll('#availablePlayersList .player-item');\n        let visibleCount = 0;\n\n        playerItems.forEach(item => {\n            const playerName = item.getAttribute('data-player-name') || '';\n            const isVisible = !searchTerm || playerName.includes(searchTerm);\n\n            // Use CSS classes instead of inline styles\n            if (isVisible) {\n                item.classList.remove('d-none');\n                item.classList.add('d-flex');\n                visibleCount++;\n            } else {\n                item.classList.remove('d-flex');\n                item.classList.add('d-none');\n            }\n        });\n\n        this.updateAvailablePlayerCount(visibleCount);\n    }\n\n    handlePositionFilter(event) {\n        const selectedPosition = event.target.value.toLowerCase();\n        const playerItems = document.querySelectorAll('#availablePlayersList .player-item');\n        let visibleCount = 0;\n\n        playerItems.forEach(item => {\n            const playerPosition = item.getAttribute('data-position') || '';\n            const isVisible = !selectedPosition || playerPosition.includes(selectedPosition);\n\n            // Use CSS classes instead of inline styles\n            if (isVisible) {\n                item.classList.remove('d-none');\n                item.classList.add('d-flex');\n                visibleCount++;\n            } else {\n                item.classList.remove('d-flex');\n                item.classList.add('d-none');\n            }\n        });\n\n        this.updateAvailablePlayerCount(visibleCount);\n    }\n\n    populateExistingPlayers() {\n        // Populate already drafted players into their saved positions\n        Object.keys(this.draftedPlayersByTeam).forEach(teamId => {\n            const players = this.draftedPlayersByTeam[teamId];\n            players.forEach(player => {\n                // Use the saved position or default to bench\n                const position = player.current_position || 'bench';\n                this.addPlayerToPosition(player, position, teamId, false); // false = don't emit socket event\n            });\n        });\n    }\n\n    onTeamTabSwitch(teamId) {\n        // Update any team-specific UI when switching between teams\n        console.log(`Switched to team ${teamId}`);\n    }\n\n    // Player Management\n    addPlayerToPosition(player, position, teamId, emitEvent = true) {\n        const positionContainer = document.getElementById(`position-${position}-${teamId}`);\n        if (!positionContainer) {\n            console.error(`Position container not found: position-${position}-${teamId}`);\n            return;\n        }\n\n        // Check if player is already positioned somewhere in this team\n        this.removePlayerFromAllPositions(player.id, teamId);\n\n        // Create player element\n        const playerElement = this.createPositionedPlayerElement(player, position, teamId);\n        positionContainer.appendChild(playerElement);\n\n        // Remove from available players list if it exists there\n        this.removePlayerFromAvailable(player.id);\n\n        // Update stats\n        this.updatePositionStats(teamId);\n        this.updateTeamCounts();\n\n        // Emit socket event if requested\n        if (emitEvent && this.socket && this.isConnected) {\n            this.socket.emit('update_player_position', {\n                player_id: player.id,\n                team_id: parseInt(teamId),\n                position: position,\n                league_name: this.leagueName\n            });\n        }\n\n        console.log(`Added ${player.name} to ${position} position in team ${teamId}`);\n    }\n\n    createPositionedPlayerElement(player, position, teamId) {\n        const element = document.createElement('div');\n        element.className = 'positioned-player newly-added';\n        element.setAttribute('data-player-id', player.id);\n        element.setAttribute('data-player-name', player.name);\n        element.setAttribute('data-position', position);\n        element.setAttribute('draggable', 'true');\n        element.setAttribute('title', player.name); // Tooltip with full name\n\n        // Add drag event listeners\n        element.addEventListener('dragstart', (e) => this.handlePositionedPlayerDragStart(e, player.id));\n        element.addEventListener('dragend', (e) => this.handlePositionedPlayerDragEnd(e));\n\n        // Player image or initials\n        if (player.profile_picture_url && player.profile_picture_url !== '/static/img/default_player.png') {\n            element.innerHTML = `\n                <img src=\"${player.profile_picture_url}\" alt=\"${player.name}\"\n                     class=\"player-profile-img\"\n                     onerror=\"this.classList.add('d-none'); this.nextElementSibling.classList.remove('d-none');\">\n                <div class=\"player-initials d-none\">${this.getPlayerInitials(player.name)}</div>\n                <button class=\"remove-btn\" onclick=\"pitchViewInstance.removePlayerFromPosition(${player.id}, '${position}', ${teamId})\" title=\"Remove ${player.name}\"></button>\n            `;\n        } else {\n            element.innerHTML = `\n                <div class=\"player-initials\">${this.getPlayerInitials(player.name)}</div>\n                <button class=\"remove-btn\" onclick=\"pitchViewInstance.removePlayerFromPosition(${player.id}, '${position}', ${teamId})\" title=\"Remove ${player.name}\"></button>\n            `;\n        }\n\n        // Remove the newly-added class after animation\n        setTimeout(() => {\n            element.classList.remove('newly-added');\n        }, 500);\n\n        return element;\n    }\n\n    getPlayerInitials(name) {\n        return name.split(' ')\n            .map(part => part.charAt(0).toUpperCase())\n            .join('')\n            .substring(0, 2);\n    }\n\n    removePlayerFromPosition(playerId, position, teamId) {\n        const positionContainer = document.getElementById(`position-${position}-${teamId}`);\n        if (positionContainer) {\n            const playerElement = positionContainer.querySelector(`[data-player-id=\"${playerId}\"]`);\n            if (playerElement) {\n                // Use CSS classes for animation instead of inline styles\n                playerElement.classList.add('removing');\n\n                setTimeout(() => {\n                    playerElement.remove();\n                    this.updatePositionStats(teamId);\n                }, 300);\n            }\n        }\n\n        // If removing from team entirely, add back to available\n        const teamHasPlayer = this.isPlayerInTeam(playerId, teamId);\n        if (!teamHasPlayer) {\n            this.addPlayerBackToAvailable(playerId);\n        }\n    }\n\n    removePlayerFromAllPositions(playerId, teamId) {\n        const positions = ['gk', 'lb', 'cb', 'rb', 'lwb', 'rwb', 'cdm', 'cm', 'cam', 'lw', 'rw', 'st', 'bench'];\n        positions.forEach(position => {\n            const positionContainer = document.getElementById(`position-${position}-${teamId}`);\n            if (positionContainer) {\n                const playerElement = positionContainer.querySelector(`[data-player-id=\"${playerId}\"]`);\n                if (playerElement) {\n                    playerElement.remove();\n                }\n            }\n        });\n    }\n\n    removePlayerFromAvailable(playerId) {\n        const playerItem = document.querySelector(`#availablePlayersList [data-player-id=\"${playerId}\"]`);\n        if (playerItem) {\n            // Use CSS class for animation instead of inline styles\n            playerItem.classList.add('removing-from-list');\n\n            setTimeout(() => {\n                playerItem.remove();\n                this.updateAvailablePlayerCount();\n            }, 300);\n        }\n    }\n\n    addPlayerBackToAvailable(playerId) {\n        // This would require the full player data - for now, we'll reload or emit an event\n        // In a real implementation, you'd maintain a player cache\n        console.log(`Should add player ${playerId} back to available pool`);\n    }\n\n    isPlayerInTeam(playerId, teamId) {\n        const positions = ['gk', 'lb', 'cb', 'rb', 'lwb', 'rwb', 'cdm', 'cm', 'cam', 'lw', 'rw', 'st', 'bench'];\n        return positions.some(position => {\n            const container = document.getElementById(`position-${position}-${teamId}`);\n            return container && container.querySelector(`[data-player-id=\"${playerId}\"]`);\n        });\n    }\n\n    // Drag and Drop Handlers\n    handlePlayerDragStart(event, playerId) {\n        this.currentDraggedPlayer = playerId;\n        event.dataTransfer.setData('text/plain', playerId);\n        event.dataTransfer.effectAllowed = 'move';\n\n        // Visual feedback using CSS classes\n        event.target.classList.add('dragging');\n    }\n\n    handlePlayerDragEnd(event) {\n        this.currentDraggedPlayer = null;\n        event.target.classList.remove('dragging');\n    }\n\n    handlePositionedPlayerDragStart(event, playerId) {\n        this.currentDraggedPlayer = playerId;\n        event.dataTransfer.setData('text/plain', playerId);\n        event.dataTransfer.effectAllowed = 'move';\n\n        // Mark as positioned player being moved\n        event.dataTransfer.setData('positioned', 'true');\n\n        // Visual feedback using CSS classes\n        event.target.classList.add('dragging');\n    }\n\n    handlePositionedPlayerDragEnd(event) {\n        this.currentDraggedPlayer = null;\n        event.target.classList.remove('dragging');\n    }\n\n    handlePositionDragOver(event) {\n        event.preventDefault();\n        event.dataTransfer.dropEffect = 'move';\n\n        const zone = event.currentTarget;\n        zone.classList.add('drag-over');\n    }\n\n    handlePositionDragLeave(event) {\n        const zone = event.currentTarget;\n        zone.classList.remove('drag-over');\n    }\n\n    handlePositionDrop(event, position, teamId) {\n        event.preventDefault();\n\n        const zone = event.currentTarget;\n        zone.classList.remove('drag-over');\n\n        const playerId = event.dataTransfer.getData('text/plain');\n        const isPositioned = event.dataTransfer.getData('positioned') === 'true';\n\n        if (!playerId) {\n            this.showToast('No player data found', 'error');\n            return;\n        }\n\n        // Soft warning for position capacity (doesn't block)\n        const currentPlayers = zone.querySelector('.position-players').children.length;\n        const recommended = this.getRecommendedMax(position);\n\n        if (currentPlayers >= recommended) {\n            this.showPositionWarning(position, currentPlayers + 1, recommended);\n            // CONTINUE with draft - don't block\n        }\n\n        if (isPositioned) {\n            // Moving from one position to another\n            this.movePlayerBetweenPositions(playerId, position, teamId);\n        } else {\n            // Drafting new player\n            this.draftPlayerToPosition(playerId, position, teamId);\n        }\n\n        // Update capacity indicators after drop\n        setTimeout(() => this.updatePositionCapacity(position, teamId), 100);\n    }\n\n    getRecommendedMax(position) {\n        /**\n         * Get recommended maximum players for a position\n         */\n        const recommendations = {\n            'gk': 1,\n            'lb': 1,\n            'cb': 2,\n            'rb': 1,\n            'lwb': 1,\n            'rwb': 1,\n            'cdm': 2,\n            'cm': 2,\n            'cam': 1,\n            'lw': 1,\n            'rw': 1,\n            'st': 2,\n            'bench': 999\n        };\n        return recommendations[position.toLowerCase()] || 1;\n    }\n\n    showPositionWarning(position, currentCount, recommendedMax) {\n        /**\n         * Show a toast warning when position capacity is exceeded\n         */\n        const positionName = position.toUpperCase();\n        const toast = document.createElement('div');\n        toast.className = 'position-warning-toast';\n        toast.innerHTML = `\n            <i class=\"ti ti-alert-triangle text-warning me-2\"></i>\n            <div>\n                <strong>${positionName} Position Over Capacity</strong>\n                <div class=\"small text-muted\">Current: ${currentCount} | Recommended: ${recommendedMax}</div>\n            </div>\n        `;\n\n        document.body.appendChild(toast);\n\n        // Auto-remove after 3 seconds - use CSS class for animation\n        setTimeout(() => {\n            toast.classList.add('toast-dismissing');\n            setTimeout(() => toast.remove(), 300);\n        }, 3000);\n    }\n\n    updatePositionCapacity(position, teamId) {\n        /**\n         * Update visual capacity indicators for a position\n         */\n        const slot = document.querySelector(`[data-position=\"${position}\"][data-team-id=\"${teamId}\"]`);\n        if (!slot) return;\n\n        const indicator = slot.querySelector('.capacity-indicator');\n        if (!indicator) return;\n\n        const currentCount = slot.querySelectorAll('.positioned-player').length;\n        const recommended = this.getRecommendedMax(position);\n\n        // Update current count display\n        const currentSpan = indicator.querySelector('.current');\n        if (currentSpan) {\n            currentSpan.textContent = currentCount;\n        }\n\n        // Update visual state\n        indicator.classList.remove('at-capacity', 'over-capacity');\n        slot.classList.remove('at-capacity', 'over-capacity');\n\n        if (currentCount === recommended) {\n            indicator.classList.add('at-capacity');\n            slot.classList.add('at-capacity');\n        } else if (currentCount > recommended) {\n            indicator.classList.add('over-capacity');\n            slot.classList.add('over-capacity');\n        }\n    }\n\n    movePlayerBetweenPositions(playerId, newPosition, teamId) {\n        // Find current position\n        const positions = ['gk', 'lb', 'cb', 'rb', 'lwb', 'rwb', 'cdm', 'cm', 'cam', 'lw', 'rw', 'st', 'bench'];\n        let currentPosition = null;\n        let playerData = null;\n\n        for (const pos of positions) {\n            const container = document.getElementById(`position-${pos}-${teamId}`);\n            const playerElement = container?.querySelector(`[data-player-id=\"${playerId}\"]`);\n            if (playerElement) {\n                currentPosition = pos;\n                playerData = {\n                    id: playerId,\n                    name: playerElement.getAttribute('data-player-name')\n                };\n                playerElement.remove();\n                break;\n            }\n        }\n\n        if (!playerData) {\n            this.showToast('Player not found', 'error');\n            return;\n        }\n\n        // Add to new position\n        this.addPlayerToPosition(playerData, newPosition, teamId, true);\n\n        this.showToast(`Moved ${playerData.name} to ${newPosition}`, 'success');\n    }\n\n    draftPlayerToPosition(playerId, position, teamId) {\n        // Get player data from available list\n        const playerItem = document.querySelector(`#availablePlayersList [data-player-id=\"${playerId}\"]`);\n        if (!playerItem) {\n            this.showToast('Player not found in available list', 'error');\n            return;\n        }\n\n        const playerName = playerItem.querySelector('.player-name').textContent;\n\n        // First, draft the player to the team via the regular draft system\n        if (this.socket && this.isConnected) {\n            this.showLoading();\n\n            this.socket.emit('draft_player_enhanced', {\n                player_id: parseInt(playerId),\n                team_id: parseInt(teamId),\n                league_name: this.leagueName,\n                position: position // Extra data for position\n            });\n        } else {\n            this.showToast('Not connected to server', 'error');\n        }\n    }\n\n    // Socket Event Handlers\n    handlePlayerDrafted(data) {\n        this.hideLoading();\n\n        // Add player to the specified position (default to bench if no position specified)\n        const position = data.position || 'bench';\n        this.addPlayerToPosition(data.player, position, data.team_id, false);\n\n        this.showToast(`${data.player.name} drafted to ${data.team_name}`, 'success');\n    }\n\n    handlePlayerRemoved(data) {\n        this.hideLoading();\n\n        // Remove from all positions in the team\n        this.removePlayerFromAllPositions(data.player.id, data.team_id);\n        this.updatePositionStats(data.team_id);\n        this.updateTeamCounts();\n\n        // Add player back to available list (real-time, no reload)\n        this.addPlayerToAvailableList(data.player);\n\n        this.showToast(`${data.player.name} removed from team`, 'info');\n    }\n\n    addPlayerToAvailableList(player) {\n        const availableList = document.getElementById('availablePlayersList');\n        if (!availableList) return;\n\n        // Check if player already exists in available list\n        if (availableList.querySelector(`[data-player-id=\"${player.id}\"]`)) {\n            return;\n        }\n\n        // Create player card HTML matching the template structure\n        const playerCard = document.createElement('div');\n        playerCard.className = 'pitch-player-card js-draggable-player';\n        playerCard.setAttribute('data-player-id', player.id);\n        playerCard.setAttribute('data-player-name', (player.name || '').toLowerCase());\n        playerCard.setAttribute('data-position', (player.favorite_position || player.position || '').toLowerCase());\n        playerCard.setAttribute('draggable', 'true');\n\n        const profileUrl = player.profile_picture_url || '/static/img/default_player.png';\n        const position = player.favorite_position || player.position || 'Any';\n        const goals = player.career_goals || 0;\n        const assists = player.career_assists || 0;\n\n        playerCard.innerHTML = `\n            <div class=\"pitch-player-card__avatar\">\n                <img src=\"${profileUrl}\"\n                     alt=\"${player.name}\" class=\"js-player-image\"\n                     data-fallback=\"/static/img/default_player.png\"\n                     onerror=\"this.src='/static/img/default_player.png'\">\n            </div>\n            <div class=\"pitch-player-card__content\">\n                <div class=\"pitch-player-card__header\">\n                    <span class=\"pitch-player-card__name\">${player.name}</span>\n                    <span class=\"pitch-player-card__position\">${position}</span>\n                </div>\n                <div class=\"pitch-player-card__stats\">\n                    <span class=\"pitch-player-card__stat pitch-player-card__stat--goals\" title=\"Goals\">\n                        <i class=\"ti ti-ball-football\"></i> ${goals}\n                    </span>\n                    <span class=\"pitch-player-card__stat pitch-player-card__stat--assists\" title=\"Assists\">\n                        <i class=\"ti ti-shoe\"></i> ${assists}\n                    </span>\n                </div>\n            </div>\n            <div class=\"pitch-player-card__drag-handle\">\n                <i class=\"ti ti-grip-vertical\"></i>\n            </div>\n        `;\n\n        // Add animation class for visual feedback\n        playerCard.classList.add('newly-added');\n\n        // Insert at beginning of list\n        availableList.insertBefore(playerCard, availableList.firstChild);\n\n        // Remove animation class after animation completes\n        setTimeout(() => {\n            playerCard.classList.remove('newly-added');\n        }, 500);\n\n        // Update count\n        this.updateAvailablePlayerCount();\n    }\n\n    handlePlayerPositionUpdated(data) {\n        // Handle position updates from other clients\n        this.addPlayerToPosition(data.player, data.position, data.team_id, false);\n    }\n\n    // Stats and UI Updates\n    updatePositionStats(teamId) {\n        // Position categories for the formation stats at bottom\n        const positionCategories = {\n            gk: ['gk'],\n            def: ['lb', 'cb', 'rb', 'lwb', 'rwb'],\n            mid: ['cdm', 'cm', 'cam'],\n            fwd: ['lw', 'rw', 'st'],\n            bench: ['bench']\n        };\n\n        // Update category counts (GK, DEF, MID, FWD, BENCH at bottom)\n        Object.entries(positionCategories).forEach(([category, positions]) => {\n            let totalCount = 0;\n            positions.forEach(pos => {\n                const container = document.getElementById(`position-${pos}-${teamId}`);\n                if (container) {\n                    totalCount += container.querySelectorAll('.positioned-player').length;\n                }\n            });\n\n            const countElement = document.getElementById(`${category}-count-${teamId}`);\n            if (countElement) {\n                countElement.textContent = totalCount;\n            }\n        });\n\n        // Update individual position zone counts (the (0) on each zone)\n        const allPositions = ['gk', 'lb', 'cb', 'rb', 'lwb', 'rwb', 'cdm', 'cm', 'cam', 'lw', 'rw', 'st', 'bench'];\n        allPositions.forEach(pos => {\n            const container = document.getElementById(`position-${pos}-${teamId}`);\n            if (container) {\n                const count = container.querySelectorAll('.positioned-player').length;\n                // Find the position-count span in the parent zone\n                const zone = container.closest('.position-zone');\n                if (zone) {\n                    const countSpan = zone.querySelector('.position-count');\n                    if (countSpan) {\n                        countSpan.textContent = `(${count})`;\n                    }\n                }\n            }\n        });\n    }\n\n    updateAllStats() {\n        this.teams.forEach(team => {\n            this.updatePositionStats(team.id);\n        });\n        this.updateTeamCounts();\n    }\n\n    updateTeamCounts() {\n        this.teams.forEach(team => {\n            const totalPlayers = this.getTotalPlayersInTeam(team.id);\n            const countElement = document.getElementById(`teamPitchCount${team.id}`);\n            if (countElement) {\n                countElement.textContent = totalPlayers;\n            }\n        });\n    }\n\n    getTotalPlayersInTeam(teamId) {\n        const positions = ['gk', 'lb', 'cb', 'rb', 'lwb', 'rwb', 'cdm', 'cm', 'cam', 'lw', 'rw', 'st', 'bench'];\n        return positions.reduce((total, position) => {\n            const container = document.getElementById(`position-${position}-${teamId}`);\n            return total + (container ? container.children.length : 0);\n        }, 0);\n    }\n\n    updateAvailablePlayerCount(count = null) {\n        if (count === null) {\n            const visiblePlayers = document.querySelectorAll('#availablePlayersList .player-item:not(.d-none)');\n            count = visiblePlayers.length;\n        }\n\n        const countElement = document.getElementById('availablePlayerCount');\n        if (countElement) {\n            countElement.textContent = count;\n        }\n    }\n\n    // UI Helpers\n    showLoading() {\n        const overlay = document.getElementById('loadingOverlay');\n        if (overlay) {\n            overlay.classList.remove('d-none');\n            overlay.classList.add('d-flex');\n        }\n    }\n\n    hideLoading() {\n        const overlay = document.getElementById('loadingOverlay');\n        if (overlay) {\n            overlay.classList.remove('d-flex');\n            overlay.classList.add('d-none');\n        }\n    }\n\n    showToast(message, type = 'info') {\n        if (window.Swal) {\n            const iconMap = {\n                'success': 'success',\n                'error': 'error',\n                'warning': 'warning',\n                'info': 'info'\n            };\n\n            Swal.fire({\n                title: message,\n                icon: iconMap[type] || 'info',\n                toast: true,\n                position: 'top-end',\n                showConfirmButton: false,\n                timer: 3000,\n                timerProgressBar: true\n            });\n        } else {\n            console.log(`${type.toUpperCase()}: ${message}`);\n        }\n    }\n}\n\n// Global instance\nlet pitchViewInstance = null;\n\n// Global initialization function\nfunction initializePitchView(leagueName, teams, draftedPlayersByTeam) {\n    pitchViewInstance = new PitchViewSystem(leagueName, teams, draftedPlayersByTeam);\n    return pitchViewInstance;\n}\n\n// Global functions for template compatibility\nfunction handlePlayerDragStart(event, playerId) {\n    if (pitchViewInstance) {\n        pitchViewInstance.handlePlayerDragStart(event, playerId);\n    }\n}\n\nfunction handlePlayerDragEnd(event) {\n    if (pitchViewInstance) {\n        pitchViewInstance.handlePlayerDragEnd(event);\n    }\n}\n\nfunction handlePositionDragOver(event) {\n    if (pitchViewInstance) {\n        pitchViewInstance.handlePositionDragOver(event);\n    }\n}\n\nfunction handlePositionDragLeave(event) {\n    if (pitchViewInstance) {\n        pitchViewInstance.handlePositionDragLeave(event);\n    }\n}\n\nfunction handlePositionDrop(event, position, teamId) {\n    if (pitchViewInstance) {\n        pitchViewInstance.handlePositionDrop(event, position, teamId);\n    }\n}\n\nfunction switchTeamView(teamId) {\n    // Switch to the team's tab\n    const tabButton = document.getElementById(`team-${teamId}-tab`);\n    if (tabButton) {\n        const tab = new bootstrap.Tab(tabButton);\n        tab.show();\n    }\n}\n\n// Export for module use\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = PitchViewSystem;\n}\n","/**\n * Application Initialization Registration\n * ========================================\n *\n * Central registration file for simple page components using InitSystem.\n * This file consolidates scattered DOMContentLoaded listeners into a single,\n * organized initialization system with proper dependency management and ordering.\n *\n * Priority Levels:\n * ----------------\n * - 100-90: Core systems (helpers, menu, responsive)\n * - 89-70:  Global components (theme, config, modals)\n * - 69-50:  Feature modules (forms, auth)\n * - 49-30:  Page-specific features\n * - 29-10:  Enhancements (UI fixes, animations)\n *\n * Phase 2.4 - Centralized Init System Completion\n * Batch 1: 7 components registered (waves-css-override removed - Waves.Effect not exposed)\n *\n * @version 1.0.2\n * @created 2025-12-16\n * @updated 2025-12-26 - Refactored to use EventDelegation for menu toggle\n *\n * Migration Summary:\n * -----------------\n *  page-loader.js (19 lines)  Priority 85\n *  admin-utilities-init.js (25 lines)  Priority 70\n *  waves-css-override.js - REMOVED (Waves.Effect is internal to node-waves, not exposed)\n *  design-system-fix.js (54 lines)  Priority 30\n *  design-system-override.js (49 lines)  Priority 30 (merged with design-system-fix)\n *  dropdown-menu-fix.js (20 lines)  Priority 30\n *  mobile-menu-fix.js (113 lines)  Priority 30\n *  waitlist-register.js (24 lines)  Priority 20\n *\n * Total: 7 active components\n *\n * Testing:\n * --------\n * In browser console:\n *   InitSystemDebug.printOrder()   - View initialization order\n *   InitSystemDebug.printStatus()  - View component status\n *   InitSystemDebug.getComponent('component-name') - Get component details\n *\n * HTMX Integration:\n * ----------------\n * Components marked as reinitializable can be re-initialized after AJAX loads:\n *   document.addEventListener('htmx:afterSwap', function(event) {\n *     InitSystem.reinit(['dropdown-menu-fix', 'admin-utilities'], event.target);\n *   });\n */\n\n(function(window, document) {\n    'use strict';\n\n    // Ensure InitSystem is loaded\n    if (typeof InitSystem === 'undefined') {\n        console.error('[App Init] InitSystem not loaded! Please include init-system.js before this file.');\n        return;\n    }\n\n    console.log('[App Init] Registering application components...');\n\n    // ============================================================================\n    // PRIORITY 85: PAGE LOADER\n    // ============================================================================\n    // Hide page loading animation after initial load\n    InitSystem.register('page-loader', function() {\n        // Hide loader after short delay to ensure smooth transition\n        setTimeout(function() {\n            const loader = document.getElementById('page-loader');\n            if (loader) {\n                loader.classList.add('hidden');\n                // Remove from DOM after fade animation completes\n                setTimeout(function() {\n                    if (loader.parentNode) {\n                        loader.parentNode.removeChild(loader);\n                    }\n                }, 500); // Match CSS transition duration\n            }\n        }, 800); // Minimum display time for UX\n    }, {\n        priority: 85,\n        description: 'Hide page loading animation',\n        reinitializable: false // Only runs once on initial page load\n    });\n\n    // ============================================================================\n    // PRIORITY 70: ADMIN UTILITIES\n    // ============================================================================\n    // Initialize admin utility helpers for progress bars and themed elements\n    InitSystem.register('admin-utilities', function(context) {\n        const root = context || document;\n\n        // Apply data-width to all progress bars\n        const progressBars = root.querySelectorAll('[data-width]');\n        progressBars.forEach(bar => {\n            const width = bar.dataset.width;\n            if (width) {\n                bar.style.width = width + '%';\n            }\n        });\n\n        // Apply data-theme-color to elements\n        const themedElements = root.querySelectorAll('[data-theme-color]');\n        themedElements.forEach(el => {\n            const color = el.dataset.themeColor;\n            if (color) {\n                el.style.backgroundColor = color;\n            }\n        });\n    }, {\n        priority: 70,\n        description: 'Initialize admin utility helpers (progress bars, theme colors)',\n        reinitializable: true // Can be re-initialized for AJAX-loaded content\n    });\n\n    // ============================================================================\n    // PRIORITY 30: UI FIXES AND ENHANCEMENTS\n    // ============================================================================\n\n    // ----------------------------------------------------------------------------\n    // Design System Fixes\n    // ----------------------------------------------------------------------------\n    // Fixes issues with design-system.js by safely overriding problematic methods\n    InitSystem.register('design-system-fixes', function() {\n        // Check if ECSDesignSystem exists\n        if (!window.ECSDesignSystem) {\n            return; // Design system not loaded, nothing to fix\n        }\n\n        // Store reference to original setupCustomBehaviors method\n        const originalSetupCustomBehaviors = ECSDesignSystem.setupCustomBehaviors;\n\n        // Replace with our safe version that handles errors gracefully\n        ECSDesignSystem.setupCustomBehaviors = function() {\n            try {\n                // Try to run the original implementation first\n                if (typeof originalSetupCustomBehaviors === 'function') {\n                    originalSetupCustomBehaviors.call(ECSDesignSystem);\n                }\n            } catch (e) {\n                // Original failed, use safe fallback implementation\n                console.warn('[Design System Fix] Original setupCustomBehaviors failed, using safe version', e);\n\n                // Safe implementation - call methods individually with error handling\n                try {\n                    if (typeof this.addRippleEffect === 'function') {\n                        this.addRippleEffect();\n                    }\n                } catch (e2) {\n                    console.warn('[Design System Fix] Error in addRippleEffect', e2);\n                }\n\n                try {\n                    if (typeof this.improveKeyboardNavigation === 'function') {\n                        this.improveKeyboardNavigation();\n                    }\n                } catch (e2) {\n                    console.warn('[Design System Fix] Error in improveKeyboardNavigation', e2);\n                }\n\n                try {\n                    if (typeof this.setupTransitions === 'function') {\n                        this.setupTransitions();\n                    }\n                } catch (e2) {\n                    console.warn('[Design System Fix] Error in setupTransitions', e2);\n                }\n            }\n        };\n\n        // Call the setup method after a delay to ensure DOM is ready\n        setTimeout(function() {\n            try {\n                ECSDesignSystem.setupCustomBehaviors();\n            } catch (e) {\n                console.error('[Design System Fix] Error in setupCustomBehaviors:', e);\n            }\n        }, 500);\n    }, {\n        priority: 30,\n        description: 'Apply design system CSS fixes and safe method overrides',\n        reinitializable: false // Only needs to run once\n    });\n\n    // ----------------------------------------------------------------------------\n    // Waves CSS Override - REMOVED\n    // ----------------------------------------------------------------------------\n    // Note: Waves.Effect is an internal API not exposed by node-waves.\n    // Ripple effects work via CSS classes applied by Waves.init() which is\n    // called in vendor/libs/node-waves/node-waves.js and assets/js/main.js.\n    // No override needed - just let the library work as designed.\n\n    // ----------------------------------------------------------------------------\n    // Dropdown Menu Fix\n    // ----------------------------------------------------------------------------\n    // Fixes dropdown menus being hidden behind tables\n    InitSystem.register('dropdown-menu-fix', function(context) {\n        const root = context || document;\n\n        // Add necessary class to tables to fix z-index issues\n        const userManagementTables = root.querySelectorAll('.table');\n        userManagementTables.forEach(table => {\n            table.classList.add('user-management-table');\n        });\n\n        // Add class to RSVP status page for specific fixes\n        if (window.location.href.includes('rsvp_status')) {\n            document.body.classList.add('rsvp-status-page');\n        }\n    }, {\n        priority: 30,\n        description: 'Fix dropdown menu positioning and z-index issues',\n        reinitializable: true // Can be re-initialized for AJAX-loaded tables\n    });\n\n    // ----------------------------------------------------------------------------\n    // Mobile Menu Fix\n    // ----------------------------------------------------------------------------\n    // Ensures sidebar menu works properly on mobile devices (especially iOS Safari)\n    InitSystem.register('mobile-menu-fix', function() {\n        // References to key elements\n        const layoutMenu = document.getElementById('layout-menu');\n        const closeIcon = document.getElementById('close-icon');\n        let layoutOverlay = document.querySelector('.layout-overlay');\n\n        // Create layout overlay if it doesn't exist\n        if (!layoutOverlay) {\n            const overlayDiv = document.createElement('div');\n            overlayDiv.className = 'layout-overlay';\n            document.body.appendChild(overlayDiv);\n            layoutOverlay = overlayDiv;\n        }\n\n        // Function to open menu\n        function openMenu() {\n            document.documentElement.classList.add('layout-menu-expanded');\n            document.body.classList.add('layout-menu-expanded');\n            if (layoutMenu) {\n                layoutMenu.classList.add('menu-open');\n            }\n            if (closeIcon) {\n                closeIcon.classList.remove('d-none');\n            }\n        }\n\n        // Function to close menu\n        function closeMenu() {\n            document.documentElement.classList.remove('layout-menu-expanded');\n            document.body.classList.remove('layout-menu-expanded');\n            if (layoutMenu) {\n                layoutMenu.classList.remove('menu-open');\n            }\n            if (closeIcon) {\n                closeIcon.classList.add('d-none');\n            }\n        }\n\n        // Toggle menu function\n        function toggleMenu() {\n            if (document.documentElement.classList.contains('layout-menu-expanded')) {\n                closeMenu();\n            } else {\n                openMenu();\n            }\n        }\n\n        // Register event delegation handler for menu toggle\n        if (typeof EventDelegation !== 'undefined') {\n            EventDelegation.register('toggle-mobile-menu', function(element, e) {\n                e.preventDefault();\n                toggleMenu();\n            }, { preventDefault: true });\n        }\n\n        // Register event delegation handler for close icon\n        if (typeof EventDelegation !== 'undefined') {\n            EventDelegation.register('close-mobile-menu', function(element, e) {\n                e.preventDefault();\n                closeMenu();\n            }, { preventDefault: true });\n        }\n\n        // Close when clicking the overlay (keep this as non-action click)\n        document.addEventListener('click', function(e) {\n            if (e.target.classList.contains('layout-overlay') &&\n                document.documentElement.classList.contains('layout-menu-expanded')) {\n                closeMenu();\n            }\n        });\n\n        // Fix for any inert attributes on menu items\n        const menuItems = document.querySelectorAll('.menu-item a');\n        menuItems.forEach(item => {\n            item.removeAttribute('inert');\n            item.classList.add('pointer-events-auto');\n        });\n\n        // Remove problematic attributes from the menu\n        if (layoutMenu) {\n            layoutMenu.removeAttribute('inert');\n            layoutMenu.classList.add('pointer-events-auto', 'user-select-auto', 'touch-action-auto');\n        }\n\n        // iOS specific fixes\n        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) ||\n                     (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);\n\n        if (isIOS) {\n            // Extra iOS fixes\n            document.documentElement.classList.add('ios-device');\n\n            // Fix scrolling in menu for iOS\n            if (layoutMenu) {\n                layoutMenu.classList.add('ios-overflow-scrolling');\n            }\n\n            // Additional handling for iOS gesture conflicts\n            const menuLinks = document.querySelectorAll('.menu-link, .menu-toggle');\n            menuLinks.forEach(link => {\n                link.addEventListener('touchstart', function(e) {\n                    // Ensure links are touchable\n                    e.stopPropagation();\n                }, { passive: true });\n            });\n        }\n    }, {\n        priority: 30,\n        description: 'Enhance mobile menu interactions and iOS compatibility',\n        reinitializable: false // Only needs to run once\n    });\n\n    // ============================================================================\n    // PRIORITY 20: WAITLIST REGISTRATION FOCUS\n    // ============================================================================\n    // Auto-focus on Discord registration button and show membership prompts\n    InitSystem.register('waitlist-register-focus', function() {\n        // Page guard - only run on waitlist registration page\n        const discordBtn = document.querySelector('a[href*=\"waitlist_discord_register\"]');\n        if (!discordBtn) {\n            return; // Not on waitlist registration page\n        }\n\n        // Auto-focus on Discord registration button\n        discordBtn.focus();\n\n        // Initialize Discord membership checker for registration page\n        // Show a more gentle prompt since they're already on the waitlist registration page\n        // Only show if user is not already in Discord (check via DiscordMembershipChecker)\n        if (typeof DiscordMembershipChecker !== 'undefined') {\n            // Check if user is already in Discord before showing prompt\n            const membershipStatus = window.discordMembershipStatus;\n            if (membershipStatus === true || membershipStatus === 'true') {\n                console.log('[waitlist-register-focus] User already in Discord, skipping prompt');\n                return;\n            }\n\n            setTimeout(() => {\n                DiscordMembershipChecker.showJoinPrompt({\n                    title: ' Pro Tip: Join Discord First!',\n                    urgency: 'info',\n                    showUrgentPopup: true\n                });\n            }, 2000); // Show after 2 seconds\n        }\n    }, {\n        priority: 20,\n        description: 'Auto-focus Discord registration button and show membership prompts',\n        reinitializable: false // Only runs on waitlist registration page\n    });\n\n    // ============================================================================\n    // REGISTRATION COMPLETE\n    // ============================================================================\n    console.log('[App Init]  7 components registered successfully');\n    console.log('[App Init] Run InitSystemDebug.printOrder() to view initialization order');\n\n})(window, document);\n","/**\n * ============================================================================\n * ADMIN PANEL BASE - JavaScript Controller\n * ============================================================================\n *\n * Purpose: Core functionality for admin panel base template\n * Features:\n * - Mobile navigation auto-collapse\n * - Touch gesture support\n * - Progressive loading\n * - Responsive table handling\n * - Network status monitoring\n * - Performance monitoring\n * - Global admin utilities\n *\n * Dependencies: Bootstrap 5\n * Registration: InitSystem (priority 15)\n *\n * ============================================================================\n */\n\n(function() {\n    'use strict';\n\n    /**\n     * Admin Panel Base Controller\n     * Uses data-* selectors for element binding (never classes)\n     */\n    const AdminPanelBase = {\n        // Configuration\n        CONFIG: {\n            MOBILE_BREAKPOINT: 768,\n            TABLET_BREAKPOINT: 992,\n            TOAST_DURATION_MOBILE: 3000,\n            TOAST_DURATION_DESKTOP: 5000,\n            FETCH_TIMEOUT_MOBILE: 10000,\n            FETCH_TIMEOUT_DESKTOP: 30000,\n            DEBOUNCE_WAIT: 250\n        },\n\n        // State tracking\n        _initialized: false,\n        _autoRefreshInterval: null,\n\n        /**\n         * Initialize all admin panel base functionality\n         */\n        init: function(context) {\n            context = context || document;\n\n            // Prevent duplicate initialization\n            if (this._initialized && context === document) {\n                return;\n            }\n\n            this.initMobileNavigation(context);\n            this.initAdminNavToggle(context);\n            this.initTouchGestures(context);\n            this.initProgressiveLoading(context);\n            this.initResponsiveTables(context);\n            this.initNetworkMonitoring();\n            this.initAutoRefreshManagement();\n            this.initPerformanceMonitoring();\n            this.initDoubleTapPrevention(context);\n            this.initSmoothScrolling(context);\n            this.initIOSBouncePrevent();\n\n            if (context === document) {\n                this._initialized = true;\n            }\n        },\n\n        /**\n         * Mobile navigation auto-collapse\n         * Uses data-nav-link and data-navbar-collapse selectors\n         */\n        initMobileNavigation: function(context) {\n            context = context || document;\n\n            // Query by data attribute first, then fall back to classes\n            const navLinks = context.querySelectorAll('[data-nav-link], .navbar-nav .nav-link');\n            const navbarCollapse = context.querySelector('[data-navbar-collapse], .navbar-collapse');\n\n            navLinks.forEach(link => {\n                // Skip if already enhanced\n                if (link.dataset.navEnhanced === 'true') return;\n                link.dataset.navEnhanced = 'true';\n\n                link.addEventListener('click', () => {\n                    if (window.innerWidth < this.CONFIG.TABLET_BREAKPOINT && navbarCollapse && navbarCollapse.classList.contains('show')) {\n                        const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);\n                        if (bsCollapse) {\n                            bsCollapse.hide();\n                        }\n                    }\n                });\n            });\n        },\n\n        /**\n         * Admin panel navigation toggle (mobile)\n         * Pure CSS/JS implementation without Bootstrap collapse\n         */\n        initAdminNavToggle: function(context) {\n            context = context || document;\n\n            const toggleBtn = context.querySelector('[data-action=\"toggle-mobile-nav\"]');\n            const navContainer = context.querySelector('[data-nav-container]');\n\n            if (!toggleBtn || !navContainer) return;\n\n            // Skip if already enhanced\n            if (toggleBtn.dataset.adminNavToggleEnhanced === 'true') return;\n            toggleBtn.dataset.adminNavToggleEnhanced = 'true';\n\n            toggleBtn.addEventListener('click', () => {\n                const isCollapsed = navContainer.classList.contains('is-collapsed');\n\n                if (isCollapsed) {\n                    navContainer.classList.remove('is-collapsed');\n                    toggleBtn.setAttribute('aria-expanded', 'true');\n                } else {\n                    navContainer.classList.add('is-collapsed');\n                    toggleBtn.setAttribute('aria-expanded', 'false');\n                }\n            });\n        },\n\n        /**\n         * Touch gesture support for cards\n         * Uses data-component=\"admin-card\" selector\n         */\n        initTouchGestures: function(context) {\n            context = context || document;\n\n            const adminCards = context.querySelectorAll('[data-component=\"admin-card\"]');\n\n            adminCards.forEach(card => {\n                // Skip if already enhanced\n                if (card.dataset.gesturesEnhanced === 'true') return;\n                card.dataset.gesturesEnhanced = 'true';\n\n                let touchStartY = 0;\n\n                card.addEventListener('touchstart', (e) => {\n                    touchStartY = e.touches[0].clientY;\n                }, { passive: true });\n\n                card.addEventListener('touchend', (e) => {\n                    const touchEndY = e.changedTouches[0].clientY;\n                    const diff = touchStartY - touchEndY;\n\n                    // Simple swipe up gesture for card interaction\n                    if (Math.abs(diff) > 50 && diff > 0) {\n                        card.click();\n                    }\n                }, { passive: true });\n            });\n        },\n\n        /**\n         * Progressive loading for heavy content\n         * Uses data-lazy-load attribute\n         */\n        initProgressiveLoading: function(context) {\n            context = context || document;\n\n            if ('IntersectionObserver' in window) {\n                const observer = new IntersectionObserver((entries) => {\n                    entries.forEach(entry => {\n                        if (entry.isIntersecting) {\n                            entry.target.classList.add('loaded');\n                            entry.target.dataset.loaded = 'true';\n                            observer.unobserve(entry.target);\n                        }\n                    });\n                }, {\n                    rootMargin: '50px'\n                });\n\n                context.querySelectorAll('[data-lazy-load]').forEach(el => {\n                    if (el.dataset.loaded !== 'true') {\n                        observer.observe(el);\n                    }\n                });\n            }\n        },\n\n        /**\n         * Responsive table handling\n         * Uses data-responsive-table or .table-responsive\n         */\n        initResponsiveTables: function(context) {\n            context = context || document;\n            const self = this;\n\n            function handleResponsiveTables() {\n                // Query by data attribute first, then fall back to class\n                const tableContainers = context.querySelectorAll('[data-responsive-table], .table-responsive');\n\n                tableContainers.forEach(container => {\n                    const table = container.tagName === 'TABLE' ? container : container.querySelector('table');\n                    if (!table) return;\n\n                    if (window.innerWidth < self.CONFIG.MOBILE_BREAKPOINT) {\n                        // Add mobile-friendly data-label attributes\n                        const headers = table.querySelectorAll('th');\n                        const rows = table.querySelectorAll('tbody tr');\n\n                        rows.forEach(row => {\n                            const cells = row.querySelectorAll('td');\n                            cells.forEach((cell, index) => {\n                                if (headers[index]) {\n                                    cell.setAttribute('data-label', headers[index].textContent);\n                                }\n                            });\n                        });\n\n                        // Add mobile stack class for very small screens\n                        if (window.innerWidth < 576) {\n                            table.classList.add('table-mobile-stack');\n                            table.dataset.mobileStack = 'true';\n                        }\n                    } else {\n                        table.classList.remove('table-mobile-stack');\n                        table.dataset.mobileStack = 'false';\n                    }\n                });\n            }\n\n            // Call on load and resize\n            handleResponsiveTables();\n            window.addEventListener('resize', this.debounce(handleResponsiveTables, this.CONFIG.DEBOUNCE_WAIT));\n        },\n\n        /**\n         * Network status monitoring\n         * Uses data-component=\"network-status\" selector\n         */\n        initNetworkMonitoring: function() {\n            // Avoid duplicate listeners\n            if (this._networkMonitoringSetup) return;\n            this._networkMonitoringSetup = true;\n\n            const self = this;\n\n            function updateNetworkStatus() {\n                const statusIndicator = document.querySelector('[data-component=\"network-status\"]');\n                if (!statusIndicator) return;\n\n                if (navigator.onLine) {\n                    statusIndicator.classList.remove('c-admin-panel-base__network-status--offline');\n                    statusIndicator.classList.add('c-admin-panel-base__network-status--online');\n                    statusIndicator.dataset.status = 'online';\n                    statusIndicator.title = 'Online';\n                } else {\n                    statusIndicator.classList.remove('c-admin-panel-base__network-status--online');\n                    statusIndicator.classList.add('c-admin-panel-base__network-status--offline');\n                    statusIndicator.dataset.status = 'offline';\n                    statusIndicator.title = 'Offline';\n\n                    // Show offline notification\n                    self.showMobileToast('You are currently offline. Some features may not work.', 'warning');\n                }\n            }\n\n            window.addEventListener('online', () => {\n                updateNetworkStatus();\n                self.showMobileToast('Connection restored', 'success');\n            });\n\n            window.addEventListener('offline', updateNetworkStatus);\n            updateNetworkStatus();\n        },\n\n        /**\n         * Auto-refresh management for mobile battery optimization\n         */\n        initAutoRefreshManagement: function() {\n            // Avoid duplicate listeners\n            if (this._autoRefreshSetup) return;\n            this._autoRefreshSetup = true;\n\n            const self = this;\n\n            function manageAutoRefresh() {\n                if (window.innerWidth < self.CONFIG.MOBILE_BREAKPOINT) {\n                    // Clear any existing auto-refresh on mobile\n                    if (self._autoRefreshInterval) {\n                        clearInterval(self._autoRefreshInterval);\n                        console.log('Auto-refresh disabled on mobile for battery optimization');\n                    }\n                }\n            }\n\n            window.addEventListener('resize', this.debounce(manageAutoRefresh, this.CONFIG.DEBOUNCE_WAIT));\n            manageAutoRefresh();\n        },\n\n        /**\n         * Performance monitoring\n         */\n        initPerformanceMonitoring: function() {\n            // Avoid duplicate observers\n            if (this._performanceMonitoringSetup) return;\n            this._performanceMonitoringSetup = true;\n\n            const self = this;\n\n            if ('PerformanceObserver' in window) {\n                const observer = new PerformanceObserver((list) => {\n                    const entries = list.getEntries();\n                    entries.forEach(entry => {\n                        if (entry.entryType === 'navigation') {\n                            const loadTime = entry.loadEventEnd - entry.loadEventStart;\n                            console.log('Page load time:', loadTime + 'ms');\n\n                            // Warn on slow loading for mobile\n                            if (loadTime > 3000 && window.innerWidth < self.CONFIG.MOBILE_BREAKPOINT) {\n                                console.warn('Slow page load detected on mobile');\n                            }\n                        }\n                    });\n                });\n\n                try {\n                    observer.observe({ entryTypes: ['navigation'] });\n                } catch (e) {\n                    console.log('Performance observer not fully supported');\n                }\n            }\n        },\n\n        /**\n         * Prevent double-tap zoom on buttons and forms\n         * Uses data-action or falls back to element types\n         * EXCLUDES navigation elements that have their own event handling\n         */\n        initDoubleTapPrevention: function(context) {\n            context = context || document;\n\n            // Query by data-action first, then fall back to element types\n            // EXCLUDE navigation elements - they have their own controller\n            const interactiveElements = context.querySelectorAll(\n                '[data-action]:not([data-action=\"toggle-dropdown\"]):not([data-action=\"navigate\"]), ' +\n                'button:not(.c-admin-nav__link):not(.c-admin-nav__dropdown-toggle), ' +\n                '.c-btn:not(.c-admin-nav__link), input, select, textarea'\n            );\n\n            interactiveElements.forEach(element => {\n                // Skip if already enhanced\n                if (element.dataset.doubleTapPrevented === 'true') return;\n                // Skip if inside admin navigation\n                if (element.closest('[data-controller=\"admin-nav\"]')) return;\n\n                element.dataset.doubleTapPrevented = 'true';\n\n                element.addEventListener('touchend', function(e) {\n                    if (this.disabled) return;\n                    e.preventDefault();\n                    this.click();\n                }, { passive: false });\n\n                element.addEventListener('click', function(e) {\n                    if (e.detail > 1) {\n                        e.preventDefault();\n                    }\n                });\n            });\n        },\n\n        /**\n         * Smooth scrolling for anchor links\n         */\n        initSmoothScrolling: function(context) {\n            context = context || document;\n\n            context.querySelectorAll('a[href^=\"#\"]').forEach(anchor => {\n                // Skip if already enhanced\n                if (anchor.dataset.smoothScrollEnhanced === 'true') return;\n                anchor.dataset.smoothScrollEnhanced = 'true';\n\n                anchor.addEventListener('click', function(e) {\n                    const href = this.getAttribute('href');\n                    // Skip empty hash links (href=\"#\") - they're not valid selectors\n                    if (!href || href === '#') {\n                        return;\n                    }\n                    e.preventDefault();\n                    try {\n                        const target = document.querySelector(href);\n                        if (target) {\n                            target.scrollIntoView({\n                                behavior: 'smooth',\n                                block: 'start'\n                            });\n                        }\n                    } catch (err) {\n                        // Invalid selector, ignore\n                        console.debug('Invalid anchor selector:', href);\n                    }\n                });\n            });\n        },\n\n        /**\n         * Prevent iOS bounce scroll\n         */\n        initIOSBouncePrevent: function() {\n            // Avoid duplicate listeners\n            if (this._iosBouncePreventSetup) return;\n            this._iosBouncePreventSetup = true;\n\n            document.body.addEventListener('touchstart', function(e) {\n                if (e.target === document.body) {\n                    e.preventDefault();\n                }\n            }, { passive: false });\n\n            document.body.addEventListener('touchend', function(e) {\n                if (e.target === document.body) {\n                    e.preventDefault();\n                }\n            }, { passive: false });\n\n            document.body.addEventListener('touchmove', function(e) {\n                if (e.target === document.body) {\n                    e.preventDefault();\n                }\n            }, { passive: false });\n        },\n\n        /**\n         * Utility: Debounce function\n         */\n        debounce: function(func, wait) {\n            let timeout;\n            return function executedFunction(...args) {\n                const later = () => {\n                    clearTimeout(timeout);\n                    func(...args);\n                };\n                clearTimeout(timeout);\n                timeout = setTimeout(later, wait);\n            };\n        },\n\n        // ========================================================================\n        // PUBLIC API - Global Admin Panel Utilities\n        // ========================================================================\n\n        /**\n         * Check if device is mobile\n         */\n        isMobile: function() {\n            return window.innerWidth < this.CONFIG.MOBILE_BREAKPOINT;\n        },\n\n        /**\n         * Check if device is tablet\n         */\n        isTablet: function() {\n            return window.innerWidth >= this.CONFIG.MOBILE_BREAKPOINT &&\n                   window.innerWidth < this.CONFIG.TABLET_BREAKPOINT;\n        },\n\n        /**\n         * Check if device is desktop\n         */\n        isDesktop: function() {\n            return window.innerWidth >= this.CONFIG.TABLET_BREAKPOINT;\n        },\n\n        /**\n         * Show mobile-friendly toast notification\n         * Uses data-component=\"toast-container\" selector\n         */\n        showMobileToast: function(message, type) {\n            type = type || 'info';\n\n            const toast = document.createElement('div');\n            toast.className = `toast align-items-center text-white bg-${type} border-0`;\n            toast.setAttribute('role', 'alert');\n            toast.setAttribute('aria-live', 'assertive');\n            toast.setAttribute('aria-atomic', 'true');\n            toast.dataset.toast = type;\n            toast.innerHTML = `\n                <div class=\"d-flex\">\n                    <div class=\"toast-body\">${message}</div>\n                    <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" data-action=\"close-toast\" aria-label=\"Close\"></button>\n                </div>\n            `;\n\n            const container = document.querySelector('[data-component=\"toast-container\"]');\n            if (container) {\n                container.appendChild(toast);\n\n                const toastInstance = new bootstrap.Toast(toast, {\n                    autohide: true,\n                    delay: this.isMobile() ? this.CONFIG.TOAST_DURATION_MOBILE : this.CONFIG.TOAST_DURATION_DESKTOP\n                });\n\n                toastInstance.show();\n\n                toast.addEventListener('hidden.bs.toast', () => {\n                    toast.remove();\n                });\n            }\n        },\n\n        /**\n         * Confirm action with mobile-optimized UX\n         * @param {string} message - The confirmation message\n         * @param {function} callback - Function to call if confirmed\n         * @param {object} options - Optional configuration\n         * @param {string} options.confirmText - Custom confirm button text\n         * @param {string} options.cancelText - Custom cancel button text\n         * @param {string} options.title - Custom title\n         * @param {string} options.icon - SweetAlert icon (warning, question, info, error)\n         * @param {string} options.confirmColor - Confirm button color (#hex or Bootstrap class)\n         */\n        confirmAction: function(message, callback, options) {\n            options = options || {};\n\n            // Smart defaults based on message content\n            const messageLower = message.toLowerCase();\n            let defaultConfirm = 'Confirm';\n            let defaultCancel = 'Cancel';\n            let defaultIcon = 'question';\n            let defaultTitle = 'Confirm Action';\n            let defaultColor = '#3085d6';\n\n            // Contextual button text based on action type\n            if (messageLower.includes('delete') || messageLower.includes('remove')) {\n                defaultConfirm = 'Delete';\n                defaultIcon = 'warning';\n                defaultTitle = 'Confirm Delete';\n                defaultColor = '#dc3545'; // danger red\n            } else if (messageLower.includes('sync')) {\n                defaultConfirm = 'Sync';\n                defaultIcon = 'question';\n                defaultTitle = 'Confirm Sync';\n            } else if (messageLower.includes('reset')) {\n                defaultConfirm = 'Reset';\n                defaultIcon = 'warning';\n                defaultTitle = 'Confirm Reset';\n                defaultColor = '#dc3545';\n            } else if (messageLower.includes('clear')) {\n                defaultConfirm = 'Clear';\n                defaultIcon = 'warning';\n                defaultTitle = 'Confirm Clear';\n                defaultColor = '#dc3545';\n            } else if (messageLower.includes('approve')) {\n                defaultConfirm = 'Approve';\n                defaultIcon = 'question';\n                defaultTitle = 'Confirm Approval';\n                defaultColor = '#28a745'; // success green\n            } else if (messageLower.includes('reject') || messageLower.includes('deny')) {\n                defaultConfirm = 'Reject';\n                defaultIcon = 'warning';\n                defaultTitle = 'Confirm Rejection';\n                defaultColor = '#dc3545';\n            } else if (messageLower.includes('send')) {\n                defaultConfirm = 'Send';\n                defaultIcon = 'question';\n                defaultTitle = 'Confirm Send';\n            } else if (messageLower.includes('save')) {\n                defaultConfirm = 'Save';\n                defaultIcon = 'question';\n                defaultTitle = 'Confirm Save';\n                defaultColor = '#28a745';\n            } else if (messageLower.includes('cancel')) {\n                defaultConfirm = 'Yes, Cancel';\n                defaultIcon = 'warning';\n                defaultTitle = 'Confirm Cancellation';\n            } else if (messageLower.includes('disable')) {\n                defaultConfirm = 'Disable';\n                defaultIcon = 'warning';\n                defaultTitle = 'Confirm Disable';\n                defaultColor = '#dc3545';\n            } else if (messageLower.includes('enable')) {\n                defaultConfirm = 'Enable';\n                defaultIcon = 'question';\n                defaultTitle = 'Confirm Enable';\n                defaultColor = '#28a745';\n            } else if (messageLower.includes('continue')) {\n                defaultConfirm = 'Continue';\n            }\n\n            const confirmText = options.confirmText || defaultConfirm;\n            const cancelText = options.cancelText || defaultCancel;\n            const title = options.title || defaultTitle;\n            const icon = options.icon || defaultIcon;\n            const confirmColor = options.confirmColor || defaultColor;\n\n            if (this.isMobile()) {\n                // Use native confirm on mobile for better UX\n                if (confirm(message)) {\n                    callback();\n                }\n            } else {\n                // Use SweetAlert2 on desktop if available\n                if (typeof Swal !== 'undefined') {\n                    Swal.fire({\n                        title: title,\n                        text: message,\n                        icon: icon,\n                        showCancelButton: true,\n                        confirmButtonText: confirmText,\n                        cancelButtonText: cancelText,\n                        confirmButtonColor: confirmColor,\n                        cancelButtonColor: '#6c757d',\n                        reverseButtons: true // Cancel on left, Confirm on right\n                    }).then((result) => {\n                        if (result.isConfirmed) {\n                            callback();\n                        }\n                    });\n                } else {\n                    if (confirm(message)) {\n                        callback();\n                    }\n                }\n            }\n        },\n\n        /**\n         * Show loading state on element\n         */\n        showLoading: function(element) {\n            if (element) {\n                element.classList.add('is-loading');\n                element.dataset.loading = 'true';\n            }\n        },\n\n        /**\n         * Hide loading state on element\n         */\n        hideLoading: function(element) {\n            if (element) {\n                element.classList.remove('is-loading');\n                element.dataset.loading = 'false';\n            }\n        },\n\n        /**\n         * Optimized fetch for mobile with timeout and error handling\n         */\n        fetch: async function(url, options) {\n            options = options || {};\n            const self = this;\n            const controller = new AbortController();\n            const timeoutId = setTimeout(\n                () => controller.abort(),\n                self.isMobile() ? self.CONFIG.FETCH_TIMEOUT_MOBILE : self.CONFIG.FETCH_TIMEOUT_DESKTOP\n            );\n\n            try {\n                const response = await fetch(url, {\n                    ...options,\n                    signal: controller.signal\n                });\n\n                clearTimeout(timeoutId);\n                return response;\n            } catch (error) {\n                clearTimeout(timeoutId);\n\n                if (error.name === 'AbortError') {\n                    self.showMobileToast('Request timed out. Please try again.', 'warning');\n                } else if (!navigator.onLine) {\n                    self.showMobileToast('No internet connection. Please check your network.', 'danger');\n                }\n\n                throw error;\n            }\n        }\n    };\n\n    /**\n     * Service Worker Registration (for offline support)\n     */\n    function registerServiceWorker() {\n        if ('serviceWorker' in navigator && 'caches' in window) {\n            window.addEventListener('load', () => {\n                navigator.serviceWorker.register('/static/js/service-worker.js')\n                    .then(registration => {\n                        console.log('Service Worker registered:', registration);\n                    })\n                    .catch(error => {\n                        console.log('Service Worker registration failed:', error);\n                    });\n            });\n        }\n    }\n\n    // Register with InitSystem if available\n    if (typeof window.InitSystem !== 'undefined') {\n        window.InitSystem.register('AdminPanelBase', {\n            priority: 15, // Early priority - after responsive-global (10) but before most components\n            init: function(context) {\n                AdminPanelBase.init(context);\n                registerServiceWorker();\n            }\n        });\n    } else {\n        // Fallback to DOMContentLoaded\n        document.addEventListener('DOMContentLoaded', function() {\n            AdminPanelBase.init(document);\n            registerServiceWorker();\n        });\n    }\n\n    // Expose AdminPanel globally for backward compatibility\n    window.AdminPanel = AdminPanelBase;\n\n    // Also expose as AdminPanelBase for explicit access\n    window.AdminPanelBase = AdminPanelBase;\n\n})();\n","/**\n * ============================================================================\n * ADMIN PANEL DASHBOARD - JAVASCRIPT CONTROLLER\n * ============================================================================\n *\n * Handles all interactions for the admin panel dashboard.\n * Uses the centralized EventDelegation system for all click handling.\n *\n * Features:\n * - Navigation handling\n * - Modal dialogs (navigation settings, registration settings, etc.)\n * - Task monitoring\n * - Database monitoring\n * - Match reports\n *\n * Architecture:\n * - Registers handlers with EventDelegation (no duplicate listeners)\n * - Data-action attribute driven\n * - No inline event handlers\n *\n * ============================================================================\n */\n\n(function() {\n  'use strict';\n\n  // ============================================================================\n  // INITIALIZATION\n  // ============================================================================\n\n  function init() {\n    // Only initialize if we're on the admin dashboard page\n    if (!document.querySelector('.admin-panel-dashboard, [data-page=\"admin-dashboard\"]')) {\n      return;\n    }\n\n    registerEventHandlers();\n    highlightActiveNav();\n    setupNavigationCards();\n\n    console.log('[AdminDashboard] Initialized');\n  }\n\n  // ============================================================================\n  // EVENT REGISTRATION - Uses central EventDelegation system\n  // ============================================================================\n\n  function registerEventHandlers() {\n    // Check if EventDelegation is available\n    if (typeof EventDelegation === 'undefined') {\n      console.warn('[AdminDashboard] EventDelegation not available, skipping handler registration');\n      return;\n    }\n\n    // Register only the actions this module handles\n    EventDelegation.register('navigate', handleNavigate);\n    EventDelegation.register('open-navigation-settings', openNavigationSettings, { preventDefault: true });\n    EventDelegation.register('open-registration-settings', openRegistrationSettings, { preventDefault: true });\n    EventDelegation.register('open-task-monitor', openTaskMonitor, { preventDefault: true });\n    EventDelegation.register('open-database-monitor', openDatabaseMonitor, { preventDefault: true });\n    EventDelegation.register('open-match-reports', openMatchReports, { preventDefault: true });\n    EventDelegation.register('generate-report', generateReport, { preventDefault: true });\n  }\n\n  function setupNavigationCards() {\n    // Add pointer cursor to navigation cards\n    document.querySelectorAll('[data-action=\"navigate\"]').forEach(card => {\n      card.style.cursor = 'pointer';\n    });\n  }\n\n  // ============================================================================\n  // NAVIGATION\n  // ============================================================================\n\n  function handleNavigate(element) {\n    const url = element.dataset.url;\n    if (url) {\n      window.location.href = url;\n    }\n  }\n\n  function highlightActiveNav() {\n    const currentPath = window.location.pathname;\n    const navLinks = document.querySelectorAll('.nav-pills .nav-link');\n\n    navLinks.forEach(link => {\n      if (currentPath.includes(link.getAttribute('href'))) {\n        link.classList.add('active');\n      }\n    });\n  }\n\n  // ============================================================================\n  // MODAL: NAVIGATION SETTINGS\n  // ============================================================================\n\n  function openNavigationSettings() {\n    if (typeof Swal === 'undefined') {\n      alert('SweetAlert2 is required for this feature');\n      return;\n    }\n\n    Swal.fire({\n      title: 'Navigation Settings',\n      html: '<div class=\"text-center\"><div class=\"spinner-border\" role=\"status\"><span class=\"visually-hidden\">Loading...</span></div><p class=\"mt-2\">Loading navigation settings...</p></div>',\n      showConfirmButton: false,\n      allowOutsideClick: false\n    });\n\n    fetch('/admin-panel/api/navigation-settings')\n      .then(response => response.json())\n      .then(data => {\n        if (data.success) {\n          showNavigationSettingsModal(data.settings);\n        } else {\n          Swal.fire('Error', data.message || 'Failed to load navigation settings', 'error');\n        }\n      })\n      .catch(error => {\n        console.error('Navigation settings error:', error);\n        Swal.fire('Error', 'Failed to load navigation settings', 'error');\n      });\n  }\n\n  function showNavigationSettingsModal(settings) {\n    const html = `\n      <div class=\"text-start\">\n        <p class=\"text-info mb-3\"><i class=\"ti ti-info-circle me-1\"></i>Control which navigation items are visible to non-admin users. Admins can always see all navigation items.</p>\n\n        <div class=\"row\">\n          <div class=\"col-md-6\">\n            ${createToggle('teamsNav', 'Teams Navigation', 'Team rosters and management for pl-premier, pl-classic roles', settings.teams_navigation_enabled)}\n            ${createToggle('storeNav', 'Store Navigation', 'League store for coaches and admins', settings.store_navigation_enabled)}\n            ${createToggle('matchesNav', 'Matches Navigation', 'Match schedules and results', settings.matches_navigation_enabled)}\n            ${createToggle('leaguesNav', 'Leagues Navigation', 'League standings and information', settings.leagues_navigation_enabled)}\n          </div>\n          <div class=\"col-md-6\">\n            ${createToggle('draftsNav', 'Drafts Navigation', 'Draft system for coaches', settings.drafts_navigation_enabled)}\n            ${createToggle('playersNav', 'Players Navigation', 'Player profiles and statistics', settings.players_navigation_enabled)}\n            ${createToggle('messagingNav', 'Messaging Navigation', 'Communication tools', settings.messaging_navigation_enabled)}\n            ${createToggle('mobileFeaturesNav', 'Mobile Features Navigation', 'Mobile app integration', settings.mobile_features_navigation_enabled)}\n          </div>\n        </div>\n      </div>\n    `;\n\n    Swal.fire({\n      title: 'Navigation Settings',\n      html: html,\n      width: '800px',\n      showCancelButton: true,\n      confirmButtonText: 'Save Settings',\n      cancelButtonText: 'Cancel',\n      showLoaderOnConfirm: true,\n      preConfirm: () => saveNavigationSettings(),\n      allowOutsideClick: () => !Swal.isLoading()\n    }).then((result) => {\n      if (result.isConfirmed) {\n        Swal.fire({\n          title: 'Settings Saved!',\n          text: 'Navigation settings have been updated successfully. Changes will take effect immediately.',\n          icon: 'success'\n        }).then(() => {\n          location.reload();\n        });\n      }\n    });\n  }\n\n  function saveNavigationSettings() {\n    const formData = {\n      teams_navigation_enabled: document.getElementById('teamsNav').checked,\n      store_navigation_enabled: document.getElementById('storeNav').checked,\n      matches_navigation_enabled: document.getElementById('matchesNav').checked,\n      leagues_navigation_enabled: document.getElementById('leaguesNav').checked,\n      drafts_navigation_enabled: document.getElementById('draftsNav').checked,\n      players_navigation_enabled: document.getElementById('playersNav').checked,\n      messaging_navigation_enabled: document.getElementById('messagingNav').checked,\n      mobile_features_navigation_enabled: document.getElementById('mobileFeaturesNav').checked\n    };\n\n    return fetch('/admin-panel/api/navigation-settings', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': getCSRFToken()\n      },\n      body: JSON.stringify(formData)\n    })\n    .then(response => response.json())\n    .then(data => {\n      if (!data.success) {\n        throw new Error(data.message);\n      }\n      return data;\n    });\n  }\n\n  // ============================================================================\n  // MODAL: REGISTRATION SETTINGS\n  // ============================================================================\n\n  function openRegistrationSettings() {\n    if (typeof Swal === 'undefined') {\n      alert('SweetAlert2 is required for this feature');\n      return;\n    }\n\n    Swal.fire({\n      title: 'Registration Settings',\n      html: '<div class=\"text-center\"><div class=\"spinner-border\" role=\"status\"><span class=\"visually-hidden\">Loading...</span></div><p class=\"mt-2\">Loading registration settings...</p></div>',\n      showConfirmButton: false,\n      allowOutsideClick: false\n    });\n\n    fetch('/admin-panel/api/registration-settings')\n      .then(response => response.json())\n      .then(data => {\n        if (data.success) {\n          showRegistrationSettingsModal(data.settings, data.available_roles);\n        } else {\n          Swal.fire('Error', data.message || 'Failed to load registration settings', 'error');\n        }\n      })\n      .catch(error => {\n        console.error('Registration settings error:', error);\n        Swal.fire('Error', 'Failed to load registration settings', 'error');\n      });\n  }\n\n  function showRegistrationSettingsModal(settings, roles) {\n    const roleOptions = roles.map(role =>\n      `<option value=\"${role.name}\" ${settings.default_user_role === role.name ? 'selected' : ''}>${role.name}</option>`\n    ).join('');\n\n    const html = `\n      <div class=\"text-start\">\n        <p class=\"text-info mb-3\"><i class=\"ti ti-info-circle me-1\"></i>Configure registration settings based on your actual onboarding flow. Discord OAuth is the primary login method.</p>\n\n        <div class=\"row\">\n          <div class=\"col-md-6\">\n            <h6 class=\"text-primary mb-3\">Registration Control</h6>\n            ${createToggle('registrationEnabled', 'Allow New Registration', 'Enable/disable new user registration', settings.registration_enabled)}\n            ${createToggle('waitlistEnabled', 'Enable Waitlist', 'Allow waitlist registration when full', settings.waitlist_registration_enabled)}\n            ${createToggle('adminApproval', 'Admin Approval Required', 'All new users need admin approval', settings.admin_approval_required)}\n            ${createToggle('discordOnly', 'Discord Only Login', 'Only Discord OAuth allowed (FIXED)', true, true)}\n\n            <div class=\"mb-3\">\n              <label class=\"form-label\">Default User Role</label>\n              <select class=\"form-select\" id=\"defaultRole\">\n                ${roleOptions}\n              </select>\n              <small class=\"text-muted\">Role assigned to new registered users</small>\n            </div>\n          </div>\n          <div class=\"col-md-6\">\n            <h6 class=\"text-primary mb-3\">Registration Fields</h6>\n            ${createToggle('requireRealName', 'Require Real Name', '', settings.require_real_name)}\n            ${createToggle('requireEmail', 'Require Email', '', settings.require_email)}\n            ${createToggle('requirePhone', 'Require Phone Number', '', settings.require_phone)}\n            ${createToggle('requireLocation', 'Require Location', '', settings.require_location)}\n            ${createToggle('requireJerseySize', 'Require Jersey Size', '', settings.require_jersey_size)}\n            ${createToggle('requirePositions', 'Require Position Preferences', '', settings.require_position_preferences)}\n            ${createToggle('requireAvailability', 'Require Availability Info', '', settings.require_availability)}\n            ${createToggle('requireReferee', 'Require Referee Willingness', '', settings.require_referee_willingness)}\n          </div>\n        </div>\n        <div class=\"alert alert-info mt-3\">\n          <small><i class=\"ti ti-info-circle me-1\"></i>These settings reflect your real onboarding form fields. Discord OAuth is your primary authentication method.</small>\n        </div>\n      </div>\n    `;\n\n    Swal.fire({\n      title: 'Registration Settings',\n      html: html,\n      width: '900px',\n      showCancelButton: true,\n      confirmButtonText: 'Save Settings',\n      cancelButtonText: 'Cancel',\n      showLoaderOnConfirm: true,\n      preConfirm: () => saveRegistrationSettings(),\n      allowOutsideClick: () => !Swal.isLoading()\n    }).then((result) => {\n      if (result.isConfirmed) {\n        Swal.fire({\n          title: 'Settings Saved!',\n          text: 'Registration settings have been updated successfully. Changes will affect new registrations immediately.',\n          icon: 'success'\n        });\n      }\n    });\n  }\n\n  function saveRegistrationSettings() {\n    const formData = {\n      registration_enabled: document.getElementById('registrationEnabled').checked,\n      waitlist_registration_enabled: document.getElementById('waitlistEnabled').checked,\n      admin_approval_required: document.getElementById('adminApproval').checked,\n      discord_only_login: true,\n      default_user_role: document.getElementById('defaultRole').value,\n      require_real_name: document.getElementById('requireRealName').checked,\n      require_email: document.getElementById('requireEmail').checked,\n      require_phone: document.getElementById('requirePhone').checked,\n      require_location: document.getElementById('requireLocation').checked,\n      require_jersey_size: document.getElementById('requireJerseySize').checked,\n      require_position_preferences: document.getElementById('requirePositions').checked,\n      require_availability: document.getElementById('requireAvailability').checked,\n      require_referee_willingness: document.getElementById('requireReferee').checked\n    };\n\n    return fetch('/admin-panel/api/registration-settings', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': getCSRFToken()\n      },\n      body: JSON.stringify(formData)\n    })\n    .then(response => response.json())\n    .then(data => {\n      if (!data.success) {\n        throw new Error(data.message);\n      }\n      return data;\n    });\n  }\n\n  // ============================================================================\n  // MODAL: TASK MONITOR\n  // ============================================================================\n\n  function openTaskMonitor() {\n    if (typeof Swal === 'undefined') {\n      alert('SweetAlert2 is required for this feature');\n      return;\n    }\n\n    Swal.fire({\n      title: 'Task Monitor',\n      html: '<div class=\"text-center\"><div class=\"spinner-border\" role=\"status\"><span class=\"visually-hidden\">Loading...</span></div><p class=\"mt-2\">Loading task information...</p></div>',\n      width: '800px',\n      showConfirmButton: false,\n      allowOutsideClick: false\n    });\n\n    fetch('/admin-panel/api/task-monitor')\n      .then(response => response.json())\n      .then(data => {\n        showTaskMonitorModal(data);\n      })\n      .catch(error => {\n        console.error('Error loading task monitor:', error);\n        Swal.fire('Error', 'Failed to load task monitor data', 'error');\n      });\n  }\n\n  function showTaskMonitorModal(data) {\n    let tasksHtml = '';\n    if (data.tasks && data.tasks.length > 0) {\n      data.tasks.forEach(task => {\n        const statusClass = task.status === 'active' ? 'success' : 'secondary';\n        tasksHtml += `\n          <tr>\n            <td>${task.name}</td>\n            <td><span class=\"badge bg-${statusClass}\">${task.status}</span></td>\n            <td>${task.started || '-'}</td>\n            <td>${task.worker || '-'}</td>\n            <td class=\"text-truncate\">${task.args || '-'}</td>\n          </tr>\n        `;\n      });\n    } else {\n      tasksHtml = '<tr><td colspan=\"5\" class=\"text-center text-muted\">No active tasks found</td></tr>';\n    }\n\n    const html = `\n      <div class=\"text-start\">\n        <div class=\"row mb-3\">\n          <div class=\"col-md-4\">\n            <div class=\"card bg-success text-white\">\n              <div class=\"card-body text-center\">\n                <h4>${data.active_count || 0}</h4>\n                <small>Active Tasks</small>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-md-4\">\n            <div class=\"card bg-warning text-white\">\n              <div class=\"card-body text-center\">\n                <h4>${data.scheduled_count || 0}</h4>\n                <small>Scheduled Tasks</small>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-md-4\">\n            <div class=\"card bg-info text-white\">\n              <div class=\"card-body text-center\">\n                <h4>${data.worker_count || 0}</h4>\n                <small>Workers</small>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"table-responsive\">\n          <table class=\"table table-sm\">\n            <thead>\n              <tr>\n                <th>Task Name</th>\n                <th>Status</th>\n                <th>Started</th>\n                <th>Worker</th>\n                <th>Arguments</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${tasksHtml}\n            </tbody>\n          </table>\n        </div>\n        ${data.message ? `<div class=\"alert alert-info\"><small>${data.message}</small></div>` : ''}\n        <p class=\"text-muted mt-3\"><small>Task monitoring shows real-time background processes and scheduled jobs.</small></p>\n      </div>\n    `;\n\n    Swal.fire({\n      title: 'Task Monitor',\n      html: html,\n      width: '900px',\n      confirmButtonText: 'Close'\n    });\n  }\n\n  // ============================================================================\n  // MODAL: DATABASE MONITOR\n  // ============================================================================\n\n  function openDatabaseMonitor() {\n    if (typeof Swal === 'undefined') {\n      alert('SweetAlert2 is required for this feature');\n      return;\n    }\n\n    Swal.fire({\n      title: 'Database Monitor',\n      html: '<div class=\"text-center\"><div class=\"spinner-border\" role=\"status\"><span class=\"visually-hidden\">Loading...</span></div><p class=\"mt-2\">Loading system information...</p></div>',\n      width: '900px',\n      showConfirmButton: false,\n      allowOutsideClick: false\n    });\n\n    fetch('/admin-panel/api/system-status')\n      .then(response => response.json())\n      .then(data => {\n        showDatabaseMonitorModal(data);\n      })\n      .catch(error => {\n        console.error('Error loading database monitor:', error);\n        Swal.fire('Error', 'Failed to load system monitor data', 'error');\n      });\n  }\n\n  function showDatabaseMonitorModal(data) {\n    const html = `\n      <div class=\"text-start\">\n        <div class=\"row mb-3\">\n          <div class=\"col-md-3\">\n            <div class=\"card bg-info text-white\">\n              <div class=\"card-body text-center\">\n                <h4>${data.system.cpu_percent}%</h4>\n                <small>CPU Usage</small>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-md-3\">\n            <div class=\"card bg-success text-white\">\n              <div class=\"card-body text-center\">\n                <h4>${data.system.memory_percent}%</h4>\n                <small>Memory Usage</small>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-md-3\">\n            <div class=\"card bg-primary text-white\">\n              <div class=\"card-body text-center\">\n                <h4>${data.services.database.response_time_ms}ms</h4>\n                <small>DB Response Time</small>\n              </div>\n            </div>\n          </div>\n          <div class=\"col-md-3\">\n            <div class=\"card bg-${data.services.redis.status === 'online' ? 'success' : 'danger'} text-white\">\n              <div class=\"card-body text-center\">\n                <h4>${data.services.redis.response_time_ms}ms</h4>\n                <small>Redis Response</small>\n              </div>\n            </div>\n          </div>\n        </div>\n        <p class=\"text-muted mt-3\"><small>Real-time system monitoring data updated at ${new Date(data.timestamp).toLocaleString()}.</small></p>\n      </div>\n    `;\n\n    Swal.fire({\n      title: 'System Monitor',\n      html: html,\n      width: '900px',\n      confirmButtonText: 'Close'\n    });\n  }\n\n  // ============================================================================\n  // MODAL: MATCH REPORTS\n  // ============================================================================\n\n  function openMatchReports() {\n    if (typeof Swal === 'undefined') {\n      alert('SweetAlert2 is required for this feature');\n      return;\n    }\n\n    Swal.fire({\n      title: 'Match Reports',\n      html: `\n        <div class=\"text-start\">\n          <p class=\"text-info mb-3\"><i class=\"ti ti-info-circle me-1\"></i>Generate comprehensive match reports with various options.</p>\n          <div class=\"alert alert-warning\">\n            <strong>Note:</strong> This feature is currently in development. Report generation will be available soon.\n          </div>\n        </div>\n      `,\n      width: '600px',\n      confirmButtonText: 'Close'\n    });\n  }\n\n  function generateReport() {\n    console.log('Generate report functionality coming soon');\n  }\n\n  // ============================================================================\n  // UTILITIES\n  // ============================================================================\n\n  function createToggle(id, label, description, checked, disabled = false) {\n    return `\n      <div class=\"mb-3\">\n        <div class=\"form-check form-switch\">\n          <input class=\"form-check-input\" type=\"checkbox\" id=\"${id}\" ${checked ? 'checked' : ''} ${disabled ? 'disabled' : ''}>\n          <label class=\"form-check-label\" for=\"${id}\">\n            <strong>${label}</strong>\n            ${description ? `<br><small class=\"text-muted\">${description}</small>` : ''}\n          </label>\n        </div>\n      </div>\n    `;\n  }\n\n  function getCSRFToken() {\n    const metaToken = document.querySelector('meta[name=\"csrf-token\"]');\n    if (metaToken) {\n      return metaToken.getAttribute('content');\n    }\n\n    const formToken = document.querySelector('input[name=\"csrf_token\"]');\n    if (formToken) {\n      return formToken.value;\n    }\n\n    console.error('CSRF token not found');\n    return '';\n  }\n\n  // ============================================================================\n  // AUTO-INITIALIZE\n  // ============================================================================\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n\n})();\n","/**\n * ============================================================================\n * DISCORD BOT MANAGEMENT - EVENT HANDLERS\n * ============================================================================\n *\n * Modern JavaScript for Discord bot admin panel with event delegation\n * No inline scripts - all handlers attached via data-action attributes\n *\n * Features:\n * - Bot control operations (restart, health check, logs, sync)\n * - Command management (view, permissions, usage, custom)\n * - Guild management (stats, settings, add)\n * - Configuration management (save, reset, load)\n * - Real-time updates and animations\n *\n * ============================================================================\n */\n\n(function() {\n  'use strict';\n\n  // Configuration\n  const CONFIG = {\n    botApiUrl: 'http://localhost:5001/api/bot',\n    recentLogs: null, // Will be populated from template\n    commands: null, // Will be populated from template\n    commandUsage: null, // Will be populated from template\n    guildInfo: null // Will be populated from template\n  };\n\n  // Initialize data from template\n  function initializeData() {\n    // These would be populated from script tags in the template if needed\n    // For now, using placeholder data structure\n    CONFIG.recentLogs = window.__BOT_RECENT_LOGS__ || [];\n    CONFIG.commands = window.__BOT_COMMANDS__ || [];\n    CONFIG.commandUsage = window.__BOT_COMMAND_USAGE__ || {};\n    CONFIG.guildInfo = window.__BOT_GUILD_INFO__ || {};\n  }\n\n  // ============================================================================\n  // BOT CONTROL OPERATIONS\n  // ============================================================================\n\n  async function restartBot() {\n    const result = await Swal.fire({\n      title: 'Restart Discord Bot?',\n      text: 'This will temporarily disconnect the bot from Discord while it restarts.',\n      icon: 'warning',\n      showCancelButton: true,\n      confirmButtonText: 'Restart Bot'\n    });\n\n    if (result.isConfirmed) {\n      Swal.fire({\n        title: 'Restarting Bot...',\n        text: 'Please wait while the bot restarts',\n        allowOutsideClick: false,\n        didOpen: () => {\n          Swal.showLoading();\n\n          fetch(`${CONFIG.botApiUrl}/restart`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            }\n          })\n          .then(response => response.json())\n          .then(data => {\n            if (data.success) {\n              Swal.fire('Restarted!', 'Discord bot restart has been initiated.', 'success');\n            } else {\n              Swal.fire('Error!', `Failed to restart bot: ${data.message || 'Unknown error'}`, 'error');\n            }\n          })\n          .catch(error => {\n            console.error('Error restarting bot:', error);\n            Swal.fire('Error!', 'Failed to connect to bot API.', 'error');\n          });\n        }\n      });\n    }\n  }\n\n  async function checkBotHealth() {\n    Swal.fire({\n      title: 'Running Health Check...',\n      text: 'Checking bot connectivity and status',\n      allowOutsideClick: false,\n      didOpen: () => {\n        Swal.showLoading();\n\n        fetch(`${CONFIG.botApiUrl}/health-detailed`)\n        .then(response => response.json())\n        .then(data => {\n          if (data.status === 'online') {\n            const healthInfo = `\n              <div class=\"text-start\">\n                <p><strong>Status:</strong> ${data.status}</p>\n                <p><strong>Username:</strong> ${data.username || 'Unknown'}</p>\n                <p><strong>Guild Count:</strong> ${data.guild_count || 0}</p>\n                <p><strong>Latency:</strong> ${data.latency || 'N/A'}ms</p>\n                ${data.memory_usage_mb ? `<p><strong>Memory Usage:</strong> ${data.memory_usage_mb}MB</p>` : ''}\n              </div>\n            `;\n            Swal.fire({\n              title: 'Bot Health Check',\n              html: healthInfo,\n              icon: 'success',\n              confirmButtonText: 'Close'\n            });\n          } else {\n            Swal.fire('Bot Offline', `Bot status: ${data.status}. ${data.details || ''}`, 'warning');\n          }\n        })\n        .catch(error => {\n          console.error('Error checking bot health:', error);\n          Swal.fire('Connection Error', 'Failed to connect to bot API.', 'error');\n        });\n      }\n    });\n  }\n\n  function viewBotLogs() {\n    let logsHtml = '';\n    const logs = CONFIG.recentLogs;\n\n    if (logs && logs.length > 0) {\n      logs.forEach(log => {\n        const timestamp = new Date(log.timestamp).toLocaleString();\n        logsHtml += `[${timestamp}] ${log.level}: ${log.message}\\n`;\n      });\n    } else {\n      logsHtml = 'No recent logs available. Bot may not be connected to the API.';\n    }\n\n    Swal.fire({\n      title: 'Discord Bot Logs',\n      html: `\n        <div class=\"bot-logs-container\" style=\"max-height: 400px; overflow-y: auto; text-align: left;\">\n          <pre style=\"font-family: var(--font-mono); font-size: 0.875rem; white-space: pre-wrap;\">${logsHtml}</pre>\n        </div>\n      `,\n      showCancelButton: true,\n      confirmButtonText: 'Refresh Logs',\n      cancelButtonText: 'Close',\n      width: '700px'\n    }).then((result) => {\n      if (result.isConfirmed) {\n        location.reload();\n      }\n    });\n  }\n\n  async function syncCommands() {\n    const result = await Swal.fire({\n      title: 'Sync Commands?',\n      text: 'This will synchronize all slash commands with Discord.',\n      icon: 'question',\n      showCancelButton: true,\n      confirmButtonText: 'Sync Commands'\n    });\n\n    if (result.isConfirmed) {\n      Swal.fire({\n        title: 'Syncing Commands...',\n        text: 'Please wait while commands are synchronized',\n        allowOutsideClick: false,\n        didOpen: () => {\n          Swal.showLoading();\n\n          fetch(`${CONFIG.botApiUrl}/sync-commands`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n            }\n          })\n          .then(response => response.json())\n          .then(data => {\n            if (data.success) {\n              Swal.fire('Synced!', `${data.commands_synced || 'All'} commands have been synchronized with Discord.`, 'success');\n            } else {\n              Swal.fire('Error!', `Failed to sync commands: ${data.message || 'Unknown error'}`, 'error');\n            }\n          })\n          .catch(error => {\n            console.error('Error syncing commands:', error);\n            Swal.fire('Error!', 'Failed to connect to bot API.', 'error');\n          });\n        }\n      });\n    }\n  }\n\n  // ============================================================================\n  // COMMAND MANAGEMENT\n  // ============================================================================\n\n  function viewCommands() {\n    const commands = CONFIG.commands;\n    let commandsHtml = '';\n\n    // Group commands by category\n    const categories = {};\n    commands.forEach(cmd => {\n      if (!categories[cmd.category]) {\n        categories[cmd.category] = [];\n      }\n      categories[cmd.category].push(cmd);\n    });\n\n    // Build HTML for each category\n    Object.keys(categories).forEach(category => {\n      commandsHtml += `\n        <div class=\"mb-4\">\n          <h6 class=\"mb-2 text-primary\">${category} Commands</h6>\n          <div class=\"table-responsive\">\n            <table class=\"table table-sm table-hover\">\n              <thead class=\"table-light\">\n                <tr>\n                  <th>Command</th>\n                  <th>Description</th>\n                  <th>Permission</th>\n                </tr>\n              </thead>\n              <tbody>\n      `;\n\n      categories[category].forEach(cmd => {\n        const permissionColor = cmd.permission_level === 'Public' ? 'success' :\n                               cmd.permission_level.includes('Admin') ? 'danger' : 'warning';\n        commandsHtml += `\n          <tr>\n            <td><code>/${cmd.name}</code></td>\n            <td>${cmd.description}</td>\n            <td><span class=\"badge bg-${permissionColor}\">${cmd.permission_level}</span></td>\n          </tr>\n        `;\n      });\n\n      commandsHtml += `\n              </tbody>\n            </table>\n          </div>\n        </div>\n      `;\n    });\n\n    Swal.fire({\n      title: 'Discord Bot Commands',\n      html: `\n        <div class=\"command-list-container\" style=\"max-height: 500px; overflow-y: auto;\">\n          ${commandsHtml}\n        </div>\n      `,\n      confirmButtonText: 'Close',\n      width: '800px'\n    });\n  }\n\n  function commandPermissions() {\n    // Placeholder - would implement permissions management\n    Swal.fire('Command Permissions', 'Command permissions management interface would appear here.', 'info');\n  }\n\n  function commandUsage() {\n    const usage = CONFIG.commandUsage;\n\n    Swal.fire({\n      title: 'Command Usage Statistics',\n      html: `\n        <div class=\"command-usage-stats\" style=\"text-align: left;\">\n          <div class=\"row mb-3\">\n            <div class=\"col-md-6\">\n              <div class=\"card bg-primary text-white\">\n                <div class=\"card-body text-center\">\n                  <h4>${usage.commands_today || 0}</h4>\n                  <small>Commands Today</small>\n                </div>\n              </div>\n            </div>\n            <div class=\"col-md-6\">\n              <div class=\"card bg-info text-white\">\n                <div class=\"card-body text-center\">\n                  <h4>${usage.commands_this_week || 0}</h4>\n                  <small>Commands This Week</small>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"row\">\n            <div class=\"col-md-6\">\n              <h6>Most Used Command</h6>\n              <p><code>/${usage.most_used_command || 'N/A'}</code></p>\n            </div>\n            <div class=\"col-md-6\">\n              <h6>Average Response Time</h6>\n              <p>${usage.avg_response_time || 'N/A'}</p>\n            </div>\n          </div>\n        </div>\n      `,\n      confirmButtonText: 'Close',\n      width: '700px'\n    });\n  }\n\n  function customCommands() {\n    // Placeholder - would implement custom commands interface\n    Swal.fire('Custom Commands', 'Custom commands management interface would appear here.', 'info');\n  }\n\n  // ============================================================================\n  // GUILD MANAGEMENT\n  // ============================================================================\n\n  function manageGuild(element, e) {\n    const guildId = element.dataset.guild;\n    Swal.fire('Guild Management', `Guild management interface for ${guildId} would appear here.`, 'info');\n  }\n\n  function guildStats(element, e) {\n    const guild = CONFIG.guildInfo;\n\n    Swal.fire({\n      title: `${guild.name || 'Guild'} Statistics`,\n      html: `\n        <div class=\"guild-stats-container\" style=\"text-align: left;\">\n          <div class=\"row mb-3\">\n            <div class=\"col-md-4\">\n              <div class=\"card bg-primary text-white\">\n                <div class=\"card-body text-center\">\n                  <h4>${guild.member_count || 0}</h4>\n                  <small>Total Members</small>\n                </div>\n              </div>\n            </div>\n            <div class=\"col-md-4\">\n              <div class=\"card bg-success text-white\">\n                <div class=\"card-body text-center\">\n                  <h4>${guild.channel_count || 0}</h4>\n                  <small>Channels</small>\n                </div>\n              </div>\n            </div>\n            <div class=\"col-md-4\">\n              <div class=\"card bg-info text-white\">\n                <div class=\"card-body text-center\">\n                  <h4>${guild.role_count || 0}</h4>\n                  <small>Roles</small>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      `,\n      confirmButtonText: 'Close',\n      width: '700px'\n    });\n  }\n\n  function addGuild() {\n    Swal.fire({\n      title: 'Add Bot to Server',\n      html: `\n        <div class=\"add-guild-container\">\n          <p>To add the ECS FC Discord bot to another server, you need administrator permissions on that server.</p>\n          <div class=\"alert alert-info\">\n            <i class=\"ti ti-info-circle me-2\"></i>\n            Click the button below to authorize the bot for a new server.\n          </div>\n          <div class=\"mt-4\">\n            <h6>Required Permissions:</h6>\n            <ul class=\"small\" style=\"text-align: left;\">\n              <li>Manage Roles</li>\n              <li>Send Messages</li>\n              <li>Read Message History</li>\n              <li>Manage Channels</li>\n              <li>Use Application Commands</li>\n            </ul>\n          </div>\n        </div>\n      `,\n      showConfirmButton: false,\n      showCloseButton: true\n    });\n  }\n\n  // ============================================================================\n  // CONFIGURATION MANAGEMENT\n  // ============================================================================\n\n  async function saveBotConfig() {\n    const config = {\n      prefix: document.getElementById('botPrefix')?.value || '!',\n      default_role: document.getElementById('defaultRole')?.value || '',\n      activity_type: document.getElementById('activityType')?.value || 'playing',\n      activity_text: document.getElementById('activityText')?.value || 'ECS FC League',\n      auto_moderation: document.getElementById('autoModeration')?.checked || false,\n      command_logging: document.getElementById('commandLogging')?.checked || false,\n      welcome_messages: document.getElementById('welcomeMessages')?.checked || false\n    };\n\n    Swal.fire({\n      title: 'Saving Configuration...',\n      text: 'Please wait while the configuration is being saved',\n      allowOutsideClick: false,\n      didOpen: () => {\n        Swal.showLoading();\n      }\n    });\n\n    try {\n      const response = await fetch(`${CONFIG.botApiUrl}/config`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(config)\n      });\n\n      const data = await response.json();\n\n      if (data.success) {\n        Swal.fire('Saved!', 'Bot configuration has been updated successfully.', 'success');\n      } else {\n        Swal.fire('Error!', `Failed to save configuration: ${data.error || 'Unknown error'}`, 'error');\n      }\n    } catch (error) {\n      console.error('Error saving bot config:', error);\n      Swal.fire('Error!', 'Failed to connect to bot API. Please check if the bot is running.', 'error');\n    }\n  }\n\n  function resetBotConfig() {\n    const prefixEl = document.getElementById('botPrefix');\n    const roleEl = document.getElementById('defaultRole');\n    const activityTypeEl = document.getElementById('activityType');\n    const activityTextEl = document.getElementById('activityText');\n    const autoModEl = document.getElementById('autoModeration');\n    const cmdLogEl = document.getElementById('commandLogging');\n    const welcomeEl = document.getElementById('welcomeMessages');\n\n    if (prefixEl) prefixEl.value = '!';\n    if (roleEl) roleEl.value = '';\n    if (activityTypeEl) activityTypeEl.value = 'playing';\n    if (activityTextEl) activityTextEl.value = 'ECS FC League';\n    if (autoModEl) autoModEl.checked = true;\n    if (cmdLogEl) cmdLogEl.checked = true;\n    if (welcomeEl) welcomeEl.checked = true;\n\n    Swal.fire('Reset!', 'Configuration has been reset to defaults.', 'info');\n  }\n\n  async function loadBotConfig() {\n    try {\n      const response = await fetch(`${CONFIG.botApiUrl}/config`);\n      const data = await response.json();\n\n      if (data.success && data.config) {\n        const config = data.config;\n        const prefixEl = document.getElementById('botPrefix');\n        const roleEl = document.getElementById('defaultRole');\n        const activityTypeEl = document.getElementById('activityType');\n        const activityTextEl = document.getElementById('activityText');\n        const autoModEl = document.getElementById('autoModeration');\n        const cmdLogEl = document.getElementById('commandLogging');\n        const welcomeEl = document.getElementById('welcomeMessages');\n\n        if (prefixEl) prefixEl.value = config.prefix || '!';\n        if (roleEl) roleEl.value = config.default_role || '';\n        if (activityTypeEl) activityTypeEl.value = config.activity_type || 'playing';\n        if (activityTextEl) activityTextEl.value = config.activity_text || 'ECS FC League';\n        if (autoModEl) autoModEl.checked = config.auto_moderation !== false;\n        if (cmdLogEl) cmdLogEl.checked = config.command_logging !== false;\n        if (welcomeEl) welcomeEl.checked = config.welcome_messages !== false;\n      }\n    } catch (error) {\n      console.log('Could not load bot configuration:', error);\n      // Use default values if API is not accessible\n    }\n  }\n\n  // ============================================================================\n  // INITIALIZATION\n  // ============================================================================\n\n  function init() {\n    // Page guard: only run on Discord Bot admin pages\n    const isBotPage = document.querySelector('[data-page=\"admin-discord-bot\"]') ||\n                      document.querySelector('.admin-discord-bot') ||\n                      window.location.pathname.includes('discord-bot');\n\n    if (!isBotPage) {\n      return;\n    }\n\n    // Initialize data\n    initializeData();\n\n    // Register all event handlers with EventDelegation\n    if (typeof EventDelegation !== 'undefined') {\n      // Bot Control\n      EventDelegation.register('restart-bot', restartBot, { preventDefault: true });\n      EventDelegation.register('check-bot-health', checkBotHealth, { preventDefault: true });\n      EventDelegation.register('view-bot-logs', viewBotLogs, { preventDefault: true });\n      EventDelegation.register('sync-commands', syncCommands, { preventDefault: true });\n\n      // Command Management\n      EventDelegation.register('view-commands', viewCommands, { preventDefault: true });\n      EventDelegation.register('command-permissions', commandPermissions, { preventDefault: true });\n      EventDelegation.register('command-usage', commandUsage, { preventDefault: true });\n      EventDelegation.register('custom-commands', customCommands, { preventDefault: true });\n\n      // Guild Management\n      EventDelegation.register('manage-guild', manageGuild, { preventDefault: true });\n      EventDelegation.register('guild-stats', guildStats, { preventDefault: true });\n      EventDelegation.register('add-guild', addGuild, { preventDefault: true });\n\n      // Configuration\n      EventDelegation.register('save-bot-config', saveBotConfig, { preventDefault: true });\n      EventDelegation.register('reset-bot-config', resetBotConfig, { preventDefault: true });\n    }\n\n    // Load bot configuration\n    loadBotConfig();\n\n    console.log('Discord Bot Management initialized');\n  }\n\n  // Run initialization when DOM is ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n\n})();\n","/**\n * ============================================================================\n * PERFORMANCE MONITORING PAGE - JAVASCRIPT\n * ============================================================================\n *\n * Handles performance monitoring charts and real-time updates\n * Uses Chart.js for visualizations and event delegation for interactions\n *\n * ARCHITECTURAL COMPLIANCE:\n * - Event delegation pattern\n * - Data-attribute based hooks\n * - No inline event handlers\n * - State-driven styling with classList\n *\n * ============================================================================\n */\n\n(function() {\n  'use strict';\n\n  let autoRefresh = true;\n  let refreshInterval;\n  let queryPerformanceChart;\n  let cacheUsageChart;\n\n  /**\n   * Initialize on DOM load\n   */\n  function init() {\n    // Page guard: only run on performance monitoring pages\n    const isPerfPage = document.querySelector('[data-page=\"admin-performance\"]') ||\n                       document.querySelector('.admin-performance') ||\n                       window.location.pathname.includes('performance');\n\n    if (!isPerfPage) {\n      return;\n    }\n\n    initializeCharts();\n    registerEventHandlers();\n    startAutoRefresh();\n  }\n\n  /**\n   * Initialize Chart.js visualizations\n   */\n  function initializeCharts() {\n    // Get data from hidden data element\n    const perfData = document.querySelector('[data-perf-data]');\n    if (!perfData) return;\n\n    const avgQueryTime = parseFloat(perfData.dataset.dbAvgQueryTime || 0);\n    const cacheActive = parseInt(perfData.dataset.cacheActive || 0);\n    const cacheExpired = parseInt(perfData.dataset.cacheExpired || 0);\n\n    // Query Performance Chart\n    const queryCtx = document.querySelector('[data-chart=\"query-performance\"]');\n    if (queryCtx) {\n      queryPerformanceChart = new Chart(queryCtx.getContext('2d'), {\n        type: 'line',\n        data: {\n          labels: ['5min ago', '4min ago', '3min ago', '2min ago', '1min ago', 'Now'],\n          datasets: [{\n            label: 'Avg Query Time (ms)',\n            data: [\n              avgQueryTime * 1000,\n              avgQueryTime * 1000 * 0.9,\n              avgQueryTime * 1000 * 1.1,\n              avgQueryTime * 1000 * 0.8,\n              avgQueryTime * 1000 * 1.2,\n              avgQueryTime * 1000\n            ],\n            borderColor: getCSSVariable('--color-primary') || '#0d6efd',\n            backgroundColor: 'rgba(13, 110, 253, 0.1)',\n            tension: 0.4,\n            fill: true\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          scales: {\n            y: {\n              beginAtZero: true,\n              title: {\n                display: true,\n                text: 'Time (ms)'\n              }\n            }\n          },\n          plugins: {\n            legend: {\n              display: false\n            }\n          }\n        }\n      });\n    }\n\n    // Cache Usage Chart\n    const cacheCtx = document.querySelector('[data-chart=\"cache-usage\"]');\n    if (cacheCtx) {\n      cacheUsageChart = new Chart(cacheCtx.getContext('2d'), {\n        type: 'doughnut',\n        data: {\n          labels: ['Active', 'Expired'],\n          datasets: [{\n            data: [cacheActive, cacheExpired],\n            backgroundColor: [\n              getCSSVariable('--color-success') || '#198754',\n              getCSSVariable('--color-danger') || '#dc3545'\n            ],\n            borderWidth: 0\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          plugins: {\n            legend: {\n              position: 'bottom'\n            }\n          }\n        }\n      });\n    }\n  }\n\n  /**\n   * Register event handlers using EventDelegation\n   */\n  function registerEventHandlers() {\n    if (typeof EventDelegation !== 'undefined') {\n      EventDelegation.register('toggle-auto-refresh', handleToggleAutoRefresh, { preventDefault: true });\n      EventDelegation.register('clear-cache', handleClearCache, { preventDefault: true });\n    }\n  }\n\n  /**\n   * Handle auto-refresh toggle\n   */\n  function handleToggleAutoRefresh() {\n    autoRefresh = !autoRefresh;\n    const statusSpan = document.querySelector('[data-status=\"auto-refresh\"]');\n\n    if (autoRefresh) {\n      if (statusSpan) statusSpan.textContent = 'ON';\n      startAutoRefresh();\n    } else {\n      if (statusSpan) statusSpan.textContent = 'OFF';\n      clearInterval(refreshInterval);\n    }\n  }\n\n  /**\n   * Handle cache clear with confirmation\n   */\n  function handleClearCache(e) {\n    const confirmed = confirm('Are you sure you want to clear all cache?');\n    if (!confirmed) {\n      e.preventDefault();\n      return false;\n    }\n  }\n\n  /**\n   * Start auto-refresh interval\n   */\n  function startAutoRefresh() {\n    // Clear any existing interval\n    if (refreshInterval) {\n      clearInterval(refreshInterval);\n    }\n\n    // Update every 30 seconds\n    refreshInterval = setInterval(updateMetrics, 30000);\n  }\n\n  /**\n   * Update real-time metrics from server\n   */\n  function updateMetrics() {\n    if (!autoRefresh) return;\n\n    fetch('/admin_panel/performance/api/metrics')\n      .then(response => response.json())\n      .then(data => {\n        if (data.success) {\n          const report = data.data;\n\n          // Update live metrics\n          updateLiveValue('query-time', (report.database.avg_query_time * 1000).toFixed(1) + 'ms');\n          updateLiveValue('slow-queries', report.database.slow_queries);\n          updateLiveValue('cache-hits', report.cache.active_entries);\n          updateLiveValue('cache-size', report.cache.cache_size_mb.toFixed(1) + 'MB');\n\n          // Update timestamp\n          const timestampEl = document.querySelector('[data-timestamp]');\n          if (timestampEl) {\n            timestampEl.textContent = new Date(report.timestamp).toLocaleString();\n          }\n\n          // Update colors based on thresholds\n          updateMetricColors(report);\n\n          // Update charts if they exist\n          if (queryPerformanceChart) {\n            updateQueryChart(report.database.avg_query_time * 1000);\n          }\n\n          if (cacheUsageChart) {\n            updateCacheChart(report.cache.active_entries, report.cache.expired_entries);\n          }\n        }\n      })\n      .catch(error => {\n        console.error('Error updating metrics:', error);\n      });\n  }\n\n  /**\n   * Update a live value element\n   */\n  function updateLiveValue(metric, value) {\n    const element = document.querySelector(`[data-live-value=\"${metric}\"]`);\n    if (element) {\n      element.textContent = value;\n    }\n  }\n\n  /**\n   * Update metric colors based on thresholds\n   */\n  function updateMetricColors(report) {\n    const slowQueriesEl = document.querySelector('[data-live-value=\"slow-queries\"]');\n    if (slowQueriesEl) {\n      slowQueriesEl.className = 'c-perf-realtime__value';\n      if (report.database.slow_queries > 5) {\n        slowQueriesEl.classList.add('c-perf-realtime__value--danger');\n      } else if (report.database.slow_queries > 2) {\n        slowQueriesEl.classList.add('c-perf-realtime__value--warning');\n      } else {\n        slowQueriesEl.classList.add('c-perf-realtime__value--success');\n      }\n    }\n\n    const cacheSizeEl = document.querySelector('[data-live-value=\"cache-size\"]');\n    if (cacheSizeEl) {\n      cacheSizeEl.className = 'c-perf-realtime__value';\n      if (report.cache.cache_size_mb > 50) {\n        cacheSizeEl.classList.add('c-perf-realtime__value--warning');\n      } else {\n        cacheSizeEl.classList.add('c-perf-realtime__value--secondary');\n      }\n    }\n  }\n\n  /**\n   * Update query performance chart\n   */\n  function updateQueryChart(newValue) {\n    if (!queryPerformanceChart) return;\n\n    const data = queryPerformanceChart.data.datasets[0].data;\n    data.shift(); // Remove first element\n    data.push(newValue); // Add new value\n\n    queryPerformanceChart.update();\n  }\n\n  /**\n   * Update cache usage chart\n   */\n  function updateCacheChart(active, expired) {\n    if (!cacheUsageChart) return;\n\n    cacheUsageChart.data.datasets[0].data = [active, expired];\n    cacheUsageChart.update();\n  }\n\n  /**\n   * Get CSS variable value\n   */\n  function getCSSVariable(varName) {\n    const value = getComputedStyle(document.documentElement).getPropertyValue(varName);\n    return value ? value.trim() : null;\n  }\n\n  // Run initialization when DOM is ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n  } else {\n    init();\n  }\n\n})();\n","/**\n * ============================================================================\n * ADMIN DASHBOARD MODULE\n * ============================================================================\n *\n * Main controller for the admin dashboard page.\n * Handles:\n *   - Docker container status management\n *   - Task management (Celery tasks)\n *   - Role permissions management\n *   - Event delegation for dynamic elements\n *\n * Uses InitSystem for registration and data-* selectors for JS hooks.\n *\n * ============================================================================\n */\n\n(function() {\n    'use strict';\n\n    /* ========================================================================\n       CONFIGURATION\n       ======================================================================== */\n\n    const CONFIG = {\n        selectors: {\n            // Containers\n            dockerStatusContainer: '#dockerStatusContainer',\n            taskManagementContainer: '#taskManagementContainer',\n            toastContainer: '#toastContainer',\n\n            // Permissions\n            roleSelect: '#role_id',\n            permissionsSelect: '#permissions',\n            currentPermissionsList: '#current-permissions-list',\n\n            // Modal\n            dockerLogsContent: '#dockerLogsContent',\n            dockerLogsModalLabel: '#dockerLogsModalLabel',\n\n            // Actions (data-action attribute values)\n            actions: {\n                refreshContainers: 'refresh-containers',\n                openTaskManagement: 'open-task-management',\n                refreshTaskList: 'refresh-task-list',\n                cleanupOldTasks: 'cleanup-old-tasks',\n                loadTaskManagement: 'load-task-management',\n                showLogs: 'show-logs',\n                containerAction: 'container-action',\n                revokeTask: 'revoke-task',\n                viewTaskDetails: 'view-task-details',\n                removeTask: 'remove-task',\n                closeModal: 'close-modal'\n            }\n        },\n        endpoints: {\n            dockerStatus: '/admin/docker-status',\n            dockerLogs: '/admin/docker-logs/',\n            dockerAction: '/admin/docker-',\n            taskManagement: '/admin/task-management',\n            taskDetails: '/admin/task-details/',\n            revokeTask: '/admin/revoke-task/',\n            removeTask: '/admin/remove-task/',\n            cleanupTasks: '/admin/cleanup-tasks',\n            rolePermissions: '/admin/role-permissions/'\n        }\n    };\n\n    /* ========================================================================\n       ADMIN DASHBOARD CONTROLLER\n       ======================================================================== */\n\n    const AdminDashboard = {\n        /**\n         * Initialize the admin dashboard\n         */\n        init: function(context = document) {\n            console.log('[AdminDashboard] Initializing...');\n\n            this.initEventDelegation(context);\n            this.initPermissionsTab(context);\n            this.initDockerStatus(context);\n\n            console.log('[AdminDashboard] Initialized');\n        },\n\n        /**\n         * Event delegation for dynamic elements using data-action attributes\n         */\n        initEventDelegation: function(context) {\n            context.addEventListener('click', (e) => {\n                const actionElement = e.target.closest('[data-action]');\n                if (!actionElement) return;\n\n                const action = actionElement.dataset.action;\n\n                switch(action) {\n                    case CONFIG.selectors.actions.refreshContainers:\n                        e.preventDefault();\n                        this.handleRefreshContainers(actionElement);\n                        break;\n\n                    case CONFIG.selectors.actions.openTaskManagement:\n                        e.preventDefault();\n                        this.openTaskManagement();\n                        break;\n\n                    case CONFIG.selectors.actions.refreshTaskList:\n                        this.refreshTaskList();\n                        break;\n\n                    case CONFIG.selectors.actions.cleanupOldTasks:\n                        this.cleanupOldTasks();\n                        break;\n\n                    case CONFIG.selectors.actions.loadTaskManagement:\n                        this.loadTaskManagement();\n                        break;\n\n                    case CONFIG.selectors.actions.showLogs:\n                        this.showLogs(actionElement.dataset.containerName);\n                        break;\n\n                    case CONFIG.selectors.actions.containerAction:\n                        this.containerAction(\n                            actionElement.dataset.containerName,\n                            actionElement.dataset.containerActionType,\n                            actionElement\n                        );\n                        break;\n\n                    case CONFIG.selectors.actions.revokeTask:\n                        this.revokeTask(actionElement.dataset.taskId);\n                        break;\n\n                    case CONFIG.selectors.actions.viewTaskDetails:\n                        this.viewTaskDetails(actionElement.dataset.taskId);\n                        break;\n\n                    case CONFIG.selectors.actions.removeTask:\n                        this.removeTask(actionElement.dataset.taskId);\n                        break;\n\n                    case CONFIG.selectors.actions.closeModal:\n                        if (window.ModernComponents?.Modal && actionElement.dataset.modalId) {\n                            window.ModernComponents.Modal.close(actionElement.dataset.modalId);\n                        }\n                        break;\n                }\n            });\n        },\n\n        /**\n         * Handle refresh containers button click\n         */\n        handleRefreshContainers: function(target) {\n            target.classList.add('is-loading');\n            target.disabled = true;\n\n            this.fetchDockerStatus().finally(() => {\n                target.classList.remove('is-loading');\n                target.disabled = false;\n            });\n        },\n\n        /* ====================================================================\n           PERMISSIONS TAB\n           ==================================================================== */\n\n        initPermissionsTab: function(context) {\n            const roleSelect = context.querySelector(CONFIG.selectors.roleSelect);\n            const permissionsSelect = context.querySelector(CONFIG.selectors.permissionsSelect);\n            const currentPermissionsList = context.querySelector(CONFIG.selectors.currentPermissionsList);\n\n            // Initialize Select2 for permissions dropdown\n            if (permissionsSelect && typeof $ !== 'undefined' && $.fn.select2) {\n                $(permissionsSelect).select2({\n                    theme: 'bootstrap-5',\n                    placeholder: 'Select permissions...',\n                    allowClear: true,\n                    width: '100%'\n                });\n            }\n\n            if (roleSelect) {\n                roleSelect.addEventListener('change', () => {\n                    const roleId = roleSelect.value;\n                    if (roleId) {\n                        this.fetchRolePermissions(roleId, permissionsSelect, currentPermissionsList);\n                    } else {\n                        if (currentPermissionsList) {\n                            currentPermissionsList.innerHTML = '<li class=\"c-permissions-list__item c-permissions-list__item--empty\">Select a role to view permissions.</li>';\n                        }\n                        if (permissionsSelect) {\n                            if ($(permissionsSelect).hasClass('select2-hidden-accessible')) {\n                                $(permissionsSelect).val([]).trigger('change');\n                            } else {\n                                Array.from(permissionsSelect.options).forEach(option => option.selected = false);\n                            }\n                        }\n                    }\n                });\n            }\n        },\n\n        fetchRolePermissions: function(roleId, permissionsSelect, currentPermissionsList) {\n            fetch(`${CONFIG.endpoints.rolePermissions}${roleId}`)\n                .then(response => response.json())\n                .then(data => {\n                    if (data.success) {\n                        this.updateCurrentPermissionsList(data.permissions, currentPermissionsList);\n\n                        if (permissionsSelect) {\n                            const currentPermissionIds = data.permissions.map(p => p.id.toString());\n\n                            if ($(permissionsSelect).hasClass('select2-hidden-accessible')) {\n                                $(permissionsSelect).val(currentPermissionIds).trigger('change');\n                            } else {\n                                Array.from(permissionsSelect.options).forEach(option => {\n                                    option.selected = currentPermissionIds.includes(option.value);\n                                });\n                            }\n                        }\n                    } else {\n                        currentPermissionsList.innerHTML = '<li class=\"c-permissions-list__item c-permissions-list__item--error\">Error loading permissions</li>';\n                    }\n                })\n                .catch(error => {\n                    console.error('Error fetching role permissions:', error);\n                    currentPermissionsList.innerHTML = '<li class=\"c-permissions-list__item c-permissions-list__item--error\">Error loading permissions</li>';\n                });\n        },\n\n        updateCurrentPermissionsList: function(permissions, listElement) {\n            if (!listElement) return;\n\n            if (permissions.length === 0) {\n                listElement.innerHTML = '<li class=\"c-permissions-list__item c-permissions-list__item--empty\">No permissions assigned.</li>';\n            } else {\n                const permissionsHTML = permissions.map(permission =>\n                    `<li class=\"c-permissions-list__item\">${permission.name}</li>`\n                ).join('');\n                listElement.innerHTML = permissionsHTML;\n            }\n        },\n\n        /* ====================================================================\n           DOCKER STATUS\n           ==================================================================== */\n\n        initDockerStatus: function(context) {\n            const container = context.querySelector(CONFIG.selectors.dockerStatusContainer);\n            if (!container) return;\n\n            this.fetchDockerStatus();\n        },\n\n        fetchDockerStatus: async function() {\n            const container = document.querySelector(CONFIG.selectors.dockerStatusContainer);\n            if (!container) return;\n\n            try {\n                const response = await fetch(CONFIG.endpoints.dockerStatus);\n                const data = await response.json();\n\n                if (data.success && data.containers) {\n                    this.renderContainers(data.containers);\n                } else {\n                    container.innerHTML = `\n                        <div class=\"col-12\">\n                            <div class=\"c-empty-state c-empty-state--warning\">\n                                <i class=\"ti ti-alert-triangle c-empty-state__icon\"></i>\n                                <p class=\"c-empty-state__text\">${data.error || 'Unable to load container status'}</p>\n                            </div>\n                        </div>\n                    `;\n                }\n            } catch (error) {\n                console.error('Error fetching Docker status:', error);\n                container.innerHTML = `\n                    <div class=\"col-12\">\n                        <div class=\"c-empty-state c-empty-state--error\">\n                            <i class=\"ti ti-alert-circle c-empty-state__icon\"></i>\n                            <p class=\"c-empty-state__text\">Failed to load container status</p>\n                        </div>\n                    </div>\n                `;\n            }\n        },\n\n        renderContainers: function(containers) {\n            const container = document.querySelector(CONFIG.selectors.dockerStatusContainer);\n            if (!container) return;\n\n            if (containers.length === 0) {\n                container.innerHTML = `\n                    <div class=\"col-12\">\n                        <div class=\"c-empty-state\">\n                            <i class=\"ti ti-info-circle c-empty-state__icon\"></i>\n                            <p class=\"c-empty-state__text\">No containers found</p>\n                        </div>\n                    </div>\n                `;\n                return;\n            }\n\n            const containersHTML = containers.map(cont => {\n                const statusClass = cont.status === 'running' ? 'success' : 'danger';\n                const statusIcon = cont.status === 'running' ? 'ti-check' : 'ti-x';\n\n                return `\n                    <div class=\"col-xl-4 col-lg-6 mb-3\">\n                        <div class=\"c-container-card\" data-component=\"container-card\" data-container-name=\"${cont.name}\">\n                            <div class=\"c-container-card__header\">\n                                <div class=\"c-container-card__info\">\n                                    <h6 class=\"c-container-card__name\">${cont.name}</h6>\n                                    <small class=\"c-container-card__image\">${cont.image}</small>\n                                </div>\n                                <span class=\"c-badge c-badge--${statusClass}\">\n                                    <i class=\"ti ${statusIcon}\"></i>\n                                    <span>${cont.status}</span>\n                                </span>\n                            </div>\n\n                            <div class=\"c-container-card__body\">\n                                <div class=\"c-container-card__stat\">\n                                    <small class=\"c-container-card__stat-label\">Uptime:</small>\n                                    <small class=\"c-container-card__stat-value\">${cont.uptime || 'N/A'}</small>\n                                </div>\n                                <div class=\"c-container-card__stat\">\n                                    <small class=\"c-container-card__stat-label\">CPU:</small>\n                                    <small class=\"c-container-card__stat-value\">${cont.cpu_usage || 'N/A'}</small>\n                                </div>\n                                <div class=\"c-container-card__stat\">\n                                    <small class=\"c-container-card__stat-label\">Memory:</small>\n                                    <small class=\"c-container-card__stat-value\">${cont.memory_usage || 'N/A'}</small>\n                                </div>\n                            </div>\n\n                            <div class=\"c-container-card__actions\">\n                                ${cont.status === 'running' ?\n                                    `<button class=\"btn btn-outline-warning btn-sm\" data-action=\"container-action\" data-container-name=\"${cont.name}\" data-container-action-type=\"restart\">\n                                        <i class=\"ti ti-refresh\"></i> <span>Restart</span>\n                                    </button>\n                                    <button class=\"btn btn-outline-danger btn-sm\" data-action=\"container-action\" data-container-name=\"${cont.name}\" data-container-action-type=\"stop\">\n                                        <i class=\"ti ti-stop\"></i> <span>Stop</span>\n                                    </button>` :\n                                    `<button class=\"btn btn-outline-success btn-sm\" data-action=\"container-action\" data-container-name=\"${cont.name}\" data-container-action-type=\"start\">\n                                        <i class=\"ti ti-play\"></i> <span>Start</span>\n                                    </button>`\n                                }\n                                <button class=\"btn btn-outline-primary btn-sm\" data-action=\"show-logs\" data-container-name=\"${cont.name}\" title=\"View Logs\">\n                                    <i class=\"ti ti-file-text\"></i>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n            }).join('');\n\n            container.innerHTML = containersHTML;\n        },\n\n        showLogs: async function(containerName) {\n            const content = document.querySelector(CONFIG.selectors.dockerLogsContent);\n            const title = document.querySelector(CONFIG.selectors.dockerLogsModalLabel);\n\n            if (title) title.textContent = `${containerName} - Logs`;\n            if (content) content.textContent = 'Loading logs...';\n\n            if (window.ModernComponents?.Modal) {\n                window.ModernComponents.Modal.open('dockerLogsModal');\n            }\n\n            try {\n                const response = await fetch(`${CONFIG.endpoints.dockerLogs}${containerName}`);\n                const data = await response.json();\n\n                if (data.success) {\n                    if (content) content.textContent = data.logs || 'No logs available';\n                } else {\n                    if (content) content.textContent = `Error: ${data.error || 'Failed to load logs'}`;\n                }\n            } catch (error) {\n                console.error('Error fetching logs:', error);\n                if (content) content.textContent = 'Error loading logs';\n            }\n        },\n\n        containerAction: async function(containerName, action, btn) {\n            if (!btn) return;\n\n            btn.classList.add('is-loading');\n            btn.disabled = true;\n\n            try {\n                const response = await fetch(`${CONFIG.endpoints.dockerAction}${action}/${containerName}`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' }\n                });\n\n                if (response.ok) {\n                    this.showComponentToast('success', 'Success', `Container ${action}ed successfully`);\n                    setTimeout(() => this.fetchDockerStatus(), 1000);\n                } else {\n                    const errorData = await response.json();\n                    this.showComponentToast('error', 'Error', errorData.error || `Failed to ${action} container`);\n                    btn.classList.remove('is-loading');\n                    btn.disabled = false;\n                }\n            } catch (error) {\n                console.error(`Error during ${action}:`, error);\n                this.showComponentToast('error', 'Error', `Failed to ${action} container`);\n                btn.classList.remove('is-loading');\n                btn.disabled = false;\n            }\n        },\n\n        /* ====================================================================\n           TASK MANAGEMENT\n           ==================================================================== */\n\n        openTaskManagement: function() {\n            this.loadTaskManagement();\n            const container = document.querySelector(CONFIG.selectors.taskManagementContainer);\n            if (container) {\n                container.scrollIntoView({ behavior: 'smooth' });\n            }\n        },\n\n        loadTaskManagement: function() {\n            const container = document.querySelector(CONFIG.selectors.taskManagementContainer);\n            if (!container) return;\n\n            container.innerHTML = `\n                <div class=\"text-center py-4\">\n                    <div class=\"c-loading-spinner\" role=\"status\"></div>\n                    <p class=\"c-loading-text\">Loading task management...</p>\n                </div>\n            `;\n\n            this.fetchTaskList();\n        },\n\n        fetchTaskList: async function() {\n            const container = document.querySelector(CONFIG.selectors.taskManagementContainer);\n            if (!container) return;\n\n            try {\n                const response = await fetch(CONFIG.endpoints.taskManagement);\n                const data = await response.json();\n\n                if (data.success) {\n                    this.renderTaskManagement(data);\n                } else {\n                    container.innerHTML = `\n                        <div class=\"alert alert-warning\" role=\"alert\">\n                            <i class=\"ti ti-alert-triangle me-2\"></i>\n                            ${data.error || 'Unable to load task management'}\n                        </div>\n                    `;\n                }\n            } catch (error) {\n                console.error('Error fetching task management:', error);\n                container.innerHTML = `\n                    <div class=\"alert alert-danger\" role=\"alert\">\n                        <i class=\"ti ti-alert-circle me-2\"></i>\n                        Failed to load task management\n                    </div>\n                `;\n            }\n        },\n\n        renderTaskManagement: function(data) {\n            const container = document.querySelector(CONFIG.selectors.taskManagementContainer);\n            if (!container) return;\n\n            const stats = data.statistics || {};\n            const activeTasks = data.active_tasks || [];\n\n            const html = `\n                <div class=\"row mb-4\">\n                    <div class=\"col-md-3\">\n                        <div class=\"c-stat-card c-stat-card--primary\">\n                            <div class=\"c-stat-card__value\">${stats.total_active || 0}</div>\n                            <div class=\"c-stat-card__label\">Active Tasks</div>\n                            <div class=\"c-stat-card__icon\"><i class=\"ti ti-activity\"></i></div>\n                        </div>\n                    </div>\n                    <div class=\"col-md-3\">\n                        <div class=\"c-stat-card c-stat-card--success\">\n                            <div class=\"c-stat-card__value\">${stats.by_status?.SUCCESS || 0}</div>\n                            <div class=\"c-stat-card__label\">Completed</div>\n                            <div class=\"c-stat-card__icon\"><i class=\"ti ti-check\"></i></div>\n                        </div>\n                    </div>\n                    <div class=\"col-md-3\">\n                        <div class=\"c-stat-card c-stat-card--danger\">\n                            <div class=\"c-stat-card__value\">${stats.by_status?.FAILURE || 0}</div>\n                            <div class=\"c-stat-card__label\">Failed</div>\n                            <div class=\"c-stat-card__icon\"><i class=\"ti ti-x\"></i></div>\n                        </div>\n                    </div>\n                    <div class=\"col-md-3\">\n                        <div class=\"c-stat-card c-stat-card--warning\">\n                            <div class=\"c-stat-card__value\">${stats.by_status?.PENDING || 0}</div>\n                            <div class=\"c-stat-card__label\">Pending</div>\n                            <div class=\"c-stat-card__icon\"><i class=\"ti ti-clock\"></i></div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"c-table-wrapper\">\n                    <table class=\"c-table c-table--hover c-table--striped\">\n                        <thead class=\"c-table__head\">\n                            <tr>\n                                <th class=\"c-table__header\">Task ID</th>\n                                <th class=\"c-table__header\">Type</th>\n                                <th class=\"c-table__header\">User</th>\n                                <th class=\"c-table__header\">Status</th>\n                                <th class=\"c-table__header\">Progress</th>\n                                <th class=\"c-table__header\">Created</th>\n                                <th class=\"c-table__header\">Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody class=\"c-table__body\">\n                            ${activeTasks.length > 0 ?\n                                activeTasks.map(task => this.renderTaskRow(task)).join('') :\n                                '<tr><td colspan=\"7\" class=\"text-center c-text-muted py-4\">No active tasks</td></tr>'\n                            }\n                        </tbody>\n                    </table>\n                </div>\n            `;\n\n            container.innerHTML = html;\n        },\n\n        renderTaskRow: function(task) {\n            const statusColor = this.getStatusColor(task.celery_state || task.status);\n\n            return `\n                <tr class=\"c-table__row ${task.celery_state === 'REVOKED' ? 'is-muted' : ''}\">\n                    <td class=\"c-table__cell\" data-label=\"Task ID\">\n                        <code class=\"c-code\">${task.task_id.substring(0, 8)}...</code>\n                        ${task.celery_state === 'REVOKED' ? '<small class=\"c-text-muted\">CANCELLED</small>' : ''}\n                    </td>\n                    <td class=\"c-table__cell\" data-label=\"Type\">\n                        <span class=\"c-badge c-badge--secondary\">${task.task_type || 'unknown'}</span>\n                    </td>\n                    <td class=\"c-table__cell\" data-label=\"User\">${task.user_id || 'N/A'}</td>\n                    <td class=\"c-table__cell\" data-label=\"Status\">\n                        <span class=\"c-badge c-badge--${statusColor}\">\n                            ${task.celery_state || task.status || 'UNKNOWN'}\n                        </span>\n                    </td>\n                    <td class=\"c-table__cell\" data-label=\"Progress\">\n                        <div class=\"c-progress\">\n                            <div class=\"c-progress__bar c-progress__bar--${statusColor}\"\n                                 role=\"progressbar\"\n                                 aria-valuenow=\"${task.progress || 0}\"\n                                 aria-valuemin=\"0\" aria-valuemax=\"100\"\n                                 style=\"width: ${task.progress || 0}%\">\n                                ${task.progress || 0}%\n                            </div>\n                        </div>\n                        ${task.stage ? `<small class=\"c-text-muted\">${task.stage}</small>` : ''}\n                    </td>\n                    <td class=\"c-table__cell\" data-label=\"Created\">\n                        <small>${task.created_at ? new Date(task.created_at).toLocaleString() : 'N/A'}</small>\n                    </td>\n                    <td class=\"c-table__cell\" data-label=\"Actions\">\n                        <div class=\"c-button-group c-button-group--sm\">\n                            ${['PENDING', 'PROGRESS', 'STARTED'].includes(task.celery_state) ?\n                                `<button class=\"btn btn-outline-danger btn-sm\" data-action=\"revoke-task\" data-task-id=\"${task.task_id}\" title=\"DESTROY Task (Nuclear Option)\">\n                                    <i class=\"ti ti-bomb\"></i>\n                                </button>` : ''\n                            }\n                            ${['REVOKED', 'FAILURE', 'SUCCESS'].includes(task.celery_state) ?\n                                `<button class=\"btn btn-outline-secondary btn-sm\" data-action=\"remove-task\" data-task-id=\"${task.task_id}\" title=\"Remove from List\">\n                                    <i class=\"ti ti-trash\"></i> <span>Clear</span>\n                                </button>` : ''\n                            }\n                            <button class=\"btn btn-outline-primary btn-sm\" data-action=\"view-task-details\" data-task-id=\"${task.task_id}\" title=\"View Details\">\n                                <i class=\"ti ti-eye\"></i>\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `;\n        },\n\n        getStatusColor: function(status) {\n            const colors = {\n                'SUCCESS': 'success',\n                'FAILURE': 'danger',\n                'PENDING': 'warning',\n                'STARTED': 'primary',\n                'PROGRESS': 'primary',\n                'REVOKED': 'dark'\n            };\n            return colors[status] || 'light';\n        },\n\n        revokeTask: async function(taskId) {\n            const result = await Swal.fire({\n                title: 'DESTROY Task?',\n                html: `\n                    <div class=\"text-start\">\n                        <p class=\"text-warning\"><strong> WARNING: Nuclear Option</strong></p>\n                        <p>This will completely <strong>DESTROY</strong> the task:</p>\n                        <ul class=\"text-start\">\n                            <li>Terminate the running process</li>\n                            <li>Remove all Redis data</li>\n                            <li>Purge from all tracking systems</li>\n                            <li>Cannot be undone</li>\n                        </ul>\n                        <p class=\"text-danger\"><strong>Are you absolutely sure?</strong></p>\n                    </div>\n                `,\n                icon: 'warning',\n                showCancelButton: true,\n                confirmButtonColor: this.getThemeColor('danger', '#dc3545'),\n                cancelButtonColor: this.getThemeColor('secondary', '#6c757d'),\n                confirmButtonText: ' DESTROY IT',\n                cancelButtonText: 'No, keep it',\n                width: '500px'\n            });\n\n            if (!result.isConfirmed) return;\n\n            try {\n                const response = await fetch(`${CONFIG.endpoints.revokeTask}${taskId}`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': this.getCsrfToken()\n                    }\n                });\n\n                const data = await response.json();\n\n                if (data.success) {\n                    Swal.fire({\n                        title: 'DESTROYED! ',\n                        text: 'The task has been completely obliterated.',\n                        icon: 'success',\n                        timer: 3000,\n                        showConfirmButton: false\n                    });\n                    setTimeout(() => this.refreshTaskList(), 1000);\n                } else {\n                    Swal.fire({ title: 'Error!', text: data.error || 'Failed to destroy task', icon: 'error' });\n                }\n            } catch (error) {\n                console.error('Error destroying task:', error);\n                Swal.fire({ title: 'Error!', text: 'Failed to destroy task', icon: 'error' });\n            }\n        },\n\n        viewTaskDetails: async function(taskId) {\n            try {\n                const response = await fetch(`${CONFIG.endpoints.taskDetails}${taskId}`);\n                const data = await response.json();\n\n                if (data.success) {\n                    const task = data.task;\n                    const detailsHtml = `\n                        <div class=\"text-start\">\n                            <p><strong>Task ID:</strong> <code>${task.task_id}</code></p>\n                            <p><strong>Type:</strong> <span class=\"c-badge c-badge--secondary\">${task.task_type || 'N/A'}</span></p>\n                            <p><strong>Status:</strong> <span class=\"c-badge c-badge--${this.getStatusColor(task.celery_state || task.status)}\">${task.celery_state || task.status || 'N/A'}</span></p>\n                            <p><strong>Progress:</strong> ${task.progress || 0}%</p>\n                            <p><strong>Stage:</strong> ${task.stage || 'N/A'}</p>\n                            <p><strong>Created:</strong> ${task.created_at ? new Date(task.created_at).toLocaleString() : 'N/A'}</p>\n                            ${task.message ? `<p><strong>Message:</strong> ${task.message}</p>` : ''}\n                        </div>\n                    `;\n\n                    Swal.fire({\n                        title: 'Task Details',\n                        html: detailsHtml,\n                        icon: 'info',\n                        width: '600px',\n                        confirmButtonText: 'Close'\n                    });\n                } else {\n                    Swal.fire({ title: 'Error!', text: data.error || 'Failed to load task details', icon: 'error' });\n                }\n            } catch (error) {\n                console.error('Error fetching task details:', error);\n                Swal.fire({ title: 'Error!', text: 'Failed to load task details', icon: 'error' });\n            }\n        },\n\n        removeTask: async function(taskId) {\n            const result = await Swal.fire({\n                title: 'Remove Task?',\n                text: 'This will remove the task from the list. Are you sure?',\n                icon: 'question',\n                showCancelButton: true,\n                confirmButtonColor: this.getThemeColor('secondary', '#6c757d'),\n                cancelButtonColor: this.getThemeColor('danger', '#dc3545'),\n                confirmButtonText: 'Yes, remove it',\n                cancelButtonText: 'Cancel'\n            });\n\n            if (!result.isConfirmed) return;\n\n            try {\n                const response = await fetch(`${CONFIG.endpoints.removeTask}${taskId}`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': this.getCsrfToken()\n                    }\n                });\n\n                const data = await response.json();\n\n                if (data.success) {\n                    Swal.fire({\n                        title: 'Removed!',\n                        text: 'The task has been removed from the list.',\n                        icon: 'success',\n                        timer: 2000,\n                        showConfirmButton: false\n                    });\n                    setTimeout(() => this.refreshTaskList(), 500);\n                } else {\n                    Swal.fire({ title: 'Error!', text: data.error || 'Failed to remove task', icon: 'error' });\n                }\n            } catch (error) {\n                console.error('Error removing task:', error);\n                Swal.fire({ title: 'Error!', text: 'Failed to remove task', icon: 'error' });\n            }\n        },\n\n        cleanupOldTasks: async function() {\n            const result = await Swal.fire({\n                title: 'Cleanup Old Tasks?',\n                html: `\n                    <div class=\"text-start\">\n                        <p>This will remove:</p>\n                        <ul class=\"text-start\">\n                            <li>TaskManager entries older than 24 hours</li>\n                            <li>Celery metadata older than 7 days</li>\n                            <li>Improves Redis performance</li>\n                        </ul>\n                        <p class=\"text-muted\"><small>Recent tasks will be preserved</small></p>\n                    </div>\n                `,\n                icon: 'question',\n                showCancelButton: true,\n                confirmButtonColor: this.getThemeColor('warning', '#ffc107'),\n                cancelButtonColor: this.getThemeColor('secondary', '#6c757d'),\n                confirmButtonText: ' Clean Up',\n                cancelButtonText: 'Cancel'\n            });\n\n            if (!result.isConfirmed) return;\n\n            try {\n                const response = await fetch(CONFIG.endpoints.cleanupTasks, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': this.getCsrfToken()\n                    }\n                });\n\n                const data = await response.json();\n\n                if (data.success) {\n                    Swal.fire({\n                        title: 'Cleanup Complete! ',\n                        html: `\n                            <div class=\"text-start\">\n                                <p><strong>Cleaned up:</strong></p>\n                                <ul>\n                                    <li>Registry: ${data.registry_cleaned} tasks</li>\n                                    <li>Metadata: ${data.metadata_cleaned} keys</li>\n                                    <li><strong>Total: ${data.total_cleaned} items</strong></li>\n                                </ul>\n                            </div>\n                        `,\n                        icon: 'success',\n                        timer: 4000,\n                        showConfirmButton: false\n                    });\n                    setTimeout(() => this.refreshTaskList(), 1000);\n                } else {\n                    Swal.fire({ title: 'Error!', text: data.error || 'Failed to cleanup tasks', icon: 'error' });\n                }\n            } catch (error) {\n                console.error('Error cleaning up tasks:', error);\n                Swal.fire({ title: 'Error!', text: 'Failed to cleanup tasks', icon: 'error' });\n            }\n        },\n\n        refreshTaskList: function() {\n            this.fetchTaskList();\n        },\n\n        /* ====================================================================\n           UTILITY FUNCTIONS\n           ==================================================================== */\n\n        getCsrfToken: function() {\n            return document.querySelector('input[name=\"csrf_token\"]')?.value ||\n                   document.querySelector('meta[name=\"csrf-token\"]')?.getAttribute('content') || '';\n        },\n\n        getThemeColor: function(colorName, fallback) {\n            return (typeof ECSTheme !== 'undefined' && ECSTheme.getColor) ?\n                   ECSTheme.getColor(colorName) : fallback;\n        },\n\n        showComponentToast: function(type, title, message) {\n            if (window.ModernComponents?.Toast) {\n                window.ModernComponents.Toast.show({ type, title, message, duration: 5000 });\n            }\n        },\n\n        showToast: function(title, message, type) {\n            const container = document.querySelector(CONFIG.selectors.toastContainer);\n            if (!container) return;\n\n            const toastId = 'toast-' + Date.now();\n            const toastHTML = `\n                <div id=\"${toastId}\" class=\"toast align-items-center border-0 bg-${type} text-white\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n                    <div class=\"d-flex\">\n                        <div class=\"toast-body\">\n                            <strong>${title}:</strong> ${message}\n                        </div>\n                        <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\n                    </div>\n                </div>\n            `;\n            container.insertAdjacentHTML('beforeend', toastHTML);\n\n            const toastElement = document.getElementById(toastId);\n            if (toastElement && typeof bootstrap !== 'undefined') {\n                const toast = new bootstrap.Toast(toastElement, { autohide: true, delay: 5000 });\n                toast.show();\n\n                toastElement.addEventListener('hidden.bs.toast', function() {\n                    toastElement.remove();\n                });\n            }\n        }\n    };\n\n    /* ========================================================================\n       REGISTER WITH INITSYSTEM OR FALLBACK TO DOMCONTENTLOADED\n       ======================================================================== */\n\n    if (typeof window.InitSystem !== 'undefined') {\n        window.InitSystem.register('AdminDashboard', {\n            priority: 50,\n            init: function(context) {\n                AdminDashboard.init(context);\n            }\n        });\n    } else {\n        document.addEventListener('DOMContentLoaded', function() {\n            AdminDashboard.init(document);\n        });\n    }\n\n    // Expose for external access if needed\n    window.AdminDashboard = AdminDashboard;\n\n})();\n","/**\n * ============================================================================\n * MESSAGE CATEGORIES - Category Management for Message Templates\n * ============================================================================\n *\n * Handles message template category management in the admin panel.\n * Replaces 43-line inline script from messages.html.\n *\n * Features:\n * - Edit message categories\n * - Delete message categories with confirmation\n * - Event delegation for dynamic actions\n *\n * NO INLINE STYLES - Uses CSS classes and data attributes instead.\n *\n * Dependencies:\n * - Bootstrap 5.x (modals)\n * - SweetAlert2 (confirmations)\n * - EventDelegation (centralized event handling)\n *\n * ============================================================================\n */\n\n(function() {\n    'use strict';\n\n    // ========================================================================\n    // EDIT CATEGORY\n    // ========================================================================\n\n    /**\n     * Edit a message category\n     * Opens modal with pre-filled category data\n     * @param {number} id - Category ID\n     * @param {string} name - Category name\n     * @param {string} description - Category description\n     */\n    function editCategory(id, name, description) {\n        const idInput = document.getElementById('edit_category_id');\n        const nameInput = document.getElementById('edit_category_name');\n        const descInput = document.getElementById('edit_category_description');\n\n        if (idInput) idInput.value = id;\n        if (nameInput) nameInput.value = name;\n        if (descInput) descInput.value = description || '';\n\n        // Show edit modal\n        const modalEl = document.getElementById('editCategoryModal');\n        if (modalEl) {\n            ModalManager.show('editCategoryModal');\n        }\n    }\n\n    // ========================================================================\n    // DELETE CATEGORY\n    // ========================================================================\n\n    /**\n     * Delete a message category\n     * Shows confirmation dialog before deletion\n     * @param {number} id - Category ID\n     * @param {string} name - Category name for display\n     * @param {string} deleteUrl - URL to submit delete request\n     * @param {string} csrfToken - CSRF token for form submission\n     */\n    function deleteCategory(id, name, deleteUrl, csrfToken) {\n        Swal.fire({\n            title: 'Delete Category?',\n            text: `Are you sure you want to delete \"${name}\"? This action cannot be undone.`,\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : '#dc3545',\n            cancelButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('info') : '#3085d6',\n            confirmButtonText: 'Yes, delete it!'\n        }).then((result) => {\n            if (result.isConfirmed) {\n                // Create form and submit\n                const form = document.createElement('form');\n                form.method = 'POST';\n                form.action = deleteUrl;\n\n                const csrfInput = document.createElement('input');\n                csrfInput.type = 'hidden';\n                csrfInput.name = 'csrf_token';\n                csrfInput.value = csrfToken;\n\n                const categoryIdInput = document.createElement('input');\n                categoryIdInput.type = 'hidden';\n                categoryIdInput.name = 'category_id';\n                categoryIdInput.value = id;\n\n                form.appendChild(csrfInput);\n                form.appendChild(categoryIdInput);\n                document.body.appendChild(form);\n                form.submit();\n            }\n        });\n    }\n\n    // ========================================================================\n    // ACTION HANDLERS\n    // ========================================================================\n\n    /**\n     * Handle edit category action\n     * @param {Event} e - The event object\n     */\n    function handleEditCategory(e) {\n        const editId = e.target.dataset.categoryId;\n        const editName = e.target.dataset.categoryName;\n        const editDesc = e.target.dataset.categoryDescription;\n        editCategory(editId, editName, editDesc);\n    }\n\n    /**\n     * Handle delete category action\n     * @param {Event} e - The event object\n     */\n    function handleDeleteCategory(e) {\n        const deleteId = e.target.dataset.categoryId;\n        const deleteName = e.target.dataset.categoryName;\n        const deleteUrl = e.target.dataset.deleteUrl;\n        const csrfToken = e.target.dataset.csrfToken;\n        deleteCategory(deleteId, deleteName, deleteUrl, csrfToken);\n    }\n\n    // ========================================================================\n    // EVENT DELEGATION\n    // ========================================================================\n\n    /**\n     * Initialize event delegation for category actions\n     */\n    function initEventDelegation() {\n        if (typeof EventDelegation === 'undefined') {\n            console.error('[Message Categories] EventDelegation not available');\n            return;\n        }\n\n        EventDelegation.register('edit-category', handleEditCategory, { preventDefault: true });\n        EventDelegation.register('delete-category', handleDeleteCategory, { preventDefault: true });\n    }\n\n    // ========================================================================\n    // INITIALIZATION\n    // ========================================================================\n\n    /**\n     * Initialize all message category functionality\n     */\n    function init() {\n        // Page guard: only run on message categories page\n        if (!document.getElementById('editCategoryModal')) {\n            return;\n        }\n\n        console.log('[Message Categories] Initializing...');\n        initEventDelegation();\n        console.log('[Message Categories] Initialization complete');\n    }\n\n    // ========================================================================\n    // DOM READY\n    // ========================================================================\n\n    // Initialize when DOM is ready\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        // DOM already loaded\n        init();\n    }\n\n    // Expose public API\n    window.MessageCategories = {\n        version: '1.0.0',\n        editCategory,\n        deleteCategory,\n        init\n    };\n\n})();\n","/**\n * ============================================================================\n * MESSAGE TEMPLATE DETAIL - Template Management in Categories\n * ============================================================================\n *\n * Handles message template management within categories in the admin panel.\n * Replaces 90-line inline script from category_detail.html.\n *\n * Features:\n * - View template content\n * - Edit templates\n * - Toggle template active status\n * - Delete templates with confirmation\n * - Event delegation for dynamic actions\n *\n * NO INLINE STYLES - Uses CSS classes and data attributes instead.\n *\n * Dependencies:\n * - Bootstrap 5.x (modals)\n * - SweetAlert2 (confirmations)\n * - EventDelegation (centralized event handling)\n *\n * ============================================================================\n */\n\n(function() {\n    'use strict';\n\n    // ========================================================================\n    // VIEW TEMPLATE\n    // ========================================================================\n\n    /**\n     * View template content in modal\n     * @param {number} id - Template ID\n     * @param {string} name - Template name\n     * @param {string} content - Template content\n     */\n    function viewTemplate(id, name, content) {\n        const titleEl = document.getElementById('view_template_title');\n        const contentEl = document.getElementById('view_template_content');\n\n        if (titleEl) titleEl.textContent = name;\n        if (contentEl) contentEl.textContent = content;\n\n        // Show modal\n        const modalEl = document.getElementById('viewTemplateModal');\n        if (modalEl) {\n            ModalManager.show('viewTemplateModal');\n        }\n    }\n\n    // ========================================================================\n    // EDIT TEMPLATE\n    // ========================================================================\n\n    /**\n     * Edit a template\n     * Opens modal with pre-filled template data\n     * @param {number} id - Template ID\n     * @param {string} name - Template name\n     * @param {string} description - Template description\n     * @param {string} content - Template content\n     * @param {string} channelType - Channel type (discord_dm, sms, etc.)\n     * @param {string} usageContext - Usage context description\n     * @param {boolean} isActive - Template active status\n     */\n    function editTemplate(id, name, description, content, channelType, usageContext, isActive) {\n        const idInput = document.getElementById('edit_template_id');\n        const nameInput = document.getElementById('edit_template_name');\n        const descInput = document.getElementById('edit_template_description');\n        const contentInput = document.getElementById('edit_template_content');\n        const channelSelect = document.getElementById('edit_channel_type');\n        const contextInput = document.getElementById('edit_usage_context');\n        const activeCheckbox = document.getElementById('edit_template_active');\n\n        if (idInput) idInput.value = id;\n        if (nameInput) nameInput.value = name;\n        if (descInput) descInput.value = description || '';\n        if (contentInput) contentInput.value = content;\n        if (channelSelect) channelSelect.value = channelType || '';\n        if (contextInput) contextInput.value = usageContext || '';\n        if (activeCheckbox) activeCheckbox.checked = isActive;\n\n        // Show edit modal\n        const modalEl = document.getElementById('editTemplateModal');\n        if (modalEl) {\n            ModalManager.show('editTemplateModal');\n        }\n    }\n\n    // ========================================================================\n    // TOGGLE TEMPLATE STATUS\n    // ========================================================================\n\n    /**\n     * Toggle template active/inactive status\n     * @param {number} id - Template ID\n     * @param {string} name - Template name for display\n     * @param {boolean} currentStatus - Current active status\n     * @param {string} toggleUrl - URL to submit toggle request\n     * @param {string} csrfToken - CSRF token for form submission\n     */\n    function toggleTemplate(id, name, currentStatus, toggleUrl, csrfToken) {\n        const action = currentStatus ? 'deactivate' : 'activate';\n        const newStatus = !currentStatus;\n\n        Swal.fire({\n            title: `${action.charAt(0).toUpperCase() + action.slice(1)} Template?`,\n            text: `Are you sure you want to ${action} \"${name}\"?`,\n            icon: 'question',\n            showCancelButton: true,\n            confirmButtonColor: newStatus ?\n                (getComputedStyle(document.documentElement).getPropertyValue('--ecs-success').trim() || '#198754') :\n                (getComputedStyle(document.documentElement).getPropertyValue('--ecs-warning').trim() || '#ffc107'),\n            cancelButtonColor: (typeof ECSTheme !== 'undefined') ?\n                ECSTheme.getColor('secondary') :\n                (getComputedStyle(document.documentElement).getPropertyValue('--ecs-neutral-50').trim() || '#6c757d'),\n            confirmButtonText: `Yes, ${action} it!`\n        }).then((result) => {\n            if (result.isConfirmed) {\n                // Create form and submit\n                const form = document.createElement('form');\n                form.method = 'POST';\n                form.action = toggleUrl;\n\n                const csrfInput = document.createElement('input');\n                csrfInput.type = 'hidden';\n                csrfInput.name = 'csrf_token';\n                csrfInput.value = csrfToken;\n\n                const templateIdInput = document.createElement('input');\n                templateIdInput.type = 'hidden';\n                templateIdInput.name = 'template_id';\n                templateIdInput.value = id;\n\n                form.appendChild(csrfInput);\n                form.appendChild(templateIdInput);\n                document.body.appendChild(form);\n                form.submit();\n            }\n        });\n    }\n\n    // ========================================================================\n    // DELETE TEMPLATE\n    // ========================================================================\n\n    /**\n     * Delete a template\n     * Shows confirmation dialog before deletion\n     * @param {number} id - Template ID\n     * @param {string} name - Template name for display\n     * @param {string} deleteUrl - URL to submit delete request\n     * @param {string} csrfToken - CSRF token for form submission\n     */\n    function deleteTemplate(id, name, deleteUrl, csrfToken) {\n        Swal.fire({\n            title: 'Delete Template?',\n            text: `Are you sure you want to delete \"${name}\"? This action cannot be undone.`,\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonColor: (typeof ECSTheme !== 'undefined') ?\n                ECSTheme.getColor('danger') :\n                (getComputedStyle(document.documentElement).getPropertyValue('--ecs-danger').trim() || '#dc3545'),\n            cancelButtonColor: (typeof ECSTheme !== 'undefined') ?\n                ECSTheme.getColor('info') :\n                (getComputedStyle(document.documentElement).getPropertyValue('--ecs-info').trim() || '#0dcaf0'),\n            confirmButtonText: 'Yes, delete it!'\n        }).then((result) => {\n            if (result.isConfirmed) {\n                // Create form and submit\n                const form = document.createElement('form');\n                form.method = 'POST';\n                form.action = deleteUrl;\n\n                const csrfInput = document.createElement('input');\n                csrfInput.type = 'hidden';\n                csrfInput.name = 'csrf_token';\n                csrfInput.value = csrfToken;\n\n                const templateIdInput = document.createElement('input');\n                templateIdInput.type = 'hidden';\n                templateIdInput.name = 'template_id';\n                templateIdInput.value = id;\n\n                form.appendChild(csrfInput);\n                form.appendChild(templateIdInput);\n                document.body.appendChild(form);\n                form.submit();\n            }\n        });\n    }\n\n    // ========================================================================\n    // VARIABLE INSERTION\n    // ========================================================================\n\n    /**\n     * Insert variable into textarea at cursor position\n     * @param {string} variable - Variable string to insert\n     * @param {string} targetId - ID of textarea to insert into\n     */\n    function insertVariable(variable, targetId) {\n        const textarea = document.getElementById(targetId);\n        if (!textarea) return;\n\n        const start = textarea.selectionStart;\n        const end = textarea.selectionEnd;\n        const text = textarea.value;\n\n        // Insert variable at cursor position\n        textarea.value = text.substring(0, start) + variable + text.substring(end);\n\n        // Move cursor to after inserted variable\n        const newPos = start + variable.length;\n        textarea.setSelectionRange(newPos, newPos);\n        textarea.focus();\n    }\n\n    /**\n     * Initialize variable button click handlers\n     */\n    function initVariableButtons() {\n        document.addEventListener('click', function(e) {\n            const varBtn = e.target.closest('.var-btn');\n            if (!varBtn) return;\n\n            e.preventDefault();\n            const variable = varBtn.dataset.var;\n            const targetId = varBtn.dataset.target || 'template_content';\n\n            // Determine target based on which modal is open\n            let actualTarget = targetId;\n            const editModal = document.getElementById('editTemplateModal');\n            const createModal = document.getElementById('createTemplateModal');\n\n            if (editModal && editModal.classList.contains('show')) {\n                actualTarget = 'edit_template_content';\n            } else if (createModal && createModal.classList.contains('show')) {\n                actualTarget = 'template_content';\n            }\n\n            insertVariable(variable, actualTarget);\n\n            // Visual feedback\n            varBtn.classList.add('inserted');\n            setTimeout(() => varBtn.classList.remove('inserted'), 300);\n        });\n    }\n\n    // ========================================================================\n    // ACTION HANDLERS\n    // ========================================================================\n\n    /**\n     * Handle go back action\n     * @param {Event} e - The event object\n     */\n    function handleGoBack(e) {\n        window.history.back();\n    }\n\n    /**\n     * Handle view template action\n     * @param {Event} e - The event object\n     */\n    function handleViewTemplate(e) {\n        const viewId = e.target.dataset.templateId;\n        const viewName = e.target.dataset.templateName;\n        const viewContent = e.target.dataset.templateContent;\n        viewTemplate(viewId, viewName, viewContent);\n    }\n\n    /**\n     * Handle edit template action\n     * @param {Event} e - The event object\n     */\n    function handleEditTemplate(e) {\n        const editId = e.target.dataset.templateId;\n        const editName = e.target.dataset.templateName;\n        const editDesc = e.target.dataset.templateDescription;\n        const editContent = e.target.dataset.templateContent;\n        const editChannel = e.target.dataset.templateChannel;\n        const editContext = e.target.dataset.templateContext;\n        const editActive = e.target.dataset.templateActive === 'true';\n        editTemplate(editId, editName, editDesc, editContent, editChannel, editContext, editActive);\n    }\n\n    /**\n     * Handle toggle template action\n     * @param {Event} e - The event object\n     */\n    function handleToggleTemplate(e) {\n        const toggleId = e.target.dataset.templateId;\n        const toggleName = e.target.dataset.templateName;\n        const toggleActive = e.target.dataset.templateActive === 'true';\n        const toggleUrl = e.target.dataset.toggleUrl;\n        const toggleCsrf = e.target.dataset.csrfToken;\n        toggleTemplate(toggleId, toggleName, toggleActive, toggleUrl, toggleCsrf);\n    }\n\n    /**\n     * Handle delete template action\n     * @param {Event} e - The event object\n     */\n    function handleDeleteTemplate(e) {\n        const deleteId = e.target.dataset.templateId;\n        const deleteName = e.target.dataset.templateName;\n        const deleteUrl = e.target.dataset.deleteUrl;\n        const deleteCsrf = e.target.dataset.csrfToken;\n        deleteTemplate(deleteId, deleteName, deleteUrl, deleteCsrf);\n    }\n\n    // ========================================================================\n    // EVENT DELEGATION\n    // ========================================================================\n\n    /**\n     * Initialize event delegation for template actions\n     */\n    function initEventDelegation() {\n        if (typeof EventDelegation === 'undefined') {\n            console.error('[Template Detail] EventDelegation not available');\n            return;\n        }\n\n        EventDelegation.register('go-back', handleGoBack, { preventDefault: true });\n        EventDelegation.register('view-template', handleViewTemplate, { preventDefault: true });\n        EventDelegation.register('edit-template', handleEditTemplate, { preventDefault: true });\n        EventDelegation.register('toggle-template', handleToggleTemplate, { preventDefault: true });\n        EventDelegation.register('delete-template', handleDeleteTemplate, { preventDefault: true });\n    }\n\n    // ========================================================================\n    // INITIALIZATION\n    // ========================================================================\n\n    /**\n     * Initialize all template detail functionality\n     */\n    function init() {\n        // Page guard: only run on template detail page\n        if (!document.getElementById('viewTemplateModal') && !document.getElementById('editTemplateModal')) {\n            return;\n        }\n\n        console.log('[Template Detail] Initializing...');\n        initEventDelegation();\n        initVariableButtons();\n        console.log('[Template Detail] Initialization complete');\n    }\n\n    // ========================================================================\n    // DOM READY\n    // ========================================================================\n\n    // Initialize when DOM is ready\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        // DOM already loaded\n        init();\n    }\n\n    // Expose public API\n    window.MessageTemplateDetail = {\n        version: '1.1.0',\n        viewTemplate,\n        editTemplate,\n        toggleTemplate,\n        deleteTemplate,\n        insertVariable,\n        init\n    };\n\n})();\n","/**\n * ============================================================================\n * PUSH CAMPAIGNS - Campaign Management System\n * ============================================================================\n *\n * Comprehensive push notification campaign management.\n * Replaces 400+ line inline script from campaigns.html.\n *\n * Features:\n * - Create, edit, delete campaigns\n * - Schedule and send campaigns\n * - Target audience selection\n * - Campaign status management\n * - Event delegation for dynamic content\n *\n * NO INLINE STYLES - Uses CSS classes and data attributes instead.\n *\n * Dependencies:\n * - Bootstrap 5.x (modals)\n * - SweetAlert2 (confirmations)\n * - EventDelegation (centralized event handling)\n *\n * ============================================================================\n */\n\n(function() {\n    'use strict';\n\n    // ========================================================================\n    // CONFIGURATION\n    // ========================================================================\n\n    const CampaignsConfig = {\n        baseUrl: window.CAMPAIGNS_BASE_URL || '/admin-panel',\n        csrfToken: window.CAMPAIGNS_CSRF_TOKEN || ''\n    };\n\n    // ========================================================================\n    // CAMPAIGN CRUD OPERATIONS\n    // ========================================================================\n\n    async function viewCampaign(campaignId) {\n        try {\n            const response = await fetch(`${CampaignsConfig.baseUrl}/communication/campaigns/${campaignId}`);\n            const data = await response.json();\n\n            if (data.success) {\n                // Show campaign details in modal\n                Swal.fire({\n                    title: data.campaign.name,\n                    html: `\n                        <div class=\"text-start\">\n                            <p><strong>Title:</strong> ${data.campaign.title}</p>\n                            <p><strong>Body:</strong> ${data.campaign.body}</p>\n                            <p><strong>Target:</strong> ${data.campaign.target_type}</p>\n                            <p><strong>Status:</strong> ${data.campaign.status}</p>\n                        </div>\n                    `,\n                    width: 600\n                });\n            }\n        } catch (error) {\n            Swal.fire('Error', 'Failed to load campaign details', 'error');\n        }\n    }\n\n    async function editCampaign(campaignId) {\n        try {\n            const response = await fetch(`${CampaignsConfig.baseUrl}/communication/campaigns/${campaignId}`);\n            const data = await response.json();\n\n            if (data.success) {\n                window.location.href = `${CampaignsConfig.baseUrl}/communication/campaigns/${campaignId}/edit`;\n            }\n        } catch (error) {\n            Swal.fire('Error', 'Failed to load campaign for editing', 'error');\n        }\n    }\n\n    async function sendCampaign(campaignId, campaignName) {\n        const result = await Swal.fire({\n            title: 'Send Campaign Now?',\n            text: `Send \"${campaignName}\" to all targeted users immediately?`,\n            icon: 'question',\n            showCancelButton: true,\n            confirmButtonText: 'Yes, send it!',\n            cancelButtonText: 'Cancel'\n        });\n\n        if (result.isConfirmed) {\n            try {\n                const response = await fetch(`${CampaignsConfig.baseUrl}/communication/campaigns/${campaignId}/send`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': CampaignsConfig.csrfToken\n                    }\n                });\n\n                const data = await response.json();\n                if (data.success) {\n                    Swal.fire('Sent!', data.message, 'success').then(() => location.reload());\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            } catch (error) {\n                Swal.fire('Error', 'Failed to send campaign', 'error');\n            }\n        }\n    }\n\n    async function scheduleCampaign(campaignId, campaignName) {\n        const result = await Swal.fire({\n            title: 'Schedule Campaign',\n            html: `\n                <div class=\"text-start\">\n                    <label class=\"form-label\">Schedule Time</label>\n                    <input type=\"datetime-local\" id=\"scheduleTime\" class=\"form-control\">\n                </div>\n            `,\n            showCancelButton: true,\n            confirmButtonText: 'Schedule',\n            preConfirm: () => {\n                const scheduleTime = document.getElementById('scheduleTime').value;\n                if (!scheduleTime) {\n                    Swal.showValidationMessage('Please select a time');\n                    return false;\n                }\n                return { scheduleTime };\n            }\n        });\n\n        if (result.isConfirmed) {\n            try {\n                const response = await fetch(`${CampaignsConfig.baseUrl}/communication/campaigns/${campaignId}/schedule`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': CampaignsConfig.csrfToken\n                    },\n                    body: JSON.stringify({ scheduled_send_time: result.value.scheduleTime })\n                });\n\n                const data = await response.json();\n                if (data.success) {\n                    Swal.fire('Scheduled!', data.message, 'success').then(() => location.reload());\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            } catch (error) {\n                Swal.fire('Error', 'Failed to schedule campaign', 'error');\n            }\n        }\n    }\n\n    async function deleteCampaign(campaignId, campaignName) {\n        const result = await Swal.fire({\n            title: 'Delete Campaign?',\n            text: `Delete \"${campaignName}\"? This cannot be undone.`,\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonColor: '#dc3545',\n            confirmButtonText: 'Yes, delete it!'\n        });\n\n        if (result.isConfirmed) {\n            try {\n                const response = await fetch(`${CampaignsConfig.baseUrl}/communication/campaigns/${campaignId}`, {\n                    method: 'DELETE',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': CampaignsConfig.csrfToken\n                    }\n                });\n\n                const data = await response.json();\n                if (data.success) {\n                    Swal.fire('Deleted!', data.message, 'success').then(() => location.reload());\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            } catch (error) {\n                Swal.fire('Error', 'Failed to delete campaign', 'error');\n            }\n        }\n    }\n\n    async function cancelCampaign(campaignId, campaignName) {\n        const result = await Swal.fire({\n            title: 'Cancel Campaign?',\n            text: `Cancel scheduled campaign \"${campaignName}\"?`,\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonText: 'Yes, cancel it!'\n        });\n\n        if (result.isConfirmed) {\n            try {\n                const response = await fetch(`${CampaignsConfig.baseUrl}/communication/campaigns/${campaignId}/cancel`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': CampaignsConfig.csrfToken\n                    }\n                });\n\n                const data = await response.json();\n                if (data.success) {\n                    Swal.fire('Cancelled!', data.message, 'success').then(() => location.reload());\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            } catch (error) {\n                Swal.fire('Error', 'Failed to cancel campaign', 'error');\n            }\n        }\n    }\n\n    async function duplicateCampaign(campaignId, campaignName) {\n        const result = await Swal.fire({\n            title: 'Duplicate Campaign?',\n            text: `Create a copy of \"${campaignName}\"?`,\n            icon: 'question',\n            showCancelButton: true,\n            confirmButtonText: 'Yes, duplicate it!'\n        });\n\n        if (result.isConfirmed) {\n            try {\n                const response = await fetch(`${CampaignsConfig.baseUrl}/communication/campaigns/${campaignId}/duplicate`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRFToken': CampaignsConfig.csrfToken\n                    }\n                });\n\n                const data = await response.json();\n                if (data.success) {\n                    Swal.fire('Duplicated!', data.message, 'success').then(() => location.reload());\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            } catch (error) {\n                Swal.fire('Error', 'Failed to duplicate campaign', 'error');\n            }\n        }\n    }\n\n    // ========================================================================\n    // FORM HELPERS\n    // ========================================================================\n\n    function toggleCampaignTargetOptions() {\n        const targetType = document.getElementById('campaign_target_type')?.value;\n        if (!targetType) return;\n\n        // Hide all target selectors\n        const selectors = [\n            'campaignTeamSelector',\n            'campaignLeagueSelector',\n            'campaignRoleSelector',\n            'campaignPoolSelector',\n            'campaignGroupSelector'\n        ];\n\n        selectors.forEach(id => {\n            const el = document.getElementById(id);\n            if (el) el.classList.add('d-none');\n        });\n\n        // Show selected target selector\n        const selectorMap = {\n            'team': 'campaignTeamSelector',\n            'league': 'campaignLeagueSelector',\n            'role': 'campaignRoleSelector',\n            'pool': 'campaignPoolSelector',\n            'group': 'campaignGroupSelector'\n        };\n\n        const selectedSelector = selectorMap[targetType];\n        if (selectedSelector) {\n            const el = document.getElementById(selectedSelector);\n            if (el) el.classList.remove('d-none');\n        }\n    }\n\n    function toggleCampaignSchedule() {\n        const sendType = document.querySelector('input[name=\"send_type\"]:checked')?.value;\n        const scheduleContainer = document.getElementById('campaignScheduleContainer');\n\n        if (!scheduleContainer) return;\n\n        if (sendType === 'scheduled') {\n            scheduleContainer.classList.remove('d-none');\n        } else {\n            scheduleContainer.classList.add('d-none');\n        }\n    }\n\n    // ========================================================================\n    // ACTION HANDLERS\n    // ========================================================================\n\n    /**\n     * Handle go back action\n     * @param {Event} e - The event object\n     */\n    function handleGoBack(e) {\n        window.history.back();\n    }\n\n    /**\n     * Handle view campaign action\n     * @param {Event} e - The event object\n     */\n    function handleViewCampaign(e) {\n        viewCampaign(e.target.dataset.campaignId);\n    }\n\n    /**\n     * Handle edit campaign action\n     * @param {Event} e - The event object\n     */\n    function handleEditCampaign(e) {\n        editCampaign(e.target.dataset.campaignId);\n    }\n\n    /**\n     * Handle send campaign action\n     * @param {Event} e - The event object\n     */\n    function handleSendCampaign(e) {\n        sendCampaign(\n            e.target.dataset.campaignId,\n            e.target.dataset.campaignName\n        );\n    }\n\n    /**\n     * Handle schedule campaign action\n     * @param {Event} e - The event object\n     */\n    function handleScheduleCampaign(e) {\n        scheduleCampaign(\n            e.target.dataset.campaignId,\n            e.target.dataset.campaignName\n        );\n    }\n\n    /**\n     * Handle delete campaign action\n     * @param {Event} e - The event object\n     */\n    function handleDeleteCampaign(e) {\n        deleteCampaign(\n            e.target.dataset.campaignId,\n            e.target.dataset.campaignName\n        );\n    }\n\n    /**\n     * Handle cancel campaign action\n     * @param {Event} e - The event object\n     */\n    function handleCancelCampaign(e) {\n        cancelCampaign(\n            e.target.dataset.campaignId,\n            e.target.dataset.campaignName\n        );\n    }\n\n    /**\n     * Handle duplicate campaign action\n     * @param {Event} e - The event object\n     */\n    function handleDuplicateCampaign(e) {\n        duplicateCampaign(\n            e.target.dataset.campaignId,\n            e.target.dataset.campaignName\n        );\n    }\n\n    // ========================================================================\n    // EVENT DELEGATION\n    // ========================================================================\n\n    function initEventDelegation() {\n        if (typeof EventDelegation === 'undefined') {\n            console.error('[Push Campaigns] EventDelegation not available');\n            return;\n        }\n\n        EventDelegation.register('go-back', handleGoBack, { preventDefault: true });\n        EventDelegation.register('view-campaign', handleViewCampaign, { preventDefault: true });\n        EventDelegation.register('edit-campaign', handleEditCampaign, { preventDefault: true });\n        EventDelegation.register('send-campaign', handleSendCampaign, { preventDefault: true });\n        EventDelegation.register('schedule-campaign', handleScheduleCampaign, { preventDefault: true });\n        EventDelegation.register('delete-campaign', handleDeleteCampaign, { preventDefault: true });\n        EventDelegation.register('cancel-campaign', handleCancelCampaign, { preventDefault: true });\n        EventDelegation.register('duplicate-campaign', handleDuplicateCampaign, { preventDefault: true });\n    }\n\n    // ========================================================================\n    // INITIALIZATION\n    // ========================================================================\n\n    function init() {\n        // Page guard: only run on campaigns page\n        if (!document.querySelector('[data-action*=\"campaign\"]')) {\n            return;\n        }\n\n        console.log('[Push Campaigns] Initializing...');\n\n        initEventDelegation();\n\n        // Initialize target type selector\n        const targetTypeSelect = document.getElementById('campaign_target_type');\n        if (targetTypeSelect) {\n            targetTypeSelect.addEventListener('change', toggleCampaignTargetOptions);\n            toggleCampaignTargetOptions(); // Set initial state\n        }\n\n        // Initialize send type radios\n        const sendTypeRadios = document.querySelectorAll('input[name=\"send_type\"]');\n        sendTypeRadios.forEach(radio => {\n            radio.addEventListener('change', toggleCampaignSchedule);\n        });\n        toggleCampaignSchedule(); // Set initial state\n\n        console.log('[Push Campaigns] Initialization complete');\n    }\n\n    // ========================================================================\n    // DOM READY\n    // ========================================================================\n\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        init();\n    }\n\n    // Expose public API\n    window.PushCampaigns = {\n        version: '1.0.0',\n        viewCampaign,\n        editCampaign,\n        sendCampaign,\n        scheduleCampaign,\n        deleteCampaign,\n        cancelCampaign,\n        duplicateCampaign,\n        init\n    };\n\n})();\n","/**\n * ============================================================================\n * SCHEDULED MESSAGES - Message Scheduling & Management\n * ============================================================================\n *\n * Handles scheduled Discord message management in the admin panel.\n * Replaces 239-line inline script from scheduled_messages.html.\n *\n * Features:\n * - Message preview and validation\n * - View scheduled message details\n * - Edit scheduled messages\n * - Cancel scheduled messages\n * - Retry failed messages\n * - Queue filtering\n * - Recurring message options\n *\n * NO INLINE STYLES - Uses CSS classes and data attributes instead.\n *\n * Dependencies:\n * - Bootstrap 5.x (modals)\n * - SweetAlert2 (confirmations)\n * - EventDelegation (centralized event handling)\n *\n * ============================================================================\n */\n\n(function() {\n    'use strict';\n\n    // ========================================================================\n    // CONFIGURATION\n    // ========================================================================\n\n    const CONFIG = {\n        ENDPOINTS: {\n            MESSAGE_DETAILS: '/admin-panel/communication/scheduled-messages/{id}/details',\n            MESSAGE_UPDATE: '/admin-panel/communication/scheduled-messages/{id}/update'\n        }\n    };\n\n    // ========================================================================\n    // MESSAGE PREVIEW\n    // ========================================================================\n\n    /**\n     * Preview message before scheduling\n     */\n    function previewMessage() {\n        const title = document.getElementById('message_title')?.value;\n        const content = document.getElementById('message_content')?.value;\n        const type = document.getElementById('message_type')?.value;\n        const channel = document.getElementById('target_channel')?.value;\n        const scheduleDate = document.getElementById('schedule_date')?.value;\n\n        if (!title || !content || !type || !channel) {\n            Swal.fire('Error', 'Please fill in all required fields before previewing', 'error');\n            return;\n        }\n\n        // Update preview modal content\n        const previewTitle = document.getElementById('preview_title');\n        const previewContent = document.getElementById('preview_content');\n        const previewType = document.getElementById('preview_type');\n        const previewChannel = document.getElementById('preview_channel');\n        const previewSchedule = document.getElementById('preview_schedule');\n\n        if (previewTitle) previewTitle.textContent = title;\n        if (previewContent) previewContent.textContent = content;\n        if (previewType) previewType.textContent = type;\n        if (previewChannel) previewChannel.textContent = channel;\n        if (previewSchedule) previewSchedule.textContent = scheduleDate || 'Not set';\n\n        // Show modal\n        const modalEl = document.getElementById('messagePreviewModal');\n        if (modalEl) {\n            ModalManager.show('messagePreviewModal');\n        }\n    }\n\n    // ========================================================================\n    // VIEW MESSAGE DETAILS\n    // ========================================================================\n\n    /**\n     * View details of a scheduled message\n     * @param {number} messageId - The message ID\n     * @param {string} messageTitle - The message title for display\n     */\n    function viewScheduledMessage(messageId, messageTitle) {\n        const titleEl = document.getElementById('message_details_title');\n        const contentEl = document.getElementById('message_details_content');\n\n        if (titleEl) {\n            titleEl.textContent = `Details for \"${messageTitle}\"`;\n        }\n\n        if (contentEl) {\n            contentEl.innerHTML = '<div class=\"text-center\"><div class=\"spinner-border\" role=\"status\"></div></div>';\n        }\n\n        // Show modal\n        const modalEl = document.getElementById('messageDetailsModal');\n        if (modalEl) {\n            ModalManager.show('messageDetailsModal');\n        }\n\n        // Load message details via AJAX\n        const url = CONFIG.ENDPOINTS.MESSAGE_DETAILS.replace('{id}', messageId);\n        fetch(url)\n            .then(response => response.json())\n            .then(data => {\n                if (data.success && contentEl) {\n                    contentEl.innerHTML = data.html;\n                } else if (contentEl) {\n                    contentEl.innerHTML = '<div class=\"alert alert-danger\">Error loading message details</div>';\n                }\n            })\n            .catch(() => {\n                if (contentEl) {\n                    contentEl.innerHTML = '<div class=\"alert alert-danger\">Error loading message details</div>';\n                }\n            });\n    }\n\n    // ========================================================================\n    // EDIT MESSAGE\n    // ========================================================================\n\n    /**\n     * Edit a scheduled message\n     * @param {number} messageId - The message ID\n     */\n    function editScheduledMessage(messageId) {\n        // Fetch message details first\n        const url = CONFIG.ENDPOINTS.MESSAGE_DETAILS.replace('{id}', messageId);\n\n        fetch(url)\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    const message = data.message;\n                    const scheduledTime = message.scheduled_send_time ? message.scheduled_send_time.slice(0, 16) : '';\n\n                    Swal.fire({\n                        title: 'Edit Scheduled Message',\n                        html: `\n                            <div class=\"text-start\">\n                                <div class=\"mb-3\">\n                                    <label class=\"form-label\">Message Type</label>\n                                    <select id=\"editMessageType\" class=\"form-select\">\n                                        <option value=\"standard\" ${message.message_type === 'standard' ? 'selected' : ''}>Standard</option>\n                                        <option value=\"announcement\" ${message.message_type === 'announcement' ? 'selected' : ''}>Announcement</option>\n                                        <option value=\"reminder\" ${message.message_type === 'reminder' ? 'selected' : ''}>Reminder</option>\n                                        <option value=\"notification\" ${message.message_type === 'notification' ? 'selected' : ''}>Notification</option>\n                                        <option value=\"alert\" ${message.message_type === 'alert' ? 'selected' : ''}>Alert</option>\n                                    </select>\n                                </div>\n                                <div class=\"mb-3\">\n                                    <label class=\"form-label\">Scheduled Time <span class=\"text-danger\">*</span></label>\n                                    <input type=\"datetime-local\" id=\"editScheduledTime\" class=\"form-control\" value=\"${scheduledTime}\">\n                                </div>\n                                <div class=\"mb-3\">\n                                    <label class=\"form-label\">Match ID</label>\n                                    <input type=\"text\" class=\"form-control\" value=\"${message.match_id || 'N/A'}\" disabled>\n                                    <small class=\"text-muted\">Match ID cannot be changed</small>\n                                </div>\n                            </div>\n                        `,\n                        showCancelButton: true,\n                        confirmButtonText: 'Save Changes',\n                        cancelButtonText: 'Cancel',\n                        preConfirm: () => {\n                            const scheduledTime = document.getElementById('editScheduledTime')?.value;\n                            if (!scheduledTime) {\n                                Swal.showValidationMessage('Scheduled time is required');\n                                return false;\n                            }\n                            return {\n                                message_type: document.getElementById('editMessageType')?.value,\n                                scheduled_time: scheduledTime\n                            };\n                        }\n                    }).then((result) => {\n                        if (result.isConfirmed) {\n                            const formData = new FormData();\n                            formData.append('message_type', result.value.message_type);\n                            formData.append('scheduled_time', result.value.scheduled_time);\n\n                            const updateUrl = CONFIG.ENDPOINTS.MESSAGE_UPDATE.replace('{id}', messageId);\n                            fetch(updateUrl, {\n                                method: 'POST',\n                                body: formData\n                            })\n                            .then(response => response.json())\n                            .then(data => {\n                                if (data.success) {\n                                    Swal.fire('Success', data.message, 'success').then(() => location.reload());\n                                } else {\n                                    Swal.fire('Error', data.message, 'error');\n                                }\n                            })\n                            .catch(() => Swal.fire('Error', 'Failed to update message', 'error'));\n                        }\n                    });\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            })\n            .catch(() => Swal.fire('Error', 'Failed to load message details', 'error'));\n    }\n\n    // ========================================================================\n    // CANCEL MESSAGE\n    // ========================================================================\n\n    /**\n     * Cancel a scheduled message\n     * @param {number} messageId - The message ID\n     * @param {string} messageTitle - The message title for display\n     * @param {string} cancelUrl - URL to submit cancel request\n     * @param {string} csrfToken - CSRF token for form submission\n     */\n    function cancelScheduledMessage(messageId, messageTitle, cancelUrl, csrfToken) {\n        Swal.fire({\n            title: 'Cancel Scheduled Message?',\n            text: `Cancel the scheduled message \"${messageTitle}\"? This action cannot be undone.`,\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : 'var(--ecs-danger)',\n            cancelButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('secondary') : '#6c757d',\n            confirmButtonText: 'Yes, cancel it!'\n        }).then((result) => {\n            if (result.isConfirmed) {\n                // Create form and submit\n                const form = document.createElement('form');\n                form.method = 'POST';\n                form.action = cancelUrl;\n\n                const csrfInput = document.createElement('input');\n                csrfInput.type = 'hidden';\n                csrfInput.name = 'csrf_token';\n                csrfInput.value = csrfToken;\n\n                const messageIdInput = document.createElement('input');\n                messageIdInput.type = 'hidden';\n                messageIdInput.name = 'message_id';\n                messageIdInput.value = messageId;\n\n                form.appendChild(csrfInput);\n                form.appendChild(messageIdInput);\n                document.body.appendChild(form);\n                form.submit();\n            }\n        });\n    }\n\n    // ========================================================================\n    // RETRY FAILED MESSAGE\n    // ========================================================================\n\n    /**\n     * Retry sending a failed message\n     * @param {number} messageId - The message ID\n     * @param {string} messageTitle - The message title for display\n     * @param {string} retryUrl - URL to submit retry request\n     * @param {string} csrfToken - CSRF token for form submission\n     */\n    function retryScheduledMessage(messageId, messageTitle, retryUrl, csrfToken) {\n        Swal.fire({\n            title: 'Retry Scheduled Message?',\n            text: `Retry sending the failed message \"${messageTitle}\"?`,\n            icon: 'question',\n            showCancelButton: true,\n            confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('success') : 'var(--ecs-success)',\n            cancelButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('secondary') : '#6c757d',\n            confirmButtonText: 'Yes, retry!'\n        }).then((result) => {\n            if (result.isConfirmed) {\n                // Create form and submit\n                const form = document.createElement('form');\n                form.method = 'POST';\n                form.action = retryUrl;\n\n                const csrfInput = document.createElement('input');\n                csrfInput.type = 'hidden';\n                csrfInput.name = 'csrf_token';\n                csrfInput.value = csrfToken;\n\n                const messageIdInput = document.createElement('input');\n                messageIdInput.type = 'hidden';\n                messageIdInput.name = 'message_id';\n                messageIdInput.value = messageId;\n\n                form.appendChild(csrfInput);\n                form.appendChild(messageIdInput);\n                document.body.appendChild(form);\n                form.submit();\n            }\n        });\n    }\n\n    // ========================================================================\n    // RECURRING MESSAGE TOGGLE\n    // ========================================================================\n\n    /**\n     * Initialize recurring message checkbox handler\n     */\n    function initRecurringToggle() {\n        const recurringCheckbox = document.getElementById('is_recurring');\n        const recurrenceOptions = document.getElementById('recurrence_options');\n        const recurrencePattern = document.getElementById('recurrence_pattern');\n\n        if (!recurringCheckbox || !recurrenceOptions) return;\n\n        recurringCheckbox.addEventListener('change', function() {\n            if (this.checked) {\n                recurrenceOptions.classList.remove('u-hidden');\n                if (recurrencePattern) {\n                    recurrencePattern.required = true;\n                }\n            } else {\n                recurrenceOptions.classList.add('u-hidden');\n                if (recurrencePattern) {\n                    recurrencePattern.required = false;\n                }\n            }\n        });\n\n        // Set initial state\n        if (recurringCheckbox.checked) {\n            recurrenceOptions.classList.remove('u-hidden');\n            if (recurrencePattern) {\n                recurrencePattern.required = true;\n            }\n        } else {\n            recurrenceOptions.classList.add('u-hidden');\n            if (recurrencePattern) {\n                recurrencePattern.required = false;\n            }\n        }\n    }\n\n    // ========================================================================\n    // QUEUE FILTERING\n    // ========================================================================\n\n    /**\n     * Initialize queue filtering radio buttons\n     */\n    function initQueueFiltering() {\n        const filterRadios = document.querySelectorAll('input[name=\"queue_filter\"]');\n\n        filterRadios.forEach(radio => {\n            radio.addEventListener('change', function() {\n                const filterValue = this.id.replace('filter_', '');\n                const rows = document.querySelectorAll('.message-row');\n\n                rows.forEach(row => {\n                    const status = row.dataset.status;\n\n                    if (filterValue === 'all') {\n                        row.classList.remove('u-hidden');\n                    } else if (status === filterValue) {\n                        row.classList.remove('u-hidden');\n                    } else {\n                        row.classList.add('u-hidden');\n                    }\n                });\n            });\n        });\n    }\n\n    // ========================================================================\n    // MINIMUM DATETIME SETUP\n    // ========================================================================\n\n    /**\n     * Set minimum date/time for scheduling input to current time\n     */\n    function initMinDateTime() {\n        const scheduleDateInput = document.getElementById('schedule_date');\n        if (!scheduleDateInput) return;\n\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        const hour = String(now.getHours()).padStart(2, '0');\n        const minute = String(now.getMinutes()).padStart(2, '0');\n\n        const minDateTime = `${year}-${month}-${day}T${hour}:${minute}`;\n        scheduleDateInput.min = minDateTime;\n    }\n\n    // ========================================================================\n    // ACTION HANDLERS\n    // ========================================================================\n\n    /**\n     * Handle go back action\n     * @param {Event} e - The event object\n     */\n    function handleGoBack(e) {\n        window.history.back();\n    }\n\n    /**\n     * Handle preview message action\n     * @param {Event} e - The event object\n     */\n    function handlePreviewMessage(e) {\n        previewMessage();\n    }\n\n    /**\n     * Handle view scheduled message action\n     * @param {Event} e - The event object\n     */\n    function handleViewScheduledMessage(e) {\n        const viewId = e.target.dataset.messageId;\n        const viewTitle = e.target.dataset.title;\n        viewScheduledMessage(viewId, viewTitle);\n    }\n\n    /**\n     * Handle edit scheduled message action\n     * @param {Event} e - The event object\n     */\n    function handleEditScheduledMessage(e) {\n        const editId = e.target.dataset.messageId;\n        editScheduledMessage(editId);\n    }\n\n    /**\n     * Handle cancel scheduled message action\n     * @param {Event} e - The event object\n     */\n    function handleCancelScheduledMessage(e) {\n        const cancelId = e.target.dataset.messageId;\n        const cancelTitle = e.target.dataset.title;\n        const cancelUrl = e.target.dataset.cancelUrl;\n        const cancelCsrf = e.target.dataset.csrfToken;\n        cancelScheduledMessage(cancelId, cancelTitle, cancelUrl, cancelCsrf);\n    }\n\n    /**\n     * Handle retry scheduled message action\n     * @param {Event} e - The event object\n     */\n    function handleRetryScheduledMessage(e) {\n        const retryId = e.target.dataset.messageId;\n        const retryTitle = e.target.dataset.title;\n        const retryUrl = e.target.dataset.retryUrl;\n        const retryCsrf = e.target.dataset.csrfToken;\n        retryScheduledMessage(retryId, retryTitle, retryUrl, retryCsrf);\n    }\n\n    // ========================================================================\n    // EVENT DELEGATION\n    // ========================================================================\n\n    /**\n     * Initialize event delegation for scheduled message actions\n     */\n    function initEventDelegation() {\n        if (typeof EventDelegation === 'undefined') {\n            console.error('[Scheduled Messages] EventDelegation not available');\n            return;\n        }\n\n        EventDelegation.register('go-back', handleGoBack, { preventDefault: true });\n        EventDelegation.register('preview-message', handlePreviewMessage, { preventDefault: true });\n        EventDelegation.register('view-scheduled-message', handleViewScheduledMessage, { preventDefault: true });\n        EventDelegation.register('edit-scheduled-message', handleEditScheduledMessage, { preventDefault: true });\n        EventDelegation.register('cancel-scheduled-message', handleCancelScheduledMessage, { preventDefault: true });\n        EventDelegation.register('retry-scheduled-message', handleRetryScheduledMessage, { preventDefault: true });\n    }\n\n    // ========================================================================\n    // INITIALIZATION\n    // ========================================================================\n\n    /**\n     * Initialize all scheduled message functionality\n     */\n    function init() {\n        // Page guard: only run on scheduled messages page\n        if (!document.getElementById('messagePreviewModal') && !document.getElementById('messageDetailsModal')) {\n            return;\n        }\n\n        console.log('[Scheduled Messages] Initializing...');\n\n        initRecurringToggle();\n        initQueueFiltering();\n        initMinDateTime();\n        initEventDelegation();\n\n        console.log('[Scheduled Messages] Initialization complete');\n    }\n\n    // ========================================================================\n    // DOM READY\n    // ========================================================================\n\n    // Initialize when DOM is ready\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        // DOM already loaded\n        init();\n    }\n\n    // Expose public API\n    window.ScheduledMessages = {\n        version: '1.0.0',\n        previewMessage,\n        viewScheduledMessage,\n        editScheduledMessage,\n        cancelScheduledMessage,\n        retryScheduledMessage,\n        init\n    };\n\n})();\n","/**\n * Match Reports - Event Handler and Chart Initialization\n * Handles all report generation and export actions\n */\n\n(function() {\n    'use strict';\n\n    // Page guard - only run on match reports page\n    const isMatchReportsPage = document.getElementById('matchStatusChart') ||\n                                document.getElementById('matchesPerWeekChart') ||\n                                document.querySelector('[data-action^=\"generate-\"][data-action*=\"report\"]') ||\n                                document.querySelector('[data-action^=\"export-\"]');\n\n    if (!isMatchReportsPage) return;\n\n    // Initialize charts and event handlers when DOM is loaded\n    document.addEventListener('DOMContentLoaded', function() {\n        initializeCharts();\n    });\n\n    /**\n     * Initialize Chart.js charts\n     */\n    function initializeCharts() {\n        const matchStatusCtx = document.getElementById('matchStatusChart');\n        const matchesPerWeekCtx = document.getElementById('matchesPerWeekChart');\n\n        if (matchStatusCtx) {\n            new Chart(matchStatusCtx.getContext('2d'), {\n                type: 'doughnut',\n                data: {\n                    labels: ['Completed', 'Upcoming', 'Live', 'Cancelled'],\n                    datasets: [{\n                        data: [\n                            parseInt(matchStatusCtx.dataset.completed || 0),\n                            parseInt(matchStatusCtx.dataset.pending || 0),\n                            parseInt(matchStatusCtx.dataset.live || 0),\n                            parseInt(matchStatusCtx.dataset.cancelled || 0)\n                        ],\n                        backgroundColor: [\n                            getComputedStyle(document.documentElement).getPropertyValue('--color-success') || '#28a745',\n                            getComputedStyle(document.documentElement).getPropertyValue('--color-warning') || '#ffc107',\n                            getComputedStyle(document.documentElement).getPropertyValue('--color-primary') || '#007bff',\n                            getComputedStyle(document.documentElement).getPropertyValue('--color-danger') || '#dc3545'\n                        ]\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            position: 'bottom'\n                        }\n                    }\n                }\n            });\n        }\n\n        if (matchesPerWeekCtx) {\n            new Chart(matchesPerWeekCtx.getContext('2d'), {\n                type: 'line',\n                data: {\n                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],\n                    datasets: [{\n                        label: 'Matches Played',\n                        data: [12, 19, 3, 5, 2, 15],\n                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary') || '#007bff',\n                        backgroundColor: 'rgba(0, 123, 255, 0.1)',\n                        tension: 0.4\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    scales: {\n                        y: {\n                            beginAtZero: true\n                        }\n                    }\n                }\n            });\n        }\n    }\n\n    /**\n     * Report generation functions\n     */\n    function generateMatchReport(matchId = null) {\n        console.log('Generate match report:', matchId);\n        // Implementation from original file\n    }\n\n    function generateLeagueReport() {\n        console.log('Generate league report');\n        // Implementation from original file\n    }\n\n    function generateTeamReport(teamId = null) {\n        console.log('Generate team report:', teamId);\n        // Implementation from original file\n    }\n\n    function generateCustomReport() {\n        console.log('Generate custom report');\n        // Implementation from original file\n    }\n\n    /**\n     * Quick report views\n     */\n    function viewRecentMatches() {\n        window.location.href = '/admin-panel/matches/recent';\n    }\n\n    function viewUpcomingMatches() {\n        window.location.href = '/admin-panel/matches/upcoming';\n    }\n\n    function viewTopScorers() {\n        console.log('View top scorers');\n    }\n\n    function viewLeagueStandings() {\n        window.location.href = '/admin-panel/match-operations/league-standings';\n    }\n\n    /**\n     * Export functions\n     */\n    function exportPDF() {\n        window.open('/admin/match-operations/reports/export?format=pdf', '_blank');\n    }\n\n    function exportExcel() {\n        window.open('/admin/match-operations/reports/export?format=excel', '_blank');\n    }\n\n    function exportCSV() {\n        window.open('/admin/match-operations/reports/export?format=csv', '_blank');\n    }\n\n    function scheduleReport() {\n        console.log('Schedule report');\n    }\n\n    /**\n     * Individual item views\n     */\n    function viewMatchReport(matchId) {\n        window.location.href = `/admin/match-operations/match/${matchId}/report`;\n    }\n\n    function viewTeamReport(teamId) {\n        window.location.href = `/admin/match-operations/team/${teamId}/report`;\n    }\n\n    function viewAllMatches() {\n        window.location.href = '/admin-panel/matches';\n    }\n\n    // ========================================================================\n    // EVENT DELEGATION REGISTRATIONS\n    // ========================================================================\n\n    // Report Generation Actions\n    EventDelegation.register('generate-match-report', function(element, e) {\n        const matchId = element.dataset.matchId;\n        generateMatchReport(matchId);\n    }, { preventDefault: true });\n\n    EventDelegation.register('generate-league-report', function(element, e) {\n        generateLeagueReport();\n    }, { preventDefault: true });\n\n    EventDelegation.register('generate-team-report', function(element, e) {\n        const teamId = element.dataset.teamId;\n        generateTeamReport(teamId);\n    }, { preventDefault: true });\n\n    EventDelegation.register('generate-custom-report', function(element, e) {\n        generateCustomReport();\n    }, { preventDefault: true });\n\n    // Quick View Actions\n    EventDelegation.register('view-recent-matches', function(element, e) {\n        viewRecentMatches();\n    }, { preventDefault: true });\n\n    EventDelegation.register('view-upcoming-matches', function(element, e) {\n        viewUpcomingMatches();\n    }, { preventDefault: true });\n\n    EventDelegation.register('view-top-scorers', function(element, e) {\n        viewTopScorers();\n    }, { preventDefault: true });\n\n    EventDelegation.register('view-league-standings', function(element, e) {\n        viewLeagueStandings();\n    }, { preventDefault: true });\n\n    // Export Actions\n    EventDelegation.register('export-pdf', function(element, e) {\n        exportPDF();\n    }, { preventDefault: true });\n\n    EventDelegation.register('export-excel', function(element, e) {\n        exportExcel();\n    }, { preventDefault: true });\n\n    EventDelegation.register('export-csv', function(element, e) {\n        exportCSV();\n    }, { preventDefault: true });\n\n    EventDelegation.register('schedule-report', function(element, e) {\n        scheduleReport();\n    }, { preventDefault: true });\n\n    // Individual Report View Actions\n    EventDelegation.register('view-match-report', function(element, e) {\n        const matchId = element.dataset.matchId;\n        viewMatchReport(matchId);\n    }, { preventDefault: true });\n\n    EventDelegation.register('view-team-report', function(element, e) {\n        const teamId = element.dataset.teamId;\n        viewTeamReport(teamId);\n    }, { preventDefault: true });\n\n    EventDelegation.register('view-all-matches', function(element, e) {\n        viewAllMatches();\n    }, { preventDefault: true });\n\n})();\n","/**\n * ============================================================================\n * SEASONS MANAGEMENT - MODERN JAVASCRIPT\n * ============================================================================\n *\n * Modern, maintainable JavaScript for seasons management\n * Uses event delegation and data attributes for all interactions\n *\n * ARCHITECTURAL STANDARDS:\n * - Event delegation for all interactions\n * - Data attributes for configuration\n * - No inline event handlers\n * - ES6+ features\n * - Proper error handling\n * - Accessible interactions\n *\n * ============================================================================\n */\n\n(function() {\n    'use strict';\n\n    // Page guard - only run on seasons page\n    const isSeasonsPage = document.querySelector('[data-action=\"create-season\"]') ||\n                          document.querySelector('[data-action=\"view-season\"]') ||\n                          document.querySelector('[data-action=\"edit-season\"]') ||\n                          document.querySelector('[data-action=\"set-current-season\"]') ||\n                          document.querySelector('[data-create-season-url]');\n\n    if (!isSeasonsPage) return;\n\n    /**\n     * Show create season modal\n     */\n    function createSeason() {\n        Swal.fire({\n            title: 'Create New Season',\n            html: `\n      <div class=\"text-start\">\n        <div class=\"mb-3\">\n          <label class=\"form-label\">Season Name <span class=\"text-danger\">*</span></label>\n          <input type=\"text\" id=\"seasonName\" class=\"form-control\" placeholder=\"e.g., Spring 2025\" data-form-control>\n        </div>\n        <div class=\"mb-3\">\n          <label class=\"form-label\">Start Date</label>\n          <input type=\"date\" id=\"seasonStartDate\" class=\"form-control\" data-form-control>\n        </div>\n        <div class=\"mb-3\">\n          <label class=\"form-label\">End Date</label>\n          <input type=\"date\" id=\"seasonEndDate\" class=\"form-control\" data-form-control>\n        </div>\n        <div class=\"form-check\">\n          <input type=\"checkbox\" id=\"seasonIsCurrent\" class=\"form-check-input\">\n          <label class=\"form-check-label\" for=\"seasonIsCurrent\">Set as current season</label>\n        </div>\n      </div>\n    `,\n            showCancelButton: true,\n            confirmButtonText: 'Create Season',\n            cancelButtonText: 'Cancel',\n            preConfirm: () => {\n                const name = document.getElementById('seasonName').value;\n                if (!name) {\n                    Swal.showValidationMessage('Season name is required');\n                    return false;\n                }\n                return {\n                    name: name,\n                    start_date: document.getElementById('seasonStartDate').value,\n                    end_date: document.getElementById('seasonEndDate').value,\n                    is_current: document.getElementById('seasonIsCurrent').checked ? 'true' : 'false'\n                };\n            }\n        }).then((result) => {\n            if (result.isConfirmed) {\n                submitCreateSeason(result.value);\n            }\n        });\n    }\n\n    /**\n     * Submit create season form\n     * @param {Object} data - Form data\n     */\n    function submitCreateSeason(data) {\n        const formData = new FormData();\n        formData.append('name', data.name);\n        formData.append('start_date', data.start_date);\n        formData.append('end_date', data.end_date);\n        formData.append('is_current', data.is_current);\n\n        // Get the create URL from Flask\n        const createUrl = document.querySelector('[data-create-season-url]')?.dataset.createSeasonUrl ||\n            window.location.origin + '/admin-panel/match-operations/seasons/create';\n\n        fetch(createUrl, {\n            method: 'POST',\n            body: formData\n        })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    Swal.fire('Success', data.message, 'success').then(() => location.reload());\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            })\n            .catch(() => Swal.fire('Error', 'Failed to create season', 'error'));\n    }\n\n    /**\n     * View season details\n     * @param {string} seasonId - Season ID\n     */\n    function viewSeason(seasonId) {\n        fetch(`/admin-panel/match-operations/seasons/${seasonId}/details`)\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    const season = data.season;\n                    Swal.fire({\n                        title: season.name,\n                        html: `\n            <div class=\"text-start\">\n              <p><strong>Start Date:</strong> ${season.start_date || 'Not set'}</p>\n              <p><strong>End Date:</strong> ${season.end_date || 'Not set'}</p>\n              <p><strong>Current Season:</strong> ${season.is_current ? 'Yes' : 'No'}</p>\n            </div>\n          `,\n                        icon: 'info'\n                    });\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            })\n            .catch(() => Swal.fire('Error', 'Failed to load season details', 'error'));\n    }\n\n    /**\n     * Edit season\n     * @param {string} seasonId - Season ID\n     */\n    function editSeason(seasonId) {\n        // First fetch the season details\n        fetch(`/admin-panel/match-operations/seasons/${seasonId}/details`)\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    showEditSeasonModal(seasonId, data.season);\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            })\n            .catch(() => Swal.fire('Error', 'Failed to load season details', 'error'));\n    }\n\n    /**\n     * Show edit season modal\n     * @param {string} seasonId - Season ID\n     * @param {Object} season - Season data\n     */\n    function showEditSeasonModal(seasonId, season) {\n        Swal.fire({\n            title: 'Edit Season',\n            html: `\n      <div class=\"text-start\">\n        <div class=\"mb-3\">\n          <label class=\"form-label\">Season Name <span class=\"text-danger\">*</span></label>\n          <input type=\"text\" id=\"editSeasonName\" class=\"form-control\" value=\"${season.name}\" data-form-control>\n        </div>\n        <div class=\"mb-3\">\n          <label class=\"form-label\">Start Date</label>\n          <input type=\"date\" id=\"editSeasonStartDate\" class=\"form-control\" value=\"${season.start_date}\" data-form-control>\n        </div>\n        <div class=\"mb-3\">\n          <label class=\"form-label\">End Date</label>\n          <input type=\"date\" id=\"editSeasonEndDate\" class=\"form-control\" value=\"${season.end_date}\" data-form-control>\n        </div>\n        <div class=\"form-check\">\n          <input type=\"checkbox\" id=\"editSeasonIsCurrent\" class=\"form-check-input\" ${season.is_current ? 'checked' : ''}>\n          <label class=\"form-check-label\" for=\"editSeasonIsCurrent\">Set as current season</label>\n        </div>\n      </div>\n    `,\n            showCancelButton: true,\n            showDenyButton: true,\n            confirmButtonText: 'Save Changes',\n            denyButtonText: 'Delete Season',\n            denyButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : 'var(--ecs-danger)',\n            cancelButtonText: 'Cancel',\n            preConfirm: () => {\n                const name = document.getElementById('editSeasonName').value;\n                if (!name) {\n                    Swal.showValidationMessage('Season name is required');\n                    return false;\n                }\n                return {\n                    name: name,\n                    start_date: document.getElementById('editSeasonStartDate').value,\n                    end_date: document.getElementById('editSeasonEndDate').value,\n                    is_current: document.getElementById('editSeasonIsCurrent').checked ? 'true' : 'false'\n                };\n            }\n        }).then((result) => {\n            if (result.isConfirmed) {\n                submitUpdateSeason(seasonId, result.value);\n            } else if (result.isDenied) {\n                deleteSeason(seasonId, season.name);\n            }\n        });\n    }\n\n    /**\n     * Submit update season form\n     * @param {string} seasonId - Season ID\n     * @param {Object} data - Form data\n     */\n    function submitUpdateSeason(seasonId, data) {\n        const formData = new FormData();\n        formData.append('name', data.name);\n        formData.append('start_date', data.start_date);\n        formData.append('end_date', data.end_date);\n        formData.append('is_current', data.is_current);\n\n        fetch(`/admin-panel/match-operations/seasons/${seasonId}/update`, {\n            method: 'POST',\n            body: formData\n        })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    Swal.fire('Success', data.message, 'success').then(() => location.reload());\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            })\n            .catch(() => Swal.fire('Error', 'Failed to update season', 'error'));\n    }\n\n    /**\n     * Delete season with confirmation\n     * @param {string} seasonId - Season ID\n     * @param {string} seasonName - Season name\n     */\n    function deleteSeason(seasonId, seasonName) {\n        Swal.fire({\n            title: 'Delete Season?',\n            text: `Are you sure you want to delete \"${seasonName}\"? This cannot be undone.`,\n            icon: 'warning',\n            showCancelButton: true,\n            confirmButtonText: 'Yes, delete',\n            confirmButtonColor: (typeof ECSTheme !== 'undefined') ? ECSTheme.getColor('danger') : 'var(--ecs-danger)',\n            cancelButtonText: 'Cancel'\n        }).then((result) => {\n            if (result.isConfirmed) {\n                submitDeleteSeason(seasonId);\n            }\n        });\n    }\n\n    /**\n     * Submit delete season request\n     * @param {string} seasonId - Season ID\n     */\n    function submitDeleteSeason(seasonId) {\n        fetch(`/admin-panel/match-operations/seasons/${seasonId}/delete`, {\n            method: 'POST'\n        })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    Swal.fire('Deleted', data.message, 'success').then(() => location.reload());\n                } else {\n                    Swal.fire('Error', data.message, 'error');\n                }\n            })\n            .catch(() => Swal.fire('Error', 'Failed to delete season', 'error'));\n    }\n\n    /**\n     * Set season as current\n     * @param {string} seasonId - Season ID\n     */\n    function setCurrentSeason(seasonId) {\n        Swal.fire({\n            title: 'Set Current Season?',\n            text: 'This will make this season the active one for new leagues and matches.',\n            icon: 'question',\n            showCancelButton: true,\n            confirmButtonText: 'Yes, set as current',\n            cancelButtonText: 'Cancel'\n        }).then((result) => {\n            if (result.isConfirmed) {\n                submitSetCurrentSeason(seasonId);\n            }\n        });\n    }\n\n    /**\n     * Submit set current season request\n     * @param {string} seasonId - Season ID\n     */\n    function submitSetCurrentSeason(seasonId) {\n        // Get the set current URL from Flask\n        const setCurrentUrl = document.querySelector('[data-set-current-season-url]')?.dataset.setCurrentSeasonUrl ||\n            window.location.origin + '/admin-panel/match-operations/seasons/set-current';\n\n        fetch(setCurrentUrl, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/x-www-form-urlencoded',\n            },\n            body: `season_id=${seasonId}`\n        })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    Swal.fire({\n                        title: 'Success',\n                        text: data.message,\n                        icon: 'success'\n                    }).then(() => {\n                        location.reload();\n                    });\n                } else {\n                    Swal.fire({\n                        title: 'Error',\n                        text: data.message,\n                        icon: 'error'\n                    });\n                }\n            })\n            .catch(error => {\n                Swal.fire({\n                    title: 'Error',\n                    text: 'An error occurred while setting current season',\n                    icon: 'error'\n                });\n            });\n    }\n\n    // ========================================================================\n    // EVENT DELEGATION REGISTRATIONS\n    // ========================================================================\n\n    EventDelegation.register('create-season', function(element, e) {\n        createSeason();\n    }, { preventDefault: true });\n\n    EventDelegation.register('view-season', function(element, e) {\n        const seasonId = element.dataset.seasonId;\n        viewSeason(seasonId);\n    }, { preventDefault: true });\n\n    EventDelegation.register('edit-season', function(element, e) {\n        const seasonId = element.dataset.seasonId;\n        editSeason(seasonId);\n    }, { preventDefault: true });\n\n    EventDelegation.register('set-current-season', function(element, e) {\n        const seasonId = element.dataset.seasonId;\n        setCurrentSeason(seasonId);\n    }, { preventDefault: true });\n\n})();\n\n/**\n * ============================================================================\n * END OF SEASONS MANAGEMENT JAVASCRIPT\n * ============================================================================\n */\n","/**\n * ============================================================================\n * MAIN ENTRY POINT - Vite Build System\n * ============================================================================\n *\n * This is the single entry point for all JavaScript in the application.\n * Vite will bundle this and all its imports into optimized chunks.\n *\n * Architecture:\n * 1. Core systems initialize first (EventDelegation, Helpers, etc.)\n * 2. Modules register their handlers with EventDelegation\n * 3. No duplicate event listeners - single source of truth\n *\n * ============================================================================\n */\n\n// ============================================================================\n// 1. CORE SYSTEMS - Must load first\n// ============================================================================\n\n// Event delegation system - the ONLY global click handler\nimport './event-delegation.js';\n\n// Core utilities\nimport './csrf-fetch.js';\nimport './helpers-minimal.js';\nimport './modal-manager.js';\nimport './config.js';\n\n// ============================================================================\n// 2. LAYOUT & NAVIGATION\n// ============================================================================\n\nimport './sidebar-interactions.js';\nimport './navbar-modern.js';\nimport './simple-theme-switcher.js';\nimport './admin-navigation.js';\n\n// ============================================================================\n// 3. UI COMPONENTS\n// ============================================================================\n\nimport './components-modern.js';\nimport './responsive-system.js';\nimport './ui-enhancements.js';\nimport './mobile-gestures.js';\nimport './mobile-keyboard.js';\nimport './mobile-forms.js';\nimport './mobile-haptics.js';\nimport './responsive-tables.js';\nimport './design-system.js';\nimport './swal-contextual.js';\n\n// ============================================================================\n// 4. FEATURE MODULES\n// ============================================================================\n\n// Chat and messaging\nimport './chat-widget.js';\nimport './messenger-widget.js';\n\n// Player features\n// import './player-profile.js';  // TODO: Create this file\n// import './profile-form.js';    // TODO: Create this file\nimport './profile-wizard.js';\nimport './profile-verification.js';\n\n// Match and draft\nimport './draft-system.js';\nimport './draft-history.js';\nimport './pitch-view.js';\n\n// Home page\n// import './home.js';  // TODO: Create this file\n\n// ============================================================================\n// 5. ADMIN MODULES\n// ============================================================================\n\nimport './admin-panel-base.js';\nimport './admin-panel-dashboard.js';\nimport './admin-panel-discord-bot.js';\nimport './admin-panel-performance.js';\n// import './admin-discord-management.js';  // TODO: Create this file\nimport './admin-utilities-init.js';\n\n// Admin submodules\nimport './admin/admin-dashboard.js';\nimport './admin/message-categories.js';\nimport './admin/message-template-detail.js';\nimport './admin/push-campaigns.js';\nimport './admin/scheduled-messages.js';\n\n// Match operations\nimport './match-operations/match-reports.js';\nimport './match-operations/seasons.js';\n\n// ============================================================================\n// 6. INITIALIZATION\n// ============================================================================\n\nimport './app-init-registration.js';\n\n// Log successful initialization\nconsole.log('[Main Entry] All modules loaded successfully');\n"],"names":["require_main_001","exports","module","_a","EventDelegation","handlers","Map","debug","stats","handlersRegistered","eventsProcessed","errorsEncountered","register","action","handler","options","this","set","element","event","preventDefault","stopPropagation","console","log","error","unregister","has","delete","isRegistered","getRegisteredActions","Array","from","keys","init","document","addEventListener","handleClick","bind","handleChange","handleInput","handleSubmit","handleKeydown","e","actionElement","target","closest","dataset","get","data","handleError","warn","onChange","value","onInput","form","onSubmit","FormData","onKeydown","key","code","showNotification","enableDebug","disableDebug","getStats","registeredActions","size","resetStats","updateRSVPStatus","playerId","matchId","response","Swal","fire","title","text","icon","showCancelButton","confirmButtonText","cancelButtonText","confirmButtonColor","ECSTheme","getColor","customClass","confirmButton","cancelButton","buttonsStyling","then","result","isConfirmed","formData","csrfToken","querySelector","append","allowOutsideClick","didOpen","showLoading","fetch","method","body","headers","ok","Error","json","success","timer","showConfirmButton","window","location","reload","message","catch","showCalendarToast","type","showToast","Toastify","bgColors","warning","info","duration","gravity","position","style","background","setCalendarLoading","loading","loadingIndicator","getElementById","content","classList","toggle","readyState","taskId","taskType","taskDataStr","taskData","JSON","parse","err","showTaskInfo","revokeTask","rescheduleTask","loadAllTaskDetails","refreshStatuses","targetId","bootstrap","Collapse","getOrCreateInstance","scheduleMatch","verifyMatch","verifyUrl","href","editMatch","playerName","confirmDraftPlayer","draftSystemInstance","showDraftModal","teamId","teamName","confirmRemovePlayer","openPlayerModal","searchTerm","toLowerCase","trim","handleSearch","querySelectorAll","forEach","card","shouldShow","includes","handleFilter","playerPosition","handleSort","handleEditButtonClick","onclickAttr","getAttribute","match","containerId","addEvent","removeEvent","updatePlayerRSVP","submitRSVP","withdrawRSVP","phone","jQuery","$","val","formatPhoneNumber","smsModal","ModalManager","showByElement","playerNameEl","playerIdEl","playerPhoneEl","messageEl","charCountEl","textContent","discordId","discordModal","discordIdEl","async","urlInput","navigator","clipboard","writeText","originalHtml","innerHTML","setTimeout","select","execCommand","confirm","CalendarSubscription","loadSubscription","webcalUrl","feedUrl","googleUrl","encodeURIComponent","open","_b","_c","preferences","include_team_matches","checked","include_league_events","include_ref_assignments","stringify","ProfileVerification","handleCheckboxChange","verifyDataEl","areAllSectionsReviewed","Haptics","uncheckedSections","getUncheckedSections","showIncompleteWarning","perPage","url","URL","searchParams","toString","btn","cancelButtonColor","originalText","disabled","success_count","finally","dmDiscordIdInput","modalTitle","dmMessageTextarea","defaultMessage","show","discord_id","modalElement","modalInstance","Modal","getInstance","hide","refId","assignReferee","removeReferee","loadCalendarEvents","fetchAvailableReferees","calendarInstance","getDate","Date","refreshCalendar","refereeId","viewRefereeProfile","profileUrl","status","updateRefereeStatus","league","approvePlayer","removePlayer","openEditPreferencesModal","openPlayerDetailsModal","view","section","parentElement","remove","add","listView","gridView","filterText","filterPlayerCards","searchText","openLeagueManagementModal","savePreferences","page","parseInt","paginationState","currentPage","updatePagination","addToPool","rejectPlayer","removeFromPool","loadStatistics","showAddPlayerModal","formActionInput","carouselElement","Carousel","next","submit","OnboardingWizard","croppedImageHiddenInput","bootstrapCarousel","totalSteps","getFormElements","getCurrentStep","cropper","canvas","getCroppedCanvas","toDataURL","checkValidity","firstInvalid","focus","scrollIntoView","behavior","block","activeItem","requiredFields","isValid","field","offsetParent","nextElementSibling","contains","feedback","createElement","className","validationMessage","parentNode","insertBefore","nextSibling","prev","handleSmsToggle","securityDashboard","refreshAll","loadSecurityEvents","loadSecurityLogs","ip","unbanIP","reason","quickBanIP","banIP","clearAllBans","showBanIpModal","banIp","startSeasonWizard","showExistingSeasons","showMainView","nextStep","previousStep","createSeason","updateSeasonStructure","templateType","applyWizardTemplate","addWizardField","removeWizardField","seasonId","seasonType","setActiveSeason","seasonName","confirmDeleteSeason","recreateDiscordResources","toggleScheduleSettings","deleteSchedule","commitSchedule","matchDesc","selectForSwap","executeSwap","swapIndex","removeFromSwap","removeField","addField","template","applyTemplate","addWeekConfig","generateDefaultWeeks","clearWeeks","updateWeekCard","removeWeekCard","platform","PassStudio","setPreviewPlatform","updatePassStylePreview","bg","fg","label","bgColorInput","fgColorInput","labelColorInput","bgColorText","fgColorText","labelColorText","updatePreviewFromForm","markUnsaved","textInput","toggleLogoVisibility","assetType","openAssetCropper","updateGooglePreview","updateBarcodePreview","saveAppearance","FieldsManager","initializeDefaults","fieldType","openAddFieldModal","createField","saveFields","resetFields","variableName","insertVariableInAdd","refreshStats","userId","showPlayerDetails","showApprovalModal","showDenialModal","submitApproval","submitDenial","originalFetch","CSRF_METHODS","toUpperCase","meta","getCSRFToken","Headers","call","fetchWithCSRF","Helpers","ROOT_EL","documentElement","LAYOUT_BREAKPOINT","RESIZE_DELAY","_initialized","_listeners","_resizeCallback","_resizeTimeout","menuPsScroll","mainMenu","isRtl","isMobileDevice","orientation","userAgent","indexOf","isSmallScreen","innerWidth","clientWidth","isDarkStyle","isLightStyle","isCollapsed","isFixed","isOffcanvas","isNavbarFixed","isFooterFixed","isLayoutNavbarFull","getLayoutMenu","getMenu","layoutMenu","getLayoutNavbar","getLayoutFooter","_addClass","cls","el","length","split","c","_removeClass","_hasClass","setCollapsed","collapsed","animate","_triggerEvent","toggleCollapsed","setNavbarFixed","fixed","setFooterFixed","scrollToActive","activeEl","menuInner","activeTop","getBoundingClientRect","top","scrollTop","clientHeight","scrollTo","swipeIn","targetEl","callback","Hammer","on","swipeOut","hammer","direction","DIRECTION_ALL","threshold","initPasswordToggle","input","replace","initCustomOptionCheck","updateCustomOptionCheck","opt","initSpeechToText","SpeechRecognition","webkitSpeechRecognition","listening","recognition","onspeechstart","onerror","onresult","results","transcript","onspeechend","stop","start","initNavbarDropdownScrollbar","PerfectScrollbar","wheelPropagation","suppressScrollX","initSidebarToggle","overlay","appOverlay","tel","currentTarget","eventName","namespaceParts","namespace","join","push","off","filter","l","name","dispatchEvent","Event","update","setAutoUpdate","enable","self","clearTimeout","destroy","removeEventListener","ModalManager$1","__publicField","context","discoverModals","setupEventDelegation","setupMutationObserver","modalInstances","modalEl","id","instance","modalId","parseOptionsFromElement","closestModal","backdrop","keyboard","Object","MutationObserver","mutations","mutation","removedNodes","node","nodeType","hasAttribute","cleanup","observe","childList","subtree","modal","dispose","cleanupAll","clear","reinit","DEBUG","args","getCSSVariable","fallback","getComputedStyle","getPropertyValue","InitSystem","priority","safeGetModal","safeShowModal","draftHistoryManager","config","colors","primary","danger","secondary","light","dark","colors_label","colors_dark","assetsPath","templateName","rtlSupport","setAttribute","cardBg","bodyBg","headerBg","CONFIG","sidebar","sidebarToggle","submenuToggle","expandableItem","collapsedKey","desktop","State","isDesktop","isSidebarOpen","collapsedState","localStorage","getItem","handleOutsideClick","handleKeyDown","resizeTimeout","handleResize","setupResizeHandler","item","isOpen","handleSidebarToggle","closeSidebar","button","handleSubmenuToggle","alert","toggleCollapsedState","openSidebar","setItem","focusableElements","getFocusableElements","firstFocusableElement","lastFocusableElement","focusTrapActive","handleFocusTrap","trapFocus","matches","currentElement","focusable","currentIndex","previousIndex","focusPreviousItem","nextIndex","focusNextItem","focusFirstItem","focusLastItem","shiftKey","activeElement","wasDesktop","SidebarInteractions","close","collapse","expand","description","reinitializable","ModernNavbarController","constructor","navbar","activeDropdown","lastScrollTop","scrollThreshold","csrfMeta","csrfInput","cookies","cookie","decodeURIComponent","registerEventHandlers","attachEventListeners","initScrollTracking","initSearch","initNotifications","initRoleImpersonation","initTheme","initPresence","toggleMobileMenu","dropdownId","dropdown","toggleDropdown","theme","switchTheme","startRoleImpersonation","stopRoleImpersonation","notificationId","markNotificationRead","markAllNotificationsRead","clearAllNotifications","dismissNotification","toggleNotificationExpand","handleLogout","handleKeyboard","navigateDropdown","closeDropdown","openDropdown","staggerDropdownItems","index","opacity","transform","transition","items","findIndex","menu","overflow","ticking","requestAnimationFrame","pageYOffset","searchInput","searchTimeout","query","performSearch","initializePlayerSearch","actualTheme","matchMedia","html","iconClass","system","option","checkboxes","selectedRoles","map","cb","roles","badge","normalStatus","activeStatus","activeRolesList","role","notification","updateNotificationBadge","unread_count","loadNotifications","setInterval","refreshNotificationCount","container","loadingEl","emptyEl","notifications","notifEl","createNotificationElement","appendChild","emptyText","div","is_read","colorClass","icon_color","truncatedMessage","substring","hasMore","escapeHtml","time_ago","created_at","expandedContent","n","deleted_count","count","loadImpersonationStatus","refreshBtn","loadAvailableRoles","checkbox","validateRoleSelection","clearBtn","clearRoleSelection","updateImpersonationStatus","animation","current_impersonation","isActive","active","startBtn","countDisplay","selectedCount","savedTheme","applyTheme","save","io","initPresenceSocket","checkPresence","refreshPresence","visibilityState","presenceSocket","connected","connect","SocketManager","isOptimisticallyConnected","updateOnlineStatus","getSocket","onConnect","socket","onDisconnect","username","attachSocketListenersDirect","transports","upgrade","reconnection","reconnectionAttempts","reconnectionDelay","reconnectionDelayMax","timeout","autoConnect","withCredentials","online","isOnline","statusIndicator","initNavbar","navbarController","SimpleThemeSwitcher","themes","variants","currentTheme","currentVariant","setupEventListeners","setupSystemThemeDetection","loadSavedVariant","savedVariant","loadSavedTheme","setTheme","effectiveTheme","resolveSystemTheme","updateThemeIcon","updateActiveMenuItem","saveThemeToServer","CustomEvent","detail","dropdownInstance","Dropdown","ctrlKey","metaKey","cycleTheme","getCurrentTheme","getEffectiveTheme","setVariant","variant","saveVariantToServer","notifyAndReload","timerProgressBar","getCurrentVariant","isModern","toggleVariant","themeSwitcher","_themeNeedsSync","_variantNeedsSync","AdminNavigationController","nav","handleEscapeKey","registerActions","handleToggleDropdown","handleNavigation","handleCloseDropdown","closeAllDropdowns","previousElementSibling","dropdownItem","firstItem","initAdminNavigation","pathname","navElements","altNav","adminNavController","ModalController","activeModals","Set","modalTrigger","Element","openModal","pop","topModal","firstElement","lastElement","ToastController","toasts","idCounter","toastId","dismiss","dismissible","actions","toast","icons","TooltipController","activeTooltip","tooltips","getElement","trigger","tooltip","tooltipPosition","tooltipVariant","DropdownController","dropdownTrigger","TableController","header","sort","paginationBtn","tableId","paginate","table","column","sortColumn","currentDirection","sortDirection","newDirection","h","FormController","validateField","validateForm","clearError","showError","inputs","ModernComponents","Toast","Tooltip","Table","Form","ResponsiveSystem","device","isMobile","isTablet","isIOS","isAndroid","hasTouch","hasMouse","detectDevice","applyDeviceClasses","fixIOSViewportHeight","setupTouchFeedback","enhanceModals","enhanceFormControls","enhanceTables","enhanceNavigation","improveScrolling","monitorNetworkStatus","maxTouchPoints","msMaxTouchPoints","screenWidth","test","setVh","vh","innerHeight","setProperty","passive","modalDialog","setupModalSwipeDismiss","modalOpen","modalBody","modalContent","handleModalKeyboard","modalClose","cleanupModalBackdrops","modalHeader","startY","currentY","isDragging","touches","clientY","deltaY","bsModal","removeProperty","tagName","control","offsetHeight","fn","select2","each","selectElement","siblings","width","dropdownParent","placeholder","is","scrollWidth","scrollHint","scrollLeft","tabs","isOnMobile","hasMultipleTabs","hasOverflow","existingHint","sidebarMenu","link","anchor","targetElement","showNetworkStatus","statusDiv","removeChild","resizeTimer","openModals","modalBackdrops","shouldEnhance","addedNodes","i","enhanceNewElements","feather","hasNewFeatherIcons","Node","ELEMENT_NODE","group","d","MobileGestures","isTouchDevice","isHammerLoaded","DIRECTION_DOWN","ev","center","y","bootstrapModal","setupSidebarSwipe","x","menuOpen","menuClose","setupPullToRefresh","isPulling","refreshIndicator","height","borderRadius","firstChild","refreshThreshold","Math","min","refresh","refreshEvent","setupLongPress","time","longPress","longPressEvent","setupDoubleTap","taps","posThreshold","isZoomed","tapCount","doubleTap","setupSwipeActions","row","velocity","actionsRevealed","actionsContainer","padding","deleteBtn","onclick","deleteEvent","swipe","setupPinchZoom","lastScale","scale","max","setupSwipeNavigation","activeTab","find","tab","activeIndex","click","addGestureStyles","head","MobileKeyboard","state","isVisible","keyboardHeight","activeInput","originalViewportHeight","detectKeyboard","currentHeight","heightDiff","onKeyboardShow","onKeyboardHide","adjustModalsForKeyboard","adjustDropdownsForKeyboard","resetModalAdjustments","availableHeight","inputRect","keyboardTop","bottom","rect","scrollInputIntoView","inputBottom","scrollAmount","inline","optimizeInputType","autocomplete","inputMode","pattern","fontSize","setupInputHandlers","setupIOSFixes","setVH","setupAndroidFixes","metaViewport","originalContent","setupFormValidation","validationError","validity","valid","addKeyboardStyles","MobileForms","optimizeModals","optimizeInputGroups","setupSwipeToDelete","entry","DIRECTION_LEFT","deleteIndicator","hideTimeout","removeBtn","optimizeSelect2","$select","hasClass","dropdownAutoWidth","dropdownCssClass","containerCssClass","minimumResultsForSearch","makeCollapsible","inputGroups","sectionTitle","optimizeDataTables","DataTable","$table","isDataTable","dt","settings","responsive","columns","visible","len","draw","pageLength","dom","language","search","lengthMenu","infoEmpty","infoFiltered","addQuickActions","optimizeTextareas","textarea","maxLength","counter","updateCounter","remaining","convertToFloatingLabels","setupMobileValidation","invalidFields","addMobileFormStyles","isSupported","_vibrate","isDisabled","vibrate","mozVibrate","webkitVibrate","removeItem","disable","medium","heavy","selection","deselection","drafted","invalidSelection","timeWarning","inputFocus","formSubmit","archive","custom","ResponsiveTables","processAllTables","setupScrollTracking","setupDataTables","processTable","headerCells","headerTexts","th","cell","isCellWithOnlyActions","isCellWithAvatar","innerText","children","every","child","tableWrapper","dataTable","extend","defaults","drawCallback","shouldProcess","ECSDesignSystem","ensureStylesheetLoaded","enhanceButtons","enhanceCards","enhanceForms","enhanceNavs","setupResponsive","setupDarkMode","setupCustomBehaviors","btnClassMap","excludeSelector","bootstrapClass","ecsClass","entries","cardClassMap","headerColorMap","cardHeader","adjustForScreenSize","htmlElement","attributeName","isDarkBsTheme","isDark","applyDarkModeToContent","attributes","addDarkModeToggle","addRippleEffect","improveKeyboardNavigation","setupTransitions","ripple","clientX","left","ACTION_CONFIGS","titlePrefix","approve","reject","deny","send","sync","reset","cancel","unlink","revoke","retry","resend","duplicate","assign","schedule","detectAction","lowerText","SwalContextual","Promise","resolve","actionConfig","reverseButtons","buildConfig","conversations","messages","unreadCount","searchUsers","markRead","msgId","enabled","interval","animationDuration","typingDebounce","searchDebounce","maxMessageLength","currentView","activeConversation","onlineUsers","isTyping","typingTimeout","searchQuery","searchResults","typingIndicators","readReceipts","elements","fetchJSON","loadConversations","conversationList","emptyState","display","defaultAvatar","conv","user","isUnread","is_online","avatarUrl","avatar_url","roleBadges","renderRoleBadges","is_coach","is_admin","is_global_admin","is_ref","last_message","sent_by_me","renderConversations","loadUnreadCount","updateBadge","badges","renderMessages","messagesContainer","currentUserId","getCurrentUserId","msg","isSent","sender_id","is_deleted","formatMessageTime","contentWithEmojis","shortcode","emoji","EMOJI_MAP","escaped","RegExp","convertEmojiShortcodes","handleDeleteMenuClick","messageId","popup","showDenyButton","denyButtonText","denyButtonColor","deleteMessage","isDenied","showDeleteConfirmation","senderId","deleteFor","msgIndex","m","scrollToBottom","xD","XD","renderSearchResults","navbarBadge","updateSendButton","sendBtn","composerInput","hasContent","openWidget","widget","scrollY","chatScrollY","joinMessagingRoom","closeWidget","clearSearch","toggleWidget","openConversation","userName","roleInfo","avatar","chatAvatar","src","chatName","chatStatus","chatAvatarContainer","loadMessages","closeConversation","scrollHeight","handleTriggerClick","handleConversationClick","conversation","isCoach","isAdmin","isGlobalAdmin","isRef","handleBackClick","handleSendClick","sendMessage","handleComposerKeydown","isConnected","emit","recipient_id","handleComposerInput","searchDebounceTimer","handleSearchInput","users","handleSearchFocus","handleSearchBlur","handleClickOutside","initWebSocket","connectedSocket","handleNewMessage","handleMessageSent","handleMessageError","handleUnreadUpdate","handleMessageDeleted","handleUserTyping","handleMessagesRead","handleUserOnline","handleUserOffline","handleOnlineUsers","attachSocketListeners","checkSocket","once","message_id","deletedFor","deleted_for","sender_name","Notification","permission","tag","user_id","typing","typingIndicator","reader_id","updateUserOnlineStatus","onlineList","onlineSection","slice","renderOnlineUsers","isoString","date","now","diff","toLocaleTimeString","hour","minute","toLocaleDateString","weekday","month","day","sessionData","updatePosition","mobileNav","navHeight","panel","chatView","backBtn","newChatBtn","openInboxBtn","closeBtns","pointerEvents","ChatWidget","getUnreadCount","MessengerWidget","currentUserName","refreshIntervals","bindEvents","setupWebSocket","loadOnlineUsers","unread","handleAction","conversationId","onlineUser","onlineUserId","msgInput","handleTyping","showList","focusSearch","handleTypingIndicator","appendMessage","online_users","updateOnlineCount","list","countEl","empty","onlineClass","preview","u","headerTitle","scroll","bubble","timeStr","msgEl","markAsRead","typingEl","navBadge","values","ProfileWizard","autoSaveUrl","autoSaveDelay","currentStep","autoSaveTimeout","lastSavedData","progressBar","currentStepInput","prevBtn","nextBtn","confirmBtn","saveIndicator","swipeHint","steps","stepIndicators","editButtons","confirmCheckbox","updateUI","initSwipeGestures","indicator","stepNum","stepIndicator","goToStep","gotoStep","scheduleAutoSave","populateReview","validateFinalStep","updateConfirmButton","validateCurrentStep","shakeInvalidFields","step","progress","updateNavigationButtons","currentStepEl","emailField","fieldName","review","displayValue","multiple","selected","selectedOptions","selectedIndex","checkedBoxes","autoSave","fromEntries","dataString","showSaveIndicator","touchStartX","touchEndX","changedTouches","screenX","swipeDistance","abs","formatPosition","isVerificationPage","setupSectionCheckboxes","setupConfirmButton","setupProgressIndicator","setupHapticFeedback","trackUserInteraction","createSectionCheckboxes","attachCheckboxListeners","cardTitle","sectionName","shouldSkipSection","checkboxContainer","some","isChecked","updateProgress","animateCardCheck","prepend","progressContainer","createProgressIndicator","progressText","helpText","firstCard","checkedCount","totalCount","updateProgressBar","progressBarContainer","percentage","round","sectionList","s","DraftSystemV2","leagueName","currentPlayerId","setupImageHandling","initializeSocket","setupSearch","setupTeamTabHighlighting","img","testImg","Image","onload","player","smartCropImage","aspectRatio","naturalWidth","naturalHeight","positionClass","closeModals","updateConnectionStatus","league_name","setupSocketListenersViaManager","setupSocketListeners","tryFallbackConnection","room","hideDraftingIndicator","handlePlayerDrafted","handlePlayerRemoved","player_name","showUserActivity","team_name","hideLoading","handlePlayerDetails","SM","disconnect","forceNew","setupSocketEventListeners","statusElement","updatePlayerCounts","playerColumns","visibleCount","playerCard","toggleEmptyState","updateAvailableCount","sortBy","players","a","b","cardA","cardB","aValue","bValue","localeCompare","teams","playerCount","inputOptions","reduce","obj","team","inputPlaceholder","inputValidator","t","confirmDraft","prompt","showDraftingIndicator","player_id","team_id","activity","fallbackDraftPlayer","availableContainer","playerColumn","maxHeight","addPlayerToTeam","teamSection","profilePictureUrl","profile_picture_url","favorite_position","career_goals","career_assists","career_yellow_cards","career_red_cards","updateTeamCount","teamCountBadge","addPlayerToAvailable","experienceLevel","experience_level","league_experience_seasons","mediumPictureUrl","profile_picture_medium","profile_picture_webp","experienceSeasons","attendanceEstimate","attendance_estimate","expectedAvailability","expected_weeks_available","experienceBadgeColor","attendanceColor","attendanceDisplay","sortSelect","positionFilter","filterPosition","removePlayerFromTeam","profileHtml","season_goals","season_assists","season_yellow_cards","season_red_cards","reliability_score","rsvp_response_rate","player_notes","admin_notes","match_history","goals","assists","yellow_cards","red_cards","availableCount","countElement","playersContainer","iconMap","refreshDraft","viewPlayerProfile","handleDragStart","dataTransfer","setData","effectAllowed","draggedPlayerId","handleDragEnd","handleDragOver","dropEffect","dropZone","startsWith","handleDragLeave","handleDrop","getData","teamNameElement","teamAccordion","handleDropToAvailable","currentPlayerCard","fetchPositionAnalysis","updatePositionHighlighting","activeTeamId","analysis","player_fit_scores","existingBadge","fitData","fit_category","openAccordion","DraftHistoryManager","getCsrfToken","initDragAndDrop","metaToken","editForm","handleEditSubmit","draggableCard","currentPos","pickId","dragImage","cloneNode","setDragImage","relatedTarget","draggedPickId","targetPosition","showAlert","handleDragDrop","newPosition","mode","reloadPage","clearFilters","currentUrl","editDraftPick","notes","deleteDraftPick","normalizeDraftPositions","leagueId","season_id","league_id","clearSeasonLeague","alertClass","alertHtml","insertAdjacentHTML","initTooltips","tooltipTriggerEl","PitchViewSystem","draftedPlayersByTeam","currentDraggedPlayer","setupSocket","populateExistingPlayers","updateAllStats","handlePlayerPositionUpdated","handlePositionFilter","onTeamTabSwitch","setupDragAndDropEvents","handlePositionDrop","updateAvailablePlayerCount","playerItems","selectedPosition","current_position","addPlayerToPosition","emitEvent","positionContainer","removePlayerFromAllPositions","playerElement","createPositionedPlayerElement","removePlayerFromAvailable","updatePositionStats","updateTeamCounts","handlePositionedPlayerDragStart","handlePositionedPlayerDragEnd","getPlayerInitials","part","charAt","removePlayerFromPosition","isPlayerInTeam","addPlayerBackToAvailable","playerItem","handlePlayerDragStart","handlePlayerDragEnd","handlePositionDragOver","handlePositionDragLeave","zone","isPositioned","currentPlayers","recommended","getRecommendedMax","showPositionWarning","movePlayerBetweenPositions","draftPlayerToPosition","updatePositionCapacity","gk","lb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench","currentCount","recommendedMax","positionName","slot","currentSpan","positions","playerData","pos","addPlayerToAvailableList","availableList","def","mid","fwd","category","countSpan","totalPlayers","getTotalPlayersInTeam","total","AdminPanelBase","MOBILE_BREAKPOINT","TABLET_BREAKPOINT","TOAST_DURATION_MOBILE","TOAST_DURATION_DESKTOP","FETCH_TIMEOUT_MOBILE","FETCH_TIMEOUT_DESKTOP","DEBOUNCE_WAIT","_autoRefreshInterval","initMobileNavigation","initAdminNavToggle","initTouchGestures","initProgressiveLoading","initResponsiveTables","initNetworkMonitoring","initAutoRefreshManagement","initPerformanceMonitoring","initDoubleTapPrevention","initSmoothScrolling","initIOSBouncePrevent","navLinks","navbarCollapse","navEnhanced","bsCollapse","toggleBtn","navContainer","adminNavToggleEnhanced","gesturesEnhanced","touchStartY","touchEndY","observer","IntersectionObserver","isIntersecting","loaded","unobserve","rootMargin","handleResponsiveTables","mobileStack","debounce","_networkMonitoringSetup","updateNetworkStatus","onLine","showMobileToast","_autoRefreshSetup","manageAutoRefresh","clearInterval","_performanceMonitoringSetup","PerformanceObserver","getEntries","entryType","loadTime","loadEventEnd","loadEventStart","entryTypes","doubleTapPrevented","smoothScrollEnhanced","_iosBouncePreventSetup","func","wait","autohide","delay","confirmAction","messageLower","defaultConfirm","defaultIcon","defaultTitle","defaultColor","confirmText","cancelText","confirmColor","controller","AbortController","timeoutId","abort","signal","registerServiceWorker","serviceWorker","registration","AdminPanel","handleNavigate","openNavigationSettings","openRegistrationSettings","openTaskMonitor","openDatabaseMonitor","openMatchReports","generateReport","currentPath","highlightActiveNav","cursor","createToggle","teams_navigation_enabled","store_navigation_enabled","matches_navigation_enabled","leagues_navigation_enabled","drafts_navigation_enabled","players_navigation_enabled","messaging_navigation_enabled","mobile_features_navigation_enabled","showLoaderOnConfirm","preConfirm","saveNavigationSettings","isLoading","showNavigationSettingsModal","roleOptions","default_user_role","registration_enabled","waitlist_registration_enabled","admin_approval_required","require_real_name","require_email","require_phone","require_location","require_jersey_size","require_position_preferences","require_availability","require_referee_willingness","discord_only_login","saveRegistrationSettings","showRegistrationSettingsModal","available_roles","tasksHtml","tasks","task","statusClass","started","worker","active_count","scheduled_count","worker_count","showTaskMonitorModal","cpu_percent","memory_percent","services","database","response_time_ms","redis","timestamp","toLocaleString","showDatabaseMonitorModal","formToken","botApiUrl","recentLogs","commands","commandUsage","guildInfo","restartBot","checkBotHealth","healthInfo","guild_count","latency","memory_usage_mb","details","viewBotLogs","logsHtml","logs","level","syncCommands","commands_synced","viewCommands","commandsHtml","categories","cmd","permissionColor","permission_level","commandPermissions","usage","commands_today","commands_this_week","most_used_command","avg_response_time","customCommands","manageGuild","guildId","guild","guildStats","member_count","channel_count","role_count","addGuild","showCloseButton","saveBotConfig","_d","_e","_f","_g","prefix","default_role","activity_type","activity_text","auto_moderation","command_logging","welcome_messages","resetBotConfig","prefixEl","roleEl","activityTypeEl","activityTextEl","autoModEl","cmdLogEl","welcomeEl","__BOT_RECENT_LOGS__","__BOT_COMMANDS__","__BOT_COMMAND_USAGE__","__BOT_GUILD_INFO__","loadBotConfig","refreshInterval","queryPerformanceChart","cacheUsageChart","autoRefresh","perfData","avgQueryTime","parseFloat","dbAvgQueryTime","cacheActive","cacheExpired","queryCtx","Chart","getContext","labels","datasets","borderColor","backgroundColor","tension","fill","maintainAspectRatio","scales","beginAtZero","plugins","legend","cacheCtx","borderWidth","initializeCharts","handleToggleAutoRefresh","handleClearCache","startAutoRefresh","statusSpan","updateMetrics","report","updateLiveValue","avg_query_time","toFixed","slow_queries","cache","active_entries","cache_size_mb","timestampEl","slowQueriesEl","cacheSizeEl","updateMetricColors","newValue","shift","updateQueryChart","expired","expired_entries","metric","varName","dockerStatusContainer","taskManagementContainer","toastContainer","roleSelect","permissionsSelect","currentPermissionsList","dockerLogsContent","dockerLogsModalLabel","refreshContainers","openTaskManagement","refreshTaskList","cleanupOldTasks","loadTaskManagement","showLogs","containerAction","viewTaskDetails","removeTask","closeModal","dockerStatus","dockerLogs","dockerAction","taskManagement","taskDetails","cleanupTasks","rolePermissions","AdminDashboard","initEventDelegation","initPermissionsTab","initDockerStatus","handleRefreshContainers","containerName","containerActionType","fetchDockerStatus","allowClear","roleId","fetchRolePermissions","updateCurrentPermissionsList","permissions","currentPermissionIds","p","listElement","permissionsHTML","containers","renderContainers","containersHTML","cont","statusIcon","image","uptime","cpu_usage","memory_usage","showComponentToast","errorData","fetchTaskList","renderTaskManagement","statistics","activeTasks","active_tasks","total_active","by_status","SUCCESS","FAILURE","PENDING","renderTaskRow","statusColor","getStatusColor","celery_state","task_id","task_type","stage","STARTED","PROGRESS","REVOKED","getThemeColor","detailsHtml","registry_cleaned","metadata_cleaned","total_cleaned","colorName","toastHTML","toastElement","editCategory","idInput","nameInput","descInput","deleteCategory","deleteUrl","categoryIdInput","handleEditCategory","categoryId","categoryName","categoryDescription","handleDeleteCategory","MessageCategories","version","viewTemplate","titleEl","contentEl","editTemplate","channelType","usageContext","contentInput","channelSelect","contextInput","activeCheckbox","toggleTemplate","currentStatus","toggleUrl","newStatus","templateIdInput","deleteTemplate","insertVariable","variable","selectionStart","end","selectionEnd","newPos","setSelectionRange","handleGoBack","history","back","handleViewTemplate","templateId","viewId","templateContent","handleEditTemplate","templateDescription","templateChannel","templateContext","templateActive","handleToggleTemplate","handleDeleteTemplate","varBtn","var","actualTarget","editModal","createModal","MessageTemplateDetail","CampaignsConfig","baseUrl","CAMPAIGNS_BASE_URL","CAMPAIGNS_CSRF_TOKEN","viewCampaign","campaignId","campaign","target_type","editCampaign","sendCampaign","campaignName","scheduleCampaign","scheduleTime","showValidationMessage","scheduled_send_time","deleteCampaign","cancelCampaign","duplicateCampaign","toggleCampaignTargetOptions","targetType","selectedSelector","pool","toggleCampaignSchedule","sendType","scheduleContainer","handleViewCampaign","handleEditCampaign","handleSendCampaign","handleScheduleCampaign","handleDeleteCampaign","handleCancelCampaign","handleDuplicateCampaign","targetTypeSelect","radio","PushCampaigns","ENDPOINTS","MESSAGE_DETAILS","MESSAGE_UPDATE","previewMessage","channel","scheduleDate","previewTitle","previewContent","previewType","previewChannel","previewSchedule","viewScheduledMessage","messageTitle","editScheduledMessage","scheduledTime","message_type","match_id","scheduled_time","updateUrl","cancelScheduledMessage","cancelUrl","messageIdInput","retryScheduledMessage","retryUrl","handlePreviewMessage","handleViewScheduledMessage","handleEditScheduledMessage","handleCancelScheduledMessage","handleRetryScheduledMessage","recurringCheckbox","recurrenceOptions","recurrencePattern","required","initRecurringToggle","filterValue","scheduleDateInput","minDateTime","getFullYear","String","getMonth","padStart","getHours","getMinutes","initMinDateTime","ScheduledMessages","matchStatusCtx","matchesPerWeekCtx","completed","pending","live","cancelled","generateMatchReport","generateTeamReport","viewMatchReport","viewTeamReport","start_date","end_date","is_current","createUrl","createSeasonUrl","origin","submitCreateSeason","editSeason","season","submitUpdateSeason","submitDeleteSeason","deleteSeason","showEditSeasonModal","setCurrentSeason","setCurrentUrl","setCurrentSeasonUrl","submitSetCurrentSeason","viewSeason","loader","root","bar","color","themeColor","originalSetupCustomBehaviors","e2","closeIcon","layoutOverlay","overlayDiv","closeMenu","toggleMenu","removeAttribute","discordBtn","DiscordMembershipChecker","membershipStatus","discordMembershipStatus","showJoinPrompt","urgency","showUrgentPopup"],"mappings":"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"}