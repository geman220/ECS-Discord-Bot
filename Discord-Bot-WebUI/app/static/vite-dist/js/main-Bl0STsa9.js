var e,t,n=Object.defineProperty,o=Object.getOwnPropertyNames,s=(e,t,o)=>((e,t,o)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o)(e,"symbol"!=typeof t?t+"":t,o),i=(e={"js/main-Bl0STsa9.js"(e,t){
/*! jQuery v3.7.1 | (c) OpenJS Foundation and other contributors | jquery.org/license */
var n,o,i,a,r;o="undefined"!=typeof window?window:void 0,i=function(e,t){var n=[],o=Object.getPrototypeOf,s=n.slice,i=n.flat?function(e){return n.flat.call(e)}:function(e){return n.concat.apply([],e)},a=n.push,r=n.indexOf,c={},l=c.toString,d=c.hasOwnProperty,u=d.toString,m=u.call(Object),h={},p=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},f=function(e){return null!=e&&e===e.window},g=e.document,v={type:!0,src:!0,nonce:!0,noModule:!0};function y(e,t,n){var o,s,i=(n=n||g).createElement("script");if(i.text=e,t)for(o in v)(s=t[o]||t.getAttribute&&t.getAttribute(o))&&i.setAttribute(o,s);n.head.appendChild(i).parentNode.removeChild(i)}function b(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?c[l.call(e)]||"object":typeof e}var w="3.7.1",S=/HTML$/i,_=function(e,t){return new _.fn.init(e,t)};function E(e){var t=!!e&&"length"in e&&e.length,n=b(e);return!p(e)&&!f(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}function C(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}_.fn=_.prototype={jquery:w,constructor:_,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=_.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return _.each(this,e)},map:function(e){return this.pushStack(_.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(_.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(_.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:n.sort,splice:n.splice},_.extend=_.fn.extend=function(){var e,t,n,o,s,i,a=arguments[0]||{},r=1,c=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[r]||{},r++),"object"==typeof a||p(a)||(a={}),r===c&&(a=this,r--);r<c;r++)if(null!=(e=arguments[r]))for(t in e)o=e[t],"__proto__"!==t&&a!==o&&(l&&o&&(_.isPlainObject(o)||(s=Array.isArray(o)))?(n=a[t],i=s&&!Array.isArray(n)?[]:s||_.isPlainObject(n)?n:{},s=!1,a[t]=_.extend(l,i,o)):void 0!==o&&(a[t]=o));return a},_.extend({expando:"jQuery"+(w+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==l.call(e)||(t=o(e))&&("function"!=typeof(n=d.call(t,"constructor")&&t.constructor)||u.call(n)!==m))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){y(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,o=0;if(E(e))for(n=e.length;o<n&&!1!==t.call(e[o],o,e[o]);o++);else for(o in e)if(!1===t.call(e[o],o,e[o]))break;return e},text:function(e){var t,n="",o=0,s=e.nodeType;if(!s)for(;t=e[o++];)n+=_.text(t);return 1===s||11===s?e.textContent:9===s?e.documentElement.textContent:3===s||4===s?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(E(Object(e))?_.merge(n,"string"==typeof e?[e]:e):a.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:r.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!S.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,o=0,s=e.length;o<n;o++)e[s++]=t[o];return e.length=s,e},grep:function(e,t,n){for(var o=[],s=0,i=e.length,a=!n;s<i;s++)!t(e[s],s)!==a&&o.push(e[s]);return o},map:function(e,t,n){var o,s,a=0,r=[];if(E(e))for(o=e.length;a<o;a++)null!=(s=t(e[a],a,n))&&r.push(s);else for(a in e)null!=(s=t(e[a],a,n))&&r.push(s);return i(r)},guid:1,support:h}),"function"==typeof Symbol&&(_.fn[Symbol.iterator]=n[Symbol.iterator]),_.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()});var T=n.pop,x=n.sort,L=n.splice,k="[\\x20\\t\\r\\n\\f]",I=new RegExp("^"+k+"+|((?:^|[^\\\\])(?:\\\\.)*)"+k+"+$","g");_.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var A=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function $(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}_.escapeSelector=function(e){return(e+"").replace(A,$)};var D=g,M=a;!function(){var t,o,i,a,c,l,u,m,p,f,g=M,v=_.expando,y=0,b=0,w=ee(),S=ee(),E=ee(),A=ee(),$=function(e,t){return e===t&&(c=!0),0},P="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="(?:\\\\[\\da-fA-F]{1,6}"+k+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",q="\\["+k+"*("+B+")(?:"+k+"*([*^$|!~]?=)"+k+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+k+"*\\]",O=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",N=new RegExp(k+"+","g"),R=new RegExp("^"+k+"*,"+k+"*"),F=new RegExp("^"+k+"*([>+~]|"+k+")"+k+"*"),H=new RegExp(k+"|>"),j=new RegExp(O),z=new RegExp("^"+B+"$"),W={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+k+"*(even|odd|(([+-]|)(\\d*)n|)"+k+"*(?:([+-]|)"+k+"*(\\d+)|))"+k+"*\\)|)","i"),bool:new RegExp("^(?:"+P+")$","i"),needsContext:new RegExp("^"+k+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+k+"*((?:-\\d)?\\d*)"+k+"*\\)|)(?=[^-]|$)","i")},U=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,X=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,V=/[+~]/,G=new RegExp("\\\\[\\da-fA-F]{1,6}"+k+"?|\\\\([^\\r\\n\\f])","g"),K=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},J=function(){ce()},Q=me(function(e){return!0===e.disabled&&C(e,"fieldset")},{dir:"parentNode",next:"legend"});try{g.apply(n=s.call(D.childNodes),D.childNodes),n[D.childNodes.length].nodeType}catch(be){g={apply:function(e,t){M.apply(e,s.call(t))},call:function(e){M.apply(e,s.call(arguments,1))}}}function Z(e,t,n,o){var s,i,a,r,c,d,u,f=t&&t.ownerDocument,y=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==y&&9!==y&&11!==y)return n;if(!o&&(ce(t),t=t||l,m)){if(11!==y&&(c=X.exec(e)))if(s=c[1]){if(9===y){if(!(a=t.getElementById(s)))return n;if(a.id===s)return g.call(n,a),n}else if(f&&(a=f.getElementById(s))&&Z.contains(t,a)&&a.id===s)return g.call(n,a),n}else{if(c[2])return g.apply(n,t.getElementsByTagName(e)),n;if((s=c[3])&&t.getElementsByClassName)return g.apply(n,t.getElementsByClassName(s)),n}if(!(A[e+" "]||p&&p.test(e))){if(u=e,f=t,1===y&&(H.test(e)||F.test(e))){for((f=V.test(e)&&re(t.parentNode)||t)==t&&h.scope||((r=t.getAttribute("id"))?r=_.escapeSelector(r):t.setAttribute("id",r=v)),i=(d=de(e)).length;i--;)d[i]=(r?"#"+r:":scope")+" "+ue(d[i]);u=d.join(",")}try{return g.apply(n,f.querySelectorAll(u)),n}catch(b){A(e,!0)}finally{r===v&&t.removeAttribute("id")}}}return ye(e.replace(I,"$1"),t,n,o)}function ee(){var e=[];return function t(n,s){return e.push(n+" ")>o.cacheLength&&delete t[e.shift()],t[n+" "]=s}}function te(e){return e[v]=!0,e}function ne(e){var t=l.createElement("fieldset");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function oe(e){return function(t){return C(t,"input")&&t.type===e}}function se(e){return function(t){return(C(t,"input")||C(t,"button"))&&t.type===e}}function ie(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Q(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ae(e){return te(function(t){return t=+t,te(function(n,o){for(var s,i=e([],n.length,t),a=i.length;a--;)n[s=i[a]]&&(n[s]=!(o[s]=n[s]))})})}function re(e){return e&&void 0!==e.getElementsByTagName&&e}function ce(e){var t,n=e?e.ownerDocument||e:D;return n!=l&&9===n.nodeType&&n.documentElement&&(u=(l=n).documentElement,m=!_.isXMLDoc(l),f=u.matches||u.webkitMatchesSelector||u.msMatchesSelector,u.msMatchesSelector&&D!=l&&(t=l.defaultView)&&t.top!==t&&t.addEventListener("unload",J),h.getById=ne(function(e){return u.appendChild(e).id=_.expando,!l.getElementsByName||!l.getElementsByName(_.expando).length}),h.disconnectedMatch=ne(function(e){return f.call(e,"*")}),h.scope=ne(function(){return l.querySelectorAll(":scope")}),h.cssHas=ne(function(){try{return l.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}}),h.getById?(o.filter.ID=function(e){var t=e.replace(G,K);return function(e){return e.getAttribute("id")===t}},o.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var n=t.getElementById(e);return n?[n]:[]}}):(o.filter.ID=function(e){var t=e.replace(G,K);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},o.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var n,o,s,i=t.getElementById(e);if(i){if((n=i.getAttributeNode("id"))&&n.value===e)return[i];for(s=t.getElementsByName(e),o=0;i=s[o++];)if((n=i.getAttributeNode("id"))&&n.value===e)return[i]}return[]}}),o.find.TAG=function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},o.find.CLASS=function(e,t){if(void 0!==t.getElementsByClassName&&m)return t.getElementsByClassName(e)},p=[],ne(function(e){var t;u.appendChild(e).innerHTML="<a id='"+v+"' href='' disabled='disabled'></a><select id='"+v+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||p.push("\\["+k+"*(?:value|"+P+")"),e.querySelectorAll("[id~="+v+"-]").length||p.push("~="),e.querySelectorAll("a#"+v+"+*").length||p.push(".#.+[+~]"),e.querySelectorAll(":checked").length||p.push(":checked"),(t=l.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),u.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&p.push(":enabled",":disabled"),(t=l.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||p.push("\\["+k+"*name"+k+"*="+k+"*(?:''|\"\")")}),h.cssHas||p.push(":has"),p=p.length&&new RegExp(p.join("|")),$=function(e,t){if(e===t)return c=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!h.sortDetached&&t.compareDocumentPosition(e)===n?e===l||e.ownerDocument==D&&Z.contains(D,e)?-1:t===l||t.ownerDocument==D&&Z.contains(D,t)?1:a?r.call(a,e)-r.call(a,t):0:4&n?-1:1)}),l}for(t in Z.matches=function(e,t){return Z(e,null,null,t)},Z.matchesSelector=function(e,t){if(ce(e),m&&!A[t+" "]&&(!p||!p.test(t)))try{var n=f.call(e,t);if(n||h.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(o){A(t,!0)}return 0<Z(t,l,null,[e]).length},Z.contains=function(e,t){return(e.ownerDocument||e)!=l&&ce(e),_.contains(e,t)},Z.attr=function(e,t){(e.ownerDocument||e)!=l&&ce(e);var n=o.attrHandle[t.toLowerCase()],s=n&&d.call(o.attrHandle,t.toLowerCase())?n(e,t,!m):void 0;return void 0!==s?s:e.getAttribute(t)},Z.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},_.uniqueSort=function(e){var t,n=[],o=0,i=0;if(c=!h.sortStable,a=!h.sortStable&&s.call(e,0),x.call(e,$),c){for(;t=e[i++];)t===e[i]&&(o=n.push(i));for(;o--;)L.call(e,n[o],1)}return a=null,e},_.fn.uniqueSort=function(){return this.pushStack(_.uniqueSort(s.apply(this)))},(o=_.expr={cacheLength:50,createPseudo:te,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(G,K),e[3]=(e[3]||e[4]||e[5]||"").replace(G,K),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||Z.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&Z.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return W.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&j.test(n)&&(t=de(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(G,K).toLowerCase();return"*"===e?function(){return!0}:function(e){return C(e,t)}},CLASS:function(e){var t=w[e+" "];return t||(t=new RegExp("(^|"+k+")"+e+"("+k+"|$)"))&&w(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(o){var s=Z.attr(o,e);return null==s?"!="===t:!t||(s+="","="===t?s===n:"!="===t?s!==n:"^="===t?n&&0===s.indexOf(n):"*="===t?n&&-1<s.indexOf(n):"$="===t?n&&s.slice(-n.length)===n:"~="===t?-1<(" "+s.replace(N," ")+" ").indexOf(n):"|="===t&&(s===n||s.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,o,s){var i="nth"!==e.slice(0,3),a="last"!==e.slice(-4),r="of-type"===t;return 1===o&&0===s?function(e){return!!e.parentNode}:function(t,n,c){var l,d,u,m,h,p=i!==a?"nextSibling":"previousSibling",f=t.parentNode,g=r&&t.nodeName.toLowerCase(),b=!c&&!r,w=!1;if(f){if(i){for(;p;){for(u=t;u=u[p];)if(r?C(u,g):1===u.nodeType)return!1;h=p="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?f.firstChild:f.lastChild],a&&b){for(w=(m=(l=(d=f[v]||(f[v]={}))[e]||[])[0]===y&&l[1])&&l[2],u=m&&f.childNodes[m];u=++m&&u&&u[p]||(w=m=0)||h.pop();)if(1===u.nodeType&&++w&&u===t){d[e]=[y,m,w];break}}else if(b&&(w=m=(l=(d=t[v]||(t[v]={}))[e]||[])[0]===y&&l[1]),!1===w)for(;(u=++m&&u&&u[p]||(w=m=0)||h.pop())&&(!(r?C(u,g):1===u.nodeType)||!++w||(b&&((d=u[v]||(u[v]={}))[e]=[y,w]),u!==t)););return(w-=s)===o||w%o==0&&0<=w/o}}},PSEUDO:function(e,t){var n,s=o.pseudos[e]||o.setFilters[e.toLowerCase()]||Z.error("unsupported pseudo: "+e);return s[v]?s(t):1<s.length?(n=[e,e,"",t],o.setFilters.hasOwnProperty(e.toLowerCase())?te(function(e,n){for(var o,i=s(e,t),a=i.length;a--;)e[o=r.call(e,i[a])]=!(n[o]=i[a])}):function(e){return s(e,0,n)}):s}},pseudos:{not:te(function(e){var t=[],n=[],o=ve(e.replace(I,"$1"));return o[v]?te(function(e,t,n,s){for(var i,a=o(e,null,s,[]),r=e.length;r--;)(i=a[r])&&(e[r]=!(t[r]=i))}):function(e,s,i){return t[0]=e,o(t,null,i,n),t[0]=null,!n.pop()}}),has:te(function(e){return function(t){return 0<Z(e,t).length}}),contains:te(function(e){return e=e.replace(G,K),function(t){return-1<(t.textContent||_.text(t)).indexOf(e)}}),lang:te(function(e){return z.test(e||"")||Z.error("unsupported lang: "+e),e=e.replace(G,K).toLowerCase(),function(t){var n;do{if(n=m?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===u},focus:function(e){return e===function(){try{return l.activeElement}catch(e){}}()&&l.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:ie(!1),disabled:ie(!0),checked:function(e){return C(e,"input")&&!!e.checked||C(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!o.pseudos.empty(e)},header:function(e){return Y.test(e.nodeName)},input:function(e){return U.test(e.nodeName)},button:function(e){return C(e,"input")&&"button"===e.type||C(e,"button")},text:function(e){var t;return C(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ae(function(){return[0]}),last:ae(function(e,t){return[t-1]}),eq:ae(function(e,t,n){return[n<0?n+t:n]}),even:ae(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ae(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ae(function(e,t,n){var o;for(o=n<0?n+t:t<n?t:n;0<=--o;)e.push(o);return e}),gt:ae(function(e,t,n){for(var o=n<0?n+t:n;++o<t;)e.push(o);return e})}}).pseudos.nth=o.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[t]=oe(t);for(t in{submit:!0,reset:!0})o.pseudos[t]=se(t);function le(){}function de(e,t){var n,s,i,a,r,c,l,d=S[e+" "];if(d)return t?0:d.slice(0);for(r=e,c=[],l=o.preFilter;r;){for(a in n&&!(s=R.exec(r))||(s&&(r=r.slice(s[0].length)||r),c.push(i=[])),n=!1,(s=F.exec(r))&&(n=s.shift(),i.push({value:n,type:s[0].replace(I," ")}),r=r.slice(n.length)),o.filter)!(s=W[a].exec(r))||l[a]&&!(s=l[a](s))||(n=s.shift(),i.push({value:n,type:a,matches:s}),r=r.slice(n.length));if(!n)break}return t?r.length:r?Z.error(e):S(e,c).slice(0)}function ue(e){for(var t=0,n=e.length,o="";t<n;t++)o+=e[t].value;return o}function me(e,t,n){var o=t.dir,s=t.next,i=s||o,a=n&&"parentNode"===i,r=b++;return t.first?function(t,n,s){for(;t=t[o];)if(1===t.nodeType||a)return e(t,n,s);return!1}:function(t,n,c){var l,d,u=[y,r];if(c){for(;t=t[o];)if((1===t.nodeType||a)&&e(t,n,c))return!0}else for(;t=t[o];)if(1===t.nodeType||a)if(d=t[v]||(t[v]={}),s&&C(t,s))t=t[o]||t;else{if((l=d[i])&&l[0]===y&&l[1]===r)return u[2]=l[2];if((d[i]=u)[2]=e(t,n,c))return!0}return!1}}function he(e){return 1<e.length?function(t,n,o){for(var s=e.length;s--;)if(!e[s](t,n,o))return!1;return!0}:e[0]}function pe(e,t,n,o,s){for(var i,a=[],r=0,c=e.length,l=null!=t;r<c;r++)(i=e[r])&&(n&&!n(i,o,s)||(a.push(i),l&&t.push(r)));return a}function fe(e,t,n,o,s,i){return o&&!o[v]&&(o=fe(o)),s&&!s[v]&&(s=fe(s,i)),te(function(i,a,c,l){var d,u,m,h,p=[],f=[],v=a.length,y=i||function(e,t,n){for(var o=0,s=t.length;o<s;o++)Z(e,t[o],n);return n}(t||"*",c.nodeType?[c]:c,[]),b=!e||!i&&t?y:pe(y,p,e,c,l);if(n?n(b,h=s||(i?e:v||o)?[]:a,c,l):h=b,o)for(d=pe(h,f),o(d,[],c,l),u=d.length;u--;)(m=d[u])&&(h[f[u]]=!(b[f[u]]=m));if(i){if(s||e){if(s){for(d=[],u=h.length;u--;)(m=h[u])&&d.push(b[u]=m);s(null,h=[],d,l)}for(u=h.length;u--;)(m=h[u])&&-1<(d=s?r.call(i,m):p[u])&&(i[d]=!(a[d]=m))}}else h=pe(h===a?h.splice(v,h.length):h),s?s(null,a,h,l):g.apply(a,h)})}function ge(e){for(var t,n,s,a=e.length,c=o.relative[e[0].type],l=c||o.relative[" "],d=c?1:0,u=me(function(e){return e===t},l,!0),m=me(function(e){return-1<r.call(t,e)},l,!0),h=[function(e,n,o){var s=!c&&(o||n!=i)||((t=n).nodeType?u(e,n,o):m(e,n,o));return t=null,s}];d<a;d++)if(n=o.relative[e[d].type])h=[me(he(h),n)];else{if((n=o.filter[e[d].type].apply(null,e[d].matches))[v]){for(s=++d;s<a&&!o.relative[e[s].type];s++);return fe(1<d&&he(h),1<d&&ue(e.slice(0,d-1).concat({value:" "===e[d-2].type?"*":""})).replace(I,"$1"),n,d<s&&ge(e.slice(d,s)),s<a&&ge(e=e.slice(s)),s<a&&ue(e))}h.push(n)}return he(h)}function ve(e,t){var n,s,a,r,c,d,u=[],h=[],p=E[e+" "];if(!p){for(t||(t=de(e)),n=t.length;n--;)(p=ge(t[n]))[v]?u.push(p):h.push(p);(p=E(e,(s=h,r=0<(a=u).length,c=0<s.length,d=function(e,t,n,d,u){var h,p,f,v=0,b="0",w=e&&[],S=[],E=i,C=e||c&&o.find.TAG("*",u),x=y+=null==E?1:Math.random()||.1,L=C.length;for(u&&(i=t==l||t||u);b!==L&&null!=(h=C[b]);b++){if(c&&h){for(p=0,t||h.ownerDocument==l||(ce(h),n=!m);f=s[p++];)if(f(h,t||l,n)){g.call(d,h);break}u&&(y=x)}r&&((h=!f&&h)&&v--,e&&w.push(h))}if(v+=b,r&&b!==v){for(p=0;f=a[p++];)f(w,S,t,n);if(e){if(0<v)for(;b--;)w[b]||S[b]||(S[b]=T.call(d));S=pe(S)}g.apply(d,S),u&&!e&&0<S.length&&1<v+a.length&&_.uniqueSort(d)}return u&&(y=x,i=E),w},r?te(d):d))).selector=e}return p}function ye(e,t,n,s){var i,a,r,c,l,d="function"==typeof e&&e,u=!s&&de(e=d.selector||e);if(n=n||[],1===u.length){if(2<(a=u[0]=u[0].slice(0)).length&&"ID"===(r=a[0]).type&&9===t.nodeType&&m&&o.relative[a[1].type]){if(!(t=(o.find.ID(r.matches[0].replace(G,K),t)||[])[0]))return n;d&&(t=t.parentNode),e=e.slice(a.shift().value.length)}for(i=W.needsContext.test(e)?0:a.length;i--&&(r=a[i],!o.relative[c=r.type]);)if((l=o.find[c])&&(s=l(r.matches[0].replace(G,K),V.test(a[0].type)&&re(t.parentNode)||t))){if(a.splice(i,1),!(e=s.length&&ue(a)))return g.apply(n,s),n;break}}return(d||ve(e,u))(s,t,!m,n,!t||V.test(e)&&re(t.parentNode)||t),n}le.prototype=o.filters=o.pseudos,o.setFilters=new le,h.sortStable=v.split("").sort($).join("")===v,ce(),h.sortDetached=ne(function(e){return 1&e.compareDocumentPosition(l.createElement("fieldset"))}),_.find=Z,_.expr[":"]=_.expr.pseudos,_.unique=_.uniqueSort,Z.compile=ve,Z.select=ye,Z.setDocument=ce,Z.tokenize=de,Z.escape=_.escapeSelector,Z.getText=_.text,Z.isXML=_.isXMLDoc,Z.selectors=_.expr,Z.support=_.support,Z.uniqueSort=_.uniqueSort}();var P=function(e,t,n){for(var o=[],s=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(s&&_(e).is(n))break;o.push(e)}return o},B=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},q=_.expr.match.needsContext,O=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function N(e,t,n){return p(t)?_.grep(e,function(e,o){return!!t.call(e,o,e)!==n}):t.nodeType?_.grep(e,function(e){return e===t!==n}):"string"!=typeof t?_.grep(e,function(e){return-1<r.call(t,e)!==n}):_.filter(t,e,n)}_.filter=function(e,t,n){var o=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===o.nodeType?_.find.matchesSelector(o,e)?[o]:[]:_.find.matches(e,_.grep(t,function(e){return 1===e.nodeType}))},_.fn.extend({find:function(e){var t,n,o=this.length,s=this;if("string"!=typeof e)return this.pushStack(_(e).filter(function(){for(t=0;t<o;t++)if(_.contains(s[t],this))return!0}));for(n=this.pushStack([]),t=0;t<o;t++)_.find(e,s[t],n);return 1<o?_.uniqueSort(n):n},filter:function(e){return this.pushStack(N(this,e||[],!1))},not:function(e){return this.pushStack(N(this,e||[],!0))},is:function(e){return!!N(this,"string"==typeof e&&q.test(e)?_(e):e||[],!1).length}});var R,F=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(_.fn.init=function(e,t,n){var o,s;if(!e)return this;if(n=n||R,"string"==typeof e){if(!(o="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:F.exec(e))||!o[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(o[1]){if(t=t instanceof _?t[0]:t,_.merge(this,_.parseHTML(o[1],t&&t.nodeType?t.ownerDocument||t:g,!0)),O.test(o[1])&&_.isPlainObject(t))for(o in t)p(this[o])?this[o](t[o]):this.attr(o,t[o]);return this}return(s=g.getElementById(o[2]))&&(this[0]=s,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):p(e)?void 0!==n.ready?n.ready(e):e(_):_.makeArray(e,this)}).prototype=_.fn,R=_(g);var H=/^(?:parents|prev(?:Until|All))/,j={children:!0,contents:!0,next:!0,prev:!0};function z(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}_.fn.extend({has:function(e){var t=_(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(_.contains(this,t[e]))return!0})},closest:function(e,t){var n,o=0,s=this.length,i=[],a="string"!=typeof e&&_(e);if(!q.test(e))for(;o<s;o++)for(n=this[o];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&_.find.matchesSelector(n,e))){i.push(n);break}return this.pushStack(1<i.length?_.uniqueSort(i):i)},index:function(e){return e?"string"==typeof e?r.call(_(e),this[0]):r.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(_.uniqueSort(_.merge(this.get(),_(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),_.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return P(e,"parentNode")},parentsUntil:function(e,t,n){return P(e,"parentNode",n)},next:function(e){return z(e,"nextSibling")},prev:function(e){return z(e,"previousSibling")},nextAll:function(e){return P(e,"nextSibling")},prevAll:function(e){return P(e,"previousSibling")},nextUntil:function(e,t,n){return P(e,"nextSibling",n)},prevUntil:function(e,t,n){return P(e,"previousSibling",n)},siblings:function(e){return B((e.parentNode||{}).firstChild,e)},children:function(e){return B(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(C(e,"template")&&(e=e.content||e),_.merge([],e.childNodes))}},function(e,t){_.fn[e]=function(n,o){var s=_.map(this,t,n);return"Until"!==e.slice(-5)&&(o=n),o&&"string"==typeof o&&(s=_.filter(o,s)),1<this.length&&(j[e]||_.uniqueSort(s),H.test(e)&&s.reverse()),this.pushStack(s)}});var W=/[^\x20\t\r\n\f]+/g;function U(e){return e}function Y(e){throw e}function X(e,t,n,o){var s;try{e&&p(s=e.promise)?s.call(e).done(t).fail(n):e&&p(s=e.then)?s.call(e,t,n):t.apply(void 0,[e].slice(o))}catch(i){n.apply(void 0,[i])}}_.Callbacks=function(e){var t,n;e="string"==typeof e?(t=e,n={},_.each(t.match(W)||[],function(e,t){n[t]=!0}),n):_.extend({},e);var o,s,i,a,r=[],c=[],l=-1,d=function(){for(a=a||e.once,i=o=!0;c.length;l=-1)for(s=c.shift();++l<r.length;)!1===r[l].apply(s[0],s[1])&&e.stopOnFalse&&(l=r.length,s=!1);e.memory||(s=!1),o=!1,a&&(r=s?[]:"")},u={add:function(){return r&&(s&&!o&&(l=r.length-1,c.push(s)),function t(n){_.each(n,function(n,o){p(o)?e.unique&&u.has(o)||r.push(o):o&&o.length&&"string"!==b(o)&&t(o)})}(arguments),s&&!o&&d()),this},remove:function(){return _.each(arguments,function(e,t){for(var n;-1<(n=_.inArray(t,r,n));)r.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<_.inArray(e,r):0<r.length},empty:function(){return r&&(r=[]),this},disable:function(){return a=c=[],r=s="",this},disabled:function(){return!r},lock:function(){return a=c=[],s||o||(r=s=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],c.push(t),o||d()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!i}};return u},_.extend({Deferred:function(t){var n=[["notify","progress",_.Callbacks("memory"),_.Callbacks("memory"),2],["resolve","done",_.Callbacks("once memory"),_.Callbacks("once memory"),0,"resolved"],["reject","fail",_.Callbacks("once memory"),_.Callbacks("once memory"),1,"rejected"]],o="pending",s={state:function(){return o},always:function(){return i.done(arguments).fail(arguments),this},catch:function(e){return s.then(null,e)},pipe:function(){var e=arguments;return _.Deferred(function(t){_.each(n,function(n,o){var s=p(e[o[4]])&&e[o[4]];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&p(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[o[0]+"With"](this,s?[e]:arguments)})}),e=null}).promise()},then:function(t,o,s){var i=0;function a(t,n,o,s){return function(){var r=this,c=arguments,l=function(){var e,l;if(!(t<i)){if((e=o.apply(r,c))===n.promise())throw new TypeError("Thenable self-resolution");l=e&&("object"==typeof e||"function"==typeof e)&&e.then,p(l)?s?l.call(e,a(i,n,U,s),a(i,n,Y,s)):(i++,l.call(e,a(i,n,U,s),a(i,n,Y,s),a(i,n,U,n.notifyWith))):(o!==U&&(r=void 0,c=[e]),(s||n.resolveWith)(r,c))}},d=s?l:function(){try{l()}catch(e){_.Deferred.exceptionHook&&_.Deferred.exceptionHook(e,d.error),i<=t+1&&(o!==Y&&(r=void 0,c=[e]),n.rejectWith(r,c))}};t?d():(_.Deferred.getErrorHook?d.error=_.Deferred.getErrorHook():_.Deferred.getStackHook&&(d.error=_.Deferred.getStackHook()),e.setTimeout(d))}}return _.Deferred(function(e){n[0][3].add(a(0,e,p(s)?s:U,e.notifyWith)),n[1][3].add(a(0,e,p(t)?t:U)),n[2][3].add(a(0,e,p(o)?o:Y))}).promise()},promise:function(e){return null!=e?_.extend(e,s):s}},i={};return _.each(n,function(e,t){var a=t[2],r=t[5];s[t[1]]=a.add,r&&a.add(function(){o=r},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),a.add(t[3].fire),i[t[0]]=function(){return i[t[0]+"With"](this===i?void 0:this,arguments),this},i[t[0]+"With"]=a.fireWith}),s.promise(i),t&&t.call(i,i),i},when:function(e){var t=arguments.length,n=t,o=Array(n),i=s.call(arguments),a=_.Deferred(),r=function(e){return function(n){o[e]=this,i[e]=1<arguments.length?s.call(arguments):n,--t||a.resolveWith(o,i)}};if(t<=1&&(X(e,a.done(r(n)).resolve,a.reject,!t),"pending"===a.state()||p(i[n]&&i[n].then)))return a.then();for(;n--;)X(i[n],r(n),a.reject);return a.promise()}});var V=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;_.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&V.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},_.readyException=function(t){e.setTimeout(function(){throw t})};var G=_.Deferred();function K(){g.removeEventListener("DOMContentLoaded",K),e.removeEventListener("load",K),_.ready()}_.fn.ready=function(e){return G.then(e).catch(function(e){_.readyException(e)}),this},_.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--_.readyWait:_.isReady)||(_.isReady=!0)!==e&&0<--_.readyWait||G.resolveWith(g,[_])}}),_.ready.then=G.then,"complete"===g.readyState||"loading"!==g.readyState&&!g.documentElement.doScroll?e.setTimeout(_.ready):(g.addEventListener("DOMContentLoaded",K),e.addEventListener("load",K));var J=function(e,t,n,o,s,i,a){var r=0,c=e.length,l=null==n;if("object"===b(n))for(r in s=!0,n)J(e,t,r,n[r],!0,i,a);else if(void 0!==o&&(s=!0,p(o)||(a=!0),l&&(a?(t.call(e,o),t=null):(l=t,t=function(e,t,n){return l.call(_(e),n)})),t))for(;r<c;r++)t(e[r],n,a?o:o.call(e[r],r,t(e[r],n)));return s?e:l?t.call(e):c?t(e[0],n):i},Q=/^-ms-/,Z=/-([a-z])/g;function ee(e,t){return t.toUpperCase()}function te(e){return e.replace(Q,"ms-").replace(Z,ee)}var ne=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function oe(){this.expando=_.expando+oe.uid++}oe.uid=1,oe.prototype={cache:function(e){var t=e[this.expando];return t||(t={},ne(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var o,s=this.cache(e);if("string"==typeof t)s[te(t)]=n;else for(o in t)s[te(o)]=t[o];return s},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][te(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,o=e[this.expando];if(void 0!==o){if(void 0!==t){n=(t=Array.isArray(t)?t.map(te):(t=te(t))in o?[t]:t.match(W)||[]).length;for(;n--;)delete o[t[n]]}(void 0===t||_.isEmptyObject(o))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!_.isEmptyObject(t)}};var se=new oe,ie=new oe,ae=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,re=/[A-Z]/g;function ce(e,t,n){var o,s;if(void 0===n&&1===e.nodeType)if(o="data-"+t.replace(re,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(o))){try{n="true"===(s=n)||"false"!==s&&("null"===s?null:s===+s+""?+s:ae.test(s)?JSON.parse(s):s)}catch(i){}ie.set(e,t,n)}else n=void 0;return n}_.extend({hasData:function(e){return ie.hasData(e)||se.hasData(e)},data:function(e,t,n){return ie.access(e,t,n)},removeData:function(e,t){ie.remove(e,t)},_data:function(e,t,n){return se.access(e,t,n)},_removeData:function(e,t){se.remove(e,t)}}),_.fn.extend({data:function(e,t){var n,o,s,i=this[0],a=i&&i.attributes;if(void 0===e){if(this.length&&(s=ie.get(i),1===i.nodeType&&!se.get(i,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&0===(o=a[n].name).indexOf("data-")&&(o=te(o.slice(5)),ce(i,o,s[o]));se.set(i,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each(function(){ie.set(this,e)}):J(this,function(t){var n;if(i&&void 0===t)return void 0!==(n=ie.get(i,e))||void 0!==(n=ce(i,e))?n:void 0;this.each(function(){ie.set(this,e,t)})},null,t,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){ie.remove(this,e)})}}),_.extend({queue:function(e,t,n){var o;if(e)return t=(t||"fx")+"queue",o=se.get(e,t),n&&(!o||Array.isArray(n)?o=se.access(e,t,_.makeArray(n)):o.push(n)),o||[]},dequeue:function(e,t){t=t||"fx";var n=_.queue(e,t),o=n.length,s=n.shift(),i=_._queueHooks(e,t);"inprogress"===s&&(s=n.shift(),o--),s&&("fx"===t&&n.unshift("inprogress"),delete i.stop,s.call(e,function(){_.dequeue(e,t)},i)),!o&&i&&i.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return se.get(e,n)||se.access(e,n,{empty:_.Callbacks("once memory").add(function(){se.remove(e,[t+"queue",n])})})}}),_.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?_.queue(this[0],e):void 0===t?this:this.each(function(){var n=_.queue(this,e,t);_._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&_.dequeue(this,e)})},dequeue:function(e){return this.each(function(){_.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,o=1,s=_.Deferred(),i=this,a=this.length,r=function(){--o||s.resolveWith(i,[i])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=se.get(i[a],e+"queueHooks"))&&n.empty&&(o++,n.empty.add(r));return r(),s.promise(t)}});var le=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,de=new RegExp("^(?:([+-])=|)("+le+")([a-z%]*)$","i"),ue=["Top","Right","Bottom","Left"],me=g.documentElement,he=function(e){return _.contains(e.ownerDocument,e)},pe={composed:!0};me.getRootNode&&(he=function(e){return _.contains(e.ownerDocument,e)||e.getRootNode(pe)===e.ownerDocument});var fe=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&he(e)&&"none"===_.css(e,"display")};function ge(e,t,n,o){var s,i,a=20,r=o?function(){return o.cur()}:function(){return _.css(e,t,"")},c=r(),l=n&&n[3]||(_.cssNumber[t]?"":"px"),d=e.nodeType&&(_.cssNumber[t]||"px"!==l&&+c)&&de.exec(_.css(e,t));if(d&&d[3]!==l){for(c/=2,l=l||d[3],d=+c||1;a--;)_.style(e,t,d+l),(1-i)*(1-(i=r()/c||.5))<=0&&(a=0),d/=i;d*=2,_.style(e,t,d+l),n=n||[]}return n&&(d=+d||+c||0,s=n[1]?d+(n[1]+1)*n[2]:+n[2],o&&(o.unit=l,o.start=d,o.end=s)),s}var ve={};function ye(e,t){for(var n,o,s,i,a,r,c,l=[],d=0,u=e.length;d<u;d++)(o=e[d]).style&&(n=o.style.display,t?("none"===n&&(l[d]=se.get(o,"display")||null,l[d]||(o.style.display="")),""===o.style.display&&fe(o)&&(l[d]=(c=a=i=void 0,a=(s=o).ownerDocument,r=s.nodeName,(c=ve[r])||(i=a.body.appendChild(a.createElement(r)),c=_.css(i,"display"),i.parentNode.removeChild(i),"none"===c&&(c="block"),ve[r]=c)))):"none"!==n&&(l[d]="none",se.set(o,"display",n)));for(d=0;d<u;d++)null!=l[d]&&(e[d].style.display=l[d]);return e}_.fn.extend({show:function(){return ye(this,!0)},hide:function(){return ye(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){fe(this)?_(this).show():_(this).hide()})}});var be,we,Se=/^(?:checkbox|radio)$/i,_e=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ee=/^$|^module$|\/(?:java|ecma)script/i;be=g.createDocumentFragment().appendChild(g.createElement("div")),(we=g.createElement("input")).setAttribute("type","radio"),we.setAttribute("checked","checked"),we.setAttribute("name","t"),be.appendChild(we),h.checkClone=be.cloneNode(!0).cloneNode(!0).lastChild.checked,be.innerHTML="<textarea>x</textarea>",h.noCloneChecked=!!be.cloneNode(!0).lastChild.defaultValue,be.innerHTML="<option></option>",h.option=!!be.lastChild;var Ce={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Te(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&C(e,t)?_.merge([e],n):n}function xe(e,t){for(var n=0,o=e.length;n<o;n++)se.set(e[n],"globalEval",!t||se.get(t[n],"globalEval"))}Ce.tbody=Ce.tfoot=Ce.colgroup=Ce.caption=Ce.thead,Ce.th=Ce.td,h.option||(Ce.optgroup=Ce.option=[1,"<select multiple='multiple'>","</select>"]);var Le=/<|&#?\w+;/;function ke(e,t,n,o,s){for(var i,a,r,c,l,d,u=t.createDocumentFragment(),m=[],h=0,p=e.length;h<p;h++)if((i=e[h])||0===i)if("object"===b(i))_.merge(m,i.nodeType?[i]:i);else if(Le.test(i)){for(a=a||u.appendChild(t.createElement("div")),r=(_e.exec(i)||["",""])[1].toLowerCase(),c=Ce[r]||Ce._default,a.innerHTML=c[1]+_.htmlPrefilter(i)+c[2],d=c[0];d--;)a=a.lastChild;_.merge(m,a.childNodes),(a=u.firstChild).textContent=""}else m.push(t.createTextNode(i));for(u.textContent="",h=0;i=m[h++];)if(o&&-1<_.inArray(i,o))s&&s.push(i);else if(l=he(i),a=Te(u.appendChild(i),"script"),l&&xe(a),n)for(d=0;i=a[d++];)Ee.test(i.type||"")&&n.push(i);return u}var Ie=/^([^.]*)(?:\.(.+)|)/;function Ae(){return!0}function $e(){return!1}function De(e,t,n,o,s,i){var a,r;if("object"==typeof t){for(r in"string"!=typeof n&&(o=o||n,n=void 0),t)De(e,r,n,o,t[r],i);return e}if(null==o&&null==s?(s=n,o=n=void 0):null==s&&("string"==typeof n?(s=o,o=void 0):(s=o,o=n,n=void 0)),!1===s)s=$e;else if(!s)return e;return 1===i&&(a=s,(s=function(e){return _().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=_.guid++)),e.each(function(){_.event.add(this,t,s,o,n)})}function Me(e,t,n){n?(se.set(e,t,!1),_.event.add(e,t,{namespace:!1,handler:function(e){var n,o=se.get(this,t);if(1&e.isTrigger&&this[t]){if(o)(_.event.special[t]||{}).delegateType&&e.stopPropagation();else if(o=s.call(arguments),se.set(this,t,o),this[t](),n=se.get(this,t),se.set(this,t,!1),o!==n)return e.stopImmediatePropagation(),e.preventDefault(),n}else o&&(se.set(this,t,_.event.trigger(o[0],o.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ae)}})):void 0===se.get(e,t)&&_.event.add(e,t,Ae)}_.event={global:{},add:function(e,t,n,o,s){var i,a,r,c,l,d,u,m,h,p,f,g=se.get(e);if(ne(e))for(n.handler&&(n=(i=n).handler,s=i.selector),s&&_.find.matchesSelector(me,s),n.guid||(n.guid=_.guid++),(c=g.events)||(c=g.events=Object.create(null)),(a=g.handle)||(a=g.handle=function(t){return void 0!==_&&_.event.triggered!==t.type?_.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(W)||[""]).length;l--;)h=f=(r=Ie.exec(t[l])||[])[1],p=(r[2]||"").split(".").sort(),h&&(u=_.event.special[h]||{},h=(s?u.delegateType:u.bindType)||h,u=_.event.special[h]||{},d=_.extend({type:h,origType:f,data:o,handler:n,guid:n.guid,selector:s,needsContext:s&&_.expr.match.needsContext.test(s),namespace:p.join(".")},i),(m=c[h])||((m=c[h]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,o,p,a)||e.addEventListener&&e.addEventListener(h,a)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=n.guid)),s?m.splice(m.delegateCount++,0,d):m.push(d),_.event.global[h]=!0)},remove:function(e,t,n,o,s){var i,a,r,c,l,d,u,m,h,p,f,g=se.hasData(e)&&se.get(e);if(g&&(c=g.events)){for(l=(t=(t||"").match(W)||[""]).length;l--;)if(h=f=(r=Ie.exec(t[l])||[])[1],p=(r[2]||"").split(".").sort(),h){for(u=_.event.special[h]||{},m=c[h=(o?u.delegateType:u.bindType)||h]||[],r=r[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=i=m.length;i--;)d=m[i],!s&&f!==d.origType||n&&n.guid!==d.guid||r&&!r.test(d.namespace)||o&&o!==d.selector&&("**"!==o||!d.selector)||(m.splice(i,1),d.selector&&m.delegateCount--,u.remove&&u.remove.call(e,d));a&&!m.length&&(u.teardown&&!1!==u.teardown.call(e,p,g.handle)||_.removeEvent(e,h,g.handle),delete c[h])}else for(h in c)_.event.remove(e,h+t[l],n,o,!0);_.isEmptyObject(c)&&se.remove(e,"handle events")}},dispatch:function(e){var t,n,o,s,i,a,r=new Array(arguments.length),c=_.event.fix(e),l=(se.get(this,"events")||Object.create(null))[c.type]||[],d=_.event.special[c.type]||{};for(r[0]=c,t=1;t<arguments.length;t++)r[t]=arguments[t];if(c.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,c)){for(a=_.event.handlers.call(this,c,l),t=0;(s=a[t++])&&!c.isPropagationStopped();)for(c.currentTarget=s.elem,n=0;(i=s.handlers[n++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==i.namespace&&!c.rnamespace.test(i.namespace)||(c.handleObj=i,c.data=i.data,void 0!==(o=((_.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,r))&&!1===(c.result=o)&&(c.preventDefault(),c.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,c),c.result}},handlers:function(e,t){var n,o,s,i,a,r=[],c=t.delegateCount,l=e.target;if(c&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(i=[],a={},n=0;n<c;n++)void 0===a[s=(o=t[n]).selector+" "]&&(a[s]=o.needsContext?-1<_(s,this).index(l):_.find(s,this,null,[l]).length),a[s]&&i.push(o);i.length&&r.push({elem:l,handlers:i})}return l=this,c<t.length&&r.push({elem:l,handlers:t.slice(c)}),r},addProp:function(e,t){Object.defineProperty(_.Event.prototype,e,{enumerable:!0,configurable:!0,get:p(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[_.expando]?e:new _.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return Se.test(t.type)&&t.click&&C(t,"input")&&Me(t,"click",!0),!1},trigger:function(e){var t=this||e;return Se.test(t.type)&&t.click&&C(t,"input")&&Me(t,"click"),!0},_default:function(e){var t=e.target;return Se.test(t.type)&&t.click&&C(t,"input")&&se.get(t,"click")||C(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},_.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},_.Event=function(e,t){if(!(this instanceof _.Event))return new _.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ae:$e,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&_.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[_.expando]=!0},_.Event.prototype={constructor:_.Event,isDefaultPrevented:$e,isPropagationStopped:$e,isImmediatePropagationStopped:$e,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ae,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ae,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ae,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},_.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},_.event.addProp),_.each({focus:"focusin",blur:"focusout"},function(e,t){function n(e){if(g.documentMode){var n=se.get(this,"handle"),o=_.event.fix(e);o.type="focusin"===e.type?"focus":"blur",o.isSimulated=!0,n(e),o.target===o.currentTarget&&n(o)}else _.event.simulate(t,e.target,_.event.fix(e))}_.event.special[e]={setup:function(){var o;if(Me(this,e,!0),!g.documentMode)return!1;(o=se.get(this,t))||this.addEventListener(t,n),se.set(this,t,(o||0)+1)},trigger:function(){return Me(this,e),!0},teardown:function(){var e;if(!g.documentMode)return!1;(e=se.get(this,t)-1)?se.set(this,t,e):(this.removeEventListener(t,n),se.remove(this,t))},_default:function(t){return se.get(t.target,e)},delegateType:t},_.event.special[t]={setup:function(){var o=this.ownerDocument||this.document||this,s=g.documentMode?this:o,i=se.get(s,t);i||(g.documentMode?this.addEventListener(t,n):o.addEventListener(e,n,!0)),se.set(s,t,(i||0)+1)},teardown:function(){var o=this.ownerDocument||this.document||this,s=g.documentMode?this:o,i=se.get(s,t)-1;i?se.set(s,t,i):(g.documentMode?this.removeEventListener(t,n):o.removeEventListener(e,n,!0),se.remove(s,t))}}}),_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){_.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,o=e.relatedTarget,s=e.handleObj;return o&&(o===this||_.contains(this,o))||(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),_.fn.extend({on:function(e,t,n,o){return De(this,e,t,n,o)},one:function(e,t,n,o){return De(this,e,t,n,o,1)},off:function(e,t,n){var o,s;if(e&&e.preventDefault&&e.handleObj)return o=e.handleObj,_(e.delegateTarget).off(o.namespace?o.origType+"."+o.namespace:o.origType,o.selector,o.handler),this;if("object"==typeof e){for(s in e)this.off(s,t,e[s]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=$e),this.each(function(){_.event.remove(this,e,n,t)})}});var Pe=/<script|<style|<link/i,Be=/checked\s*(?:[^=]|=\s*.checked.)/i,qe=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Oe(e,t){return C(e,"table")&&C(11!==t.nodeType?t:t.firstChild,"tr")&&_(e).children("tbody")[0]||e}function Ne(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Re(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Fe(e,t){var n,o,s,i,a,r;if(1===t.nodeType){if(se.hasData(e)&&(r=se.get(e).events))for(s in se.remove(t,"handle events"),r)for(n=0,o=r[s].length;n<o;n++)_.event.add(t,s,r[s][n]);ie.hasData(e)&&(i=ie.access(e),a=_.extend({},i),ie.set(t,a))}}function He(e,t,n,o){t=i(t);var s,a,r,c,l,d,u=0,m=e.length,f=m-1,g=t[0],v=p(g);if(v||1<m&&"string"==typeof g&&!h.checkClone&&Be.test(g))return e.each(function(s){var i=e.eq(s);v&&(t[0]=g.call(this,s,i.html())),He(i,t,n,o)});if(m&&(a=(s=ke(t,e[0].ownerDocument,!1,e,o)).firstChild,1===s.childNodes.length&&(s=a),a||o)){for(c=(r=_.map(Te(s,"script"),Ne)).length;u<m;u++)l=s,u!==f&&(l=_.clone(l,!0,!0),c&&_.merge(r,Te(l,"script"))),n.call(e[u],l,u);if(c)for(d=r[r.length-1].ownerDocument,_.map(r,Re),u=0;u<c;u++)l=r[u],Ee.test(l.type||"")&&!se.access(l,"globalEval")&&_.contains(d,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?_._evalUrl&&!l.noModule&&_._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},d):y(l.textContent.replace(qe,""),l,d))}return e}function je(e,t,n){for(var o,s=t?_.filter(t,e):e,i=0;null!=(o=s[i]);i++)n||1!==o.nodeType||_.cleanData(Te(o)),o.parentNode&&(n&&he(o)&&xe(Te(o,"script")),o.parentNode.removeChild(o));return e}_.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var o,s,i,a,r,c,l,d=e.cloneNode(!0),u=he(e);if(!(h.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||_.isXMLDoc(e)))for(a=Te(d),o=0,s=(i=Te(e)).length;o<s;o++)r=i[o],"input"===(l=(c=a[o]).nodeName.toLowerCase())&&Se.test(r.type)?c.checked=r.checked:"input"!==l&&"textarea"!==l||(c.defaultValue=r.defaultValue);if(t)if(n)for(i=i||Te(e),a=a||Te(d),o=0,s=i.length;o<s;o++)Fe(i[o],a[o]);else Fe(e,d);return 0<(a=Te(d,"script")).length&&xe(a,!u&&Te(e,"script")),d},cleanData:function(e){for(var t,n,o,s=_.event.special,i=0;void 0!==(n=e[i]);i++)if(ne(n)){if(t=n[se.expando]){if(t.events)for(o in t.events)s[o]?_.event.remove(n,o):_.removeEvent(n,o,t.handle);n[se.expando]=void 0}n[ie.expando]&&(n[ie.expando]=void 0)}}}),_.fn.extend({detach:function(e){return je(this,e,!0)},remove:function(e){return je(this,e)},text:function(e){return J(this,function(e){return void 0===e?_.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Oe(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Oe(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(_.cleanData(Te(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return _.clone(this,e,t)})},html:function(e){return J(this,function(e){var t=this[0]||{},n=0,o=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Pe.test(e)&&!Ce[(_e.exec(e)||["",""])[1].toLowerCase()]){e=_.htmlPrefilter(e);try{for(;n<o;n++)1===(t=this[n]||{}).nodeType&&(_.cleanData(Te(t,!1)),t.innerHTML=e);t=0}catch(s){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return He(this,arguments,function(t){var n=this.parentNode;_.inArray(this,e)<0&&(_.cleanData(Te(this)),n&&n.replaceChild(t,this))},e)}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){_.fn[e]=function(e){for(var n,o=[],s=_(e),i=s.length-1,r=0;r<=i;r++)n=r===i?this:this.clone(!0),_(s[r])[t](n),a.apply(o,n.get());return this.pushStack(o)}});var ze=new RegExp("^("+le+")(?!px)[a-z%]+$","i"),We=/^--/,Ue=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Ye=function(e,t,n){var o,s,i={};for(s in t)i[s]=e.style[s],e.style[s]=t[s];for(s in o=n.call(e),t)e.style[s]=i[s];return o},Xe=new RegExp(ue.join("|"),"i");function Ve(e,t,n){var o,s,i,a,r=We.test(t),c=e.style;return(n=n||Ue(e))&&(a=n.getPropertyValue(t)||n[t],r&&a&&(a=a.replace(I,"$1")||void 0),""!==a||he(e)||(a=_.style(e,t)),!h.pixelBoxStyles()&&ze.test(a)&&Xe.test(t)&&(o=c.width,s=c.minWidth,i=c.maxWidth,c.minWidth=c.maxWidth=c.width=a,a=n.width,c.width=o,c.minWidth=s,c.maxWidth=i)),void 0!==a?a+"":a}function Ge(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function t(){if(d){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",me.appendChild(l).appendChild(d);var t=e.getComputedStyle(d);o="1%"!==t.top,c=12===n(t.marginLeft),d.style.right="60%",a=36===n(t.right),s=36===n(t.width),d.style.position="absolute",i=12===n(d.offsetWidth/3),me.removeChild(l),d=null}}function n(e){return Math.round(parseFloat(e))}var o,s,i,a,r,c,l=g.createElement("div"),d=g.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",h.clearCloneStyle="content-box"===d.style.backgroundClip,_.extend(h,{boxSizingReliable:function(){return t(),s},pixelBoxStyles:function(){return t(),a},pixelPosition:function(){return t(),o},reliableMarginLeft:function(){return t(),c},scrollboxSize:function(){return t(),i},reliableTrDimensions:function(){var t,n,o,s;return null==r&&(t=g.createElement("table"),n=g.createElement("tr"),o=g.createElement("div"),t.style.cssText="position:absolute;left:-11111px;border-collapse:separate",n.style.cssText="box-sizing:content-box;border:1px solid",n.style.height="1px",o.style.height="9px",o.style.display="block",me.appendChild(t).appendChild(n).appendChild(o),s=e.getComputedStyle(n),r=parseInt(s.height,10)+parseInt(s.borderTopWidth,10)+parseInt(s.borderBottomWidth,10)===n.offsetHeight,me.removeChild(t)),r}}))}();var Ke=["Webkit","Moz","ms"],Je=g.createElement("div").style,Qe={};function Ze(e){return _.cssProps[e]||Qe[e]||(e in Je?e:Qe[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=Ke.length;n--;)if((e=Ke[n]+t)in Je)return e}(e)||e)}var et=/^(none|table(?!-c[ea]).+)/,tt={position:"absolute",visibility:"hidden",display:"block"},nt={letterSpacing:"0",fontWeight:"400"};function ot(e,t,n){var o=de.exec(t);return o?Math.max(0,o[2]-(n||0))+(o[3]||"px"):t}function st(e,t,n,o,s,i){var a="width"===t?1:0,r=0,c=0,l=0;if(n===(o?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(l+=_.css(e,n+ue[a],!0,s)),o?("content"===n&&(c-=_.css(e,"padding"+ue[a],!0,s)),"margin"!==n&&(c-=_.css(e,"border"+ue[a]+"Width",!0,s))):(c+=_.css(e,"padding"+ue[a],!0,s),"padding"!==n?c+=_.css(e,"border"+ue[a]+"Width",!0,s):r+=_.css(e,"border"+ue[a]+"Width",!0,s));return!o&&0<=i&&(c+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-i-c-r-.5))||0),c+l}function it(e,t,n){var o=Ue(e),s=(!h.boxSizingReliable()||n)&&"border-box"===_.css(e,"boxSizing",!1,o),i=s,a=Ve(e,t,o),r="offset"+t[0].toUpperCase()+t.slice(1);if(ze.test(a)){if(!n)return a;a="auto"}return(!h.boxSizingReliable()&&s||!h.reliableTrDimensions()&&C(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===_.css(e,"display",!1,o))&&e.getClientRects().length&&(s="border-box"===_.css(e,"boxSizing",!1,o),(i=r in e)&&(a=e[r])),(a=parseFloat(a)||0)+st(e,t,n||(s?"border":"content"),i,o,a)+"px"}function at(e,t,n,o,s){return new at.prototype.init(e,t,n,o,s)}_.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ve(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,o){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,i,a,r=te(t),c=We.test(t),l=e.style;if(c||(t=Ze(r)),a=_.cssHooks[t]||_.cssHooks[r],void 0===n)return a&&"get"in a&&void 0!==(s=a.get(e,!1,o))?s:l[t];"string"==(i=typeof n)&&(s=de.exec(n))&&s[1]&&(n=ge(e,t,s),i="number"),null!=n&&n==n&&("number"!==i||c||(n+=s&&s[3]||(_.cssNumber[r]?"":"px")),h.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,o))||(c?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,o){var s,i,a,r=te(t);return We.test(t)||(t=Ze(r)),(a=_.cssHooks[t]||_.cssHooks[r])&&"get"in a&&(s=a.get(e,!0,n)),void 0===s&&(s=Ve(e,t,o)),"normal"===s&&t in nt&&(s=nt[t]),""===n||n?(i=parseFloat(s),!0===n||isFinite(i)?i||0:s):s}}),_.each(["height","width"],function(e,t){_.cssHooks[t]={get:function(e,n,o){if(n)return!et.test(_.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?it(e,t,o):Ye(e,tt,function(){return it(e,t,o)})},set:function(e,n,o){var s,i=Ue(e),a=!h.scrollboxSize()&&"absolute"===i.position,r=(a||o)&&"border-box"===_.css(e,"boxSizing",!1,i),c=o?st(e,t,o,r,i):0;return r&&a&&(c-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(i[t])-st(e,t,"border",!1,i)-.5)),c&&(s=de.exec(n))&&"px"!==(s[3]||"px")&&(e.style[t]=n,n=_.css(e,t)),ot(0,n,c)}}}),_.cssHooks.marginLeft=Ge(h.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ve(e,"marginLeft"))||e.getBoundingClientRect().left-Ye(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),_.each({margin:"",padding:"",border:"Width"},function(e,t){_.cssHooks[e+t]={expand:function(n){for(var o=0,s={},i="string"==typeof n?n.split(" "):[n];o<4;o++)s[e+ue[o]+t]=i[o]||i[o-2]||i[0];return s}},"margin"!==e&&(_.cssHooks[e+t].set=ot)}),_.fn.extend({css:function(e,t){return J(this,function(e,t,n){var o,s,i={},a=0;if(Array.isArray(t)){for(o=Ue(e),s=t.length;a<s;a++)i[t[a]]=_.css(e,t[a],!1,o);return i}return void 0!==n?_.style(e,t,n):_.css(e,t)},e,t,1<arguments.length)}}),((_.Tween=at).prototype={constructor:at,init:function(e,t,n,o,s,i){this.elem=e,this.prop=n,this.easing=s||_.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=o,this.unit=i||(_.cssNumber[n]?"":"px")},cur:function(){var e=at.propHooks[this.prop];return e&&e.get?e.get(this):at.propHooks._default.get(this)},run:function(e){var t,n=at.propHooks[this.prop];return this.options.duration?this.pos=t=_.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):at.propHooks._default.set(this),this}}).init.prototype=at.prototype,(at.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=_.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){_.fx.step[e.prop]?_.fx.step[e.prop](e):1!==e.elem.nodeType||!_.cssHooks[e.prop]&&null==e.elem.style[Ze(e.prop)]?e.elem[e.prop]=e.now:_.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=at.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},_.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},_.fx=at.prototype.init,_.fx.step={};var rt,ct,lt,dt,ut=/^(?:toggle|show|hide)$/,mt=/queueHooks$/;function ht(){ct&&(!1===g.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(ht):e.setTimeout(ht,_.fx.interval),_.fx.tick())}function pt(){return e.setTimeout(function(){rt=void 0}),rt=Date.now()}function ft(e,t){var n,o=0,s={height:e};for(t=t?1:0;o<4;o+=2-t)s["margin"+(n=ue[o])]=s["padding"+n]=e;return t&&(s.opacity=s.width=e),s}function gt(e,t,n){for(var o,s=(vt.tweeners[t]||[]).concat(vt.tweeners["*"]),i=0,a=s.length;i<a;i++)if(o=s[i].call(n,t,e))return o}function vt(e,t,n){var o,s,i=0,a=vt.prefilters.length,r=_.Deferred().always(function(){delete c.elem}),c=function(){if(s)return!1;for(var t=rt||pt(),n=Math.max(0,l.startTime+l.duration-t),o=1-(n/l.duration||0),i=0,a=l.tweens.length;i<a;i++)l.tweens[i].run(o);return r.notifyWith(e,[l,o,n]),o<1&&a?n:(a||r.notifyWith(e,[l,1,0]),r.resolveWith(e,[l]),!1)},l=r.promise({elem:e,props:_.extend({},t),opts:_.extend(!0,{specialEasing:{},easing:_.easing._default},n),originalProperties:t,originalOptions:n,startTime:rt||pt(),duration:n.duration,tweens:[],createTween:function(t,n){var o=_.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(o),o},stop:function(t){var n=0,o=t?l.tweens.length:0;if(s)return this;for(s=!0;n<o;n++)l.tweens[n].run(1);return t?(r.notifyWith(e,[l,1,0]),r.resolveWith(e,[l,t])):r.rejectWith(e,[l,t]),this}}),d=l.props;for(function(e,t){var n,o,s,i,a;for(n in e)if(s=t[o=te(n)],i=e[n],Array.isArray(i)&&(s=i[1],i=e[n]=i[0]),n!==o&&(e[o]=i,delete e[n]),(a=_.cssHooks[o])&&"expand"in a)for(n in i=a.expand(i),delete e[o],i)n in e||(e[n]=i[n],t[n]=s);else t[o]=s}(d,l.opts.specialEasing);i<a;i++)if(o=vt.prefilters[i].call(l,e,d,l.opts))return p(o.stop)&&(_._queueHooks(l.elem,l.opts.queue).stop=o.stop.bind(o)),o;return _.map(d,gt,l),p(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),_.fx.timer(_.extend(c,{elem:e,anim:l,queue:l.opts.queue})),l}_.Animation=_.extend(vt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ge(n.elem,e,de.exec(t),n),n}]},tweener:function(e,t){p(e)?(t=e,e=["*"]):e=e.match(W);for(var n,o=0,s=e.length;o<s;o++)n=e[o],vt.tweeners[n]=vt.tweeners[n]||[],vt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var o,s,i,a,r,c,l,d,u="width"in t||"height"in t,m=this,h={},p=e.style,f=e.nodeType&&fe(e),g=se.get(e,"fxshow");for(o in n.queue||(null==(a=_._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,r=a.empty.fire,a.empty.fire=function(){a.unqueued||r()}),a.unqueued++,m.always(function(){m.always(function(){a.unqueued--,_.queue(e,"fx").length||a.empty.fire()})})),t)if(s=t[o],ut.test(s)){if(delete t[o],i=i||"toggle"===s,s===(f?"hide":"show")){if("show"!==s||!g||void 0===g[o])continue;f=!0}h[o]=g&&g[o]||_.style(e,o)}if((c=!_.isEmptyObject(t))||!_.isEmptyObject(h))for(o in u&&1===e.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(l=g&&g.display)&&(l=se.get(e,"display")),"none"===(d=_.css(e,"display"))&&(l?d=l:(ye([e],!0),l=e.style.display||l,d=_.css(e,"display"),ye([e]))),("inline"===d||"inline-block"===d&&null!=l)&&"none"===_.css(e,"float")&&(c||(m.done(function(){p.display=l}),null==l&&(d=p.display,l="none"===d?"":d)),p.display="inline-block")),n.overflow&&(p.overflow="hidden",m.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]})),c=!1,h)c||(g?"hidden"in g&&(f=g.hidden):g=se.access(e,"fxshow",{display:l}),i&&(g.hidden=!f),f&&ye([e],!0),m.done(function(){for(o in f||ye([e]),se.remove(e,"fxshow"),h)_.style(e,o,h[o])})),c=gt(f?g[o]:0,o,m),o in g||(g[o]=c.start,f&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?vt.prefilters.unshift(e):vt.prefilters.push(e)}}),_.speed=function(e,t,n){var o=e&&"object"==typeof e?_.extend({},e):{complete:n||!n&&t||p(e)&&e,duration:e,easing:n&&t||t&&!p(t)&&t};return _.fx.off?o.duration=0:"number"!=typeof o.duration&&(o.duration in _.fx.speeds?o.duration=_.fx.speeds[o.duration]:o.duration=_.fx.speeds._default),null!=o.queue&&!0!==o.queue||(o.queue="fx"),o.old=o.complete,o.complete=function(){p(o.old)&&o.old.call(this),o.queue&&_.dequeue(this,o.queue)},o},_.fn.extend({fadeTo:function(e,t,n,o){return this.filter(fe).css("opacity",0).show().end().animate({opacity:t},e,n,o)},animate:function(e,t,n,o){var s=_.isEmptyObject(e),i=_.speed(t,n,o),a=function(){var t=vt(this,_.extend({},e),i);(s||se.get(this,"finish"))&&t.stop(!0)};return a.finish=a,s||!1===i.queue?this.each(a):this.queue(i.queue,a)},stop:function(e,t,n){var o=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each(function(){var t=!0,s=null!=e&&e+"queueHooks",i=_.timers,a=se.get(this);if(s)a[s]&&a[s].stop&&o(a[s]);else for(s in a)a[s]&&a[s].stop&&mt.test(s)&&o(a[s]);for(s=i.length;s--;)i[s].elem!==this||null!=e&&i[s].queue!==e||(i[s].anim.stop(n),t=!1,i.splice(s,1));!t&&n||_.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=se.get(this),o=n[e+"queue"],s=n[e+"queueHooks"],i=_.timers,a=o?o.length:0;for(n.finish=!0,_.queue(this,e,[]),s&&s.stop&&s.stop.call(this,!0),t=i.length;t--;)i[t].elem===this&&i[t].queue===e&&(i[t].anim.stop(!0),i.splice(t,1));for(t=0;t<a;t++)o[t]&&o[t].finish&&o[t].finish.call(this);delete n.finish})}}),_.each(["toggle","show","hide"],function(e,t){var n=_.fn[t];_.fn[t]=function(e,o,s){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ft(t,!0),e,o,s)}}),_.each({slideDown:ft("show"),slideUp:ft("hide"),slideToggle:ft("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){_.fn[e]=function(e,n,o){return this.animate(t,e,n,o)}}),_.timers=[],_.fx.tick=function(){var e,t=0,n=_.timers;for(rt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||_.fx.stop(),rt=void 0},_.fx.timer=function(e){_.timers.push(e),_.fx.start()},_.fx.interval=13,_.fx.start=function(){ct||(ct=!0,ht())},_.fx.stop=function(){ct=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(t,n){return t=_.fx&&_.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(n,o){var s=e.setTimeout(n,t);o.stop=function(){e.clearTimeout(s)}})},lt=g.createElement("input"),dt=g.createElement("select").appendChild(g.createElement("option")),lt.type="checkbox",h.checkOn=""!==lt.value,h.optSelected=dt.selected,(lt=g.createElement("input")).value="t",lt.type="radio",h.radioValue="t"===lt.value;var yt,bt=_.expr.attrHandle;_.fn.extend({attr:function(e,t){return J(this,_.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){_.removeAttr(this,e)})}}),_.extend({attr:function(e,t,n){var o,s,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return void 0===e.getAttribute?_.prop(e,t,n):(1===i&&_.isXMLDoc(e)||(s=_.attrHooks[t.toLowerCase()]||(_.expr.match.bool.test(t)?yt:void 0)),void 0!==n?null===n?void _.removeAttr(e,t):s&&"set"in s&&void 0!==(o=s.set(e,n,t))?o:(e.setAttribute(t,n+""),n):s&&"get"in s&&null!==(o=s.get(e,t))?o:null==(o=_.find.attr(e,t))?void 0:o)},attrHooks:{type:{set:function(e,t){if(!h.radioValue&&"radio"===t&&C(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,o=0,s=t&&t.match(W);if(s&&1===e.nodeType)for(;n=s[o++];)e.removeAttribute(n)}}),yt={set:function(e,t,n){return!1===t?_.removeAttr(e,n):e.setAttribute(n,n),n}},_.each(_.expr.match.bool.source.match(/\w+/g),function(e,t){var n=bt[t]||_.find.attr;bt[t]=function(e,t,o){var s,i,a=t.toLowerCase();return o||(i=bt[a],bt[a]=s,s=null!=n(e,t,o)?a:null,bt[a]=i),s}});var wt=/^(?:input|select|textarea|button)$/i,St=/^(?:a|area)$/i;function _t(e){return(e.match(W)||[]).join(" ")}function Et(e){return e.getAttribute&&e.getAttribute("class")||""}function Ct(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(W)||[]}_.fn.extend({prop:function(e,t){return J(this,_.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[_.propFix[e]||e]})}}),_.extend({prop:function(e,t,n){var o,s,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return 1===i&&_.isXMLDoc(e)||(t=_.propFix[t]||t,s=_.propHooks[t]),void 0!==n?s&&"set"in s&&void 0!==(o=s.set(e,n,t))?o:e[t]=n:s&&"get"in s&&null!==(o=s.get(e,t))?o:e[t]},propHooks:{tabIndex:{get:function(e){var t=_.find.attr(e,"tabindex");return t?parseInt(t,10):wt.test(e.nodeName)||St.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),h.optSelected||(_.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){_.propFix[this.toLowerCase()]=this}),_.fn.extend({addClass:function(e){var t,n,o,s,i,a;return p(e)?this.each(function(t){_(this).addClass(e.call(this,t,Et(this)))}):(t=Ct(e)).length?this.each(function(){if(o=Et(this),n=1===this.nodeType&&" "+_t(o)+" "){for(i=0;i<t.length;i++)s=t[i],n.indexOf(" "+s+" ")<0&&(n+=s+" ");a=_t(n),o!==a&&this.setAttribute("class",a)}}):this},removeClass:function(e){var t,n,o,s,i,a;return p(e)?this.each(function(t){_(this).removeClass(e.call(this,t,Et(this)))}):arguments.length?(t=Ct(e)).length?this.each(function(){if(o=Et(this),n=1===this.nodeType&&" "+_t(o)+" "){for(i=0;i<t.length;i++)for(s=t[i];-1<n.indexOf(" "+s+" ");)n=n.replace(" "+s+" "," ");a=_t(n),o!==a&&this.setAttribute("class",a)}}):this:this.attr("class","")},toggleClass:function(e,t){var n,o,s,i,a=typeof e,r="string"===a||Array.isArray(e);return p(e)?this.each(function(n){_(this).toggleClass(e.call(this,n,Et(this),t),t)}):"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):(n=Ct(e),this.each(function(){if(r)for(i=_(this),s=0;s<n.length;s++)o=n[s],i.hasClass(o)?i.removeClass(o):i.addClass(o);else void 0!==e&&"boolean"!==a||((o=Et(this))&&se.set(this,"__className__",o),this.setAttribute&&this.setAttribute("class",o||!1===e?"":se.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,o=0;for(t=" "+e+" ";n=this[o++];)if(1===n.nodeType&&-1<(" "+_t(Et(n))+" ").indexOf(t))return!0;return!1}});var Tt=/\r/g;_.fn.extend({val:function(e){var t,n,o,s=this[0];return arguments.length?(o=p(e),this.each(function(n){var s;1===this.nodeType&&(null==(s=o?e.call(this,n,_(this).val()):e)?s="":"number"==typeof s?s+="":Array.isArray(s)&&(s=_.map(s,function(e){return null==e?"":e+""})),(t=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,s,"value")||(this.value=s))})):s?(t=_.valHooks[s.type]||_.valHooks[s.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(s,"value"))?n:"string"==typeof(n=s.value)?n.replace(Tt,""):null==n?"":n:void 0}}),_.extend({valHooks:{option:{get:function(e){var t=_.find.attr(e,"value");return null!=t?t:_t(_.text(e))}},select:{get:function(e){var t,n,o,s=e.options,i=e.selectedIndex,a="select-one"===e.type,r=a?null:[],c=a?i+1:s.length;for(o=i<0?c:a?i:0;o<c;o++)if(((n=s[o]).selected||o===i)&&!n.disabled&&(!n.parentNode.disabled||!C(n.parentNode,"optgroup"))){if(t=_(n).val(),a)return t;r.push(t)}return r},set:function(e,t){for(var n,o,s=e.options,i=_.makeArray(t),a=s.length;a--;)((o=s[a]).selected=-1<_.inArray(_.valHooks.option.get(o),i))&&(n=!0);return n||(e.selectedIndex=-1),i}}}}),_.each(["radio","checkbox"],function(){_.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<_.inArray(_(e).val(),t)}},h.checkOn||(_.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var xt=e.location,Lt={guid:Date.now()},kt=/\?/;_.parseXML=function(t){var n,o;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(s){}return o=n&&n.getElementsByTagName("parsererror")[0],n&&!o||_.error("Invalid XML: "+(o?_.map(o.childNodes,function(e){return e.textContent}).join("\n"):t)),n};var It=/^(?:focusinfocus|focusoutblur)$/,At=function(e){e.stopPropagation()};_.extend(_.event,{trigger:function(t,n,o,s){var i,a,r,c,l,u,m,h,v=[o||g],y=d.call(t,"type")?t.type:t,b=d.call(t,"namespace")?t.namespace.split("."):[];if(a=h=r=o=o||g,3!==o.nodeType&&8!==o.nodeType&&!It.test(y+_.event.triggered)&&(-1<y.indexOf(".")&&(y=(b=y.split(".")).shift(),b.sort()),l=y.indexOf(":")<0&&"on"+y,(t=t[_.expando]?t:new _.Event(y,"object"==typeof t&&t)).isTrigger=s?2:3,t.namespace=b.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=o),n=null==n?[t]:_.makeArray(n,[t]),m=_.event.special[y]||{},s||!m.trigger||!1!==m.trigger.apply(o,n))){if(!s&&!m.noBubble&&!f(o)){for(c=m.delegateType||y,It.test(c+y)||(a=a.parentNode);a;a=a.parentNode)v.push(a),r=a;r===(o.ownerDocument||g)&&v.push(r.defaultView||r.parentWindow||e)}for(i=0;(a=v[i++])&&!t.isPropagationStopped();)h=a,t.type=1<i?c:m.bindType||y,(u=(se.get(a,"events")||Object.create(null))[t.type]&&se.get(a,"handle"))&&u.apply(a,n),(u=l&&a[l])&&u.apply&&ne(a)&&(t.result=u.apply(a,n),!1===t.result&&t.preventDefault());return t.type=y,s||t.isDefaultPrevented()||m._default&&!1!==m._default.apply(v.pop(),n)||!ne(o)||l&&p(o[y])&&!f(o)&&((r=o[l])&&(o[l]=null),_.event.triggered=y,t.isPropagationStopped()&&h.addEventListener(y,At),o[y](),t.isPropagationStopped()&&h.removeEventListener(y,At),_.event.triggered=void 0,r&&(o[l]=r)),t.result}},simulate:function(e,t,n){var o=_.extend(new _.Event,n,{type:e,isSimulated:!0});_.event.trigger(o,null,t)}}),_.fn.extend({trigger:function(e,t){return this.each(function(){_.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return _.event.trigger(e,t,n,!0)}});var $t=/\[\]$/,Dt=/\r?\n/g,Mt=/^(?:submit|button|image|reset|file)$/i,Pt=/^(?:input|select|textarea|keygen)/i;function Bt(e,t,n,o){var s;if(Array.isArray(t))_.each(t,function(t,s){n||$t.test(e)?o(e,s):Bt(e+"["+("object"==typeof s&&null!=s?t:"")+"]",s,n,o)});else if(n||"object"!==b(t))o(e,t);else for(s in t)Bt(e+"["+s+"]",t[s],n,o)}_.param=function(e,t){var n,o=[],s=function(e,t){var n=p(t)?t():t;o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!_.isPlainObject(e))_.each(e,function(){s(this.name,this.value)});else for(n in e)Bt(n,e[n],t,s);return o.join("&")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=_.prop(this,"elements");return e?_.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!_(this).is(":disabled")&&Pt.test(this.nodeName)&&!Mt.test(e)&&(this.checked||!Se.test(e))}).map(function(e,t){var n=_(this).val();return null==n?null:Array.isArray(n)?_.map(n,function(e){return{name:t.name,value:e.replace(Dt,"\r\n")}}):{name:t.name,value:n.replace(Dt,"\r\n")}}).get()}});var qt=/%20/g,Ot=/#.*$/,Nt=/([?&])_=[^&]*/,Rt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ft=/^(?:GET|HEAD)$/,Ht=/^\/\//,jt={},zt={},Wt="*/".concat("*"),Ut=g.createElement("a");function Yt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var o,s=0,i=t.toLowerCase().match(W)||[];if(p(n))for(;o=i[s++];)"+"===o[0]?(o=o.slice(1)||"*",(e[o]=e[o]||[]).unshift(n)):(e[o]=e[o]||[]).push(n)}}function Xt(e,t,n,o){var s={},i=e===zt;function a(r){var c;return s[r]=!0,_.each(e[r]||[],function(e,r){var l=r(t,n,o);return"string"!=typeof l||i||s[l]?i?!(c=l):void 0:(t.dataTypes.unshift(l),a(l),!1)}),c}return a(t.dataTypes[0])||!s["*"]&&a("*")}function Vt(e,t){var n,o,s=_.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((s[n]?e:o||(o={}))[n]=t[n]);return o&&_.extend(!0,e,o),e}Ut.href=xt.href,_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:xt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(xt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Wt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Vt(Vt(e,_.ajaxSettings),t):Vt(_.ajaxSettings,e)},ajaxPrefilter:Yt(jt),ajaxTransport:Yt(zt),ajax:function(t,n){"object"==typeof t&&(n=t,t=void 0),n=n||{};var o,s,i,a,r,c,l,d,u,m,h=_.ajaxSetup({},n),p=h.context||h,f=h.context&&(p.nodeType||p.jquery)?_(p):_.event,v=_.Deferred(),y=_.Callbacks("once memory"),b=h.statusCode||{},w={},S={},E="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(l){if(!a)for(a={};t=Rt.exec(i);)a[t[1].toLowerCase()+" "]=(a[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=a[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return l?i:null},setRequestHeader:function(e,t){return null==l&&(e=S[e.toLowerCase()]=S[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==l&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)C.always(e[C.status]);else for(t in e)b[t]=[b[t],e[t]];return this},abort:function(e){var t=e||E;return o&&o.abort(t),T(0,t),this}};if(v.promise(C),h.url=((t||h.url||xt.href)+"").replace(Ht,xt.protocol+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(W)||[""],null==h.crossDomain){c=g.createElement("a");try{c.href=h.url,c.href=c.href,h.crossDomain=Ut.protocol+"//"+Ut.host!=c.protocol+"//"+c.host}catch(x){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!=typeof h.data&&(h.data=_.param(h.data,h.traditional)),Xt(jt,h,n,C),l)return C;for(u in(d=_.event&&h.global)&&0==_.active++&&_.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Ft.test(h.type),s=h.url.replace(Ot,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(qt,"+")):(m=h.url.slice(s.length),h.data&&(h.processData||"string"==typeof h.data)&&(s+=(kt.test(s)?"&":"?")+h.data,delete h.data),!1===h.cache&&(s=s.replace(Nt,"$1"),m=(kt.test(s)?"&":"?")+"_="+Lt.guid+++m),h.url=s+m),h.ifModified&&(_.lastModified[s]&&C.setRequestHeader("If-Modified-Since",_.lastModified[s]),_.etag[s]&&C.setRequestHeader("If-None-Match",_.etag[s])),(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&C.setRequestHeader("Content-Type",h.contentType),C.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+Wt+"; q=0.01":""):h.accepts["*"]),h.headers)C.setRequestHeader(u,h.headers[u]);if(h.beforeSend&&(!1===h.beforeSend.call(p,C,h)||l))return C.abort();if(E="abort",y.add(h.complete),C.done(h.success),C.fail(h.error),o=Xt(zt,h,n,C)){if(C.readyState=1,d&&f.trigger("ajaxSend",[C,h]),l)return C;h.async&&0<h.timeout&&(r=e.setTimeout(function(){C.abort("timeout")},h.timeout));try{l=!1,o.send(w,T)}catch(x){if(l)throw x;T(-1,x)}}else T(-1,"No Transport");function T(t,n,a,c){var u,m,g,w,S,E=n;l||(l=!0,r&&e.clearTimeout(r),o=void 0,i=c||"",C.readyState=0<t?4:0,u=200<=t&&t<300||304===t,a&&(w=function(e,t,n){for(var o,s,i,a,r=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===o&&(o=e.mimeType||t.getResponseHeader("Content-Type"));if(o)for(s in r)if(r[s]&&r[s].test(o)){c.unshift(s);break}if(c[0]in n)i=c[0];else{for(s in n){if(!c[0]||e.converters[s+" "+c[0]]){i=s;break}a||(a=s)}i=i||a}if(i)return i!==c[0]&&c.unshift(i),n[i]}(h,C,a)),!u&&-1<_.inArray("script",h.dataTypes)&&_.inArray("json",h.dataTypes)<0&&(h.converters["text script"]=function(){}),w=function(e,t,n,o){var s,i,a,r,c,l={},d=e.dataTypes.slice();if(d[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(i=d.shift();i;)if(e.responseFields[i]&&(n[e.responseFields[i]]=t),!c&&o&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=i,i=d.shift())if("*"===i)i=c;else if("*"!==c&&c!==i){if(!(a=l[c+" "+i]||l["* "+i]))for(s in l)if((r=s.split(" "))[1]===i&&(a=l[c+" "+r[0]]||l["* "+r[0]])){!0===a?a=l[s]:!0!==l[s]&&(i=r[0],d.unshift(r[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(u){return{state:"parsererror",error:a?u:"No conversion from "+c+" to "+i}}}return{state:"success",data:t}}(h,w,C,u),u?(h.ifModified&&((S=C.getResponseHeader("Last-Modified"))&&(_.lastModified[s]=S),(S=C.getResponseHeader("etag"))&&(_.etag[s]=S)),204===t||"HEAD"===h.type?E="nocontent":304===t?E="notmodified":(E=w.state,m=w.data,u=!(g=w.error))):(g=E,!t&&E||(E="error",t<0&&(t=0))),C.status=t,C.statusText=(n||E)+"",u?v.resolveWith(p,[m,E,C]):v.rejectWith(p,[C,E,g]),C.statusCode(b),b=void 0,d&&f.trigger(u?"ajaxSuccess":"ajaxError",[C,h,u?m:g]),y.fireWith(p,[C,E]),d&&(f.trigger("ajaxComplete",[C,h]),--_.active||_.event.trigger("ajaxStop")))}return C},getJSON:function(e,t,n){return _.get(e,t,n,"json")},getScript:function(e,t){return _.get(e,void 0,t,"script")}}),_.each(["get","post"],function(e,t){_[t]=function(e,n,o,s){return p(n)&&(s=s||o,o=n,n=void 0),_.ajax(_.extend({url:e,type:t,dataType:s,data:n,success:o},_.isPlainObject(e)&&e))}}),_.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),_._evalUrl=function(e,t,n){return _.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){_.globalEval(e,t,n)}})},_.fn.extend({wrapAll:function(e){var t;return this[0]&&(p(e)&&(e=e.call(this[0])),t=_(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return p(e)?this.each(function(t){_(this).wrapInner(e.call(this,t))}):this.each(function(){var t=_(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=p(e);return this.each(function(n){_(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){_(this).replaceWith(this.childNodes)}),this}}),_.expr.pseudos.hidden=function(e){return!_.expr.pseudos.visible(e)},_.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},_.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(t){}};var Gt={0:200,1223:204},Kt=_.ajaxSettings.xhr();h.cors=!!Kt&&"withCredentials"in Kt,h.ajax=Kt=!!Kt,_.ajaxTransport(function(t){var n,o;if(h.cors||Kt&&!t.crossDomain)return{send:function(s,i){var a,r=t.xhr();if(r.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)r[a]=t.xhrFields[a];for(a in t.mimeType&&r.overrideMimeType&&r.overrideMimeType(t.mimeType),t.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest"),s)r.setRequestHeader(a,s[a]);n=function(e){return function(){n&&(n=o=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?i(0,"error"):i(r.status,r.statusText):i(Gt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=n(),o=r.onerror=r.ontimeout=n("error"),void 0!==r.onabort?r.onabort=o:r.onreadystatechange=function(){4===r.readyState&&e.setTimeout(function(){n&&o()})},n=n("abort");try{r.send(t.hasContent&&t.data||null)}catch(c){if(n)throw c}},abort:function(){n&&n()}}}),_.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return _.globalEval(e),e}}}),_.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),_.ajaxTransport("script",function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(o,s){t=_("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&s("error"===e.type?404:200,e.type)}),g.head.appendChild(t[0])},abort:function(){n&&n()}}});var Jt,Qt=[],Zt=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Qt.pop()||_.expando+"_"+Lt.guid++;return this[e]=!0,e}}),_.ajaxPrefilter("json jsonp",function(t,n,o){var s,i,a,r=!1!==t.jsonp&&(Zt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Zt.test(t.data)&&"data");if(r||"jsonp"===t.dataTypes[0])return s=t.jsonpCallback=p(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,r?t[r]=t[r].replace(Zt,"$1"+s):!1!==t.jsonp&&(t.url+=(kt.test(t.url)?"&":"?")+t.jsonp+"="+s),t.converters["script json"]=function(){return a||_.error(s+" was not called"),a[0]},t.dataTypes[0]="json",i=e[s],e[s]=function(){a=arguments},o.always(function(){void 0===i?_(e).removeProp(s):e[s]=i,t[s]&&(t.jsonpCallback=n.jsonpCallback,Qt.push(s)),a&&p(i)&&i(a[0]),a=i=void 0}),"script"}),h.createHTMLDocument=((Jt=g.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Jt.childNodes.length),_.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(h.createHTMLDocument?((o=(t=g.implementation.createHTMLDocument("")).createElement("base")).href=g.location.href,t.head.appendChild(o)):t=g),i=!n&&[],(s=O.exec(e))?[t.createElement(s[1])]:(s=ke([e],t,i),i&&i.length&&_(i).remove(),_.merge([],s.childNodes)));var o,s,i},_.fn.load=function(e,t,n){var o,s,i,a=this,r=e.indexOf(" ");return-1<r&&(o=_t(e.slice(r)),e=e.slice(0,r)),p(t)?(n=t,t=void 0):t&&"object"==typeof t&&(s="POST"),0<a.length&&_.ajax({url:e,type:s||"GET",dataType:"html",data:t}).done(function(e){i=arguments,a.html(o?_("<div>").append(_.parseHTML(e)).find(o):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,i||[e.responseText,t,e])})}),this},_.expr.pseudos.animated=function(e){return _.grep(_.timers,function(t){return e===t.elem}).length},_.offset={setOffset:function(e,t,n){var o,s,i,a,r,c,l=_.css(e,"position"),d=_(e),u={};"static"===l&&(e.style.position="relative"),r=d.offset(),i=_.css(e,"top"),c=_.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(i+c).indexOf("auto")?(a=(o=d.position()).top,s=o.left):(a=parseFloat(i)||0,s=parseFloat(c)||0),p(t)&&(t=t.call(e,n,_.extend({},r))),null!=t.top&&(u.top=t.top-r.top+a),null!=t.left&&(u.left=t.left-r.left+s),"using"in t?t.using.call(e,u):d.css(u)}},_.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){_.offset.setOffset(this,e,t)});var t,n,o=this[0];return o?o.getClientRects().length?(t=o.getBoundingClientRect(),n=o.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,o=this[0],s={top:0,left:0};if("fixed"===_.css(o,"position"))t=o.getBoundingClientRect();else{for(t=this.offset(),n=o.ownerDocument,e=o.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===_.css(e,"position");)e=e.parentNode;e&&e!==o&&1===e.nodeType&&((s=_(e).offset()).top+=_.css(e,"borderTopWidth",!0),s.left+=_.css(e,"borderLeftWidth",!0))}return{top:t.top-s.top-_.css(o,"marginTop",!0),left:t.left-s.left-_.css(o,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===_.css(e,"position");)e=e.offsetParent;return e||me})}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;_.fn[e]=function(o){return J(this,function(e,o,s){var i;if(f(e)?i=e:9===e.nodeType&&(i=e.defaultView),void 0===s)return i?i[t]:e[o];i?i.scrollTo(n?i.pageXOffset:s,n?s:i.pageYOffset):e[o]=s},e,o,arguments.length)}}),_.each(["top","left"],function(e,t){_.cssHooks[t]=Ge(h.pixelPosition,function(e,n){if(n)return n=Ve(e,t),ze.test(n)?_(e).position()[t]+"px":n})}),_.each({Height:"height",Width:"width"},function(e,t){_.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,o){_.fn[o]=function(s,i){var a=arguments.length&&(n||"boolean"!=typeof s),r=n||(!0===s||!0===i?"margin":"border");return J(this,function(t,n,s){var i;return f(t)?0===o.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===s?_.css(t,n,r):_.style(t,n,s,r)},t,a?s:void 0,a)}})}),_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){_.fn[t]=function(e){return this.on(t,e)}}),_.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,o){return this.on(t,e,n,o)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.on("mouseenter",e).on("mouseleave",t||e)}}),_.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){_.fn[t]=function(e,n){return 0<arguments.length?this.on(t,null,e,n):this.trigger(t)}});var en=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;_.proxy=function(e,t){var n,o,i;if("string"==typeof t&&(n=e[t],t=e,e=n),p(e))return o=s.call(arguments,2),(i=function(){return e.apply(t||this,o.concat(s.call(arguments)))}).guid=e.guid=e.guid||_.guid++,i},_.holdReady=function(e){e?_.readyWait++:_.ready(!0)},_.isArray=Array.isArray,_.parseJSON=JSON.parse,_.nodeName=C,_.isFunction=p,_.isWindow=f,_.camelCase=te,_.type=b,_.now=Date.now,_.isNumeric=function(e){var t=_.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},_.trim=function(e){return null==e?"":(e+"").replace(en,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return _});var tn=e.jQuery,nn=e.$;return _.noConflict=function(t){return e.$===_&&(e.$=nn),t&&e.jQuery===_&&(e.jQuery=tn),_},void 0===t&&(e.jQuery=e.$=_),_},"object"==typeof t&&"object"==typeof t.exports?t.exports=o.document?i(o,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return i(e)}:i(o),function(n,o){"object"==typeof e&&void 0!==t?o(e):"function"==typeof define&&define.amd?define(["exports"],o):o((n="undefined"!=typeof globalThis?globalThis:n||self).Popper={})}(void 0,function(e){function t(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function n(e){return e instanceof t(e).Element||e instanceof Element}function o(e){return e instanceof t(e).HTMLElement||e instanceof HTMLElement}function s(e){return"undefined"!=typeof ShadowRoot&&(e instanceof t(e).ShadowRoot||e instanceof ShadowRoot)}var i=Math.max,a=Math.min,r=Math.round;function c(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function l(){return!/^((?!chrome|android).)*safari/i.test(c())}function d(e,s,i){void 0===s&&(s=!1),void 0===i&&(i=!1);var a=e.getBoundingClientRect(),c=1,d=1;s&&o(e)&&(c=e.offsetWidth>0&&r(a.width)/e.offsetWidth||1,d=e.offsetHeight>0&&r(a.height)/e.offsetHeight||1);var u=(n(e)?t(e):window).visualViewport,m=!l()&&i,h=(a.left+(m&&u?u.offsetLeft:0))/c,p=(a.top+(m&&u?u.offsetTop:0))/d,f=a.width/c,g=a.height/d;return{width:f,height:g,top:p,right:h+f,bottom:p+g,left:h,x:h,y:p}}function u(e){var n=t(e);return{scrollLeft:n.pageXOffset,scrollTop:n.pageYOffset}}function m(e){return e?(e.nodeName||"").toLowerCase():null}function h(e){return((n(e)?e.ownerDocument:e.document)||window.document).documentElement}function p(e){return d(h(e)).left+u(e).scrollLeft}function f(e){return t(e).getComputedStyle(e)}function g(e){var t=f(e),n=t.overflow,o=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+s+o)}function v(e,n,s){void 0===s&&(s=!1);var i,a,c,l,f,v,y=o(n),b=o(n)&&(l=(c=n).getBoundingClientRect(),f=r(l.width)/c.offsetWidth||1,v=r(l.height)/c.offsetHeight||1,1!==f||1!==v),w=h(n),S=d(e,b,s),_={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(y||!y&&!s)&&(("body"!==m(n)||g(w))&&(_=(i=n)!==t(i)&&o(i)?{scrollLeft:(a=i).scrollLeft,scrollTop:a.scrollTop}:u(i)),o(n)?((E=d(n,!0)).x+=n.clientLeft,E.y+=n.clientTop):w&&(E.x=p(w))),{x:S.left+_.scrollLeft-E.x,y:S.top+_.scrollTop-E.y,width:S.width,height:S.height}}function y(e){var t=d(e),n=e.offsetWidth,o=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-o)<=1&&(o=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:o}}function b(e){return"html"===m(e)?e:e.assignedSlot||e.parentNode||(s(e)?e.host:null)||h(e)}function w(e){return["html","body","#document"].indexOf(m(e))>=0?e.ownerDocument.body:o(e)&&g(e)?e:w(b(e))}function S(e,n){var o;void 0===n&&(n=[]);var s=w(e),i=s===(null==(o=e.ownerDocument)?void 0:o.body),a=t(s),r=i?[a].concat(a.visualViewport||[],g(s)?s:[]):s,c=n.concat(r);return i?c:c.concat(S(b(r)))}function _(e){return["table","td","th"].indexOf(m(e))>=0}function E(e){return o(e)&&"fixed"!==f(e).position?e.offsetParent:null}function C(e){for(var n=t(e),i=E(e);i&&_(i)&&"static"===f(i).position;)i=E(i);return i&&("html"===m(i)||"body"===m(i)&&"static"===f(i).position)?n:i||function(e){var t=/firefox/i.test(c());if(/Trident/i.test(c())&&o(e)&&"fixed"===f(e).position)return null;var n=b(e);for(s(n)&&(n=n.host);o(n)&&["html","body"].indexOf(m(n))<0;){var i=f(n);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return n;n=n.parentNode}return null}(e)||n}var T="top",x="bottom",L="right",k="left",I="auto",A=[T,x,L,k],$="start",D="end",M="viewport",P="popper",B=A.reduce(function(e,t){return e.concat([t+"-"+$,t+"-"+D])},[]),q=[].concat(A,[I]).reduce(function(e,t){return e.concat([t,t+"-"+$,t+"-"+D])},[]),O=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function N(e){var t=new Map,n=new Set,o=[];function s(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!n.has(e)){var o=t.get(e);o&&s(o)}}),o.push(e)}return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){n.has(e.name)||s(e)}),o}function R(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&s(n)){var o=t;do{if(o&&e.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function F(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function H(e,o,s){return o===M?F(function(e,n){var o=t(e),s=h(e),i=o.visualViewport,a=s.clientWidth,r=s.clientHeight,c=0,d=0;if(i){a=i.width,r=i.height;var u=l();(u||!u&&"fixed"===n)&&(c=i.offsetLeft,d=i.offsetTop)}return{width:a,height:r,x:c+p(e),y:d}}(e,s)):n(o)?((r=d(a=o,!1,"fixed"===s)).top=r.top+a.clientTop,r.left=r.left+a.clientLeft,r.bottom=r.top+a.clientHeight,r.right=r.left+a.clientWidth,r.width=a.clientWidth,r.height=a.clientHeight,r.x=r.left,r.y=r.top,r):F(function(e){var t,n=h(e),o=u(e),s=null==(t=e.ownerDocument)?void 0:t.body,a=i(n.scrollWidth,n.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),r=i(n.scrollHeight,n.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),c=-o.scrollLeft+p(e),l=-o.scrollTop;return"rtl"===f(s||n).direction&&(c+=i(n.clientWidth,s?s.clientWidth:0)-a),{width:a,height:r,x:c,y:l}}(h(e)));var a,r}function j(e){return e.split("-")[0]}function z(e){return e.split("-")[1]}function W(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function U(e){var t,n=e.reference,o=e.element,s=e.placement,i=s?j(s):null,a=s?z(s):null,r=n.x+n.width/2-o.width/2,c=n.y+n.height/2-o.height/2;switch(i){case T:t={x:r,y:n.y-o.height};break;case x:t={x:r,y:n.y+n.height};break;case L:t={x:n.x+n.width,y:c};break;case k:t={x:n.x-o.width,y:c};break;default:t={x:n.x,y:n.y}}var l=i?W(i):null;if(null!=l){var d="y"===l?"height":"width";switch(a){case $:t[l]=t[l]-(n[d]/2-o[d]/2);break;case D:t[l]=t[l]+(n[d]/2-o[d]/2)}}return t}function Y(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function X(e,t){return t.reduce(function(t,n){return t[n]=e,t},{})}function V(e,t){void 0===t&&(t={});var s=t,r=s.placement,c=void 0===r?e.placement:r,l=s.strategy,u=void 0===l?e.strategy:l,p=s.boundary,g=void 0===p?"clippingParents":p,v=s.rootBoundary,y=void 0===v?M:v,w=s.elementContext,_=void 0===w?P:w,E=s.altBoundary,k=void 0!==E&&E,I=s.padding,$=void 0===I?0:I,D=Y("number"!=typeof $?$:X($,A)),B=_===P?"reference":P,q=e.rects.popper,O=e.elements[k?B:_],N=function(e,t,s,r){var c,l,d,u="clippingParents"===t?(l=S(b(c=e)),n(d=["absolute","fixed"].indexOf(f(c).position)>=0&&o(c)?C(c):c)?l.filter(function(e){return n(e)&&R(e,d)&&"body"!==m(e)}):[]):[].concat(t),h=[].concat(u,[s]),p=h[0],g=h.reduce(function(t,n){var o=H(e,n,r);return t.top=i(o.top,t.top),t.right=a(o.right,t.right),t.bottom=a(o.bottom,t.bottom),t.left=i(o.left,t.left),t},H(e,p,r));return g.width=g.right-g.left,g.height=g.bottom-g.top,g.x=g.left,g.y=g.top,g}(n(O)?O:O.contextElement||h(e.elements.popper),g,y,u),j=d(e.elements.reference),z=U({reference:j,element:q,placement:c}),W=F(Object.assign({},q,z)),V=_===P?W:j,G={top:N.top-V.top+D.top,bottom:V.bottom-N.bottom+D.bottom,left:N.left-V.left+D.left,right:V.right-N.right+D.right},K=e.modifiersData.offset;if(_===P&&K){var J=K[c];Object.keys(G).forEach(function(e){var t=[L,x].indexOf(e)>=0?1:-1,n=[T,x].indexOf(e)>=0?"y":"x";G[e]+=J[n]*t})}return G}var G={placement:"bottom",modifiers:[],strategy:"absolute"};function K(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}function J(e){void 0===e&&(e={});var t=e,o=t.defaultModifiers,s=void 0===o?[]:o,i=t.defaultOptions,a=void 0===i?G:i;return function(e,t,o){void 0===o&&(o=a);var i,r,c={placement:"bottom",orderedModifiers:[],options:Object.assign({},G,a),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],d=!1,u={state:c,setOptions:function(o){var i="function"==typeof o?o(c.options):o;m(),c.options=Object.assign({},a,c.options,i),c.scrollParents={reference:n(e)?S(e):e.contextElement?S(e.contextElement):[],popper:S(t)};var r,d,h,p,f=(r=[].concat(s,c.options.modifiers),d=r.reduce(function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e},{}),h=Object.keys(d).map(function(e){return d[e]}),p=N(h),O.reduce(function(e,t){return e.concat(p.filter(function(e){return e.phase===t}))},[]));return c.orderedModifiers=f.filter(function(e){return e.enabled}),c.orderedModifiers.forEach(function(e){var t=e.name,n=e.options,o=void 0===n?{}:n,s=e.effect;if("function"==typeof s){var i=s({state:c,name:t,instance:u,options:o});l.push(i||function(){})}}),u.update()},forceUpdate:function(){if(!d){var e=c.elements,t=e.reference,n=e.popper;if(K(t,n)){c.rects={reference:v(t,C(n),"fixed"===c.options.strategy),popper:y(n)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(e){return c.modifiersData[e.name]=Object.assign({},e.data)});for(var o=0;o<c.orderedModifiers.length;o++)if(!0!==c.reset){var s=c.orderedModifiers[o],i=s.fn,a=s.options,r=void 0===a?{}:a,l=s.name;"function"==typeof i&&(c=i({state:c,options:r,name:l,instance:u})||c)}else c.reset=!1,o=-1}}},update:(i=function(){return new Promise(function(e){u.forceUpdate(),e(c)})},function(){return r||(r=new Promise(function(e){Promise.resolve().then(function(){r=void 0,e(i())})})),r}),destroy:function(){m(),d=!0}};if(!K(e,t))return u;function m(){l.forEach(function(e){return e()}),l=[]}return u.setOptions(o).then(function(e){!d&&o.onFirstUpdate&&o.onFirstUpdate(e)}),u}}var Q={passive:!0},Z={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var n=e.state,o=e.instance,s=e.options,i=s.scroll,a=void 0===i||i,r=s.resize,c=void 0===r||r,l=t(n.elements.popper),d=[].concat(n.scrollParents.reference,n.scrollParents.popper);return a&&d.forEach(function(e){e.addEventListener("scroll",o.update,Q)}),c&&l.addEventListener("resize",o.update,Q),function(){a&&d.forEach(function(e){e.removeEventListener("scroll",o.update,Q)}),c&&l.removeEventListener("resize",o.update,Q)}},data:{}},ee={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=U({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})},data:{}},te={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ne(e){var n,o=e.popper,s=e.popperRect,i=e.placement,a=e.variation,c=e.offsets,l=e.position,d=e.gpuAcceleration,u=e.adaptive,m=e.roundOffsets,p=e.isFixed,g=c.x,v=void 0===g?0:g,y=c.y,b=void 0===y?0:y,w="function"==typeof m?m({x:v,y:b}):{x:v,y:b};v=w.x,b=w.y;var S=c.hasOwnProperty("x"),_=c.hasOwnProperty("y"),E=k,I=T,A=window;if(u){var $=C(o),M="clientHeight",P="clientWidth";$===t(o)&&"static"!==f($=h(o)).position&&"absolute"===l&&(M="scrollHeight",P="scrollWidth"),(i===T||(i===k||i===L)&&a===D)&&(I=x,b-=(p&&$===A&&A.visualViewport?A.visualViewport.height:$[M])-s.height,b*=d?1:-1),i!==k&&(i!==T&&i!==x||a!==D)||(E=L,v-=(p&&$===A&&A.visualViewport?A.visualViewport.width:$[P])-s.width,v*=d?1:-1)}var B,q,O,N,R,F,H=Object.assign({position:l},u&&te),j=!0===m?(q={x:v,y:b},O=t(o),N=q.x,R=q.y,F=O.devicePixelRatio||1,{x:r(N*F)/F||0,y:r(R*F)/F||0}):{x:v,y:b};return v=j.x,b=j.y,d?Object.assign({},H,((B={})[I]=_?"0":"",B[E]=S?"0":"",B.transform=(A.devicePixelRatio||1)<=1?"translate("+v+"px, "+b+"px)":"translate3d("+v+"px, "+b+"px, 0)",B)):Object.assign({},H,((n={})[I]=_?b+"px":"",n[E]=S?v+"px":"",n.transform="",n))}var oe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,o=n.gpuAcceleration,s=void 0===o||o,i=n.adaptive,a=void 0===i||i,r=n.roundOffsets,c=void 0===r||r,l={placement:j(t.placement),variation:z(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,ne(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,ne(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},se={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach(function(e){var n=t.styles[e]||{},s=t.attributes[e]||{},i=t.elements[e];o(i)&&m(i)&&(Object.assign(i.style,n),Object.keys(s).forEach(function(e){var t=s[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)}))})},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(e){var s=t.elements[e],i=t.attributes[e]||{},a=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce(function(e,t){return e[t]="",e},{});o(s)&&m(s)&&(Object.assign(s.style,a),Object.keys(i).forEach(function(e){s.removeAttribute(e)}))})}},requires:["computeStyles"]},ie={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,o=e.name,s=n.offset,i=void 0===s?[0,0]:s,a=q.reduce(function(e,n){return e[n]=(o=n,s=t.rects,a=i,r=j(o),c=[k,T].indexOf(r)>=0?-1:1,l="function"==typeof a?a(Object.assign({},s,{placement:o})):a,d=l[0],u=l[1],d=d||0,u=(u||0)*c,[k,L].indexOf(r)>=0?{x:u,y:d}:{x:d,y:u}),e;var o,s,a,r,c,l,d,u},{}),r=a[t.placement],c=r.x,l=r.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[o]=a}},ae={left:"right",right:"left",bottom:"top",top:"bottom"};function re(e){return e.replace(/left|right|bottom|top/g,function(e){return ae[e]})}var ce={start:"end",end:"start"};function le(e){return e.replace(/start|end/g,function(e){return ce[e]})}var de={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,o=e.name;if(!t.modifiersData[o]._skip){for(var s=n.mainAxis,i=void 0===s||s,a=n.altAxis,r=void 0===a||a,c=n.fallbackPlacements,l=n.padding,d=n.boundary,u=n.rootBoundary,m=n.altBoundary,h=n.flipVariations,p=void 0===h||h,f=n.allowedAutoPlacements,g=t.options.placement,v=j(g),y=c||(v!==g&&p?function(e){if(j(e)===I)return[];var t=re(e);return[le(e),t,le(t)]}(g):[re(g)]),b=[g].concat(y).reduce(function(e,n){return e.concat(j(n)===I?function(e,t){void 0===t&&(t={});var n=t,o=n.placement,s=n.boundary,i=n.rootBoundary,a=n.padding,r=n.flipVariations,c=n.allowedAutoPlacements,l=void 0===c?q:c,d=z(o),u=d?r?B:B.filter(function(e){return z(e)===d}):A,m=u.filter(function(e){return l.indexOf(e)>=0});0===m.length&&(m=u);var h=m.reduce(function(t,n){return t[n]=V(e,{placement:n,boundary:s,rootBoundary:i,padding:a})[j(n)],t},{});return Object.keys(h).sort(function(e,t){return h[e]-h[t]})}(t,{placement:n,boundary:d,rootBoundary:u,padding:l,flipVariations:p,allowedAutoPlacements:f}):n)},[]),w=t.rects.reference,S=t.rects.popper,_=new Map,E=!0,C=b[0],D=0;D<b.length;D++){var M=b[D],P=j(M),O=z(M)===$,N=[T,x].indexOf(P)>=0,R=N?"width":"height",F=V(t,{placement:M,boundary:d,rootBoundary:u,altBoundary:m,padding:l}),H=N?O?L:k:O?x:T;w[R]>S[R]&&(H=re(H));var W=re(H),U=[];if(i&&U.push(F[P]<=0),r&&U.push(F[H]<=0,F[W]<=0),U.every(function(e){return e})){C=M,E=!1;break}_.set(M,U)}if(E)for(var Y=function(e){var t=b.find(function(t){var n=_.get(t);if(n)return n.slice(0,e).every(function(e){return e})});if(t)return C=t,"break"},X=p?3:1;X>0&&"break"!==Y(X);X--);t.placement!==C&&(t.modifiersData[o]._skip=!0,t.placement=C,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function ue(e,t,n){return i(e,a(t,n))}var me={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t,n,o=e.state,s=e.options,r=e.name,c=s.mainAxis,l=void 0===c||c,d=s.altAxis,u=void 0!==d&&d,m=s.boundary,h=s.rootBoundary,p=s.altBoundary,f=s.padding,g=s.tether,v=void 0===g||g,b=s.tetherOffset,w=void 0===b?0:b,S=V(o,{boundary:m,rootBoundary:h,padding:f,altBoundary:p}),_=j(o.placement),E=z(o.placement),I=!E,A=W(_),D="x"===A?"y":"x",M=o.modifiersData.popperOffsets,P=o.rects.reference,B=o.rects.popper,q="function"==typeof w?w(Object.assign({},o.rects,{placement:o.placement})):w,O="number"==typeof q?{mainAxis:q,altAxis:q}:Object.assign({mainAxis:0,altAxis:0},q),N=o.modifiersData.offset?o.modifiersData.offset[o.placement]:null,R={x:0,y:0};if(M){if(l){var F,H="y"===A?T:k,U="y"===A?x:L,Y="y"===A?"height":"width",X=M[A],G=X+S[H],K=X-S[U],J=v?-B[Y]/2:0,Q=E===$?P[Y]:B[Y],Z=E===$?-B[Y]:-P[Y],ee=o.elements.arrow,te=v&&ee?y(ee):{width:0,height:0},ne=o.modifiersData["arrow#persistent"]?o.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},oe=ne[H],se=ne[U],ie=ue(0,P[Y],te[Y]),ae=I?P[Y]/2-J-ie-oe-O.mainAxis:Q-ie-oe-O.mainAxis,re=I?-P[Y]/2+J+ie+se+O.mainAxis:Z+ie+se+O.mainAxis,ce=o.elements.arrow&&C(o.elements.arrow),le=ce?"y"===A?ce.clientTop||0:ce.clientLeft||0:0,de=null!=(F=null==N?void 0:N[A])?F:0,me=X+re-de,he=ue(v?a(G,X+ae-de-le):G,X,v?i(K,me):K);M[A]=he,R[A]=he-X}if(u){var pe,fe="x"===A?T:k,ge="x"===A?x:L,ve=M[D],ye="y"===D?"height":"width",be=ve+S[fe],we=ve-S[ge],Se=-1!==[T,k].indexOf(_),_e=null!=(pe=null==N?void 0:N[D])?pe:0,Ee=Se?be:ve-P[ye]-B[ye]-_e+O.altAxis,Ce=Se?ve+P[ye]+B[ye]-_e-O.altAxis:we,Te=v&&Se?(n=ue(Ee,ve,t=Ce))>t?t:n:ue(v?Ee:be,ve,v?Ce:we);M[D]=Te,R[D]=Te-ve}o.modifiersData[r]=R}},requiresIfExists:["offset"]},he={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n,o,s=e.state,i=e.name,a=e.options,r=s.elements.arrow,c=s.modifiersData.popperOffsets,l=j(s.placement),d=W(l),u=[k,L].indexOf(l)>=0?"height":"width";if(r&&c){var m=(n=a.padding,o=s,Y("number"!=typeof(n="function"==typeof n?n(Object.assign({},o.rects,{placement:o.placement})):n)?n:X(n,A))),h=y(r),p="y"===d?T:k,f="y"===d?x:L,g=s.rects.reference[u]+s.rects.reference[d]-c[d]-s.rects.popper[u],v=c[d]-s.rects.reference[d],b=C(r),w=b?"y"===d?b.clientHeight||0:b.clientWidth||0:0,S=g/2-v/2,_=m[p],E=w-h[u]-m[f],I=w/2-h[u]/2+S,$=ue(_,I,E),D=d;s.modifiersData[i]=((t={})[D]=$,t.centerOffset=$-I,t)}},effect:function(e){var t=e.state,n=e.options.element,o=void 0===n?"[data-popper-arrow]":n;null!=o&&("string"!=typeof o||(o=t.elements.popper.querySelector(o)))&&R(t.elements.popper,o)&&(t.elements.arrow=o)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function pe(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function fe(e){return[T,L,x,k].some(function(t){return e[t]>=0})}var ge={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,o=t.rects.reference,s=t.rects.popper,i=t.modifiersData.preventOverflow,a=V(t,{elementContext:"reference"}),r=V(t,{altBoundary:!0}),c=pe(a,o),l=pe(r,s,i),d=fe(c),u=fe(l);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:d,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":u})}},ve=J({defaultModifiers:[Z,ee,oe,se]}),ye=[Z,ee,oe,se,ie,de,me,he,ge],be=J({defaultModifiers:ye});e.applyStyles=se,e.arrow=he,e.computeStyles=oe,e.createPopper=be,e.createPopperLite=ve,e.defaultModifiers=ye,e.detectOverflow=V,e.eventListeners=Z,e.flip=de,e.hide=ge,e.offset=ie,e.popperGenerator=J,e.popperOffsets=ee,e.preventOverflow=me,Object.defineProperty(e,"__esModule",{value:!0})}),function(n,o){"object"==typeof e&&void 0!==t?t.exports=o():"function"==typeof define&&define.amd?define(o):(n="undefined"!=typeof globalThis?globalThis:n||self).bootstrap=o()}(void 0,function(){const e=new Map,t={set(t,n,o){e.has(t)||e.set(t,new Map);const s=e.get(t);s.has(n)||0===s.size?s.set(n,o):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(s.keys())[0]}.`)},get:(t,n)=>e.has(t)&&e.get(t).get(n)||null,remove(t,n){if(!e.has(t))return;const o=e.get(t);o.delete(n),0===o.size&&e.delete(t)}},n="transitionend",o=e=>(e&&window.CSS&&window.CSS.escape&&(e=e.replace(/#([^\s"#']+)/g,(e,t)=>`#${CSS.escape(t)}`)),e),s=e=>{e.dispatchEvent(new Event(n))},i=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),a=e=>i(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(o(e)):null,r=e=>{if(!i(e)||0===e.getClientRects().length)return!1;const t="visible"===getComputedStyle(e).getPropertyValue("visibility"),n=e.closest("details:not([open])");if(!n)return t;if(n!==e){const t=e.closest("summary");if(t&&t.parentNode!==n)return!1;if(null===t)return!1}return t},c=e=>!e||e.nodeType!==Node.ELEMENT_NODE||!!e.classList.contains("disabled")||(void 0!==e.disabled?e.disabled:e.hasAttribute("disabled")&&"false"!==e.getAttribute("disabled")),l=e=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof e.getRootNode){const t=e.getRootNode();return t instanceof ShadowRoot?t:null}return e instanceof ShadowRoot?e:e.parentNode?l(e.parentNode):null},d=()=>{},u=e=>{e.offsetHeight},m=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,h=[],p=()=>"rtl"===document.documentElement.dir,f=e=>{var t;t=()=>{const t=m();if(t){const n=e.NAME,o=t.fn[n];t.fn[n]=e.jQueryInterface,t.fn[n].Constructor=e,t.fn[n].noConflict=()=>(t.fn[n]=o,e.jQueryInterface)}},"loading"===document.readyState?(h.length||document.addEventListener("DOMContentLoaded",()=>{for(const e of h)e()}),h.push(t)):t()},g=(e,t=[],n=e)=>"function"==typeof e?e(...t):n,v=(e,t,o=!0)=>{if(!o)return void g(e);const i=(e=>{if(!e)return 0;let{transitionDuration:t,transitionDelay:n}=window.getComputedStyle(e);const o=Number.parseFloat(t),s=Number.parseFloat(n);return o||s?(t=t.split(",")[0],n=n.split(",")[0],1e3*(Number.parseFloat(t)+Number.parseFloat(n))):0})(t)+5;let a=!1;const r=({target:o})=>{o===t&&(a=!0,t.removeEventListener(n,r),g(e))};t.addEventListener(n,r),setTimeout(()=>{a||s(t)},i)},y=(e,t,n,o)=>{const s=e.length;let i=e.indexOf(t);return-1===i?!n&&o?e[s-1]:e[0]:(i+=n?1:-1,o&&(i=(i+s)%s),e[Math.max(0,Math.min(i,s-1))])},b=/[^.]*(?=\..*)\.|.*/,w=/\..*/,S=/::\d+$/,_={};let E=1;const C={mouseenter:"mouseover",mouseleave:"mouseout"},T=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function x(e,t){return t&&`${t}::${E++}`||e.uidEvent||E++}function L(e){const t=x(e);return e.uidEvent=t,_[t]=_[t]||{},_[t]}function k(e,t,n=null){return Object.values(e).find(e=>e.callable===t&&e.delegationSelector===n)}function I(e,t,n){const o="string"==typeof t,s=o?n:t||n;let i=M(e);return T.has(i)||(i=e),[o,s,i]}function A(e,t,n,o,s){if("string"!=typeof t||!e)return;let[i,a,r]=I(t,n,o);var c;t in C&&(c=a,a=function(e){if(!e.relatedTarget||e.relatedTarget!==e.delegateTarget&&!e.delegateTarget.contains(e.relatedTarget))return c.call(this,e)});const l=L(e),d=l[r]||(l[r]={}),u=k(d,a,i?n:null);if(u)return void(u.oneOff=u.oneOff&&s);const m=x(a,t.replace(b,"")),h=i?function(e,t,n){return function o(s){const i=e.querySelectorAll(t);for(let{target:a}=s;a&&a!==this;a=a.parentNode)for(const r of i)if(r===a)return B(s,{delegateTarget:a}),o.oneOff&&P.off(e,s.type,t,n),n.apply(a,[s])}}(e,n,a):function(e,t){return function n(o){return B(o,{delegateTarget:e}),n.oneOff&&P.off(e,o.type,t),t.apply(e,[o])}}(e,a);h.delegationSelector=i?n:null,h.callable=a,h.oneOff=s,h.uidEvent=m,d[m]=h,e.addEventListener(r,h,i)}function $(e,t,n,o,s){const i=k(t[n],o,s);i&&(e.removeEventListener(n,i,Boolean(s)),delete t[n][i.uidEvent])}function D(e,t,n,o){const s=t[n]||{};for(const[i,a]of Object.entries(s))i.includes(o)&&$(e,t,n,a.callable,a.delegationSelector)}function M(e){return e=e.replace(w,""),C[e]||e}const P={on(e,t,n,o){A(e,t,n,o,!1)},one(e,t,n,o){A(e,t,n,o,!0)},off(e,t,n,o){if("string"!=typeof t||!e)return;const[s,i,a]=I(t,n,o),r=a!==t,c=L(e),l=c[a]||{},d=t.startsWith(".");if(void 0===i){if(d)for(const n of Object.keys(c))D(e,c,n,t.slice(1));for(const[n,o]of Object.entries(l)){const s=n.replace(S,"");r&&!t.includes(s)||$(e,c,a,o.callable,o.delegationSelector)}}else{if(!Object.keys(l).length)return;$(e,c,a,i,s?n:null)}},trigger(e,t,n){if("string"!=typeof t||!e)return null;const o=m();let s=null,i=!0,a=!0,r=!1;t!==M(t)&&o&&(s=o.Event(t,n),o(e).trigger(s),i=!s.isPropagationStopped(),a=!s.isImmediatePropagationStopped(),r=s.isDefaultPrevented());const c=B(new Event(t,{bubbles:i,cancelable:!0}),n);return r&&c.preventDefault(),a&&e.dispatchEvent(c),c.defaultPrevented&&s&&s.preventDefault(),c}};function B(e,t={}){for(const[o,s]of Object.entries(t))try{e[o]=s}catch(n){Object.defineProperty(e,o,{configurable:!0,get:()=>s})}return e}function q(e){if("true"===e)return!0;if("false"===e)return!1;if(e===Number(e).toString())return Number(e);if(""===e||"null"===e)return null;if("string"!=typeof e)return e;try{return JSON.parse(decodeURIComponent(e))}catch(t){return e}}function O(e){return e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}const N={setDataAttribute(e,t,n){e.setAttribute(`data-bs-${O(t)}`,n)},removeDataAttribute(e,t){e.removeAttribute(`data-bs-${O(t)}`)},getDataAttributes(e){if(!e)return{};const t={},n=Object.keys(e.dataset).filter(e=>e.startsWith("bs")&&!e.startsWith("bsConfig"));for(const o of n){let n=o.replace(/^bs/,"");n=n.charAt(0).toLowerCase()+n.slice(1,n.length),t[n]=q(e.dataset[o])}return t},getDataAttribute:(e,t)=>q(e.getAttribute(`data-bs-${O(t)}`))};class R{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,t){const n=i(t)?N.getDataAttribute(t,"config"):{};return{...this.constructor.Default,..."object"==typeof n?n:{},...i(t)?N.getDataAttributes(t):{},..."object"==typeof e?e:{}}}_typeCheckConfig(e,t=this.constructor.DefaultType){for(const[o,s]of Object.entries(t)){const t=e[o],a=i(t)?"element":null==(n=t)?`${n}`:Object.prototype.toString.call(n).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(s).test(a))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${o}" provided type "${a}" but expected type "${s}".`)}var n}}class F extends R{constructor(e,n){super(),(e=a(e))&&(this._element=e,this._config=this._getConfig(n),t.set(this._element,this.constructor.DATA_KEY,this))}dispose(){t.remove(this._element,this.constructor.DATA_KEY),P.off(this._element,this.constructor.EVENT_KEY);for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,t,n=!0){v(e,t,n)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return t.get(a(e),this.DATA_KEY)}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,"object"==typeof t?t:null)}static get VERSION(){return"5.3.0"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}}const H=e=>{let t=e.getAttribute("data-bs-target");if(!t||"#"===t){let n=e.getAttribute("href");if(!n||!n.includes("#")&&!n.startsWith("."))return null;n.includes("#")&&!n.startsWith("#")&&(n=`#${n.split("#")[1]}`),t=n&&"#"!==n?n.trim():null}return o(t)},j={find:(e,t=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(t,e)),findOne:(e,t=document.documentElement)=>Element.prototype.querySelector.call(t,e),children:(e,t)=>[].concat(...e.children).filter(e=>e.matches(t)),parents(e,t){const n=[];let o=e.parentNode.closest(t);for(;o;)n.push(o),o=o.parentNode.closest(t);return n},prev(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return[n];n=n.previousElementSibling}return[]},next(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return[n];n=n.nextElementSibling}return[]},focusableChildren(e){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(e=>`${e}:not([tabindex^="-"])`).join(",");return this.find(t,e).filter(e=>!c(e)&&r(e))},getSelectorFromElement(e){const t=H(e);return t&&j.findOne(t)?t:null},getElementFromSelector(e){const t=H(e);return t?j.findOne(t):null},getMultipleElementsFromSelector(e){const t=H(e);return t?j.find(t):[]}},z=(e,t="hide")=>{const n=`click.dismiss${e.EVENT_KEY}`,o=e.NAME;P.on(document,n,`[data-bs-dismiss="${o}"]`,function(n){if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),c(this))return;const s=j.getElementFromSelector(this)||this.closest(`.${o}`);e.getOrCreateInstance(s)[t]()})};class W extends F{static get NAME(){return"alert"}close(){if(P.trigger(this._element,"close.bs.alert").defaultPrevented)return;this._element.classList.remove("show");const e=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,e)}_destroyElement(){this._element.remove(),P.trigger(this._element,"closed.bs.alert"),this.dispose()}static jQueryInterface(e){return this.each(function(){const t=W.getOrCreateInstance(this);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e](this)}})}}z(W,"close"),f(W);const U='[data-bs-toggle="button"]';class Y extends F{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(e){return this.each(function(){const t=Y.getOrCreateInstance(this);"toggle"===e&&t[e]()})}}P.on(document,"click.bs.button.data-api",U,e=>{e.preventDefault();const t=e.target.closest(U);Y.getOrCreateInstance(t).toggle()}),f(Y);const X={endCallback:null,leftCallback:null,rightCallback:null},V={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class G extends R{constructor(e,t){super(),this._element=e,e&&G.isSupported()&&(this._config=this._getConfig(t),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return X}static get DefaultType(){return V}static get NAME(){return"swipe"}dispose(){P.off(this._element,".bs.swipe")}_start(e){this._supportPointerEvents?this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX):this._deltaX=e.touches[0].clientX}_end(e){this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX-this._deltaX),this._handleSwipe(),g(this._config.endCallback)}_move(e){this._deltaX=e.touches&&e.touches.length>1?0:e.touches[0].clientX-this._deltaX}_handleSwipe(){const e=Math.abs(this._deltaX);if(e<=40)return;const t=e/this._deltaX;this._deltaX=0,t&&g(t>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(P.on(this._element,"pointerdown.bs.swipe",e=>this._start(e)),P.on(this._element,"pointerup.bs.swipe",e=>this._end(e)),this._element.classList.add("pointer-event")):(P.on(this._element,"touchstart.bs.swipe",e=>this._start(e)),P.on(this._element,"touchmove.bs.swipe",e=>this._move(e)),P.on(this._element,"touchend.bs.swipe",e=>this._end(e)))}_eventIsPointerPenTouch(e){return this._supportPointerEvents&&("pen"===e.pointerType||"touch"===e.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const K="next",J="prev",Q="left",Z="right",ee="slid.bs.carousel",te="carousel",ne="active",oe={ArrowLeft:Z,ArrowRight:Q},se={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},ie={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class ae extends F{constructor(e,t){super(e,t),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=j.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===te&&this.cycle()}static get Default(){return se}static get DefaultType(){return ie}static get NAME(){return"carousel"}next(){this._slide(K)}nextWhenVisible(){!document.hidden&&r(this._element)&&this.next()}prev(){this._slide(J)}pause(){this._isSliding&&s(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?P.one(this._element,ee,()=>this.cycle()):this.cycle())}to(e){const t=this._getItems();if(e>t.length-1||e<0)return;if(this._isSliding)return void P.one(this._element,ee,()=>this.to(e));const n=this._getItemIndex(this._getActive());if(n===e)return;const o=e>n?K:J;this._slide(o,t[e])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(e){return e.defaultInterval=e.interval,e}_addEventListeners(){this._config.keyboard&&P.on(this._element,"keydown.bs.carousel",e=>this._keydown(e)),"hover"===this._config.pause&&(P.on(this._element,"mouseenter.bs.carousel",()=>this.pause()),P.on(this._element,"mouseleave.bs.carousel",()=>this._maybeEnableCycle())),this._config.touch&&G.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const t of j.find(".carousel-item img",this._element))P.on(t,"dragstart.bs.carousel",e=>e.preventDefault());const e={leftCallback:()=>this._slide(this._directionToOrder(Q)),rightCallback:()=>this._slide(this._directionToOrder(Z)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new G(this._element,e)}_keydown(e){if(/input|textarea/i.test(e.target.tagName))return;const t=oe[e.key];t&&(e.preventDefault(),this._slide(this._directionToOrder(t)))}_getItemIndex(e){return this._getItems().indexOf(e)}_setActiveIndicatorElement(e){if(!this._indicatorsElement)return;const t=j.findOne(".active",this._indicatorsElement);t.classList.remove(ne),t.removeAttribute("aria-current");const n=j.findOne(`[data-bs-slide-to="${e}"]`,this._indicatorsElement);n&&(n.classList.add(ne),n.setAttribute("aria-current","true"))}_updateInterval(){const e=this._activeElement||this._getActive();if(!e)return;const t=Number.parseInt(e.getAttribute("data-bs-interval"),10);this._config.interval=t||this._config.defaultInterval}_slide(e,t=null){if(this._isSliding)return;const n=this._getActive(),o=e===K,s=t||y(this._getItems(),n,o,this._config.wrap);if(s===n)return;const i=this._getItemIndex(s),a=t=>P.trigger(this._element,t,{relatedTarget:s,direction:this._orderToDirection(e),from:this._getItemIndex(n),to:i});if(a("slide.bs.carousel").defaultPrevented)return;if(!n||!s)return;const r=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(i),this._activeElement=s;const c=o?"carousel-item-start":"carousel-item-end",l=o?"carousel-item-next":"carousel-item-prev";s.classList.add(l),u(s),n.classList.add(c),s.classList.add(c),this._queueCallback(()=>{s.classList.remove(c,l),s.classList.add(ne),n.classList.remove(ne,l,c),this._isSliding=!1,a(ee)},n,this._isAnimated()),r&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return j.findOne(".active.carousel-item",this._element)}_getItems(){return j.find(".carousel-item",this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(e){return p()?e===Q?J:K:e===Q?K:J}_orderToDirection(e){return p()?e===J?Q:Z:e===J?Z:Q}static jQueryInterface(e){return this.each(function(){const t=ae.getOrCreateInstance(this,e);if("number"!=typeof e){if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e]()}}else t.to(e)})}}P.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",function(e){const t=j.getElementFromSelector(this);if(!t||!t.classList.contains(te))return;e.preventDefault();const n=ae.getOrCreateInstance(t),o=this.getAttribute("data-bs-slide-to");return o?(n.to(o),void n._maybeEnableCycle()):"next"===N.getDataAttribute(this,"slide")?(n.next(),void n._maybeEnableCycle()):(n.prev(),void n._maybeEnableCycle())}),P.on(window,"load.bs.carousel.data-api",()=>{const e=j.find('[data-bs-ride="carousel"]');for(const t of e)ae.getOrCreateInstance(t)}),f(ae);const re="show",ce="collapse",le="collapsing",de='[data-bs-toggle="collapse"]',ue={parent:null,toggle:!0},me={parent:"(null|element)",toggle:"boolean"};class he extends F{constructor(e,t){super(e,t),this._isTransitioning=!1,this._triggerArray=[];const n=j.find(de);for(const o of n){const e=j.getSelectorFromElement(o),t=j.find(e).filter(e=>e===this._element);null!==e&&t.length&&this._triggerArray.push(o)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return ue}static get DefaultType(){return me}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let e=[];if(this._config.parent&&(e=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(e=>e!==this._element).map(e=>he.getOrCreateInstance(e,{toggle:!1}))),e.length&&e[0]._isTransitioning)return;if(P.trigger(this._element,"show.bs.collapse").defaultPrevented)return;for(const o of e)o.hide();const t=this._getDimension();this._element.classList.remove(ce),this._element.classList.add(le),this._element.style[t]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const n=`scroll${t[0].toUpperCase()+t.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(le),this._element.classList.add(ce,re),this._element.style[t]="",P.trigger(this._element,"shown.bs.collapse")},this._element,!0),this._element.style[t]=`${this._element[n]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(P.trigger(this._element,"hide.bs.collapse").defaultPrevented)return;const e=this._getDimension();this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,u(this._element),this._element.classList.add(le),this._element.classList.remove(ce,re);for(const t of this._triggerArray){const e=j.getElementFromSelector(t);e&&!this._isShown(e)&&this._addAriaAndCollapsedClass([t],!1)}this._isTransitioning=!0,this._element.style[e]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(le),this._element.classList.add(ce),P.trigger(this._element,"hidden.bs.collapse")},this._element,!0)}_isShown(e=this._element){return e.classList.contains(re)}_configAfterMerge(e){return e.toggle=Boolean(e.toggle),e.parent=a(e.parent),e}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const e=this._getFirstLevelChildren(de);for(const t of e){const e=j.getElementFromSelector(t);e&&this._addAriaAndCollapsedClass([t],this._isShown(e))}}_getFirstLevelChildren(e){const t=j.find(":scope .collapse .collapse",this._config.parent);return j.find(e,this._config.parent).filter(e=>!t.includes(e))}_addAriaAndCollapsedClass(e,t){if(e.length)for(const n of e)n.classList.toggle("collapsed",!t),n.setAttribute("aria-expanded",t)}static jQueryInterface(e){const t={};return"string"==typeof e&&/show|hide/.test(e)&&(t.toggle=!1),this.each(function(){const n=he.getOrCreateInstance(this,t);if("string"==typeof e){if(void 0===n[e])throw new TypeError(`No method named "${e}"`);n[e]()}})}}P.on(document,"click.bs.collapse.data-api",de,function(e){("A"===e.target.tagName||e.delegateTarget&&"A"===e.delegateTarget.tagName)&&e.preventDefault();for(const t of j.getMultipleElementsFromSelector(this))he.getOrCreateInstance(t,{toggle:!1}).toggle()}),f(he);var pe="top",fe="bottom",ge="right",ve="left",ye="auto",be=[pe,fe,ge,ve],we="start",Se="end",_e="clippingParents",Ee="viewport",Ce="popper",Te="reference",xe=be.reduce(function(e,t){return e.concat([t+"-"+we,t+"-"+Se])},[]),Le=[].concat(be,[ye]).reduce(function(e,t){return e.concat([t,t+"-"+we,t+"-"+Se])},[]),ke="beforeRead",Ie="read",Ae="afterRead",$e="beforeMain",De="main",Me="afterMain",Pe="beforeWrite",Be="write",qe="afterWrite",Oe=[ke,Ie,Ae,$e,De,Me,Pe,Be,qe];function Ne(e){return e?(e.nodeName||"").toLowerCase():null}function Re(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Fe(e){return e instanceof Re(e).Element||e instanceof Element}function He(e){return e instanceof Re(e).HTMLElement||e instanceof HTMLElement}function je(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Re(e).ShadowRoot||e instanceof ShadowRoot)}const ze={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach(function(e){var n=t.styles[e]||{},o=t.attributes[e]||{},s=t.elements[e];He(s)&&Ne(s)&&(Object.assign(s.style,n),Object.keys(o).forEach(function(e){var t=o[e];!1===t?s.removeAttribute(e):s.setAttribute(e,!0===t?"":t)}))})},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(e){var o=t.elements[e],s=t.attributes[e]||{},i=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce(function(e,t){return e[t]="",e},{});He(o)&&Ne(o)&&(Object.assign(o.style,i),Object.keys(s).forEach(function(e){o.removeAttribute(e)}))})}},requires:["computeStyles"]};function We(e){return e.split("-")[0]}var Ue=Math.max,Ye=Math.min,Xe=Math.round;function Ve(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Ge(){return!/^((?!chrome|android).)*safari/i.test(Ve())}function Ke(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var o=e.getBoundingClientRect(),s=1,i=1;t&&He(e)&&(s=e.offsetWidth>0&&Xe(o.width)/e.offsetWidth||1,i=e.offsetHeight>0&&Xe(o.height)/e.offsetHeight||1);var a=(Fe(e)?Re(e):window).visualViewport,r=!Ge()&&n,c=(o.left+(r&&a?a.offsetLeft:0))/s,l=(o.top+(r&&a?a.offsetTop:0))/i,d=o.width/s,u=o.height/i;return{width:d,height:u,top:l,right:c+d,bottom:l+u,left:c,x:c,y:l}}function Je(e){var t=Ke(e),n=e.offsetWidth,o=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-o)<=1&&(o=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:o}}function Qe(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&je(n)){var o=t;do{if(o&&e.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function Ze(e){return Re(e).getComputedStyle(e)}function et(e){return["table","td","th"].indexOf(Ne(e))>=0}function tt(e){return((Fe(e)?e.ownerDocument:e.document)||window.document).documentElement}function nt(e){return"html"===Ne(e)?e:e.assignedSlot||e.parentNode||(je(e)?e.host:null)||tt(e)}function ot(e){return He(e)&&"fixed"!==Ze(e).position?e.offsetParent:null}function st(e){for(var t=Re(e),n=ot(e);n&&et(n)&&"static"===Ze(n).position;)n=ot(n);return n&&("html"===Ne(n)||"body"===Ne(n)&&"static"===Ze(n).position)?t:n||function(e){var t=/firefox/i.test(Ve());if(/Trident/i.test(Ve())&&He(e)&&"fixed"===Ze(e).position)return null;var n=nt(e);for(je(n)&&(n=n.host);He(n)&&["html","body"].indexOf(Ne(n))<0;){var o=Ze(n);if("none"!==o.transform||"none"!==o.perspective||"paint"===o.contain||-1!==["transform","perspective"].indexOf(o.willChange)||t&&"filter"===o.willChange||t&&o.filter&&"none"!==o.filter)return n;n=n.parentNode}return null}(e)||t}function it(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function at(e,t,n){return Ue(e,Ye(t,n))}function rt(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function ct(e,t){return t.reduce(function(t,n){return t[n]=e,t},{})}const lt={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n,o,s=e.state,i=e.name,a=e.options,r=s.elements.arrow,c=s.modifiersData.popperOffsets,l=We(s.placement),d=it(l),u=[ve,ge].indexOf(l)>=0?"height":"width";if(r&&c){var m=(n=a.padding,o=s,rt("number"!=typeof(n="function"==typeof n?n(Object.assign({},o.rects,{placement:o.placement})):n)?n:ct(n,be))),h=Je(r),p="y"===d?pe:ve,f="y"===d?fe:ge,g=s.rects.reference[u]+s.rects.reference[d]-c[d]-s.rects.popper[u],v=c[d]-s.rects.reference[d],y=st(r),b=y?"y"===d?y.clientHeight||0:y.clientWidth||0:0,w=g/2-v/2,S=m[p],_=b-h[u]-m[f],E=b/2-h[u]/2+w,C=at(S,E,_),T=d;s.modifiersData[i]=((t={})[T]=C,t.centerOffset=C-E,t)}},effect:function(e){var t=e.state,n=e.options.element,o=void 0===n?"[data-popper-arrow]":n;null!=o&&("string"!=typeof o||(o=t.elements.popper.querySelector(o)))&&Qe(t.elements.popper,o)&&(t.elements.arrow=o)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function dt(e){return e.split("-")[1]}var ut={top:"auto",right:"auto",bottom:"auto",left:"auto"};function mt(e){var t,n=e.popper,o=e.popperRect,s=e.placement,i=e.variation,a=e.offsets,r=e.position,c=e.gpuAcceleration,l=e.adaptive,d=e.roundOffsets,u=e.isFixed,m=a.x,h=void 0===m?0:m,p=a.y,f=void 0===p?0:p,g="function"==typeof d?d({x:h,y:f}):{x:h,y:f};h=g.x,f=g.y;var v=a.hasOwnProperty("x"),y=a.hasOwnProperty("y"),b=ve,w=pe,S=window;if(l){var _=st(n),E="clientHeight",C="clientWidth";_===Re(n)&&"static"!==Ze(_=tt(n)).position&&"absolute"===r&&(E="scrollHeight",C="scrollWidth"),(s===pe||(s===ve||s===ge)&&i===Se)&&(w=fe,f-=(u&&_===S&&S.visualViewport?S.visualViewport.height:_[E])-o.height,f*=c?1:-1),s!==ve&&(s!==pe&&s!==fe||i!==Se)||(b=ge,h-=(u&&_===S&&S.visualViewport?S.visualViewport.width:_[C])-o.width,h*=c?1:-1)}var T,x,L,k,I,A,$=Object.assign({position:r},l&&ut),D=!0===d?(x={x:h,y:f},L=Re(n),k=x.x,I=x.y,A=L.devicePixelRatio||1,{x:Xe(k*A)/A||0,y:Xe(I*A)/A||0}):{x:h,y:f};return h=D.x,f=D.y,c?Object.assign({},$,((T={})[w]=y?"0":"",T[b]=v?"0":"",T.transform=(S.devicePixelRatio||1)<=1?"translate("+h+"px, "+f+"px)":"translate3d("+h+"px, "+f+"px, 0)",T)):Object.assign({},$,((t={})[w]=y?f+"px":"",t[b]=v?h+"px":"",t.transform="",t))}const ht={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,o=n.gpuAcceleration,s=void 0===o||o,i=n.adaptive,a=void 0===i||i,r=n.roundOffsets,c=void 0===r||r,l={placement:We(t.placement),variation:dt(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,mt(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,mt(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var pt={passive:!0};const ft={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,o=e.options,s=o.scroll,i=void 0===s||s,a=o.resize,r=void 0===a||a,c=Re(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return i&&l.forEach(function(e){e.addEventListener("scroll",n.update,pt)}),r&&c.addEventListener("resize",n.update,pt),function(){i&&l.forEach(function(e){e.removeEventListener("scroll",n.update,pt)}),r&&c.removeEventListener("resize",n.update,pt)}},data:{}};var gt={left:"right",right:"left",bottom:"top",top:"bottom"};function vt(e){return e.replace(/left|right|bottom|top/g,function(e){return gt[e]})}var yt={start:"end",end:"start"};function bt(e){return e.replace(/start|end/g,function(e){return yt[e]})}function wt(e){var t=Re(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function St(e){return Ke(tt(e)).left+wt(e).scrollLeft}function _t(e){var t=Ze(e),n=t.overflow,o=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+s+o)}function Et(e){return["html","body","#document"].indexOf(Ne(e))>=0?e.ownerDocument.body:He(e)&&_t(e)?e:Et(nt(e))}function Ct(e,t){var n;void 0===t&&(t=[]);var o=Et(e),s=o===(null==(n=e.ownerDocument)?void 0:n.body),i=Re(o),a=s?[i].concat(i.visualViewport||[],_t(o)?o:[]):o,r=t.concat(a);return s?r:r.concat(Ct(nt(a)))}function Tt(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function xt(e,t,n){return t===Ee?Tt(function(e,t){var n=Re(e),o=tt(e),s=n.visualViewport,i=o.clientWidth,a=o.clientHeight,r=0,c=0;if(s){i=s.width,a=s.height;var l=Ge();(l||!l&&"fixed"===t)&&(r=s.offsetLeft,c=s.offsetTop)}return{width:i,height:a,x:r+St(e),y:c}}(e,n)):Fe(t)?((s=Ke(o=t,!1,"fixed"===n)).top=s.top+o.clientTop,s.left=s.left+o.clientLeft,s.bottom=s.top+o.clientHeight,s.right=s.left+o.clientWidth,s.width=o.clientWidth,s.height=o.clientHeight,s.x=s.left,s.y=s.top,s):Tt(function(e){var t,n=tt(e),o=wt(e),s=null==(t=e.ownerDocument)?void 0:t.body,i=Ue(n.scrollWidth,n.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),a=Ue(n.scrollHeight,n.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),r=-o.scrollLeft+St(e),c=-o.scrollTop;return"rtl"===Ze(s||n).direction&&(r+=Ue(n.clientWidth,s?s.clientWidth:0)-i),{width:i,height:a,x:r,y:c}}(tt(e)));var o,s}function Lt(e){var t,n=e.reference,o=e.element,s=e.placement,i=s?We(s):null,a=s?dt(s):null,r=n.x+n.width/2-o.width/2,c=n.y+n.height/2-o.height/2;switch(i){case pe:t={x:r,y:n.y-o.height};break;case fe:t={x:r,y:n.y+n.height};break;case ge:t={x:n.x+n.width,y:c};break;case ve:t={x:n.x-o.width,y:c};break;default:t={x:n.x,y:n.y}}var l=i?it(i):null;if(null!=l){var d="y"===l?"height":"width";switch(a){case we:t[l]=t[l]-(n[d]/2-o[d]/2);break;case Se:t[l]=t[l]+(n[d]/2-o[d]/2)}}return t}function kt(e,t){void 0===t&&(t={});var n,o,s,i,a,r,c,l,d,u,m,h=t,p=h.placement,f=void 0===p?e.placement:p,g=h.strategy,v=void 0===g?e.strategy:g,y=h.boundary,b=void 0===y?_e:y,w=h.rootBoundary,S=void 0===w?Ee:w,_=h.elementContext,E=void 0===_?Ce:_,C=h.altBoundary,T=void 0!==C&&C,x=h.padding,L=void 0===x?0:x,k=rt("number"!=typeof L?L:ct(L,be)),I=E===Ce?Te:Ce,A=e.rects.popper,$=e.elements[T?I:E],D=(n=Fe($)?$:$.contextElement||tt(e.elements.popper),s=S,i=v,l="clippingParents"===(o=b)?(r=Ct(nt(a=n)),Fe(c=["absolute","fixed"].indexOf(Ze(a).position)>=0&&He(a)?st(a):a)?r.filter(function(e){return Fe(e)&&Qe(e,c)&&"body"!==Ne(e)}):[]):[].concat(o),d=[].concat(l,[s]),u=d[0],m=d.reduce(function(e,t){var o=xt(n,t,i);return e.top=Ue(o.top,e.top),e.right=Ye(o.right,e.right),e.bottom=Ye(o.bottom,e.bottom),e.left=Ue(o.left,e.left),e},xt(n,u,i)),m.width=m.right-m.left,m.height=m.bottom-m.top,m.x=m.left,m.y=m.top,m),M=Ke(e.elements.reference),P=Lt({reference:M,element:A,placement:f}),B=Tt(Object.assign({},A,P)),q=E===Ce?B:M,O={top:D.top-q.top+k.top,bottom:q.bottom-D.bottom+k.bottom,left:D.left-q.left+k.left,right:q.right-D.right+k.right},N=e.modifiersData.offset;if(E===Ce&&N){var R=N[f];Object.keys(O).forEach(function(e){var t=[ge,fe].indexOf(e)>=0?1:-1,n=[pe,fe].indexOf(e)>=0?"y":"x";O[e]+=R[n]*t})}return O}const It={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,o=e.name;if(!t.modifiersData[o]._skip){for(var s=n.mainAxis,i=void 0===s||s,a=n.altAxis,r=void 0===a||a,c=n.fallbackPlacements,l=n.padding,d=n.boundary,u=n.rootBoundary,m=n.altBoundary,h=n.flipVariations,p=void 0===h||h,f=n.allowedAutoPlacements,g=t.options.placement,v=We(g),y=c||(v!==g&&p?function(e){if(We(e)===ye)return[];var t=vt(e);return[bt(e),t,bt(t)]}(g):[vt(g)]),b=[g].concat(y).reduce(function(e,n){return e.concat(We(n)===ye?function(e,t){void 0===t&&(t={});var n=t,o=n.placement,s=n.boundary,i=n.rootBoundary,a=n.padding,r=n.flipVariations,c=n.allowedAutoPlacements,l=void 0===c?Le:c,d=dt(o),u=d?r?xe:xe.filter(function(e){return dt(e)===d}):be,m=u.filter(function(e){return l.indexOf(e)>=0});0===m.length&&(m=u);var h=m.reduce(function(t,n){return t[n]=kt(e,{placement:n,boundary:s,rootBoundary:i,padding:a})[We(n)],t},{});return Object.keys(h).sort(function(e,t){return h[e]-h[t]})}(t,{placement:n,boundary:d,rootBoundary:u,padding:l,flipVariations:p,allowedAutoPlacements:f}):n)},[]),w=t.rects.reference,S=t.rects.popper,_=new Map,E=!0,C=b[0],T=0;T<b.length;T++){var x=b[T],L=We(x),k=dt(x)===we,I=[pe,fe].indexOf(L)>=0,A=I?"width":"height",$=kt(t,{placement:x,boundary:d,rootBoundary:u,altBoundary:m,padding:l}),D=I?k?ge:ve:k?fe:pe;w[A]>S[A]&&(D=vt(D));var M=vt(D),P=[];if(i&&P.push($[L]<=0),r&&P.push($[D]<=0,$[M]<=0),P.every(function(e){return e})){C=x,E=!1;break}_.set(x,P)}if(E)for(var B=function(e){var t=b.find(function(t){var n=_.get(t);if(n)return n.slice(0,e).every(function(e){return e})});if(t)return C=t,"break"},q=p?3:1;q>0&&"break"!==B(q);q--);t.placement!==C&&(t.modifiersData[o]._skip=!0,t.placement=C,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function At(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function $t(e){return[pe,ge,fe,ve].some(function(t){return e[t]>=0})}const Dt={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,o=t.rects.reference,s=t.rects.popper,i=t.modifiersData.preventOverflow,a=kt(t,{elementContext:"reference"}),r=kt(t,{altBoundary:!0}),c=At(a,o),l=At(r,s,i),d=$t(c),u=$t(l);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:d,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":u})}},Mt={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,o=e.name,s=n.offset,i=void 0===s?[0,0]:s,a=Le.reduce(function(e,n){return e[n]=(o=n,s=t.rects,a=i,r=We(o),c=[ve,pe].indexOf(r)>=0?-1:1,l="function"==typeof a?a(Object.assign({},s,{placement:o})):a,d=l[0],u=l[1],d=d||0,u=(u||0)*c,[ve,ge].indexOf(r)>=0?{x:u,y:d}:{x:d,y:u}),e;var o,s,a,r,c,l,d,u},{}),r=a[t.placement],c=r.x,l=r.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[o]=a}},Pt={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=Lt({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})},data:{}},Bt={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t,n,o=e.state,s=e.options,i=e.name,a=s.mainAxis,r=void 0===a||a,c=s.altAxis,l=void 0!==c&&c,d=s.boundary,u=s.rootBoundary,m=s.altBoundary,h=s.padding,p=s.tether,f=void 0===p||p,g=s.tetherOffset,v=void 0===g?0:g,y=kt(o,{boundary:d,rootBoundary:u,padding:h,altBoundary:m}),b=We(o.placement),w=dt(o.placement),S=!w,_=it(b),E="x"===_?"y":"x",C=o.modifiersData.popperOffsets,T=o.rects.reference,x=o.rects.popper,L="function"==typeof v?v(Object.assign({},o.rects,{placement:o.placement})):v,k="number"==typeof L?{mainAxis:L,altAxis:L}:Object.assign({mainAxis:0,altAxis:0},L),I=o.modifiersData.offset?o.modifiersData.offset[o.placement]:null,A={x:0,y:0};if(C){if(r){var $,D="y"===_?pe:ve,M="y"===_?fe:ge,P="y"===_?"height":"width",B=C[_],q=B+y[D],O=B-y[M],N=f?-x[P]/2:0,R=w===we?T[P]:x[P],F=w===we?-x[P]:-T[P],H=o.elements.arrow,j=f&&H?Je(H):{width:0,height:0},z=o.modifiersData["arrow#persistent"]?o.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},W=z[D],U=z[M],Y=at(0,T[P],j[P]),X=S?T[P]/2-N-Y-W-k.mainAxis:R-Y-W-k.mainAxis,V=S?-T[P]/2+N+Y+U+k.mainAxis:F+Y+U+k.mainAxis,G=o.elements.arrow&&st(o.elements.arrow),K=G?"y"===_?G.clientTop||0:G.clientLeft||0:0,J=null!=($=null==I?void 0:I[_])?$:0,Q=B+V-J,Z=at(f?Ye(q,B+X-J-K):q,B,f?Ue(O,Q):O);C[_]=Z,A[_]=Z-B}if(l){var ee,te="x"===_?pe:ve,ne="x"===_?fe:ge,oe=C[E],se="y"===E?"height":"width",ie=oe+y[te],ae=oe-y[ne],re=-1!==[pe,ve].indexOf(b),ce=null!=(ee=null==I?void 0:I[E])?ee:0,le=re?ie:oe-T[se]-x[se]-ce+k.altAxis,de=re?oe+T[se]+x[se]-ce-k.altAxis:ae,ue=f&&re?(n=at(le,oe,t=de))>t?t:n:at(f?le:ie,oe,f?de:ae);C[E]=ue,A[E]=ue-oe}o.modifiersData[i]=A}},requiresIfExists:["offset"]};function qt(e,t,n){void 0===n&&(n=!1);var o,s,i,a,r,c,l=He(t),d=He(t)&&(a=(i=t).getBoundingClientRect(),r=Xe(a.width)/i.offsetWidth||1,c=Xe(a.height)/i.offsetHeight||1,1!==r||1!==c),u=tt(t),m=Ke(e,d,n),h={scrollLeft:0,scrollTop:0},p={x:0,y:0};return(l||!l&&!n)&&(("body"!==Ne(t)||_t(u))&&(h=(o=t)!==Re(o)&&He(o)?{scrollLeft:(s=o).scrollLeft,scrollTop:s.scrollTop}:wt(o)),He(t)?((p=Ke(t,!0)).x+=t.clientLeft,p.y+=t.clientTop):u&&(p.x=St(u))),{x:m.left+h.scrollLeft-p.x,y:m.top+h.scrollTop-p.y,width:m.width,height:m.height}}function Ot(e){var t=new Map,n=new Set,o=[];function s(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!n.has(e)){var o=t.get(e);o&&s(o)}}),o.push(e)}return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){n.has(e.name)||s(e)}),o}var Nt={placement:"bottom",modifiers:[],strategy:"absolute"};function Rt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}function Ft(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,o=void 0===n?[]:n,s=t.defaultOptions,i=void 0===s?Nt:s;return function(e,t,n){void 0===n&&(n=i);var s,a,r={placement:"bottom",orderedModifiers:[],options:Object.assign({},Nt,i),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],l=!1,d={state:r,setOptions:function(n){var s="function"==typeof n?n(r.options):n;u(),r.options=Object.assign({},i,r.options,s),r.scrollParents={reference:Fe(e)?Ct(e):e.contextElement?Ct(e.contextElement):[],popper:Ct(t)};var a,l,m,h,p=(a=[].concat(o,r.options.modifiers),l=a.reduce(function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e},{}),m=Object.keys(l).map(function(e){return l[e]}),h=Ot(m),Oe.reduce(function(e,t){return e.concat(h.filter(function(e){return e.phase===t}))},[]));return r.orderedModifiers=p.filter(function(e){return e.enabled}),r.orderedModifiers.forEach(function(e){var t=e.name,n=e.options,o=void 0===n?{}:n,s=e.effect;if("function"==typeof s){var i=s({state:r,name:t,instance:d,options:o});c.push(i||function(){})}}),d.update()},forceUpdate:function(){if(!l){var e=r.elements,t=e.reference,n=e.popper;if(Rt(t,n)){r.rects={reference:qt(t,st(n),"fixed"===r.options.strategy),popper:Je(n)},r.reset=!1,r.placement=r.options.placement,r.orderedModifiers.forEach(function(e){return r.modifiersData[e.name]=Object.assign({},e.data)});for(var o=0;o<r.orderedModifiers.length;o++)if(!0!==r.reset){var s=r.orderedModifiers[o],i=s.fn,a=s.options,c=void 0===a?{}:a,u=s.name;"function"==typeof i&&(r=i({state:r,options:c,name:u,instance:d})||r)}else r.reset=!1,o=-1}}},update:(s=function(){return new Promise(function(e){d.forceUpdate(),e(r)})},function(){return a||(a=new Promise(function(e){Promise.resolve().then(function(){a=void 0,e(s())})})),a}),destroy:function(){u(),l=!0}};if(!Rt(e,t))return d;function u(){c.forEach(function(e){return e()}),c=[]}return d.setOptions(n).then(function(e){!l&&n.onFirstUpdate&&n.onFirstUpdate(e)}),d}}var Ht=Ft(),jt=Ft({defaultModifiers:[ft,Pt,ht,ze]}),zt=Ft({defaultModifiers:[ft,Pt,ht,ze,Mt,It,Bt,lt,Dt]});const Wt=Object.freeze(Object.defineProperty({__proto__:null,afterMain:Me,afterRead:Ae,afterWrite:qe,applyStyles:ze,arrow:lt,auto:ye,basePlacements:be,beforeMain:$e,beforeRead:ke,beforeWrite:Pe,bottom:fe,clippingParents:_e,computeStyles:ht,createPopper:zt,createPopperBase:Ht,createPopperLite:jt,detectOverflow:kt,end:Se,eventListeners:ft,flip:It,hide:Dt,left:ve,main:De,modifierPhases:Oe,offset:Mt,placements:Le,popper:Ce,popperGenerator:Ft,popperOffsets:Pt,preventOverflow:Bt,read:Ie,reference:Te,right:ge,start:we,top:pe,variationPlacements:xe,viewport:Ee,write:Be},Symbol.toStringTag,{value:"Module"})),Ut="dropdown",Yt="ArrowUp",Xt="ArrowDown",Vt="click.bs.dropdown.data-api",Gt="keydown.bs.dropdown.data-api",Kt="show",Jt='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Qt=`${Jt}.show`,Zt=".dropdown-menu",en=p()?"top-end":"top-start",tn=p()?"top-start":"top-end",nn=p()?"bottom-end":"bottom-start",on=p()?"bottom-start":"bottom-end",sn=p()?"left-start":"right-start",an=p()?"right-start":"left-start",rn={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},cn={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class ln extends F{constructor(e,t){super(e,t),this._popper=null,this._parent=this._element.parentNode,this._menu=j.next(this._element,Zt)[0]||j.prev(this._element,Zt)[0]||j.findOne(Zt,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return rn}static get DefaultType(){return cn}static get NAME(){return Ut}toggle(){return this._isShown()?this.hide():this.show()}show(){if(c(this._element)||this._isShown())return;const e={relatedTarget:this._element};if(!P.trigger(this._element,"show.bs.dropdown",e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const e of[].concat(...document.body.children))P.on(e,"mouseover",d);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Kt),this._element.classList.add(Kt),P.trigger(this._element,"shown.bs.dropdown",e)}}hide(){if(c(this._element)||!this._isShown())return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!P.trigger(this._element,"hide.bs.dropdown",e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))P.off(e,"mouseover",d);this._popper&&this._popper.destroy(),this._menu.classList.remove(Kt),this._element.classList.remove(Kt),this._element.setAttribute("aria-expanded","false"),N.removeDataAttribute(this._menu,"popper"),P.trigger(this._element,"hidden.bs.dropdown",e)}}_getConfig(e){if("object"==typeof(e=super._getConfig(e)).reference&&!i(e.reference)&&"function"!=typeof e.reference.getBoundingClientRect)throw new TypeError(`${Ut.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(){if(void 0===Wt)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let e=this._element;"parent"===this._config.reference?e=this._parent:i(this._config.reference)?e=a(this._config.reference):"object"==typeof this._config.reference&&(e=this._config.reference);const t=this._getPopperConfig();this._popper=zt(e,this._menu,t)}_isShown(){return this._menu.classList.contains(Kt)}_getPlacement(){const e=this._parent;if(e.classList.contains("dropend"))return sn;if(e.classList.contains("dropstart"))return an;if(e.classList.contains("dropup-center"))return"top";if(e.classList.contains("dropdown-center"))return"bottom";const t="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return e.classList.contains("dropup")?t?tn:en:t?on:nn}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map(e=>Number.parseInt(e,10)):"function"==typeof e?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(N.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,...g(this._config.popperConfig,[e])}}_selectMenuItem({key:e,target:t}){const n=j.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(e=>r(e));n.length&&y(n,t,e===Xt,!n.includes(t)).focus()}static jQueryInterface(e){return this.each(function(){const t=ln.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}})}static clearMenus(e){if(2===e.button||"keyup"===e.type&&"Tab"!==e.key)return;const t=j.find(Qt);for(const n of t){const t=ln.getInstance(n);if(!t||!1===t._config.autoClose)continue;const o=e.composedPath(),s=o.includes(t._menu);if(o.includes(t._element)||"inside"===t._config.autoClose&&!s||"outside"===t._config.autoClose&&s)continue;if(t._menu.contains(e.target)&&("keyup"===e.type&&"Tab"===e.key||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const i={relatedTarget:t._element};"click"===e.type&&(i.clickEvent=e),t._completeHide(i)}}static dataApiKeydownHandler(e){const t=/input|textarea/i.test(e.target.tagName),n="Escape"===e.key,o=[Yt,Xt].includes(e.key);if(!o&&!n)return;if(t&&!n)return;e.preventDefault();const s=this.matches(Jt)?this:j.prev(this,Jt)[0]||j.next(this,Jt)[0]||j.findOne(Jt,e.delegateTarget.parentNode),i=ln.getOrCreateInstance(s);if(o)return e.stopPropagation(),i.show(),void i._selectMenuItem(e);i._isShown()&&(e.stopPropagation(),i.hide(),s.focus())}}P.on(document,Gt,Jt,ln.dataApiKeydownHandler),P.on(document,Gt,Zt,ln.dataApiKeydownHandler),P.on(document,Vt,ln.clearMenus),P.on(document,"keyup.bs.dropdown.data-api",ln.clearMenus),P.on(document,Vt,Jt,function(e){e.preventDefault(),ln.getOrCreateInstance(this).toggle()}),f(ln);const dn="show",un="mousedown.bs.backdrop",mn={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},hn={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class pn extends R{constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}static get Default(){return mn}static get DefaultType(){return hn}static get NAME(){return"backdrop"}show(e){if(!this._config.isVisible)return void g(e);this._append();const t=this._getElement();this._config.isAnimated&&u(t),t.classList.add(dn),this._emulateAnimation(()=>{g(e)})}hide(e){this._config.isVisible?(this._getElement().classList.remove(dn),this._emulateAnimation(()=>{this.dispose(),g(e)})):g(e)}dispose(){this._isAppended&&(P.off(this._element,un),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add("fade"),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=a(e.rootElement),e}_append(){if(this._isAppended)return;const e=this._getElement();this._config.rootElement.append(e),P.on(e,un,()=>{g(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(e){v(e,this._getElement(),this._config.isAnimated)}}const fn=".bs.focustrap",gn="backward",vn={autofocus:!0,trapElement:null},yn={autofocus:"boolean",trapElement:"element"};class bn extends R{constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return vn}static get DefaultType(){return yn}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),P.off(document,fn),P.on(document,"focusin.bs.focustrap",e=>this._handleFocusin(e)),P.on(document,"keydown.tab.bs.focustrap",e=>this._handleKeydown(e)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,P.off(document,fn))}_handleFocusin(e){const{trapElement:t}=this._config;if(e.target===document||e.target===t||t.contains(e.target))return;const n=j.focusableChildren(t);0===n.length?t.focus():this._lastTabNavDirection===gn?n[n.length-1].focus():n[0].focus()}_handleKeydown(e){"Tab"===e.key&&(this._lastTabNavDirection=e.shiftKey?gn:"forward")}}const wn=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Sn=".sticky-top",_n="padding-right",En="margin-right";class Cn{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,_n,t=>t+e),this._setElementAttributes(wn,_n,t=>t+e),this._setElementAttributes(Sn,En,t=>t-e)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,_n),this._resetElementAttributes(wn,_n),this._resetElementAttributes(Sn,En)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,t,n){const o=this.getWidth();this._applyManipulationCallback(e,e=>{if(e!==this._element&&window.innerWidth>e.clientWidth+o)return;this._saveInitialAttribute(e,t);const s=window.getComputedStyle(e).getPropertyValue(t);e.style.setProperty(t,`${n(Number.parseFloat(s))}px`)})}_saveInitialAttribute(e,t){const n=e.style.getPropertyValue(t);n&&N.setDataAttribute(e,t,n)}_resetElementAttributes(e,t){this._applyManipulationCallback(e,e=>{const n=N.getDataAttribute(e,t);null!==n?(N.removeDataAttribute(e,t),e.style.setProperty(t,n)):e.style.removeProperty(t)})}_applyManipulationCallback(e,t){if(i(e))t(e);else for(const n of j.find(e,this._element))t(n)}}const Tn=".bs.modal",xn="hidden.bs.modal",Ln="show.bs.modal",kn="modal-open",In="show",An="modal-static",$n={backdrop:!0,focus:!0,keyboard:!0},Dn={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Mn extends F{constructor(e,t){super(e,t),this._dialog=j.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Cn,this._addEventListeners()}static get Default(){return $n}static get DefaultType(){return Dn}static get NAME(){return"modal"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||this._isTransitioning||P.trigger(this._element,Ln,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(kn),this._adjustDialog(),this._backdrop.show(()=>this._showElement(e)))}hide(){this._isShown&&!this._isTransitioning&&(P.trigger(this._element,"hide.bs.modal").defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(In),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){P.off(window,Tn),P.off(this._dialog,Tn),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new pn({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new bn({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const t=j.findOne(".modal-body",this._dialog);t&&(t.scrollTop=0),u(this._element),this._element.classList.add(In),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,P.trigger(this._element,"shown.bs.modal",{relatedTarget:e})},this._dialog,this._isAnimated())}_addEventListeners(){P.on(this._element,"keydown.dismiss.bs.modal",e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),P.on(window,"resize.bs.modal",()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),P.on(this._element,"mousedown.dismiss.bs.modal",e=>{P.one(this._element,"click.dismiss.bs.modal",t=>{this._element===e.target&&this._element===t.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(kn),this._resetAdjustments(),this._scrollBar.reset(),P.trigger(this._element,xn)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(P.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._element.style.overflowY;"hidden"===t||this._element.classList.contains(An)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(An),this._queueCallback(()=>{this._element.classList.remove(An),this._queueCallback(()=>{this._element.style.overflowY=t},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),n=t>0;if(n&&!e){const e=p()?"paddingLeft":"paddingRight";this._element.style[e]=`${t}px`}if(!n&&e){const e=p()?"paddingRight":"paddingLeft";this._element.style[e]=`${t}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,t){return this.each(function(){const n=Mn.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===n[e])throw new TypeError(`No method named "${e}"`);n[e](t)}})}}P.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',function(e){const t=j.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&e.preventDefault(),P.one(t,Ln,e=>{e.defaultPrevented||P.one(t,xn,()=>{r(this)&&this.focus()})});const n=j.findOne(".modal.show");n&&Mn.getInstance(n).hide(),Mn.getOrCreateInstance(t).toggle(this)}),z(Mn),f(Mn);const Pn="show",Bn="showing",qn="hiding",On=".offcanvas.show",Nn="hidePrevented.bs.offcanvas",Rn="hidden.bs.offcanvas",Fn={backdrop:!0,keyboard:!0,scroll:!1},Hn={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class jn extends F{constructor(e,t){super(e,t),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Fn}static get DefaultType(){return Hn}static get NAME(){return"offcanvas"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||P.trigger(this._element,"show.bs.offcanvas",{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||(new Cn).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Bn),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Pn),this._element.classList.remove(Bn),P.trigger(this._element,"shown.bs.offcanvas",{relatedTarget:e})},this._element,!0))}hide(){this._isShown&&(P.trigger(this._element,"hide.bs.offcanvas").defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(qn),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Pn,qn),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new Cn).reset(),P.trigger(this._element,Rn)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const e=Boolean(this._config.backdrop);return new pn({className:"offcanvas-backdrop",isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?()=>{"static"!==this._config.backdrop?this.hide():P.trigger(this._element,Nn)}:null})}_initializeFocusTrap(){return new bn({trapElement:this._element})}_addEventListeners(){P.on(this._element,"keydown.dismiss.bs.offcanvas",e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():P.trigger(this._element,Nn))})}static jQueryInterface(e){return this.each(function(){const t=jn.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e](this)}})}}P.on(document,"click.bs.offcanvas.data-api",'[data-bs-toggle="offcanvas"]',function(e){const t=j.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&e.preventDefault(),c(this))return;P.one(t,Rn,()=>{r(this)&&this.focus()});const n=j.findOne(On);n&&n!==t&&jn.getInstance(n).hide(),jn.getOrCreateInstance(t).toggle(this)}),P.on(window,"load.bs.offcanvas.data-api",()=>{for(const e of j.find(On))jn.getOrCreateInstance(e).show()}),P.on(window,"resize.bs.offcanvas",()=>{for(const e of j.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(e).position&&jn.getOrCreateInstance(e).hide()}),z(jn),f(jn);const zn={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Wn=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Un=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Yn=(e,t)=>{const n=e.nodeName.toLowerCase();return t.includes(n)?!Wn.has(n)||Boolean(Un.test(e.nodeValue)):t.filter(e=>e instanceof RegExp).some(e=>e.test(n))},Xn={allowList:zn,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Vn={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Gn={entry:"(string|element|function|null)",selector:"(string|element)"};class Kn extends R{constructor(e){super(),this._config=this._getConfig(e)}static get Default(){return Xn}static get DefaultType(){return Vn}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(e=>this._resolvePossibleFunction(e)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content={...this._config.content,...e},this}toHtml(){const e=document.createElement("div");e.innerHTML=this._maybeSanitize(this._config.template);for(const[o,s]of Object.entries(this._config.content))this._setContent(e,s,o);const t=e.children[0],n=this._resolvePossibleFunction(this._config.extraClass);return n&&t.classList.add(...n.split(" ")),t}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[t,n]of Object.entries(e))super._typeCheckConfig({selector:t,entry:n},Gn)}_setContent(e,t,n){const o=j.findOne(n,e);o&&((t=this._resolvePossibleFunction(t))?i(t)?this._putElementInTemplate(a(t),o):this._config.html?o.innerHTML=this._maybeSanitize(t):o.textContent=t:o.remove())}_maybeSanitize(e){return this._config.sanitize?function(e,t,n){if(!e.length)return e;if(n&&"function"==typeof n)return n(e);const o=(new window.DOMParser).parseFromString(e,"text/html"),s=[].concat(...o.body.querySelectorAll("*"));for(const i of s){const e=i.nodeName.toLowerCase();if(!Object.keys(t).includes(e)){i.remove();continue}const n=[].concat(...i.attributes),o=[].concat(t["*"]||[],t[e]||[]);for(const t of n)Yn(t,o)||i.removeAttribute(t.nodeName)}return o.body.innerHTML}(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return g(e,[this])}_putElementInTemplate(e,t){if(this._config.html)return t.innerHTML="",void t.append(e);t.textContent=e.textContent}}const Jn=new Set(["sanitize","allowList","sanitizeFn"]),Qn="fade",Zn="show",eo=".modal",to="hide.bs.modal",no="hover",oo="focus",so={AUTO:"auto",TOP:"top",RIGHT:p()?"left":"right",BOTTOM:"bottom",LEFT:p()?"right":"left"},io={allowList:zn,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},ao={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class ro extends F{constructor(e,t){if(void 0===Wt)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e,t),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return io}static get DefaultType(){return ao}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),P.off(this._element.closest(eo),to,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const e=P.trigger(this._element,this.constructor.eventName("show")),t=(l(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(e.defaultPrevented||!t)return;this._disposePopper();const n=this._getTipElement();this._element.setAttribute("aria-describedby",n.getAttribute("id"));const{container:o}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(o.append(n),P.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(n),n.classList.add(Zn),"ontouchstart"in document.documentElement)for(const s of[].concat(...document.body.children))P.on(s,"mouseover",d);this._queueCallback(()=>{P.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!P.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Zn),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))P.off(e,"mouseover",d);this._activeTrigger.click=!1,this._activeTrigger.focus=!1,this._activeTrigger.hover=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),P.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const t=this._getTemplateFactory(e).toHtml();if(!t)return null;t.classList.remove(Qn,Zn),t.classList.add(`bs-${this.constructor.NAME}-auto`);const n=(e=>{do{e+=Math.floor(1e6*Math.random())}while(document.getElementById(e));return e})(this.constructor.NAME).toString();return t.setAttribute("id",n),this._isAnimated()&&t.classList.add(Qn),t}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new Kn({...this._config,content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Qn)}_isShown(){return this.tip&&this.tip.classList.contains(Zn)}_createPopper(e){const t=g(this._config.placement,[this,e,this._element]),n=so[t.toUpperCase()];return zt(this._element,e,this._getPopperConfig(n))}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map(e=>Number.parseInt(e,10)):"function"==typeof e?t=>e(t,this._element):e}_resolvePossibleFunction(e){return g(e,[this._element])}_getPopperConfig(e){const t={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:e=>{this._getTipElement().setAttribute("data-popper-placement",e.state.placement)}}]};return{...t,...g(this._config.popperConfig,[t])}}_setListeners(){const e=this._config.trigger.split(" ");for(const t of e)if("click"===t)P.on(this._element,this.constructor.eventName("click"),this._config.selector,e=>{this._initializeOnDelegatedTarget(e).toggle()});else if("manual"!==t){const e=t===no?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),n=t===no?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");P.on(this._element,e,this._config.selector,e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusin"===e.type?oo:no]=!0,t._enter()}),P.on(this._element,n,this._config.selector,e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusout"===e.type?oo:no]=t._element.contains(e.relatedTarget),t._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},P.on(this._element.closest(eo),to,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title");e&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(e,t){clearTimeout(this._timeout),this._timeout=setTimeout(e,t)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const t=N.getDataAttributes(this._element);for(const n of Object.keys(t))Jn.has(n)&&delete t[n];return e={...t,..."object"==typeof e&&e?e:{}},e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=!1===e.container?document.body:a(e.container),"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),"number"==typeof e.title&&(e.title=e.title.toString()),"number"==typeof e.content&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={};for(const[t,n]of Object.entries(this._config))this.constructor.Default[t]!==n&&(e[t]=n);return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each(function(){const t=ro.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}})}}f(ro);const co={...ro.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},lo={...ro.DefaultType,content:"(null|string|element|function)"};class uo extends ro{static get Default(){return co}static get DefaultType(){return lo}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each(function(){const t=uo.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}})}}f(uo);const mo="click.bs.scrollspy",ho="active",po="[href]",fo={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},go={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class vo extends F{constructor(e,t){super(e,t),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return fo}static get DefaultType(){return go}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const e of this._observableSections.values())this._observer.observe(e)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(e){return e.target=a(e.target)||document.body,e.rootMargin=e.offset?`${e.offset}px 0px -30%`:e.rootMargin,"string"==typeof e.threshold&&(e.threshold=e.threshold.split(",").map(e=>Number.parseFloat(e))),e}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(P.off(this._config.target,mo),P.on(this._config.target,mo,po,e=>{const t=this._observableSections.get(e.target.hash);if(t){e.preventDefault();const n=this._rootElement||window,o=t.offsetTop-this._element.offsetTop;if(n.scrollTo)return void n.scrollTo({top:o,behavior:"smooth"});n.scrollTop=o}}))}_getNewObserver(){const e={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(e=>this._observerCallback(e),e)}_observerCallback(e){const t=e=>this._targetLinks.get(`#${e.target.id}`),n=e=>{this._previousScrollData.visibleEntryTop=e.target.offsetTop,this._process(t(e))},o=(this._rootElement||document.documentElement).scrollTop,s=o>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=o;for(const i of e){if(!i.isIntersecting){this._activeTarget=null,this._clearActiveClass(t(i));continue}const e=i.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(s&&e){if(n(i),!o)return}else s||e||n(i)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const e=j.find(po,this._config.target);for(const t of e){if(!t.hash||c(t))continue;const e=j.findOne(decodeURI(t.hash),this._element);r(e)&&(this._targetLinks.set(decodeURI(t.hash),t),this._observableSections.set(t.hash,e))}}_process(e){this._activeTarget!==e&&(this._clearActiveClass(this._config.target),this._activeTarget=e,e.classList.add(ho),this._activateParents(e),P.trigger(this._element,"activate.bs.scrollspy",{relatedTarget:e}))}_activateParents(e){if(e.classList.contains("dropdown-item"))j.findOne(".dropdown-toggle",e.closest(".dropdown")).classList.add(ho);else for(const t of j.parents(e,".nav, .list-group"))for(const e of j.prev(t,".nav-link, .nav-item > .nav-link, .list-group-item"))e.classList.add(ho)}_clearActiveClass(e){e.classList.remove(ho);const t=j.find("[href].active",e);for(const n of t)n.classList.remove(ho)}static jQueryInterface(e){return this.each(function(){const t=vo.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e]()}})}}P.on(window,"load.bs.scrollspy.data-api",()=>{for(const e of j.find('[data-bs-spy="scroll"]'))vo.getOrCreateInstance(e)}),f(vo);const yo="ArrowLeft",bo="ArrowRight",wo="ArrowUp",So="ArrowDown",_o="active",Eo="fade",Co="show",To='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',xo=`.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), ${To}`;class Lo extends F{constructor(e){super(e),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),P.on(this._element,"keydown.bs.tab",e=>this._keydown(e)))}static get NAME(){return"tab"}show(){const e=this._element;if(this._elemIsActive(e))return;const t=this._getActiveElem(),n=t?P.trigger(t,"hide.bs.tab",{relatedTarget:e}):null;P.trigger(e,"show.bs.tab",{relatedTarget:t}).defaultPrevented||n&&n.defaultPrevented||(this._deactivate(t,e),this._activate(e,t))}_activate(e,t){e&&(e.classList.add(_o),this._activate(j.getElementFromSelector(e)),this._queueCallback(()=>{"tab"===e.getAttribute("role")?(e.removeAttribute("tabindex"),e.setAttribute("aria-selected",!0),this._toggleDropDown(e,!0),P.trigger(e,"shown.bs.tab",{relatedTarget:t})):e.classList.add(Co)},e,e.classList.contains(Eo)))}_deactivate(e,t){e&&(e.classList.remove(_o),e.blur(),this._deactivate(j.getElementFromSelector(e)),this._queueCallback(()=>{"tab"===e.getAttribute("role")?(e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1"),this._toggleDropDown(e,!1),P.trigger(e,"hidden.bs.tab",{relatedTarget:t})):e.classList.remove(Co)},e,e.classList.contains(Eo)))}_keydown(e){if(![yo,bo,wo,So].includes(e.key))return;e.stopPropagation(),e.preventDefault();const t=[bo,So].includes(e.key),n=y(this._getChildren().filter(e=>!c(e)),e.target,t,!0);n&&(n.focus({preventScroll:!0}),Lo.getOrCreateInstance(n).show())}_getChildren(){return j.find(xo,this._parent)}_getActiveElem(){return this._getChildren().find(e=>this._elemIsActive(e))||null}_setInitialAttributes(e,t){this._setAttributeIfNotExists(e,"role","tablist");for(const n of t)this._setInitialAttributesOnChild(n)}_setInitialAttributesOnChild(e){e=this._getInnerElement(e);const t=this._elemIsActive(e),n=this._getOuterElement(e);e.setAttribute("aria-selected",t),n!==e&&this._setAttributeIfNotExists(n,"role","presentation"),t||e.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(e,"role","tab"),this._setInitialAttributesOnTargetPanel(e)}_setInitialAttributesOnTargetPanel(e){const t=j.getElementFromSelector(e);t&&(this._setAttributeIfNotExists(t,"role","tabpanel"),e.id&&this._setAttributeIfNotExists(t,"aria-labelledby",`${e.id}`))}_toggleDropDown(e,t){const n=this._getOuterElement(e);if(!n.classList.contains("dropdown"))return;const o=(e,o)=>{const s=j.findOne(e,n);s&&s.classList.toggle(o,t)};o(".dropdown-toggle",_o),o(".dropdown-menu",Co),n.setAttribute("aria-expanded",t)}_setAttributeIfNotExists(e,t,n){e.hasAttribute(t)||e.setAttribute(t,n)}_elemIsActive(e){return e.classList.contains(_o)}_getInnerElement(e){return e.matches(xo)?e:j.findOne(xo,e)}_getOuterElement(e){return e.closest(".nav-item, .list-group-item")||e}static jQueryInterface(e){return this.each(function(){const t=Lo.getOrCreateInstance(this);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e]()}})}}P.on(document,"click.bs.tab",To,function(e){["A","AREA"].includes(this.tagName)&&e.preventDefault(),c(this)||Lo.getOrCreateInstance(this).show()}),P.on(window,"load.bs.tab",()=>{for(const e of j.find('.active[data-bs-toggle="tab"], .active[data-bs-toggle="pill"], .active[data-bs-toggle="list"]'))Lo.getOrCreateInstance(e)}),f(Lo);const ko="hide",Io="show",Ao="showing",$o={animation:"boolean",autohide:"boolean",delay:"number"},Do={animation:!0,autohide:!0,delay:5e3};class Mo extends F{constructor(e,t){super(e,t),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Do}static get DefaultType(){return $o}static get NAME(){return"toast"}show(){P.trigger(this._element,"show.bs.toast").defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(ko),u(this._element),this._element.classList.add(Io,Ao),this._queueCallback(()=>{this._element.classList.remove(Ao),P.trigger(this._element,"shown.bs.toast"),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(P.trigger(this._element,"hide.bs.toast").defaultPrevented||(this._element.classList.add(Ao),this._queueCallback(()=>{this._element.classList.add(ko),this._element.classList.remove(Ao,Io),P.trigger(this._element,"hidden.bs.toast")},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Io),super.dispose()}isShown(){return this._element.classList.contains(Io)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(e,t){switch(e.type){case"mouseover":case"mouseout":this._hasMouseInteraction=t;break;case"focusin":case"focusout":this._hasKeyboardInteraction=t}if(t)return void this._clearTimeout();const n=e.relatedTarget;this._element===n||this._element.contains(n)||this._maybeScheduleHide()}_setListeners(){P.on(this._element,"mouseover.bs.toast",e=>this._onInteraction(e,!0)),P.on(this._element,"mouseout.bs.toast",e=>this._onInteraction(e,!1)),P.on(this._element,"focusin.bs.toast",e=>this._onInteraction(e,!0)),P.on(this._element,"focusout.bs.toast",e=>this._onInteraction(e,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each(function(){const t=Mo.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e](this)}})}}return z(Mo),f(Mo),{Alert:W,Button:Y,Carousel:ae,Collapse:he,Dropdown:ln,Modal:Mn,Offcanvas:jn,Popover:uo,ScrollSpy:vo,Tab:Lo,Toast:Mo,Tooltip:ro}}),function(n,o){"function"==typeof define&&define.amd?define([],function(){return n.Waves=o.call(n),n.Waves}):"object"==typeof e?t.exports=o.call(n):n.Waves=o.call(n)}("object"==typeof global?global:void 0,function(){function e(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function t(t){var n=c.call(t);return"[object String]"===n?r(t):e(t)&&/^\[object (Array|HTMLCollection|NodeList|Object)\]$/.test(n)&&t.hasOwnProperty("length")?t:function(t){return e(t)&&t.nodeType>0}(t)?[t]:[]}function n(e){var t,n,o={top:0,left:0},s=e&&e.ownerDocument;return t=s.documentElement,void 0!==e.getBoundingClientRect&&(o=e.getBoundingClientRect()),n=function(e){return null!==(t=e)&&t===t.window?e:9===e.nodeType&&e.defaultView;var t}(s),{top:o.top+n.pageYOffset-t.clientTop,left:o.left+n.pageXOffset-t.clientLeft}}function o(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+=n+":"+e[n]+";");return t}function s(e,t,n){if(n){n.classList.remove("waves-rippling");var s=n.getAttribute("data-x"),i=n.getAttribute("data-y"),a=n.getAttribute("data-scale"),r=n.getAttribute("data-translate"),c=350-(Date.now()-Number(n.getAttribute("data-hold")));c<0&&(c=0),"mousemove"===e.type&&(c=150);var l="mousemove"===e.type?2500:d.duration;setTimeout(function(){var e={top:i+"px",left:s+"px",opacity:"0","-webkit-transition-duration":l+"ms","-moz-transition-duration":l+"ms","-o-transition-duration":l+"ms","transition-duration":l+"ms","-webkit-transform":a+" "+r,"-moz-transform":a+" "+r,"-ms-transform":a+" "+r,"-o-transform":a+" "+r,transform:a+" "+r};n.setAttribute("style",o(e)),setTimeout(function(){try{t.removeChild(n)}catch(e){return!1}},l)},c)}}function i(e){var t=function(e){if(!1===m.allowEvent(e))return null;for(var t=null,n=e.target||e.srcElement;n.parentElement;){if(!(n instanceof SVGElement)&&n.classList.contains("waves-effect")){t=n;break}n=n.parentElement}return t}(e);if(null!==t){if(t.disabled||t.getAttribute("disabled")||t.classList.contains("disabled"))return;if(m.registerEvent(e),"touchstart"===e.type&&d.delay){var n=!1,o=setTimeout(function(){o=null,d.show(e,t)},d.delay),s=function(s){o&&(clearTimeout(o),o=null,d.show(e,t)),n||(n=!0,d.hide(s,t)),a()},i=function(e){o&&(clearTimeout(o),o=null),s(e),a()};t.addEventListener("touchmove",i,!1),t.addEventListener("touchend",s,!1),t.addEventListener("touchcancel",s,!1);var a=function(){t.removeEventListener("touchmove",i),t.removeEventListener("touchend",s),t.removeEventListener("touchcancel",s)}}else d.show(e,t),l&&(t.addEventListener("touchend",d.hide,!1),t.addEventListener("touchcancel",d.hide,!1)),t.addEventListener("mouseup",d.hide,!1),t.addEventListener("mouseleave",d.hide,!1)}}var a=a||{},r=document.querySelectorAll.bind(document),c=Object.prototype.toString,l="ontouchstart"in window,d={duration:750,delay:200,show:function(e,t,s){if(2===e.button)return!1;t=t||this;var i=document.createElement("div");i.className="waves-ripple waves-rippling",t.appendChild(i);var a=n(t),r=0,c=0;"touches"in e&&e.touches.length?(r=e.touches[0].pageY-a.top,c=e.touches[0].pageX-a.left):(r=e.pageY-a.top,c=e.pageX-a.left),c=c>=0?c:0,r=r>=0?r:0;var l="scale("+t.clientWidth/100*3+")",u="translate(0,0)";s&&(u="translate("+s.x+"px, "+s.y+"px)"),i.setAttribute("data-hold",Date.now()),i.setAttribute("data-x",c),i.setAttribute("data-y",r),i.setAttribute("data-scale",l),i.setAttribute("data-translate",u);var m={top:r+"px",left:c+"px"};i.classList.add("waves-notransition"),i.setAttribute("style",o(m)),i.classList.remove("waves-notransition"),m["-webkit-transform"]=l+" "+u,m["-moz-transform"]=l+" "+u,m["-ms-transform"]=l+" "+u,m["-o-transform"]=l+" "+u,m.transform=l+" "+u,m.opacity="1";var h="mousemove"===e.type?2500:d.duration;m["-webkit-transition-duration"]=h+"ms",m["-moz-transition-duration"]=h+"ms",m["-o-transition-duration"]=h+"ms",m["transition-duration"]=h+"ms",i.setAttribute("style",o(m))},hide:function(e,t){for(var n=(t=t||this).getElementsByClassName("waves-rippling"),o=0,i=n.length;o<i;o++)s(e,t,n[o]);l&&(t.removeEventListener("touchend",d.hide),t.removeEventListener("touchcancel",d.hide)),t.removeEventListener("mouseup",d.hide),t.removeEventListener("mouseleave",d.hide)}},u={input:function(e){var t=e.parentNode;if("i"!==t.tagName.toLowerCase()||!t.classList.contains("waves-effect")){var n=document.createElement("i");n.className=e.className+" waves-input-wrapper",e.className="waves-button-input",t.replaceChild(n,e),n.appendChild(e);var o=window.getComputedStyle(e,null),s=o.color,i=o.backgroundColor;n.setAttribute("style","color:"+s+";background:"+i),e.setAttribute("style","background-color:rgba(0,0,0,0);")}},img:function(e){var t=e.parentNode;if("i"!==t.tagName.toLowerCase()||!t.classList.contains("waves-effect")){var n=document.createElement("i");t.replaceChild(n,e),n.appendChild(e)}}},m={touches:0,allowEvent:function(e){var t=!0;return/^(mousedown|mousemove)$/.test(e.type)&&m.touches&&(t=!1),t},registerEvent:function(e){var t=e.type;"touchstart"===t?m.touches+=1:/^(touchend|touchcancel)$/.test(t)&&setTimeout(function(){m.touches&&(m.touches-=1)},500)}};return a.init=function(e){var t=document.body;"duration"in(e=e||{})&&(d.duration=e.duration),"delay"in e&&(d.delay=e.delay),l&&(t.addEventListener("touchstart",i,!1),t.addEventListener("touchcancel",m.registerEvent,!1),t.addEventListener("touchend",m.registerEvent,!1)),t.addEventListener("mousedown",i,!1)},a.attach=function(e,n){e=t(e),"[object Array]"===c.call(n)&&(n=n.join(" ")),n=n?" "+n:"";for(var o,s,i=0,a=e.length;i<a;i++)s=(o=e[i]).tagName.toLowerCase(),-1!==["input","img"].indexOf(s)&&(u[s](o),o=o.parentElement),-1===o.className.indexOf("waves-effect")&&(o.className+=" waves-effect"+n)},a.ripple=function(e,o){var s=(e=t(e)).length;if((o=o||{}).wait=o.wait||0,o.position=o.position||null,s)for(var i,a,r,c={},l=0,u={type:"mousedown",button:1};l<s;l++)i=e[l],a=o.position||{x:i.clientWidth/2,y:i.clientHeight/2},r=n(i),c.x=r.left+a.x,c.y=r.top+a.y,u.pageX=c.x,u.pageY=c.y,d.show(u,i),o.wait>=0&&null!==o.wait&&setTimeout(function(e,t){return function(){d.hide(e,t)}}({type:"mouseup",button:1},i),o.wait)},a.calm=function(e){for(var n={type:"mouseup",button:1},o=0,s=(e=t(e)).length;o<s;o++)d.hide(n,e[o])},a.displayEffect=function(e){a.init(e)},a}),
/*!
     * perfect-scrollbar v1.5.3
     * Copyright 2021 Hyunje Jun, MDBootstrap and Contributors
     * Licensed under MIT
     */
a=void 0,r=function(){var e=Math.abs,t=Math.floor;function n(e){return getComputedStyle(e)}function o(e,t){for(var n in t){var o=t[n];"number"==typeof o&&(o+="px"),e.style[n]=o}return e}function s(e){var t=document.createElement("div");return t.className=e,t}function i(e,t){if(!g)throw new Error("No element matching method supported");return g.call(e,t)}function a(e){e.remove?e.remove():e.parentNode&&e.parentNode.removeChild(e)}function r(e,t){return Array.prototype.filter.call(e.children,function(e){return i(e,t)})}function c(e,t){var n=e.element.classList,o=v.state.scrolling(t);n.contains(o)?clearTimeout(y[t]):n.add(o)}function l(e,t){y[t]=setTimeout(function(){return e.isAlive&&e.element.classList.remove(v.state.scrolling(t))},e.settings.scrollingThreshold)}function d(e){if("function"==typeof window.CustomEvent)return new CustomEvent(e);var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,!1,!1,void 0),t}function u(e,t,n,o,s){var i;if(void 0===o&&(o=!0),void 0===s&&(s=!1),"top"===t)i=["contentHeight","containerHeight","scrollTop","y","up","down"];else{if("left"!==t)throw new Error("A proper axis should be provided");i=["contentWidth","containerWidth","scrollLeft","x","left","right"]}!function(e,t,n,o,s){var i=n[0],a=n[1],r=n[2],u=n[3],m=n[4],h=n[5];void 0===o&&(o=!0),void 0===s&&(s=!1);var p=e.element;e.reach[u]=null,1>p[r]&&(e.reach[u]="start"),p[r]>e[i]-e[a]-1&&(e.reach[u]="end"),t&&(p.dispatchEvent(d("ps-scroll-"+u)),0>t?p.dispatchEvent(d("ps-scroll-"+m)):0<t&&p.dispatchEvent(d("ps-scroll-"+h)),o&&function(e,t){c(e,t),l(e,t)}(e,u)),e.reach[u]&&(t||s)&&p.dispatchEvent(d("ps-"+u+"-reach-"+e.reach[u]))}(e,n,i,o,s)}function m(e){return parseInt(e,10)||0}function h(e){var n=Math.round,s=e.element,i=t(s.scrollTop),c=s.getBoundingClientRect();e.containerWidth=n(c.width),e.containerHeight=n(c.height),e.contentWidth=s.scrollWidth,e.contentHeight=s.scrollHeight,s.contains(e.scrollbarXRail)||(r(s,v.element.rail("x")).forEach(function(e){return a(e)}),s.appendChild(e.scrollbarXRail)),s.contains(e.scrollbarYRail)||(r(s,v.element.rail("y")).forEach(function(e){return a(e)}),s.appendChild(e.scrollbarYRail)),!e.settings.suppressScrollX&&e.containerWidth+e.settings.scrollXMarginOffset<e.contentWidth?(e.scrollbarXActive=!0,e.railXWidth=e.containerWidth-e.railXMarginWidth,e.railXRatio=e.containerWidth/e.railXWidth,e.scrollbarXWidth=p(e,m(e.railXWidth*e.containerWidth/e.contentWidth)),e.scrollbarXLeft=m((e.negativeScrollAdjustment+s.scrollLeft)*(e.railXWidth-e.scrollbarXWidth)/(e.contentWidth-e.containerWidth))):e.scrollbarXActive=!1,!e.settings.suppressScrollY&&e.containerHeight+e.settings.scrollYMarginOffset<e.contentHeight?(e.scrollbarYActive=!0,e.railYHeight=e.containerHeight-e.railYMarginHeight,e.railYRatio=e.containerHeight/e.railYHeight,e.scrollbarYHeight=p(e,m(e.railYHeight*e.containerHeight/e.contentHeight)),e.scrollbarYTop=m(i*(e.railYHeight-e.scrollbarYHeight)/(e.contentHeight-e.containerHeight))):e.scrollbarYActive=!1,e.scrollbarXLeft>=e.railXWidth-e.scrollbarXWidth&&(e.scrollbarXLeft=e.railXWidth-e.scrollbarXWidth),e.scrollbarYTop>=e.railYHeight-e.scrollbarYHeight&&(e.scrollbarYTop=e.railYHeight-e.scrollbarYHeight),function(e,n){var s={width:n.railXWidth},i=t(e.scrollTop);s.left=n.isRtl?n.negativeScrollAdjustment+e.scrollLeft+n.containerWidth-n.contentWidth:e.scrollLeft,n.isScrollbarXUsingBottom?s.bottom=n.scrollbarXBottom-i:s.top=n.scrollbarXTop+i,o(n.scrollbarXRail,s);var a={top:i,height:n.railYHeight};n.isScrollbarYUsingRight?n.isRtl?a.right=n.contentWidth-(n.negativeScrollAdjustment+e.scrollLeft)-n.scrollbarYRight-n.scrollbarYOuterWidth-9:a.right=n.scrollbarYRight-e.scrollLeft:n.isRtl?a.left=n.negativeScrollAdjustment+e.scrollLeft+2*n.containerWidth-n.contentWidth-n.scrollbarYLeft-n.scrollbarYOuterWidth:a.left=n.scrollbarYLeft+e.scrollLeft,o(n.scrollbarYRail,a),o(n.scrollbarX,{left:n.scrollbarXLeft,width:n.scrollbarXWidth-n.railBorderXWidth}),o(n.scrollbarY,{top:n.scrollbarYTop,height:n.scrollbarYHeight-n.railBorderYWidth})}(s,e),e.scrollbarXActive?s.classList.add(v.state.active("x")):(s.classList.remove(v.state.active("x")),e.scrollbarXWidth=0,e.scrollbarXLeft=0,s.scrollLeft=!0===e.isRtl?e.contentWidth:0),e.scrollbarYActive?s.classList.add(v.state.active("y")):(s.classList.remove(v.state.active("y")),e.scrollbarYHeight=0,e.scrollbarYTop=0,s.scrollTop=0)}function p(e,t){var n=Math.min,o=Math.max;return e.settings.minScrollbarLength&&(t=o(t,e.settings.minScrollbarLength)),e.settings.maxScrollbarLength&&(t=n(t,e.settings.maxScrollbarLength)),t}function f(e,t){function n(t){t.touches&&t.touches[0]&&(t[r]=t.touches[0].pageY),y[p]=b+S*(t[r]-w),c(e,f),h(e),t.stopPropagation(),t.type.startsWith("touch")&&1<t.changedTouches.length&&t.preventDefault()}function o(){l(e,f),e[g].classList.remove(v.state.clicking),e.event.unbind(e.ownerDocument,"mousemove",n)}function s(t,s){b=y[p],s&&t.touches&&(t[r]=t.touches[0].pageY),w=t[r],S=(e[a]-e[i])/(e[d]-e[m]),s?e.event.bind(e.ownerDocument,"touchmove",n):(e.event.bind(e.ownerDocument,"mousemove",n),e.event.once(e.ownerDocument,"mouseup",o),t.preventDefault()),e[g].classList.add(v.state.clicking),t.stopPropagation()}var i=t[0],a=t[1],r=t[2],d=t[3],u=t[4],m=t[5],p=t[6],f=t[7],g=t[8],y=e.element,b=null,w=null,S=null;e.event.bind(e[u],"mousedown",function(e){s(e)}),e.event.bind(e[u],"touchstart",function(e){s(e,!0)})}var g="undefined"!=typeof Element&&(Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector),v={main:"ps",rtl:"ps__rtl",element:{thumb:function(e){return"ps__thumb-"+e},rail:function(e){return"ps__rail-"+e},consuming:"ps__child--consume"},state:{focus:"ps--focus",clicking:"ps--clicking",active:function(e){return"ps--active-"+e},scrolling:function(e){return"ps--scrolling-"+e}}},y={x:null,y:null},b=function(e){this.element=e,this.handlers={}},w={isEmpty:{configurable:!0}};b.prototype.bind=function(e,t){void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t),this.element.addEventListener(e,t,!1)},b.prototype.unbind=function(e,t){var n=this;this.handlers[e]=this.handlers[e].filter(function(o){return!(!t||o===t)||(n.element.removeEventListener(e,o,!1),!1)})},b.prototype.unbindAll=function(){for(var e in this.handlers)this.unbind(e)},w.isEmpty.get=function(){var e=this;return Object.keys(this.handlers).every(function(t){return 0===e.handlers[t].length})},Object.defineProperties(b.prototype,w);var S=function(){this.eventElements=[]};S.prototype.eventElement=function(e){var t=this.eventElements.filter(function(t){return t.element===e})[0];return t||(t=new b(e),this.eventElements.push(t)),t},S.prototype.bind=function(e,t,n){this.eventElement(e).bind(t,n)},S.prototype.unbind=function(e,t,n){var o=this.eventElement(e);o.unbind(t,n),o.isEmpty&&this.eventElements.splice(this.eventElements.indexOf(o),1)},S.prototype.unbindAll=function(){this.eventElements.forEach(function(e){return e.unbindAll()}),this.eventElements=[]},S.prototype.once=function(e,t,n){var o=this.eventElement(e),s=function(e){o.unbind(t,s),n(e)};o.bind(t,s)};var _={isWebKit:"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style,supportsTouch:"undefined"!=typeof window&&("ontouchstart"in window||"maxTouchPoints"in window.navigator&&0<window.navigator.maxTouchPoints||window.DocumentTouch&&document instanceof window.DocumentTouch),supportsIePointer:"undefined"!=typeof navigator&&navigator.msMaxTouchPoints,isChrome:"undefined"!=typeof navigator&&/Chrome/i.test(navigator&&navigator.userAgent)},E={"click-rail":function(e){e.element,e.event.bind(e.scrollbarY,"mousedown",function(e){return e.stopPropagation()}),e.event.bind(e.scrollbarYRail,"mousedown",function(t){var n=t.pageY-window.pageYOffset-e.scrollbarYRail.getBoundingClientRect().top>e.scrollbarYTop?1:-1;e.element.scrollTop+=n*e.containerHeight,h(e),t.stopPropagation()}),e.event.bind(e.scrollbarX,"mousedown",function(e){return e.stopPropagation()}),e.event.bind(e.scrollbarXRail,"mousedown",function(t){var n=t.pageX-window.pageXOffset-e.scrollbarXRail.getBoundingClientRect().left>e.scrollbarXLeft?1:-1;e.element.scrollLeft+=n*e.containerWidth,h(e),t.stopPropagation()})},"drag-thumb":function(e){f(e,["containerWidth","contentWidth","pageX","railXWidth","scrollbarX","scrollbarXWidth","scrollLeft","x","scrollbarXRail"]),f(e,["containerHeight","contentHeight","pageY","railYHeight","scrollbarY","scrollbarYHeight","scrollTop","y","scrollbarYRail"])},keyboard:function(e){var n=e.element;e.event.bind(e.ownerDocument,"keydown",function(o){if(!(o.isDefaultPrevented&&o.isDefaultPrevented()||o.defaultPrevented)&&(i(n,":hover")||i(e.scrollbarX,":focus")||i(e.scrollbarY,":focus"))){var s=document.activeElement?document.activeElement:e.ownerDocument.activeElement;if(s){if("IFRAME"===s.tagName)s=s.contentDocument.activeElement;else for(;s.shadowRoot;)s=s.shadowRoot.activeElement;if(function(e){return i(e,"input,[contenteditable]")||i(e,"select,[contenteditable]")||i(e,"textarea,[contenteditable]")||i(e,"button,[contenteditable]")}(s))return}var a=0,r=0;switch(o.which){case 37:a=o.metaKey?-e.contentWidth:o.altKey?-e.containerWidth:-30;break;case 38:r=o.metaKey?e.contentHeight:o.altKey?e.containerHeight:30;break;case 39:a=o.metaKey?e.contentWidth:o.altKey?e.containerWidth:30;break;case 40:r=o.metaKey?-e.contentHeight:o.altKey?-e.containerHeight:-30;break;case 32:r=o.shiftKey?e.containerHeight:-e.containerHeight;break;case 33:r=e.containerHeight;break;case 34:r=-e.containerHeight;break;case 36:r=e.contentHeight;break;case 35:r=-e.contentHeight;break;default:return}e.settings.suppressScrollX&&0!==a||e.settings.suppressScrollY&&0!==r||(n.scrollTop-=r,n.scrollLeft+=a,h(e),function(o,s){var i=t(n.scrollTop);if(0===o){if(!e.scrollbarYActive)return!1;if(0===i&&0<s||i>=e.contentHeight-e.containerHeight&&0>s)return!e.settings.wheelPropagation}var a=n.scrollLeft;if(0===s){if(!e.scrollbarXActive)return!1;if(0===a&&0>o||a>=e.contentWidth-e.containerWidth&&0<o)return!e.settings.wheelPropagation}return!0}(a,r)&&o.preventDefault())}})},wheel:function(o){function s(s){var a=function(e){var t=e.deltaX,n=-1*e.deltaY;return(void 0===t||void 0===n)&&(t=-1*e.wheelDeltaX/6,n=e.wheelDeltaY/6),e.deltaMode&&1===e.deltaMode&&(t*=10,n*=10),t!=t&&n!=n&&(t=0,n=e.wheelDelta),e.shiftKey?[-n,-t]:[t,n]}(s),r=a[0],c=a[1];if(!function(e,t,o){if(!_.isWebKit&&i.querySelector("select:focus"))return!0;if(!i.contains(e))return!1;for(var s=e;s&&s!==i;){if(s.classList.contains(v.element.consuming))return!0;var a=n(s);if(o&&a.overflowY.match(/(scroll|auto)/)){var r=s.scrollHeight-s.clientHeight;if(0<r&&(0<s.scrollTop&&0>o||s.scrollTop<r&&0<o))return!0}if(t&&a.overflowX.match(/(scroll|auto)/)){var c=s.scrollWidth-s.clientWidth;if(0<c&&(0<s.scrollLeft&&0>t||s.scrollLeft<c&&0<t))return!0}s=s.parentNode}return!1}(s.target,r,c)){var l=!1;o.settings.useBothWheelAxes?o.scrollbarYActive&&!o.scrollbarXActive?(c?i.scrollTop-=c*o.settings.wheelSpeed:i.scrollTop+=r*o.settings.wheelSpeed,l=!0):o.scrollbarXActive&&!o.scrollbarYActive&&(r?i.scrollLeft+=r*o.settings.wheelSpeed:i.scrollLeft-=c*o.settings.wheelSpeed,l=!0):(i.scrollTop-=c*o.settings.wheelSpeed,i.scrollLeft+=r*o.settings.wheelSpeed),h(o),l=l||function(n,s){var a=t(i.scrollTop),r=0===i.scrollTop,c=a+i.offsetHeight===i.scrollHeight,l=0===i.scrollLeft,d=i.scrollLeft+i.offsetWidth===i.scrollWidth;return!(e(s)>e(n)?r||c:l||d)||!o.settings.wheelPropagation}(r,c),l&&!s.ctrlKey&&(s.stopPropagation(),s.preventDefault())}}var i=o.element;void 0===window.onwheel?void 0!==window.onmousewheel&&o.event.bind(i,"mousewheel",s):o.event.bind(i,"wheel",s)},touch:function(o){function s(e,t){d.scrollTop-=t,d.scrollLeft-=e,h(o)}function i(e){return e.targetTouches?e.targetTouches[0]:e}function a(e){return!(e.pointerType&&"pen"===e.pointerType&&0===e.buttons||(!e.targetTouches||1!==e.targetTouches.length)&&(!e.pointerType||"mouse"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE))}function r(e){if(a(e)){var t=i(e);u.pageX=t.pageX,u.pageY=t.pageY,m=(new Date).getTime(),null!==f&&clearInterval(f)}}function c(r){if(a(r)){var c=i(r),l={pageX:c.pageX,pageY:c.pageY},h=l.pageX-u.pageX,f=l.pageY-u.pageY;if(function(e,t,o){if(!d.contains(e))return!1;for(var s=e;s&&s!==d;){if(s.classList.contains(v.element.consuming))return!0;var i=n(s);if(o&&i.overflowY.match(/(scroll|auto)/)){var a=s.scrollHeight-s.clientHeight;if(0<a&&(0<s.scrollTop&&0>o||s.scrollTop<a&&0<o))return!0}if(t&&i.overflowX.match(/(scroll|auto)/)){var r=s.scrollWidth-s.clientWidth;if(0<r&&(0<s.scrollLeft&&0>t||s.scrollLeft<r&&0<t))return!0}s=s.parentNode}return!1}(r.target,h,f))return;s(h,f),u=l;var g=(new Date).getTime(),y=g-m;0<y&&(p.x=h/y,p.y=f/y,m=g),function(n,s){var i=t(d.scrollTop),a=d.scrollLeft,r=e(n),c=e(s);if(c>r){if(0>s&&i===o.contentHeight-o.containerHeight||0<s&&0===i)return 0===window.scrollY&&0<s&&_.isChrome}else if(r>c&&(0>n&&a===o.contentWidth-o.containerWidth||0<n&&0===a))return!0;return!0}(h,f)&&r.preventDefault()}}function l(){o.settings.swipeEasing&&(clearInterval(f),f=setInterval(function(){return o.isInitialized?void clearInterval(f):p.x||p.y?.01>e(p.x)&&.01>e(p.y)?void clearInterval(f):o.element?(s(30*p.x,30*p.y),p.x*=.8,void(p.y*=.8)):void clearInterval(f):void clearInterval(f)},10))}if(_.supportsTouch||_.supportsIePointer){var d=o.element,u={},m=0,p={},f=null;_.supportsTouch?(o.event.bind(d,"touchstart",r),o.event.bind(d,"touchmove",c),o.event.bind(d,"touchend",l)):_.supportsIePointer&&(window.PointerEvent?(o.event.bind(d,"pointerdown",r),o.event.bind(d,"pointermove",c),o.event.bind(d,"pointerup",l)):window.MSPointerEvent&&(o.event.bind(d,"MSPointerDown",r),o.event.bind(d,"MSPointerMove",c),o.event.bind(d,"MSPointerUp",l)))}}},C=function(e,i){var a=this;if(void 0===i&&(i={}),"string"==typeof e&&(e=document.querySelector(e)),!e||!e.nodeName)throw new Error("no element is specified to initialize PerfectScrollbar");for(var r in this.element=e,e.classList.add(v.main),this.settings={handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollingThreshold:1e3,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipeEasing:!0,useBothWheelAxes:!1,wheelPropagation:!0,wheelSpeed:1},i)this.settings[r]=i[r];this.containerWidth=null,this.containerHeight=null,this.contentWidth=null,this.contentHeight=null;var c,l,d=function(){return e.classList.add(v.state.focus)},u=function(){return e.classList.remove(v.state.focus)};this.isRtl="rtl"===n(e).direction,!0===this.isRtl&&e.classList.add(v.rtl),this.isNegativeScroll=(l=e.scrollLeft,e.scrollLeft=-1,c=0>e.scrollLeft,e.scrollLeft=l,c),this.negativeScrollAdjustment=this.isNegativeScroll?e.scrollWidth-e.clientWidth:0,this.event=new S,this.ownerDocument=e.ownerDocument||document,this.scrollbarXRail=s(v.element.rail("x")),e.appendChild(this.scrollbarXRail),this.scrollbarX=s(v.element.thumb("x")),this.scrollbarXRail.appendChild(this.scrollbarX),this.scrollbarX.setAttribute("tabindex",0),this.event.bind(this.scrollbarX,"focus",d),this.event.bind(this.scrollbarX,"blur",u),this.scrollbarXActive=null,this.scrollbarXWidth=null,this.scrollbarXLeft=null;var p=n(this.scrollbarXRail);this.scrollbarXBottom=parseInt(p.bottom,10),isNaN(this.scrollbarXBottom)?(this.isScrollbarXUsingBottom=!1,this.scrollbarXTop=m(p.top)):this.isScrollbarXUsingBottom=!0,this.railBorderXWidth=m(p.borderLeftWidth)+m(p.borderRightWidth),o(this.scrollbarXRail,{display:"block"}),this.railXMarginWidth=m(p.marginLeft)+m(p.marginRight),o(this.scrollbarXRail,{display:""}),this.railXWidth=null,this.railXRatio=null,this.scrollbarYRail=s(v.element.rail("y")),e.appendChild(this.scrollbarYRail),this.scrollbarY=s(v.element.thumb("y")),this.scrollbarYRail.appendChild(this.scrollbarY),this.scrollbarY.setAttribute("tabindex",0),this.event.bind(this.scrollbarY,"focus",d),this.event.bind(this.scrollbarY,"blur",u),this.scrollbarYActive=null,this.scrollbarYHeight=null,this.scrollbarYTop=null;var f=n(this.scrollbarYRail);this.scrollbarYRight=parseInt(f.right,10),isNaN(this.scrollbarYRight)?(this.isScrollbarYUsingRight=!1,this.scrollbarYLeft=m(f.left)):this.isScrollbarYUsingRight=!0,this.scrollbarYOuterWidth=this.isRtl?function(e){var t=n(e);return m(t.width)+m(t.paddingLeft)+m(t.paddingRight)+m(t.borderLeftWidth)+m(t.borderRightWidth)}(this.scrollbarY):null,this.railBorderYWidth=m(f.borderTopWidth)+m(f.borderBottomWidth),o(this.scrollbarYRail,{display:"block"}),this.railYMarginHeight=m(f.marginTop)+m(f.marginBottom),o(this.scrollbarYRail,{display:""}),this.railYHeight=null,this.railYRatio=null,this.reach={x:0>=e.scrollLeft?"start":e.scrollLeft>=this.contentWidth-this.containerWidth?"end":null,y:0>=e.scrollTop?"start":e.scrollTop>=this.contentHeight-this.containerHeight?"end":null},this.isAlive=!0,this.settings.handlers.forEach(function(e){return E[e](a)}),this.lastScrollTop=t(e.scrollTop),this.lastScrollLeft=e.scrollLeft,this.event.bind(this.element,"scroll",function(e){return a.onScroll(e)}),h(this)};return C.prototype.update=function(){this.isAlive&&(this.negativeScrollAdjustment=this.isNegativeScroll?this.element.scrollWidth-this.element.clientWidth:0,o(this.scrollbarXRail,{display:"block"}),o(this.scrollbarYRail,{display:"block"}),this.railXMarginWidth=m(n(this.scrollbarXRail).marginLeft)+m(n(this.scrollbarXRail).marginRight),this.railYMarginHeight=m(n(this.scrollbarYRail).marginTop)+m(n(this.scrollbarYRail).marginBottom),o(this.scrollbarXRail,{display:"none"}),o(this.scrollbarYRail,{display:"none"}),h(this),u(this,"top",0,!1,!0),u(this,"left",0,!1,!0),o(this.scrollbarXRail,{display:""}),o(this.scrollbarYRail,{display:""}))},C.prototype.onScroll=function(){this.isAlive&&(h(this),u(this,"top",this.element.scrollTop-this.lastScrollTop),u(this,"left",this.element.scrollLeft-this.lastScrollLeft),this.lastScrollTop=t(this.element.scrollTop),this.lastScrollLeft=this.element.scrollLeft)},C.prototype.destroy=function(){this.isAlive&&(this.event.unbindAll(),a(this.scrollbarX),a(this.scrollbarY),a(this.scrollbarXRail),a(this.scrollbarYRail),this.removePsClasses(),this.element=null,this.scrollbarX=null,this.scrollbarY=null,this.scrollbarXRail=null,this.scrollbarYRail=null,this.isAlive=!1)},C.prototype.removePsClasses=function(){this.element.className=this.element.className.split(" ").filter(function(e){return!e.match(/^ps([-_].+|)$/)}).join(" ")},C},"object"==typeof e&&void 0!==t?t.exports=r():"function"==typeof define&&define.amd?define(r):(a=a||self).PerfectScrollbar=r(),function(e,n,o,s){function i(e,t,n){return setTimeout(d(e,n),t)}function a(e,t,n){return!!Array.isArray(e)&&(r(e,n[t],n),!0)}function r(e,t,n){var o;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(o=0;o<e.length;)t.call(n,e[o],o,e),o++;else for(o in e)e.hasOwnProperty(o)&&t.call(n,e[o],o,e)}function c(t,n,o){var s="DEPRECATED METHOD: "+n+"\n"+o+" AT \n";return function(){var n=new Error("get-stack-trace"),o=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=e.console&&(e.console.warn||e.console.log);return i&&i.call(e.console,s,o),t.apply(this,arguments)}}function l(e,t,n){var o,s=t.prototype;(o=e.prototype=Object.create(s)).constructor=e,o._super=s,n&&ne(o,n)}function d(e,t){return function(){return e.apply(t,arguments)}}function u(e,t){return typeof e==ie?e.apply(t&&t[0]||s,t):e}function m(e,t){return e===s?t:e}function h(e,t,n){r(v(t),function(t){e.addEventListener(t,n,!1)})}function p(e,t,n){r(v(t),function(t){e.removeEventListener(t,n,!1)})}function f(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function g(e,t){return e.indexOf(t)>-1}function v(e){return e.trim().split(/\s+/g)}function y(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var o=0;o<e.length;){if(n&&e[o][n]==t||!n&&e[o]===t)return o;o++}return-1}function b(e){return Array.prototype.slice.call(e,0)}function w(e,t,n){for(var o=[],s=[],i=0;i<e.length;){var a=e[i][t];y(s,a)<0&&o.push(e[i]),s[i]=a,i++}return o=o.sort(function(e,n){return e[t]>n[t]})}function S(e,t){for(var n,o,i=t[0].toUpperCase()+t.slice(1),a=0;a<oe.length;){if((o=(n=oe[a])?n+i:t)in e)return o;a++}return s}function _(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}function E(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){u(e.options.enable,[e])&&n.handler(t)},this.init()}function C(e,t,n){var o=n.pointers.length,i=n.changedPointers.length,a=t&ye&&o-i===0,r=t&(we|Se)&&o-i===0;n.isFirst=!!a,n.isFinal=!!r,a&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,o=t.pointers,i=o.length;n.firstInput||(n.firstInput=T(t)),i>1&&!n.firstMultiple?n.firstMultiple=T(t):1===i&&(n.firstMultiple=!1);var a=n.firstInput,r=n.firstMultiple,c=r?r.center:a.center,l=t.center=x(o);t.timeStamp=ce(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=A(c,l),t.distance=I(c,l),function(e,t){var n=t.center,o=e.offsetDelta||{},s=e.prevDelta||{},i=e.prevInput||{};t.eventType!==ye&&i.eventType!==we||(s=e.prevDelta={x:i.deltaX||0,y:i.deltaY||0},o=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=s.x+(n.x-o.x),t.deltaY=s.y+(n.y-o.y)}(n,t),t.offsetDirection=k(t.deltaX,t.deltaY);var d=L(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=d.x,t.overallVelocityY=d.y,t.overallVelocity=re(d.x)>re(d.y)?d.x:d.y,t.scale=r?function(e,t){return I(t[0],t[1],$e)/I(e[0],e[1],$e)}(r.pointers,o):1,t.rotation=r?function(e,t){return A(t[1],t[0],$e)+A(e[1],e[0],$e)}(r.pointers,o):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,o,i,a,r=e.lastInterval||t,c=t.timeStamp-r.timeStamp;if(t.eventType!=Se&&(c>ve||r.velocity===s)){var l=t.deltaX-r.deltaX,d=t.deltaY-r.deltaY,u=L(c,l,d);o=u.x,i=u.y,n=re(u.x)>re(u.y)?u.x:u.y,a=k(l,d),e.lastInterval=t}else n=r.velocity,o=r.velocityX,i=r.velocityY,a=r.direction;t.velocity=n,t.velocityX=o,t.velocityY=i,t.direction=a}(n,t);var u=e.element;f(t.srcEvent.target,u)&&(u=t.srcEvent.target),t.target=u}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function T(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:ae(e.pointers[n].clientX),clientY:ae(e.pointers[n].clientY)},n++;return{timeStamp:ce(),pointers:t,center:x(t),deltaX:e.deltaX,deltaY:e.deltaY}}function x(e){var t=e.length;if(1===t)return{x:ae(e[0].clientX),y:ae(e[0].clientY)};for(var n=0,o=0,s=0;t>s;)n+=e[s].clientX,o+=e[s].clientY,s++;return{x:ae(n/t),y:ae(o/t)}}function L(e,t,n){return{x:t/e||0,y:n/e||0}}function k(e,t){return e===t?_e:re(e)>=re(t)?0>e?Ee:Ce:0>t?Te:xe}function I(e,t,n){n||(n=Ae);var o=t[n[0]]-e[n[0]],s=t[n[1]]-e[n[1]];return Math.sqrt(o*o+s*s)}function A(e,t,n){n||(n=Ae);var o=t[n[0]]-e[n[0]],s=t[n[1]]-e[n[1]];return 180*Math.atan2(s,o)/Math.PI}function $(){this.evEl=Me,this.evWin=Pe,this.pressed=!1,E.apply(this,arguments)}function D(){this.evEl=Oe,this.evWin=Ne,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function M(){this.evTarget=Fe,this.evWin=He,this.started=!1,E.apply(this,arguments)}function P(e,t){var n=b(e.touches),o=b(e.changedTouches);return t&(we|Se)&&(n=w(n.concat(o),"identifier")),[n,o]}function B(){this.evTarget=ze,this.targetIds={},E.apply(this,arguments)}function q(e,t){var n=b(e.touches),o=this.targetIds;if(t&(ye|be)&&1===n.length)return o[n[0].identifier]=!0,[n,n];var s,i,a=b(e.changedTouches),r=[],c=this.target;if(i=n.filter(function(e){return f(e.target,c)}),t===ye)for(s=0;s<i.length;)o[i[s].identifier]=!0,s++;for(s=0;s<a.length;)o[a[s].identifier]&&r.push(a[s]),t&(we|Se)&&delete o[a[s].identifier],s++;return r.length?[w(i.concat(r),"identifier"),r]:void 0}function O(){E.apply(this,arguments);var e=d(this.handler,this);this.touch=new B(this.manager,e),this.mouse=new $(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function N(e,t){e&ye?(this.primaryTouch=t.changedPointers[0].identifier,R.call(this,t)):e&(we|Se)&&R.call(this,t)}function R(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var o=this.lastTouches;setTimeout(function(){var e=o.indexOf(n);e>-1&&o.splice(e,1)},We)}}function F(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,o=0;o<this.lastTouches.length;o++){var s=this.lastTouches[o],i=Math.abs(t-s.x),a=Math.abs(n-s.y);if(Ue>=i&&Ue>=a)return!0}return!1}function H(e,t){this.manager=e,this.set(t)}function j(e){this.options=ne({},this.defaults,e||{}),this.id=ue++,this.manager=null,this.options.enable=m(this.options.enable,!0),this.state=tt,this.simultaneous={},this.requireFail=[]}function z(e){return e&at?"cancel":e&st?"end":e&ot?"move":e&nt?"start":""}function W(e){return e==xe?"down":e==Te?"up":e==Ee?"left":e==Ce?"right":""}function U(e,t){var n=t.manager;return n?n.get(e):e}function Y(){j.apply(this,arguments)}function X(){Y.apply(this,arguments),this.pX=null,this.pY=null}function V(){Y.apply(this,arguments)}function G(){j.apply(this,arguments),this._timer=null,this._input=null}function K(){Y.apply(this,arguments)}function J(){Y.apply(this,arguments)}function Q(){j.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Z(e,t){return(t=t||{}).recognizers=m(t.recognizers,Z.defaults.preset),new ee(e,t)}function ee(e,t){this.options=ne({},Z.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=function(e){var t=e.options.inputClass;return new(t||(he?D:pe?B:me?O:$))(e,C)}(this),this.touchAction=new H(this,this.options.touchAction),te(this,!0),r(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function te(e,t){var n,o=e.element;o.style&&(r(e.options.cssProps,function(s,i){n=S(o.style,i),t?(e.oldCssProps[n]=o.style[n],o.style[n]=s):o.style[n]=e.oldCssProps[n]||""}),t||(e.oldCssProps={}))}var ne,oe=["","webkit","Moz","MS","ms","o"],se=n.createElement("div"),ie="function",ae=Math.round,re=Math.abs,ce=Date.now;ne="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(o!==s&&null!==o)for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])}return t}:Object.assign;var le=c(function(e,t,n){for(var o=Object.keys(t),i=0;i<o.length;)(!n||n&&e[o[i]]===s)&&(e[o[i]]=t[o[i]]),i++;return e},"extend","Use `assign`."),de=c(function(e,t){return le(e,t,!0)},"merge","Use `assign`."),ue=1,me="ontouchstart"in e,he=S(e,"PointerEvent")!==s,pe=me&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),fe="touch",ge="mouse",ve=25,ye=1,be=2,we=4,Se=8,_e=1,Ee=2,Ce=4,Te=8,xe=16,Le=Ee|Ce,ke=Te|xe,Ie=Le|ke,Ae=["x","y"],$e=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&h(this.element,this.evEl,this.domHandler),this.evTarget&&h(this.target,this.evTarget,this.domHandler),this.evWin&&h(_(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(_(this.element),this.evWin,this.domHandler)}};var De={mousedown:ye,mousemove:be,mouseup:we},Me="mousedown",Pe="mousemove mouseup";l($,E,{handler:function(e){var t=De[e.type];t&ye&&0===e.button&&(this.pressed=!0),t&be&&1!==e.which&&(t=we),this.pressed&&(t&we&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:ge,srcEvent:e}))}});var Be={pointerdown:ye,pointermove:be,pointerup:we,pointercancel:Se,pointerout:Se},qe={2:fe,3:"pen",4:ge,5:"kinect"},Oe="pointerdown",Ne="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Oe="MSPointerDown",Ne="MSPointerMove MSPointerUp MSPointerCancel"),l(D,E,{handler:function(e){var t=this.store,n=!1,o=e.type.toLowerCase().replace("ms",""),s=Be[o],i=qe[e.pointerType]||e.pointerType,a=i==fe,r=y(t,e.pointerId,"pointerId");s&ye&&(0===e.button||a)?0>r&&(t.push(e),r=t.length-1):s&(we|Se)&&(n=!0),0>r||(t[r]=e,this.callback(this.manager,s,{pointers:t,changedPointers:[e],pointerType:i,srcEvent:e}),n&&t.splice(r,1))}});var Re={touchstart:ye,touchmove:be,touchend:we,touchcancel:Se},Fe="touchstart",He="touchstart touchmove touchend touchcancel";l(M,E,{handler:function(e){var t=Re[e.type];if(t===ye&&(this.started=!0),this.started){var n=P.call(this,e,t);t&(we|Se)&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:fe,srcEvent:e})}}});var je={touchstart:ye,touchmove:be,touchend:we,touchcancel:Se},ze="touchstart touchmove touchend touchcancel";l(B,E,{handler:function(e){var t=je[e.type],n=q.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:fe,srcEvent:e})}});var We=2500,Ue=25;l(O,E,{handler:function(e,t,n){var o=n.pointerType==fe,s=n.pointerType==ge;if(!(s&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(o)N.call(this,t,n);else if(s&&F.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ye=S(se.style,"touchAction"),Xe=Ye!==s,Ve="compute",Ge="auto",Ke="manipulation",Je="none",Qe="pan-x",Ze="pan-y",et=function(){if(!Xe)return!1;var t={},n=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(o){t[o]=!n||e.CSS.supports("touch-action",o)}),t}();H.prototype={set:function(e){e==Ve&&(e=this.compute()),Xe&&this.manager.element.style&&et[e]&&(this.manager.element.style[Ye]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return r(this.manager.recognizers,function(t){u(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(e){if(g(e,Je))return Je;var t=g(e,Qe),n=g(e,Ze);return t&&n?Je:t||n?t?Qe:Ze:g(e,Ke)?Ke:Ge}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(!this.manager.session.prevented){var o=this.actions,s=g(o,Je)&&!et[Je],i=g(o,Ze)&&!et[Ze],a=g(o,Qe)&&!et[Qe];if(s){var r=1===e.pointers.length,c=e.distance<2,l=e.deltaTime<250;if(r&&c&&l)return}return a&&i?void 0:s||i&&n&Le||a&&n&ke?this.preventSrc(t):void 0}t.preventDefault()},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var tt=1,nt=2,ot=4,st=8,it=st,at=16,rt=32;j.prototype={defaults:{},set:function(e){return ne(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(a(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=U(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return a(e,"dropRecognizeWith",this)||(e=U(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(a(e,"requireFailure",this))return this;var t=this.requireFail;return-1===y(t,e=U(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(a(e,"dropRequireFailure",this))return this;e=U(e,this);var t=y(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,o=this.state;st>o&&t(n.options.event+z(o)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),o>=st&&t(n.options.event+z(o))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=rt)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(rt|tt)))return!1;e++}return!0},recognize:function(e){var t=ne({},e);return u(this.options.enable,[this,t])?(this.state&(it|at|rt)&&(this.state=tt),this.state=this.process(t),void(this.state&(nt|ot|st|at)&&this.tryEmit(t))):(this.reset(),void(this.state=rt))},process:function(e){},getTouchAction:function(){},reset:function(){}},l(Y,j,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,o=t&(nt|ot),s=this.attrTest(e);return o&&(n&Se||!s)?t|at:o||s?n&we?t|st:t&nt?t|ot:nt:rt}}),l(X,Y,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ie},getTouchAction:function(){var e=this.options.direction,t=[];return e&Le&&t.push(Ze),e&ke&&t.push(Qe),t},directionTest:function(e){var t=this.options,n=!0,o=e.distance,s=e.direction,i=e.deltaX,a=e.deltaY;return s&t.direction||(t.direction&Le?(s=0===i?_e:0>i?Ee:Ce,n=i!=this.pX,o=Math.abs(e.deltaX)):(s=0===a?_e:0>a?Te:xe,n=a!=this.pY,o=Math.abs(e.deltaY))),e.direction=s,n&&o>t.threshold&&s&t.direction},attrTest:function(e){return Y.prototype.attrTest.call(this,e)&&(this.state&nt||!(this.state&nt)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=W(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),l(V,Y,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Je]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&nt)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),l(G,j,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ge]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,o=e.distance<t.threshold,s=e.deltaTime>t.time;if(this._input=e,!o||!n||e.eventType&(we|Se)&&!s)this.reset();else if(e.eventType&ye)this.reset(),this._timer=i(function(){this.state=it,this.tryEmit()},t.time,this);else if(e.eventType&we)return it;return rt},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===it&&(e&&e.eventType&we?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=ce(),this.manager.emit(this.options.event,this._input)))}}),l(K,Y,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Je]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&nt)}}),l(J,Y,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Le|ke,pointers:1},getTouchAction:function(){return X.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Le|ke)?t=e.overallVelocity:n&Le?t=e.overallVelocityX:n&ke&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&re(t)>this.options.velocity&&e.eventType&we},emit:function(e){var t=W(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),l(Q,j,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ke]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,o=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&ye&&0===this.count)return this.failTimeout();if(o&&s&&n){if(e.eventType!=we)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,r=!this.pCenter||I(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,r&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=i(function(){this.state=it,this.tryEmit()},t.interval,this),nt):it}return rt},failTimeout:function(){return this._timer=i(function(){this.state=rt},this.options.interval,this),rt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==it&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Z.VERSION="2.0.7",Z.defaults={domEvents:!1,touchAction:Ve,enable:!0,inputTarget:null,inputClass:null,preset:[[K,{enable:!1}],[V,{enable:!1},["rotate"]],[J,{direction:Le}],[X,{direction:Le},["swipe"]],[Q],[Q,{event:"doubletap",taps:2},["tap"]],[G]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},ee.prototype={set:function(e){return ne(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,o=this.recognizers,s=t.curRecognizer;(!s||s&&s.state&it)&&(s=t.curRecognizer=null);for(var i=0;i<o.length;)n=o[i],2===t.stopped||s&&n!=s&&!n.canRecognizeWith(s)?n.reset():n.recognize(e),!s&&n.state&(nt|ot|st)&&(s=t.curRecognizer=n),i++}},get:function(e){if(e instanceof j)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(a(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(a(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=y(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return r(v(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==s){var n=this.handlers;return r(v(e),function(e){t?n[e]&&n[e].splice(y(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var o=n.createEvent("Event");o.initEvent(e,!0,!0),o.gesture=t,t.target.dispatchEvent(o)}(e,t);var o=this.handlers[e]&&this.handlers[e].slice();if(o&&o.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var s=0;s<o.length;)o[s](t),s++}},destroy:function(){this.element&&te(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ne(Z,{INPUT_START:ye,INPUT_MOVE:be,INPUT_END:we,INPUT_CANCEL:Se,STATE_POSSIBLE:tt,STATE_BEGAN:nt,STATE_CHANGED:ot,STATE_ENDED:st,STATE_RECOGNIZED:it,STATE_CANCELLED:at,STATE_FAILED:rt,DIRECTION_NONE:_e,DIRECTION_LEFT:Ee,DIRECTION_RIGHT:Ce,DIRECTION_UP:Te,DIRECTION_DOWN:xe,DIRECTION_HORIZONTAL:Le,DIRECTION_VERTICAL:ke,DIRECTION_ALL:Ie,Manager:ee,Input:E,TouchAction:H,TouchInput:B,MouseInput:$,PointerEventInput:D,TouchMouseInput:O,SingleTouchInput:M,Recognizer:j,AttrRecognizer:Y,Tap:Q,Pan:X,Swipe:J,Pinch:V,Rotate:K,Press:G,on:h,off:p,each:r,merge:de,extend:le,assign:ne,inherit:l,bindFn:d,prefixed:S}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Z,"function"==typeof define&&define.amd?define(function(){return Z}):void 0!==t&&t.exports?t.exports=Z:e.Hammer=Z}(window,document);const c=["transitionend","webkitTransitionEnd","oTransitionEnd"];window.Menu=class e{constructor(t,n={},o=null){if(this._el=t,this._horizontal="horizontal"===n.orientation,this._animate=!1!==n.animate,this._accordion=!1!==n.accordion,this._showDropdownOnHover=Boolean(n.showDropdownOnHover),this._closeChildren=Boolean(n.closeChildren),this._rtl="rtl"===document.documentElement.getAttribute("dir")||"rtl"===document.body.getAttribute("dir"),this._onOpen=n.onOpen||function(){},this._onOpened=n.onOpened||function(){},this._onClose=n.onClose||function(){},this._onClosed=n.onClosed||function(){},this._psScroll=null,this._topParent=null,this._menuBgClass=null,t.classList.add("menu"),t.classList[this._animate?"remove":"add"]("menu-no-animation"),this._horizontal){t.classList.add("menu-horizontal"),t.classList.remove("menu-vertical"),this._inner=t.querySelector(".menu-inner");const e=this._inner.parentNode;this._prevBtn=t.querySelector(".menu-horizontal-prev"),this._prevBtn||(this._prevBtn=document.createElement("a"),this._prevBtn.href="#",this._prevBtn.className="menu-horizontal-prev",e.appendChild(this._prevBtn)),this._wrapper=t.querySelector(".menu-horizontal-wrapper"),this._wrapper||(this._wrapper=document.createElement("div"),this._wrapper.className="menu-horizontal-wrapper",this._wrapper.appendChild(this._inner),e.appendChild(this._wrapper)),this._nextBtn=t.querySelector(".menu-horizontal-next"),this._nextBtn||(this._nextBtn=document.createElement("a"),this._nextBtn.href="#",this._nextBtn.className="menu-horizontal-next",e.appendChild(this._nextBtn)),this._innerPosition=0,this.update()}else{t.classList.add("menu-vertical"),t.classList.remove("menu-horizontal");const n=o||window.PerfectScrollbar;n?(this._scrollbar=new n(t.querySelector(".menu-inner"),{suppressScrollX:!0,wheelPropagation:!e._hasClass("layout-menu-fixed layout-menu-fixed-offcanvas")}),window.Helpers.menuPsScroll=this._scrollbar):t.querySelector(".menu-inner").classList.add("overflow-auto")}const s=t.classList;for(let e=0;e<s.length;e++)s[e].startsWith("bg-")&&(this._menuBgClass=s[e]);t.setAttribute("data-bg-class",this._menuBgClass),this._horizontal&&window.innerWidth<window.Helpers.LAYOUT_BREAKPOINT?this.switchMenu("vertical"):this._bindEvents(),t.menuInstance=this}_bindEvents(){this._evntElClick=t=>{if(t.target.closest("ul")&&t.target.closest("ul").classList.contains("menu-inner")){const n=e._findParent(t.target,"menu-item",!1);n&&(this._topParent=n.childNodes[0])}const n=t.target.classList.contains("menu-toggle")?t.target:e._findParent(t.target,"menu-toggle",!1);n&&(t.preventDefault(),"true"!==n.getAttribute("data-hover")&&this.toggle(n))},(!this._showDropdownOnHover&&this._horizontal||!this._horizontal||window.Helpers.isMobileDevice)&&this._el.addEventListener("click",this._evntElClick),this._evntWindowResize=()=>{this.update(),this._lastWidth!==window.innerWidth&&(this._lastWidth=window.innerWidth,this.update());const e=document.querySelector("[data-template^='horizontal-menu']");this._horizontal||e||this.manageScroll()},window.addEventListener("resize",this._evntWindowResize),this._horizontal&&(this._evntPrevBtnClick=e=>{e.preventDefault(),this._prevBtn.classList.contains("disabled")||this._slide("prev")},this._prevBtn.addEventListener("click",this._evntPrevBtnClick),this._evntNextBtnClick=e=>{e.preventDefault(),this._nextBtn.classList.contains("disabled")||this._slide("next")},this._nextBtn.addEventListener("click",this._evntNextBtnClick),this._evntBodyClick=e=>{!this._inner.contains(e.target)&&this._el.querySelectorAll(".menu-inner > .menu-item.open").length&&this.closeAll()},document.body.addEventListener("click",this._evntBodyClick),this._showDropdownOnHover&&(this._evntElMouseOver=e=>{if(e.target!==e.currentTarget&&!e.target.parentNode.classList.contains("open")){const t=e.target.classList.contains("menu-toggle")?e.target:null;t&&(e.preventDefault(),"true"!==t.getAttribute("data-hover")&&this.toggle(t))}e.stopPropagation()},this._horizontal&&window.screen.width>window.Helpers.LAYOUT_BREAKPOINT&&this._el.addEventListener("mouseover",this._evntElMouseOver),this._evntElMouseOut=t=>{const n=t.currentTarget,o=t.target,s=t.toElement||t.relatedTarget;if(o.closest("ul")&&o.closest("ul").classList.contains("menu-inner")&&(this._topParent=o),o!==n&&(o.parentNode.classList.contains("open")||!o.classList.contains("menu-toggle"))&&s&&s.parentNode&&!s.parentNode.classList.contains("menu-link")){if(this._topParent&&!e.childOf(s,this._topParent.parentNode)){const e=this._topParent.classList.contains("menu-toggle")?this._topParent:null;e&&(t.preventDefault(),"true"!==e.getAttribute("data-hover")&&(this.toggle(e),this._topParent=null))}if(e.childOf(s,o.parentNode))return;const n=o.classList.contains("menu-toggle")?o:null;n&&(t.preventDefault(),"true"!==n.getAttribute("data-hover")&&this.toggle(n))}t.stopPropagation()},this._horizontal&&window.screen.width>window.Helpers.LAYOUT_BREAKPOINT&&this._el.addEventListener("mouseout",this._evntElMouseOut)))}_unbindEvents(){this._evntElClick&&(this._el.removeEventListener("click",this._evntElClick),this._evntElClick=null),this._evntElMouseOver&&(this._el.removeEventListener("mouseover",this._evntElMouseOver),this._evntElMouseOver=null),this._evntElMouseOut&&(this._el.removeEventListener("mouseout",this._evntElMouseOut),this._evntElMouseOut=null),this._evntWindowResize&&(window.removeEventListener("resize",this._evntWindowResize),this._evntWindowResize=null),this._evntBodyClick&&(document.body.removeEventListener("click",this._evntBodyClick),this._evntBodyClick=null),this._evntInnerMousemove&&(this._inner.removeEventListener("mousemove",this._evntInnerMousemove),this._evntInnerMousemove=null),this._evntInnerMouseleave&&(this._inner.removeEventListener("mouseleave",this._evntInnerMouseleave),this._evntInnerMouseleave=null)}open(t,n=this._closeChildren){const o=this._findUnopenedParent(e._getItem(t,!0),n);if(!o)return;const s=e._getLink(o,!0);e._promisify(this._onOpen,this,o,s,e._findMenu(o)).then(()=>{this._horizontal&&e._isRoot(o)?(this._toggleDropdown(!0,o,n),this._onOpened&&this._onOpened(this,o,s,e._findMenu(o))):this._animate&&!this._horizontal?(window.requestAnimationFrame(()=>this._toggleAnimation(!0,o,!1)),this._accordion&&this._closeOther(o,n)):this._animate?(this._toggleDropdown(!0,o,n),this._onOpened&&this._onOpened(this,o,s,e._findMenu(o))):(o.classList.add("open"),this._onOpened&&this._onOpened(this,o,s,e._findMenu(o)),this._accordion&&this._closeOther(o,n))}).catch(()=>{})}close(t,n=this._closeChildren,o=!1){const s=e._getItem(t,!0),i=e._getLink(t,!0);s.classList.contains("open")&&!s.classList.contains("disabled")&&e._promisify(this._onClose,this,s,i,e._findMenu(s),o).then(()=>{if(this._horizontal&&e._isRoot(s))this._toggleDropdown(!1,s,n),this._onClosed&&this._onClosed(this,s,i,e._findMenu(s));else if(this._animate&&!this._horizontal)window.requestAnimationFrame(()=>this._toggleAnimation(!1,s,n));else{if(s.classList.remove("open"),n){const e=s.querySelectorAll(".menu-item.open");for(let t=0,n=e.length;t<n;t++)e[t].classList.remove("open")}this._onClosed&&this._onClosed(this,s,i,e._findMenu(s))}}).catch(()=>{})}_closeOther(t,n){const o=e._findChild(t.parentNode,["menu-item","open"]);for(let e=0,s=o.length;e<s;e++)o[e]!==t&&this.close(o[e],n)}toggle(t,n=this._closeChildren){const o=e._getItem(t,!0);o.classList.contains("open")?this.close(o,n):this.open(o,n)}_toggleDropdown(t,n,o){const s=e._findMenu(n);let i=n,a=!1;if(t){e._findParent(n,"menu-sub",!1)&&(a=!0,n=this._topParent?this._topParent.parentNode:n);const t=Math.round(this._wrapper.getBoundingClientRect().width);let r=this._innerPosition;const c=this._getItemOffset(n),l=Math.round(n.getBoundingClientRect().width);c-5<=-1*r?this._innerPosition=-1*c:c+r+l+5>=t&&(this._innerPosition=l>t?-1*c:-1*(c+l-t)),i.classList.add("open");const d=Math.round(s.getBoundingClientRect().width);if(a)c+this._innerPosition+2*d>t&&d<t&&d>=l&&(this._rtl?s.classList.add("menu-position-right-100"):s.classList.add("menu-position-left-100"));else if(c+this._innerPosition+d>t&&d<t&&d>l){const e=d-l;s.setAttribute("data-menu-margin",e),this._rtl?s.classList.add("menu-margin-right"):s.classList.add("menu-margin-left")}this._closeOther(i,o),this._updateSlider()}else{const t=e._findChild(n,["menu-toggle"]);if(t.length&&t[0].removeAttribute("data-hover","true"),n.classList.remove("open"),s.classList.remove("menu-margin-left","menu-margin-right","menu-position-left-100","menu-position-right-100"),s.removeAttribute("data-menu-margin"),o){const e=s.querySelectorAll(".menu-item.open");for(let t=0,n=e.length;t<n;t++)e[t].classList.remove("open")}}}_slide(e){const t=Math.round(this._wrapper.getBoundingClientRect().width),n=this._innerWidth;let o;"next"===e?(o=this._getSlideNextPos(),n+o<t&&(o=t-n)):(o=this._getSlidePrevPos(),o>0&&(o=0)),this._innerPosition=o,this.update()}_getSlideNextPos(){const e=Math.round(this._wrapper.getBoundingClientRect().width),t=this._innerPosition;let n=this._inner.childNodes[0],o=0;for(;n;){if(n.tagName){const s=Math.round(n.getBoundingClientRect().width);if(o+t-5<=e&&o+t+s+5>=e){s>e&&o===-1*t&&(o+=s);break}o+=s}n=n.nextSibling}return-1*o}_getSlidePrevPos(){const e=Math.round(this._wrapper.getBoundingClientRect().width),t=this._innerPosition;let n=this._inner.childNodes[0],o=0;for(;n;){if(n.tagName){const s=Math.round(n.getBoundingClientRect().width);if(o-5<=-1*t&&o+s+5>=-1*t){s<=e&&(o=o+s-e);break}o+=s}n=n.nextSibling}return-1*o}_findUnopenedParent(t,n){let o=[],s=null;for(;t;)t.classList.contains("disabled")?(s=null,o=[]):(t.classList.contains("open")||(s=t),o.push(t)),t=e._findParent(t,"menu-item",!1);if(!s)return null;if(1===o.length)return s;o=o.slice(0,o.indexOf(s));for(let i=0,a=o.length;i<a;i++)if(o[i].classList.add("open"),this._accordion){const t=e._findChild(o[i].parentNode,["menu-item","open"]);for(let e=0,s=t.length;e<s;e++)if(t[e]!==o[i]&&(t[e].classList.remove("open"),n)){const n=t[e].querySelectorAll(".menu-item.open");for(let e=0,t=n.length;e<t;e++)n[e].classList.remove("open")}}return s}_toggleAnimation(t,n,o){const s=e._getLink(n,!0),i=e._findMenu(n);e._unbindAnimationEndEvent(n);const a=Math.round(s.getBoundingClientRect().height);n.classList.add("menu-item-overflow-hidden");const r=()=>{n.classList.remove("menu-item-animating"),n.classList.remove("menu-item-closing"),n.classList.remove("menu-item-overflow-hidden"),n.removeAttribute("data-menu-height"),this._horizontal||this.update()};if(t)n.setAttribute("data-menu-height",`${a}px`),n.classList.add("menu-item-animating"),n.classList.add("open"),e._bindAnimationEndEvent(n,()=>{r(),this._onOpened(this,n,s,i)}),setTimeout(()=>{const e=a+Math.round(i.getBoundingClientRect().height);n.setAttribute("data-menu-height",`${e}px`)},50);else{const t=a+Math.round(i.getBoundingClientRect().height);n.setAttribute("data-menu-height",`${t}px`),n.classList.add("menu-item-animating"),n.classList.add("menu-item-closing"),e._bindAnimationEndEvent(n,()=>{if(n.classList.remove("open"),r(),o){const e=n.querySelectorAll(".menu-item.open");for(let t=0,n=e.length;t<n;t++)e[t].classList.remove("open")}this._onClosed(this,n,s,i)}),setTimeout(()=>{n.setAttribute("data-menu-height",`${a}px`)},50)}}_getItemOffset(e){let t=this._inner.childNodes[0],n=0;for(;t!==e;)t.tagName&&(n+=Math.round(t.getBoundingClientRect().width)),t=t.nextSibling;return n}_updateSlider(e=null,t=null,n=null){const o=null!==e?e:Math.round(this._wrapper.getBoundingClientRect().width),s=null!==t?t:this._innerWidth,i=null!==n?n:this._innerPosition;s<o||window.innerWidth<window.Helpers.LAYOUT_BREAKPOINT?(this._prevBtn.classList.add("d-none"),this._nextBtn.classList.add("d-none")):(this._prevBtn.classList.remove("d-none"),this._nextBtn.classList.remove("d-none")),s>o&&window.innerWidth>window.Helpers.LAYOUT_BREAKPOINT&&(0===i?this._prevBtn.classList.add("disabled"):this._prevBtn.classList.remove("disabled"),s+i<=o?this._nextBtn.classList.add("disabled"):this._nextBtn.classList.remove("disabled"))}get _innerWidth(){const e=this._inner.childNodes;let t=0;for(let n=0,o=e.length;n<o;n++)e[n].tagName&&(t+=Math.round(e[n].getBoundingClientRect().width));return t}get _innerPosition(){return parseInt(this._inner.getAttribute("data-inner-position")||"0",10)}set _innerPosition(e){this._inner.setAttribute("data-inner-position",e);const t=`${e}px`;return this._rtl?this._inner.style.setProperty("--menu-margin-right",t):this._inner.style.setProperty("--menu-margin-left",t),e}closeAll(e=this._closeChildren){const t=this._el.querySelectorAll(".menu-inner > .menu-item.open");for(let n=0,o=t.length;n<o;n++)this.close(t[n],e)}update(){if(this._horizontal){this.closeAll();const e=Math.round(this._wrapper.getBoundingClientRect().width),t=this._innerWidth;let n=this._innerPosition;e-n>t&&(n=e-t,n>0&&(n=0),this._innerPosition=n),this._updateSlider(e,t,n)}else this._scrollbar&&this._scrollbar.update()}manageScroll(){const{PerfectScrollbar:e}=window,t=document.querySelector(".menu-inner");if(window.innerWidth<window.Helpers.LAYOUT_BREAKPOINT)null!==this._scrollbar&&(this._scrollbar.destroy(),this._scrollbar=null),t.classList.add("overflow-auto");else{if(null===this._scrollbar){const t=new e(document.querySelector(".menu-inner"),{suppressScrollX:!0,wheelPropagation:!1});this._scrollbar=t}t.classList.remove("overflow-auto")}}switchMenu(e){this._unbindEvents();const t=document.querySelector("nav.layout-navbar"),n=document.querySelector("#navbar-collapse"),o=document.querySelector("#layout-menu div"),s=document.querySelector("#layout-menu"),i=["layout-menu-horizontal","menu","menu-horizontal","container-fluid","flex-grow-0"],a=["layout-menu","menu","menu-vertical"],r=document.querySelector(".menu-horizontal-wrapper"),c=document.querySelector(".menu-inner"),l=document.querySelector(".app-brand"),d=document.querySelector(".layout-menu-toggle"),u=document.querySelectorAll(".menu-inner .active");if("vertical"===e){this._horizontal=!1,o.insertBefore(l,r),o.insertBefore(c,r),o.classList.add("flex-column","p-0"),[...s.classList].forEach(e=>s.classList.remove(e)),s.classList.add(...a,this._menuBgClass),l.classList.remove("d-none","d-lg-flex"),d.classList.remove("d-none"),c.classList.add("overflow-auto");for(let e=0;e<u.length-1;++e)u[e].classList.add("open")}else{this._horizontal=!0,t.children[0].insertBefore(l,n),l.classList.add("d-none","d-lg-flex"),r.appendChild(c),o.classList.remove("flex-column","p-0"),[...s.classList].forEach(e=>s.classList.remove(e)),s.classList.add(...i,this._menuBgClass),d.classList.add("d-none"),c.classList.remove("overflow-auto");for(let e=0;e<u.length;++e)u[e].classList.remove("open")}this._bindEvents()}destroy(){if(!this._el)return;this._unbindEvents();const t=this._el.querySelectorAll(".menu-item");for(let o=0,s=t.length;o<s;o++)e._unbindAnimationEndEvent(t[o]),t[o].classList.remove("menu-item-animating"),t[o].classList.remove("open"),t[o].classList.remove("menu-item-overflow-hidden"),t[o].removeAttribute("data-menu-height");const n=this._el.querySelectorAll(".menu-menu");for(let e=0,o=n.length;e<o;e++)n[e].classList.remove("menu-margin-left","menu-margin-right","menu-position-left-100","menu-position-right-100"),n[e].removeAttribute("data-menu-margin");this._el.classList.remove("menu-no-animation"),this._wrapper&&(this._prevBtn.parentNode.removeChild(this._prevBtn),this._nextBtn.parentNode.removeChild(this._nextBtn),this._wrapper.parentNode.insertBefore(this._inner,this._wrapper),this._wrapper.parentNode.removeChild(this._wrapper),this._inner.removeAttribute("data-inner-position"),this._inner.style.removeProperty("--menu-margin-left"),this._inner.style.removeProperty("--menu-margin-right")),this._el.menuInstance=null,delete this._el.menuInstance,this._el=null,this._horizontal=null,this._animate=null,this._accordion=null,this._showDropdownOnHover=null,this._closeChildren=null,this._rtl=null,this._onOpen=null,this._onOpened=null,this._onClose=null,this._onClosed=null,this._scrollbar&&(this._scrollbar.destroy(),this._scrollbar=null),this._inner=null,this._prevBtn=null,this._wrapper=null,this._nextBtn=null}static childOf(e,t){if(e.parentNode){for(;(e=e.parentNode)&&e!==t;);return!!e}return!1}static _isRoot(t){return!e._findParent(t,"menu-item",!1)}static _findParent(e,t,n=!0){if("BODY"===e.tagName.toUpperCase())return null;for(e=e.parentNode;"BODY"!==e.tagName.toUpperCase()&&!e.classList.contains(t);)e=e.parentNode;if(!(e="BODY"!==e.tagName.toUpperCase()?e:null)&&n)throw new Error(`Cannot find .${t} parent element`);return e}static _findChild(e,t){const n=e.childNodes,o=[];for(let s=0,i=n.length;s<i;s++)if(n[s].classList){let e=0;for(let o=0;o<t.length;o++)n[s].classList.contains(t[o])&&(e+=1);t.length===e&&o.push(n[s])}return o}static _findMenu(e){let t=e.childNodes[0],n=null;for(;t&&!n;)t.classList&&t.classList.contains("menu-sub")&&(n=t),t=t.nextSibling;if(!n)throw new Error("Cannot find `.menu-sub` element for the current `.menu-toggle`");return n}static _hasClass(e,t=window.Helpers.ROOT_EL){let n=!1;return e.split(" ").forEach(e=>{t.classList.contains(e)&&(n=!0)}),n}static _getItem(t,n){let o=null;const s=n?"menu-toggle":"menu-link";if(t.classList.contains("menu-item")?e._findChild(t,[s]).length&&(o=t):t.classList.contains(s)&&(o=t.parentNode.classList.contains("menu-item")?t.parentNode:null),!o)throw new Error((n?"Toggable ":"")+".menu-item element not found.");return o}static _getLink(t,n){let o=[];const s=n?"menu-toggle":"menu-link";if(t.classList.contains(s)?o=[t]:t.classList.contains("menu-item")&&(o=e._findChild(t,[s])),!o.length)throw new Error(`${s} element not found.`);return o[0]}static _bindAnimationEndEvent(t,n){const o=o=>{o.target===t&&(e._unbindAnimationEndEvent(t),n(o))};let s=window.getComputedStyle(t).transitionDuration;s=parseFloat(s)*(-1!==s.indexOf("ms")?1:1e3),t._menuAnimationEndEventCb=o,c.forEach(e=>t.addEventListener(e,t._menuAnimationEndEventCb,!1)),t._menuAnimationEndEventTimeout=setTimeout(()=>{o({target:t})},s+50)}static _promisify(e,...t){const n=e.apply(void 0,t);return n instanceof Promise?n:!1===n?Promise.reject():Promise.resolve()}static _unbindAnimationEndEvent(e){const t=e._menuAnimationEndEventCb;e._menuAnimationEndEventTimeout&&(clearTimeout(e._menuAnimationEndEventTimeout),e._menuAnimationEndEventTimeout=null),t&&(c.forEach(n=>e.removeEventListener(n,t,!1)),e._menuAnimationEndEventCb=null)}setDisabled(t,n){e._getItem(t,!1).classList[n?"add":"remove"]("disabled")}isActive(t){return e._getItem(t,!1).classList.contains("active")}isOpened(t){return e._getItem(t,!1).classList.contains("open")}isDisabled(t){return e._getItem(t,!1).classList.contains("disabled")}};const l={handlers:new Map,debug:!1,stats:{handlersRegistered:0,eventsProcessed:0,errorsEncountered:0},register(e,t,n={}){"function"==typeof t?(this.handlers.set(e,(e,o)=>(n.preventDefault&&o.preventDefault(),n.stopPropagation&&o.stopPropagation(),t(e,o))),this.stats.handlersRegistered++,this.debug&&console.log(`[EventDelegation] Registered handler: ${e}`)):console.error(`[EventDelegation] Handler for action "${e}" must be a function`)},unregister(e){this.handlers.has(e)&&(this.handlers.delete(e),this.stats.handlersRegistered--,this.debug&&console.log(`[EventDelegation] Unregistered handler: ${e}`))},isRegistered(e){return this.handlers.has(e)},getRegisteredActions(){return Array.from(this.handlers.keys())},init(){document.addEventListener("click",this.handleClick.bind(this),!1),document.addEventListener("change",this.handleChange.bind(this),!1),document.addEventListener("input",this.handleInput.bind(this),!1),document.addEventListener("submit",this.handleSubmit.bind(this),!1),document.addEventListener("keydown",this.handleKeydown.bind(this),!1),console.log("[EventDelegation] System initialized"),console.log(`[EventDelegation] Registered ${this.stats.handlersRegistered} handlers`)},handleClick(e){const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,o=this.handlers.get(n);if(o){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling click action: ${n}`,{element:t,data:t.dataset});try{o(t,e)}catch(s){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,s),this.handleError(n,s,t)}}else this.debug&&console.warn(`[EventDelegation] No handler registered for action: ${n}`)},handleChange(e){const t=e.target.closest("[data-on-change]");if(!t)return;const n=t.dataset.onChange,o=this.handlers.get(n);if(o){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling change action: ${n}`,{element:t,value:t.value});try{o(t,e)}catch(s){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,s),this.handleError(n,s,t)}}},handleInput(e){const t=e.target.closest("[data-on-input]");if(!t)return;const n=t.dataset.onInput,o=this.handlers.get(n);if(o){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling input action: ${n}`,{element:t,value:t.value});try{o(t,e)}catch(s){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,s),this.handleError(n,s,t)}}},handleSubmit(e){const t=e.target.closest("[data-on-submit]");if(!t)return;const n=t.dataset.onSubmit,o=this.handlers.get(n);if(o){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling submit action: ${n}`,{form:t,data:new FormData(t)});try{o(t,e)}catch(s){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,s),this.handleError(n,s,t)}}},handleKeydown(e){const t=e.target.closest("[data-on-keydown]");if(!t)return;const n=t.dataset.onKeydown,o=this.handlers.get(n);if(o){this.stats.eventsProcessed++,this.debug&&console.log(`[EventDelegation] Handling keydown action: ${n}`,{element:t,key:e.key,code:e.code});try{o(t,e)}catch(s){this.stats.errorsEncountered++,console.error(`[EventDelegation] Error in handler "${n}":`,s),this.handleError(n,s,t)}}},handleError(e,t,n){console.error(`[EventDelegation] Action "${e}" failed:`,t),"function"==typeof showNotification&&showNotification("Error",`Action failed: ${e}`,"error")},enableDebug(){this.debug=!0,console.log("[EventDelegation] Debug mode enabled")},disableDebug(){this.debug=!1,console.log("[EventDelegation] Debug mode disabled")},getStats(){return{...this.stats,registeredActions:this.handlers.size}},resetStats(){this.stats.eventsProcessed=0,this.stats.errorsEncountered=0}};function d(e,t,n){"undefined"!=typeof Swal?Swal.fire({title:"Update RSVP Status?",text:"Are you sure you want to update this player's RSVP status?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, update it",cancelButtonText:"Cancel",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",customClass:{confirmButton:"swal-btn-confirm",cancelButton:"swal-btn-cancel"},buttonsStyling:!1}).then(o=>{var s;if(o.isConfirmed){const o=new FormData,i=(null==(s=document.querySelector('input[name="csrf_token"]'))?void 0:s.value)||"";o.append("csrf_token",i),o.append("player_id",e),o.append("match_id",t),o.append("response",n),Swal.fire({title:"Updating...",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}}),fetch("/admin/update_rsvp",{method:"POST",body:o,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(function(e){e.success?Swal.fire({title:"Success!",text:"RSVP updated successfully.",icon:"success",timer:1500,showConfirmButton:!1}).then(()=>{window.location.reload()}):Swal.fire({title:"Error",text:e.message||"Error updating RSVP.",icon:"error"})}).catch(function(e){console.error("[updateRSVPStatus] Error:",e),Swal.fire({title:"Error",text:"An error occurred while updating RSVP. Please try again.",icon:"error"})})}}):console.error("[updateRSVPStatus] SweetAlert2 not available")}function u(e,t){if("function"!=typeof window.showToast){if("undefined"!=typeof Toastify){const n={success:`linear-gradient(to right, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"#198754"}, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("success-light"):"#198754"})`,error:`linear-gradient(to right, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545"}, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger-light"):"#dc3545"})`,warning:`linear-gradient(to right, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning"):"#ffc107"}, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning-light"):"#ffc107"})`,info:`linear-gradient(to right, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("info"):"#0dcaf0"}, ${"undefined"!=typeof ECSTheme?ECSTheme.getColor("info-light"):"#0dcaf0"})`};return void Toastify({text:t,duration:3e3,gravity:"top",position:"right",style:{background:n[e]||n.info}}).showToast()}console.log(`[${e}] ${t}`)}else window.showToast(e,t)}function m(e){const t=document.getElementById("subscriptionLoading"),n=document.getElementById("subscriptionContent");t&&t.classList.toggle("is-hidden",!e),n&&n.classList.toggle("is-hidden",e)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){l.init()}):l.init(),l.register("show-task-info",function(e,t){t.preventDefault();const n=e.dataset.taskId,o=e.dataset.taskType,s=e.dataset.taskData;if(!n||!o)return void console.error("[show-task-info] Missing required data attributes");let i;try{i=s?JSON.parse(s):{}}catch(a){console.error("[show-task-info] Failed to parse task data:",a),i={}}"function"==typeof showTaskInfo?showTaskInfo(n,o,i):console.error("[show-task-info] Function not found")}),l.register("revoke-task",function(e,t){t.preventDefault();const n=e.dataset.taskId,o=e.dataset.matchId,s=e.dataset.taskType;n&&o&&s?"function"==typeof revokeTask?revokeTask(n,o,s):console.error("[revoke-task] Function not found"):console.error("[revoke-task] Missing required data attributes")}),l.register("reschedule-task",function(e,t){t.preventDefault();const n=e.dataset.matchId,o=e.dataset.taskType;n&&o?"function"==typeof rescheduleTask?rescheduleTask(n,o):console.error("[reschedule-task] Function not found"):console.error("[reschedule-task] Missing required data attributes")}),l.register("refresh-tasks",function(e,t){t.preventDefault(),"function"==typeof loadAllTaskDetails?loadAllTaskDetails():"function"==typeof refreshStatuses?refreshStatuses():console.error("[refresh-tasks] No refresh function found")}),l.register("toggle-historical",function(e,t){t.preventDefault();const n=e.dataset.target;if(!n)return void console.error("[toggle-historical] Missing target ID");const o=document.querySelector(n);o&&window.bootstrap&&bootstrap.Collapse.getOrCreateInstance(o).toggle()}),l.register("schedule-match",function(e,t){t.preventDefault();const n=e.dataset.matchId;n?"function"==typeof scheduleMatch?scheduleMatch(n):console.error("[schedule-match] Function not found"):console.error("[schedule-match] Missing match ID")}),l.register("verify-match",function(e,t){t.preventDefault();const n=e.dataset.matchId;if(n)if("function"==typeof verifyMatch)verifyMatch(n);else{const t=e.dataset.verifyUrl||`/admin/match_verification/${n}`;window.location.href=t}else console.error("[verify-match] Missing match ID")}),l.register("edit-match",function(e,t){t.preventDefault();const n=e.dataset.matchId;n?"function"==typeof editMatch?editMatch(n):console.error("[edit-match] Function not found"):console.error("[edit-match] Missing match ID")}),l.register("draft-player",function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.playerName;n&&o?"function"==typeof confirmDraftPlayer?confirmDraftPlayer(n,o):window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.showDraftModal?window.draftSystemInstance.showDraftModal(n,o):console.error("[draft-player] No draft function available"):console.error("[draft-player] Missing required data attributes")}),l.register("remove-player",function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.teamId,s=e.dataset.playerName,i=e.dataset.teamName;n&&o?"function"==typeof confirmRemovePlayer?confirmRemovePlayer(n,o,s,i):console.error("[remove-player] Function not found"):console.error("[remove-player] Missing required data attributes")}),l.register("view-player-profile",function(e,t){t.preventDefault();const n=e.dataset.playerId;n?window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.openPlayerModal?window.draftSystemInstance.openPlayerModal(n):"function"==typeof openPlayerModal?openPlayerModal(n):console.error("[view-player-profile] No modal function available"):console.error("[view-player-profile] Missing player ID")}),l.register("search-players",function(e,t){const n=e.value.toLowerCase().trim();window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.handleSearch?window.draftSystemInstance.handleSearch(t):document.querySelectorAll('[data-component="player-card"]').forEach(e=>{var t;const o=(e.dataset.playerName||"").toLowerCase(),s=!n||o.includes(n);null==(t=e.closest('[data-component="player-column"]'))||t.classList.toggle("d-none",!s)})}),l.register("filter-position",function(e,t){if(window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.handleFilter)window.draftSystemInstance.handleFilter(t);else{const t=e.value.toLowerCase();document.querySelectorAll('[data-component="player-card"]').forEach(e=>{var n;const o=(e.dataset.position||"").toLowerCase(),s=!t||o===t;null==(n=e.closest('[data-component="player-column"]'))||n.classList.toggle("d-none",!s)})}}),l.register("sort-players",function(e,t){window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.handleSort?window.draftSystemInstance.handleSort(t):console.warn("[sort-players] Sort function not available")}),l.register("edit-match-report",function(e,t){t.preventDefault();const n=e.dataset.matchId;n?"function"==typeof handleEditButtonClick?handleEditButtonClick(n):console.error("[edit-match-report] handleEditButtonClick function not found"):console.error("[edit-match-report] Missing match ID")}),l.register("add-goal",function(e,t){t.preventDefault();let n=e.dataset.matchId;if(!n){const t=e.getAttribute("onclick");if(t){const e=t.match(/'([^']+)'/);e&&(n=e[1])}}if(!n)return void console.error("[add-goal] Missing match ID");const o=`goalScorersContainer-${n}`;"function"==typeof window.addEvent?window.addEvent(n,o):console.error("[add-goal] addEvent function not found")}),l.register("add-assist",function(e,t){t.preventDefault();let n=e.dataset.matchId;if(!n){const t=e.getAttribute("onclick");if(t){const e=t.match(/'([^']+)'/);e&&(n=e[1])}}if(!n)return void console.error("[add-assist] Missing match ID");const o=`assistProvidersContainer-${n}`;"function"==typeof window.addEvent?window.addEvent(n,o):console.error("[add-assist] addEvent function not found")}),l.register("add-yellow-card",function(e,t){t.preventDefault();let n=e.dataset.matchId;if(!n){const t=e.getAttribute("onclick");if(t){const e=t.match(/'([^']+)'/);e&&(n=e[1])}}if(!n)return void console.error("[add-yellow-card] Missing match ID");const o=`yellowCardsContainer-${n}`;"function"==typeof window.addEvent?window.addEvent(n,o):console.error("[add-yellow-card] addEvent function not found")}),l.register("add-red-card",function(e,t){t.preventDefault();let n=e.dataset.matchId;if(!n){const t=e.getAttribute("onclick");if(t){const e=t.match(/'([^']+)'/);e&&(n=e[1])}}if(!n)return void console.error("[add-red-card] Missing match ID");const o=`redCardsContainer-${n}`;"function"==typeof window.addEvent?window.addEvent(n,o):console.error("[add-red-card] addEvent function not found")}),l.register("remove-event",function(e,t){t.preventDefault(),"function"==typeof window.removeEvent?window.removeEvent(e):console.error("[remove-event] removeEvent function not found")}),l.register("remove-own-goal",function(e,t){t.preventDefault(),"function"==typeof window.removeEvent?window.removeEvent(e):console.error("[remove-own-goal] removeEvent function not found")}),l.register("rsvp-yes",function(e,t){t.preventDefault();const n=e.dataset.matchId,o=e.dataset.playerId;n?o?"function"==typeof updatePlayerRSVP?updatePlayerRSVP(o,n,"yes"):d(o,n,"yes"):"function"==typeof submitRSVP?submitRSVP(n,"yes"):console.error("[rsvp-yes] submitRSVP function not found"):console.error("[rsvp-yes] Missing match ID")}),l.register("rsvp-no",function(e,t){t.preventDefault();const n=e.dataset.matchId,o=e.dataset.playerId;n?o?"function"==typeof updatePlayerRSVP?updatePlayerRSVP(o,n,"no"):d(o,n,"no"):"function"==typeof submitRSVP?submitRSVP(n,"no"):console.error("[rsvp-no] submitRSVP function not found"):console.error("[rsvp-no] Missing match ID")}),l.register("rsvp-maybe",function(e,t){t.preventDefault();const n=e.dataset.matchId,o=e.dataset.playerId;n?o?"function"==typeof updatePlayerRSVP?updatePlayerRSVP(o,n,"maybe"):d(o,n,"maybe"):"function"==typeof submitRSVP?submitRSVP(n,"maybe"):console.error("[rsvp-maybe] submitRSVP function not found"):console.error("[rsvp-maybe] Missing match ID")}),l.register("rsvp-withdraw",function(e,t){t.preventDefault();const n=e.dataset.matchId,o=e.dataset.playerId;n?o?"function"==typeof updatePlayerRSVP?updatePlayerRSVP(o,n,"no_response"):d(o,n,"no_response"):"function"==typeof withdrawRSVP?withdrawRSVP(n):console.error("[rsvp-withdraw] withdrawRSVP function not found"):console.error("[rsvp-withdraw] Missing match ID")}),l.register("rsvp-request-sms",function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.playerName,s=e.dataset.phone;if(n)if(window.jQuery){const e=window.jQuery;try{e("#smsPlayerName").text(o||"Player"),e("#smsPlayerId").val(n),e("#smsPlayerPhone").val(s||""),s&&"function"==typeof formatPhoneNumber?e("#smsPlayerPhoneDisplay").text(formatPhoneNumber(s)):e("#smsPlayerPhoneDisplay").text(s||""),e("#smsMessage").val(""),e("#smsCharCount").text("0");const t=document.querySelector('[data-modal="send-sms"]');t&&ModalManager.showByElement(t)}catch(i){console.error("[rsvp-request-sms] Error opening modal:",i)}}else{const e=document.querySelector('[data-modal="send-sms"]');if(e&&window.bootstrap){const t=document.getElementById("smsPlayerName"),i=document.getElementById("smsPlayerId"),a=document.getElementById("smsPlayerPhone"),r=document.getElementById("smsMessage"),c=document.getElementById("smsCharCount");t&&(t.textContent=o||"Player"),i&&(i.value=n),a&&(a.value=s||""),r&&(r.value=""),c&&(c.textContent="0"),ModalManager.showByElement(e)}}else console.error("[rsvp-request-sms] Missing player ID")}),l.register("rsvp-request-discord-dm",function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.playerName,s=e.dataset.discordId;if(n)if(window.jQuery){const e=window.jQuery;try{e("#discordPlayerName").text(o||"Player"),e("#discordPlayerId").val(n),e("#discordId").val(s||""),e("#discordMessage").val(""),e("#discordCharCount").text("0");const t=document.querySelector('[data-modal="send-discord-dm"]');t&&ModalManager.showByElement(t)}catch(i){console.error("[rsvp-request-discord-dm] Error opening modal:",i)}}else{const e=document.querySelector('[data-modal="send-discord-dm"]');if(e&&window.bootstrap){const t=document.getElementById("discordPlayerName"),i=document.getElementById("discordPlayerId"),a=document.getElementById("discordId"),r=document.getElementById("discordMessage"),c=document.getElementById("discordCharCount");t&&(t.textContent=o||"Player"),i&&(i.value=n),a&&(a.value=s||""),r&&(r.value=""),c&&(c.textContent="0"),ModalManager.showByElement(e)}}else console.error("[rsvp-request-discord-dm] Missing player ID")}),l.register("rsvp-update-status",function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.matchId,s=e.dataset.response;n&&o&&s?d(n,o,s):console.error("[rsvp-update-status] Missing required data attributes")}),l.register("copy-subscription-url",async function(e,t){t.preventDefault();const n=document.getElementById("subscriptionUrl");if(n&&n.value)try{await navigator.clipboard.writeText(n.value),u("success","URL copied to clipboard");const t=e.innerHTML;e.innerHTML='<i class="ti ti-check me-1"></i>Copied!',setTimeout(()=>{e.innerHTML=t},2e3)}catch(o){n.select(),document.execCommand("copy"),u("success","URL copied to clipboard")}else u("warning","No subscription URL available")}),l.register("regenerate-subscription-token",async function(e,t){if(t.preventDefault(),confirm("Are you sure you want to regenerate your subscription URL?\n\nYour existing calendar subscriptions will stop working and you will need to re-subscribe with the new URL.")){m(!0);try{const e=await fetch("/api/calendar/subscription/regenerate",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to regenerate token");await e.json(),"undefined"!=typeof CalendarSubscription&&CalendarSubscription.loadSubscription&&await CalendarSubscription.loadSubscription(),u("success","Subscription URL regenerated successfully")}catch(n){console.error("[regenerate-subscription-token] Error:",n),u("error","Failed to regenerate subscription URL")}finally{m(!1)}}}),l.register("subscribe-webcal",function(e,t){t.preventDefault();const n=e.dataset.webcalUrl;n?window.location.href=n:u("warning","Subscription URL not available")}),l.register("subscribe-google",function(e,t){t.preventDefault();const n=e.dataset.feedUrl;if(!n)return void u("warning","Subscription URL not available");const o="https://calendar.google.com/calendar/r?cid="+encodeURIComponent(n);window.open(o,"_blank")}),l.register("update-calendar-preferences",async function(e,t){var n,o,s;const i={include_team_matches:(null==(n=document.getElementById("subIncludeMatches"))?void 0:n.checked)??!0,include_league_events:(null==(o=document.getElementById("subIncludeLeagueEvents"))?void 0:o.checked)??!0,include_ref_assignments:(null==(s=document.getElementById("subIncludeRefAssignments"))?void 0:s.checked)??!0};try{const e=await fetch("/api/calendar/subscription/preferences",{method:"PUT",headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify(i)});if(!e.ok)throw new Error("Failed to update preferences");await e.json(),u("success","Preferences updated")}catch(a){console.error("[update-calendar-preferences] Error:",a),u("error","Failed to update preferences"),e.checked=!e.checked}}),l.register("verify-section-reviewed",function(e,t){window.ProfileVerification&&"function"==typeof window.ProfileVerification.handleCheckboxChange?window.ProfileVerification.handleCheckboxChange(e):console.error("[verify-section-reviewed] ProfileVerification not available")}),l.register("verify-profile",function(e,t){t.preventDefault();const n=e.dataset.playerId;if(!n)return void console.error("[verify-profile] Missing player ID");const o=document.querySelector("[data-profile-verify]"),s=(null==o?void 0:o.dataset.verifyUrl)||`/players/profile/${n}/verify`;window.location.href=s}),l.register("verify-profile-submit",function(e,t){if(window.ProfileVerification&&"function"==typeof window.ProfileVerification.areAllSectionsReviewed)if(window.ProfileVerification.areAllSectionsReviewed())window.Haptics&&window.Haptics.success();else{t.preventDefault();const e=window.ProfileVerification.getUncheckedSections();window.Haptics&&window.Haptics.error(),window.ProfileVerification.showIncompleteWarning(e)}else console.warn("[verify-profile-submit] ProfileVerification not available, allowing submission")}),l.register("change-per-page",function(e,t){const n=e.value,o=new URL(window.location);o.searchParams.set("per_page",n),o.searchParams.set("page","1"),window.location.href=o.toString()}),l.register("refresh-all-discord-status",function(e,t){t.preventDefault();const n=e;"undefined"!=typeof Swal?Swal.fire({title:"Refresh All Discord Status",text:"This will refresh Discord status for all players. This may take a moment. Continue?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, refresh all",cancelButtonText:"Cancel",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"#28c76f",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"}).then(e=>{var t;if(e.isConfirmed){const e=n.innerHTML;n.innerHTML='<i class="ti ti-loader ti-spin me-1"></i>Refreshing...',n.disabled=!0;const o=(null==(t=document.querySelector("meta[name=csrf-token]"))?void 0:t.getAttribute("content"))||"";fetch("/admin/refresh_all_discord_status",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":o}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to refresh status");Swal.fire({icon:"success",title:"Status Updated",text:`Refreshed Discord status for ${e.success_count} players`,timer:2e3,showConfirmButton:!1}).then(()=>{location.reload()})}).catch(e=>{Swal.fire({icon:"error",title:"Error",text:"Failed to refresh status: "+e.message,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"})}).finally(()=>{n.innerHTML=e,n.disabled=!1})}}):console.error("[refresh-all-discord-status] SweetAlert2 not available")}),l.register("refresh-unknown-discord-status",function(e,t){t.preventDefault();const n=e;"undefined"!=typeof Swal?Swal.fire({title:"Check Unknown Discord Status",text:"This will check Discord status for all players with unknown status. Continue?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, check unknown",cancelButtonText:"Cancel",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning"):"#ffab00",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"}).then(e=>{var t;if(e.isConfirmed){const e=n.innerHTML;n.innerHTML='<i class="ti ti-loader ti-spin me-1"></i>Checking...',n.disabled=!0;const o=(null==(t=document.querySelector("meta[name=csrf-token]"))?void 0:t.getAttribute("content"))||"";fetch("/admin/refresh_unknown_discord_status",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":o}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to check unknown status");Swal.fire({icon:"success",title:"Status Checked",text:`Checked Discord status for ${e.success_count} players with unknown status`,timer:2e3,showConfirmButton:!1}).then(()=>{location.reload()})}).catch(e=>{Swal.fire({icon:"error",title:"Error",text:"Failed to check unknown status: "+e.message,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"})}).finally(()=>{n.innerHTML=e,n.disabled=!1})}}):console.error("[refresh-unknown-discord-status] SweetAlert2 not available")}),l.register("refresh-player-status",function(e,t){var n;t.preventDefault();const o=e.dataset.playerId,s=e.dataset.playerName;if(!o)return void console.error("[refresh-player-status] Missing player ID");const i=e.innerHTML;e.innerHTML='<i class="ti ti-loader ti-spin me-1"></i><span>Checking...</span>',e.disabled=!0;const a=(null==(n=document.querySelector("meta[name=csrf-token]"))?void 0:n.getAttribute("content"))||"";fetch(`/teams/player/${o}/refresh-discord-status`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to refresh status");"undefined"!=typeof Swal?Swal.fire({icon:"success",title:"Status Updated",text:`Discord status refreshed for ${s}`,timer:2e3,showConfirmButton:!1}).then(()=>{location.reload()}):location.reload()}).catch(e=>{"undefined"!=typeof Swal?Swal.fire({icon:"error",title:"Error",text:"Failed to refresh status: "+e.message,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"}):console.error("[refresh-player-status] Error:",e)}).finally(()=>{e.innerHTML=i,e.disabled=!1})}),l.register("send-discord-dm",function(e,t){t.preventDefault();const n=e.dataset.discordId,o=e.dataset.playerName;if(!n)return void console.error("[send-discord-dm] Missing Discord ID");const s=document.getElementById("dmDiscordId"),i=document.querySelector("#discordDMModal .modal-title"),a=document.getElementById("dmMessage");s&&(s.value=n),i&&(i.textContent=`Send Discord DM to ${o}`);const r=`Hi ${o}! ð\n\nWe noticed you haven't joined our ECS FC Discord server yet.\n\nJoin us to:\nâ¢ Get match updates and announcements\nâ¢ Connect with your teammates\nâ¢ Participate in league discussions\n\nJoin here: https://discord.gg/weareecs\n\nSee you there!\n- ECS FC Admin Team`;a&&(a.value=r),document.getElementById("discordDMModal")&&ModalManager.show("discordDMModal")}),l.register("submit-discord-dm",function(e,t){var n,o,s;t.preventDefault();const i=null==(n=document.getElementById("dmDiscordId"))?void 0:n.value,a=null==(o=document.getElementById("dmMessage"))?void 0:o.value;if(!a||!a.trim())return void("undefined"!=typeof Swal&&Swal.fire({icon:"warning",title:"Message Required",text:"Please enter a message before sending",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning"):"#ffab00"}));const r=e.innerHTML;e.innerHTML='<i class="ti ti-loader ti-spin me-1"></i>Sending...',e.disabled=!0;const c=(null==(s=document.querySelector("meta[name=csrf-token]"))?void 0:s.getAttribute("content"))||"";fetch("/admin/send_discord_dm",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":c},body:JSON.stringify({discord_id:i,message:a})}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to send message");{const e=document.getElementById("discordDMModal");if(e&&window.bootstrap){const t=bootstrap.Modal.getInstance(e);t&&t.hide()}"undefined"!=typeof Swal&&Swal.fire({icon:"success",title:"Message Sent",text:"Discord message sent successfully!",timer:2e3,showConfirmButton:!1})}}).catch(e=>{"undefined"!=typeof Swal?Swal.fire({icon:"error",title:"Error",text:"Failed to send Discord message: "+e.message,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#ea5455"}):console.error("[submit-discord-dm] Error:",e)}).finally(()=>{e.innerHTML=r,e.disabled=!1})}),l.register("assign-referee",function(e,t){var n,o;t.preventDefault();const s=null==(n=document.getElementById("matchId"))?void 0:n.value,i=null==(o=document.getElementById("refSelect"))?void 0:o.value;s&&i?"function"==typeof assignReferee?assignReferee(t):console.error("[assign-referee] assignReferee function not found"):console.error("[assign-referee] Missing match ID or referee ID")}),l.register("remove-referee",function(e,t){var n;t.preventDefault(),e.dataset.matchId||(null==(n=document.getElementById("matchId"))?void 0:n.value)?"function"==typeof removeReferee?removeReferee():console.error("[remove-referee] removeReferee function not found"):console.error("[remove-referee] Missing match ID")}),l.register("refresh-calendar",function(e,t){t.preventDefault(),"function"==typeof loadCalendarEvents&&"function"==typeof fetchAvailableReferees?(loadCalendarEvents(),window.calendarInstance?fetchAvailableReferees(window.calendarInstance.getDate()):fetchAvailableReferees(new Date)):"function"==typeof window.refreshCalendar?window.refreshCalendar():console.error("[refresh-calendar] No refresh function available")}),l.register("view-referee-profile",function(e,t){t.preventDefault();const n=e.dataset.refereeId;if(n)if("function"==typeof viewRefereeProfile)viewRefereeProfile(n);else{const t=e.dataset.profileUrl||`/admin/referee/${n}`;window.location.href=t}else console.error("[view-referee-profile] Missing referee ID")}),l.register("update-referee-status",function(e,t){t.preventDefault();const n=e.dataset.refereeId,o=e.dataset.status;n&&o?"function"==typeof updateRefereeStatus?updateRefereeStatus(n,o):console.error("[update-referee-status] updateRefereeStatus function not found"):console.error("[update-referee-status] Missing referee ID or status")}),l.register("approve-pool-player",function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.league;n&&o?"function"==typeof approvePlayer?approvePlayer(n,o):console.error("[approve-pool-player] approvePlayer function not found"):console.error("[approve-pool-player] Missing required data attributes")}),l.register("remove-pool-player",function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.league;n&&o?"function"==typeof removePlayer?removePlayer(n,o):console.error("[remove-pool-player] removePlayer function not found"):console.error("[remove-pool-player] Missing required data attributes")}),l.register("edit-pool-preferences",function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.league;n&&o?"function"==typeof openEditPreferencesModal?openEditPreferencesModal(n,o):console.error("[edit-pool-preferences] openEditPreferencesModal function not found"):console.error("[edit-pool-preferences] Missing required data attributes")}),l.register("view-pool-player-details",function(e,t){t.preventDefault();const n=e.dataset.playerId;n?"function"==typeof openPlayerDetailsModal?openPlayerDetailsModal(n):console.error("[view-pool-player-details] openPlayerDetailsModal function not found"):console.error("[view-pool-player-details] Missing player ID")}),l.register("add-player-to-league",function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.league;n&&o?"function"==typeof approvePlayer?approvePlayer(n,o):console.error("[add-player-to-league] approvePlayer function not found"):console.error("[add-player-to-league] Missing required data attributes")}),l.register("toggle-pool-view",function(e,t){t.preventDefault();const n=e.dataset.view,o=e.dataset.league,s=e.dataset.section;if(!n||!o||!s)return void console.error("[toggle-pool-view] Missing required data attributes");e.parentElement.querySelectorAll(".view-toggle").forEach(e=>e.classList.remove("active")),e.classList.add("active");const i=document.getElementById(`${s}-list-${o}`),a=document.getElementById(`${s}-grid-${o}`);"list"===n?(i&&i.classList.remove("u-hidden"),a&&a.classList.add("u-hidden")):(i&&i.classList.add("u-hidden"),a&&a.classList.remove("u-hidden"))}),l.register("filter-pool",function(e,t){const n=e.value.toLowerCase().trim(),o=e.dataset.league,s=e.dataset.section;o&&s?"function"==typeof filterPlayerCards?filterPlayerCards(o,s,n):document.querySelectorAll(`.player-card[data-league="${o}"][data-status="${s}"], .player-list-item[data-league="${o}"][data-status="${s}"]`).forEach(e=>{const t=(e.dataset.searchText||"").toLowerCase(),o=!n||t.includes(n);e.classList.toggle("u-hidden",!o)}):console.error("[filter-pool] Missing required data attributes")}),l.register("manage-league-pool",function(e,t){t.preventDefault();const n=e.dataset.league;n?"function"==typeof openLeagueManagementModal?openLeagueManagementModal(n):console.error("[manage-league-pool] openLeagueManagementModal function not found"):console.error("[manage-league-pool] Missing league identifier")}),l.register("save-pool-preferences",function(e,t){t.preventDefault(),"function"==typeof savePreferences?savePreferences():console.error("[save-pool-preferences] savePreferences function not found")}),l.register("pool-pagination",function(e,t){t.preventDefault();const n=parseInt(e.dataset.page),o=e.dataset.league,s=e.dataset.section;if(!n||!o||!s)return void console.error("[pool-pagination] Missing required data attributes");const i=`${o}-${s}`;"undefined"!=typeof paginationState&&paginationState[i]&&n!==paginationState[i].currentPage&&(paginationState[i].currentPage=n,"function"==typeof updatePagination&&updatePagination(o,s))}),l.register("add-to-pool",async function(e,t){t.preventDefault();const n=e.dataset.playerId;n?"function"==typeof addToPool?addToPool(n):console.error("[add-to-pool] addToPool function not found"):console.error("[add-to-pool] Missing player ID")}),l.register("reject-player",async function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.playerName;n?"function"==typeof rejectPlayer?rejectPlayer(n,o):console.error("[reject-player] rejectPlayer function not found"):console.error("[reject-player] Missing player ID")}),l.register("remove-player",async function(e,t){t.preventDefault();const n=e.dataset.playerId,o=e.dataset.playerName;n?"function"==typeof removeFromPool?removeFromPool(n,o):console.error("[remove-player] removeFromPool function not found"):console.error("[remove-player] Missing player ID")}),l.register("load-stats",async function(e,t){t.preventDefault(),"function"==typeof loadStatistics?loadStatistics():console.error("[load-stats] loadStatistics function not found")}),l.register("add-player",function(e,t){t.preventDefault(),"function"==typeof showAddPlayerModal?showAddPlayerModal():console.error("[add-player] showAddPlayerModal function not found")}),l.register("onboarding-create-profile",function(e,t){t.preventDefault();const n=document.getElementById("form_action");n&&(n.value="create_profile");const o=document.getElementById("modalCarouselControls");o&&window.bootstrap&&(bootstrap.Carousel.getInstance(o)||new bootstrap.Carousel(o)).next()}),l.register("onboarding-skip-profile",function(e,t){t.preventDefault();const n=document.getElementById("form_action"),o=document.getElementById("onboardingSlideModal"),s=o?o.querySelector("form.needs-validation"):null;n&&(n.value="skip_profile"),s&&s.submit()}),l.register("onboarding-next",function(e,t){if(t.preventDefault(),t.stopPropagation(),!window.OnboardingWizard)return void console.error("[onboarding-next] OnboardingWizard not initialized");const{form:n,formActionInput:o,croppedImageHiddenInput:s,carouselElement:i,bootstrapCarousel:a,totalSteps:r}=window.OnboardingWizard.getFormElements();if(window.OnboardingWizard.getCurrentStep()===r){if(o&&(o.value="update_profile"),window.cropper)try{const e=window.cropper.getCroppedCanvas();e&&(s.value=e.toDataURL("image/png"))}catch(c){console.error("[onboarding-next] Error getting cropped image:",c)}if(n&&n.checkValidity())n.submit();else{n.classList.add("was-validated");const e=n.querySelector(":invalid");e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"center"}))}}else{const e=i?i.querySelector(".carousel-item.active"):null,t=e?e.querySelectorAll("input[required], select[required], textarea[required]"):[];let n=!0;if(t.forEach(e=>{if(null!==e.offsetParent)if(e.checkValidity())e.classList.remove("is-invalid");else if(n=!1,e.classList.add("is-invalid"),!e.nextElementSibling||!e.nextElementSibling.classList.contains("invalid-feedback")){const t=document.createElement("div");t.className="invalid-feedback",t.textContent=e.validationMessage||"This field is required.",e.parentNode.insertBefore(t,e.nextSibling)}}),n)o&&(o.value=""),a&&a.next();else{const t=e?e.querySelector(".is-invalid"):null;t&&(t.focus(),t.scrollIntoView({behavior:"smooth",block:"center"}))}}}),l.register("onboarding-previous",function(e,t){t.preventDefault();const n=document.getElementById("modalCarouselControls");if(n&&window.bootstrap){const e=bootstrap.Carousel.getInstance(n);e&&e.prev()}}),l.register("onboarding-toggle-sms",function(e,t){window.OnboardingWizard&&"function"==typeof window.OnboardingWizard.handleSmsToggle?window.OnboardingWizard.handleSmsToggle(e):console.error("[onboarding-toggle-sms] SMS toggle handler not available")}),l.register("refresh-stats",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.refreshAll?await window.securityDashboard.refreshAll():console.error("[refresh-stats] SecurityDashboard instance not available")}),l.register("refresh-events",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.loadSecurityEvents?await window.securityDashboard.loadSecurityEvents():console.error("[refresh-events] SecurityDashboard instance not available")}),l.register("refresh-logs",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.loadSecurityLogs?await window.securityDashboard.loadSecurityLogs():console.error("[refresh-logs] SecurityDashboard instance not available")}),l.register("unban-ip",async function(e,t){t.preventDefault();const n=e.dataset.ip;n?window.securityDashboard&&"function"==typeof window.securityDashboard.unbanIP?await window.securityDashboard.unbanIP(n,e):console.error("[unban-ip] SecurityDashboard instance not available"):console.error("[unban-ip] Missing IP address")}),l.register("ban-ip-quick",async function(e,t){t.preventDefault();const n=e.dataset.ip,o=e.dataset.reason||"Security event";n?window.securityDashboard&&"function"==typeof window.securityDashboard.quickBanIP?await window.securityDashboard.quickBanIP(n,o):console.error("[ban-ip-quick] SecurityDashboard instance not available"):console.error("[ban-ip-quick] Missing IP address")}),l.register("ban-ip-confirm",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.banIP?await window.securityDashboard.banIP():console.error("[ban-ip-confirm] SecurityDashboard instance not available")}),l.register("clear-all-bans",async function(e,t){t.preventDefault(),window.securityDashboard&&"function"==typeof window.securityDashboard.clearAllBans?await window.securityDashboard.clearAllBans():"function"==typeof clearAllBans?await clearAllBans():console.error("[clear-all-bans] No clearAllBans function available")}),l.register("show-ban-ip-modal",function(e,t){t.preventDefault(),"function"==typeof showBanIpModal?showBanIpModal():window.bootstrap?document.getElementById("banIpModal")&&ModalManager.show("banIpModal"):console.error("[show-ban-ip-modal] No showBanIpModal function available")}),l.register("ban-ip",async function(e,t){t.preventDefault(),"function"==typeof banIp?await banIp():window.securityDashboard&&"function"==typeof window.securityDashboard.banIP?await window.securityDashboard.banIP():console.error("[ban-ip] No banIp function available")}),l.register("start-season-wizard",function(e,t){t.preventDefault(),"function"==typeof startSeasonWizard?startSeasonWizard():console.error("[start-season-wizard] startSeasonWizard function not found")}),l.register("show-existing-seasons",function(e,t){t.preventDefault(),"function"==typeof showExistingSeasons?showExistingSeasons():console.error("[show-existing-seasons] showExistingSeasons function not found")}),l.register("show-main-view",function(e,t){t.preventDefault(),"function"==typeof showMainView?showMainView():console.error("[show-main-view] showMainView function not found")}),l.register("next-step",function(e,t){t.preventDefault(),"function"==typeof nextStep?nextStep():console.error("[next-step] nextStep function not found")}),l.register("previous-step",function(e,t){t.preventDefault(),"function"==typeof previousStep?previousStep():console.error("[previous-step] previousStep function not found")}),l.register("create-season",function(e,t){t.preventDefault(),"function"==typeof createSeason?createSeason():console.error("[create-season] createSeason function not found")}),l.register("update-season-structure",function(e,t){"function"==typeof updateSeasonStructure?updateSeasonStructure():console.error("[update-season-structure] updateSeasonStructure function not found")}),l.register("apply-wizard-template",function(e,t){t.preventDefault();const n=e.dataset.templateType;n?"function"==typeof applyWizardTemplate?applyWizardTemplate(n):console.error("[apply-wizard-template] applyWizardTemplate function not found"):console.error("[apply-wizard-template] Missing template type")}),l.register("add-wizard-field",function(e,t){t.preventDefault(),"function"==typeof addWizardField?addWizardField():console.error("[add-wizard-field] addWizardField function not found")}),l.register("remove-wizard-field",function(e,t){t.preventDefault(),"function"==typeof removeWizardField?removeWizardField(e):console.error("[remove-wizard-field] removeWizardField function not found")}),l.register("set-active-season",function(e,t){t.preventDefault();const n=e.dataset.seasonId,o=e.dataset.seasonType;n&&o?"function"==typeof setActiveSeason?setActiveSeason(n,o):console.error("[set-active-season] setActiveSeason function not found"):console.error("[set-active-season] Missing season ID or type")}),l.register("confirm-delete-season",function(e,t){t.preventDefault();const n=e.dataset.seasonId,o=e.dataset.seasonName;n&&o?"function"==typeof confirmDeleteSeason?confirmDeleteSeason(n,o):console.error("[confirm-delete-season] confirmDeleteSeason function not found"):console.error("[confirm-delete-season] Missing season ID or name")}),l.register("recreate-discord-resources",function(e,t){t.preventDefault();const n=e.dataset.seasonId,o=e.dataset.seasonName;n&&o?"function"==typeof recreateDiscordResources?recreateDiscordResources(n,o):console.error("[recreate-discord-resources] recreateDiscordResources function not found"):console.error("[recreate-discord-resources] Missing season ID or name")}),l.register("toggle-settings",function(e,t){t.preventDefault(),"function"==typeof toggleScheduleSettings?toggleScheduleSettings():console.error("[toggle-settings] toggleScheduleSettings function not found")}),l.register("delete-schedule",function(e,t){t.preventDefault(),"function"==typeof deleteSchedule?deleteSchedule():console.error("[delete-schedule] deleteSchedule function not found")}),l.register("commit-schedule",function(e,t){t.preventDefault(),"function"==typeof commitSchedule?commitSchedule():console.error("[commit-schedule] commitSchedule function not found")}),l.register("select-for-swap",function(e,t){t.preventDefault();const n=parseInt(e.dataset.matchId),o=e.dataset.matchDesc;n&&o?"function"==typeof selectForSwap?selectForSwap(n,o):console.error("[select-for-swap] selectForSwap function not found"):console.error("[select-for-swap] Missing match ID or description")}),l.register("execute-swap",function(e,t){t.preventDefault(),"function"==typeof executeSwap?executeSwap():console.error("[execute-swap] executeSwap function not found")}),l.register("remove-from-swap",function(e,t){t.preventDefault();const n=parseInt(e.dataset.swapIndex);null!=n?"function"==typeof removeFromSwap?removeFromSwap(n):console.error("[remove-from-swap] removeFromSwap function not found"):console.error("[remove-from-swap] Missing swap index")}),l.register("remove-field",function(e,t){t.preventDefault(),"function"==typeof removeField?removeField(e):console.error("[remove-field] removeField function not found")}),l.register("add-field",function(e,t){t.preventDefault(),"function"==typeof addField?addField():console.error("[add-field] addField function not found")}),l.register("apply-template",function(e,t){t.preventDefault();const n=e.dataset.template;n?"function"==typeof applyTemplate?applyTemplate(n):console.error("[apply-template] applyTemplate function not found"):console.error("[apply-template] Missing template type")}),l.register("add-week-config",function(e,t){t.preventDefault(),"function"==typeof addWeekConfig?addWeekConfig():console.error("[add-week-config] addWeekConfig function not found")}),l.register("generate-default-weeks",function(e,t){t.preventDefault(),"function"==typeof generateDefaultWeeks?generateDefaultWeeks():console.error("[generate-default-weeks] generateDefaultWeeks function not found")}),l.register("clear-weeks",function(e,t){t.preventDefault(),"function"==typeof clearWeeks?clearWeeks():console.error("[clear-weeks] clearWeeks function not found")}),l.register("update-week-card",function(e,t){"function"==typeof updateWeekCard?updateWeekCard(e):console.error("[update-week-card] updateWeekCard function not found")}),l.register("remove-week-card",function(e,t){t.preventDefault(),"function"==typeof removeWeekCard?removeWeekCard(e):console.error("[remove-week-card] removeWeekCard function not found")}),l.register("close-toast",function(e,t){t.preventDefault(),e.parentElement&&e.parentElement.remove()}),l.register("toggle-platform",function(e,t){t.preventDefault();const n=e.dataset.platform;n?window.PassStudio&&"function"==typeof window.PassStudio.setPreviewPlatform?window.PassStudio.setPreviewPlatform(n):console.error("[toggle-platform] PassStudio.setPreviewPlatform not available"):console.error("[toggle-platform] Missing platform attribute")}),l.register("update-pass-style",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.updatePassStylePreview?window.PassStudio.updatePassStylePreview():console.error("[update-pass-style] PassStudio.updatePassStylePreview not available")}),l.register("apply-color-preset",function(e,t){t.preventDefault();const n=e.dataset.bg,o=e.dataset.fg,s=e.dataset.label;if(!n||!o||!s)return void console.error("[apply-color-preset] Missing color data attributes");const i=document.getElementById("background_color"),a=document.getElementById("foreground_color"),r=document.getElementById("label_color");i&&(i.value=n),a&&(a.value=o),r&&(r.value=s);const c=document.getElementById("background_color_text"),l=document.getElementById("foreground_color_text"),d=document.getElementById("label_color_text");c&&(c.value=n),l&&(l.value=o),d&&(d.value=s),window.PassStudio&&"function"==typeof window.PassStudio.updatePreviewFromForm&&window.PassStudio.updatePreviewFromForm(),window.PassStudio&&"function"==typeof window.PassStudio.markUnsaved&&window.PassStudio.markUnsaved()}),l.register("sync-color-input",function(e,t){const n=e.dataset.target;if(!n)return;const o=document.getElementById(n);if(o){if("color"===e.type){const t=document.getElementById(n+"_text");t&&(t.value=e.value)}else o.value=e.value;window.PassStudio&&"function"==typeof window.PassStudio.updatePreviewFromForm&&window.PassStudio.updatePreviewFromForm()}}),l.register("update-preview-field",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.updatePreviewFromForm&&window.PassStudio.updatePreviewFromForm()}),l.register("toggle-logo-visibility",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.toggleLogoVisibility&&window.PassStudio.toggleLogoVisibility()}),l.register("open-asset-cropper",function(e,t){t.preventDefault();const n=e.dataset.assetType;n?window.PassStudio&&"function"==typeof window.PassStudio.openAssetCropper?window.PassStudio.openAssetCropper(n):console.error("[open-asset-cropper] PassStudio.openAssetCropper not available"):console.error("[open-asset-cropper] Missing asset type")}),l.register("update-google-preview",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.updateGooglePreview&&window.PassStudio.updateGooglePreview()}),l.register("update-barcode-preview",function(e,t){window.PassStudio&&"function"==typeof window.PassStudio.updateBarcodePreview&&window.PassStudio.updateBarcodePreview()}),l.register("save-appearance",function(e,t){t.preventDefault(),window.PassStudio&&"function"==typeof window.PassStudio.saveAppearance?window.PassStudio.saveAppearance():console.error("[save-appearance] PassStudio.saveAppearance not available")}),l.register("initialize-defaults",function(e,t){t.preventDefault(),window.FieldsManager&&"function"==typeof window.FieldsManager.initializeDefaults?window.FieldsManager.initializeDefaults():console.error("[initialize-defaults] FieldsManager.initializeDefaults not available")}),l.register("add-field",function(e,t){t.preventDefault();const n=e.dataset.fieldType;n?window.FieldsManager&&"function"==typeof window.FieldsManager.openAddFieldModal?window.FieldsManager.openAddFieldModal(n):console.error("[add-field] FieldsManager.openAddFieldModal not available"):console.error("[add-field] Missing field type")}),l.register("create-field",function(e,t){t.preventDefault(),window.FieldsManager&&"function"==typeof window.FieldsManager.createField?window.FieldsManager.createField():console.error("[create-field] FieldsManager.createField not available")}),l.register("save-fields",function(e,t){t.preventDefault(),window.FieldsManager&&"function"==typeof window.FieldsManager.saveFields?window.FieldsManager.saveFields():console.error("[save-fields] FieldsManager.saveFields not available")}),l.register("reset-fields",function(e,t){t.preventDefault(),window.FieldsManager&&"function"==typeof window.FieldsManager.resetFields?window.FieldsManager.resetFields():console.error("[reset-fields] FieldsManager.resetFields not available")}),l.register("insert-variable",function(e,t){t.preventDefault();const n=e.dataset.variableName;n?window.FieldsManager&&"function"==typeof window.FieldsManager.insertVariableInAdd?window.FieldsManager.insertVariableInAdd(n):console.error("[insert-variable] FieldsManager.insertVariableInAdd not available"):console.error("[insert-variable] Missing variable name")}),l.register("refresh-approval-stats",function(e,t){t.preventDefault(),"function"==typeof window.refreshStats?window.refreshStats():console.error("[refresh-approval-stats] refreshStats function not found")}),l.register("show-player-details",function(e,t){t.preventDefault();const n=e.dataset.userId;n?"function"==typeof window.showPlayerDetails?window.showPlayerDetails(parseInt(n)):console.error("[show-player-details] showPlayerDetails function not found"):console.error("[show-player-details] Missing user ID")}),l.register("show-approval-modal",function(e,t){t.preventDefault();const n=e.dataset.userId;n?"function"==typeof window.showApprovalModal?window.showApprovalModal(parseInt(n)):console.error("[show-approval-modal] showApprovalModal function not found"):console.error("[show-approval-modal] Missing user ID")}),l.register("show-denial-modal",function(e,t){t.preventDefault();const n=e.dataset.userId;n?"function"==typeof window.showDenialModal?window.showDenialModal(parseInt(n)):console.error("[show-denial-modal] showDenialModal function not found"):console.error("[show-denial-modal] Missing user ID")}),l.register("approve-user",function(e,t){t.preventDefault(),"function"==typeof window.submitApproval?window.submitApproval():console.error("[approve-user] submitApproval function not found")}),l.register("deny-user",function(e,t){t.preventDefault(),"function"==typeof window.submitDenial?window.submitDenial():console.error("[deny-user] submitDenial function not found")}),window.EventDelegation=l,void 0!==t&&t.exports&&(t.exports=l),function(){const e=window.fetch,t=["POST","PUT","DELETE","PATCH"];window.fetch=function(n,o={}){const s=(o.method||"GET").toUpperCase();if(t.includes(s)){const e=function(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):null}();e&&(o.headers=o.headers||{},o.headers instanceof Headers?o.headers.has("X-CSRFToken")||o.headers.set("X-CSRFToken",e):o.headers["X-CSRFToken"]||o.headers["x-csrftoken"]||(o.headers["X-CSRFToken"]=e))}return e.call(window,n,o)},window.fetchWithCSRF=window.fetch,console.debug("[CSRF] Fetch wrapper initialized")}(),function(){const e={ROOT_EL:document.documentElement,LAYOUT_BREAKPOINT:1200,RESIZE_DELAY:200,_initialized:!1,_listeners:[],_resizeCallback:null,_resizeTimeout:null,menuPsScroll:null,mainMenu:null,isRtl:function(){var e,t;return"rtl"===(null==(e=document.querySelector("body"))?void 0:e.getAttribute("dir"))||"rtl"===(null==(t=document.querySelector("html"))?void 0:t.getAttribute("dir"))},isMobileDevice:function(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")},isSmallScreen:function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<this.LAYOUT_BREAKPOINT},isDarkStyle:function(){return"dark"===document.documentElement.getAttribute("data-style")||document.documentElement.classList.contains("dark-style")},isLightStyle:function(){return!this.isDarkStyle()},isCollapsed:function(){return this.isSmallScreen()?!document.documentElement.classList.contains("layout-menu-expanded"):document.documentElement.classList.contains("layout-menu-collapsed")},isFixed:function(){return document.documentElement.classList.contains("layout-menu-fixed")||document.documentElement.classList.contains("layout-menu-fixed-offcanvas")},isOffcanvas:function(){return document.documentElement.classList.contains("layout-menu-offcanvas")||document.documentElement.classList.contains("layout-menu-fixed-offcanvas")},isNavbarFixed:function(){return document.documentElement.classList.contains("layout-navbar-fixed")},isFooterFixed:function(){return document.documentElement.classList.contains("layout-footer-fixed")},isLayoutNavbarFull:function(){return!!document.querySelector(".layout-wrapper.layout-navbar-full")},getLayoutMenu:function(){return document.querySelector(".layout-menu, .c-sidebar")},getMenu:function(){const e=this.getLayoutMenu();return e?e.classList.contains("menu")?e:e.querySelector(".menu"):null},getLayoutNavbar:function(){return document.querySelector(".layout-navbar")},getLayoutFooter:function(){return document.querySelector(".content-footer")},_addClass:function(e,t=this.ROOT_EL){t&&(void 0!==t.length?t:[t]).forEach(t=>{t&&e.split(" ").forEach(e=>t.classList.add(e))})},_removeClass:function(e,t=this.ROOT_EL){t&&(void 0!==t.length?t:[t]).forEach(t=>{t&&e.split(" ").forEach(e=>t.classList.remove(e))})},_hasClass:function(e,t=this.ROOT_EL){let n=!1;return e.split(" ").forEach(e=>{t.classList.contains(e)&&(n=!0)}),n},setCollapsed:function(e,t=!0){this.isSmallScreen()?e?(this._removeClass("layout-menu-expanded"),document.body.classList.remove("sidebar-open")):(this._addClass("layout-menu-expanded"),document.body.classList.add("sidebar-open")):e?this._addClass("layout-menu-collapsed"):this._removeClass("layout-menu-collapsed"),this._triggerEvent("toggle")},toggleCollapsed:function(e=!0){this.setCollapsed(!this.isCollapsed(),e)},setNavbarFixed:function(e){e?this._addClass("layout-navbar-fixed"):this._removeClass("layout-navbar-fixed")},setFooterFixed:function(e){e?this._addClass("layout-footer-fixed"):this._removeClass("layout-footer-fixed")},scrollToActive:function(e=!1){const t=this.getLayoutMenu();if(!t)return;const n=t.querySelector("li.menu-item.active:not(.open), .c-sidebar__item.is-active");if(!n)return;const o=t.querySelector(".menu-inner, .c-sidebar__nav");if(!o)return;const s=n.getBoundingClientRect().top-o.getBoundingClientRect().top+o.scrollTop;if(s<.66*o.clientHeight)return;const i=s-o.clientHeight/2;e?o.scrollTo({top:i,behavior:"smooth"}):o.scrollTop=i},swipeIn:function(e,t){if("undefined"!=typeof Hammer&&"string"==typeof e){const n=document.querySelector(e);n&&new Hammer(n).on("panright",t)}},swipeOut:function(e,t){"undefined"!=typeof Hammer&&"string"==typeof e&&setTimeout(()=>{const n=document.querySelector(e);if(n){const e=new Hammer(n);e.get("pan").set({direction:Hammer.DIRECTION_ALL,threshold:250}),e.on("panleft",t)}},500)},initPasswordToggle:function(){document.querySelectorAll(".form-password-toggle i").forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();const n=e.closest(".form-password-toggle"),o=null==n?void 0:n.querySelector("input"),s=null==n?void 0:n.querySelector("i");o&&s&&("text"===o.type?(o.type="password",s.classList.replace("ti-eye","ti-eye-off")):(o.type="text",s.classList.replace("ti-eye-off","ti-eye")))})})},initCustomOptionCheck:function(){document.querySelectorAll(".custom-option .form-check-input").forEach(e=>{this.updateCustomOptionCheck(e),e.addEventListener("click",()=>this.updateCustomOptionCheck(e))})},updateCustomOptionCheck:function(e){var t,n,o;e.checked?("radio"===e.type&&(null==(t=e.closest(".row"))||t.querySelectorAll(".custom-option").forEach(e=>{e.classList.remove("checked")})),null==(n=e.closest(".custom-option"))||n.classList.add("checked")):null==(o=e.closest(".custom-option"))||o.classList.remove("checked")},initSpeechToText:function(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;e&&document.querySelectorAll(".speech-to-text i").forEach(t=>{let n=!1;t.addEventListener("click",function(){var o;const s=null==(o=t.closest(".input-group"))?void 0:o.querySelector(".form-control");if(!s)return;s.focus();const i=new e;i.onspeechstart=()=>{n=!0},i.onerror=()=>{n=!1},i.onresult=e=>{s.value=e.results[0][0].transcript},i.onspeechend=()=>{n=!1,i.stop()},n||i.start()})})},initNavbarDropdownScrollbar:function(){"undefined"!=typeof PerfectScrollbar&&document.querySelectorAll(".navbar-dropdown .scrollable-container").forEach(e=>{new PerfectScrollbar(e,{wheelPropagation:!1,suppressScrollX:!0})})},initSidebarToggle:function(){document.querySelectorAll('[data-bs-toggle="sidebar"]').forEach(e=>{e.addEventListener("click",function(){const t=e.getAttribute("data-target"),n=e.getAttribute("data-overlay"),o=document.querySelector(".app-overlay");document.querySelectorAll(t).forEach(e=>{e.classList.toggle("show"),n&&o&&(e.classList.contains("show")?o.classList.add("show"):o.classList.remove("show"),o.addEventListener("click",t=>{t.currentTarget.classList.remove("show"),e.classList.remove("show")}))})})})},on:function(e,t){const[n,...o]=e.split("."),s=o.join(".")||null;this._listeners.push({event:n,namespace:s,callback:t})},off:function(e){const[t,...n]=e.split("."),o=n.join(".")||null;this._listeners=this._listeners.filter(e=>!(e.event===t&&e.namespace===o))},_triggerEvent:function(e){window.dispatchEvent(new Event("layout"+e)),this._listeners.filter(t=>t.event===e).forEach(e=>e.callback.call(null))},update:function(){},setAutoUpdate:function(e){},init:function(){if(this._initialized)return;this._initialized=!0;const e=this;this._resizeCallback=function(){e._resizeTimeout&&clearTimeout(e._resizeTimeout),e._resizeTimeout=setTimeout(()=>{e._triggerEvent("resize")},e.RESIZE_DELAY)},window.addEventListener("resize",this._resizeCallback)},destroy:function(){this._initialized&&(this._initialized=!1,this._resizeCallback&&(window.removeEventListener("resize",this._resizeCallback),this._resizeCallback=null),this._listeners=[])}};e.init(),window.Helpers=e}();let h=(n=class{static init(e=document){e===document&&this._initialized||("undefined"!=typeof bootstrap&&void 0!==bootstrap.Modal?(this.log("Initializing Modal Manager..."),this.discoverModals(e),e===document&&(this.setupEventDelegation(),this.setupMutationObserver(),this._initialized=!0),this.log(`Initialized with ${this.modalInstances.size} modals`)):console.error("[ModalManager] Bootstrap not loaded. Cannot initialize modals."))}static discoverModals(e=document){e.querySelectorAll("[data-modal], .modal").forEach(e=>{if(e.id){if(this.modalInstances.has(e.id))return;try{let t=bootstrap.Modal.getInstance(e);t||(t=new bootstrap.Modal(e)),this.modalInstances.set(e.id,t),this.log(`Cached modal: ${e.id}`)}catch(t){console.error(`[ModalManager] Failed to initialize modal ${e.id}:`,t)}}else console.warn("[ModalManager] Found modal without ID. Modals should have unique IDs:",e)})}static setupEventDelegation(){"undefined"!=typeof EventDelegation?(EventDelegation.register("show-modal",(e,t)=>{const n=e.dataset.modalId;if(n){const t=this.parseOptionsFromElement(e);this.show(n,t)}else console.error('[ModalManager] data-action="show-modal" requires data-modal-id attribute')},{preventDefault:!0}),EventDelegation.register("hide-modal",(e,t)=>{const n=e.dataset.modalId;if(n)this.hide(n);else{const t=e.closest("[data-modal], .modal");t&&t.id&&this.hide(t.id)}},{preventDefault:!0}),EventDelegation.register("close-modal",(e,t)=>{const n=e.dataset.modalId;if(n)this.hide(n);else{const t=e.closest("[data-modal], .modal");t&&t.id&&this.hide(t.id)}},{preventDefault:!0}),EventDelegation.register("toggle-modal",(e,t)=>{const n=e.dataset.modalId;n?this.toggle(n):console.error('[ModalManager] data-action="toggle-modal" requires data-modal-id attribute')},{preventDefault:!0}),this.log("Event delegation registered via EventDelegation system")):(document.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,o=t.dataset.modalId;switch(n){case"show-modal":if(o){e.preventDefault();const n=this.parseOptionsFromElement(t);this.show(o,n)}else console.error('[ModalManager] data-action="show-modal" requires data-modal-id attribute');break;case"hide-modal":case"close-modal":if(e.preventDefault(),o)this.hide(o);else{const e=t.closest("[data-modal], .modal");e&&e.id&&this.hide(e.id)}break;case"toggle-modal":o?(e.preventDefault(),this.toggle(o)):console.error('[ModalManager] data-action="toggle-modal" requires data-modal-id attribute')}}),this.log("Event delegation registered via fallback click handler"))}static parseOptionsFromElement(e){const t={};return void 0!==e.dataset.backdrop&&(t.backdrop="false"!==e.dataset.backdrop&&e.dataset.backdrop),void 0!==e.dataset.keyboard&&(t.keyboard="true"===e.dataset.keyboard),void 0!==e.dataset.focus&&(t.focus="true"===e.dataset.focus),Object.keys(t).length>0?t:null}static setupMutationObserver(){new MutationObserver(e=>{e.forEach(e=>{e.removedNodes.forEach(e=>{var t,n;1===e.nodeType&&((null==(t=e.classList)?void 0:t.contains("modal"))||(null==(n=e.hasAttribute)?void 0:n.call(e,"data-modal")))&&e.id&&this.cleanup(e.id)})})}).observe(document.body,{childList:!0,subtree:!0})}static show(e,t=null){if(!e)return console.error("[ModalManager] show() requires a modal ID"),!1;this.log(`Showing modal: ${e}`);let n=this.modalInstances.get(e);if(!n){const s=document.getElementById(e);if(!s)return console.error(`[ModalManager] Modal element not found: ${e}`),!1;try{n=bootstrap.Modal.getInstance(s),n||(n=new bootstrap.Modal(s,t)),this.modalInstances.set(e,n),this.log(`Created and cached new modal: ${e}`)}catch(o){return console.error(`[ModalManager] Failed to initialize modal ${e}:`,o),!1}}try{return n.show(),!0}catch(o){return console.error(`[ModalManager] Failed to show modal ${e}:`,o),!1}}static hide(e){if(!e)return console.error("[ModalManager] hide() requires a modal ID"),!1;this.log(`Hiding modal: ${e}`);const t=this.modalInstances.get(e);if(!t){console.warn(`[ModalManager] Modal not found in cache: ${e}`);const t=document.getElementById(e);if(t){const o=bootstrap.Modal.getInstance(t);if(o)try{return o.hide(),!0}catch(n){return console.error(`[ModalManager] Failed to hide modal ${e}:`,n),!1}}return!1}try{return t.hide(),!0}catch(n){return console.error(`[ModalManager] Failed to hide modal ${e}:`,n),!1}}static toggle(e){if(!e)return console.error("[ModalManager] toggle() requires a modal ID"),!1;const t=this.modalInstances.get(e);if(!t)return this.show(e);try{return t.toggle(),!0}catch(n){return console.error(`[ModalManager] Failed to toggle modal ${e}:`,n),!1}}static getInstance(e){return this.modalInstances.get(e)||null}static cleanup(e){if(this.modalInstances.has(e)){this.log(`Cleaning up modal: ${e}`);try{this.modalInstances.get(e).dispose()}catch(t){console.warn(`[ModalManager] Error disposing modal ${e}:`,t)}this.modalInstances.delete(e)}}static cleanupAll(){this.log("Cleaning up all modals..."),this.modalInstances.forEach((e,t)=>{try{e.dispose()}catch(n){console.warn(`[ModalManager] Error disposing modal ${t}:`,n)}}),this.modalInstances.clear(),this.log("All modals cleaned up")}static reinit(e=document){this.log("Reinitializing Modal Manager..."),this.discoverModals(e)}static enableDebug(){this.DEBUG=!0,console.log("[ModalManager] Debug mode enabled")}static disableDebug(){this.DEBUG=!1}static log(...e){this.DEBUG&&console.log("[ModalManager]",...e)}},s(n,"modalInstances",new Map),s(n,"DEBUG",!0),s(n,"_initialized",!1),n);function p(e,t){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t}void 0!==window.InitSystem?window.InitSystem.register("ModalManager",{priority:20,init:function(e){h.init(e)}}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>h.init()):h.init(),window.ModalManager=h,window.safeGetModal=function(e){return console.warn("[Deprecated] safeGetModal() is deprecated. Use ModalManager.getInstance() instead."),h.getInstance(e)},window.safeShowModal=function(e){return console.warn("[Deprecated] safeShowModal() is deprecated. Use ModalManager.show() instead."),h.show(e)};let f={colors:{primary:"#7C3AED",success:"#10B981",danger:"#EF4444",warning:"#F59E0B",info:"#3B82F6",secondary:"#64748B",light:"#FAFAFA",dark:"#18181B"},colors_label:{},colors_dark:{}};window.assetsPath=document.documentElement.getAttribute("data-assets-path"),window.templateName=document.documentElement.getAttribute("data-template"),window.rtlSupport=!0,document.addEventListener("DOMContentLoaded",function(){document.documentElement.setAttribute("data-content","wide"),f.colors={primary:p("--ecs-primary","#7C3AED"),success:p("--ecs-success","#10B981"),danger:p("--ecs-danger","#EF4444"),warning:p("--ecs-warning","#F59E0B"),info:p("--ecs-info","#3B82F6"),secondary:p("--ecs-secondary","#64748B"),light:p("--ecs-neutral-5","#FAFAFA"),dark:p("--ecs-neutral-90","#18181B")},f.colors_label={...f.colors},f.colors_dark={cardBg:p("--ecs-dark-bg-card","#18181B"),bodyBg:p("--ecs-dark-bg-body","#09090B"),headerBg:p("--ecs-dark-bg-elevated","#27272A")}}),function(){const e={sidebar:".c-sidebar",sidebarToggle:'[data-action="toggle-sidebar"]',submenuToggle:'[data-action="toggle-submenu"]',expandableItem:"[data-expandable]"},t={open:"is-open",collapsed:"layout-menu-collapsed"},n={collapsedKey:"sidebar-collapsed"},o={desktop:1200},s={isDesktop:window.innerWidth>=o.desktop,isSidebarOpen:!1,collapsedState:"true"===localStorage.getItem(n.collapsedKey)};let i=null;function a(){i=document.querySelector(e.sidebar),i?(s.isDesktop&&s.collapsedState&&document.body.classList.add(t.collapsed),document.addEventListener("click",r),document.addEventListener("click",c),i.addEventListener("keydown",h),function(){let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(b,150)})}(),i.hasAttribute("role")||i.setAttribute("role","navigation"),i.hasAttribute("aria-label")||i.setAttribute("aria-label","Main navigation"),s.isDesktop||i.setAttribute("aria-hidden","true"),i.querySelectorAll(e.submenuToggle).forEach(n=>{const o=n.closest(e.expandableItem),s=null==o?void 0:o.classList.contains(t.open);n.setAttribute("aria-expanded",s)}),console.log("Sidebar interactions initialized")):console.warn("Sidebar not found")}function r(n){var o;const i=n.target,a=null==(o=i.closest("[data-action]"))?void 0:o.getAttribute("data-action");if(a)switch(a){case"toggle-sidebar":case"toggle-menu":n.preventDefault(),l();break;case"close-menu":n.preventDefault(),s.isDesktop||m();break;case"toggle-submenu":n.preventDefault(),function(n){const o=n.closest(e.expandableItem);if(!o)return;const s=o.classList.toggle(t.open);n.setAttribute("aria-expanded",s),console.log("Submenu toggled:",s)}(i);break;case"no-active-season":n.preventDefault(),alert("No active Pub League season");break;case"navigate":case"navigate-home":s.isDesktop||m()}}function c(e){s.isDesktop||s.isSidebarOpen&&(i.contains(e.target)||m())}function l(){s.isDesktop?d():s.isSidebarOpen?m():u()}function d(){const o=document.body.classList.toggle(t.collapsed);s.collapsedState=o,localStorage.setItem(n.collapsedKey,o);const a=i.querySelector(e.sidebarToggle);a&&a.setAttribute("aria-label",o?"Expand navigation menu":"Collapse navigation menu"),console.log("Sidebar collapsed state:",o)}function u(){i.classList.add(t.open),s.isSidebarOpen=!0,document.documentElement.classList.add("layout-menu-expanded");const e=document.querySelector(".layout-overlay");e&&e.classList.add("show"),i.setAttribute("aria-hidden","false"),function(){const e=p();g=e[0],v=e[e.length-1],f=!0,null==g||g.focus(),document.addEventListener("keydown",y)}(),console.log("Sidebar opened")}function m(){i.classList.remove(t.open),s.isSidebarOpen=!1,document.documentElement.classList.remove("layout-menu-expanded");const e=document.querySelector(".layout-overlay");e&&e.classList.remove("show"),i.setAttribute("aria-hidden","true"),f=!1,document.removeEventListener("keydown",y),console.log("Sidebar closed")}function h(e){const{key:t,target:n}=e;if("Escape"!==t||s.isDesktop){if(n.matches("a, button"))switch(t){case"ArrowUp":e.preventDefault(),function(e){var t;const n=p(),o=n.indexOf(e),s=o>0?o-1:n.length-1;null==(t=n[s])||t.focus()}(n);break;case"ArrowDown":e.preventDefault(),function(e){var t;const n=p(),o=n.indexOf(e),s=o<n.length-1?o+1:0;null==(t=n[s])||t.focus()}(n);break;case"Home":e.preventDefault(),function(){var e;const t=p();null==(e=t[0])||e.focus()}();break;case"End":e.preventDefault(),function(){var e;const t=p();null==(e=t[t.length-1])||e.focus()}()}}else m()}function p(){return Array.from(i.querySelectorAll("a[href], button:not([disabled])")).filter(e=>!e.closest(".c-sidebar__link--disabled"))}let f=!1,g=null,v=null;function y(e){f&&"Tab"===e.key&&(e.shiftKey?document.activeElement===g&&(e.preventDefault(),null==v||v.focus()):document.activeElement===v&&(e.preventDefault(),null==g||g.focus()))}function b(){const e=s.isDesktop;s.isDesktop=window.innerWidth>=o.desktop,e&&!s.isDesktop&&(m(),document.body.classList.remove(t.collapsed)),!e&&s.isDesktop&&(m(),s.collapsedState&&document.body.classList.add(t.collapsed))}window.SidebarInteractions={open:u,close:m,toggle:l,collapse:()=>{s.isDesktop&&!s.collapsedState&&d()},expand:()=>{s.isDesktop&&s.collapsedState&&d()}},void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("sidebar-interactions",a,{priority:80,description:"Sidebar toggle, collapse, and mobile drawer interactions",reinitializable:!1}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()}();class g{constructor(){this.navbar=document.querySelector(".c-navbar-modern"),this.navbar?(this.activeDropdown=null,this.lastScrollTop=0,this.scrollThreshold=50,this.init()):console.warn("Modern navbar not found")}getCSRFToken(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const t=document.querySelector('input[name="csrf_token"]');if(t)return t.value;const n=document.cookie.split(";");for(const o of n){const[e,t]=o.trim().split("=");if("csrf_token"===e)return decodeURIComponent(t)}return""}init(){this.registerEventHandlers(),this.attachEventListeners(),this.initScrollTracking(),this.initSearch(),this.initNotifications(),this.initRoleImpersonation(),this.initTheme(),this.initPresence()}registerEventHandlers(){"undefined"!=typeof EventDelegation?(EventDelegation.register("toggle-menu",(e,t)=>{this.toggleMobileMenu()},{preventDefault:!0}),EventDelegation.register("toggle-dropdown",(e,t)=>{const n=e.dataset.dropdown;n&&this.toggleDropdown(n)},{preventDefault:!0}),EventDelegation.register("switch-theme",(e,t)=>{const n=e.dataset.theme;n&&this.switchTheme(n)},{preventDefault:!0}),EventDelegation.register("start-impersonation",(e,t)=>{this.startRoleImpersonation()},{preventDefault:!0}),EventDelegation.register("stop-impersonation",(e,t)=>{this.stopRoleImpersonation()},{preventDefault:!0}),EventDelegation.register("mark-read",(e,t)=>{const n=e.dataset.notificationId;n&&this.markNotificationRead(n)},{preventDefault:!0}),EventDelegation.register("mark-all-read",(e,t)=>{this.markAllNotificationsRead()},{preventDefault:!0}),EventDelegation.register("clear-all-notifications",(e,t)=>{this.clearAllNotifications()},{preventDefault:!0}),EventDelegation.register("dismiss-notification",(e,t)=>{const n=e.dataset.notificationId;n&&this.dismissNotification(n)},{preventDefault:!0,stopPropagation:!0}),EventDelegation.register("expand-notification",(e,t)=>{const n=e.dataset.notificationId;n&&this.toggleNotificationExpand(n)},{preventDefault:!0}),EventDelegation.register("logout",(e,t)=>{this.handleLogout()},{preventDefault:!0})):console.warn("[Navbar] EventDelegation not available, using fallback")}attachEventListeners(){document.addEventListener("keydown",this.handleKeyboard.bind(this)),document.addEventListener("click",this.handleOutsideClick.bind(this))}handleKeyboard(e){if("Escape"!==e.key||!this.activeDropdown)return!this.activeDropdown||"ArrowDown"!==e.key&&"ArrowUp"!==e.key?void 0:(e.preventDefault(),void this.navigateDropdown(e.key));this.closeDropdown(this.activeDropdown)}handleOutsideClick(e){if(!this.activeDropdown)return;const t=document.querySelector(`[data-dropdown-id="${this.activeDropdown}"]`),n=document.querySelector(`[data-dropdown="${this.activeDropdown}"]`);t&&!t.contains(e.target)&&n&&!n.contains(e.target)&&this.closeDropdown(this.activeDropdown)}toggleDropdown(e){const t=document.querySelector(`[data-dropdown-id="${e}"]`);t&&(this.activeDropdown&&this.activeDropdown!==e&&this.closeDropdown(this.activeDropdown),t.classList.contains("is-open")?this.closeDropdown(e):this.openDropdown(e))}openDropdown(e){const t=document.querySelector(`[data-dropdown-id="${e}"]`),n=document.querySelector(`[data-dropdown="${e}"]`);t&&(t.classList.add("is-open"),t.setAttribute("aria-hidden","false"),n&&(n.classList.add("is-active"),n.setAttribute("aria-expanded","true")),this.activeDropdown=e,this.staggerDropdownItems(t))}closeDropdown(e){const t=document.querySelector(`[data-dropdown-id="${e}"]`),n=document.querySelector(`[data-dropdown="${e}"]`);t&&(t.classList.remove("is-open"),t.setAttribute("aria-hidden","true"),n&&(n.classList.remove("is-active"),n.setAttribute("aria-expanded","false")),this.activeDropdown===e&&(this.activeDropdown=null))}staggerDropdownItems(e){e.querySelectorAll(".c-navbar-modern__dropdown-item").forEach((e,t)=>{e.style.opacity="0",e.style.transform="translateX(-8px)",setTimeout(()=>{e.style.transition="all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",e.style.opacity="1",e.style.transform="translateX(0)"},30*t)})}navigateDropdown(e){var t;const n=document.querySelector(`[data-dropdown-id="${this.activeDropdown}"]`);if(!n)return;const o=Array.from(n.querySelectorAll(".c-navbar-modern__dropdown-item:not([disabled])")),s=o.findIndex(e=>e===document.activeElement);let i;i="ArrowDown"===e?s<o.length-1?s+1:0:s>0?s-1:o.length-1,null==(t=o[i])||t.focus()}toggleMobileMenu(){const e=document.querySelector('[data-action="toggle-menu"]'),t=document.querySelector("[data-mobile-menu]");e&&t&&(e.classList.contains("is-open")?(e.classList.remove("is-open"),t.classList.remove("is-open"),document.body.style.overflow=""):(e.classList.add("is-open"),t.classList.add("is-open"),document.body.style.overflow="hidden"))}initScrollTracking(){let e=!1;window.addEventListener("scroll",()=>{e||(window.requestAnimationFrame(()=>{const t=window.pageYOffset||document.documentElement.scrollTop;t>this.scrollThreshold?this.navbar.classList.add("is-scrolled"):this.navbar.classList.remove("is-scrolled"),this.lastScrollTop=t,e=!1}),e=!0)})}initSearch(){const e=document.querySelector(".c-navbar-modern__search-input");if(!e)return;const t=e.closest("form");let n;t&&t.addEventListener("submit",e=>{e.preventDefault()}),e.addEventListener("input",e=>{clearTimeout(n);const t=e.target.value.trim();t.length>=2&&(n=setTimeout(()=>{this.performSearch(t)},300))}),e.addEventListener("focus",()=>{e.parentElement.classList.add("is-focused")}),e.addEventListener("blur",()=>{e.parentElement.classList.remove("is-focused")})}performSearch(e){"function"==typeof window.initializePlayerSearch&&console.log("Searching for:",e)}switchTheme(e){this.closeDropdown("theme");let t=e;"system"===e&&(t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");const n=document.documentElement,o=document.body;n.setAttribute("data-style",t),n.setAttribute("data-bs-theme",t),o.setAttribute("data-bs-theme",t),n.setAttribute("data-theme",t),"dark"===t?(n.classList.add("dark-style"),n.classList.remove("light-style")):(n.classList.add("light-style"),n.classList.remove("dark-style")),localStorage.setItem("theme",e),localStorage.setItem("templateCustomizer-skin",t);const s=document.querySelector('[data-role="theme-icon"]');if(s){const t={light:"ti-sun",dark:"ti-moon-stars",system:"ti-device-desktop"}[e]||"ti-moon-stars";s.className=`c-navbar-modern__theme-icon ti ${t}`}document.querySelectorAll('[data-action="switch-theme"]').forEach(t=>{t.dataset.theme===e?t.classList.add("is-active"):t.classList.remove("is-active")}),this.showToast(`Theme switched to ${e} mode`)}startRoleImpersonation(){const e=document.querySelectorAll('input[name="impersonate_roles"]:checked'),t=Array.from(e).map(e=>e.value);0!==t.length?fetch("/admin-panel/user-management/impersonate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({roles:t})}).then(e=>e.json()).then(e=>{if(e.success){const e=document.querySelector('[data-dropdown="impersonation"]');e&&e.classList.add("c-navbar-modern__impersonation-active");const n=null==e?void 0:e.querySelector(".c-navbar-modern__badge");n&&n.classList.remove("u-hidden");const o=document.getElementById("currentRoleStatus"),s=document.getElementById("activeImpersonationStatus"),i=document.getElementById("activeRolesList");o&&o.classList.add("u-hidden"),s&&(s.classList.remove("u-hidden"),i&&(i.innerHTML=t.map(e=>`<span class="c-role-status__role-tag">${e}</span>`).join(""))),this.closeDropdown("impersonation"),this.showToast("Role testing started","success"),setTimeout(()=>window.location.reload(),1e3)}else this.showToast(e.message||"Failed to start role testing","error")}).catch(e=>{console.error("Impersonation error:",e),this.showToast("An error occurred","error")}):this.showToast("Please select at least one role","warning")}stopRoleImpersonation(){fetch("/admin-panel/user-management/stop-impersonate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}}).then(e=>e.json()).then(e=>{e.success&&(this.showToast("Impersonation stopped","success"),setTimeout(()=>window.location.reload(),1e3))}).catch(e=>{console.error("Stop impersonation error:",e)})}async markNotificationRead(e){const t=document.querySelector(`[data-notification-id="${e}"]`);if(t){t.classList.remove("is-unread");try{const t=await fetch(`/api/notifications/${e}/read`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}}),n=await t.json();n.success&&this.updateNotificationBadge(n.unread_count)}catch(n){console.error("Mark notification read error:",n),t.classList.add("is-unread")}}}async markAllNotificationsRead(){document.querySelectorAll(".c-navbar-modern__notification.is-unread").forEach(e=>{e.classList.remove("is-unread")});try{const e=await fetch("/api/notifications/mark-all-read",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}});(await e.json()).success&&(this.updateNotificationBadge(0),this.showToast("All notifications marked as read","success"))}catch(e){console.error("Mark all read error:",e),this.loadNotifications()}}handleLogout(){const e=document.querySelector("#logout-form");e&&e.submit()}initNotifications(){this.loadNotifications(),setInterval(()=>this.refreshNotificationCount(),6e4)}async loadNotifications(){const e=document.getElementById("notifications-list");if(!e)return;const t=e.querySelector('[data-state="loading"]'),n=e.querySelector('[data-state="empty"]');try{const o=await fetch("/api/notifications?include_read=true&limit=10"),s=await o.json();t&&t.classList.add("u-hidden"),s.success&&s.notifications.length>0?(n&&n.classList.add("u-hidden"),e.querySelectorAll(".c-navbar-modern__notification").forEach(e=>e.remove()),s.notifications.forEach(t=>{const n=this.createNotificationElement(t);e.appendChild(n)}),this.updateNotificationBadge(s.unread_count)):(n&&n.classList.remove("u-hidden"),this.updateNotificationBadge(0))}catch(o){if(console.error("Error loading notifications:",o),t&&t.classList.add("u-hidden"),n){n.classList.remove("u-hidden");const e=n.querySelector("p");e&&(e.textContent="Failed to load notifications")}}}createNotificationElement(e){const t=document.createElement("div");t.className="c-navbar-modern__notification"+(e.is_read?"":" is-unread"),t.setAttribute("data-notification-id",e.id),t.setAttribute("role","menuitem"),t.setAttribute("tabindex","0");const n=e.icon_color?`text-${e.icon_color}`:"",o=e.message.length>80?e.message.substring(0,80)+"...":e.message,s=e.message.length>80;return t.innerHTML=`\n      <div class="c-navbar-modern__notification-main"\n           data-action="expand-notification"\n           data-notification-id="${e.id}">\n        <div class="c-navbar-modern__notification-icon ${n}">\n          <i class="${e.icon}"></i>\n        </div>\n        <div class="c-navbar-modern__notification-content">\n          <p class="c-navbar-modern__notification-title">${this.escapeHtml(e.title)}</p>\n          <p class="c-navbar-modern__notification-text">${this.escapeHtml(o)}</p>\n          ${s?'<span class="c-navbar-modern__notification-expand-hint">Click to read more</span>':""}\n        </div>\n        <span class="c-navbar-modern__notification-time">${e.time_ago}</span>\n      </div>\n      <div class="c-navbar-modern__notification-expanded u-hidden" data-expanded-content>\n        <p class="c-navbar-modern__notification-full-text">${this.escapeHtml(e.message)}</p>\n        <span class="c-navbar-modern__notification-date">${e.created_at||""}</span>\n      </div>\n      <button class="c-navbar-modern__notification-dismiss"\n              data-action="dismiss-notification"\n              data-notification-id="${e.id}"\n              aria-label="Dismiss notification"\n              title="Dismiss">\n        <i class="ti ti-x" aria-hidden="true"></i>\n      </button>\n    `,t}toggleNotificationExpand(e){const t=document.querySelector(`[data-notification-id="${e}"]`);if(!t)return;const n=t.querySelector("[data-expanded-content]");n&&(t.classList.contains("is-expanded")?(t.classList.remove("is-expanded"),n.classList.add("u-hidden")):(t.classList.add("is-expanded"),n.classList.remove("u-hidden"),t.classList.contains("is-unread")&&this.markNotificationRead(e)))}async dismissNotification(e){const t=document.querySelector(`[data-notification-id="${e}"]`);if(t){t.classList.add("is-dismissing");try{const n=await fetch(`/api/notifications/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}}),o=await n.json();o.success?setTimeout(()=>{t.remove(),this.updateNotificationBadge(o.unread_count);const e=document.getElementById("notifications-list");if(0===e.querySelectorAll(".c-navbar-modern__notification").length){const t=e.querySelector('[data-state="empty"]');t&&t.classList.remove("u-hidden")}},200):(t.classList.remove("is-dismissing"),this.showToast("Failed to dismiss notification","error"))}catch(n){console.error("Dismiss notification error:",n),t.classList.remove("is-dismissing"),this.showToast("Failed to dismiss notification","error")}}}async clearAllNotifications(){const e=document.getElementById("notifications-list"),t=e.querySelectorAll(".c-navbar-modern__notification");if(0!==t.length){if(confirm("Are you sure you want to clear all notifications?")){t.forEach(e=>e.classList.add("is-dismissing"));try{const n=await fetch("/api/notifications/clear-all",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}}),o=await n.json();o.success?setTimeout(()=>{t.forEach(e=>e.remove()),this.updateNotificationBadge(0);const n=e.querySelector('[data-state="empty"]');n&&n.classList.remove("u-hidden"),this.showToast(`Cleared ${o.deleted_count} notification${1!==o.deleted_count?"s":""}`,"success")},200):(t.forEach(e=>e.classList.remove("is-dismissing")),this.showToast("Failed to clear notifications","error"))}catch(n){console.error("Clear all notifications error:",n),t.forEach(e=>e.classList.remove("is-dismissing")),this.showToast("Failed to clear notifications","error")}}}else this.showToast("No notifications to clear","info")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async refreshNotificationCount(){try{const e=await fetch("/api/notifications/count"),t=await e.json();t.success&&this.updateNotificationBadge(t.count)}catch(e){console.error("Error refreshing notification count:",e)}}updateNotificationBadge(e){document.querySelectorAll('[data-badge="notification-count"]').forEach(t=>{e>0?(t.textContent=e>99?"99+":e,t.classList.remove("u-hidden")):t.classList.add("u-hidden")})}initRoleImpersonation(){if(!document.querySelector('[data-dropdown="impersonation"]'))return;this.loadImpersonationStatus();const e=document.querySelector('[data-action="refresh-roles"]');e&&e.addEventListener("click",()=>this.loadAvailableRoles()),document.querySelectorAll('input[name="impersonate_roles"]').forEach(e=>{e.addEventListener("change",()=>this.validateRoleSelection())});const t=document.querySelector('[data-action="clear-role-selection"]');t&&t.addEventListener("click",e=>{e.preventDefault(),this.clearRoleSelection()}),this.validateRoleSelection()}clearRoleSelection(){document.querySelectorAll('input[name="impersonate_roles"]').forEach(e=>{e.checked=!1}),this.validateRoleSelection()}async loadImpersonationStatus(){try{const e=await fetch("/api/role-impersonation/status");if(!e.ok)throw new Error("Failed to load status");const t=await e.json();this.updateImpersonationStatus(t)}catch(e){console.error("Error loading impersonation status:",e)}}async loadAvailableRoles(){const e=document.querySelector('[data-action="refresh-roles"]');if(e){e.classList.add("is-loading");const t=e.querySelector("i");t&&(t.style.animation="spin 1s linear infinite")}try{const e=await fetch("/api/role-impersonation/available-roles");if(!e.ok)throw new Error("Failed to load roles");const t=await e.json();this.showToast("Roles refreshed","success"),this.updateImpersonationStatus(t.current_impersonation)}catch(t){console.error("Error loading available roles:",t),this.showToast("Failed to refresh roles","error")}finally{if(e){e.classList.remove("is-loading");const t=e.querySelector("i");t&&(t.style.animation="")}}}updateImpersonationStatus(e){const t=e&&e.active||!1,n=document.getElementById("currentRoleStatus"),o=document.getElementById("activeImpersonationStatus"),s=document.getElementById("activeRolesList"),i=document.querySelector('[data-badge="impersonation"]');t&&e.roles&&e.roles.length>0?(n&&n.classList.add("u-hidden"),o&&(o.classList.remove("u-hidden"),s&&(s.innerHTML=e.roles.map(e=>`<span class="c-role-status__role-tag">${e}</span>`).join(""))),i&&i.classList.remove("u-hidden")):(n&&n.classList.remove("u-hidden"),o&&o.classList.add("u-hidden"),i&&i.classList.add("u-hidden"))}validateRoleSelection(){const e=document.querySelectorAll('input[name="impersonate_roles"]:checked'),t=document.getElementById("startImpersonationBtn"),n=document.getElementById("selectedRoleCount"),o=e.length;n&&(n.textContent=o),t&&(t.disabled=0===o)}initTheme(){const e=localStorage.getItem("theme")||"system";this.applyTheme(e,!1)}applyTheme(e,t=!0){let n=e;"system"===e&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");const o=document.documentElement,s=document.body;o.setAttribute("data-style",n),o.setAttribute("data-bs-theme",n),s.setAttribute("data-bs-theme",n),o.setAttribute("data-theme",n),"dark"===n?(o.classList.add("dark-style"),o.classList.remove("light-style")):(o.classList.add("light-style"),o.classList.remove("dark-style"));const i=document.querySelector('[data-role="theme-icon"]');if(i){const t={light:"ti-sun",dark:"ti-moon-stars",system:"ti-device-desktop"}[e]||"ti-sun";i.className=`ti ${t} c-navbar-modern__nav-icon`}document.querySelectorAll('[data-action="switch-theme"]').forEach(t=>{t.dataset.theme===e?t.classList.add("is-active"):t.classList.remove("is-active")}),t&&(localStorage.setItem("theme",e),localStorage.setItem("templateCustomizer-skin",n))}showToast(e,t="info"){"function"==typeof window.showToast?window.showToast(e,t):console.log(`[Toast ${t}]:`,e)}initPresence(){"undefined"!=typeof io?this.initPresenceSocket():this.checkPresence(),setInterval(()=>this.refreshPresence(),12e4),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&(this.refreshPresence(),this.presenceSocket&&!this.presenceSocket.connected&&this.presenceSocket.connect())})}initPresenceSocket(){if(void 0!==window.SocketManager)return console.log("[Navbar] Using SocketManager for presence"),window.SocketManager.isOptimisticallyConnected()&&(this.updateOnlineStatus(!0),console.debug("[Navbar] Optimistic online status (recently connected)")),this.presenceSocket=window.SocketManager.getSocket(),window.SocketManager.onConnect("Navbar",e=>{this.presenceSocket=e,this.updateOnlineStatus(!0),console.debug("Presence socket connected via SocketManager")}),window.SocketManager.onDisconnect("Navbar",e=>{this.updateOnlineStatus(!1),console.debug("Presence socket disconnected:",e)}),window.SocketManager.on("Navbar","authentication_success",e=>{this.updateOnlineStatus(!0),console.debug("Presence authenticated:",e.username)}),void window.SocketManager.on("Navbar","authentication_failed",()=>{this.updateOnlineStatus(!0)});if(window.socket)return console.log("[Navbar] Reusing existing socket (connected:",window.socket.connected,")"),this.presenceSocket=window.socket,window.socket.connected&&this.updateOnlineStatus(!0),void this.attachSocketListenersDirect(this.presenceSocket);try{console.log("[Navbar] Creating new socket connection (fallback)"),this.presenceSocket=io("/",{transports:["polling","websocket"],upgrade:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4,autoConnect:!0,withCredentials:!0}),window.socket=this.presenceSocket,this.attachSocketListenersDirect(this.presenceSocket)}catch(e){console.warn("Failed to initialize presence socket:",e),this.checkPresence()}}attachSocketListenersDirect(e){e.on("connect",()=>{this.updateOnlineStatus(!0),console.debug("Presence socket connected")}),e.on("disconnect",()=>{this.updateOnlineStatus(!1),console.debug("Presence socket disconnected")}),e.on("authentication_success",e=>{this.updateOnlineStatus(!0),console.debug("Presence authenticated:",e.username)}),e.on("authentication_failed",()=>{this.updateOnlineStatus(!0)}),e.on("connect_error",e=>{console.warn("Presence socket connection error:",e.message),this.updateOnlineStatus(!1)})}async checkPresence(){try{const e=await fetch("/api/notifications/presence"),t=await e.json();t.success&&this.updateOnlineStatus(t.online)}catch(e){}}async refreshPresence(){try{await fetch("/api/notifications/presence/refresh",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()}})}catch(e){}}updateOnlineStatus(e){const t=this.navbar.querySelector(".c-navbar-modern__avatar-status");t&&(e?(t.classList.add("is-online"),t.classList.remove("is-offline"),t.setAttribute("aria-label","Online"),t.setAttribute("title","You are online")):(t.classList.remove("is-online"),t.classList.add("is-offline"),t.setAttribute("aria-label","Offline"),t.setAttribute("title","You appear offline")))}}function v(){document.querySelector(".c-navbar-modern")&&(window.navbarController=new g)}void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("navbar-modern",v,{priority:80,description:"Modern navbar controller (search, dropdowns, mobile menu)",reinitializable:!1}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",v):v(),void 0!==t&&t.exports&&(t.exports=g);class y{constructor(){this.themes=["light","dark","system"],this.variants=["modern"],this.currentTheme="light",this.currentVariant="modern",this.init()}init(){this.setupEventListeners(),this.setupSystemThemeDetection(),this.loadSavedVariant()}loadSavedVariant(){const e=localStorage.getItem("theme-variant")||"modern";this.currentVariant=this.variants.includes(e)?e:"modern"}loadSavedTheme(){const e=localStorage.getItem("template-style")||"light";this.setTheme(e,!1)}setTheme(e,t=!0){this.themes.includes(e)||(console.warn(`Invalid theme: ${e}. Using light instead.`),e="light"),console.log("Setting theme to:",e),this.currentTheme=e;const n=this.resolveSystemTheme(e);console.log("Effective theme:",n),document.documentElement.setAttribute("data-style",n),document.documentElement.setAttribute("data-theme",n),document.documentElement.className=document.documentElement.className.replace(/\b(light|dark)-style\b/g,""),document.documentElement.classList.add(`${n}-style`),this.updateThemeIcon(e),this.updateActiveMenuItem(e),t&&(localStorage.setItem("template-style",e),this.saveThemeToServer(e)),document.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:e,effectiveTheme:n}})),console.log("Theme applied successfully")}resolveSystemTheme(e){return"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e}setupEventListeners(){"undefined"!=typeof EventDelegation&&(EventDelegation.register("set-theme",(e,t)=>{const n=e.getAttribute("data-theme");n&&(console.log("Theme switching to (action):",n),this.setTheme(n),document.querySelectorAll('[data-action="set-theme"]').forEach(e=>{e.classList.remove("btn-primary"),e.classList.add("btn-outline-secondary")}),e.classList.remove("btn-outline-secondary"),e.classList.add("btn-primary"))},{preventDefault:!0}),EventDelegation.register("select-theme",(e,t)=>{const n=e.getAttribute("data-theme");if(n&&(console.log("Theme switching to:",n),this.setTheme(n),e.closest('[data-role="theme-dropdown-menu"]'))){const e=document.querySelector('[data-role="theme-dropdown-toggle"]');if(e&&window.bootstrap){const t=window.bootstrap.Dropdown.getInstance(e);t&&t.hide()}}},{preventDefault:!0})),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&"T"===e.key&&(e.preventDefault(),this.cycleTheme())})}setupSystemThemeDetection(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{"system"===this.currentTheme&&this.setTheme("system",!1)})}cycleTheme(){const e=(this.themes.indexOf(this.currentTheme)+1)%this.themes.length;this.setTheme(this.themes[e])}updateThemeIcon(e){const t=document.querySelector('[data-role="theme-icon"]');if(t){let n;switch(e){case"dark":n="ti-moon-stars";break;case"system":n="ti-device-desktop-analytics";break;default:n="ti-sun"}t.className=`ti ${n} ti-md`,t.setAttribute("data-role","theme-icon")}}updateActiveMenuItem(e){document.querySelectorAll("[data-theme]").forEach(e=>{e.classList.remove("active")});const t=document.querySelector(`[data-theme="${e}"]`);t&&t.classList.add("active")}saveThemeToServer(e){const t=document.querySelector('meta[name="csrf-token"]');t?fetch("/set-theme",{method:"POST",headers:{"Content-Type":"application/json","X-Csrftoken":t.getAttribute("content")},body:JSON.stringify({theme:e})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{e.success||console.error("Theme save failed:",e.message)}).catch(e=>{console.error("Failed to save theme to server:",e)}):console.warn("CSRF token not found, theme not saved to server")}getCurrentTheme(){return this.currentTheme}getEffectiveTheme(){return this.resolveSystemTheme(this.currentTheme)}setVariant(e,t=!0){this.variants.includes(e)||(console.warn(`Invalid variant: ${e}. Using modern instead.`),e="modern"),console.log("Setting variant to:",e),this.currentVariant=e,document.documentElement.setAttribute("data-theme-variant",e),document.documentElement.classList.remove("theme-modern"),document.documentElement.classList.add(`theme-${e}`),t&&(localStorage.setItem("theme-variant",e),this.saveVariantToServer(e)),document.dispatchEvent(new CustomEvent("variantChanged",{detail:{variant:e}})),t&&this.notifyAndReload(e),console.log("Variant applied successfully")}notifyAndReload(e){"undefined"!=typeof Swal?Swal.fire({title:"Applying Theme",text:`Switching to ${e} theme...`,icon:"info",timer:1500,timerProgressBar:!0,showConfirmButton:!1,allowOutsideClick:!1}).then(()=>{window.location.reload()}):window.location.reload()}saveVariantToServer(e){const t=document.querySelector('meta[name="csrf-token"]');t?fetch("/set-theme-variant",{method:"POST",headers:{"Content-Type":"application/json","X-Csrftoken":t.getAttribute("content")},body:JSON.stringify({variant:e})}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{e.success||console.error("Variant save failed:",e.message)}).catch(e=>{console.error("Failed to save variant to server:",e)}):console.warn("CSRF token not found, variant not saved to server")}getCurrentVariant(){return this.currentVariant}isModern(){return"modern"===this.currentVariant}toggleVariant(){this.setVariant("modern")}}document.addEventListener("DOMContentLoaded",()=>{window.themeSwitcher=new y,window._themeNeedsSync&&(window.themeSwitcher.currentTheme=window._themeNeedsSync.theme,window.themeSwitcher.saveThemeToServer(window._themeNeedsSync.theme),window.themeSwitcher.updateThemeIcon(window._themeNeedsSync.theme),window.themeSwitcher.updateActiveMenuItem(window._themeNeedsSync.theme),delete window._themeNeedsSync),window._variantNeedsSync&&(window.themeSwitcher.currentVariant=window._variantNeedsSync.variant,window.themeSwitcher.saveVariantToServer(window._variantNeedsSync.variant),delete window._variantNeedsSync);const e=document.documentElement.getAttribute("data-style")||"light",t=document.documentElement.getAttribute("data-theme-variant")||"modern";window.themeSwitcher.currentTheme=e,window.themeSwitcher.currentVariant=t,window.themeSwitcher.updateThemeIcon(e),window.themeSwitcher.updateActiveMenuItem(e)}),window.SimpleThemeSwitcher=y,function(){class e{constructor(e){this.nav=e,this.activeDropdown=null,this.init()}init(){this.nav.addEventListener("keydown",this.handleKeyboard.bind(this)),document.addEventListener("click",this.handleOutsideClick.bind(this)),document.addEventListener("keydown",this.handleEscapeKey.bind(this)),this.registerActions()}registerActions(){"undefined"!=typeof EventDelegation&&(EventDelegation.register("toggle-dropdown",this.handleToggleDropdown.bind(this),{preventDefault:!0}),EventDelegation.register("navigate",this.handleNavigation.bind(this),{preventDefault:!1}),EventDelegation.register("close-dropdown",this.handleCloseDropdown.bind(this),{preventDefault:!0}))}handleToggleDropdown(e,t){this.toggleDropdown(e)}handleCloseDropdown(e,t){this.closeDropdown(e)}handleKeyboard(e){const t=e.target;"Enter"!==e.key&&" "!==e.key||"toggle-dropdown"!==t.dataset.action||(e.preventDefault(),this.toggleDropdown(t)),!this.activeDropdown||"ArrowDown"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),this.navigateDropdown(e.key))}handleEscapeKey(e){if("Escape"===e.key&&this.activeDropdown){this.closeAllDropdowns();const e=this.activeDropdown.previousElementSibling;e&&e.focus()}}handleOutsideClick(e){!this.nav.contains(e.target)&&this.activeDropdown&&this.closeAllDropdowns()}toggleDropdown(e){const t=e.closest("[data-dropdown]");if(!t)return;const n=t.querySelector(".c-admin-nav__dropdown");if(!n)return;const o=t.classList.contains("is-open");if(this.closeAllDropdowns(),o)this.closeDropdown(t);else{t.classList.add("is-open"),e.classList.add("is-open"),e.setAttribute("aria-expanded","true"),n.setAttribute("aria-hidden","false"),this.activeDropdown=n;const o=n.querySelector(".c-admin-nav__dropdown-item");o&&o.focus()}}closeDropdown(e){const t=e.closest("[data-dropdown]");if(!t)return;const n=t.querySelector('[data-action="toggle-dropdown"]'),o=t.querySelector(".c-admin-nav__dropdown");t.classList.remove("is-open"),n&&(n.classList.remove("is-open"),n.setAttribute("aria-expanded","false")),o&&o.setAttribute("aria-hidden","true"),this.activeDropdown===o&&(this.activeDropdown=null)}closeAllDropdowns(){this.nav.querySelectorAll("[data-dropdown].is-open").forEach(e=>this.closeDropdown(e))}navigateDropdown(e){if(!this.activeDropdown)return;const t=Array.from(this.activeDropdown.querySelectorAll(".c-admin-nav__dropdown-item:not(.is-disabled)")),n=t.indexOf(document.activeElement);let o;o="ArrowDown"===e?n<t.length-1?n+1:0:n>0?n-1:t.length-1,t[o].focus()}handleNavigation(e,t){e&&e.classList&&(this.nav.querySelectorAll(".c-admin-nav__link").forEach(e=>e.classList.remove("is-active")),e.classList.add("is-active"))}destroy(){this.nav.removeEventListener("keydown",this.handleKeyboard),document.removeEventListener("click",this.handleOutsideClick),document.removeEventListener("keydown",this.handleEscapeKey)}}function t(){if(!(document.querySelector('[data-controller="admin-nav"]')||document.querySelector(".c-admin-nav")||window.location.pathname.includes("/admin")))return;const t=document.querySelectorAll('[data-controller="admin-nav"]');if(0===t.length){const t=document.querySelector(".c-admin-nav");return void(t&&!t.hasAttribute("data-controller")&&(t.setAttribute("data-controller","admin-nav"),t.adminNavController=new e(t)))}t.forEach(t=>{t.adminNavController||(t.adminNavController=new e(t))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),window.AdminNavigationController=e,window.initAdminNavigation=t}();const b=function(){let e={},t=!1;const n={primary:"--ecs-primary","primary-light":"--ecs-primary-light","primary-dark":"--ecs-primary-dark","primary-subtle":"--ecs-primary-subtle",secondary:"--ecs-secondary","secondary-light":"--ecs-secondary-light","secondary-dark":"--ecs-secondary-dark",accent:"--ecs-accent","accent-light":"--ecs-accent-light","accent-dark":"--ecs-accent-dark",success:"--ecs-success","success-light":"--ecs-success-light","success-dark":"--ecs-success-dark","success-subtle":"--ecs-success-subtle",warning:"--ecs-warning","warning-light":"--ecs-warning-light","warning-dark":"--ecs-warning-dark","warning-subtle":"--ecs-warning-subtle",danger:"--ecs-danger","danger-light":"--ecs-danger-light","danger-dark":"--ecs-danger-dark","danger-subtle":"--ecs-danger-subtle",info:"--ecs-info","info-light":"--ecs-info-light","info-dark":"--ecs-info-dark","info-subtle":"--ecs-info-subtle",white:"--ecs-neutral-0",light:"--ecs-neutral-5","light-gray":"--ecs-neutral-10",border:"--ecs-neutral-20",muted:"--ecs-neutral-50",dark:"--ecs-neutral-90","bg-body":"--ecs-bg-body","bg-card":"--ecs-bg-card","dark-bg-body":"--ecs-dark-bg-body","dark-bg-card":"--ecs-dark-bg-card","dark-bg-elevated":"--ecs-dark-bg-elevated"},o={primary:"#7C3AED","primary-light":"#8B5CF6","primary-dark":"#6D28D9","primary-subtle":"#EDE9FE",secondary:"#64748B",accent:"#F59E0B",success:"#10B981","success-light":"#34D399","success-subtle":"#D1FAE5",warning:"#F59E0B","warning-light":"#FBBF24",danger:"#EF4444","danger-light":"#F87171",info:"#3B82F6","info-light":"#60A5FA",white:"#FFFFFF",light:"#FAFAFA",border:"#E4E4E7",muted:"#71717A",dark:"#18181B","bg-body":"#FAFAFA","bg-card":"#FFFFFF","dark-bg-body":"#09090B","dark-bg-card":"#18181B","dark-bg-elevated":"#27272A"};function s(e,t){const n=e.startsWith("--")?e:`--${e}`;return getComputedStyle(document.documentElement).getPropertyValue(n).trim()||t||""}function i(i){if(t&&e[i])return e[i];const a=n[i];if(a){const t=s(a,o[i]);return e[i]=t,t}return s(`--ecs-${i}`,o[i]||"")}function a(){e={},t=!1}const r=new MutationObserver(e=>{e.forEach(e=>{"data-style"!==e.attributeName&&"data-theme-variant"!==e.attributeName||a()})});return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{r.observe(document.documentElement,{attributes:!0})}):r.observe(document.documentElement,{attributes:!0}),{getColor:i,getAllColors:function(){const e={};return Object.keys(n).forEach(t=>{e[t]=i(t)}),t=!0,e},getChartColors:function(){return{primary:i("primary"),success:i("success"),warning:i("warning"),danger:i("danger"),info:i("info"),secondary:i("secondary"),palette:[i("primary"),i("success"),i("info"),i("warning"),i("danger"),i("secondary"),i("accent")]}},getSwalColors:function(){return{confirmButtonColor:i("primary"),cancelButtonColor:i("secondary"),denyButtonColor:i("danger")}},getCSSVar:s,invalidateCache:a}}();window.ECSTheme=b,function(){const e={connection:{transports:["polling","websocket"],upgrade:!0,reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,reconnectionDelayMax:1e4,randomizationFactor:.5,timeout:2e4,autoConnect:!0,withCredentials:!0},optimisticDisconnectDelay:3e3,debug:!1};let t=null,n=!1,s=0,i=null;const a="socket_last_connected",r=new Map,c=new Map,l=new Map;function d(...t){e.debug&&console.log("[SocketManager]",...t)}function u(...e){console.warn("[SocketManager]",...e)}function m(...e){console.error("[SocketManager]",...e)}function h(){if(t)return t;if("undefined"==typeof io)return u("Socket.IO library not loaded"),null;if(window.socket&&window.socket.io)return d("Reusing existing global socket"),t=window.socket,n=t.connected,p(),n&&y(),t;d("Creating new socket connection");try{return t=io("/",e.connection),window.socket=t,p(),t}catch(o){return m("Failed to create socket:",o),null}}function p(){t&&(t.off("connect",f),t.off("disconnect",g),t.off("connect_error",v),t.on("connect",f),t.on("disconnect",g),t.on("connect_error",v),d("Internal listeners attached"))}function f(){d("Socket connected, id:",t.id),n=!0,s=0;try{sessionStorage.setItem(a,Date.now().toString())}catch(o){}i&&(clearTimeout(i),i=null,d("Cleared disconnect timeout - reconnected quickly")),y()}function g(t){d("Socket disconnected, reason:",t),i&&clearTimeout(i),i=setTimeout(()=>{d("Disconnect timeout elapsed, firing disconnect callbacks"),n=!1,i=null,function(e){c.forEach((t,n)=>{try{t(e)}catch(o){m(`Disconnect callback error for ${n}:`,o)}})}(t)},e.optimisticDisconnectDelay),d(`Disconnect delayed by ${e.optimisticDisconnectDelay}ms (optimistic UI)`)}function v(e){s++,u(`Connection error (attempt ${s}):`,e.message),s>=5&&u("Multiple connection failures. Real-time features may be unavailable.")}function y(){r.forEach((e,n)=>{try{d(`Firing connect callback for: ${n}`),e(t)}catch(o){m(`Connect callback error for ${n}:`,o)}})}const b={getSocket:h,isConnected:function(){return n&&t&&t.connected},isOptimisticallyConnected:function(){return!!(n&&t&&t.connected)||function(){try{const t=sessionStorage.getItem(a);return!!t&&Date.now()-parseInt(t,10)<e.optimisticDisconnectDelay}catch(o){return!1}}()},onConnect:function(e,o){if("function"==typeof o){if(r.set(e,o),d(`Registered connect callback: ${e}`),n&&t){d(`Already connected, firing callback for: ${e}`);try{o(t)}catch(s){m(`Connect callback error for ${e}:`,s)}}}else u("onConnect requires a function callback")},onDisconnect:function(e,t){"function"==typeof t?c.set(e,t):u("onDisconnect requires a function callback")},on:function(e,n,o){if(t||h(),!t)return void u(`Cannot register event ${n}: no socket`);l.has(e)||l.set(e,new Map);const s=l.get(e);s.has(n)&&t.off(n,s.get(n)),s.set(n,o),t.on(n,o),d(`Registered event listener: ${e}/${n}`)},emit:function(e,o){return t&&n?(t.emit(e,o),!0):(u(`Cannot emit ${e}: socket not connected`),!1)},removeListeners:function(e){r.delete(e),c.delete(e),l.has(e)&&t&&(l.get(e).forEach((e,n)=>{t.off(n,e)}),l.delete(e)),d(`Removed all listeners for: ${e}`)},reconnect:function(){t?t.connect():h()},disconnect:function(){t&&t.disconnect()},enableDebug:function(){e.debug=!0},disableDebug:function(){e.debug=!1}};function w(){"undefined"!=typeof io?(h(),d("Socket manager initialized")):d("Socket.IO not available, skipping initialization")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",w):w(),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&t&&!t.connected&&(d("Page visible, reconnecting socket"),t.connect())}),window.SocketManager=b}(),window.OnlineStatusManager=new class{constructor(){this.updateInterval=3e4,this.intervalId=null,this.onlineUserIds=new Set,this.initialized=!1}init(){this.initialized||(this.initialized=!0,this.fetchOnlineUsers(),this.intervalId=setInterval(()=>{this.fetchOnlineUsers()},this.updateInterval),this.setupWebSocketListeners())}getCSRFToken(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const t=document.querySelector('input[name="csrf_token"]');return t?t.value:""}async fetchOnlineUsers(){try{const e=await fetch("/api/notifications/presence/online-users"),t=await e.json();t.success&&t.online_user_ids&&(this.onlineUserIds=new Set(t.online_user_ids.map(String)),this.updateAllIndicators())}catch(e){console.warn("Failed to fetch online users:",e)}}isUserOnline(e){return this.onlineUserIds.has(String(e))}updateAllIndicators(){document.querySelectorAll("[data-online-status]").forEach(e=>{const t=e.getAttribute("data-online-status");if(!t)return;const n=this.isUserOnline(t);this.updateIndicator(e,n)})}updateIndicator(e,t){e.classList.toggle("is-online",t),e.classList.toggle("is-offline",!t),(e.getAttribute("data-bs-original-title")||e.getAttribute("title"))&&(e.setAttribute("title",t?"Online":"Offline"),e.setAttribute("data-bs-original-title",t?"Online":"Offline")),e.dispatchEvent(new CustomEvent("onlineStatusChanged",{detail:{isOnline:t},bubbles:!0}))}setUserStatus(e,t){const n=String(e);t?this.onlineUserIds.add(n):this.onlineUserIds.delete(n),document.querySelectorAll(`[data-online-status="${e}"]`).forEach(e=>{this.updateIndicator(e,t)})}setupWebSocketListeners(){if("undefined"==typeof io)return;const e=()=>{window.socket&&window.socket.connected?this.attachSocketListeners(window.socket):setTimeout(e,1e3)};e()}attachSocketListeners(e){e.on("user_online",e=>{e.user_id&&this.setUserStatus(e.user_id,!0)}),e.on("user_offline",e=>{e.user_id&&this.setUserStatus(e.user_id,!1)}),e.on("presence_update",e=>{void 0!==e.user_id&&void 0!==e.online&&this.setUserStatus(e.user_id,e.online)})}destroy(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.initialized=!1}getOnlineCount(){return this.onlineUserIds.size}getOnlineUserIds(){return Array.from(this.onlineUserIds)}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.OnlineStatusManager.init()}):window.OnlineStatusManager.init(),function(){const e={activeModals:new Set,init(){"undefined"!=typeof EventDelegation&&(EventDelegation.register("modal-trigger",(e,t)=>{const n=e.dataset.modalTrigger;n&&this.open(n)},{preventDefault:!0}),EventDelegation.register("close-modal",(e,t)=>{const n=e.closest(".c-modal-modern");n&&this.close(n.id)},{preventDefault:!0})),document.addEventListener("click",e=>{const t=(n=e.target)instanceof Element?n:null;var n;if(t&&t.classList.contains("c-modal-modern__backdrop")){const e=Array.from(this.activeModals).pop();e&&this.close(e)}}),document.addEventListener("keydown",e=>{if("Escape"===e.key&&this.activeModals.size>0){const e=Array.from(this.activeModals).pop();this.close(e)}})},open(e){const t=document.getElementById(e),n=document.querySelector(`[data-modal-backdrop="${e}"]`);t&&(this.activeModals.add(e),n&&n.classList.add("is-open"),t.classList.add("is-open"),t.setAttribute("aria-hidden","false"),this.trapFocus(t),t.dispatchEvent(new CustomEvent("modal:opened",{detail:{id:e}})))},close(e){const t=document.getElementById(e),n=document.querySelector(`[data-modal-backdrop="${e}"]`);t&&(t.classList.add("is-closing"),setTimeout(()=>{t.classList.remove("is-open","is-closing"),t.setAttribute("aria-hidden","true"),n&&n.classList.remove("is-open"),this.activeModals.delete(e),t.dispatchEvent(new CustomEvent("modal:closed",{detail:{id:e}}))},300))},trapFocus(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),n=t[0],o=t[t.length-1];e.addEventListener("keydown",e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===n&&(o.focus(),e.preventDefault()):document.activeElement===o&&(n.focus(),e.preventDefault()))}),null==n||n.focus()}},t={container:null,toasts:new Map,idCounter:0,init(){this.container||(this.container=document.createElement("div"),this.container.className="c-toast-modern__container",document.body.appendChild(this.container)),"undefined"!=typeof EventDelegation&&EventDelegation.register("dismiss-toast",(e,t)=>{const n=e.dataset.toastId;n&&this.dismiss(n)})},show(e={}){const{type:t="info",title:n,message:o,duration:s=5e3,dismissible:i=!0,actions:a=[]}=e,r="toast-"+ ++this.idCounter,c=document.createElement("div");c.className=`c-toast-modern c-toast-modern--${t}`,c.id=r,c.setAttribute("role","alert"),c.setAttribute("aria-live","polite");const l={success:"â",error:"Ã",warning:"â ",info:"â¹"};return c.innerHTML=`\n        <div class="c-toast-modern__icon">${l[t]||l.info}</div>\n        <div class="c-toast-modern__content">\n          ${n?`<h4 class="c-toast-modern__title">${n}</h4>`:""}\n          ${o?`<p class="c-toast-modern__message">${o}</p>`:""}\n          ${a.length>0?`\n            <div class="c-toast-modern__actions">\n              ${a.map(e=>`\n                <button class="c-toast-modern__action" data-action="toast-action" data-callback="${e.callback}">\n                  ${e.label}\n                </button>\n              `).join("")}\n            </div>\n          `:""}\n        </div>\n        ${i?`\n          <button class="c-toast-modern__dismiss" data-action="dismiss-toast" data-toast-id="${r}" aria-label="Close">Ã</button>\n        `:""}\n        ${s>0?`\n          <div class="c-toast-modern__progress">\n            <div class="c-toast-modern__progress-bar" data-duration="${s}"></div>\n          </div>\n        `:""}\n      `,this.container.appendChild(c),requestAnimationFrame(()=>{c.classList.add("is-visible")}),s>0&&setTimeout(()=>{this.dismiss(r)},s),this.toasts.set(r,c),r},dismiss(e){const t=this.toasts.get(e);t&&(t.classList.add("is-dismissing"),t.classList.remove("is-visible"),setTimeout(()=>{t.remove(),this.toasts.delete(e)},300))}},n={activeTooltip:null,tooltips:new Map,init(){const e=e=>e instanceof Element?e:null;document.addEventListener("mouseenter",t=>{const n=e(t.target);if(!n)return;const o=n.closest("[data-tooltip]");o&&this.show(o)},!0),document.addEventListener("mouseleave",t=>{const n=e(t.target);n&&n.closest("[data-tooltip]")&&this.hide()},!0),document.addEventListener("focus",t=>{const n=e(t.target);if(!n)return;const o=n.closest("[data-tooltip]");o&&this.show(o)},!0),document.addEventListener("blur",t=>{const n=e(t.target);n&&n.closest("[data-tooltip]")&&this.hide()},!0)},show(e){const t=e.dataset.tooltip,n=e.dataset.tooltipPosition||"top",o=e.dataset.tooltipVariant||"";if(!t)return;const s=document.createElement("div");s.className=`c-tooltip-modern c-tooltip-modern--${n} ${o?`c-tooltip-modern--${o}`:""}`,s.setAttribute("role","tooltip"),s.innerHTML=`\n        ${t}\n        <div class="c-tooltip-modern__arrow"></div>\n      `,e.appendChild(s),requestAnimationFrame(()=>{s.classList.add("is-visible")}),this.activeTooltip=s},hide(){this.activeTooltip&&(this.activeTooltip.classList.remove("is-visible"),setTimeout(()=>{var e;null==(e=this.activeTooltip)||e.remove(),this.activeTooltip=null},200))}},o={activeDropdown:null,init(){"undefined"!=typeof EventDelegation?EventDelegation.register("dropdown-trigger",(e,t)=>{const n=e.dataset.dropdownTrigger;n&&this.toggle(n)},{preventDefault:!0}):document.addEventListener("click",e=>{if(!(e.target instanceof Element))return;const t=e.target.closest("[data-dropdown-trigger]");if(t){e.preventDefault();const n=t.dataset.dropdownTrigger;this.toggle(n)}}),document.addEventListener("click",e=>{!e.target.closest(".c-dropdown-modern")&&this.activeDropdown&&this.close(this.activeDropdown)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.activeDropdown&&this.close(this.activeDropdown)})},toggle(e){const t=document.getElementById(e);t&&(t.classList.contains("is-open")?this.close(e):(this.activeDropdown&&this.close(this.activeDropdown),this.open(e)))},open(e){const t=document.getElementById(e);t&&(t.classList.add("is-open"),this.activeDropdown=e,t.dispatchEvent(new CustomEvent("dropdown:opened",{detail:{id:e}})))},close(e){const t=document.getElementById(e);t&&(t.classList.remove("is-open"),this.activeDropdown===e&&(this.activeDropdown=null),t.dispatchEvent(new CustomEvent("dropdown:closed",{detail:{id:e}})))}},s={init(){const e=e=>e instanceof Element?e:null;document.addEventListener("click",t=>{const n=e(t.target);if(!n)return;const o=n.closest(".c-table-modern__header--sortable");o&&this.sort(o)}),document.addEventListener("click",t=>{var n;const o=e(t.target);if(!o)return;const s=o.closest(".c-table-modern__pagination-button");if(s&&!s.disabled){const e=parseInt(s.dataset.page),t=null==(n=s.closest("[data-table-id]"))?void 0:n.dataset.tableId;t&&this.paginate(t,e)}})},sort(e){const t=e.closest(".c-table-modern"),n=e.dataset.sortColumn,o=e.dataset.sortDirection||"none";let s="asc";"asc"===o&&(s="desc"),"desc"===o&&(s="none"),t.querySelectorAll(".c-table-modern__header--sortable").forEach(e=>{e.classList.remove("c-table-modern__header--sorted-asc","c-table-modern__header--sorted-desc"),e.dataset.sortDirection="none"}),"none"!==s&&(e.classList.add(`c-table-modern__header--sorted-${s}`),e.dataset.sortDirection=s),t.dispatchEvent(new CustomEvent("table:sort",{detail:{column:n,direction:s}}))},paginate(e,t){const n=document.querySelector(`[data-table-id="${e}"]`);n&&n.dispatchEvent(new CustomEvent("table:paginate",{detail:{page:t}}))}},i={init(){const e=e=>e instanceof Element?e:null;document.addEventListener("blur",t=>{const n=e(t.target);if(!n)return;const o=n.closest(".c-form-modern__input");o&&this.validateField(o)},!0),document.addEventListener("submit",t=>{const n=e(t.target);if(!n)return;const o=n.closest("form[data-validate]");o&&(this.validateForm(o)||t.preventDefault())})},validateField(e){const t=e.checkValidity();return t?(e.classList.remove("is-invalid"),e.classList.add("is-valid"),this.clearError(e)):(e.classList.remove("is-valid"),e.classList.add("is-invalid"),this.showError(e,e.validationMessage)),t},validateForm(e){const t=e.querySelectorAll(".c-form-modern__input");let n=!0;return t.forEach(e=>{this.validateField(e)||(n=!1)}),n},showError(e,t){let n=e.parentElement.querySelector(".c-form-modern__feedback--invalid");n||(n=document.createElement("div"),n.className="c-form-modern__feedback c-form-modern__feedback--invalid",e.parentElement.appendChild(n)),n.textContent=t},clearError(e){const t=e.parentElement.querySelector(".c-form-modern__feedback--invalid");t&&t.remove()}};function a(){t.init(),n.init(),o.init(),s.init(),i.init(),console.log("Modern components initialized")}window.ModernComponents={Modal:e,Toast:t,Tooltip:n,Dropdown:o,Table:s,Form:i},void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("components-modern",a,{priority:70,description:"Modern UI components (toast, tooltip, dropdown, table, form)",reinitializable:!0}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()}(),function(){const e={device:{isMobile:!1,isTablet:!1,isDesktop:!1,isIOS:!1,isAndroid:!1,hasTouch:!1,hasMouse:!1},init:function(){this.detectDevice(),this.applyDeviceClasses(),this.fixIOSViewportHeight(),this.setupTouchFeedback(),this.enhanceModals(),this.enhanceFormControls(),this.enhanceTables(),this.enhanceNavigation(),this.improveScrolling(),this.monitorNetworkStatus(),this.attachEventListeners(),this.setupMutationObserver()},detectDevice:function(){this.device.hasTouch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,this.device.hasMouse=matchMedia("(hover: hover) and (pointer: fine)").matches;const e=window.innerWidth;this.device.isMobile=e<768,this.device.isTablet=e>=768&&e<992,this.device.isDesktop=e>=992;const t=navigator.userAgent.toLowerCase();this.device.isIOS=/iphone|ipad|ipod/.test(t),this.device.isAndroid=/android/.test(t)},applyDeviceClasses:function(){const e=document.body;e.classList.remove("mobile-device","tablet-device","desktop-device","ios-device","android-device","touch-device","mouse-device"),this.device.isMobile&&e.classList.add("mobile-device"),this.device.isTablet&&e.classList.add("tablet-device"),this.device.isDesktop&&e.classList.add("desktop-device"),this.device.isIOS&&e.classList.add("ios-device"),this.device.isAndroid&&e.classList.add("android-device"),this.device.hasTouch&&e.classList.add("touch-device"),this.device.hasMouse&&e.classList.add("mouse-device")},fixIOSViewportHeight:function(){const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)};e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(e,100)}),this.device.isIOS&&document.querySelectorAll("input, textarea, select").forEach(e=>{"checkbox"!==e.type&&"radio"!==e.type&&(e.addEventListener("focus",()=>{document.documentElement.classList.add("keyboard-visible")}),e.addEventListener("blur",()=>{document.documentElement.classList.remove("keyboard-visible")}))})},setupTouchFeedback:function(){this.device.hasTouch&&document.querySelectorAll("button, .btn, a.nav-link, .card-header").forEach(e=>{e.addEventListener("touchstart",function(){this.classList.add("touch-active")},{passive:!0}),e.addEventListener("touchend",function(){this.classList.remove("touch-active")},{passive:!0})})},enhanceModals:function(){document.querySelectorAll("[data-modal]").forEach(e=>{const t=e.querySelector("[data-modal-dialog]");this.device.isMobile&&!e.hasAttribute("data-no-bottom-sheet")&&t&&(t.classList.contains("modal-keep-centered")||t.classList.remove("modal-lg","modal-xl","modal-sm")),this.device.isMobile&&"true"===e.getAttribute("data-dismiss-on-swipe")&&this.setupModalSwipeDismiss(e),e.addEventListener("shown.bs.modal",()=>{window.Haptics&&window.Haptics.modalOpen(),this.device.isIOS&&document.body.classList.add("scroll-locked");const n=e.querySelector('input:not([type="hidden"]), button.btn-close, button:not(.close), [tabindex]:not([tabindex="-1"])');if(n&&setTimeout(()=>n.focus(),100),this.device.isIOS){const t=e.querySelector("[data-modal-body]");t&&t.classList.add("modal-body-scrollable")}if(this.device.isMobile){const n=e.querySelector("[data-modal-content]");n&&!t.classList.contains("modal-keep-centered")&&n.classList.add("modal-content-mobile")}this.handleModalKeyboard(e)}),e.addEventListener("hidden.bs.modal",()=>{window.Haptics&&window.Haptics.modalClose(),this.device.isIOS&&document.body.classList.remove("scroll-locked"),document.body.classList.remove("keyboard-open");const t=e.querySelector("[data-modal-body]");t&&t.classList.remove("modal-body-scrollable");const n=e.querySelector("[data-modal-content]");n&&n.classList.remove("modal-content-mobile"),this.cleanupModalBackdrops()}),e.querySelectorAll('.btn-close, [data-bs-dismiss="modal"]').forEach(e=>{e.addEventListener("click",()=>{window.Haptics&&window.Haptics.light()},{passive:!0})})})},setupModalSwipeDismiss:function(e){if(!this.device.isMobile)return;const t=e.querySelector("[data-modal-dialog]"),n=e.querySelector("[data-modal-header]");if(!t||!n)return;let o=0,s=0,i=!1;n.addEventListener("touchstart",e=>{o=e.touches[0].clientY,i=!0,t.classList.add("swiping")},{passive:!0}),n.addEventListener("touchmove",e=>{if(!i)return;s=e.touches[0].clientY;const n=s-o;n>0&&(e.preventDefault(),t.style.setProperty("--swipe-offset",`${n}px`),t.style.transform="translateY(var(--swipe-offset))",t.classList.add("transition-none"))}),n.addEventListener("touchend",n=>{i&&(i=!1,t.classList.remove("swiping"),s-o>100?(window.Haptics&&window.Haptics.light(),t.classList.remove("transition-none"),t.classList.add("swipe-animating","swipe-dismiss"),setTimeout(()=>{const n=bootstrap.Modal.getInstance(e);n&&n.hide(),t.classList.remove("swipe-animating","swipe-dismiss"),t.style.removeProperty("--swipe-offset"),t.style.removeProperty("transform")},300)):(t.classList.remove("transition-none"),t.classList.add("swipe-animating","swipe-reset"),setTimeout(()=>{t.classList.remove("swipe-animating","swipe-reset"),t.style.removeProperty("--swipe-offset"),t.style.removeProperty("transform")},300)),s=0)},{passive:!0})},handleModalKeyboard:function(e){this.device.isMobile&&e.querySelectorAll("input, textarea, select").forEach(t=>{t.addEventListener("focus",()=>{document.body.classList.add("keyboard-open"),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"center"})},300)}),t.addEventListener("blur",()=>{setTimeout(()=>{const t=document.activeElement;e.contains(t)&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName)||document.body.classList.remove("keyboard-open")},100)})})},enhanceFormControls:function(){if((this.device.isMobile||this.device.isTablet)&&document.querySelectorAll("[data-form-control], [data-form-select]").forEach(e=>{e.offsetHeight<44&&e.classList.add("form-control-touch-target"),!this.device.isIOS||"date"!==e.type&&"time"!==e.type&&"datetime-local"!==e.type||e.classList.add("form-control-ios-date")}),void 0!==$.fn&&void 0!==$.fn.select2)try{setTimeout(()=>{$(".select2-container").each(function(){const e=$(this).siblings("select");if(e.length){const t={theme:"bootstrap-5",width:"100%",dropdownParent:$(e).closest(".modal").length?$(e).closest(".modal"):$("body")};t.placeholder=e.data("placeholder")||(e.is("[multiple]")?"Select multiple options":"Select an option"),e.select2(t)}})},300)}catch(o){}},enhanceTables:function(){document.querySelectorAll("[data-table-responsive]").forEach(e=>{if(e.classList.add("table-responsive-touch"),this.device.isMobile&&!e.querySelector(".table-scroll-hint")&&e.scrollWidth>e.clientWidth){const t=document.createElement("div");t.className="table-scroll-hint",t.innerHTML='<small class="text-muted"><i class="ti ti-arrows-horizontal me-1"></i>swipe to see more</small>',e.parentNode.insertBefore(t,e.nextSibling),e.addEventListener("scroll",function(){this.scrollLeft>20&&t.classList.add("hidden")})}})},enhanceNavigation:function(){document.querySelectorAll("[data-tabs], .js-tabs").forEach(e=>{const t=e.querySelectorAll(".nav-link"),n=window.innerWidth<768,o=t.length>1,s=e.scrollWidth>e.clientWidth;if(n&&o&&s){if(e.classList.add("scrollable-tabs"),!e.nextElementSibling||!e.nextElementSibling.classList.contains("tabs-scroll-hint")){const t=document.createElement("div");t.className="tabs-scroll-hint",t.innerHTML='<small class="text-muted"><i class="ti ti-arrows-horizontal me-1"></i>swipe</small>',e.parentNode.insertBefore(t,e.nextSibling)}}else{const t=e.nextElementSibling;t&&t.classList.contains("tabs-scroll-hint")&&t.remove()}});const e=document.querySelector(".layout-menu");e&&(this.device.isMobile||this.device.isTablet)&&e.querySelectorAll(".menu-item").forEach(e=>{if(e.classList.contains("menu-item-has-children")){const t=e.querySelector(".menu-toggle");t&&t.classList.add("menu-toggle-touch")}const t=e.querySelector(".menu-link");t&&t.classList.add("menu-link-touch")})},improveScrolling:function(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.getAttribute("href").length>1&&e.addEventListener("click",function(e){const t=this.getAttribute("href");if("#"===t||!t)return;const n=document.querySelector(t);n&&(e.preventDefault(),n.scrollIntoView({behavior:"smooth",block:"start"}))})})},monitorNetworkStatus:function(){window.addEventListener("online",()=>{this.showNetworkStatus(!0)}),window.addEventListener("offline",()=>{this.showNetworkStatus(!1)})},showNetworkStatus:function(e){const t=document.createElement("div");t.className="network-status-indicator",e?(t.classList.add("online"),t.innerHTML='<i class="ti ti-wifi me-2"></i> Connected'):(t.classList.add("offline"),t.innerHTML='<i class="ti ti-wifi-off me-2"></i> Disconnected'),document.body.appendChild(t),setTimeout(()=>{t.classList.add("visible")},10),setTimeout(()=>{t.classList.remove("visible"),setTimeout(()=>{t.parentNode&&document.body.removeChild(t)},300)},3e3)},attachEventListeners:function(){let e;window.addEventListener("orientationchange",()=>{setTimeout(()=>{this.fixIOSViewportHeight(),this.enhanceNavigation(),document.dispatchEvent(new CustomEvent("app:orientationchange"))},200)}),window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{this.detectDevice(),this.applyDeviceClasses(),this.fixIOSViewportHeight(),this.enhanceNavigation(),this.enhanceTables(),document.dispatchEvent(new CustomEvent("app:resize"))},250)}),document.addEventListener("click",()=>{setTimeout(this.cleanupModalBackdrops.bind(this),300)}),this.device.isIOS&&window.addEventListener("scroll",()=>{document.body.scrollTop=document.body.scrollTop+1,document.body.scrollTop=document.body.scrollTop-1},{passive:!0})},cleanupModalBackdrops:function(){const e=document.querySelectorAll(".modal.show"),t=document.querySelectorAll(".modal-backdrop");0===e.length&&t.length>0&&(t.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),document.body.classList.remove("modal-open"),document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"))},setupMutationObserver:function(){new MutationObserver(e=>{let t=!1;e.forEach(e=>{if(e.addedNodes.length)for(let n=0;n<e.addedNodes.length;n++){const o=e.addedNodes[n];if(1===o.nodeType){if(o.hasAttribute&&(o.hasAttribute("data-modal")||o.hasAttribute("data-form-control")||o.hasAttribute("data-form-select")||o.hasAttribute("data-tabs")||o.hasAttribute("data-table-responsive"))){t=!0;break}if(o.querySelector&&(o.querySelector("[data-modal]")||o.querySelector("[data-form-control]")||o.querySelector("[data-form-select]")||o.querySelector("[data-tabs], .js-tabs")||o.querySelector("[data-table-responsive]"))){t=!0;break}}}}),t&&setTimeout(()=>{this.enhanceNewElements()},100)}).observe(document.body,{childList:!0,subtree:!0})},enhanceNewElements:function(){this.setupTouchFeedback(),this.enhanceFormControls(),this.enhanceTables(),this.enhanceNavigation(),this.enhanceModals()}};window.ResponsiveSystem=e,void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("responsive-system",function(){e.init()},{priority:85,description:"Responsive system (mobile detection, touch feedback, form/table/modal enhancements)",reinitializable:!0}):document.addEventListener("DOMContentLoaded",function(){e.init()})}(),function(){function e(){"undefined"!=typeof feather&&(feather.replace(),new MutationObserver(function(e){let t=!1;e.forEach(function(e){e.addedNodes.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&(e.hasAttribute&&e.hasAttribute("data-feather")&&(t=!0),e.querySelector&&e.querySelector("[data-feather]")&&(t=!0))})}),t&&feather.replace()}).observe(document.body,{childList:!0,subtree:!0})),document.querySelectorAll(".c-match-history__date-group").forEach(function(e,t){const n=e.querySelector(".c-match-history__date-header");n&&(t>0&&e.classList.add("is-collapsed"),n.addEventListener("click",function(){e.classList.toggle("is-collapsed")}),n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.addEventListener("keydown",function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.classList.toggle("is-collapsed"))}))}),"undefined"!=typeof EventDelegation?EventDelegation.register("toggle-dropdown",t,{preventDefault:!0}):document.querySelectorAll('[data-action="toggle-dropdown"]').forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();const t=this.getAttribute("data-dropdown"),n=document.querySelector(`[data-dropdown-id="${t}"]`);if(n){document.querySelectorAll(".c-navbar-modern__dropdown.is-open").forEach(function(e){e!==n&&(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"))});const e=n.classList.toggle("is-open");n.setAttribute("aria-hidden",!e),this.setAttribute("aria-expanded",e)}})}),document.addEventListener("click",n)}function t(e,t){t.stopPropagation();const n=e.getAttribute("data-dropdown"),o=document.querySelector(`[data-dropdown-id="${n}"]`);if(o){document.querySelectorAll(".c-navbar-modern__dropdown.is-open").forEach(function(e){e!==o&&(e.classList.remove("is-open"),e.setAttribute("aria-hidden","true"))});const t=o.classList.toggle("is-open");o.setAttribute("aria-hidden",!t),e.setAttribute("aria-expanded",t)}}function n(e){e.target.closest(".c-navbar-modern__dropdown")||e.target.closest('[data-action="toggle-dropdown"]')||(document.querySelectorAll(".c-navbar-modern__dropdown.is-open").forEach(function(e){e.classList.remove("is-open"),e.setAttribute("aria-hidden","true")}),document.querySelectorAll('[data-action="toggle-dropdown"]').forEach(function(e){e.setAttribute("aria-expanded","false")}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e(),document.addEventListener("turbo:load",e),document.addEventListener("turbolinks:load",e)}(),function(e){const t={isTouchDevice:function(){return"ontouchstart"in e||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},isHammerLoaded:function(){return"undefined"!=typeof Hammer},setupModalSwipeDismiss:function(){this.isHammerLoaded()&&document.querySelectorAll(".modal.modal-bottom-sheet").forEach(t=>{const n=t.querySelector(".modal-dialog");if(!n)return;const o=new Hammer(n);o.get("swipe").set({direction:Hammer.DIRECTION_DOWN,threshold:50}),o.on("swipedown",n=>{if(n.center.y<100){const n=bootstrap.Modal.getInstance(t);n&&(e.Haptics&&e.Haptics.modalClose(),n.hide())}}),o.get("pan").set({direction:Hammer.DIRECTION_DOWN,threshold:0});let s=0;o.on("panstart",e=>{s=e.center.y,n.classList.add("transition-none")}),o.on("panmove",e=>{if(e.center.y>s&&e.center.y<100){const t=e.center.y-s;t>0&&t<200&&(n.style.transform=`translateY(${t}px)`)}}),o.on("panend",o=>{if(n.classList.remove("transition-none"),n.classList.add("transition-transform"),o.center.y-s>100){const n=bootstrap.Modal.getInstance(t);n&&(e.Haptics&&e.Haptics.modalClose(),n.hide())}else n.classList.add("translate-y-0"),n.style.transform=""})})},setupSidebarSwipe:function(){if(!this.isHammerLoaded())return;const t=document.getElementById("layout-menu");if(!t)return;const n=document.body,o=new Hammer(n);o.on("swiperight",o=>{o.center.x<50&&e.innerWidth<992&&(t.classList.contains("layout-menu-expanded")||(t.classList.add("layout-menu-expanded"),n.classList.add("layout-menu-expanded"),e.Haptics&&e.Haptics.menuOpen()))}),o.on("swipeleft",o=>{t.classList.contains("layout-menu-expanded")&&(t.classList.remove("layout-menu-expanded"),n.classList.remove("layout-menu-expanded"),e.Haptics&&e.Haptics.menuClose())})},setupPullToRefresh:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-pull-refresh="true"], .table-responsive').forEach(t=>{const n=new Hammer(t);n.get("pan").set({direction:Hammer.DIRECTION_DOWN,threshold:10});let o=0,s=!1,i=t.querySelector(".pull-refresh-indicator");i||(i=document.createElement("div"),i.className="pull-refresh-indicator position-absolute left-50 translate-middle-x d-flex align-items-center justify-content-center text-white opacity-0 z-index-1000",i.innerHTML='<i class="ti ti-refresh"></i>',i.style.top="-50px",i.style.width="40px",i.style.height="40px",i.style.background="var(--bs-primary)",i.style.borderRadius="50%",i.style.transition="opacity 0.3s, top 0.3s",t.classList.add("position-relative"),t.insertBefore(i,t.firstChild)),n.on("panstart",n=>{0!==t.scrollTop&&t!==e||(o=n.center.y,s=!0)}),n.on("panmove",e=>{if(!s)return;const t=e.center.y-o;if(t>0&&t<120){i.style.opacity=Math.min(t/80,1),i.style.top=`${-50+t}px`;const e=i.querySelector("i");e&&(e.style.transform=`rotate(${3*t}deg)`)}}),n.on("panend",n=>{if(s){if(n.center.y-o>80){e.Haptics&&e.Haptics.refresh(),i.style.top="10px";const n=i.querySelector("i");n&&n.classList.add("ti-spin");const o=new CustomEvent("mobile:pullrefresh",{detail:{container:t}});t.dispatchEvent(o),setTimeout(()=>{i.classList.add("opacity-0"),i.style.top="-50px",n&&n.classList.remove("ti-spin")},2e3)}else i.classList.add("opacity-0"),i.style.top="-50px";s=!1}})})},setupLongPress:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-long-press="true"], .card, .list-group-item').forEach(t=>{const n=new Hammer(t);n.get("press").set({time:500}),n.on("press",n=>{e.Haptics&&e.Haptics.longPress();const o=new CustomEvent("mobile:longpress",{detail:{element:t,event:n}});t.dispatchEvent(o),t.classList.add("long-press-active"),setTimeout(()=>{t.classList.remove("long-press-active")},200)})})},setupDoubleTap:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-double-tap="zoom"], .player-card img, .avatar-lg').forEach(t=>{const n=new Hammer(t);n.get("tap").set({taps:2,threshold:10,posThreshold:50});let o=!1;n.on("tap",n=>{2===n.tapCount&&(e.Haptics&&e.Haptics.doubleTap(),o?(t.classList.remove("z-index-1000"),t.classList.add("scale-1"),t.style.transform="",o=!1):(t.classList.add("transition-transform","z-index-1000"),t.style.transform="scale(2)",o=!0),setTimeout(()=>{o&&(t.classList.remove("z-index-1000"),t.classList.add("scale-1"),t.style.transform="",o=!1)},3e3))})})},setupSwipeActions:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-swipe-actions="true"]').forEach(t=>{if(t.closest("thead"))return;const n=new Hammer(t);n.get("swipe").set({threshold:50,velocity:.3});let o=!1,s=t.querySelector(".swipe-actions");if(!s){s=document.createElement("div"),s.className="swipe-actions position-absolute right-0 top-0 bottom-0 d-flex align-items-center gap-2 translate-x-100 transition-transform",s.style.padding="0 16px",s.style.background="var(--bs-danger)";const n=document.createElement("button");n.className="btn btn-sm btn-light",n.innerHTML='<i class="ti ti-trash"></i>',n.onclick=()=>{e.Haptics&&e.Haptics.delete();const n=new CustomEvent("mobile:swipedelete",{detail:{row:t}});t.dispatchEvent(n)},s.appendChild(n),t.classList.add("position-relative","overflow-hidden"),t.appendChild(s)}n.on("swipeleft",()=>{o||(s.classList.remove("translate-x-100"),s.classList.add("translate-x-0"),t.style.transform="translateX(-100px)",o=!0,e.Haptics&&e.Haptics.swipe())}),n.on("swiperight",()=>{o&&(s.classList.remove("translate-x-0"),s.classList.add("translate-x-100"),t.classList.add("translate-x-0"),t.style.transform="",o=!1,e.Haptics&&e.Haptics.swipe())}),document.addEventListener("click",e=>{o&&!t.contains(e.target)&&(s.classList.remove("translate-x-0"),s.classList.add("translate-x-100"),t.classList.add("translate-x-0"),t.style.transform="",o=!1)})})},setupPinchZoom:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-pinch-zoom="true"], .chart-container, img.zoomable').forEach(e=>{const t=new Hammer(e);t.get("pinch").set({enable:!0});let n=1;t.on("pinchstart",()=>{e.classList.add("transition-none")}),t.on("pinchmove",t=>{const o=Math.max(1,Math.min(n*t.scale,4));e.style.transform=`scale(${o})`}),t.on("pinchend",t=>{e.classList.remove("transition-none"),e.classList.add("transition-transform"),n=Math.max(1,Math.min(n*t.scale,4)),n>1&&setTimeout(()=>{e.classList.add("scale-1"),e.style.transform="",n=1},3e3)})})},setupSwipeNavigation:function(){this.isHammerLoaded()&&document.querySelectorAll('[data-swipe-nav="true"], .nav-tabs').forEach(t=>{const n=new Hammer(t);n.get("swipe").set({threshold:30});const o=Array.from(t.querySelectorAll(".nav-link"));0!==o.length&&(n.on("swipeleft",()=>{const t=o.find(e=>e.classList.contains("active")),n=o.indexOf(t);n<o.length-1&&(o[n+1].click(),e.Haptics&&e.Haptics.swipe())}),n.on("swiperight",()=>{const t=o.find(e=>e.classList.contains("active")),n=o.indexOf(t);n>0&&(o[n-1].click(),e.Haptics&&e.Haptics.swipe())}))})},init:function(){this.isTouchDevice()?this.isHammerLoaded()?(this.setupModalSwipeDismiss(),this.setupSidebarSwipe(),this.setupPullToRefresh(),this.setupLongPress(),this.setupDoubleTap(),this.setupSwipeActions(),this.setupPinchZoom(),this.setupSwipeNavigation(),this.addGestureStyles(),console.log("MobileGestures: Initialized successfully")):console.warn("MobileGestures: Hammer.js not loaded, gesture support disabled"):console.log("MobileGestures: Not a touch device, skipping initialization")},addGestureStyles:function(){if(document.getElementById("mobile-gesture-styles"))return;const e=document.createElement("style");e.id="mobile-gesture-styles",e.textContent='\n        .long-press-active {\n          animation: long-press-pulse 0.2s ease;\n        }\n\n        @keyframes long-press-pulse {\n          0%, 100% { transform: scale(1); }\n          50% { transform: scale(0.95); }\n        }\n\n        .swipe-actions button {\n          touch-action: manipulation;\n        }\n\n        .pull-refresh-indicator .ti-spin {\n          animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n\n        /* Smooth transitions for swipe actions */\n        [data-swipe-actions="true"],\n        .table-responsive tr {\n          transition: transform 0.3s ease;\n        }\n      ',document.head.appendChild(e)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init(),e.MobileGestures=t}(window),function(e){const t={state:{isVisible:!1,keyboardHeight:0,activeInput:null,originalViewportHeight:e.innerHeight},isMobile:function(){return e.innerWidth<768},isIOS:function(){return/iPhone|iPad|iPod/.test(navigator.userAgent)},isAndroid:function(){return/Android/.test(navigator.userAgent)},detectKeyboard:function(){const t=e.innerHeight,n=this.state.originalViewportHeight-t;n>150?this.state.isVisible||(this.state.isVisible=!0,this.state.keyboardHeight=n,this.onKeyboardShow()):this.state.isVisible&&(this.state.isVisible=!1,this.state.keyboardHeight=0,this.onKeyboardHide())},onKeyboardShow:function(){document.documentElement.classList.add("keyboard-visible"),document.body.classList.add("keyboard-visible");const t=new CustomEvent("mobile:keyboardshow",{detail:{height:this.state.keyboardHeight}});e.dispatchEvent(t),this.adjustModalsForKeyboard(),this.adjustDropdownsForKeyboard(),console.log("Keyboard shown, height:",this.state.keyboardHeight)},onKeyboardHide:function(){document.documentElement.classList.remove("keyboard-visible"),document.body.classList.remove("keyboard-visible");const t=new CustomEvent("mobile:keyboardhide");e.dispatchEvent(t),this.resetModalAdjustments(),console.log("Keyboard hidden")},adjustModalsForKeyboard:function(){document.querySelectorAll("[data-modal].show").forEach(t=>{const n=t.querySelector("[data-modal-dialog]");if(!n)return;const o=e.innerHeight-this.state.keyboardHeight;if(n.offsetHeight>o&&n.classList.add("modal-keyboard-visible"),this.state.activeInput){const t=this.state.activeInput.getBoundingClientRect(),o=e.innerHeight-this.state.keyboardHeight;t.bottom>o&&n.classList.add("modal-keyboard-shift")}})},resetModalAdjustments:function(){document.querySelectorAll("[data-modal].show [data-modal-dialog]").forEach(e=>{e.classList.remove("modal-keyboard-visible","modal-keyboard-shift")})},adjustDropdownsForKeyboard:function(){document.querySelectorAll("[data-dropdown].show, [data-select-dropdown]").forEach(t=>{const n=t.getBoundingClientRect(),o=e.innerHeight-this.state.keyboardHeight;n.bottom>o&&t.classList.add("dropdown-above-keyboard")})},scrollInputIntoView:function(t){this.isMobile()&&setTimeout(()=>{const n=t.getBoundingClientRect(),o=e.innerHeight-this.state.keyboardHeight,s=n.bottom;if(s>o){const e=s-o+20;t.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});const n=t.closest("[data-modal-body]");n&&(n.scrollTop+=e)}},300)},optimizeInputType:function(t){const n=t.type,o=t.name||"",s=t.id||"",i=t.placeholder||"";if(("email"===n||o.includes("email")||s.includes("email"))&&(t.type="email",t.autocomplete="email",t.inputMode="email"),(o.includes("phone")||o.includes("tel")||s.includes("phone"))&&(t.type="tel",t.autocomplete="tel",t.inputMode="tel"),("number"===n||o.includes("number")||i.includes("number"))&&(t.inputMode="numeric",t.pattern="[0-9]*"),(o.includes("url")||o.includes("website")||s.includes("url"))&&(t.type="url",t.autocomplete="url",t.inputMode="url"),("search"===n||o.includes("search")||s.includes("search"))&&(t.type="search"),(o.includes("username")||s.includes("username"))&&(t.autocomplete="username"),"password"===n&&(t.autocomplete="current-password"),this.isIOS()){const n=e.getComputedStyle(t).fontSize;parseInt(n)<16&&t.classList.add("ios-no-zoom")}},setupInputHandlers:function(){document.addEventListener("focusin",e=>{const t=e.target;["INPUT","TEXTAREA","SELECT"].includes(t.tagName)&&(this.state.activeInput=t,document.body.classList.add("input-focused"),this.scrollInputIntoView(t),setTimeout(()=>this.detectKeyboard(),100))},!0),document.addEventListener("focusout",e=>{this.state.activeInput=null,document.body.classList.remove("input-focused"),setTimeout(()=>this.detectKeyboard(),100)},!0),document.querySelectorAll("input, textarea").forEach(e=>{this.optimizeInputType(e)})},setupIOSFixes:function(){if(!this.isIOS())return;const t=()=>{const t=.01*e.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`)};t(),e.addEventListener("resize",t),e.addEventListener("focusout",()=>{setTimeout(()=>{e.scrollTo(0,0)},100)}),document.querySelectorAll('input[type="date"], input[type="datetime-local"], input[type="time"]').forEach(e=>{e.classList.add("ios-date-input")}),document.addEventListener("touchmove",e=>{this.state.isVisible&&this.state.activeInput&&(e.target.closest("[data-modal-body], [data-table-responsive], [data-scrollable]")||e.preventDefault())},{passive:!1})},setupAndroidFixes:function(){if(!this.isAndroid())return;let t;if(e.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{this.detectKeyboard()},100)}),this.state.isVisible&&this.state.activeInput){const e=document.querySelector('meta[name="viewport"]');if(e){const t=e.content;e.content="width=device-width, initial-scale=1.0, maximum-scale=1.0",setTimeout(()=>{e.content=t},300)}}},setupFormValidation:function(){document.querySelectorAll("form").forEach(t=>{t.addEventListener("submit",n=>{const o=t.querySelector(":invalid");o&&(n.preventDefault(),o.focus(),this.scrollInputIntoView(o),e.Haptics&&e.Haptics.validationError())}),t.querySelectorAll("input, textarea, select").forEach(t=>{t.addEventListener("invalid",()=>{e.Haptics&&e.Haptics.validationError()}),t.addEventListener("input",()=>{t.validity.valid&&t.classList.contains("is-invalid")&&(t.classList.remove("is-invalid"),t.classList.add("is-valid"))})})})},setupMutationObserver:function(){new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{var t;1===e.nodeType&&(["INPUT","TEXTAREA","SELECT"].includes(e.tagName)&&this.optimizeInputType(e),null==(t=e.querySelectorAll)||t.call(e,"input, textarea, select").forEach(e=>{this.optimizeInputType(e)}))})})}).observe(document.body,{childList:!0,subtree:!0})},addKeyboardStyles:function(){if(document.getElementById("mobile-keyboard-styles"))return;const e=document.createElement("style");e.id="mobile-keyboard-styles",e.textContent="\n        /* Keyboard visible state */\n        body.keyboard-visible {\n          /* Optional: adjust fixed elements */\n        }\n\n        /* Input focused state */\n        body.input-focused .navbar-fixed-bottom,\n        body.input-focused .mobile-bottom-nav {\n          transform: translateY(100%);\n          transition: transform 0.3s ease;\n        }\n\n        /* Ensure inputs are visible above keyboard */\n        [data-form-control]:focus,\n        [data-form-select]:focus,\n        textarea:focus {\n          position: relative;\n          z-index: 10;\n        }\n\n        /* iOS-specific: fix 100vh with keyboard */\n        @supports (-webkit-touch-callout: none) {\n          [data-modal-dialog],\n          [data-full-height] {\n            height: calc(var(--vh, 1vh) * 100);\n          }\n        }\n\n        /* Smooth transitions for keyboard adjustments */\n        [data-modal-dialog] {\n          transition: transform 0.3s ease, max-height 0.3s ease;\n        }\n      ",document.head.appendChild(e)},init:function(){this.isMobile()?(this.setupInputHandlers(),this.setupFormValidation(),this.setupMutationObserver(),this.isIOS()&&this.setupIOSFixes(),this.isAndroid()&&this.setupAndroidFixes(),this.addKeyboardStyles(),e.addEventListener("orientationchange",()=>{setTimeout(()=>{this.state.originalViewportHeight=e.innerHeight,this.detectKeyboard()},200)}),console.log("MobileKeyboard: Initialized successfully")):console.log("MobileKeyboard: Not a mobile device, skipping initialization")}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init(),e.MobileKeyboard=t}(window),function(e){const t={isMobile:function(){return e.innerWidth<768},optimizeModals:function(){document.querySelectorAll("[data-modal]").forEach(e=>{if(this.isMobile()){const t=e.querySelector("[data-modal-dialog]");if(t){t.classList.contains("modal-lg")&&t.classList.add("mobile-optimized-modal");const n=e.querySelector("[data-modal-content]");n&&n.classList.add("mobile-modal-content")}}})},optimizeInputGroups:function(){document.querySelectorAll("[data-input-group]").forEach(e=>{this.isMobile()&&(e.querySelectorAll("select").forEach(e=>{e.classList.add("mobile-input-select")}),e.querySelectorAll('input[type="number"], input[placeholder*="Min"]').forEach(e=>{e.classList.add("mobile-input-number")}),e.querySelectorAll('[data-remove-btn], button[onclick*="remove"]').forEach(e=>{e.classList.add("mobile-remove-btn")}))})},setupSwipeToDelete:function(){e.Hammer&&this.isMobile()&&document.querySelectorAll('[data-input-group][id*="event-"], [data-event-entry]').forEach(t=>{const n=new Hammer(t);n.get("swipe").set({direction:Hammer.DIRECTION_LEFT,threshold:50});let o=t.querySelector(".swipe-delete-indicator");o||(o=document.createElement("div"),o.className="swipe-delete-indicator",o.innerHTML='<i class="ti ti-trash"></i> Swipe to delete',t.classList.add("swipe-container"),t.appendChild(o)),n.on("swipeleft",()=>{o.classList.add("swipe-visible"),t.classList.add("swipe-active"),e.Haptics&&e.Haptics.warning();const n=setTimeout(()=>{o.classList.remove("swipe-visible"),t.classList.remove("swipe-active")},3e3);o.onclick=()=>{clearTimeout(n),e.Haptics&&e.Haptics.delete();const o=t.querySelector('[data-remove-btn], button[onclick*="remove"]');o&&o.click()}}),n.on("swiperight",()=>{o.classList.remove("swipe-visible"),t.classList.remove("swipe-active")})})},optimizeSelect2:function(){this.isMobile()&&e.jQuery&&jQuery.fn.select2&&jQuery("select.select2").each(function(){const e=jQuery(this);e.hasClass("select2-hidden-accessible")&&e.select2("destroy"),e.select2({width:"100%",dropdownAutoWidth:!0,dropdownCssClass:"mobile-select2-dropdown",containerCssClass:"mobile-select2-container",minimumResultsForSearch:10})})},makeCollapsible:function(){this.isMobile()&&document.querySelectorAll("[data-modal-body] .row, [data-form-section]").forEach(t=>{const n=t.querySelectorAll("[data-input-group]");if(n.length>3){const o=document.createElement("button");o.type="button",o.className="btn btn-link w-100 text-start mobile-collapse-toggle",o.innerHTML=`\n            <span class="fw-bold">${t.dataset.sectionTitle||"Show/Hide Section"}</span>\n            <i class="ti ti-chevron-down float-end"></i>\n          `;const s=document.createElement("div");for(s.className="mobile-collapse-content mobile-collapse-expanded";n.length>0;)s.appendChild(n[0]);t.insertBefore(o,t.firstChild),t.appendChild(s);let i=!1;o.onclick=()=>{i=!i;const t=o.querySelector("i");i?(s.classList.remove("mobile-collapse-expanded"),s.classList.add("mobile-collapse-collapsed"),t.classList.remove("ti-chevron-down"),t.classList.add("ti-chevron-right")):(s.classList.remove("mobile-collapse-collapsed"),s.classList.add("mobile-collapse-expanded"),t.classList.remove("ti-chevron-right"),t.classList.add("ti-chevron-down")),e.Haptics&&e.Haptics.light()}}})},optimizeDataTables:function(){this.isMobile()&&e.jQuery&&jQuery.fn.DataTable&&jQuery("[data-table], .js-data-table").each(function(){const e=jQuery(this);if(jQuery.fn.DataTable.isDataTable(e)){const t=e.DataTable();t.settings()[0].responsive=!0,t.columns([0,-1]).visible(!0),t.page.len(10).draw()}else e.DataTable({responsive:!0,pageLength:10,dom:'<"top"f>rt<"bottom"ip><"clear">',language:{search:"Filter:",lengthMenu:"Show _MENU_",info:"Page _PAGE_ of _PAGES_",infoEmpty:"No entries",infoFiltered:""}})})},addQuickActions:function(){},optimizeTextareas:function(){document.querySelectorAll("textarea").forEach(e=>{if(this.isMobile()){e.classList.add("mobile-textarea"),e.addEventListener("focus",()=>{e.classList.add("mobile-textarea-expanded")});const t=e.getAttribute("maxlength");if(t){let n=e.parentElement.querySelector(".char-counter");n||(n=document.createElement("div"),n.className="char-counter text-muted small",e.parentElement.appendChild(n));const o=()=>{const o=t-e.value.length;n.textContent=`${o} characters remaining`,o<20?n.classList.add("char-counter-warning"):n.classList.remove("char-counter-warning")};e.addEventListener("input",o),o()}}})},convertToFloatingLabels:function(){this.isMobile()&&document.querySelectorAll("[data-form-group]:not(.form-floating)").forEach(e=>{const t=e.querySelector("label"),n=e.querySelector("input, select, textarea");t&&n&&!n.closest("[data-input-group]")&&(e.classList.add("form-floating"),e.appendChild(t))})},setupMobileValidation:function(){document.querySelectorAll("form").forEach(t=>{t.addEventListener("submit",n=>{const o=t.querySelectorAll(":invalid");if(o.length>0){n.preventDefault();const t=o[0];t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus(),t.classList.add("shake-invalid"),setTimeout(()=>t.classList.remove("shake-invalid"),500),e.Haptics&&e.Haptics.validationError(),e.Swal&&Swal.fire({toast:!0,position:"top",icon:"error",title:"Please fill out all required fields",showConfirmButton:!1,timer:3e3})}}),t.querySelectorAll("input, select, textarea").forEach(t=>{t.addEventListener("blur",()=>{t.validity.valid?(t.classList.remove("is-invalid"),t.classList.add("is-valid")):t.value&&(t.classList.remove("is-valid"),t.classList.add("is-invalid"),e.Haptics&&e.Haptics.light())})})})},addMobileFormStyles:function(){if(document.getElementById("mobile-form-styles"))return;const e=document.createElement("style");e.id="mobile-form-styles",e.textContent='\n        /* Mobile modal optimization */\n        @media (max-width: 767.98px) {\n          .mobile-optimized-modal {\n            max-width: 100%;\n            margin: 0;\n          }\n\n          .mobile-optimized-modal [data-modal-content] {\n            border-radius: 16px 16px 0 0;\n          }\n\n          /* Input group stacking */\n          [data-input-group] {\n            flex-wrap: wrap;\n            gap: 8px;\n          }\n\n          [data-input-group] > * {\n            flex: 1 1 auto;\n            min-width: 0;\n          }\n\n          [data-input-group] [data-remove-btn],\n          [data-input-group] button[onclick*="remove"] {\n            flex: 0 0 44px;\n            min-width: 44px !important;\n            min-height: 44px !important;\n            padding: 0;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n          }\n\n          /* Select2 mobile */\n          .mobile-select2-dropdown {\n            font-size: 16px !important;\n          }\n\n          .mobile-select2-container .select2-selection {\n            min-height: 44px;\n            padding: 8px 12px;\n          }\n\n          /* Shake animation for validation */\n          @keyframes shake {\n            0%, 100% { transform: translateX(0); }\n            25% { transform: translateX(-10px); }\n            75% { transform: translateX(10px); }\n          }\n\n          .shake-invalid {\n            animation: shake 0.3s ease-in-out;\n            border-color: var(--bs-danger) !important;\n          }\n\n          /* Mobile form row stacking */\n          [data-modal-body] .row.g-2 {\n            row-gap: 16px !important;\n          }\n\n          [data-modal-body] .col-md-6,\n          [data-modal-body] .col-lg-6 {\n            width: 100%;\n          }\n\n          /* Sticky submit button spacing */\n          [data-modal-footer] {\n            padding-bottom: 0 !important;\n          }\n\n          /* Larger touch targets in modals */\n          [data-modal] .btn {\n            min-height: 48px;\n            font-size: 16px;\n            padding: 12px 24px;\n          }\n\n          [data-modal] .form-control,\n          [data-modal] .form-select {\n            min-height: 44px;\n            font-size: 16px;\n          }\n        }\n\n        /* Swipe delete indicator */\n        .swipe-delete-indicator {\n          font-size: 14px;\n          font-weight: 600;\n          cursor: pointer;\n        }\n\n        /* Entry transition for swipe */\n        [data-input-group],\n        [data-event-entry] {\n          transition: transform 0.3s ease;\n        }\n      ',document.head.appendChild(e)},init:function(){let t;this.addMobileFormStyles(),this.optimizeModals(),this.optimizeInputGroups(),this.optimizeSelect2(),this.optimizeDataTables(),this.optimizeTextareas(),this.setupMobileValidation(),this.isMobile()&&(this.setupSwipeToDelete(),this.addQuickActions()),document.addEventListener("shown.bs.modal",()=>{setTimeout(()=>{this.optimizeInputGroups(),this.setupSwipeToDelete(),this.addQuickActions()},100)}),e.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(()=>{this.isMobile()&&this.optimizeInputGroups()},250)}),console.log("MobileForms: Initialized successfully (refactored with CSS classes and stable selectors)")}};e.MobileForms=t,void 0!==e.InitSystem&&e.InitSystem.register?e.InitSystem.register("mobile-forms",function(){t.init()},{priority:60,description:"Mobile form optimizations (input groups, swipe, quick actions)",reinitializable:!0}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init()}(window),function(e){const t={isSupported:function(){return"vibrate"in navigator||"mozVibrate"in navigator||"webkitVibrate"in navigator},_vibrate:function(e){if(!this.isSupported())return!1;if(this.isDisabled())return!1;try{if(navigator.vibrate)return navigator.vibrate(e);if(navigator.mozVibrate)return navigator.mozVibrate(e);if(navigator.webkitVibrate)return navigator.webkitVibrate(e)}catch(o){return console.warn("Haptics error:",o),!1}},isDisabled:function(){return"true"===localStorage.getItem("haptics-disabled")},enable:function(){localStorage.removeItem("haptics-disabled")},disable:function(){localStorage.setItem("haptics-disabled","true")},toggle:function(){return this.isDisabled()?(this.enable(),!0):(this.disable(),!1)},stop:function(){this._vibrate(0)},light:function(){return this._vibrate(10)},medium:function(){return this._vibrate(20)},heavy:function(){return this._vibrate(30)},success:function(){return this._vibrate([10,50,10])},error:function(){return this._vibrate([30,100,30])},warning:function(){return this._vibrate([20,50,20])},notification:function(){return this._vibrate([10,30,10,30,10])},selection:function(){return this._vibrate(15)},deselection:function(){return this._vibrate([8,20,8])},swipe:function(){return this._vibrate(12)},longPress:function(){return this._vibrate(50)},doubleTap:function(){return this._vibrate([15,30,15])},drafted:function(){return this._vibrate([20,50,20,50,30])},invalidSelection:function(){return this._vibrate([40,60,40])},timeWarning:function(){return this._vibrate([25,100,25,100,25])},inputFocus:function(){return this._vibrate(8)},validationError:function(){return this._vibrate([25,50,25])},formSubmit:function(){return this._vibrate(18)},menuOpen:function(){return this._vibrate(15)},menuClose:function(){return this._vibrate(12)},modalOpen:function(){return this._vibrate([10,30,15])},modalClose:function(){return this._vibrate(15)},refresh:function(){return this._vibrate([15,50,15,50,20])},delete:function(){return this._vibrate([35,60,35])},archive:function(){return this._vibrate([12,40,12])},custom:function(e){return this._vibrate(e)},init:function(){this.isSupported()?(document.querySelectorAll('.btn:not([data-haptics="false"])').forEach(e=>{e.addEventListener("click",n=>{e.classList.contains("btn-success")?t.success():e.classList.contains("btn-danger")?t.warning():t.medium()},{passive:!0})}),document.querySelectorAll(".form-control, .form-select").forEach(e=>{e.addEventListener("focus",()=>{t.inputFocus()},{passive:!0}),e.addEventListener("invalid",()=>{t.validationError()})}),document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(e=>{e.addEventListener("change",()=>{e.checked?t.selection():t.deselection()},{passive:!0})}),document.querySelectorAll('.nav-link:not([data-haptics="false"])').forEach(e=>{e.addEventListener("click",()=>{t.light()},{passive:!0})}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("shown.bs.modal",()=>{t.modalOpen()}),e.addEventListener("hidden.bs.modal",()=>{t.modalClose()})}),console.log("Haptics: Initialized successfully")):console.log("Haptics: Vibration API not supported")}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init(),e.Haptics=t}(window),function(){const e={init:function(){this.processAllTables(),this.setupScrollTracking(),this.setupDataTables(),this.setupMutationObserver()},processAllTables:function(){document.querySelectorAll("table.mobile-card-table").forEach(e=>{this.processTable(e)}),document.querySelectorAll("[data-table-responsive] table").forEach(e=>{e.classList.contains("mobile-card-processed")||e.closest("[data-table-horizontal-mobile]")||this.processTable(e)}),document.querySelectorAll("table.table:not(.mobile-card-processed)").forEach(e=>{!e.closest("[data-table-responsive]")&&!e.closest("[data-table-horizontal-mobile]")&&window.innerWidth<992&&this.processTable(e)})},processTable:function(e){if(e.classList.contains("mobile-card-processed"))return;const t=e.querySelectorAll("thead th"),n=Array.from(t).map(e=>e.textContent.trim());e.querySelectorAll("tbody tr").forEach(e=>{e.querySelectorAll("td").forEach((e,t)=>{if(t<n.length&&!e.hasAttribute("data-label")&&e.setAttribute("data-label",n[t]),this.isCellWithOnlyActions(e)&&e.classList.add("table-actions"),this.isCellWithAvatar(e)&&e.classList.add("avatar-cell"),!e.textContent.trim()&&!e.querySelector("*")){const t=document.createElement("span");t.classList.add("empty-cell-placeholder"),t.innerText="â",e.appendChild(t)}})}),e.classList.add("mobile-card-processed")},isCellWithOnlyActions:function(e){const t=Array.from(e.children);return 0!==t.length&&t.every(e=>"BUTTON"===e.tagName||"A"===e.tagName&&e.classList.contains("btn")||e.hasAttribute("data-dropdown")||e.hasAttribute("data-btn-group"))},isCellWithAvatar:function(e){return null!==e.querySelector("[data-avatar]")||null!==e.querySelector("img[data-rounded-circle]")||null!==e.querySelector("img[data-avatar]")},setupScrollTracking:function(){document.querySelectorAll("[data-table-responsive-scroll]").forEach(e=>{e.addEventListener("scroll",function(){this.scrollLeft>10?this.classList.add("is-scrolled"):this.classList.remove("is-scrolled")})})},setupDataTables:function(){void 0!==$.fn.dataTable&&($.extend(!0,$.fn.dataTable.defaults,{responsive:!0,drawCallback:function(){this.hasClass("mobile-card-table")&&e.processTable(this[0])}}),$(".dataTable.mobile-card-table").each(function(){e.processTable(this)}))},setupMutationObserver:function(){new MutationObserver(e=>{let t=!1;e.forEach(e=>{if(e.addedNodes&&e.addedNodes.length)for(let n=0;n<e.addedNodes.length;n++){const o=e.addedNodes[n];if(1===o.nodeType){if(o.matches&&o.matches("table.mobile-card-table")){t=!0;break}if(o.querySelectorAll&&o.querySelectorAll("table.mobile-card-table").length){t=!0;break}}}}),t&&this.processAllTables()}).observe(document.body,{childList:!0,subtree:!0})}};window.ResponsiveTables=e,void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("responsive-tables",function(){e.init()},{priority:60,description:"Responsive table system (card view on mobile, data-labels)",reinitializable:!0}):document.addEventListener("DOMContentLoaded",function(){e.init()})}(),function(){const e={init:function(){this.ensureStylesheetLoaded(),this.enhanceButtons(),this.enhanceCards(),this.enhanceForms(),this.enhanceModals(),this.enhanceTables(),this.enhanceNavs(),this.setupResponsive(),this.setupDarkMode(),this.setupCustomBehaviors()},ensureStylesheetLoaded:function(){},enhanceButtons:function(){const e={"btn-primary":"ecs-btn ecs-btn-primary","btn-secondary":"ecs-btn ecs-btn-secondary","btn-success":"ecs-btn ecs-btn-success","btn-info":"ecs-btn ecs-btn-info","btn-warning":"ecs-btn ecs-btn-warning","btn-danger":"ecs-btn ecs-btn-danger","btn-dark":"ecs-btn ecs-btn-dark","btn-outline-primary":"ecs-btn ecs-btn-outline-primary","btn-outline-secondary":"ecs-btn ecs-btn-outline-secondary","btn-sm":"ecs-btn-sm","btn-lg":"ecs-btn-lg"},t=[".c-admin-nav",".c-mobile-nav",".c-modal",".c-btn-modern",".c-form-modern",".c-settings-tabs",".c-messages-inbox",".c-tabs",".c-schedule",".c-schedule-controls","[data-no-enhance]"].join(", ");document.querySelectorAll('button, [type="button"], [type="submit"], [role="button"]').forEach(n=>{if(!n.closest(t)&&!(n.classList.contains("c-tabs__item")||n.classList.contains("c-btn")||n.classList.contains("c-nav__item")||n.classList.contains("c-schedule-controls__btn")||n.classList.contains("ecs-btn"))){n.classList.add("ecs-btn");for(const[t,o]of Object.entries(e))n.classList.contains(t)&&o.split(" ").forEach(e=>{n.classList.contains(e)||n.classList.add(e)});n.querySelector('[data-icon], [class*="icon-"], [class*="ti-"], [class*="feather-"]')&&n.classList.add("ecs-btn-icon")}})},enhanceCards:function(){const e={card:"ecs-card","card-header":"ecs-card-header","card-body":"ecs-card-body","card-footer":"ecs-card-footer","card-title":"ecs-card-title","card-subtitle":"ecs-card-subtitle"},t={"bg-primary":"ecs-card-header-primary","bg-secondary":"ecs-card-header-secondary","bg-success":"ecs-card-header-success","bg-info":"ecs-card-header-info","bg-warning":"ecs-card-header-warning","bg-danger":"ecs-card-header-danger","bg-dark":"ecs-card-header-dark"};document.querySelectorAll('[data-component="card"], [data-role*="card"]').forEach(n=>{if(!n.classList.contains("ecs-card")){n.classList.add("ecs-card"),Object.entries(e).forEach(([e,t])=>{n.querySelectorAll(`[data-card-part="${e.replace("card-","")}"]`).forEach(e=>{e.classList.contains(t)||e.classList.add(t)})});const o=n.querySelector('[data-card-part="header"]');o&&Object.entries(t).forEach(([e,t])=>{o.classList.contains(e)&&!o.classList.contains(t)&&o.classList.add(t)})}})},enhanceForms:function(){Object.entries({"form-control":"ecs-form-control","form-select":"ecs-form-select","form-check":"ecs-form-check","form-check-input":"ecs-form-check-input","form-label":"ecs-form-label","form-text":"ecs-form-text","form-floating":"ecs-form-floating"}).forEach(([e,t])=>{document.querySelectorAll("[data-form-element], [data-input-type]").forEach(e=>{e.classList.contains(t)||e.classList.add(t)})}),document.querySelectorAll('[data-validation-state="valid"], [data-validation-state="invalid"]').forEach(e=>{"valid"===e.getAttribute("data-validation-state")?e.classList.add("ecs-is-valid"):"invalid"===e.getAttribute("data-validation-state")&&e.classList.add("ecs-is-invalid")})},enhanceModals:function(){Object.entries({modal:"ecs-modal","modal-dialog":"ecs-modal-dialog","modal-content":"ecs-modal-content","modal-header":"ecs-modal-header","modal-body":"ecs-modal-body","modal-footer":"ecs-modal-footer","modal-title":"ecs-modal-title","btn-close":"ecs-modal-close","modal-dialog-centered":"ecs-modal-dialog-centered","modal-dialog-scrollable":"ecs-modal-dialog-scrollable","modal-sm":"ecs-modal-sm","modal-lg":"ecs-modal-lg","modal-xl":"ecs-modal-xl"}).forEach(([e,t])=>{document.querySelectorAll(`[data-component="${e}"], [data-modal-part]`).forEach(e=>{e.closest(".c-modal")||e.classList.contains(t)||e.classList.add(t)})}),document.querySelectorAll('[data-component="modal"], [role="dialog"]').forEach(e=>{e.classList.contains("c-modal")||(e.id,e.addEventListener("show.bs.modal",function(){this.querySelectorAll("[data-form-element], [data-input-type]").forEach(e=>{e.classList.contains("form-control")?e.classList.add("ecs-form-control"):e.classList.contains("form-select")&&e.classList.add("ecs-form-select")}),this.querySelectorAll('button, [type="button"], [type="submit"], [role="button"]').forEach(e=>{e.classList.contains("ecs-btn")||e.classList.add("ecs-btn")})}))})},enhanceTables:function(){Object.entries({table:"ecs-table","table-hover":"ecs-table-hover","table-striped":"ecs-table-striped","table-sm":"ecs-table-sm"}).forEach(([e,t])=>{document.querySelectorAll('[data-component="table"], [role="table"]').forEach(e=>{e.classList.contains(t)||e.classList.add(t)})})},enhanceNavs:function(){Object.entries({nav:"ecs-nav","nav-link":"ecs-nav-link","nav-tabs":"ecs-nav-tabs","nav-pills":"ecs-nav-pills",active:"ecs-active"}).forEach(([e,t])=>{document.querySelectorAll('[data-component="nav"], [role="navigation"] > [role="tablist"]').forEach(e=>{e.classList.contains(t)||e.classList.add(t)})}),document.querySelectorAll('[data-component="tab-content"], [role="tabpanel"]').forEach(e=>{e.hasAttribute("data-component")?e.classList.add("ecs-tab-content"):e.hasAttribute("role")&&e.classList.add("ecs-tab-pane")})},setupResponsive:function(){const e=()=>{window.innerWidth<768&&(document.querySelectorAll('button, [type="button"], [type="submit"], [role="button"]').forEach(e=>{e.classList.contains("btn-sm")||e.classList.contains("ecs-btn-sm")||e.classList.add("touch-target")}),document.querySelectorAll('[data-form-element]:not([type="checkbox"]):not([type="radio"]), [data-input-type]:not([type="checkbox"]):not([type="radio"])').forEach(e=>{e.classList.contains("ios-input")||e.classList.add("ios-input")}))};e(),window.addEventListener("resize",e)},setupDarkMode:function(){const e=document.documentElement;new MutationObserver(t=>{t.forEach(t=>{if("attributes"===t.type&&("data-style"===t.attributeName||"data-bs-theme"===t.attributeName)){const t="dark"===e.getAttribute("data-style"),n="dark"===e.getAttribute("data-bs-theme"),o=t||n;this.applyDarkModeToContent(o)}})}).observe(e,{attributes:!0});const t="dark"===e.getAttribute("data-style"),n="dark"===e.getAttribute("data-bs-theme"),o=t||n;this.applyDarkModeToContent(o),document.querySelector(".dark-mode-toggle")||this.addDarkModeToggle()},applyDarkModeToContent:function(e){e?document.body.classList.add("dark-mode-body"):(document.body.classList.remove("dark-mode-body"),document.querySelectorAll(".dark-mode-applied").forEach(e=>{e.classList.remove("dark-mode-applied")}))},addDarkModeToggle:function(){},setupCustomBehaviors:function(){this.addRippleEffect(),this.improveKeyboardNavigation(),this.setupTransitions()},addRippleEffect:function(){document.querySelectorAll('button:not([data-bs-toggle="modal"]), [type="button"]:not([data-bs-toggle="modal"]), [type="submit"]:not([data-bs-toggle="modal"]), [role="button"]:not([data-bs-toggle="modal"])').forEach(e=>{e.addEventListener("click",function(e){if("modal"===this.getAttribute("data-bs-toggle")||this.classList.contains("edit-match-btn")||this.closest('[data-bs-toggle="modal"]'))return;const t=document.createElement("span");t.classList.add("waves-ripple");const n=this.getBoundingClientRect(),o=Math.max(n.width,n.height);t.style.setProperty("--ripple-size",`${o}px`),t.style.setProperty("--ripple-left",e.clientX-n.left-o/2+"px"),t.style.setProperty("--ripple-top",e.clientY-n.top-o/2+"px"),t.classList.add("transform-none"),this.appendChild(t),setTimeout(()=>{t.classList.add("waves-ripple-active")},10),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},600)})})},improveKeyboardNavigation:function(){document.querySelectorAll("a, button, input, select, textarea, [tabindex]").forEach(e=>{e.addEventListener("focus",function(){this.classList.add("ecs-focus")}),e.addEventListener("blur",function(){this.classList.remove("ecs-focus")})})},setupTransitions:function(){document.querySelectorAll('[data-ecs-animate="slide-in"]').forEach(e=>{e.classList.add("opacity-0","translate-y-20px","transition-smooth"),setTimeout(()=>{e.classList.remove("opacity-0","translate-y-20px"),e.classList.add("opacity-100","translate-y-0")},100)})}};window.ECSDesignSystem=e,void 0!==window.InitSystem&&window.InitSystem.register?window.InitSystem.register("design-system",function(){e.init()},{priority:90,description:"ECS Design System (theme, colors, focus states)",reinitializable:!1}):document.addEventListener("DOMContentLoaded",function(){e.init()})}(),function(){const e={delete:{icon:"warning",confirmButtonText:"Delete",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Delete"},remove:{icon:"warning",confirmButtonText:"Remove",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Remove"},approve:{icon:"question",confirmButtonText:"Approve",confirmButtonColor:"#28a745",titlePrefix:"Confirm Approval"},reject:{icon:"warning",confirmButtonText:"Reject",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Rejection"},deny:{icon:"warning",confirmButtonText:"Deny",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Denial"},send:{icon:"question",confirmButtonText:"Send",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Send"},sync:{icon:"question",confirmButtonText:"Sync",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Sync"},refresh:{icon:"question",confirmButtonText:"Refresh",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Refresh"},reset:{icon:"warning",confirmButtonText:"Reset",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Reset"},clear:{icon:"warning",confirmButtonText:"Clear",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Clear"},cancel:{icon:"warning",confirmButtonText:"Yes, Cancel",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Cancellation"},disable:{icon:"warning",confirmButtonText:"Disable",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Disable"},enable:{icon:"question",confirmButtonText:"Enable",confirmButtonColor:"#28a745",titlePrefix:"Confirm Enable"},save:{icon:"question",confirmButtonText:"Save",confirmButtonColor:"#28a745",titlePrefix:"Confirm Save"},submit:{icon:"question",confirmButtonText:"Submit",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Submit"},unlink:{icon:"warning",confirmButtonText:"Unlink",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Unlink"},revoke:{icon:"warning",confirmButtonText:"Revoke",confirmButtonColor:"#dc3545",titlePrefix:"Confirm Revoke"},retry:{icon:"question",confirmButtonText:"Retry",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Retry"},resend:{icon:"question",confirmButtonText:"Resend",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Resend"},duplicate:{icon:"question",confirmButtonText:"Duplicate",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Duplicate"},assign:{icon:"question",confirmButtonText:"Assign",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Assignment"},schedule:{icon:"question",confirmButtonText:"Schedule",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Schedule"},fetch:{icon:"question",confirmButtonText:"Fetch",confirmButtonColor:"#3085d6",titlePrefix:"Confirm Fetch"}};function t(t){if(!t)return null;const n=t.toLowerCase();for(const[o,s]of Object.entries(e))if(n.includes(o))return o;return null}const n={confirm:function(n){if("undefined"==typeof Swal)return console.error("SweetAlert2 not loaded"),Promise.resolve({isConfirmed:confirm(n.text||n.title)});const o=function(t,n){const o=n?e[n]:{};return{icon:"question",showCancelButton:!0,confirmButtonText:"Confirm",cancelButtonText:"Cancel",confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",reverseButtons:!0,...o,...t,title:t.title||o.titlePrefix||"Confirm Action"}}(n,t(n.title)||t(n.text));return Swal.fire(o)},success:function(e,t){return Swal.fire({icon:"success",title:e,text:t,timer:2e3,showConfirmButton:!1})},error:function(e,t){return Swal.fire({icon:"error",title:e,text:t})},info:function(e,t){return Swal.fire({icon:"info",title:e,text:t})},warning:function(e,t){return Swal.fire({icon:"warning",title:e,text:t})}};Object.keys(e).forEach(e=>{n[e]=function(e,t={}){return this.confirm({text:e,...t})}}),window.SwalContextual=n,console.debug("[SwalContextual] Helper initialized")}(),function(){const e={conversations:"/api/messages",messages:e=>`/api/messages/${e}`,send:e=>`/api/messages/${e}`,unreadCount:"/api/messages/unread-count",searchUsers:"/api/messages/users/search",markRead:e=>`/api/messages/${e}/read`},t={enabled:!0,interval:3e4},n={animationDuration:250,typingDebounce:2e3,searchDebounce:300,maxMessageLength:2e3},o={isOpen:!1,currentView:"list",activeConversation:null,conversations:[],messages:[],unreadCount:0,onlineUsers:[],isTyping:!1,typingTimeout:null,searchQuery:"",searchResults:[],settings:{typingIndicators:!0,readReceipts:!0,maxMessageLength:2e3}};let s={};async function i(e,t={}){try{const n={"Content-Type":"application/json",...t.headers};t.method&&"GET"!==t.method&&(n["X-CSRFToken"]=function(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""}());const o=await fetch(e,{...t,headers:n});if(!o.ok)throw new Error(`HTTP ${o.status}`);return await o.json()}catch(n){throw console.error(`[ChatWidget] API Error: ${e}`,n),n}}async function a(){try{const t=await i(e.conversations);t.success&&(o.conversations=t.conversations||[],function(){if(!s.conversationList)return;if(0===o.conversations.length)return s.conversationList.innerHTML="",void(s.emptyState&&(s.emptyState.style.display="flex"));s.emptyState&&(s.emptyState.style.display="none");const e="/static/img/default_player.png",t=o.conversations.map(t=>{var n;const s=(null==(n=o.activeConversation)?void 0:n.id)===t.user.id,i=t.unread_count>0,a=t.user.is_online,r=t.user.avatar_url||e,l=c(t.user);return`\n        <div class="c-chat-widget__conversation ${s?"c-chat-widget__conversation--active":""} ${i?"c-chat-widget__conversation--unread":""}"\n             data-user-id="${t.user.id}"\n             data-user-name="${K(t.user.name)}"\n             data-avatar="${r}"\n             data-online="${a}"\n             data-is-coach="${t.user.is_coach||!1}"\n             data-is-admin="${t.user.is_admin||!1}"\n             data-is-global-admin="${t.user.is_global_admin||!1}"\n             data-is-ref="${t.user.is_ref||!1}"\n             role="button"\n             tabindex="0">\n          <div class="c-chat-widget__conv-avatar ${a?"c-chat-widget__conv-avatar--online":""}">\n            <img src="${r}" alt="${K(t.user.name)}" onerror="this.src='${e}'">\n          </div>\n          <div class="c-chat-widget__conv-content">\n            <div class="c-chat-widget__conv-header">\n              <span class="c-chat-widget__conv-name">${K(t.user.name)}${l}</span>\n              <span class="c-chat-widget__conv-time">${t.last_message.time_ago}</span>\n            </div>\n            <div class="c-chat-widget__conv-preview">\n              ${t.last_message.sent_by_me?"You: ":""}${K(t.last_message.content)}\n            </div>\n          </div>\n          ${i?`<div class="c-chat-widget__conv-badge">${t.unread_count}</div>`:""}\n        </div>\n      `}).join("");s.conversationList.innerHTML=t}())}catch(t){console.error("[ChatWidget] Failed to load conversations",t)}}async function r(){try{const t=await i(e.unreadCount);t.success&&(o.unreadCount=t.count,p())}catch(t){console.error("[ChatWidget] Failed to load unread count",t)}}function c(e){if(!e)return"";const t=[];return e.is_global_admin?t.push('<span class="c-chat-widget__role-badge c-chat-widget__role-badge--admin" title="Global Admin"><i class="ti ti-crown"></i></span>'):e.is_admin&&t.push('<span class="c-chat-widget__role-badge c-chat-widget__role-badge--admin" title="Admin"><i class="ti ti-shield-check"></i></span>'),e.is_coach&&t.push('<span class="c-chat-widget__role-badge c-chat-widget__role-badge--coach" title="Coach"><i class="ti ti-speakerphone"></i></span>'),e.is_ref&&t.push('<span class="c-chat-widget__role-badge c-chat-widget__role-badge--ref" title="Referee"><i class="ti ti-cards"></i></span>'),t.length>0?`<span class="c-chat-widget__role-badges">${t.join("")}</span>`:""}function l(){if(!s.messagesContainer)return;if(0===o.messages.length)return void(s.messagesContainer.innerHTML='\n        <div class="c-chat-widget__empty" style="padding: 24px;">\n          <i class="c-chat-widget__empty-icon ti ti-message-2"></i>\n          <div class="c-chat-widget__empty-text">No messages yet. Say hello!</div>\n        </div>\n      ');const e=Q(),t=o.messages.map(t=>{const n=t.sender_id===e;if(t.is_deleted)return`\n          <div class="c-chat-widget__message c-chat-widget__message--${n?"sent":"received"} c-chat-widget__message--deleted"\n               data-message-id="${t.id}">\n            <div class="c-chat-widget__message-bubble c-chat-widget__message-bubble--deleted">\n              <i class="ti ti-message-off" style="margin-right: 6px; opacity: 0.7;"></i>\n              ${n?"You unsent a message":"This message was unsent"}\n            </div>\n            <span class="c-chat-widget__message-time">\n              ${J(t.created_at)}\n            </span>\n          </div>\n        `;const o=function(e){if(!e)return e;let t=e;for(const[n,o]of Object.entries(m)){const e=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");t=t.replace(new RegExp(e,"g"),o)}return t}(K(t.content));return`\n        <div class="c-chat-widget__message c-chat-widget__message--${n?"sent":"received"}"\n             data-message-id="${t.id}"\n             data-sender-id="${t.sender_id}">\n          <div class="c-chat-widget__message-actions">\n            <button class="c-chat-widget__message-action-btn" data-action="delete-menu" title="Delete message">\n              <i class="ti ti-trash"></i>\n            </button>\n          </div>\n          <div class="c-chat-widget__message-bubble">\n            ${o}\n          </div>\n          <span class="c-chat-widget__message-time">\n            ${J(t.created_at)}\n            ${n&&t.is_read?'<i class="ti ti-checks" style="margin-left: 4px; color: var(--cw-accent);"></i>':""}\n          </span>\n        </div>\n      `}).join("");s.messagesContainer.innerHTML=t}function d(e,t){t.stopPropagation();const n=e.closest(".c-chat-widget__message");n&&function(e,t){if("undefined"!=typeof Swal){const n={title:"Delete message?",icon:"question",showCancelButton:!0,confirmButtonColor:"var(--cw-danger, #ef4444)",cancelButtonColor:"var(--cw-text-secondary, #6b7280)",confirmButtonText:"Delete for me",cancelButtonText:"Cancel",customClass:{popup:"c-chat-widget-swal"}};t&&(n.showDenyButton=!0,n.denyButtonText="Unsend for everyone",n.denyButtonColor="var(--cw-accent, #7c3aed)"),Swal.fire(n).then(t=>{t.isConfirmed?u(e,"me"):t.isDenied&&u(e,"everyone")})}else confirm("Delete this message for yourself?")&&u(e,"me")}(parseInt(n.dataset.messageId),parseInt(n.dataset.senderId)===Q())}async function u(e,t){try{let n,s;"everyone"===t?(n=`/api/messages/message/${e}`,s="DELETE"):(n=`/api/messages/message/${e}/hide`,s="POST");const a=await i(n,{method:s});if(a.success){if("everyone"===t){const t=o.messages.findIndex(t=>t.id===e);-1!==t&&(o.messages[t].is_deleted=!0,o.messages[t].content=null)}else o.messages=o.messages.filter(t=>t.id!==e);l(),S(),Z("everyone"===t?"Message unsent":"Message deleted","success")}else Z(a.error||"Failed to delete message","error")}catch(n){console.error("[ChatWidget] Delete message error:",n),Z("Failed to delete message","error")}}const m={":)":"ð",":-)":"ð","=)":"ð",":(":"ð",":-(":"ð","=(":"ð",":D":"ð",":-D":"ð","=D":"ð",";)":"ð",";-)":"ð",":P":"ð",":-P":"ð",":p":"ð",":O":"ð®",":-O":"ð®",":o":"ð®","<3":"â¤ï¸","</3":"ð",":*":"ð",":-*":"ð",":'(":"ð¢",":')":"ð",":fire:":"ð¥",":heart:":"â¤ï¸",":thumbsup:":"ð",":thumbsdown:":"ð",":clap:":"ð",":wave:":"ð",":ok:":"ð",":100:":"ð¯",":star:":"â­",":sun:":"âï¸",":moon:":"ð",":soccer:":"â½",":trophy:":"ð",":medal:":"ð",":crown:":"ð",":check:":"â",":x:":"â",":warning:":"â ï¸",":party:":"ð",":confetti:":"ð",xD:"ð",XD:"ð","B)":"ð","B-)":"ð","-_-":"ð",":|":"ð",":angry:":"ð ",">:(":"ð ",":thinking:":"ð¤",":shrug:":"ð¤·",":pray:":"ð",":muscle:":"ðª",":eyes:":"ð",":sweat:":"ð",":cool:":"ð",":lol:":"ð",":rofl:":"ð¤£"};function h(){if(!s.searchResults)return void console.warn("[ChatWidget] Search results element not found");if(0===o.searchResults.length)return console.log("[ChatWidget] No search results, hiding dropdown"),s.searchResults.classList.remove("is-visible"),void(s.searchResults.innerHTML="");console.log("[ChatWidget] Rendering",o.searchResults.length,"search results");const e="/static/img/default_player.png",t=o.searchResults.map(t=>{const n=t.avatar_url||e,o=c(t);return`\n        <div class="c-chat-widget__search-result"\n             data-user-id="${t.id}"\n             data-user-name="${K(t.name)}"\n             data-avatar="${n}"\n             data-online="${t.is_online||!1}"\n             data-is-coach="${t.is_coach||!1}"\n             data-is-admin="${t.is_admin||!1}"\n             data-is-global-admin="${t.is_global_admin||!1}"\n             data-is-ref="${t.is_ref||!1}"\n             role="button"\n             tabindex="0">\n          <div class="c-chat-widget__search-result-avatar">\n            <img src="${n}" alt="${K(t.name)}" onerror="this.src='${e}'">\n          </div>\n          <span class="c-chat-widget__search-result-name">${K(t.name)}${o}</span>\n        </div>\n      `}).join("");s.searchResults.innerHTML=t,s.searchResults.classList.add("is-visible"),console.log("[ChatWidget] Search results dropdown visible")}function p(){if(!s.badge)return;o.unreadCount>0?(s.badge.textContent=o.unreadCount>99?"99+":o.unreadCount,s.badge.dataset.count=o.unreadCount,s.badge.style.display=""):(s.badge.style.display="none",s.badge.dataset.count="0");const e=document.querySelector('[data-badge="messages-count"]');e&&(e.textContent=o.unreadCount>99?"99+":o.unreadCount,e.classList.toggle("u-hidden",0===o.unreadCount))}function f(){if(!s.sendBtn||!s.composerInput)return;const e=s.composerInput.value.trim().length>0;s.sendBtn.disabled=!e}function g(){if(s.widget){if(o.isOpen=!0,s.widget.dataset.state="open",window.innerWidth<=767){const e=window.scrollY||window.pageYOffset||document.documentElement.scrollTop;document.body.dataset.chatScrollY=e,document.documentElement.classList.add("chat-widget-open"),document.body.classList.add("chat-widget-open"),document.body.style.top=`-${e}px`}a(),r(),R(),window.innerWidth>575&&s.searchInput&&setTimeout(()=>s.searchInput.focus(),n.animationDuration)}}function v(){if(s.widget){if(o.isOpen=!1,o.currentView="list",o.activeConversation=null,o.messages=[],s.widget.dataset.state="closed",s.widget.dataset.view="list",document.documentElement.classList.remove("chat-widget-open"),document.body.classList.remove("chat-widget-open"),document.body.style.top="",void 0!==document.body.dataset.chatScrollY){const e=parseInt(document.body.dataset.chatScrollY||"0",10);delete document.body.dataset.chatScrollY,window.scrollTo(0,e)}C()}}function y(){o.isOpen?v():g()}function b(t,a,d,u,m){o.currentView="chat",o.activeConversation={id:parseInt(t),name:a,avatar:d,isOnline:"true"===u||!0===u,roles:m||{}},s.widget&&(s.widget.dataset.view="chat");const h="/static/img/default_player.png";if(s.chatAvatar&&(s.chatAvatar.src=d||h,s.chatAvatar.onerror=function(){this.src=h}),s.chatName){const e=c(m);s.chatName.innerHTML=K(a)+e}s.chatStatus&&(s.chatStatus.textContent=o.activeConversation.isOnline?"Online":"Offline",s.chatStatus.classList.toggle("c-chat-widget__chat-status--offline",!o.activeConversation.isOnline)),s.chatAvatarContainer&&s.chatAvatarContainer.classList.toggle("c-chat-widget__chat-avatar--online",o.activeConversation.isOnline),s.messagesContainer&&(s.messagesContainer.innerHTML='\n        <div style="display: flex; justify-content: center; padding: 40px;">\n          <div class="c-chat-widget__typing-dots">\n            <span class="c-chat-widget__typing-dot"></span>\n            <span class="c-chat-widget__typing-dot"></span>\n            <span class="c-chat-widget__typing-dot"></span>\n          </div>\n        </div>\n      '),async function(t){try{const n=await i(e.messages(t));n.success&&(o.messages=n.messages||[],o.settings={...o.settings,...n.settings},l(),S(),r())}catch(n){console.error("[ChatWidget] Failed to load messages",n)}}(t),s.composerInput&&setTimeout(()=>s.composerInput.focus(),n.animationDuration)}function w(){o.currentView="list",o.activeConversation=null,o.messages=[],s.widget&&(s.widget.dataset.view="list"),C(),a()}function S(){s.messagesContainer&&requestAnimationFrame(()=>{s.messagesContainer.scrollTop=s.messagesContainer.scrollHeight})}function _(e){e.preventDefault(),e.stopPropagation(),y()}function E(e){const t=e.target.closest(".c-chat-widget__conversation, .c-chat-widget__online-user, .c-chat-widget__search-result");t&&(b(t.dataset.userId,t.dataset.userName,t.dataset.avatar,t.dataset.online,{is_coach:"true"===t.dataset.isCoach,is_admin:"true"===t.dataset.isAdmin,is_global_admin:"true"===t.dataset.isGlobalAdmin,is_ref:"true"===t.dataset.isRef}),C())}function C(){o.searchQuery="",o.searchResults=[],s.searchInput&&(s.searchInput.value=""),s.searchResults&&(s.searchResults.classList.remove("is-visible"),s.searchResults.innerHTML="")}function T(e){e.preventDefault(),w()}function x(t){if(t.preventDefault(),!o.activeConversation||!s.composerInput)return;const n=s.composerInput.value.trim();n&&async function(t,n){try{const r=await i(e.send(t),{method:"POST",body:JSON.stringify({content:n})});return r.success&&(o.messages.push(r.message),l(),S(),s.composerInput&&(s.composerInput.value="",s.composerInput.style.height="auto",f()),a()),r}catch(r){throw console.error("[ChatWidget] Failed to send message",r),Z("Failed to send message","error"),r}}(o.activeConversation.id,n)}function L(e){if("Enter"===e.key&&!e.shiftKey)return e.preventDefault(),void x(e);o.activeConversation&&o.settings.typingIndicators&&(void 0!==window.SocketManager&&window.SocketManager.isConnected()||B&&B.connected)&&(o.isTyping||(o.isTyping=!0,void 0!==window.SocketManager?window.SocketManager.emit("typing_start",{recipient_id:o.activeConversation.id}):B&&B.emit("typing_start",{recipient_id:o.activeConversation.id})),clearTimeout(o.typingTimeout),o.typingTimeout=setTimeout(()=>{o.isTyping=!1,void 0!==window.SocketManager?window.SocketManager.emit("typing_stop",{recipient_id:o.activeConversation.id}):B&&B.emit("typing_stop",{recipient_id:o.activeConversation.id})},n.typingDebounce))}function k(){var e;f(),(e=s.composerInput)&&(e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px")}let I=null;function A(t){const s=t.target.value.trim();o.searchQuery=s,console.log("[ChatWidget] Search input:",s),clearTimeout(I),I=setTimeout(()=>{!async function(t){if(t.length<2)return o.searchResults=[],void h();console.log("[ChatWidget] Searching users for:",t);try{const n=await i(`${e.searchUsers}?q=${encodeURIComponent(t)}`);console.log("[ChatWidget] Search response:",n),n.success?(o.searchResults=n.users||[],h(),console.log("[ChatWidget] Found",o.searchResults.length,"users")):(console.warn("[ChatWidget] Search returned success=false:",n.error),o.searchResults=[],h())}catch(n){console.error("[ChatWidget] Failed to search users",n),o.searchResults=[],h()}}(s)},n.searchDebounce)}function $(){o.searchResults.length>0&&s.searchResults&&s.searchResults.classList.add("is-visible")}function D(){setTimeout(()=>{s.searchResults&&s.searchResults.classList.remove("is-visible")},200)}function M(e){"Escape"===e.key&&("chat"===o.currentView?w():o.isOpen&&v())}function P(e){s.widget&&o.isOpen&&(s.widget.contains(e.target)||window.innerWidth<=575||v())}let B=null;function q(){if(void 0!==window.SocketManager)return console.log("[ChatWidget] Using SocketManager"),B=window.SocketManager.getSocket(),window.SocketManager.onConnect("ChatWidget",function(e){B=e,console.log("[ChatWidget] Socket connected via SocketManager"),o.isOpen&&R()}),window.SocketManager.onDisconnect("ChatWidget",function(e){console.log("[ChatWidget] Socket disconnected:",e)}),void function(){if(void 0!==window.SocketManager)return window.SocketManager.on("ChatWidget","new_message",F),window.SocketManager.on("ChatWidget","dm_sent",H),window.SocketManager.on("ChatWidget","dm_error",j),window.SocketManager.on("ChatWidget","dm_unread_update",z),window.SocketManager.on("ChatWidget","message_deleted",N),window.SocketManager.on("ChatWidget","user_typing",W),window.SocketManager.on("ChatWidget","messages_read",U),window.SocketManager.on("ChatWidget","user_online",Y),window.SocketManager.on("ChatWidget","user_offline",X),window.SocketManager.on("ChatWidget","online_users",V),void console.log("[ChatWidget] Socket listeners attached via SocketManager");O()}();if("undefined"==typeof io)return console.warn("[ChatWidget] Socket.IO not available, using polling"),void setInterval(r,t.interval);const e=()=>{window.socket&&window.socket.connected?(B=window.socket,O()):window.socket?(B=window.socket,B.once("connect",()=>{O()})):setTimeout(e,1e3)};e()}function O(){B&&(B.on("new_message",F),B.on("dm_sent",H),B.on("dm_error",j),B.on("dm_unread_update",z),B.on("message_deleted",N),B.on("user_typing",W),B.on("messages_read",U),B.on("user_online",Y),B.on("user_offline",X),B.on("online_users",V),console.log("[ChatWidget] Socket listeners attached (direct)"))}function N(e){const t=e.message_id,n=e.deleted_for,s=o.messages.findIndex(e=>e.id===t);-1!==s&&"everyone"===n&&(o.messages[s].is_deleted=!0,o.messages[s].content=null,l())}function R(){void 0===window.SocketManager?B&&B.connected&&B.emit("join_messaging"):window.SocketManager.isConnected()&&window.SocketManager.emit("join_messaging")}function F(e){var t,n;o.unreadCount++,p(),o.activeConversation&&e.sender_id===o.activeConversation.id&&(o.messages.push(e),l(),S(),void 0!==window.SocketManager?window.SocketManager.emit("mark_dm_read",{sender_id:e.sender_id}):B&&B.emit("mark_dm_read",{sender_id:e.sender_id})),a(),o.isOpen||(t=e.sender_name,n=e.content,"Notification"in window&&"granted"===Notification.permission&&new Notification(t,{body:n.length>50?n.substring(0,50)+"...":n,icon:"/static/images/logo-icon.png",tag:"chat-message"}))}function H(e){var t;console.log("[ChatWidget] Message sent:",null==(t=e.message)?void 0:t.id)}function j(e){Z(e.error||"Failed to send message","error")}function z(e){o.unreadCount=e.count,p()}function W(e){o.activeConversation&&e.user_id===o.activeConversation.id&&(e.typing?s.typingIndicator&&(s.typingIndicator.style.display="flex",S()):s.typingIndicator&&(s.typingIndicator.style.display="none"))}function U(e){o.activeConversation&&e.reader_id===o.activeConversation.id&&(o.messages.forEach(t=>{t.sender_id!==e.reader_id&&(t.is_read=!0)}),l())}function Y(e){var t;G(e.user_id,!0),(null==(t=o.activeConversation)?void 0:t.id)===e.user_id&&(o.activeConversation.isOnline=!0,s.chatStatus&&(s.chatStatus.textContent="Online",s.chatStatus.classList.remove("c-chat-widget__chat-status--offline")),s.chatAvatarContainer&&s.chatAvatarContainer.classList.add("c-chat-widget__chat-avatar--online"))}function X(e){var t;G(e.user_id,!1),(null==(t=o.activeConversation)?void 0:t.id)===e.user_id&&(o.activeConversation.isOnline=!1,s.chatStatus&&(s.chatStatus.textContent="Offline",s.chatStatus.classList.add("c-chat-widget__chat-status--offline")),s.chatAvatarContainer&&s.chatAvatarContainer.classList.remove("c-chat-widget__chat-avatar--online"))}function V(e){o.onlineUsers=e.users||[],function(e){if(!s.onlineList)return;const t=s.onlineList.closest(".c-chat-widget__online");if(!e||0===e.length)return void(t&&t.classList.add("u-hidden"));t&&t.classList.remove("u-hidden");const n="/static/img/default_player.png",o=e.slice(0,8).map(e=>{const t=e.avatar_url||n;return`\n        <div class="c-chat-widget__online-user"\n             data-user-id="${e.id}"\n             data-user-name="${K(e.name)}"\n             data-avatar="${t}"\n             data-online="true"\n             role="button"\n             tabindex="0">\n          <div class="c-chat-widget__online-avatar">\n            <img src="${t}" alt="${K(e.name)}" onerror="this.src='${n}'">\n          </div>\n          <span class="c-chat-widget__online-name">${K(e.name.split(" ")[0])}</span>\n        </div>\n      `}).join("");s.onlineList.innerHTML=o}(o.onlineUsers)}function G(e,t){document.querySelectorAll(`[data-user-id="${e}"]`).forEach(e=>{e.dataset.online=t;const n=e.querySelector(".c-chat-widget__conv-avatar, .c-chat-widget__online-avatar");n&&n.classList.toggle("c-chat-widget__conv-avatar--online",t)})}function K(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function J(e){if(!e)return"";const t=new Date(e),n=new Date,o=n-t;return o<864e5&&t.getDate()===n.getDate()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):o<1728e5?"Yesterday":o<6048e5?t.toLocaleDateString([],{weekday:"short"}):t.toLocaleDateString([],{month:"short",day:"numeric"})}function Q(){if(window.currentUserId)return parseInt(window.currentUserId);const e=document.querySelector('meta[name="user-id"]');if(e)return parseInt(e.content);const t=document.querySelector("[data-user-id]");return t?parseInt(t.dataset.userId):null}function Z(e,t="info"){"undefined"!=typeof Swal?Swal.fire({toast:!0,position:"top-end",icon:t,title:e,showConfirmButton:!1,timer:3e3,timerProgressBar:!0}):console.log(`[ChatWidget] ${t}: ${e}`)}function ee(){if(!s.widget)return;const e=document.querySelector(".mobile-bottom-nav, .c-mobile-nav, [data-mobile-nav]");if(e){const t=e.offsetHeight;document.documentElement.style.setProperty("--mobile-nav-height",`${t}px`)}}function te(){document.querySelector(".c-chat-widget")?(s={widget:document.querySelector(".c-chat-widget"),trigger:document.querySelector(".c-chat-widget__trigger"),badge:document.querySelector(".c-chat-widget__badge"),panel:document.querySelector(".c-chat-widget__panel"),listView:document.querySelector(".c-chat-widget__list-view"),searchInput:document.querySelector(".c-chat-widget__search-input"),searchResults:document.querySelector(".c-chat-widget__search-results"),onlineList:document.querySelector(".c-chat-widget__online-list"),conversationList:document.querySelector(".c-chat-widget__conversations"),emptyState:document.querySelector(".c-chat-widget__empty"),chatView:document.querySelector(".c-chat-widget__chat"),backBtn:document.querySelector(".c-chat-widget__back-btn"),chatAvatar:document.querySelector(".c-chat-widget__chat-avatar img"),chatAvatarContainer:document.querySelector(".c-chat-widget__chat-avatar"),chatName:document.querySelector(".c-chat-widget__chat-name"),chatStatus:document.querySelector(".c-chat-widget__chat-status"),messagesContainer:document.querySelector(".c-chat-widget__messages"),typingIndicator:document.querySelector(".c-chat-widget__typing"),composerInput:document.querySelector(".c-chat-widget__composer-input"),sendBtn:document.querySelector(".c-chat-widget__send-btn"),newChatBtn:document.querySelector('[data-action="new-chat"]'),openInboxBtn:document.querySelector('[data-action="open-inbox"]'),closeBtns:document.querySelectorAll('[data-action="close-widget"]')},"undefined"!=typeof EventDelegation&&EventDelegation.register("delete-menu",d,{preventDefault:!0}),s.trigger&&s.trigger.addEventListener("click",_),s.closeBtns&&s.closeBtns.forEach(e=>{e.addEventListener("click",v)}),s.conversationList&&s.conversationList.addEventListener("click",E),s.onlineList&&s.onlineList.addEventListener("click",E),s.searchResults&&s.searchResults.addEventListener("click",E),s.backBtn&&s.backBtn.addEventListener("click",T),s.sendBtn&&s.sendBtn.addEventListener("click",x),s.composerInput&&(s.composerInput.addEventListener("keydown",L),s.composerInput.addEventListener("input",k),s.composerInput.addEventListener("touchstart",function(e){this.style.pointerEvents="auto"},{passive:!0}),s.composerInput.addEventListener("click",function(e){e.stopPropagation(),this.focus()})),s.searchInput?(console.log("[ChatWidget] Search input found, binding events"),s.searchInput.addEventListener("input",A),s.searchInput.addEventListener("focus",$),s.searchInput.addEventListener("blur",D)):console.warn("[ChatWidget] Search input not found!"),document.addEventListener("keydown",M),document.addEventListener("click",P),window.addEventListener("resize",ee),s.openInboxBtn&&s.openInboxBtn.addEventListener("click",()=>{window.location.href="/messages"}),s.newChatBtn&&s.newChatBtn.addEventListener("click",()=>{"chat"===o.currentView&&w(),s.searchInput&&s.searchInput.focus()}),q(),ee(),r(),setInterval(r,t.interval),console.log("[ChatWidget] Initialized")):console.log("[ChatWidget] No widget element found, skipping initialization")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",te):te(),window.ChatWidget={open:g,close:v,toggle:y,openConversation:b,refresh:a,getUnreadCount:()=>o.unreadCount}}(),window.MessengerWidget=new class{constructor(){this.widget=null,this.currentUserId=null,this.currentUserName="",this.conversations=[],this.messages=[],this.onlineUsers=[],this.unreadCount=0,this.typingTimeout=null,this.socket=null,this.refreshIntervals={}}init(){this.widget=document.querySelector('[data-component="messenger-widget"]'),this.widget&&(this.bindEvents(),this.setupWebSocket(),this.loadOnlineUsers(),this.loadConversations(),this.loadUnreadCount(),this.refreshIntervals.online=setInterval(()=>this.loadOnlineUsers(),3e4),this.refreshIntervals.unread=setInterval(()=>this.loadUnreadCount(),6e4),console.log("[Messenger] Initialized"))}getCSRFToken(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""}bindEvents(){this.widget.addEventListener("click",e=>{const t=e.target.closest("[data-action]");t&&(e.preventDefault(),this.handleAction(t.dataset.action,t));const n=e.target.closest("[data-conversation-id]");if(n&&!t){e.preventDefault();const t=parseInt(n.dataset.conversationId,10);this.openConversation(t)}const o=e.target.closest("[data-online-user-id]");if(o&&!t){e.preventDefault();const t=parseInt(o.dataset.onlineUserId,10);this.openConversation(t)}});const e=this.widget.querySelector('[data-input="search"]');e&&e.addEventListener("input",e=>this.handleSearch(e.target.value));const t=this.widget.querySelector('[data-input="message"]');t&&(t.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage())}),t.addEventListener("input",()=>this.handleTyping()),t.addEventListener("input",()=>{t.style.height="auto",t.style.height=Math.min(t.scrollHeight,100)+"px"})),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.widget.classList.contains("is-chatting")&&this.showList()})}handleAction(e,t){var n;switch(e){case"back":this.showList();break;case"new-chat":this.focusSearch();break;case"send-message":this.sendMessage();break;case"delete-message":const e=null==(n=t.closest("[data-message-id]"))?void 0:n.dataset.messageId;e&&this.deleteMessage(parseInt(e,10));break;case"open-messages":window.location.href="/messages"}}setupWebSocket(){if("undefined"==typeof io)return;const e=()=>{window.socket&&window.socket.connected?(this.socket=window.socket,this.attachSocketListeners()):setTimeout(e,1e3)};e()}attachSocketListeners(){this.socket&&(this.socket.on("new_message",e=>this.handleNewMessage(e)),this.socket.on("user_typing",e=>this.handleTypingIndicator(e)),this.socket.on("messages_read",e=>this.handleMessagesRead(e)),this.socket.on("dm_sent",e=>{e.message&&this.appendMessage(e.message)}),this.socket.on("dm_error",e=>{this.showToast(e.error||"Failed to send message","error")}),this.socket.on("user_online",()=>this.loadOnlineUsers()),this.socket.on("user_offline",()=>this.loadOnlineUsers()),this.socket.on("message_deleted",e=>this.handleMessageDeleted(e)))}async loadOnlineUsers(){try{const e=await fetch("/api/notifications/presence/online-users?details=true&limit=8"),t=await e.json();t.success&&(this.onlineUsers=t.online_users||[],this.renderOnlineUsers(),this.updateOnlineCount(t.count||this.onlineUsers.length))}catch(e){console.warn("[Messenger] Failed to load online users:",e)}}renderOnlineUsers(){const e=this.widget.querySelector("[data-online-list]");e&&(e.innerHTML="",0!==this.onlineUsers.length?this.onlineUsers.forEach(t=>{const n=document.createElement("div");n.className="c-messenger__online-user",n.dataset.onlineUserId=t.id,n.title=`Chat with ${t.name}`;const o=t.avatar_url||"/static/img/default_player.png";n.innerHTML=`\n          <div class="c-messenger__online-avatar">\n            <img src="${o}" alt="${t.name}" class="c-messenger__online-avatar-img"\n                 onerror="this.src='/static/img/default_player.png'">\n            <span class="c-online-status c-online-status--sm is-online"></span>\n          </div>\n          <span class="c-messenger__online-name">${t.name.split(" ")[0]}</span>\n        `,e.appendChild(n)}):e.innerHTML='<span class="c-messenger__online-empty">No one online</span>')}updateOnlineCount(e){const t=this.widget.querySelector("[data-online-count]");t&&(t.textContent=e)}async loadConversations(){this.widget.querySelector("[data-conversation-list]");const e=this.widget.querySelector('[data-state="loading"]'),t=this.widget.querySelector('[data-state="empty"]');e&&e.classList.remove("u-hidden"),t&&t.classList.add("u-hidden");try{const t=await fetch("/api/messages"),n=await t.json();e&&e.classList.add("u-hidden"),n.success&&(this.conversations=n.conversations||[],this.renderConversations())}catch(n){console.error("[Messenger] Failed to load conversations:",n),e&&e.classList.add("u-hidden")}}renderConversations(){const e=this.widget.querySelector("[data-conversation-list]"),t=this.widget.querySelector('[data-state="empty"]');e&&(e.querySelectorAll(".c-messenger__conversation").forEach(e=>e.remove()),0!==this.conversations.length?(t&&t.classList.add("u-hidden"),this.conversations.forEach(t=>{const n=document.createElement("div");n.className="c-messenger__conversation",t.unread_count>0&&n.classList.add("is-unread"),n.dataset.conversationId=t.user.id;const o=t.user.avatar_url||"/static/img/default_player.png",s=t.user.is_online?"is-online":"is-offline",i=t.last_message?`${t.last_message.sent_by_me?"You: ":""}${t.last_message.content}`:"No messages yet";n.innerHTML=`\n          <div class="c-messenger__conversation-avatar">\n            <img src="${o}" alt="${t.user.name}"\n                 class="c-messenger__conversation-avatar-img"\n                 onerror="this.src='/static/img/default_player.png'">\n            <span class="c-online-status c-online-status--sm ${s}"\n                  data-online-status="${t.user.id}"></span>\n          </div>\n          <div class="c-messenger__conversation-body">\n            <p class="c-messenger__conversation-name">${t.user.name}</p>\n            <p class="c-messenger__conversation-preview">${this.escapeHtml(i)}</p>\n          </div>\n          <div class="c-messenger__conversation-meta">\n            ${t.last_message?`<span class="c-messenger__conversation-time">${t.last_message.time_ago}</span>`:""}\n            ${t.unread_count>0?`<span class="c-messenger__conversation-unread">${t.unread_count}</span>`:""}\n          </div>\n        `,e.appendChild(n)})):t&&t.classList.remove("u-hidden"))}async openConversation(e){var t;this.currentUserId=e,this.widget.classList.add("is-chatting");const n=this.onlineUsers.find(t=>t.id===e)||(null==(t=this.conversations.find(t=>t.user.id===e))?void 0:t.user);if(n){this.currentUserName=n.name;const e=this.widget.querySelector("[data-header-title] span");e&&(e.textContent=n.name)}await this.loadMessages(e);const o=this.widget.querySelector('[data-input="message"]');o&&o.focus()}async loadMessages(e){const t=this.widget.querySelector("[data-messages]");if(t){t.innerHTML='<div class="c-messenger__loading"><div class="c-messenger__loading-spinner"></div></div>';try{const n=await fetch(`/api/messages/${e}`),o=await n.json();o.success&&(this.messages=o.messages||[],this.renderMessages(t),this.scrollToBottom(t),this.loadUnreadCount())}catch(n){console.error("[Messenger] Failed to load messages:",n),t.innerHTML='<p class="c-messenger__empty">Failed to load messages</p>'}}}renderMessages(e){e&&(e.innerHTML="",0!==this.messages.length?this.messages.forEach(e=>this.appendMessage(e,!1)):e.innerHTML='\n          <div class="c-messenger__empty">\n            <i class="ti ti-message-2 c-messenger__empty-icon"></i>\n            <p class="c-messenger__empty-text">No messages yet. Say hello!</p>\n          </div>\n        ')}appendMessage(e,t=!0){const n=this.widget.querySelector("[data-messages]");if(!n)return;const o=n.querySelector(".c-messenger__empty");o&&o.remove();const s=e.sender_id!==this.currentUserId,i=document.createElement("div");i.className="c-messenger__message c-messenger__message--"+(s?"sent":"received"),i.dataset.messageId=e.id;const a=e.created_at?new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";i.innerHTML=`\n        <div class="c-messenger__message-content">${this.escapeHtml(e.content)}</div>\n        <div class="c-messenger__message-time">${a}</div>\n        ${s?'\n          <div class="c-messenger__message-actions">\n            <button class="c-messenger__message-action" data-action="delete-message" title="Delete">\n              <i class="ti ti-trash"></i>\n            </button>\n          </div>\n        ':""}\n      `,n.appendChild(i),t&&this.scrollToBottom(n)}async sendMessage(){const e=this.widget.querySelector('[data-input="message"]');if(!e||!this.currentUserId)return;const t=e.value.trim();if(t)if(e.value="",e.style.height="auto",e.focus(),this.socket&&this.socket.connected)this.socket.emit("send_dm",{recipient_id:this.currentUserId,content:t});else try{const e=await fetch(`/api/messages/${this.currentUserId}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({content:t})}),n=await e.json();n.success&&n.message?this.appendMessage(n.message):this.showToast(n.error||"Failed to send","error")}catch(n){this.showToast("Failed to send message","error")}}async deleteMessage(e){if(confirm("Delete this message?"))try{const t=await fetch(`/api/messages/message/${e}`,{method:"DELETE",headers:{"X-CSRFToken":this.getCSRFToken()}}),n=await t.json();if(n.success){const t=this.widget.querySelector(`[data-message-id="${e}"]`);t&&(t.classList.add("is-deleting"),setTimeout(()=>t.remove(),200))}else this.showToast(n.error||"Failed to delete","error")}catch(t){this.showToast("Failed to delete message","error")}}handleNewMessage(e){this.loadUnreadCount(),this.widget.classList.contains("is-chatting")&&this.currentUserId===e.sender_id?(this.appendMessage(e),this.markAsRead(e.id)):this.showToast(`${e.sender_name}: ${e.content.substring(0,50)}`,"info"),this.widget.classList.contains("is-chatting")||this.loadConversations()}handleMessageDeleted(e){const t=this.widget.querySelector(`[data-message-id="${e.message_id}"]`);t&&t.remove()}handleTypingIndicator(e){if(this.currentUserId!==e.user_id)return;const t=this.widget.querySelector("[data-messages]");let n=null==t?void 0:t.querySelector(".c-messenger__typing");e.typing?n||(n=document.createElement("div"),n.className="c-messenger__typing",n.innerHTML='\n            <span class="c-messenger__typing-dots">\n              <span class="c-messenger__typing-dot"></span>\n              <span class="c-messenger__typing-dot"></span>\n              <span class="c-messenger__typing-dot"></span>\n            </span>\n            <span>typing...</span>\n          ',t.appendChild(n),this.scrollToBottom(t)):n&&n.remove()}handleTyping(){this.socket&&this.currentUserId&&(this.typingTimeout&&clearTimeout(this.typingTimeout),this.socket.emit("typing_start",{recipient_id:this.currentUserId}),this.typingTimeout=setTimeout(()=>{this.socket.emit("typing_stop",{recipient_id:this.currentUserId})},2e3))}handleMessagesRead(e){}markAsRead(e){this.socket&&this.socket.connected&&this.socket.emit("mark_dm_read",{message_id:e})}async handleSearch(e){if(e.length<2)this.renderConversations();else try{const t=await fetch(`/api/messages/users/search?q=${encodeURIComponent(e)}`),n=await t.json();n.success&&n.users&&this.renderSearchResults(n.users)}catch(t){console.error("[Messenger] Search failed:",t)}}renderSearchResults(e){const t=this.widget.querySelector("[data-conversation-list]");t&&(t.querySelectorAll(".c-messenger__conversation").forEach(e=>e.remove()),e.forEach(e=>{const n=document.createElement("div");n.className="c-messenger__conversation",n.dataset.conversationId=e.id;const o=e.avatar_url||"/static/img/default_player.png";n.innerHTML=`\n          <div class="c-messenger__conversation-avatar">\n            <img src="${o}" alt="${e.name}"\n                 class="c-messenger__conversation-avatar-img"\n                 onerror="this.src='/static/img/default_player.png'">\n          </div>\n          <div class="c-messenger__conversation-body">\n            <p class="c-messenger__conversation-name">${e.name}</p>\n            <p class="c-messenger__conversation-preview">Click to start chatting</p>\n          </div>\n        `,t.appendChild(n)}))}focusSearch(){const e=this.widget.querySelector('[data-input="search"]');e&&(e.focus(),e.value="")}showList(){this.widget.classList.remove("is-chatting"),this.currentUserId=null,this.currentUserName="",this.loadConversations();const e=this.widget.querySelector("[data-header-title] span");e&&(e.textContent="Messages")}async loadUnreadCount(){try{const e=await fetch("/api/messages/unread-count"),t=await e.json();t.success&&this.updateBadge(t.count)}catch(e){console.warn("[Messenger] Failed to load unread count:",e)}}updateBadge(e){this.unreadCount=e;const t=this.widget.querySelector('[data-badge="unread"]');t&&(t.textContent=e>99?"99+":e,t.classList.toggle("u-hidden",0===e));const n=document.querySelector('[data-badge="messages-count"]');n&&(n.textContent=e>99?"99+":e,n.classList.toggle("u-hidden",0===e))}scrollToBottom(e){e&&(e.scrollTop=e.scrollHeight)}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}showToast(e,t="info"){"undefined"!=typeof Swal?Swal.fire({toast:!0,position:"top-end",icon:t,title:e,showConfirmButton:!1,timer:3e3}):console.log(`[${t}]`,e)}destroy(){Object.values(this.refreshIntervals).forEach(e=>{e&&clearInterval(e)})}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.MessengerWidget.init()}):window.MessengerWidget.init(),window.addEventListener("beforeunload",()=>{window.MessengerWidget.destroy()});class w{constructor(e={}){this.config={totalSteps:e.totalSteps||5,playerId:e.playerId||null,csrfToken:e.csrfToken||"",autoSaveUrl:e.autoSaveUrl||"",autoSaveDelay:e.autoSaveDelay||2e3},this.currentStep=1,this.autoSaveTimeout=null,this.lastSavedData=null,this.elements={form:document.getElementById("wizardForm"),progressBar:document.getElementById("progressBar"),currentStepInput:document.getElementById("currentStep"),prevBtn:document.getElementById("prevBtn"),nextBtn:document.getElementById("nextBtn"),confirmBtn:document.getElementById("confirmBtn"),saveIndicator:document.getElementById("saveIndicator"),swipeHint:document.getElementById("swipeHint"),steps:document.querySelectorAll("[data-step]"),stepIndicators:document.querySelectorAll("[data-step-indicator]"),editButtons:document.querySelectorAll("[data-goto-step]"),confirmCheckbox:document.getElementById("confirmCheck")},this.init()}init(){this.elements.form?(this.bindEvents(),this.updateUI(),this.initSwipeGestures(),this.elements.swipeHint&&setTimeout(()=>{this.elements.swipeHint.style.opacity="0.5"},3e3)):console.warn("Profile wizard form not found")}bindEvents(){this.elements.nextBtn&&this.elements.nextBtn.addEventListener("click",e=>{e.preventDefault(),this.next()}),this.elements.prevBtn&&this.elements.prevBtn.addEventListener("click",e=>{e.preventDefault(),this.prev()}),this.elements.stepIndicators.forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.dataset.stepIndicator);t<this.currentStep&&this.goToStep(t)})}),this.elements.editButtons.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=parseInt(e.dataset.gotoStep);this.goToStep(n)})}),this.elements.form.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("change",()=>{this.scheduleAutoSave(),this.currentStep===this.config.totalSteps&&this.populateReview()}),e.addEventListener("input",()=>{e.classList.remove("is-invalid","is-shaking")})}),this.elements.form.addEventListener("submit",e=>{this.validateFinalStep()||e.preventDefault()}),this.elements.confirmCheckbox&&this.elements.confirmCheckbox.addEventListener("change",()=>{this.updateConfirmButton()})}next(){this.currentStep>1&&!this.validateCurrentStep()?this.shakeInvalidFields():this.currentStep<this.config.totalSteps&&(this.currentStep++,this.updateUI(),this.currentStep===this.config.totalSteps&&this.populateReview())}prev(){this.currentStep>1&&(this.currentStep--,this.updateUI())}goToStep(e){e>=1&&e<=this.config.totalSteps&&(this.currentStep=e,this.updateUI(),this.currentStep===this.config.totalSteps&&this.populateReview())}updateUI(){this.elements.currentStepInput&&(this.elements.currentStepInput.value=this.currentStep),this.elements.steps.forEach(e=>{const t=parseInt(e.dataset.step);e.classList.toggle("c-wizard__step--active",t===this.currentStep)}),this.elements.stepIndicators.forEach(e=>{const t=parseInt(e.dataset.stepIndicator);e.classList.remove("c-wizard__progress-step--active","c-wizard__progress-step--completed"),t===this.currentStep?e.classList.add("c-wizard__progress-step--active"):t<this.currentStep&&e.classList.add("c-wizard__progress-step--completed")});const e=(this.currentStep-1)/(this.config.totalSteps-1)*80;this.elements.progressBar&&(this.elements.progressBar.style.width=e+"%"),this.updateNavigationButtons(),this.elements.form.scrollIntoView({behavior:"smooth",block:"start"})}updateNavigationButtons(){const{prevBtn:e,nextBtn:t,confirmBtn:n}=this.elements;1===this.currentStep?(e&&(e.disabled=!0),t&&(t.style.display="flex",t.querySelector("span").textContent="Get Started"),n&&(n.style.display="none")):this.currentStep===this.config.totalSteps?(e&&(e.disabled=!1),t&&(t.style.display="none"),n&&(n.style.display="flex",this.updateConfirmButton())):(e&&(e.disabled=!1),t&&(t.style.display="flex",t.querySelector("span").textContent="Continue"),n&&(n.style.display="none"))}updateConfirmButton(){this.elements.confirmBtn&&this.elements.confirmCheckbox&&(this.elements.confirmBtn.disabled=!this.elements.confirmCheckbox.checked)}validateCurrentStep(){const e=document.querySelector(`[data-step="${this.currentStep}"]`);if(!e)return!0;let t=!0;e.querySelectorAll("[required]").forEach(e=>{e.value.trim()?e.classList.remove("is-invalid"):(e.classList.add("is-invalid"),t=!1)});const n=e.querySelector("#email");return n&&n.value&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.value)||(n.classList.add("is-invalid"),t=!1)),t}validateFinalStep(){return!this.elements.confirmCheckbox||this.elements.confirmCheckbox.checked}shakeInvalidFields(){const e=document.querySelector(`[data-step="${this.currentStep}"]`);if(!e)return;const t=e.querySelectorAll(".is-invalid");t.forEach(e=>{e.classList.add("is-shaking"),setTimeout(()=>{e.classList.remove("is-shaking")},300)}),t.length&&t[0].focus()}populateReview(){document.querySelectorAll("[data-review]").forEach(e=>{var t;const n=e.dataset.review;let o="-";const s=this.elements.form.querySelector(`[data-field="${n}"]`);if(s)if("SELECT"===s.tagName)if(s.multiple){const e=Array.from(s.selectedOptions).map(e=>e.text);o=e.length>0?e.join(", "):"None selected"}else o=(null==(t=s.options[s.selectedIndex])?void 0:t.text)||"-";else if("TEXTAREA"===s.tagName)o=s.value.trim()||"No additional notes";else if("DIV"===s.tagName){const e=s.querySelectorAll('input[type="checkbox"]:checked'),t=Array.from(e).map(e=>e.value);o=t.length>0?t.join(", "):"None selected"}else o=s.value.trim()||"-";else{const e=this.elements.form.querySelectorAll(`input[name="${n}"]:checked`);e.length>0&&(o=Array.from(e).map(e=>e.value).join(", "))}e.textContent=o})}scheduleAutoSave(){this.config.autoSaveUrl&&(this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.autoSave()},this.config.autoSaveDelay))}async autoSave(){if(!this.config.autoSaveUrl)return;const e=new FormData(this.elements.form),t=Object.fromEntries(e.entries()),n=JSON.stringify(t);if(n!==this.lastSavedData)try{(await fetch(this.config.autoSaveUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.config.csrfToken},body:JSON.stringify(t)})).ok&&(this.lastSavedData=n,this.showSaveIndicator())}catch(o){console.warn("Auto-save failed:",o)}}showSaveIndicator(){this.elements.saveIndicator&&(this.elements.saveIndicator.classList.add("is-visible"),setTimeout(()=>{this.elements.saveIndicator.classList.remove("is-visible")},2e3))}initSwipeGestures(){if(!("ontouchstart"in window))return;let e=0,t=0;this.elements.form.addEventListener("touchstart",t=>{e=t.changedTouches[0].screenX},{passive:!0}),this.elements.form.addEventListener("touchend",n=>{t=n.changedTouches[0].screenX;const o=t-e;Math.abs(o)<50||(o>0?this.prev():this.next())},{passive:!0})}getCurrentStep(){return this.currentStep}}function S(e){return e?e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):e}void 0!==t&&t.exports&&(t.exports=w),function(){const e={init:function(){this.isVerificationPage()&&(this.setupSectionCheckboxes(),this.setupConfirmButton(),this.setupProgressIndicator(),this.setupHapticFeedback(),this.trackUserInteraction(),console.log("Profile verification system initialized"))},isVerificationPage:function(){return null!==document.querySelector('button[name="verify_profile"]')||null!==document.querySelector('[data-verification-page="true"]')},setupSectionCheckboxes:function(){0===document.querySelectorAll(".verification-section").length?this.createSectionCheckboxes():this.attachCheckboxListeners()},createSectionCheckboxes:function(){document.querySelectorAll(".card").forEach((e,t)=>{const n=e.querySelector(".card-header");if(!n)return;if(n.querySelector(".section-reviewed"))return;const o=n.querySelector("h5, h4, h3, .card-title");if(!o)return;const s=o.textContent.trim();if(this.shouldSkipSection(s))return;const i=document.createElement("div");i.className="form-check form-switch d-flex align-items-center ms-auto";const a=document.createElement("input");a.className="form-check-input section-reviewed",a.type="checkbox",a.id=`section-reviewed-${t}`,a.setAttribute("data-section",s.toLowerCase().replace(/\s+/g,"-")),a.setAttribute("data-verification-checkbox","section"),a.setAttribute("data-on-change","verify-section-reviewed");const r=document.createElement("label");r.className="form-check-label ms-2 verification-label",r.setAttribute("for",`section-reviewed-${t}`),r.textContent="Reviewed",i.appendChild(a),i.appendChild(r),n.classList.contains("d-flex")||n.classList.add("d-flex","justify-content-between","align-items-center"),n.appendChild(i),e.classList.add("verification-section")}),this.attachCheckboxListeners()},shouldSkipSection:function(e){return[/action/i,/button/i,/submit/i,/confirm/i].some(t=>t.test(e))},attachCheckboxListeners:function(){document.querySelectorAll(".section-reviewed").forEach(e=>{e.setAttribute("data-verification-initialized","true")})},handleCheckboxChange:function(e){window.Haptics&&(e.checked?window.Haptics.success():window.Haptics.light());const t=e.getAttribute("data-section"),n=e.checked;console.log(`Section "${t}" ${n?"checked":"unchecked"}`),this.updateProgress(),this.updateConfirmButton();const o=e.closest("[data-section-card]");o&&(e.checked?(o.classList.add("section-complete"),o.setAttribute("data-complete","true"),this.animateCardCheck(o)):(o.classList.remove("section-complete"),o.setAttribute("data-complete","false")))},animateCardCheck:function(e){e.classList.add("section-complete-animation"),e.classList.add("scale-down"),e.classList.remove("scale-normal"),setTimeout(()=>{e.classList.remove("scale-down"),e.classList.add("scale-normal")},150),setTimeout(()=>{e.classList.remove("section-complete-animation","scale-normal")},300)},setupConfirmButton:function(){const e=document.querySelector('button[name="verify_profile"]');e&&(e.disabled=!0,e.classList.add("disabled"),this.updateConfirmButton())},updateConfirmButton:function(){const e=document.querySelector('button[name="verify_profile"]');if(e)if(this.areAllSectionsReviewed()){if(e.disabled=!1,e.classList.remove("disabled"),e.classList.add("btn-success"),e.classList.remove("btn-secondary"),e.setAttribute("data-state","enabled"),!e.querySelector(".ti-check")){const t=document.createElement("i");t.className="ti ti-check me-2",e.prepend(t)}}else{e.disabled=!0,e.classList.add("disabled"),e.classList.remove("btn-success"),e.classList.add("btn-secondary"),e.setAttribute("data-state","disabled");const t=e.querySelector(".ti-check");t&&t.remove()}},areAllSectionsReviewed:function(){const e=document.querySelectorAll(".section-reviewed");return 0===e.length||Array.from(e).every(e=>e.checked)},getUncheckedSections:function(){const e=document.querySelectorAll(".section-reviewed:not(:checked)");return Array.from(e).map(e=>e.getAttribute("data-section").replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase()))},setupProgressIndicator:function(){let e=document.getElementById("verification-progress");e||(e=this.createProgressIndicator()),this.updateProgress()},createProgressIndicator:function(){const e=document.createElement("div");e.id="verification-progress",e.className="alert alert-info sticky-top mb-4 verification-progress-container",e.setAttribute("data-progress-indicator","verification"),e.setAttribute("data-status","info");const t=document.createElement("strong");t.id="progress-text",t.textContent="0 of 0 sections reviewed";const n=document.createElement("p");n.className="mb-0 small mt-2",n.textContent="Please review each section and check the box before confirming.",e.appendChild(t),e.appendChild(n);const o=document.querySelector("[data-section-card]");return o&&o.parentNode&&o.parentNode.insertBefore(e,o),e},updateProgress:function(){const e=document.querySelectorAll(".section-reviewed"),t=document.querySelectorAll(".section-reviewed:checked").length,n=e.length,o=document.getElementById("progress-text");if(o){o.textContent=`${t} of ${n} sections reviewed`;const e=document.querySelector('[data-progress-indicator="verification"]');e&&(t===n&&n>0?(e.classList.remove("alert-info","alert-warning"),e.classList.add("alert-success"),e.setAttribute("data-status","success")):t>0?(e.classList.remove("alert-info","alert-success"),e.classList.add("alert-warning"),e.setAttribute("data-status","warning")):(e.classList.remove("alert-warning","alert-success"),e.classList.add("alert-info"),e.setAttribute("data-status","info")))}this.updateProgressBar(t,n)},updateProgressBar:function(e,t){let n=document.getElementById("verification-progress-bar");if(!n&&t>0){const e=document.querySelector('[data-progress-indicator="verification"]');if(e){const t=document.createElement("div");t.className="progress mt-2 verification-progress-bar-container",t.setAttribute("data-progress-container","verification"),n=document.createElement("div"),n.id="verification-progress-bar",n.className="progress-bar verification-progress-bar",n.role="progressbar",n.setAttribute("data-progress-bar","verification"),t.appendChild(n),e.appendChild(t)}}if(n&&t>0){const o=Math.round(e/t*100);n.style.width=o+"%",n.setAttribute("aria-valuenow",o),n.setAttribute("aria-valuemin","0"),n.setAttribute("aria-valuemax","100")}},showIncompleteWarning:function(e){const t=e.map(e=>`â¢ ${e}`).join("<br>");"undefined"!=typeof Swal?Swal.fire({icon:"warning",title:"Review Required",html:`<p>Please review the following sections before confirming:</p><br>${t}`,confirmButtonText:"OK",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("warning"):"#ffc107"}):alert(`Please review the following sections:\n\n${e.join("\n")}`)},setupHapticFeedback:function(){},trackUserInteraction:function(){}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{e.init()}):e.init(),window.ProfileVerification=e}();class _{constructor(e){this.leagueName=e,this.socket=null,this.currentPlayerId=null,this.isConnected=!1,window.draftSystemInstance=this,this.init()}init(){console.log("ð¯ [Draft] Initializing DraftSystemV2 for league:",this.leagueName),this.setupImageHandling(),this.setupEventListeners(),this.initializeSocket(),this.setupSearch(),this.setupTeamTabHighlighting(),console.log("ð¯ [Draft] DraftSystemV2 initialization complete")}setupImageHandling(){document.querySelectorAll('[data-component="player-avatar-container"]').forEach(e=>{const t=e.querySelector(".player-avatar"),n=e.querySelector(".player-avatar-fallback");if(t&&n&&(n.classList.add("d-flex"),n.classList.remove("d-none"),t.classList.add("d-none"),t.classList.remove("d-block"),t.src&&""!==t.src)){const e=new Image;e.onload=()=>{t.classList.add("d-block"),t.classList.remove("d-none"),n.classList.add("d-none"),n.classList.remove("d-flex")},e.onerror=()=>{t.classList.add("d-none"),t.classList.remove("d-block"),n.classList.add("d-flex"),n.classList.remove("d-none")},e.src=t.src}}),document.querySelectorAll('[data-component="team-player"]').forEach(e=>{const t=e.querySelector(".team-player-avatar"),n=e.querySelector(".team-player-avatar-fallback");if(t&&n&&(n.classList.add("d-flex"),n.classList.remove("d-none"),t.classList.add("d-none"),t.classList.remove("d-block"),t.src&&""!==t.src)){const e=new Image;e.onload=()=>{t.classList.add("d-block"),t.classList.remove("d-none"),n.classList.add("d-none"),n.classList.remove("d-flex")},e.onerror=()=>{t.classList.add("d-none"),t.classList.remove("d-block"),n.classList.add("d-flex"),n.classList.remove("d-none")},e.src=t.src}})}smartCropImage(e){const t=e.naturalWidth/e.naturalHeight;let n="object-position-top-20";t>1.3?n="object-position-center-35":t>.9&&t<1.1?n="object-position-top-25":t<.7&&(n="object-position-top-15"),e.classList.add(n)}setupEventListeners(){const e=document.getElementById("playerSearch");document.addEventListener("keydown",t=>{"Escape"===t.key&&this.closeModals(),"/"!==t.key||t.target.matches("input, textarea")||(t.preventDefault(),e&&e.focus())})}initializeSocket(){try{if(void 0!==window.SocketManager)return console.log("ð [Draft] Using SocketManager"),this.socket=window.SocketManager.getSocket(),window.SocketManager.onConnect("DraftSystem",e=>{console.log("ð [Draft] Socket connected via SocketManager"),this.socket=e,this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})}),window.SocketManager.onDisconnect("DraftSystem",e=>{console.log("ð [Draft] Socket disconnected:",e),this.isConnected=!1,this.updateConnectionStatus(!1)}),void this.setupSocketListenersViaManager();if(window.socket)return console.log("ð [Draft] Reusing existing socket (connected:",window.socket.connected,")"),this.socket=window.socket,this.socket.connected&&(this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})),void this.setupSocketListeners();console.log("ð [Draft] Creating new socket connection (fallback)"),this.socket=io("/",{transports:["polling","websocket"],upgrade:!0,timeout:1e4,reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:3,withCredentials:!0}),window.socket=this.socket,this.socket.on("connect",()=>{this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})}),this.socket.on("disconnect",()=>{this.isConnected=!1,this.updateConnectionStatus(!1)}),this.socket.on("connect_error",e=>{this.updateConnectionStatus(!1,"Connection Error"),setTimeout(()=>{this.isConnected||this.tryFallbackConnection()},3e3)}),this.socket.on("joined_room",e=>{console.log("ð  [Draft] Joined room:",e.room)}),this.socket.on("player_drafted_enhanced",e=>{this.hideDraftingIndicator(),this.handlePlayerDrafted(e)}),this.socket.on("player_removed_enhanced",e=>{this.handlePlayerRemoved(e)}),this.socket.on("user_drafting",e=>{e.username&&e.player_name&&this.showUserActivity(e.username,e.player_name,e.team_name)}),this.socket.on("error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Error: "+e.message,"error")}),this.socket.on("draft_error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Draft Error: "+e.message,"error")}),this.socket.on("player_details",e=>{this.handlePlayerDetails(e)})}catch(e){this.updateConnectionStatus(!1,"Failed to Connect")}}setupSocketListeners(){this.socket&&(this.socket.on("connect",()=>{console.log("ð [Draft] Socket connected, joining draft room"),this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})}),this.socket.on("disconnect",()=>{this.isConnected=!1,this.updateConnectionStatus(!1)}),this.socket.on("joined_room",e=>{console.log("ð  [Draft] Joined room:",e.room),this.hideLoading()}),this.socket.on("player_drafted_enhanced",e=>{this.hideDraftingIndicator(),this.handlePlayerDrafted(e)}),this.socket.on("player_removed_enhanced",e=>{this.handlePlayerRemoved(e)}),this.socket.on("user_drafting",e=>{e.username&&e.player_name&&this.showUserActivity(e.username,e.player_name,e.team_name)}),this.socket.on("error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Error: "+e.message,"error")}),this.socket.on("draft_error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Draft Error: "+e.message,"error")}),this.socket.on("player_details",e=>{this.handlePlayerDetails(e)}))}setupSocketListenersViaManager(){const e=window.SocketManager;e.on("DraftSystem","joined_room",e=>{console.log("ð  [Draft] Joined room:",e.room),this.hideLoading()}),e.on("DraftSystem","player_drafted_enhanced",e=>{this.hideDraftingIndicator(),this.handlePlayerDrafted(e)}),e.on("DraftSystem","player_removed_enhanced",e=>{this.handlePlayerRemoved(e)}),e.on("DraftSystem","user_drafting",e=>{e.username&&e.player_name&&this.showUserActivity(e.username,e.player_name,e.team_name)}),e.on("DraftSystem","error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Error: "+e.message,"error")}),e.on("DraftSystem","draft_error",e=>{this.hideDraftingIndicator(),this.hideLoading(),this.showToast("Draft Error: "+e.message,"error")}),e.on("DraftSystem","player_details",e=>{this.handlePlayerDetails(e)}),console.log("ð [Draft] Socket listeners attached via SocketManager")}tryFallbackConnection(){try{this.socket&&this.socket.disconnect(),this.socket=io("/",{transports:["polling"],upgrade:!1,timeout:1e4,reconnection:!1,forceNew:!0}),this.socket.on("connect",()=>{this.isConnected=!0,this.updateConnectionStatus(!0),this.socket.emit("join_draft_room",{league_name:this.leagueName})}),this.socket.on("connect_error",e=>{this.updateConnectionStatus(!1,"Using HTTP Fallback"),this.showToast("WebSocket connection failed. Using HTTP mode.","info")}),this.setupSocketEventListeners()}catch(e){this.updateConnectionStatus(!1,"HTTP Fallback Only")}}setupSocketEventListeners(){this.socket&&(this.socket.on("player_drafted_enhanced",e=>{this.hideDraftingIndicator(),this.handlePlayerDrafted(e)}),this.socket.on("player_removed_enhanced",e=>{this.handlePlayerRemoved(e)}),this.socket.on("user_drafting",e=>{e.username&&e.player_name&&this.showUserActivity(e.username,e.player_name,e.team_name)}),this.socket.on("remove_error",e=>{this.hideLoading(),this.showToast("Remove Error: "+e.message,"error")}),this.socket.on("error",e=>{this.showToast("Error: "+e.message,"error")}))}updateConnectionStatus(e,t=null){const n=document.getElementById("connectionStatus");n&&(e?(n.className="connection-status status-connected",n.innerHTML='<i class="ti ti-wifi me-1"></i>Connected'):(n.className="connection-status status-disconnected",n.innerHTML=`<i class="ti ti-wifi-off me-1"></i>${t||"Disconnected"}`))}setupSearch(){this.updatePlayerCounts()}handleSearch(e){const t=e.target.value.toLowerCase(),n=document.getElementById("available-players");if(!n)return;const o=Array.from(n.children);let s=0;o.forEach(e=>{const n=e.querySelector('[data-component="player-card"]');n&&((n.getAttribute("data-player-name")||"").includes(t)?(e.classList.remove("d-none"),e.classList.add("d-block"),s++):(e.classList.add("d-none"),e.classList.remove("d-block")))}),this.toggleEmptyState(0===s),this.updateAvailableCount(s)}handleFilter(e){const t=e.target.value.toLowerCase(),n=document.getElementById("available-players");if(!n)return;const o=Array.from(n.children);let s=0;o.forEach(e=>{const n=e.querySelector('[data-component="player-card"]');if(n){const o=n.getAttribute("data-position")||"";!t||o.includes(t)?(e.classList.remove("d-none"),e.classList.add("d-block"),s++):(e.classList.add("d-none"),e.classList.remove("d-block"))}}),this.toggleEmptyState(0===s),this.updateAvailableCount(s)}handleSort(e){const t=e.target.value,n=document.getElementById("available-players");if(!n)return;const o=Array.from(n.children);o.sort((e,n)=>{const o=e.querySelector('[data-component="player-card"]'),s=n.querySelector('[data-component="player-card"]');if(!o||!s)return 0;let i,a;switch(t){case"name":return i=o.getAttribute("data-player-name")||"",a=s.getAttribute("data-player-name")||"",i.localeCompare(a);case"experience":return i=parseInt(o.getAttribute("data-experience"))||0,a=parseInt(s.getAttribute("data-experience"))||0,a-i;case"attendance":return i=parseInt(o.getAttribute("data-attendance"))||0,a=parseInt(s.getAttribute("data-attendance"))||0,a-i;case"goals":return i=parseInt(o.getAttribute("data-goals"))||0,a=parseInt(s.getAttribute("data-goals"))||0,a-i;default:return 0}}),o.forEach(e=>{n.appendChild(e)}),Array.from(n.children).forEach(e=>{e.hasAttribute("data-component")&&"player-column"===e.getAttribute("data-component")&&!e.querySelector('[data-component="player-card"]')&&e.remove()})}showDraftModal(e,t){this.currentPlayerId=e;const n=[];if(document.querySelectorAll('#teamsAccordion [data-component="team-item"]').forEach(e=>{const t=e.querySelector('[data-component="team-toggle"]'),o=t.querySelector('[data-component="team-name"]').textContent.trim(),s=t.querySelector('[data-component="player-count"]').textContent.trim(),i=e.querySelector("[data-team-id]").getAttribute("data-team-id");n.push({text:`${o} (${s})`,value:i})}),window.Swal)Swal.fire({title:"Draft Player",html:`Select a team for <strong>${t}</strong>:`,input:"select",inputOptions:n.reduce((e,t)=>(e[t.value]=t.text,e),{}),inputPlaceholder:"Choose a team...",showCancelButton:!0,confirmButtonText:"Draft Player",cancelButtonText:"Cancel",customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-secondary"},buttonsStyling:!1,inputValidator:e=>{if(!e)return"Please select a team!"}}).then(e=>{var t,o;if(e.isConfirmed){const s=e.value,i=(null==(o=null==(t=n.find(e=>e.value===s))?void 0:t.text)?void 0:o.split(" (")[0])||"Unknown Team";this.confirmDraft(s,i)}this.currentPlayerId=null});else{const e=prompt(`Select team ID for ${t}:`);e&&this.confirmDraft(e,"Selected Team")}}confirmDraft(e,t){var n;if(!this.currentPlayerId)return void this.showToast("No player selected","error");if(!this.socket||!this.isConnected)return void this.showToast("Not connected to server - cannot draft","error");const o=document.querySelector(`[data-player-id="${this.currentPlayerId}"]`),s=o&&(null==(n=o.querySelector(".fw-semibold"))?void 0:n.textContent)||"Player";this.showDraftingIndicator(s,t),this.socket.emit("draft_player_enhanced",{player_id:this.currentPlayerId,team_id:e,league_name:this.leagueName,player_name:s}),setTimeout(()=>{document.getElementById("currentDraftIndicator")&&(this.hideDraftingIndicator(),this.showToast("Draft timed out. Please refresh.","warning"))},1e4),this.currentPlayerId=null}showDraftingIndicator(e,t){this.hideDraftingIndicator();const n=document.createElement("div");n.id="currentDraftIndicator",n.className="drafting-indicator",n.innerHTML=`\n            <div class="d-flex align-items-center gap-3">\n                <div class="spinner-border spinner-border-sm text-primary" role="status">\n                    <span class="visually-hidden">Drafting...</span>\n                </div>\n                <div>\n                    <strong>Drafting ${e}</strong>\n                    <div class="small text-muted">to ${t}</div>\n                </div>\n            </div>\n        `,document.body.appendChild(n)}hideDraftingIndicator(){const e=document.getElementById("currentDraftIndicator");e&&(e.classList.add("animate-slide-out-right"),setTimeout(()=>e.remove(),300))}showUserActivity(e,t,n){if(!document.getElementById("draftActivity")){const e=document.createElement("div");e.id="draftActivity",e.className="draft-activity-container",document.body.appendChild(e)}const o=document.createElement("div");o.className="user-activity-toast",o.innerHTML=`\n            <i class="ti ti-user-check text-primary me-2"></i>\n            <div>\n                <strong>${e}</strong> is drafting <strong>${t}</strong>\n                ${n?`<div class="small text-muted">to ${n}</div>`:""}\n            </div>\n        `,document.getElementById("draftActivity").appendChild(o),setTimeout(()=>{o.classList.add("animate-fade-out"),setTimeout(()=>o.remove(),300)},5e3)}async fallbackDraftPlayer(e,t,n){var o;try{this.showLoading();const s=null==(o=document.querySelector("meta[name=csrf-token]"))?void 0:o.getAttribute("content"),i={"Content-Type":"application/json"};s&&(i["X-CSRFToken"]=s);const a=await fetch("/draft/api/draft-player",{method:"POST",headers:i,body:JSON.stringify({player_id:e,team_id:t,league_name:this.leagueName})});if(a.ok){const e=await a.json();this.handlePlayerDrafted(e),this.showToast(`${e.player.name} drafted to ${n}`,"success")}else{const e=await a.json();this.showToast(e.message||"Draft failed","error")}}catch(s){this.showToast("Draft failed - please try again","error")}finally{this.hideLoading(),this.currentPlayerId=null}}removePlayer(e,t){this.socket&&this.isConnected?(this.showLoading(),this.socket.emit("remove_player_enhanced",{player_id:e,team_id:t,league_name:this.leagueName})):this.showToast("Not connected to server","error")}handlePlayerDrafted(e){var t;this.hideLoading();const n=document.getElementById("available-players");if(n){const o=null==(t=n.querySelector(`[data-player-id="${e.player.id}"]`))?void 0:t.closest('[data-component="player-column"]');if(o){const e=o.offsetHeight;o.style.maxHeight=e+"px",o.classList.add("transition-smooth"),requestAnimationFrame(()=>{o.classList.add("opacity-0"),o.classList.add("scale-90"),o.style.transform="scale(0.8) translateY(-10px)",setTimeout(()=>{o.classList.add("max-h-0","mb-0-important","pt-0-important","pb-0-important","overflow-hidden"),o.style.maxHeight="0"},100)}),setTimeout(()=>{o.remove(),this.updatePlayerCounts()},400)}}this.addPlayerToTeam(e.player,e.team_id,e.team_name),this.showToast(`${e.player.name} drafted to ${e.team_name}`,"success")}addPlayerToTeam(e,t,n){const o=document.getElementById(`teamPlayers${t}`);if(!o)return;const s=document.createElement("div");s.className="col-md-6 col-lg-4",s.setAttribute("data-component","team-player-card"),s.setAttribute("data-player-id",e.id);const i=e.profile_picture_url||"/static/img/default_player.png";s.innerHTML=`\n            <div class="card border-0 shadow-sm position-relative"\n                 style="min-height: 120px; cursor: grab;"\n                 draggable="true"\n                 ondragstart="handleDragStart(event, ${e.id})"\n                 ondragend="handleDragEnd(event)">\n                ${e.is_ref?'\n                <div class="position-absolute top-0 start-0" style="z-index: 2;">\n                    <div class="bg-danger text-white" style="padding: 2px 4px; border-radius: 0 0 8px 0; font-size: 10px; font-weight: bold;" title="Referee">\n                        REF\n                    </div>\n                </div>\n                ':""}\n                <div class="card-body p-2">\n                    <div class="d-flex align-items-center mb-2">\n                        <img src="${i}"\n                             alt="${e.name}"\n                             class="rounded-circle me-2"\n                             style="width: 40px; height: 40px; object-fit: cover;"\n                             loading="lazy"\n                             onerror="this.src='/static/img/default_player.png';">\n                        <div class="flex-grow-1 min-width-0">\n                            <div class="fw-semibold text-truncate small">${e.name}</div>\n                            <div class="text-muted" style="font-size: 0.75rem;">\n                                ${S(e.favorite_position)||"Any"}\n                            </div>\n                        </div>\n                        <button class="btn btn-outline-danger btn-sm p-1"\n                                data-action="remove-player"\n                                data-player-id="${e.id}"\n                                data-team-id="${t}"\n                                data-player-name="${e.name}"\n                                data-team-name="${n}"\n                                title="Remove ${e.name}">\n                            <i class="ti ti-x" style="font-size: 0.75rem;"></i>\n                        </button>\n                    </div>\n                    <div class="d-flex justify-content-between text-center small">\n                        <div>\n                            <div class="fw-bold text-success">${e.career_goals||0}</div>\n                            <div class="text-muted" style="font-size: 0.7rem;">Goals</div>\n                        </div>\n                        <div>\n                            <div class="fw-bold text-info">${e.career_assists||0}</div>\n                            <div class="text-muted" style="font-size: 0.7rem;">Assists</div>\n                        </div>\n                        <div>\n                            <div class="fw-bold">\n                                <span class="text-warning">${e.career_yellow_cards||0}</span>/<span class="text-danger">${e.career_red_cards||0}</span>\n                            </div>\n                            <div class="text-muted" style="font-size: 0.7rem;">Cards</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,s.classList.add("draft-card-enter"),o.appendChild(s),setTimeout(()=>{s.classList.remove("draft-card-enter"),s.classList.add("draft-card-enter-active")},10),this.updateTeamCount(t)}updateTeamCount(e){const t=document.getElementById(`teamPlayers${e}`),n=document.getElementById(`teamCount${e}`);if(t&&n){const e=t.querySelectorAll(".draft-team-player-card").length;n.textContent=`${e} players`}}addPlayerToAvailable(e){const t=document.getElementById("available-players");if(!t)return;const n=document.createElement("div");n.className="col-xl-3 col-lg-4 col-md-6 col-sm-6",n.setAttribute("data-component","player-column");const o=e.profile_picture_url||"/static/img/default_player.png",s=e.experience_level||e.league_experience_seasons||"Unknown",i=S(e.favorite_position||e.position)||"Any",a=e.profile_picture_medium||e.profile_picture_webp||o,r=e.league_experience_seasons||0,c=e.attendance_estimate||75,l=e.expected_weeks_available||"All weeks";let d="secondary";"Veteran"===s?d="success":"Experienced"===s&&(d="warning");let u="muted",m="No data";null!=c&&(m=`${Math.round(c)}%`,u=c>=80?"success":c>=60?"warning":"danger"),n.innerHTML=`\n            <div id="player-${e.id}" class="card border-0 shadow-sm h-100"\n                 data-component="player-card"\n                 data-player-id="${e.id}"\n                 data-player-name="${e.name.toLowerCase()}"\n                 data-position="${i.toLowerCase()}"\n                 data-experience="${r}"\n                 data-attendance="${c}"\n                 data-goals="${e.career_goals||0}"\n                 draggable="true"\n                 ondragstart="handleDragStart(event, ${e.id})"\n                 ondragend="handleDragEnd(event)"\n                 style="cursor: grab; transition: all 0.2s ease; min-height: 320px;">\n\n                \x3c!-- Player Image Header --\x3e\n                <div class="position-relative overflow-hidden" style="height: 120px;">\n                    \x3c!-- Full Header Player Image --\x3e\n                    <img src="${a}"\n                         alt="${e.name}"\n                         class="player-face-crop"\n                         style="width: 100%; height: 100%; object-fit: cover; object-position: center 20%; display: block !important; visibility: visible !important; opacity: 1 !important;"\n                         loading="eager"\n                         onerror="// console.log('Image failed to load:', this.src); this.src='/static/img/default_player.png';"\n                         onload="// console.log('Image loaded successfully:', this.src); if(typeof smartCropImage === 'function') smartCropImage(this);">\n\n                    \x3c!-- Dark overlay for better text readability --\x3e\n                    <div class="position-absolute w-100 h-100" style="background: rgba(0,0,0,0.3); top: 0; left: 0;"></div>\n\n                    \x3c!-- Experience Badge - Small Corner Tag --\x3e\n                    <div class="position-absolute top-0 end-0" style="z-index: 2;">\n                        <div class="experience-corner-tag bg-${d}"\n                             title="${s}">\n                            <span class="experience-initial">\n                                ${s[0]||"N"}\n                            </span>\n                        </div>\n                    </div>\n\n                    \x3c!-- Player Name Overlay --\x3e\n                    <div class="position-absolute bottom-0 start-0 p-2" style="z-index: 2;">\n                        <h6 class="text-white fw-bold mb-0 text-shadow-sm">${e.name}</h6>\n                    </div>\n                </div>\n\n                \x3c!-- Player Info Body --\x3e\n                <div class="card-body p-3 text-center">\n                    \x3c!-- Position Badge --\x3e\n                    <div class="mb-2">\n                        ${"Any"!==i?`<span class="badge bg-primary rounded-pill">${i}</span>`:'<span class="badge bg-secondary rounded-pill">Any Position</span>'}\n                    </div>\n\n                    \x3c!-- Stats Row --\x3e\n                    <div class="row text-center mb-2 small">\n                        <div class="col-6">\n                            <div class="fw-bold text-success">${e.career_goals||0}</div>\n                            <div class="text-muted">Goals</div>\n                        </div>\n                        <div class="col-6">\n                            <div class="fw-bold text-info">${e.career_assists||0}</div>\n                            <div class="text-muted">Assists</div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Cards & Attendance --\x3e\n                    <div class="row text-center mb-3 small">\n                        <div class="col-6">\n                            <div class="fw-bold">\n                                <span class="text-warning">${e.career_yellow_cards||0}</span>/<span class="text-danger">${e.career_red_cards||0}</span>\n                            </div>\n                            <div class="text-muted">Y/R Cards</div>\n                        </div>\n                        <div class="col-6">\n                            <div class="fw-bold text-${u}">\n                                ${m}\n                            </div>\n                            <div class="text-muted">Attendance</div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Experience Info --\x3e\n                    <div class="small text-muted mb-2">\n                        ${r} season${1!==r?"s":""}\n                    </div>\n\n                    \x3c!-- Availability Info --\x3e\n                    ${"All weeks"!==l?`<div class="small text-info mb-3">\n                            <i class="ti ti-calendar-event me-1"></i><strong>Expected:</strong> ${l}\n                        </div>`:'<div class="small text-success mb-3">\n                            <i class="ti ti-calendar-check me-1"></i><strong>Available:</strong> All weeks\n                        </div>'}\n                </div>\n\n                \x3c!-- Action Buttons --\x3e\n                <div class="card-footer bg-transparent border-0 p-2">\n                    <div class="d-grid gap-1">\n                        <button class="btn btn-success btn-sm fw-bold"\n                                data-action="draft-player"\n                                data-player-id="${e.id}"\n                                data-player-name="${e.name}"\n                                style="background: linear-gradient(45deg, var(--ecs-success, #28a745), var(--ecs-success-light, #20c997));">\n                            <i class="ti ti-user-plus me-1"></i>Draft Player\n                        </button>\n                        <button class="btn btn-outline-info btn-sm"\n                                data-action="view-player-profile"\n                                data-player-id="${e.id}">\n                            <i class="ti ti-user me-1"></i>View Profile\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `,n.classList.add("draft-card-enter"),t.appendChild(n),Array.from(t.children).forEach(e=>{e.hasAttribute("data-component")&&"player-column"===e.getAttribute("data-component")&&!e.querySelector('[data-component="player-card"]')&&e.remove()}),setTimeout(()=>{const e=document.getElementById("sortPlayers");e&&e.value&&"default"!==e.value&&this.handleSort({target:e});const t=document.getElementById("searchPlayers"),o=document.getElementById("filterPosition");if(t&&t.value){const e=t.value.toLowerCase();(n.querySelector('[data-component="player-card"]').getAttribute("data-player-name")||"").includes(e)||n.classList.add("d-none")}if(o&&o.value){const e=o.value.toLowerCase(),t=n.querySelector('[data-component="player-card"]').getAttribute("data-position")||"";e&&!t.includes(e)&&n.classList.add("d-none")}},50),setTimeout(()=>{n.classList.remove("draft-card-enter"),n.classList.add("draft-card-enter-active")},10),this.updatePlayerCounts()}handlePlayerRemoved(e){this.hideLoading(),this.removePlayerFromTeam(e.player.id,e.team_id),this.addPlayerToAvailable(e.player),this.showToast(`${e.player.name} removed from ${e.team_name}`,"info")}removePlayerFromTeam(e,t){const n=document.querySelector(`#teamPlayers${t} [data-player-id="${e}"]`);n&&(n.classList.add("team-player-exit"),setTimeout(()=>{n.remove(),this.updateTeamCount(t)},300))}handlePlayerDetails(e){const t=document.getElementById("playerProfileContent");if(!t)return;const n=e.player,o=`\n            <div class="row">\n                <div class="col-md-4 text-center">\n                    <div class="player-avatar-container mx-auto mb-3" style="width: 120px; height: 120px;">\n                        <div class="player-avatar-fallback">\n                            ${n.name.substring(0,2).toUpperCase()}\n                        </div>\n                        ${n.profile_picture_url?`<img src="${n.profile_picture_url}" alt="${n.name}" class="player-avatar"\n                                  onload="this.classList.add('d-block'); this.classList.remove('d-none'); this.previousElementSibling.classList.add('d-none'); this.previousElementSibling.classList.remove('d-flex');"\n                                  onerror="this.classList.add('d-none'); this.classList.remove('d-block'); this.previousElementSibling.classList.add('d-flex'); this.previousElementSibling.classList.remove('d-none');">`:""}\n                    </div>\n                    <h4 class="fw-bold mb-2">${n.name}</h4>\n                    <div class="mb-3">\n                        ${n.favorite_position?`<span class="badge badge-position">${S(n.favorite_position)}</span>`:""}\n                        <span class="badge badge-${"Veteran"===n.experience_level?"veteran":"Experienced"===n.experience_level?"experienced":"new-player"}">\n                            ${n.experience_level}\n                        </span>\n                    </div>\n                </div>\n                <div class="col-md-8">\n                    <div class="row">\n                        <div class="col-sm-6 mb-3">\n                            <h6 class="text-muted mb-1">Career Stats</h6>\n                            <div class="d-flex gap-2 flex-wrap">\n                                <span class="stat-chip stat-goals">${n.career_goals}G</span>\n                                <span class="stat-chip stat-assists">${n.career_assists}A</span>\n                                <span class="stat-chip bg-warning text-dark">${n.career_yellow_cards}Y</span>\n                                <span class="stat-chip bg-danger">${n.career_red_cards}R</span>\n                                <span class="stat-chip stat-seasons">${n.league_experience_seasons}T</span>\n                            </div>\n                        </div>\n                        <div class="col-sm-6 mb-3">\n                            <h6 class="text-muted mb-1">Season Stats</h6>\n                            <div class="d-flex gap-2 flex-wrap">\n                                <span class="stat-chip stat-goals">${n.season_goals}G</span>\n                                <span class="stat-chip stat-assists">${n.season_assists}A</span>\n                                <span class="stat-chip bg-warning text-dark">${n.season_yellow_cards}Y</span>\n                                <span class="stat-chip bg-danger">${n.season_red_cards}R</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-sm-6 mb-3">\n                            <h6 class="text-muted mb-1">Attendance</h6>\n                            <div class="attendance-section">\n                                <div class="attendance-label">\n                                    <span>Rate</span>\n                                    <span class="fw-bold">${Math.round(n.attendance_estimate)}%</span>\n                                </div>\n                                <div class="attendance-bar">\n                                    <div class="attendance-fill attendance-${n.attendance_estimate>=80?"excellent":n.attendance_estimate>=60?"good":"poor"}"\n                                         style="width: ${n.attendance_estimate}%"></div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="col-sm-6 mb-3">\n                            <h6 class="text-muted mb-1">Reliability</h6>\n                            <div class="text-center">\n                                <div class="fs-4 fw-bold text-primary">${Math.round(n.reliability_score)}%</div>\n                                <small class="text-muted">Response Rate: ${Math.round(n.rsvp_response_rate)}%</small>\n                            </div>\n                        </div>\n                    </div>\n                    ${n.player_notes?`<div class="mb-3">\n                            <h6 class="text-muted mb-1">Player Notes</h6>\n                            <p class="mb-0">${n.player_notes}</p>\n                        </div>`:""}\n                    ${n.admin_notes?`<div class="mb-3">\n                            <h6 class="text-muted mb-1">Admin/Coach Notes</h6>\n                            <p class="mb-0">${n.admin_notes}</p>\n                        </div>`:""}\n                    ${n.expected_weeks_available&&"All weeks"!==n.expected_weeks_available?`<div class="mb-3">\n                            <h6 class="text-muted mb-1">Availability</h6>\n                            <p class="mb-0">${n.expected_weeks_available}</p>\n                        </div>`:""}\n                </div>\n            </div>\n            ${n.match_history&&n.match_history.length>0?`<hr>\n                <h6 class="text-muted mb-3">Recent Match History</h6>\n                <div class="table-responsive">\n                    <table class="table table-sm">\n                        <thead>\n                            <tr>\n                                <th>Date</th>\n                                <th>Goals</th>\n                                <th>Assists</th>\n                                <th>Cards</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${n.match_history.map(e=>`\n                                <tr>\n                                    <td>${e.date}</td>\n                                    <td>${e.goals}</td>\n                                    <td>${e.assists}</td>\n                                    <td>\n                                        ${e.yellow_cards?`<span class="badge bg-warning">${e.yellow_cards}Y</span>`:""}\n                                        ${e.red_cards?`<span class="badge bg-danger">${e.red_cards}R</span>`:""}\n                                    </td>\n                                </tr>\n                            `).join("")}\n                        </tbody>\n                    </table>\n                </div>`:""}\n        `;t.innerHTML=o}updatePlayerCounts(){const e=document.querySelectorAll('[data-component="player-item"]').length,t=document.getElementById("availableCount");t&&(t.textContent=e),document.querySelectorAll('[id^="teamCount"]').forEach(e=>{const t=e.id.replace("teamCount",""),n=document.querySelectorAll(`#teamPlayers${t} .draft-team-player-card`).length;e.textContent=`${n} players`})}updateAvailableCount(e){const t=document.getElementById("availableCount");t&&(t.textContent=e)}toggleEmptyState(e){const t=document.getElementById("emptyState"),n=document.getElementById("playersContainer");t&&(e?(t.classList.add("d-block"),t.classList.remove("d-none")):(t.classList.add("d-none"),t.classList.remove("d-block"))),n&&(e?(n.classList.add("d-none"),n.classList.remove("d-block")):(n.classList.add("d-block"),n.classList.remove("d-none")))}showLoading(){const e=document.querySelector('[data-component="draft-loading-overlay"]');e&&(e.classList.add("is-visible"),e.classList.remove("is-hidden"))}hideLoading(){const e=document.querySelector('[data-component="draft-loading-overlay"]');e&&(e.classList.add("is-hidden"),e.classList.remove("is-visible"))}showToast(e,t="info"){if(window.Swal){const n={success:"success",error:"error",warning:"warning",info:"info"};Swal.fire({title:e,icon:n[t]||"info",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}else window.showToast&&window.showToast(e,t)}closeModals(){document.querySelectorAll('[data-component="modal"][data-state="open"]').forEach(e=>{const t=bootstrap.Modal.getInstance(e);t&&t.hide()})}refreshDraft(){this.showLoading(),setTimeout(()=>{window.location.reload()},500)}viewPlayerProfile(e){this.socket&&this.isConnected?document.getElementById("playerProfileModal")&&(ModalManager.show("playerProfileModal"),this.socket.emit("get_player_details",{player_id:e})):this.showToast("Not connected to server","error")}handleDragStart(e,t){e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move",e.target.classList.add("opacity-50","dragging"),this.draggedPlayerId=t}handleDragEnd(e){e.target.classList.remove("opacity-50","dragging"),this.draggedPlayerId=null}handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move";const t=e.currentTarget;t.classList.add("drag-over"),"available-players"===t.id?t.classList.add("drag-over-available"):t.id&&t.id.startsWith("teamSection")?t.classList.add("drag-over-team"):t.classList.contains("team-drop-zone")&&t.classList.add("drag-over-team-zone")}handleDragLeave(e){e.currentTarget.classList.remove("drag-over","drag-over-available","drag-over-team","drag-over-team-zone")}handleDrop(e,t){var n,o;e.preventDefault();const s=e.currentTarget;s.classList.remove("drag-over","drag-over-available","drag-over-team","drag-over-team-zone");const i=e.dataTransfer.getData("text/plain")||this.draggedPlayerId;if(!i)return void this.showToast("No player data found","error");if(document.querySelector(`#teamPlayers${t} [data-player-id="${i}"]`))return void this.showToast("Player is already on this team","warning");const a=document.querySelector(`[data-player-id="${i}"]`);!a||null==(n=a.querySelector(".fw-semibold"))||n.textContent;let r=`Team ${t}`;if(s.classList.contains("team-drop-zone")){const e=s.querySelector('[data-component="team-name"]');r=e?e.textContent.trim():`Team ${t}`}else{const e=null==(o=document.querySelector(`#teamSection${t}`))?void 0:o.closest('[data-component="team-item"]'),n=e?e.querySelector('[data-component="team-name"]'):null;r=n?n.textContent.trim():`Team ${t}`}this.currentPlayerId=i,this.confirmDraft(t,r)}handleDropToAvailable(e){var t;e.preventDefault(),e.currentTarget.classList.remove("drag-over","drag-over-available","drag-over-team","drag-over-team-zone");const n=e.dataTransfer.getData("text/plain")||this.draggedPlayerId;if(!n)return void this.showToast("No player data found","error");if(document.querySelector(`#available-players [data-player-id="${n}"]`))return void this.showToast("Player is already in available pool","warning");const o=document.querySelector(`[data-player-id="${n}"]`),s=o?o.closest('[id^="teamPlayers"]'):null,i=s?s.id.replace("teamPlayers",""):null;if(!i)return void this.showToast("Could not determine current team","error");!o||null==(t=o.querySelector('[data-component="player-name"]'))||t.textContent;const a=document.querySelector(`#teamSection${i}`).closest('[data-component="team-item"]').querySelector('[data-component="team-name"]');a&&a.textContent.trim(),this.removePlayer(n,i)}async fetchPositionAnalysis(e){try{const t=await fetch(`/draft/api/${this.leagueName}/position-analysis/${e}`);return t.ok?await t.json():(console.error("Failed to fetch position analysis:",t.status),null)}catch(t){return console.error("Error fetching position analysis:",t),null}}async updatePositionHighlighting(e){if(!e)return void document.querySelectorAll('[data-component="player-card"]').forEach(e=>{e.classList.remove("highlight-strong","highlight-moderate");const t=e.querySelector('[data-component="position-fit-badge"]');t&&t.remove()});const t=await this.fetchPositionAnalysis(e);t&&t.player_fit_scores&&document.querySelectorAll('[data-component="player-card"]').forEach(e=>{const n=parseInt(e.dataset.playerId);if(!n)return;e.classList.remove("highlight-strong","highlight-moderate");const o=e.querySelector('[data-component="position-fit-badge"]');o&&o.remove();const s=t.player_fit_scores[n];if(s)if("strong"===s.fit_category){e.classList.add("highlight-strong");const t=document.createElement("span");t.className="badge-strong",t.setAttribute("data-component","position-fit-badge"),t.innerHTML='<i class="ti ti-star-filled me-1"></i>Position Fit',t.title=`${s.favorite_position} - Perfect match for team needs`,e.appendChild(t)}else if("moderate"===s.fit_category){e.classList.add("highlight-moderate");const t=document.createElement("span");t.className="badge-moderate",t.setAttribute("data-component","position-fit-badge"),t.innerHTML='<i class="ti ti-check me-1"></i>Can Play',t.title="Can play needed position",e.appendChild(t)}})}setupTeamTabHighlighting(){document.querySelectorAll('[data-bs-toggle="collapse"][data-team-id]').forEach(e=>{e.addEventListener("click",e=>{const t=parseInt(e.currentTarget.dataset.teamId);t&&setTimeout(()=>this.updatePositionHighlighting(t),100)})});const e=document.querySelector('[data-component="team-collapse"].show[data-team-id]');if(e){const t=parseInt(e.dataset.teamId);t&&this.updatePositionHighlighting(t)}}}void 0!==t&&t.exports&&(t.exports=_);class E{constructor(){this.csrfToken=null,this.init()}init(){this.setupEventListeners(),this.getCsrfToken(),this.initDragAndDrop(),console.log("Draft History Manager initialized")}getCsrfToken(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return void(this.csrfToken=e.getAttribute("content"));const t=document.cookie.split(";");for(let n of t){const[e,t]=n.trim().split("=");if("csrf_token"===e)return void(this.csrfToken=t)}console.warn("CSRF token not found")}setupEventListeners(){const e=document.getElementById("editDraftPickForm");e&&e.addEventListener("submit",e=>this.handleEditSubmit(e))}initDragAndDrop(){document.querySelectorAll(".sortable-draft-picks").forEach(e=>{const t=e.querySelectorAll(".sortable-item");t.forEach(n=>{const o=n.querySelector(".draggable-card");o.addEventListener("dragstart",t=>{n.classList.add("dragging"),e.classList.add("drag-active");const o=n.querySelector("h6").textContent,s=n.dataset.position;t.dataTransfer.setData("text/plain",n.dataset.pickId),t.dataTransfer.setData("application/x-player-name",o),t.dataTransfer.setData("application/x-current-pos",s),t.dataTransfer.effectAllowed="move";const i=n.cloneNode(!0);i.classList.add("drag-image-preview"),document.body.appendChild(i),t.dataTransfer.setDragImage(i,100,50),setTimeout(()=>{document.body.contains(i)&&document.body.removeChild(i)},0)}),o.addEventListener("dragend",o=>{n.classList.remove("dragging"),e.classList.remove("drag-active"),t.forEach(e=>e.classList.remove("drag-over"))}),n.addEventListener("dragover",e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",n.classList.contains("dragging")||n.classList.add("drag-over")}),n.addEventListener("dragleave",e=>{n.contains(e.relatedTarget)||n.classList.remove("drag-over")}),n.addEventListener("drop",t=>{t.preventDefault(),n.classList.remove("drag-over"),e.classList.remove("drag-active");const o=t.dataTransfer.getData("text/plain"),s=t.dataTransfer.getData("application/x-player-name"),i=t.dataTransfer.getData("application/x-current-pos"),a=parseInt(n.dataset.position);o&&a&&(this.showAlert("info",`Moving ${s} from position #${i} to #${a}...`),this.handleDragDrop(o,a,s))})})})}async handleDragDrop(e,t,n="Player"){try{const n={"Content-Type":"application/json"};this.csrfToken&&(n["X-CSRFToken"]=this.csrfToken);const o=await fetch(`/admin/draft-history/edit/${e}`,{method:"POST",headers:n,body:JSON.stringify({position:t,mode:"smart"})}),s=await o.json();s.success?(this.showAlert("success",`Player moved to position #${t}`),this.reloadPage()):this.showAlert("error",s.message)}catch(o){this.showAlert("error","Failed to reorder draft pick"),console.error("Error reordering draft pick:",o)}}clearFilters(){const e=new URL(window.location);e.search="",window.location.href=e.toString()}editDraftPick(e,t,n,o){document.getElementById("editPickId").value=e,document.getElementById("editPlayerName").value=o,document.getElementById("editDraftPosition").value=t,document.getElementById("editNotes").value=n||"",ModalManager.show("editDraftPickModal")}async handleEditSubmit(e){e.preventDefault();const t=document.getElementById("editPickId").value,n=parseInt(document.getElementById("editDraftPosition").value),o=document.getElementById("editNotes").value.trim();let s="smart";document.getElementById("insertMode").checked?s="insert":document.getElementById("cascadingMode").checked?s="cascading":document.getElementById("absoluteMode").checked&&(s="absolute");try{const e={"Content-Type":"application/json"};this.csrfToken&&(e["X-CSRFToken"]=this.csrfToken);const i=await fetch(`/admin/draft-history/edit/${t}`,{method:"POST",headers:e,body:JSON.stringify({position:n,notes:o,mode:s})}),a=await i.json();a.success?(this.showAlert("success",a.message),bootstrap.Modal.getInstance(document.getElementById("editDraftPickModal")).hide(),this.reloadPage()):this.showAlert("error",a.message)}catch(i){this.showAlert("error","Failed to update draft pick"),console.error("Error updating draft pick:",i)}}async deleteDraftPick(e,t,n,o){if(confirm(`Are you sure you want to delete draft pick #${t} (${n} to ${o})?\n\nThis will adjust all subsequent draft positions and cannot be undone.`))try{const t={"Content-Type":"application/json"};this.csrfToken&&(t["X-CSRFToken"]=this.csrfToken);const n=await fetch(`/admin/draft-history/delete/${e}`,{method:"DELETE",headers:t}),o=await n.json();o.success?(this.showAlert("success",o.message),this.reloadPage()):this.showAlert("error",o.message)}catch(s){this.showAlert("error","Failed to delete draft pick"),console.error("Error deleting draft pick:",s)}}async normalizeDraftPositions(e,t,n,o){if(confirm(`Fix the draft order for ${n} - ${o}?\n\nThis will renumber all positions to run 1, 2, 3, 4... with no gaps. This action cannot be undone.`))try{const n={"Content-Type":"application/json"};this.csrfToken&&(n["X-CSRFToken"]=this.csrfToken);const o=await fetch("/admin/draft-history/normalize",{method:"POST",headers:n,body:JSON.stringify({season_id:e,league_id:t})}),s=await o.json();s.success?(this.showAlert("success",s.message),this.reloadPage()):this.showAlert("error",s.message)}catch(s){this.showAlert("error","Failed to normalize draft positions"),console.error("Error normalizing draft positions:",s)}}async clearSeasonLeague(e,t,n,o){if(confirm(`Are you sure you want to clear ALL draft picks for ${n} - ${o}?\n\nThis action cannot be undone.`))try{const n={"Content-Type":"application/json"};this.csrfToken&&(n["X-CSRFToken"]=this.csrfToken);const o=await fetch("/admin/draft-history/clear",{method:"POST",headers:n,body:JSON.stringify({season_id:e,league_id:t})}),s=await o.json();s.success?(this.showAlert("success",s.message),this.reloadPage()):this.showAlert("error",s.message)}catch(s){this.showAlert("error","Failed to clear draft history"),console.error("Error clearing draft history:",s)}}showAlert(e,t){let n,o;"success"===e?(n="alert-success",o="ti-check"):"info"===e?(n="alert-info",o="ti-info-circle"):(n="alert-danger",o="ti-x");const s=`\n            <div class="alert ${n} alert-dismissible fade show" role="alert">\n                <i class="ti ${o} me-2"></i>${t}\n                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n            </div>\n        `,i=document.querySelector(".container-xxl");i&&(i.insertAdjacentHTML("afterbegin",s),setTimeout(()=>{const e=i.querySelector(".alert");e&&e.remove()},5e3))}reloadPage(){setTimeout(()=>{window.location.reload()},1e3)}initTooltips(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)})}}let C;document.addEventListener("DOMContentLoaded",function(){(document.querySelector(".sortable-draft-picks")||document.getElementById("editDraftPickForm"))&&(C=new E,C.initTooltips(),console.log("Draft History interface loaded successfully"))});class T{constructor(e,t,n){this.leagueName=e,this.teams=t,this.draftedPlayersByTeam=n,this.socket=null,this.currentDraggedPlayer=null,this.isConnected=!1,this.init()}init(){this.setupSocket(),this.setupEventListeners(),this.populateExistingPlayers(),this.setupSearch(),this.updateAllStats(),console.log("ðï¸ Pitch View System initialized")}setupSocket(){try{if(window.socket)return console.log("ðï¸ [PitchView] Reusing existing socket (connected:",window.socket.connected,")"),this.socket=window.socket,this.socket.connected&&(this.isConnected=!0,this.socket.emit("join_draft_room",{league_name:this.leagueName})),void this.setupSocketListeners();console.log("ðï¸ [PitchView] Creating new socket connection"),this.socket=io("/",{transports:["polling","websocket"],upgrade:!0,timeout:1e4,withCredentials:!0}),window.socket=this.socket,this.setupSocketListeners()}catch(e){console.error("Failed to initialize socket:",e)}}setupSocketListeners(){this.socket&&(this.socket.on("connect",()=>{console.log("â Connected to draft system"),this.isConnected=!0,this.socket.emit("join_draft_room",{league_name:this.leagueName})}),this.socket.on("disconnect",()=>{console.log("â Disconnected from draft system"),this.isConnected=!1}),this.socket.on("player_drafted_enhanced",e=>{console.log("ð¯ Player drafted:",e),this.handlePlayerDrafted(e)}),this.socket.on("player_removed_enhanced",e=>{console.log("ð¥ Player removed:",e),this.handlePlayerRemoved(e)}),this.socket.on("player_position_updated",e=>{console.log("ð Player position updated:",e),this.handlePlayerPositionUpdated(e)}),this.socket.on("error",e=>{console.error("â Socket error:",e),this.showToast("Error: "+e.message,"error")}))}setupEventListeners(){const e=document.getElementById("playerSearchPitch");e&&e.addEventListener("input",this.handleSearch.bind(this));const t=document.getElementById("positionFilterPitch");t&&t.addEventListener("change",this.handlePositionFilter.bind(this)),document.addEventListener("shown.bs.tab",e=>{if(e.target.id.includes("team-")&&e.target.id.includes("-tab")){const t=e.target.getAttribute("data-team-id");this.onTeamTabSwitch(t)}}),this.setupDragAndDropEvents()}setupDragAndDropEvents(){const e=this;document.addEventListener("dragstart",function(t){const n=t.target.closest(".js-draggable-player");if(n){const o=n.dataset.playerId;t.dataTransfer.setData("text/plain",o),t.dataTransfer.effectAllowed="move",n.classList.add("dragging"),e.currentDraggedPlayer=o}}),document.addEventListener("dragend",function(t){const n=t.target.closest(".js-draggable-player");n&&(n.classList.remove("dragging"),e.currentDraggedPlayer=null)}),document.addEventListener("dragover",function(e){const t=e.target.closest(".js-position-drop-zone");t&&(e.preventDefault(),e.dataTransfer.dropEffect="move",t.classList.add("drag-over"))}),document.addEventListener("dragleave",function(e){const t=e.target.closest(".js-position-drop-zone");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-over")}),document.addEventListener("drop",function(t){const n=t.target.closest(".js-position-drop-zone");if(n){t.preventDefault(),n.classList.remove("drag-over");const o=n.dataset.position,s=n.dataset.teamId;(t.dataTransfer.getData("text/plain")||e.currentDraggedPlayer)&&o&&s&&e.handlePositionDrop(t,o,s)}})}setupSearch(){this.updateAvailablePlayerCount()}handleSearch(e){const t=e.target.value.toLowerCase(),n=document.querySelectorAll("#availablePlayersList .player-item");let o=0;n.forEach(e=>{const n=e.getAttribute("data-player-name")||"";!t||n.includes(t)?(e.classList.remove("d-none"),e.classList.add("d-flex"),o++):(e.classList.remove("d-flex"),e.classList.add("d-none"))}),this.updateAvailablePlayerCount(o)}handlePositionFilter(e){const t=e.target.value.toLowerCase(),n=document.querySelectorAll("#availablePlayersList .player-item");let o=0;n.forEach(e=>{const n=e.getAttribute("data-position")||"";!t||n.includes(t)?(e.classList.remove("d-none"),e.classList.add("d-flex"),o++):(e.classList.remove("d-flex"),e.classList.add("d-none"))}),this.updateAvailablePlayerCount(o)}populateExistingPlayers(){Object.keys(this.draftedPlayersByTeam).forEach(e=>{this.draftedPlayersByTeam[e].forEach(t=>{const n=t.current_position||"bench";this.addPlayerToPosition(t,n,e,!1)})})}onTeamTabSwitch(e){console.log(`Switched to team ${e}`)}addPlayerToPosition(e,t,n,o=!0){const s=document.getElementById(`position-${t}-${n}`);if(!s)return void console.error(`Position container not found: position-${t}-${n}`);this.removePlayerFromAllPositions(e.id,n);const i=this.createPositionedPlayerElement(e,t,n);s.appendChild(i),this.removePlayerFromAvailable(e.id),this.updatePositionStats(n),this.updateTeamCounts(),o&&this.socket&&this.isConnected&&this.socket.emit("update_player_position",{player_id:e.id,team_id:parseInt(n),position:t,league_name:this.leagueName}),console.log(`Added ${e.name} to ${t} position in team ${n}`)}createPositionedPlayerElement(e,t,n){const o=document.createElement("div");return o.className="positioned-player newly-added",o.setAttribute("data-player-id",e.id),o.setAttribute("data-player-name",e.name),o.setAttribute("data-position",t),o.setAttribute("draggable","true"),o.setAttribute("title",e.name),o.addEventListener("dragstart",t=>this.handlePositionedPlayerDragStart(t,e.id)),o.addEventListener("dragend",e=>this.handlePositionedPlayerDragEnd(e)),e.profile_picture_url&&"/static/img/default_player.png"!==e.profile_picture_url?o.innerHTML=`\n                <img src="${e.profile_picture_url}" alt="${e.name}"\n                     class="player-profile-img"\n                     onerror="this.classList.add('d-none'); this.nextElementSibling.classList.remove('d-none');">\n                <div class="player-initials d-none">${this.getPlayerInitials(e.name)}</div>\n                <button class="remove-btn" onclick="pitchViewInstance.removePlayerFromPosition(${e.id}, '${t}', ${n})" title="Remove ${e.name}">Ã</button>\n            `:o.innerHTML=`\n                <div class="player-initials">${this.getPlayerInitials(e.name)}</div>\n                <button class="remove-btn" onclick="pitchViewInstance.removePlayerFromPosition(${e.id}, '${t}', ${n})" title="Remove ${e.name}">Ã</button>\n            `,setTimeout(()=>{o.classList.remove("newly-added")},500),o}getPlayerInitials(e){return e.split(" ").map(e=>e.charAt(0).toUpperCase()).join("").substring(0,2)}removePlayerFromPosition(e,t,n){const o=document.getElementById(`position-${t}-${n}`);if(o){const t=o.querySelector(`[data-player-id="${e}"]`);t&&(t.classList.add("removing"),setTimeout(()=>{t.remove(),this.updatePositionStats(n)},300))}this.isPlayerInTeam(e,n)||this.addPlayerBackToAvailable(e)}removePlayerFromAllPositions(e,t){["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"].forEach(n=>{const o=document.getElementById(`position-${n}-${t}`);if(o){const t=o.querySelector(`[data-player-id="${e}"]`);t&&t.remove()}})}removePlayerFromAvailable(e){const t=document.querySelector(`#availablePlayersList [data-player-id="${e}"]`);t&&(t.classList.add("removing-from-list"),setTimeout(()=>{t.remove(),this.updateAvailablePlayerCount()},300))}addPlayerBackToAvailable(e){console.log(`Should add player ${e} back to available pool`)}isPlayerInTeam(e,t){return["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"].some(n=>{const o=document.getElementById(`position-${n}-${t}`);return o&&o.querySelector(`[data-player-id="${e}"]`)})}handlePlayerDragStart(e,t){this.currentDraggedPlayer=t,e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move",e.target.classList.add("dragging")}handlePlayerDragEnd(e){this.currentDraggedPlayer=null,e.target.classList.remove("dragging")}handlePositionedPlayerDragStart(e,t){this.currentDraggedPlayer=t,e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("positioned","true"),e.target.classList.add("dragging")}handlePositionedPlayerDragEnd(e){this.currentDraggedPlayer=null,e.target.classList.remove("dragging")}handlePositionDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move",e.currentTarget.classList.add("drag-over")}handlePositionDragLeave(e){e.currentTarget.classList.remove("drag-over")}handlePositionDrop(e,t,n){e.preventDefault();const o=e.currentTarget;o.classList.remove("drag-over");const s=e.dataTransfer.getData("text/plain"),i="true"===e.dataTransfer.getData("positioned");if(!s)return void this.showToast("No player data found","error");const a=o.querySelector(".position-players").children.length,r=this.getRecommendedMax(t);a>=r&&this.showPositionWarning(t,a+1,r),i?this.movePlayerBetweenPositions(s,t,n):this.draftPlayerToPosition(s,t,n),setTimeout(()=>this.updatePositionCapacity(t,n),100)}getRecommendedMax(e){return{gk:1,lb:1,cb:2,rb:1,lwb:1,rwb:1,cdm:2,cm:2,cam:1,lw:1,rw:1,st:2,bench:999}[e.toLowerCase()]||1}showPositionWarning(e,t,n){const o=e.toUpperCase(),s=document.createElement("div");s.className="position-warning-toast",s.innerHTML=`\n            <i class="ti ti-alert-triangle text-warning me-2"></i>\n            <div>\n                <strong>${o} Position Over Capacity</strong>\n                <div class="small text-muted">Current: ${t} | Recommended: ${n}</div>\n            </div>\n        `,document.body.appendChild(s),setTimeout(()=>{s.classList.add("toast-dismissing"),setTimeout(()=>s.remove(),300)},3e3)}updatePositionCapacity(e,t){const n=document.querySelector(`[data-position="${e}"][data-team-id="${t}"]`);if(!n)return;const o=n.querySelector(".capacity-indicator");if(!o)return;const s=n.querySelectorAll(".positioned-player").length,i=this.getRecommendedMax(e),a=o.querySelector(".current");a&&(a.textContent=s),o.classList.remove("at-capacity","over-capacity"),n.classList.remove("at-capacity","over-capacity"),s===i?(o.classList.add("at-capacity"),n.classList.add("at-capacity")):s>i&&(o.classList.add("over-capacity"),n.classList.add("over-capacity"))}movePlayerBetweenPositions(e,t,n){const o=["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"];let s=null;for(const i of o){const t=document.getElementById(`position-${i}-${n}`),o=null==t?void 0:t.querySelector(`[data-player-id="${e}"]`);if(o){s={id:e,name:o.getAttribute("data-player-name")},o.remove();break}}s?(this.addPlayerToPosition(s,t,n,!0),this.showToast(`Moved ${s.name} to ${t}`,"success")):this.showToast("Player not found","error")}draftPlayerToPosition(e,t,n){const o=document.querySelector(`#availablePlayersList [data-player-id="${e}"]`);o?(o.querySelector(".player-name").textContent,this.socket&&this.isConnected?(this.showLoading(),this.socket.emit("draft_player_enhanced",{player_id:parseInt(e),team_id:parseInt(n),league_name:this.leagueName,position:t})):this.showToast("Not connected to server","error")):this.showToast("Player not found in available list","error")}handlePlayerDrafted(e){this.hideLoading();const t=e.position||"bench";this.addPlayerToPosition(e.player,t,e.team_id,!1),this.showToast(`${e.player.name} drafted to ${e.team_name}`,"success")}handlePlayerRemoved(e){this.hideLoading(),this.removePlayerFromAllPositions(e.player.id,e.team_id),this.updatePositionStats(e.team_id),this.updateTeamCounts(),this.addPlayerToAvailableList(e.player),this.showToast(`${e.player.name} removed from team`,"info")}addPlayerToAvailableList(e){const t=document.getElementById("availablePlayersList");if(!t)return;if(t.querySelector(`[data-player-id="${e.id}"]`))return;const n=document.createElement("div");n.className="pitch-player-card js-draggable-player",n.setAttribute("data-player-id",e.id),n.setAttribute("data-player-name",(e.name||"").toLowerCase()),n.setAttribute("data-position",(e.favorite_position||e.position||"").toLowerCase()),n.setAttribute("draggable","true");const o=e.profile_picture_url||"/static/img/default_player.png",s=e.favorite_position||e.position||"Any",i=e.career_goals||0,a=e.career_assists||0;n.innerHTML=`\n            <div class="pitch-player-card__avatar">\n                <img src="${o}"\n                     alt="${e.name}" class="js-player-image"\n                     data-fallback="/static/img/default_player.png"\n                     onerror="this.src='/static/img/default_player.png'">\n            </div>\n            <div class="pitch-player-card__content">\n                <div class="pitch-player-card__header">\n                    <span class="pitch-player-card__name">${e.name}</span>\n                    <span class="pitch-player-card__position">${s}</span>\n                </div>\n                <div class="pitch-player-card__stats">\n                    <span class="pitch-player-card__stat pitch-player-card__stat--goals" title="Goals">\n                        <i class="ti ti-ball-football"></i> ${i}\n                    </span>\n                    <span class="pitch-player-card__stat pitch-player-card__stat--assists" title="Assists">\n                        <i class="ti ti-shoe"></i> ${a}\n                    </span>\n                </div>\n            </div>\n            <div class="pitch-player-card__drag-handle">\n                <i class="ti ti-grip-vertical"></i>\n            </div>\n        `,n.classList.add("newly-added"),t.insertBefore(n,t.firstChild),setTimeout(()=>{n.classList.remove("newly-added")},500),this.updateAvailablePlayerCount()}handlePlayerPositionUpdated(e){this.addPlayerToPosition(e.player,e.position,e.team_id,!1)}updatePositionStats(e){Object.entries({gk:["gk"],def:["lb","cb","rb","lwb","rwb"],mid:["cdm","cm","cam"],fwd:["lw","rw","st"],bench:["bench"]}).forEach(([t,n])=>{let o=0;n.forEach(t=>{const n=document.getElementById(`position-${t}-${e}`);n&&(o+=n.querySelectorAll(".positioned-player").length)});const s=document.getElementById(`${t}-count-${e}`);s&&(s.textContent=o)}),["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"].forEach(t=>{const n=document.getElementById(`position-${t}-${e}`);if(n){const e=n.querySelectorAll(".positioned-player").length,t=n.closest(".position-zone");if(t){const n=t.querySelector(".position-count");n&&(n.textContent=`(${e})`)}}})}updateAllStats(){this.teams.forEach(e=>{this.updatePositionStats(e.id)}),this.updateTeamCounts()}updateTeamCounts(){this.teams.forEach(e=>{const t=this.getTotalPlayersInTeam(e.id),n=document.getElementById(`teamPitchCount${e.id}`);n&&(n.textContent=t)})}getTotalPlayersInTeam(e){return["gk","lb","cb","rb","lwb","rwb","cdm","cm","cam","lw","rw","st","bench"].reduce((t,n)=>{const o=document.getElementById(`position-${n}-${e}`);return t+(o?o.children.length:0)},0)}updateAvailablePlayerCount(e=null){null===e&&(e=document.querySelectorAll("#availablePlayersList .player-item:not(.d-none)").length);const t=document.getElementById("availablePlayerCount");t&&(t.textContent=e)}showLoading(){const e=document.getElementById("loadingOverlay");e&&(e.classList.remove("d-none"),e.classList.add("d-flex"))}hideLoading(){const e=document.getElementById("loadingOverlay");e&&(e.classList.remove("d-flex"),e.classList.add("d-none"))}showToast(e,t="info"){if(window.Swal){const n={success:"success",error:"error",warning:"warning",info:"info"};Swal.fire({title:e,icon:n[t]||"info",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}else console.log(`${t.toUpperCase()}: ${e}`)}}var x,L;function k(e,t){let n;return"goal_scorers"===e?n="goalScorersContainer-"+t:"assist_providers"===e?n="assistProvidersContainer-"+t:"yellow_cards"===e?n="yellowCardsContainer-"+t:"red_cards"===e?n="redCardsContainer-"+t:"own_goals"===e&&(n="ownGoalsContainer-"+t),n}function I(e,t){let n=k(t,e),o=n.split("Container-")[0],s=[],i=o;return"yellowCards"===o?i="yellow_cards":"redCards"===o?i="red_cards":"goalScorers"===o?i="goalScorers":"assistProviders"===o&&(i="assistProviders"),$(`#${n}`).find(".player-event-entry.to-be-removed").each(function(){const e=$(this).find(`input[name="${i}-stat_id[]"]`).val();e&&""!==e.trim()&&s.push(e)}),s}function A(e,t){let n=[],o=k(t,e),s=o.split("Container-")[0],i=s;return"yellowCards"===s?i="yellow_cards":"redCards"===s?i="red_cards":"goalScorers"===s?i="goalScorers":"assistProviders"===s&&(i="assistProviders"),"own_goals"===t?$(`#${o}`).find(".own-goal-event-entry:not(.to-be-removed)").each(function(){let e=$(this).find('input[name="own_goals-stat_id[]"]').val(),t=$(this).find('select[name="own_goals-team_id[]"]').val(),o=$(this).find('input[name="own_goals-minute[]"]').val(),s=$(this).attr("data-unique-id");t&&n.push({stat_id:e||"",team_id:t,minute:o||"",unique_id:s})}):$(`#${o}`).find(".player-event-entry:not(.to-be-removed)").each(function(){let e=$(this).find(`input[name="${i}-stat_id[]"]`).val(),t=$(this).find(`select[name="${i}-player_id[]"]`).val(),o=$(this).find(`input[name="${i}-minute[]"]`).val(),s=$(this).attr("data-unique-id");t&&(e=e?String(e):null,t=t?String(t):null,o=o?String(o):null,n.push({unique_id:s,stat_id:e,player_id:t,minute:o}))}),n}function D(e,t){return!(e.element&&e.element.classList&&e.element.classList.contains("to-be-removed"))&&(e.stat_id?t.some(t=>t.stat_id&&String(t.stat_id)===String(e.stat_id)):!!e.unique_id&&t.some(t=>String(t.unique_id)===String(e.unique_id)))}function M(e,t){return t.some(t=>e.stat_id&&t.stat_id?e.stat_id===t.stat_id:e.unique_id&&t.unique_id?e.unique_id===t.unique_id:e.team_id===t.team_id&&e.minute===t.minute)}function P(){try{for(var e=document.querySelectorAll("[data-dropdown]:not(.c-navbar-modern__actions [data-dropdown])"),t=0;t<e.length;t++)e[t].classList.add("dt-dropdown");for(var n=document.querySelectorAll('[data-container="table"], [data-container="card"], [data-container="tab"], div.dataTables_wrapper'),s=0;s<n.length;s++)n[s].classList.add("dt-container-visible")}catch(o){}}function B(){try{if(window.jQuery){var e=window.jQuery;window.bootstrap&&[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e,{delay:{show:200,hide:100}})}),e("#smsMessage").on("input",function(){try{var t=e(this).val().length;e("#smsCharCount").text(t),t>160?e("#smsCharCount").addClass("text-danger fw-bold"):e("#smsCharCount").removeClass("text-danger fw-bold")}catch(o){}}),e("#discordMessage").on("input",function(){try{var t=e(this).val().length;e("#discordCharCount").text(t),t>2e3?e("#discordCharCount").addClass("text-danger fw-bold"):e("#discordCharCount").removeClass("text-danger fw-bold")}catch(o){}}),e("#sendSmsForm").on("submit",function(t){t.preventDefault();try{if(e("#smsMessage").val().length>160)return window.toastr&&toastr.warning("Your message exceeds the 160 character limit for SMS. Please shorten your message."),!1;var n=new FormData(this),o=e(this).find('button[type="submit"]'),s=o.html();o.prop("disabled",!0).html('<i class="ti ti-loader ti-spin me-1"></i>Sending...'),fetch(this.action,{method:"POST",body:n,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){if(e.success){window.toastr&&toastr.success("SMS sent successfully.");var t=document.querySelector('[data-modal="send-sms"]');window.bootstrap&&t&&bootstrap.Modal.getInstance(t).hide()}else window.toastr&&toastr.error(e.message||"Error sending SMS.")}).catch(function(e){window.toastr&&toastr.error("An error occurred while sending SMS.")}).finally(function(){o.prop("disabled",!1).html(s)})}catch(i){}}),e("#sendDiscordDmForm").on("submit",function(t){t.preventDefault();try{if(e("#discordMessage").val().length>2e3)return window.toastr&&toastr.warning("Your message exceeds the 2000 character limit for Discord. Please shorten your message."),!1;var n=new FormData(this),o=e(this).find('button[type="submit"]'),s=o.html();o.prop("disabled",!0).html('<i class="ti ti-loader ti-spin me-1"></i>Sending...'),fetch(this.action,{method:"POST",body:n,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){if(e.success){window.toastr&&toastr.success("Discord DM sent successfully.");var t=document.querySelector('[data-modal="send-discord-dm"]');window.bootstrap&&t&&bootstrap.Modal.getInstance(t).hide()}else window.toastr&&toastr.error(e.message||"Error sending Discord DM.")}).catch(function(e){window.toastr&&toastr.error("An error occurred while sending Discord DM.")}).finally(function(){o.prop("disabled",!1).html(s)})}catch(i){}})}}catch(o){}}function q(){try{document.querySelectorAll("table.dataTable thead th.sorting, table.dataTable thead th.sorting_asc, table.dataTable thead th.sorting_desc").forEach(function(e){var t=window.getComputedStyle(e,"::before"),n=window.getComputedStyle(e,"::after");t.content,n.content})}catch(o){}}void 0!==t&&t.exports&&(t.exports=T),function(){const e={CONFIG:{MOBILE_BREAKPOINT:768,TABLET_BREAKPOINT:992,TOAST_DURATION_MOBILE:3e3,TOAST_DURATION_DESKTOP:5e3,FETCH_TIMEOUT_MOBILE:1e4,FETCH_TIMEOUT_DESKTOP:3e4,DEBOUNCE_WAIT:250},_initialized:!1,_autoRefreshInterval:null,init:function(e){e=e||document,this._initialized&&e===document||(this.initMobileNavigation(e),this.initAdminNavToggle(e),this.initTouchGestures(e),this.initProgressiveLoading(e),this.initResponsiveTables(e),this.initNetworkMonitoring(),this.initAutoRefreshManagement(),this.initPerformanceMonitoring(),this.initDoubleTapPrevention(e),this.initSmoothScrolling(e),this.initIOSBouncePrevent(),e===document&&(this._initialized=!0))},initMobileNavigation:function(e){const t=(e=e||document).querySelectorAll("[data-nav-link], .navbar-nav .nav-link"),n=e.querySelector("[data-navbar-collapse], .navbar-collapse");t.forEach(e=>{"true"!==e.dataset.navEnhanced&&(e.dataset.navEnhanced="true",e.addEventListener("click",()=>{if(window.innerWidth<this.CONFIG.TABLET_BREAKPOINT&&n&&n.classList.contains("show")){const e=bootstrap.Collapse.getInstance(n);e&&e.hide()}}))})},initAdminNavToggle:function(e){const t=(e=e||document).querySelector('[data-action="toggle-mobile-nav"]'),n=e.querySelector("[data-nav-container]");t&&n&&"true"!==t.dataset.adminNavToggleEnhanced&&(t.dataset.adminNavToggleEnhanced="true",t.addEventListener("click",()=>{n.classList.contains("is-collapsed")?(n.classList.remove("is-collapsed"),t.setAttribute("aria-expanded","true")):(n.classList.add("is-collapsed"),t.setAttribute("aria-expanded","false"))}))},initTouchGestures:function(e){(e=e||document).querySelectorAll('[data-component="admin-card"]').forEach(e=>{if("true"===e.dataset.gesturesEnhanced)return;e.dataset.gesturesEnhanced="true";let t=0;e.addEventListener("touchstart",e=>{t=e.touches[0].clientY},{passive:!0}),e.addEventListener("touchend",n=>{const o=n.changedTouches[0].clientY,s=t-o;Math.abs(s)>50&&s>0&&e.click()},{passive:!0})})},initProgressiveLoading:function(e){if(e=e||document,"IntersectionObserver"in window){const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("loaded"),e.target.dataset.loaded="true",t.unobserve(e.target))})},{rootMargin:"50px"});e.querySelectorAll("[data-lazy-load]").forEach(e=>{"true"!==e.dataset.loaded&&t.observe(e)})}},initResponsiveTables:function(e){e=e||document;const t=this;function n(){e.querySelectorAll("[data-responsive-table], .table-responsive").forEach(e=>{const n="TABLE"===e.tagName?e:e.querySelector("table");if(n)if(window.innerWidth<t.CONFIG.MOBILE_BREAKPOINT){const e=n.querySelectorAll("th");n.querySelectorAll("tbody tr").forEach(t=>{t.querySelectorAll("td").forEach((t,n)=>{e[n]&&t.setAttribute("data-label",e[n].textContent)})}),window.innerWidth<576&&(n.classList.add("table-mobile-stack"),n.dataset.mobileStack="true")}else n.classList.remove("table-mobile-stack"),n.dataset.mobileStack="false"})}n(),window.addEventListener("resize",this.debounce(n,this.CONFIG.DEBOUNCE_WAIT))},initNetworkMonitoring:function(){if(this._networkMonitoringSetup)return;this._networkMonitoringSetup=!0;const e=this;function t(){const t=document.querySelector('[data-component="network-status"]');t&&(navigator.onLine?(t.classList.remove("c-admin-panel-base__network-status--offline"),t.classList.add("c-admin-panel-base__network-status--online"),t.dataset.status="online",t.title="Online"):(t.classList.remove("c-admin-panel-base__network-status--online"),t.classList.add("c-admin-panel-base__network-status--offline"),t.dataset.status="offline",t.title="Offline",e.showMobileToast("You are currently offline. Some features may not work.","warning")))}window.addEventListener("online",()=>{t(),e.showMobileToast("Connection restored","success")}),window.addEventListener("offline",t),t()},initAutoRefreshManagement:function(){if(this._autoRefreshSetup)return;this._autoRefreshSetup=!0;const e=this;function t(){window.innerWidth<e.CONFIG.MOBILE_BREAKPOINT&&e._autoRefreshInterval&&(clearInterval(e._autoRefreshInterval),console.log("Auto-refresh disabled on mobile for battery optimization"))}window.addEventListener("resize",this.debounce(t,this.CONFIG.DEBOUNCE_WAIT)),t()},initPerformanceMonitoring:function(){if(this._performanceMonitoringSetup)return;this._performanceMonitoringSetup=!0;const e=this;if("PerformanceObserver"in window){const t=new PerformanceObserver(t=>{t.getEntries().forEach(t=>{if("navigation"===t.entryType){const n=t.loadEventEnd-t.loadEventStart;console.log("Page load time:",n+"ms"),n>3e3&&window.innerWidth<e.CONFIG.MOBILE_BREAKPOINT&&console.warn("Slow page load detected on mobile")}})});try{t.observe({entryTypes:["navigation"]})}catch(o){console.log("Performance observer not fully supported")}}},initDoubleTapPrevention:function(e){(e=e||document).querySelectorAll('[data-action]:not([data-action="toggle-dropdown"]):not([data-action="navigate"]), button:not(.c-admin-nav__link):not(.c-admin-nav__dropdown-toggle), .c-btn:not(.c-admin-nav__link), input, select, textarea').forEach(e=>{"true"!==e.dataset.doubleTapPrevented&&(e.closest('[data-controller="admin-nav"]')||(e.dataset.doubleTapPrevented="true",e.addEventListener("touchend",function(e){this.disabled||(e.preventDefault(),this.click())},{passive:!1}),e.addEventListener("click",function(e){e.detail>1&&e.preventDefault()})))})},initSmoothScrolling:function(e){(e=e||document).querySelectorAll('a[href^="#"]').forEach(e=>{"true"!==e.dataset.smoothScrollEnhanced&&(e.dataset.smoothScrollEnhanced="true",e.addEventListener("click",function(e){const t=this.getAttribute("href");if(t&&"#"!==t){e.preventDefault();try{const e=document.querySelector(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}catch(n){console.debug("Invalid anchor selector:",t)}}}))})},initIOSBouncePrevent:function(){this._iosBouncePreventSetup||(this._iosBouncePreventSetup=!0,document.body.addEventListener("touchstart",function(e){e.target===document.body&&e.preventDefault()},{passive:!1}),document.body.addEventListener("touchend",function(e){e.target===document.body&&e.preventDefault()},{passive:!1}),document.body.addEventListener("touchmove",function(e){e.target===document.body&&e.preventDefault()},{passive:!1}))},debounce:function(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...o)},t)}},isMobile:function(){return window.innerWidth<this.CONFIG.MOBILE_BREAKPOINT},isTablet:function(){return window.innerWidth>=this.CONFIG.MOBILE_BREAKPOINT&&window.innerWidth<this.CONFIG.TABLET_BREAKPOINT},isDesktop:function(){return window.innerWidth>=this.CONFIG.TABLET_BREAKPOINT},showMobileToast:function(e,t){t=t||"info";const n=document.createElement("div");n.className=`toast align-items-center text-white bg-${t} border-0`,n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),n.dataset.toast=t,n.innerHTML=`\n                <div class="d-flex">\n                    <div class="toast-body">${e}</div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" data-action="close-toast" aria-label="Close"></button>\n                </div>\n            `;const o=document.querySelector('[data-component="toast-container"]');o&&(o.appendChild(n),new bootstrap.Toast(n,{autohide:!0,delay:this.isMobile()?this.CONFIG.TOAST_DURATION_MOBILE:this.CONFIG.TOAST_DURATION_DESKTOP}).show(),n.addEventListener("hidden.bs.toast",()=>{n.remove()}))},confirmAction:function(e,t,n){n=n||{};const o=e.toLowerCase();let s="Confirm",i="question",a="Confirm Action",r="#3085d6";o.includes("delete")||o.includes("remove")?(s="Delete",i="warning",a="Confirm Delete",r="#dc3545"):o.includes("sync")?(s="Sync",i="question",a="Confirm Sync"):o.includes("reset")?(s="Reset",i="warning",a="Confirm Reset",r="#dc3545"):o.includes("clear")?(s="Clear",i="warning",a="Confirm Clear",r="#dc3545"):o.includes("approve")?(s="Approve",i="question",a="Confirm Approval",r="#28a745"):o.includes("reject")||o.includes("deny")?(s="Reject",i="warning",a="Confirm Rejection",r="#dc3545"):o.includes("send")?(s="Send",i="question",a="Confirm Send"):o.includes("save")?(s="Save",i="question",a="Confirm Save",r="#28a745"):o.includes("cancel")?(s="Yes, Cancel",i="warning",a="Confirm Cancellation"):o.includes("disable")?(s="Disable",i="warning",a="Confirm Disable",r="#dc3545"):o.includes("enable")?(s="Enable",i="question",a="Confirm Enable",r="#28a745"):o.includes("continue")&&(s="Continue");const c=n.confirmText||s,l=n.cancelText||"Cancel",d=n.title||a,u=n.icon||i,m=n.confirmColor||r;this.isMobile()?confirm(e)&&t():"undefined"!=typeof Swal?Swal.fire({title:d,text:e,icon:u,showCancelButton:!0,confirmButtonText:c,cancelButtonText:l,confirmButtonColor:m,cancelButtonColor:"#6c757d",reverseButtons:!0}).then(e=>{e.isConfirmed&&t()}):confirm(e)&&t()},showLoading:function(e){e&&(e.classList.add("is-loading"),e.dataset.loading="true")},hideLoading:function(e){e&&(e.classList.remove("is-loading"),e.dataset.loading="false")},fetch:async function(e,t){t=t||{};const n=this,o=new AbortController,s=setTimeout(()=>o.abort(),n.isMobile()?n.CONFIG.FETCH_TIMEOUT_MOBILE:n.CONFIG.FETCH_TIMEOUT_DESKTOP);try{const n=await fetch(e,{...t,signal:o.signal});return clearTimeout(s),n}catch(i){throw clearTimeout(s),"AbortError"===i.name?n.showMobileToast("Request timed out. Please try again.","warning"):navigator.onLine||n.showMobileToast("No internet connection. Please check your network.","danger"),i}}};function t(){"serviceWorker"in navigator&&"caches"in window&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/static/js/service-worker.js").then(e=>{console.log("Service Worker registered:",e)}).catch(e=>{console.log("Service Worker registration failed:",e)})})}void 0!==window.InitSystem?window.InitSystem.register("AdminPanelBase",{priority:15,init:function(n){e.init(n),t()}}):document.addEventListener("DOMContentLoaded",function(){e.init(document),t()}),window.AdminPanel=e,window.AdminPanelBase=e}(),function(){function e(){document.querySelector('.admin-panel-dashboard, [data-page="admin-dashboard"]')&&("undefined"!=typeof EventDelegation?(EventDelegation.register("navigate",t),EventDelegation.register("open-navigation-settings",n,{preventDefault:!0}),EventDelegation.register("open-registration-settings",o,{preventDefault:!0}),EventDelegation.register("open-task-monitor",s,{preventDefault:!0}),EventDelegation.register("open-database-monitor",i,{preventDefault:!0}),EventDelegation.register("open-match-reports",a,{preventDefault:!0}),EventDelegation.register("generate-report",r,{preventDefault:!0})):console.warn("[AdminDashboard] EventDelegation not available, skipping handler registration"),function(){const e=window.location.pathname;document.querySelectorAll(".nav-pills .nav-link").forEach(t=>{e.includes(t.getAttribute("href"))&&t.classList.add("active")})}(),document.querySelectorAll('[data-action="navigate"]').forEach(e=>{e.style.cursor="pointer"}),console.log("[AdminDashboard] Initialized"))}function t(e){const t=e.dataset.url;t&&(window.location.href=t)}function n(){"undefined"!=typeof Swal?(Swal.fire({title:"Navigation Settings",html:'<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Loading navigation settings...</p></div>',showConfirmButton:!1,allowOutsideClick:!1}),fetch("/admin-panel/api/navigation-settings").then(e=>e.json()).then(e=>{e.success?function(e){const t=`\n      <div class="text-start">\n        <p class="text-info mb-3"><i class="ti ti-info-circle me-1"></i>Control which navigation items are visible to non-admin users. Admins can always see all navigation items.</p>\n\n        <div class="row">\n          <div class="col-md-6">\n            ${c("teamsNav","Teams Navigation","Team rosters and management for pl-premier, pl-classic roles",e.teams_navigation_enabled)}\n            ${c("storeNav","Store Navigation","League store for coaches and admins",e.store_navigation_enabled)}\n            ${c("matchesNav","Matches Navigation","Match schedules and results",e.matches_navigation_enabled)}\n            ${c("leaguesNav","Leagues Navigation","League standings and information",e.leagues_navigation_enabled)}\n          </div>\n          <div class="col-md-6">\n            ${c("draftsNav","Drafts Navigation","Draft system for coaches",e.drafts_navigation_enabled)}\n            ${c("playersNav","Players Navigation","Player profiles and statistics",e.players_navigation_enabled)}\n            ${c("messagingNav","Messaging Navigation","Communication tools",e.messaging_navigation_enabled)}\n            ${c("mobileFeaturesNav","Mobile Features Navigation","Mobile app integration",e.mobile_features_navigation_enabled)}\n          </div>\n        </div>\n      </div>\n    `;Swal.fire({title:"Navigation Settings",html:t,width:"800px",showCancelButton:!0,confirmButtonText:"Save Settings",cancelButtonText:"Cancel",showLoaderOnConfirm:!0,preConfirm:()=>function(){const e={teams_navigation_enabled:document.getElementById("teamsNav").checked,store_navigation_enabled:document.getElementById("storeNav").checked,matches_navigation_enabled:document.getElementById("matchesNav").checked,leagues_navigation_enabled:document.getElementById("leaguesNav").checked,drafts_navigation_enabled:document.getElementById("draftsNav").checked,players_navigation_enabled:document.getElementById("playersNav").checked,messaging_navigation_enabled:document.getElementById("messagingNav").checked,mobile_features_navigation_enabled:document.getElementById("mobileFeaturesNav").checked};return fetch("/admin-panel/api/navigation-settings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":l()},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message);return e})}(),allowOutsideClick:()=>!Swal.isLoading()}).then(e=>{e.isConfirmed&&Swal.fire({title:"Settings Saved!",text:"Navigation settings have been updated successfully. Changes will take effect immediately.",icon:"success"}).then(()=>{location.reload()})})}(e.settings):Swal.fire("Error",e.message||"Failed to load navigation settings","error")}).catch(e=>{console.error("Navigation settings error:",e),Swal.fire("Error","Failed to load navigation settings","error")})):alert("SweetAlert2 is required for this feature")}function o(){"undefined"!=typeof Swal?(Swal.fire({title:"Registration Settings",html:'<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Loading registration settings...</p></div>',showConfirmButton:!1,allowOutsideClick:!1}),fetch("/admin-panel/api/registration-settings").then(e=>e.json()).then(e=>{e.success?function(e,t){const n=t.map(t=>`<option value="${t.name}" ${e.default_user_role===t.name?"selected":""}>${t.name}</option>`).join(""),o=`\n      <div class="text-start">\n        <p class="text-info mb-3"><i class="ti ti-info-circle me-1"></i>Configure registration settings based on your actual onboarding flow. Discord OAuth is the primary login method.</p>\n\n        <div class="row">\n          <div class="col-md-6">\n            <h6 class="text-primary mb-3">Registration Control</h6>\n            ${c("registrationEnabled","Allow New Registration","Enable/disable new user registration",e.registration_enabled)}\n            ${c("waitlistEnabled","Enable Waitlist","Allow waitlist registration when full",e.waitlist_registration_enabled)}\n            ${c("adminApproval","Admin Approval Required","All new users need admin approval",e.admin_approval_required)}\n            ${c("discordOnly","Discord Only Login","Only Discord OAuth allowed (FIXED)",!0,!0)}\n\n            <div class="mb-3">\n              <label class="form-label">Default User Role</label>\n              <select class="form-select" id="defaultRole">\n                ${n}\n              </select>\n              <small class="text-muted">Role assigned to new registered users</small>\n            </div>\n          </div>\n          <div class="col-md-6">\n            <h6 class="text-primary mb-3">Registration Fields</h6>\n            ${c("requireRealName","Require Real Name","",e.require_real_name)}\n            ${c("requireEmail","Require Email","",e.require_email)}\n            ${c("requirePhone","Require Phone Number","",e.require_phone)}\n            ${c("requireLocation","Require Location","",e.require_location)}\n            ${c("requireJerseySize","Require Jersey Size","",e.require_jersey_size)}\n            ${c("requirePositions","Require Position Preferences","",e.require_position_preferences)}\n            ${c("requireAvailability","Require Availability Info","",e.require_availability)}\n            ${c("requireReferee","Require Referee Willingness","",e.require_referee_willingness)}\n          </div>\n        </div>\n        <div class="alert alert-info mt-3">\n          <small><i class="ti ti-info-circle me-1"></i>These settings reflect your real onboarding form fields. Discord OAuth is your primary authentication method.</small>\n        </div>\n      </div>\n    `;Swal.fire({title:"Registration Settings",html:o,width:"900px",showCancelButton:!0,confirmButtonText:"Save Settings",cancelButtonText:"Cancel",showLoaderOnConfirm:!0,preConfirm:()=>function(){const e={registration_enabled:document.getElementById("registrationEnabled").checked,waitlist_registration_enabled:document.getElementById("waitlistEnabled").checked,admin_approval_required:document.getElementById("adminApproval").checked,discord_only_login:!0,default_user_role:document.getElementById("defaultRole").value,require_real_name:document.getElementById("requireRealName").checked,require_email:document.getElementById("requireEmail").checked,require_phone:document.getElementById("requirePhone").checked,require_location:document.getElementById("requireLocation").checked,require_jersey_size:document.getElementById("requireJerseySize").checked,require_position_preferences:document.getElementById("requirePositions").checked,require_availability:document.getElementById("requireAvailability").checked,require_referee_willingness:document.getElementById("requireReferee").checked};return fetch("/admin-panel/api/registration-settings",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":l()},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message);return e})}(),allowOutsideClick:()=>!Swal.isLoading()}).then(e=>{e.isConfirmed&&Swal.fire({title:"Settings Saved!",text:"Registration settings have been updated successfully. Changes will affect new registrations immediately.",icon:"success"})})}(e.settings,e.available_roles):Swal.fire("Error",e.message||"Failed to load registration settings","error")}).catch(e=>{console.error("Registration settings error:",e),Swal.fire("Error","Failed to load registration settings","error")})):alert("SweetAlert2 is required for this feature")}function s(){"undefined"!=typeof Swal?(Swal.fire({title:"Task Monitor",html:'<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Loading task information...</p></div>',width:"800px",showConfirmButton:!1,allowOutsideClick:!1}),fetch("/admin-panel/api/task-monitor").then(e=>e.json()).then(e=>{!function(e){let t="";e.tasks&&e.tasks.length>0?e.tasks.forEach(e=>{const n="active"===e.status?"success":"secondary";t+=`\n          <tr>\n            <td>${e.name}</td>\n            <td><span class="badge bg-${n}">${e.status}</span></td>\n            <td>${e.started||"-"}</td>\n            <td>${e.worker||"-"}</td>\n            <td class="text-truncate">${e.args||"-"}</td>\n          </tr>\n        `}):t='<tr><td colspan="5" class="text-center text-muted">No active tasks found</td></tr>';const n=`\n      <div class="text-start">\n        <div class="row mb-3">\n          <div class="col-md-4">\n            <div class="card bg-success text-white">\n              <div class="card-body text-center">\n                <h4>${e.active_count||0}</h4>\n                <small>Active Tasks</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-4">\n            <div class="card bg-warning text-white">\n              <div class="card-body text-center">\n                <h4>${e.scheduled_count||0}</h4>\n                <small>Scheduled Tasks</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-4">\n            <div class="card bg-info text-white">\n              <div class="card-body text-center">\n                <h4>${e.worker_count||0}</h4>\n                <small>Workers</small>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="table-responsive">\n          <table class="table table-sm">\n            <thead>\n              <tr>\n                <th>Task Name</th>\n                <th>Status</th>\n                <th>Started</th>\n                <th>Worker</th>\n                <th>Arguments</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${t}\n            </tbody>\n          </table>\n        </div>\n        ${e.message?`<div class="alert alert-info"><small>${e.message}</small></div>`:""}\n        <p class="text-muted mt-3"><small>Task monitoring shows real-time background processes and scheduled jobs.</small></p>\n      </div>\n    `;Swal.fire({title:"Task Monitor",html:n,width:"900px",confirmButtonText:"Close"})}(e)}).catch(e=>{console.error("Error loading task monitor:",e),Swal.fire("Error","Failed to load task monitor data","error")})):alert("SweetAlert2 is required for this feature")}function i(){"undefined"!=typeof Swal?(Swal.fire({title:"Database Monitor",html:'<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Loading system information...</p></div>',width:"900px",showConfirmButton:!1,allowOutsideClick:!1}),fetch("/admin-panel/api/system-status").then(e=>e.json()).then(e=>{!function(e){const t=`\n      <div class="text-start">\n        <div class="row mb-3">\n          <div class="col-md-3">\n            <div class="card bg-info text-white">\n              <div class="card-body text-center">\n                <h4>${e.system.cpu_percent}%</h4>\n                <small>CPU Usage</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-3">\n            <div class="card bg-success text-white">\n              <div class="card-body text-center">\n                <h4>${e.system.memory_percent}%</h4>\n                <small>Memory Usage</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-3">\n            <div class="card bg-primary text-white">\n              <div class="card-body text-center">\n                <h4>${e.services.database.response_time_ms}ms</h4>\n                <small>DB Response Time</small>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-3">\n            <div class="card bg-${"online"===e.services.redis.status?"success":"danger"} text-white">\n              <div class="card-body text-center">\n                <h4>${e.services.redis.response_time_ms}ms</h4>\n                <small>Redis Response</small>\n              </div>\n            </div>\n          </div>\n        </div>\n        <p class="text-muted mt-3"><small>Real-time system monitoring data updated at ${new Date(e.timestamp).toLocaleString()}.</small></p>\n      </div>\n    `;Swal.fire({title:"System Monitor",html:t,width:"900px",confirmButtonText:"Close"})}(e)}).catch(e=>{console.error("Error loading database monitor:",e),Swal.fire("Error","Failed to load system monitor data","error")})):alert("SweetAlert2 is required for this feature")}function a(){"undefined"!=typeof Swal?Swal.fire({title:"Match Reports",html:'\n        <div class="text-start">\n          <p class="text-info mb-3"><i class="ti ti-info-circle me-1"></i>Generate comprehensive match reports with various options.</p>\n          <div class="alert alert-warning">\n            <strong>Note:</strong> This feature is currently in development. Report generation will be available soon.\n          </div>\n        </div>\n      ',width:"600px",confirmButtonText:"Close"}):alert("SweetAlert2 is required for this feature")}function r(){console.log("Generate report functionality coming soon")}function c(e,t,n,o,s=!1){return`\n      <div class="mb-3">\n        <div class="form-check form-switch">\n          <input class="form-check-input" type="checkbox" id="${e}" ${o?"checked":""} ${s?"disabled":""}>\n          <label class="form-check-label" for="${e}">\n            <strong>${t}</strong>\n            ${n?`<br><small class="text-muted">${n}</small>`:""}\n          </label>\n        </div>\n      </div>\n    `}function l(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const t=document.querySelector('input[name="csrf_token"]');return t?t.value:(console.error("CSRF token not found"),"")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}(),function(){const e={botApiUrl:"http://localhost:5001/api/bot",recentLogs:null,commands:null,commandUsage:null,guildInfo:null};async function t(){(await Swal.fire({title:"Restart Discord Bot?",text:"This will temporarily disconnect the bot from Discord while it restarts.",icon:"warning",showCancelButton:!0,confirmButtonText:"Restart Bot"})).isConfirmed&&Swal.fire({title:"Restarting Bot...",text:"Please wait while the bot restarts",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading(),fetch(`${e.botApiUrl}/restart`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Restarted!","Discord bot restart has been initiated.","success"):Swal.fire("Error!",`Failed to restart bot: ${e.message||"Unknown error"}`,"error")}).catch(e=>{console.error("Error restarting bot:",e),Swal.fire("Error!","Failed to connect to bot API.","error")})}})}async function n(){Swal.fire({title:"Running Health Check...",text:"Checking bot connectivity and status",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading(),fetch(`${e.botApiUrl}/health-detailed`).then(e=>e.json()).then(e=>{if("online"===e.status){const t=`\n              <div class="text-start">\n                <p><strong>Status:</strong> ${e.status}</p>\n                <p><strong>Username:</strong> ${e.username||"Unknown"}</p>\n                <p><strong>Guild Count:</strong> ${e.guild_count||0}</p>\n                <p><strong>Latency:</strong> ${e.latency||"N/A"}ms</p>\n                ${e.memory_usage_mb?`<p><strong>Memory Usage:</strong> ${e.memory_usage_mb}MB</p>`:""}\n              </div>\n            `;Swal.fire({title:"Bot Health Check",html:t,icon:"success",confirmButtonText:"Close"})}else Swal.fire("Bot Offline",`Bot status: ${e.status}. ${e.details||""}`,"warning")}).catch(e=>{console.error("Error checking bot health:",e),Swal.fire("Connection Error","Failed to connect to bot API.","error")})}})}function o(){let t="";const n=e.recentLogs;n&&n.length>0?n.forEach(e=>{const n=new Date(e.timestamp).toLocaleString();t+=`[${n}] ${e.level}: ${e.message}\n`}):t="No recent logs available. Bot may not be connected to the API.",Swal.fire({title:"Discord Bot Logs",html:`\n        <div class="bot-logs-container" style="max-height: 400px; overflow-y: auto; text-align: left;">\n          <pre style="font-family: var(--font-mono); font-size: 0.875rem; white-space: pre-wrap;">${t}</pre>\n        </div>\n      `,showCancelButton:!0,confirmButtonText:"Refresh Logs",cancelButtonText:"Close",width:"700px"}).then(e=>{e.isConfirmed&&location.reload()})}async function s(){(await Swal.fire({title:"Sync Commands?",text:"This will synchronize all slash commands with Discord.",icon:"question",showCancelButton:!0,confirmButtonText:"Sync Commands"})).isConfirmed&&Swal.fire({title:"Syncing Commands...",text:"Please wait while commands are synchronized",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading(),fetch(`${e.botApiUrl}/sync-commands`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Synced!",`${e.commands_synced||"All"} commands have been synchronized with Discord.`,"success"):Swal.fire("Error!",`Failed to sync commands: ${e.message||"Unknown error"}`,"error")}).catch(e=>{console.error("Error syncing commands:",e),Swal.fire("Error!","Failed to connect to bot API.","error")})}})}function i(){const t=e.commands;let n="";const o={};t.forEach(e=>{o[e.category]||(o[e.category]=[]),o[e.category].push(e)}),Object.keys(o).forEach(e=>{n+=`\n        <div class="mb-4">\n          <h6 class="mb-2 text-primary">${e} Commands</h6>\n          <div class="table-responsive">\n            <table class="table table-sm table-hover">\n              <thead class="table-light">\n                <tr>\n                  <th>Command</th>\n                  <th>Description</th>\n                  <th>Permission</th>\n                </tr>\n              </thead>\n              <tbody>\n      `,o[e].forEach(e=>{const t="Public"===e.permission_level?"success":e.permission_level.includes("Admin")?"danger":"warning";n+=`\n          <tr>\n            <td><code>/${e.name}</code></td>\n            <td>${e.description}</td>\n            <td><span class="badge bg-${t}">${e.permission_level}</span></td>\n          </tr>\n        `}),n+="\n              </tbody>\n            </table>\n          </div>\n        </div>\n      "}),Swal.fire({title:"Discord Bot Commands",html:`\n        <div class="command-list-container" style="max-height: 500px; overflow-y: auto;">\n          ${n}\n        </div>\n      `,confirmButtonText:"Close",width:"800px"})}function a(){Swal.fire("Command Permissions","Command permissions management interface would appear here.","info")}function r(){const t=e.commandUsage;Swal.fire({title:"Command Usage Statistics",html:`\n        <div class="command-usage-stats" style="text-align: left;">\n          <div class="row mb-3">\n            <div class="col-md-6">\n              <div class="card bg-primary text-white">\n                <div class="card-body text-center">\n                  <h4>${t.commands_today||0}</h4>\n                  <small>Commands Today</small>\n                </div>\n              </div>\n            </div>\n            <div class="col-md-6">\n              <div class="card bg-info text-white">\n                <div class="card-body text-center">\n                  <h4>${t.commands_this_week||0}</h4>\n                  <small>Commands This Week</small>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class="row">\n            <div class="col-md-6">\n              <h6>Most Used Command</h6>\n              <p><code>/${t.most_used_command||"N/A"}</code></p>\n            </div>\n            <div class="col-md-6">\n              <h6>Average Response Time</h6>\n              <p>${t.avg_response_time||"N/A"}</p>\n            </div>\n          </div>\n        </div>\n      `,confirmButtonText:"Close",width:"700px"})}function c(){Swal.fire("Custom Commands","Custom commands management interface would appear here.","info")}function l(e,t){const n=e.dataset.guild;Swal.fire("Guild Management",`Guild management interface for ${n} would appear here.`,"info")}function d(t,n){const o=e.guildInfo;Swal.fire({title:`${o.name||"Guild"} Statistics`,html:`\n        <div class="guild-stats-container" style="text-align: left;">\n          <div class="row mb-3">\n            <div class="col-md-4">\n              <div class="card bg-primary text-white">\n                <div class="card-body text-center">\n                  <h4>${o.member_count||0}</h4>\n                  <small>Total Members</small>\n                </div>\n              </div>\n            </div>\n            <div class="col-md-4">\n              <div class="card bg-success text-white">\n                <div class="card-body text-center">\n                  <h4>${o.channel_count||0}</h4>\n                  <small>Channels</small>\n                </div>\n              </div>\n            </div>\n            <div class="col-md-4">\n              <div class="card bg-info text-white">\n                <div class="card-body text-center">\n                  <h4>${o.role_count||0}</h4>\n                  <small>Roles</small>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      `,confirmButtonText:"Close",width:"700px"})}function u(){Swal.fire({title:"Add Bot to Server",html:'\n        <div class="add-guild-container">\n          <p>To add the ECS FC Discord bot to another server, you need administrator permissions on that server.</p>\n          <div class="alert alert-info">\n            <i class="ti ti-info-circle me-2"></i>\n            Click the button below to authorize the bot for a new server.\n          </div>\n          <div class="mt-4">\n            <h6>Required Permissions:</h6>\n            <ul class="small" style="text-align: left;">\n              <li>Manage Roles</li>\n              <li>Send Messages</li>\n              <li>Read Message History</li>\n              <li>Manage Channels</li>\n              <li>Use Application Commands</li>\n            </ul>\n          </div>\n        </div>\n      ',showConfirmButton:!1,showCloseButton:!0})}async function m(){var t,n,o,s,i,a,r;const c={prefix:(null==(t=document.getElementById("botPrefix"))?void 0:t.value)||"!",default_role:(null==(n=document.getElementById("defaultRole"))?void 0:n.value)||"",activity_type:(null==(o=document.getElementById("activityType"))?void 0:o.value)||"playing",activity_text:(null==(s=document.getElementById("activityText"))?void 0:s.value)||"ECS FC League",auto_moderation:(null==(i=document.getElementById("autoModeration"))?void 0:i.checked)||!1,command_logging:(null==(a=document.getElementById("commandLogging"))?void 0:a.checked)||!1,welcome_messages:(null==(r=document.getElementById("welcomeMessages"))?void 0:r.checked)||!1};Swal.fire({title:"Saving Configuration...",text:"Please wait while the configuration is being saved",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}});try{const t=await fetch(`${e.botApiUrl}/config`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),n=await t.json();n.success?Swal.fire("Saved!","Bot configuration has been updated successfully.","success"):Swal.fire("Error!",`Failed to save configuration: ${n.error||"Unknown error"}`,"error")}catch(l){console.error("Error saving bot config:",l),Swal.fire("Error!","Failed to connect to bot API. Please check if the bot is running.","error")}}function h(){const e=document.getElementById("botPrefix"),t=document.getElementById("defaultRole"),n=document.getElementById("activityType"),o=document.getElementById("activityText"),s=document.getElementById("autoModeration"),i=document.getElementById("commandLogging"),a=document.getElementById("welcomeMessages");e&&(e.value="!"),t&&(t.value=""),n&&(n.value="playing"),o&&(o.value="ECS FC League"),s&&(s.checked=!0),i&&(i.checked=!0),a&&(a.checked=!0),Swal.fire("Reset!","Configuration has been reset to defaults.","info")}function p(){(document.querySelector('[data-page="admin-discord-bot"]')||document.querySelector(".admin-discord-bot")||window.location.pathname.includes("discord-bot"))&&(e.recentLogs=window.__BOT_RECENT_LOGS__||[],e.commands=window.__BOT_COMMANDS__||[],e.commandUsage=window.__BOT_COMMAND_USAGE__||{},e.guildInfo=window.__BOT_GUILD_INFO__||{},"undefined"!=typeof EventDelegation&&(EventDelegation.register("restart-bot",t,{preventDefault:!0}),EventDelegation.register("check-bot-health",n,{preventDefault:!0}),EventDelegation.register("view-bot-logs",o,{preventDefault:!0}),EventDelegation.register("sync-commands",s,{preventDefault:!0}),EventDelegation.register("view-commands",i,{preventDefault:!0}),EventDelegation.register("command-permissions",a,{preventDefault:!0}),EventDelegation.register("command-usage",r,{preventDefault:!0}),EventDelegation.register("custom-commands",c,{preventDefault:!0}),EventDelegation.register("manage-guild",l,{preventDefault:!0}),EventDelegation.register("guild-stats",d,{preventDefault:!0}),EventDelegation.register("add-guild",u,{preventDefault:!0}),EventDelegation.register("save-bot-config",m,{preventDefault:!0}),EventDelegation.register("reset-bot-config",h,{preventDefault:!0})),async function(){try{const t=await fetch(`${e.botApiUrl}/config`),n=await t.json();if(n.success&&n.config){const e=n.config,t=document.getElementById("botPrefix"),o=document.getElementById("defaultRole"),s=document.getElementById("activityType"),i=document.getElementById("activityText"),a=document.getElementById("autoModeration"),r=document.getElementById("commandLogging"),c=document.getElementById("welcomeMessages");t&&(t.value=e.prefix||"!"),o&&(o.value=e.default_role||""),s&&(s.value=e.activity_type||"playing"),i&&(i.value=e.activity_text||"ECS FC League"),a&&(a.checked=!1!==e.auto_moderation),r&&(r.checked=!1!==e.command_logging),c&&(c.checked=!1!==e.welcome_messages)}}catch(t){console.log("Could not load bot configuration:",t)}}(),console.log("Discord Bot Management initialized"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):p()}(),function(){let e,t,n,o=!0;function s(){(document.querySelector('[data-page="admin-performance"]')||document.querySelector(".admin-performance")||window.location.pathname.includes("performance"))&&(function(){const e=document.querySelector("[data-perf-data]");if(!e)return;const o=parseFloat(e.dataset.dbAvgQueryTime||0),s=parseInt(e.dataset.cacheActive||0),i=parseInt(e.dataset.cacheExpired||0),a=document.querySelector('[data-chart="query-performance"]');a&&(t=new Chart(a.getContext("2d"),{type:"line",data:{labels:["5min ago","4min ago","3min ago","2min ago","1min ago","Now"],datasets:[{label:"Avg Query Time (ms)",data:[1e3*o,1e3*o*.9,1e3*o*1.1,1e3*o*.8,1e3*o*1.2,1e3*o],borderColor:d("--color-primary")||"#0d6efd",backgroundColor:"rgba(13, 110, 253, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Time (ms)"}}},plugins:{legend:{display:!1}}}}));const r=document.querySelector('[data-chart="cache-usage"]');r&&(n=new Chart(r.getContext("2d"),{type:"doughnut",data:{labels:["Active","Expired"],datasets:[{data:[s,i],backgroundColor:[d("--color-success")||"#198754",d("--color-danger")||"#dc3545"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}))}(),"undefined"!=typeof EventDelegation&&(EventDelegation.register("toggle-auto-refresh",i,{preventDefault:!0}),EventDelegation.register("clear-cache",a,{preventDefault:!0})),r())}function i(){o=!o;const t=document.querySelector('[data-status="auto-refresh"]');o?(t&&(t.textContent="ON"),r()):(t&&(t.textContent="OFF"),clearInterval(e))}function a(e){if(!confirm("Are you sure you want to clear all cache?"))return e.preventDefault(),!1}function r(){e&&clearInterval(e),e=setInterval(c,3e4)}function c(){o&&fetch("/admin_panel/performance/api/metrics").then(e=>e.json()).then(e=>{if(e.success){const i=e.data;l("query-time",(1e3*i.database.avg_query_time).toFixed(1)+"ms"),l("slow-queries",i.database.slow_queries),l("cache-hits",i.cache.active_entries),l("cache-size",i.cache.cache_size_mb.toFixed(1)+"MB");const a=document.querySelector("[data-timestamp]");a&&(a.textContent=new Date(i.timestamp).toLocaleString()),function(e){const t=document.querySelector('[data-live-value="slow-queries"]');t&&(t.className="c-perf-realtime__value",e.database.slow_queries>5?t.classList.add("c-perf-realtime__value--danger"):e.database.slow_queries>2?t.classList.add("c-perf-realtime__value--warning"):t.classList.add("c-perf-realtime__value--success"));const n=document.querySelector('[data-live-value="cache-size"]');n&&(n.className="c-perf-realtime__value",e.cache.cache_size_mb>50?n.classList.add("c-perf-realtime__value--warning"):n.classList.add("c-perf-realtime__value--secondary"))}(i),t&&function(e){if(!t)return;const n=t.data.datasets[0].data;n.shift(),n.push(e),t.update()}(1e3*i.database.avg_query_time),n&&(o=i.cache.active_entries,s=i.cache.expired_entries,n&&(n.data.datasets[0].data=[o,s],n.update()))}var o,s}).catch(e=>{console.error("Error updating metrics:",e)})}function l(e,t){const n=document.querySelector(`[data-live-value="${e}"]`);n&&(n.textContent=t)}function d(e){const t=getComputedStyle(document.documentElement).getPropertyValue(e);return t?t.trim():null}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s()}(),function(){const e={dockerStatusContainer:"#dockerStatusContainer",taskManagementContainer:"#taskManagementContainer",toastContainer:"#toastContainer",roleSelect:"#role_id",permissionsSelect:"#permissions",currentPermissionsList:"#current-permissions-list",dockerLogsContent:"#dockerLogsContent",dockerLogsModalLabel:"#dockerLogsModalLabel",actions:{refreshContainers:"refresh-containers",openTaskManagement:"open-task-management",refreshTaskList:"refresh-task-list",cleanupOldTasks:"cleanup-old-tasks",loadTaskManagement:"load-task-management",showLogs:"show-logs",containerAction:"container-action",revokeTask:"revoke-task",viewTaskDetails:"view-task-details",removeTask:"remove-task",closeModal:"close-modal"}},t={dockerStatus:"/admin/docker-status",dockerLogs:"/admin/docker-logs/",dockerAction:"/admin/docker-",taskManagement:"/admin/task-management",taskDetails:"/admin/task-details/",revokeTask:"/admin/revoke-task/",removeTask:"/admin/remove-task/",cleanupTasks:"/admin/cleanup-tasks",rolePermissions:"/admin/role-permissions/"},n={init:function(e=document){console.log("[AdminDashboard] Initializing..."),this.initEventDelegation(e),this.initPermissionsTab(e),this.initDockerStatus(e),console.log("[AdminDashboard] Initialized")},initEventDelegation:function(t){t.addEventListener("click",t=>{var n;const o=t.target.closest("[data-action]");if(o)switch(o.dataset.action){case e.actions.refreshContainers:t.preventDefault(),this.handleRefreshContainers(o);break;case e.actions.openTaskManagement:t.preventDefault(),this.openTaskManagement();break;case e.actions.refreshTaskList:this.refreshTaskList();break;case e.actions.cleanupOldTasks:this.cleanupOldTasks();break;case e.actions.loadTaskManagement:this.loadTaskManagement();break;case e.actions.showLogs:this.showLogs(o.dataset.containerName);break;case e.actions.containerAction:this.containerAction(o.dataset.containerName,o.dataset.containerActionType,o);break;case e.actions.revokeTask:this.revokeTask(o.dataset.taskId);break;case e.actions.viewTaskDetails:this.viewTaskDetails(o.dataset.taskId);break;case e.actions.removeTask:this.removeTask(o.dataset.taskId);break;case e.actions.closeModal:(null==(n=window.ModernComponents)?void 0:n.Modal)&&o.dataset.modalId&&window.ModernComponents.Modal.close(o.dataset.modalId)}})},handleRefreshContainers:function(e){e.classList.add("is-loading"),e.disabled=!0,this.fetchDockerStatus().finally(()=>{e.classList.remove("is-loading"),e.disabled=!1})},initPermissionsTab:function(t){const n=t.querySelector(e.roleSelect),o=t.querySelector(e.permissionsSelect),s=t.querySelector(e.currentPermissionsList);o&&"undefined"!=typeof $&&$.fn.select2&&$(o).select2({theme:"bootstrap-5",placeholder:"Select permissions...",allowClear:!0,width:"100%"}),n&&n.addEventListener("change",()=>{const e=n.value;e?this.fetchRolePermissions(e,o,s):(s&&(s.innerHTML='<li class="c-permissions-list__item c-permissions-list__item--empty">Select a role to view permissions.</li>'),o&&($(o).hasClass("select2-hidden-accessible")?$(o).val([]).trigger("change"):Array.from(o.options).forEach(e=>e.selected=!1)))})},fetchRolePermissions:function(e,n,o){fetch(`${t.rolePermissions}${e}`).then(e=>e.json()).then(e=>{if(e.success){if(this.updateCurrentPermissionsList(e.permissions,o),n){const t=e.permissions.map(e=>e.id.toString());$(n).hasClass("select2-hidden-accessible")?$(n).val(t).trigger("change"):Array.from(n.options).forEach(e=>{e.selected=t.includes(e.value)})}}else o.innerHTML='<li class="c-permissions-list__item c-permissions-list__item--error">Error loading permissions</li>'}).catch(e=>{console.error("Error fetching role permissions:",e),o.innerHTML='<li class="c-permissions-list__item c-permissions-list__item--error">Error loading permissions</li>'})},updateCurrentPermissionsList:function(e,t){if(t)if(0===e.length)t.innerHTML='<li class="c-permissions-list__item c-permissions-list__item--empty">No permissions assigned.</li>';else{const n=e.map(e=>`<li class="c-permissions-list__item">${e.name}</li>`).join("");t.innerHTML=n}},initDockerStatus:function(t){t.querySelector(e.dockerStatusContainer)&&this.fetchDockerStatus()},fetchDockerStatus:async function(){const n=document.querySelector(e.dockerStatusContainer);if(n)try{const e=await fetch(t.dockerStatus),o=await e.json();o.success&&o.containers?this.renderContainers(o.containers):n.innerHTML=`\n                        <div class="col-12">\n                            <div class="c-empty-state c-empty-state--warning">\n                                <i class="ti ti-alert-triangle c-empty-state__icon"></i>\n                                <p class="c-empty-state__text">${o.error||"Unable to load container status"}</p>\n                            </div>\n                        </div>\n                    `}catch(o){console.error("Error fetching Docker status:",o),n.innerHTML='\n                    <div class="col-12">\n                        <div class="c-empty-state c-empty-state--error">\n                            <i class="ti ti-alert-circle c-empty-state__icon"></i>\n                            <p class="c-empty-state__text">Failed to load container status</p>\n                        </div>\n                    </div>\n                '}},renderContainers:function(t){const n=document.querySelector(e.dockerStatusContainer);if(!n)return;if(0===t.length)return void(n.innerHTML='\n                    <div class="col-12">\n                        <div class="c-empty-state">\n                            <i class="ti ti-info-circle c-empty-state__icon"></i>\n                            <p class="c-empty-state__text">No containers found</p>\n                        </div>\n                    </div>\n                ');const o=t.map(e=>{const t="running"===e.status?"success":"danger",n="running"===e.status?"ti-check":"ti-x";return`\n                    <div class="col-xl-4 col-lg-6 mb-3">\n                        <div class="c-container-card" data-component="container-card" data-container-name="${e.name}">\n                            <div class="c-container-card__header">\n                                <div class="c-container-card__info">\n                                    <h6 class="c-container-card__name">${e.name}</h6>\n                                    <small class="c-container-card__image">${e.image}</small>\n                                </div>\n                                <span class="c-badge c-badge--${t}">\n                                    <i class="ti ${n}"></i>\n                                    <span>${e.status}</span>\n                                </span>\n                            </div>\n\n                            <div class="c-container-card__body">\n                                <div class="c-container-card__stat">\n                                    <small class="c-container-card__stat-label">Uptime:</small>\n                                    <small class="c-container-card__stat-value">${e.uptime||"N/A"}</small>\n                                </div>\n                                <div class="c-container-card__stat">\n                                    <small class="c-container-card__stat-label">CPU:</small>\n                                    <small class="c-container-card__stat-value">${e.cpu_usage||"N/A"}</small>\n                                </div>\n                                <div class="c-container-card__stat">\n                                    <small class="c-container-card__stat-label">Memory:</small>\n                                    <small class="c-container-card__stat-value">${e.memory_usage||"N/A"}</small>\n                                </div>\n                            </div>\n\n                            <div class="c-container-card__actions">\n                                ${"running"===e.status?`<button class="btn btn-outline-warning btn-sm" data-action="container-action" data-container-name="${e.name}" data-container-action-type="restart">\n                                        <i class="ti ti-refresh"></i> <span>Restart</span>\n                                    </button>\n                                    <button class="btn btn-outline-danger btn-sm" data-action="container-action" data-container-name="${e.name}" data-container-action-type="stop">\n                                        <i class="ti ti-stop"></i> <span>Stop</span>\n                                    </button>`:`<button class="btn btn-outline-success btn-sm" data-action="container-action" data-container-name="${e.name}" data-container-action-type="start">\n                                        <i class="ti ti-play"></i> <span>Start</span>\n                                    </button>`}\n                                <button class="btn btn-outline-primary btn-sm" data-action="show-logs" data-container-name="${e.name}" title="View Logs">\n                                    <i class="ti ti-file-text"></i>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `}).join("");n.innerHTML=o},showLogs:async function(n){var o;const s=document.querySelector(e.dockerLogsContent),i=document.querySelector(e.dockerLogsModalLabel);i&&(i.textContent=`${n} - Logs`),s&&(s.textContent="Loading logs..."),(null==(o=window.ModernComponents)?void 0:o.Modal)&&window.ModernComponents.Modal.open("dockerLogsModal");try{const e=await fetch(`${t.dockerLogs}${n}`),o=await e.json();o.success?s&&(s.textContent=o.logs||"No logs available"):s&&(s.textContent=`Error: ${o.error||"Failed to load logs"}`)}catch(a){console.error("Error fetching logs:",a),s&&(s.textContent="Error loading logs")}},containerAction:async function(e,n,o){if(o){o.classList.add("is-loading"),o.disabled=!0;try{const s=await fetch(`${t.dockerAction}${n}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(s.ok)this.showComponentToast("success","Success",`Container ${n}ed successfully`),setTimeout(()=>this.fetchDockerStatus(),1e3);else{const e=await s.json();this.showComponentToast("error","Error",e.error||`Failed to ${n} container`),o.classList.remove("is-loading"),o.disabled=!1}}catch(s){console.error(`Error during ${n}:`,s),this.showComponentToast("error","Error",`Failed to ${n} container`),o.classList.remove("is-loading"),o.disabled=!1}}},openTaskManagement:function(){this.loadTaskManagement();const t=document.querySelector(e.taskManagementContainer);t&&t.scrollIntoView({behavior:"smooth"})},loadTaskManagement:function(){const t=document.querySelector(e.taskManagementContainer);t&&(t.innerHTML='\n                <div class="text-center py-4">\n                    <div class="c-loading-spinner" role="status"></div>\n                    <p class="c-loading-text">Loading task management...</p>\n                </div>\n            ',this.fetchTaskList())},fetchTaskList:async function(){const n=document.querySelector(e.taskManagementContainer);if(n)try{const e=await fetch(t.taskManagement),o=await e.json();o.success?this.renderTaskManagement(o):n.innerHTML=`\n                        <div class="alert alert-warning" role="alert">\n                            <i class="ti ti-alert-triangle me-2"></i>\n                            ${o.error||"Unable to load task management"}\n                        </div>\n                    `}catch(o){console.error("Error fetching task management:",o),n.innerHTML='\n                    <div class="alert alert-danger" role="alert">\n                        <i class="ti ti-alert-circle me-2"></i>\n                        Failed to load task management\n                    </div>\n                '}},renderTaskManagement:function(t){var n,o,s;const i=document.querySelector(e.taskManagementContainer);if(!i)return;const a=t.statistics||{},r=t.active_tasks||[],c=`\n                <div class="row mb-4">\n                    <div class="col-md-3">\n                        <div class="c-stat-card c-stat-card--primary">\n                            <div class="c-stat-card__value">${a.total_active||0}</div>\n                            <div class="c-stat-card__label">Active Tasks</div>\n                            <div class="c-stat-card__icon"><i class="ti ti-activity"></i></div>\n                        </div>\n                    </div>\n                    <div class="col-md-3">\n                        <div class="c-stat-card c-stat-card--success">\n                            <div class="c-stat-card__value">${(null==(n=a.by_status)?void 0:n.SUCCESS)||0}</div>\n                            <div class="c-stat-card__label">Completed</div>\n                            <div class="c-stat-card__icon"><i class="ti ti-check"></i></div>\n                        </div>\n                    </div>\n                    <div class="col-md-3">\n                        <div class="c-stat-card c-stat-card--danger">\n                            <div class="c-stat-card__value">${(null==(o=a.by_status)?void 0:o.FAILURE)||0}</div>\n                            <div class="c-stat-card__label">Failed</div>\n                            <div class="c-stat-card__icon"><i class="ti ti-x"></i></div>\n                        </div>\n                    </div>\n                    <div class="col-md-3">\n                        <div class="c-stat-card c-stat-card--warning">\n                            <div class="c-stat-card__value">${(null==(s=a.by_status)?void 0:s.PENDING)||0}</div>\n                            <div class="c-stat-card__label">Pending</div>\n                            <div class="c-stat-card__icon"><i class="ti ti-clock"></i></div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="c-table-wrapper">\n                    <table class="c-table c-table--hover c-table--striped">\n                        <thead class="c-table__head">\n                            <tr>\n                                <th class="c-table__header">Task ID</th>\n                                <th class="c-table__header">Type</th>\n                                <th class="c-table__header">User</th>\n                                <th class="c-table__header">Status</th>\n                                <th class="c-table__header">Progress</th>\n                                <th class="c-table__header">Created</th>\n                                <th class="c-table__header">Actions</th>\n                            </tr>\n                        </thead>\n                        <tbody class="c-table__body">\n                            ${r.length>0?r.map(e=>this.renderTaskRow(e)).join(""):'<tr><td colspan="7" class="text-center c-text-muted py-4">No active tasks</td></tr>'}\n                        </tbody>\n                    </table>\n                </div>\n            `;i.innerHTML=c},renderTaskRow:function(e){const t=this.getStatusColor(e.celery_state||e.status);return`\n                <tr class="c-table__row ${"REVOKED"===e.celery_state?"is-muted":""}">\n                    <td class="c-table__cell" data-label="Task ID">\n                        <code class="c-code">${e.task_id.substring(0,8)}...</code>\n                        ${"REVOKED"===e.celery_state?'<small class="c-text-muted">CANCELLED</small>':""}\n                    </td>\n                    <td class="c-table__cell" data-label="Type">\n                        <span class="c-badge c-badge--secondary">${e.task_type||"unknown"}</span>\n                    </td>\n                    <td class="c-table__cell" data-label="User">${e.user_id||"N/A"}</td>\n                    <td class="c-table__cell" data-label="Status">\n                        <span class="c-badge c-badge--${t}">\n                            ${e.celery_state||e.status||"UNKNOWN"}\n                        </span>\n                    </td>\n                    <td class="c-table__cell" data-label="Progress">\n                        <div class="c-progress">\n                            <div class="c-progress__bar c-progress__bar--${t}"\n                                 role="progressbar"\n                                 aria-valuenow="${e.progress||0}"\n                                 aria-valuemin="0" aria-valuemax="100"\n                                 style="width: ${e.progress||0}%">\n                                ${e.progress||0}%\n                            </div>\n                        </div>\n                        ${e.stage?`<small class="c-text-muted">${e.stage}</small>`:""}\n                    </td>\n                    <td class="c-table__cell" data-label="Created">\n                        <small>${e.created_at?new Date(e.created_at).toLocaleString():"N/A"}</small>\n                    </td>\n                    <td class="c-table__cell" data-label="Actions">\n                        <div class="c-button-group c-button-group--sm">\n                            ${["PENDING","PROGRESS","STARTED"].includes(e.celery_state)?`<button class="btn btn-outline-danger btn-sm" data-action="revoke-task" data-task-id="${e.task_id}" title="DESTROY Task (Nuclear Option)">\n                                    <i class="ti ti-bomb"></i>\n                                </button>`:""}\n                            ${["REVOKED","FAILURE","SUCCESS"].includes(e.celery_state)?`<button class="btn btn-outline-secondary btn-sm" data-action="remove-task" data-task-id="${e.task_id}" title="Remove from List">\n                                    <i class="ti ti-trash"></i> <span>Clear</span>\n                                </button>`:""}\n                            <button class="btn btn-outline-primary btn-sm" data-action="view-task-details" data-task-id="${e.task_id}" title="View Details">\n                                <i class="ti ti-eye"></i>\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n            `},getStatusColor:function(e){return{SUCCESS:"success",FAILURE:"danger",PENDING:"warning",STARTED:"primary",PROGRESS:"primary",REVOKED:"dark"}[e]||"light"},revokeTask:async function(e){if((await Swal.fire({title:"DESTROY Task?",html:'\n                    <div class="text-start">\n                        <p class="text-warning"><strong>â ï¸ WARNING: Nuclear Option</strong></p>\n                        <p>This will completely <strong>DESTROY</strong> the task:</p>\n                        <ul class="text-start">\n                            <li>Terminate the running process</li>\n                            <li>Remove all Redis data</li>\n                            <li>Purge from all tracking systems</li>\n                            <li>Cannot be undone</li>\n                        </ul>\n                        <p class="text-danger"><strong>Are you absolutely sure?</strong></p>\n                    </div>\n                ',icon:"warning",showCancelButton:!0,confirmButtonColor:this.getThemeColor("danger","#dc3545"),cancelButtonColor:this.getThemeColor("secondary","#6c757d"),confirmButtonText:"ð¥ DESTROY IT",cancelButtonText:"No, keep it",width:"500px"})).isConfirmed)try{const n=await fetch(`${t.revokeTask}${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCsrfToken()}}),o=await n.json();o.success?(Swal.fire({title:"DESTROYED! ð¥",text:"The task has been completely obliterated.",icon:"success",timer:3e3,showConfirmButton:!1}),setTimeout(()=>this.refreshTaskList(),1e3)):Swal.fire({title:"Error!",text:o.error||"Failed to destroy task",icon:"error"})}catch(n){console.error("Error destroying task:",n),Swal.fire({title:"Error!",text:"Failed to destroy task",icon:"error"})}},viewTaskDetails:async function(e){try{const n=await fetch(`${t.taskDetails}${e}`),o=await n.json();if(o.success){const e=o.task,t=`\n                        <div class="text-start">\n                            <p><strong>Task ID:</strong> <code>${e.task_id}</code></p>\n                            <p><strong>Type:</strong> <span class="c-badge c-badge--secondary">${e.task_type||"N/A"}</span></p>\n                            <p><strong>Status:</strong> <span class="c-badge c-badge--${this.getStatusColor(e.celery_state||e.status)}">${e.celery_state||e.status||"N/A"}</span></p>\n                            <p><strong>Progress:</strong> ${e.progress||0}%</p>\n                            <p><strong>Stage:</strong> ${e.stage||"N/A"}</p>\n                            <p><strong>Created:</strong> ${e.created_at?new Date(e.created_at).toLocaleString():"N/A"}</p>\n                            ${e.message?`<p><strong>Message:</strong> ${e.message}</p>`:""}\n                        </div>\n                    `;Swal.fire({title:"Task Details",html:t,icon:"info",width:"600px",confirmButtonText:"Close"})}else Swal.fire({title:"Error!",text:o.error||"Failed to load task details",icon:"error"})}catch(n){console.error("Error fetching task details:",n),Swal.fire({title:"Error!",text:"Failed to load task details",icon:"error"})}},removeTask:async function(e){if((await Swal.fire({title:"Remove Task?",text:"This will remove the task from the list. Are you sure?",icon:"question",showCancelButton:!0,confirmButtonColor:this.getThemeColor("secondary","#6c757d"),cancelButtonColor:this.getThemeColor("danger","#dc3545"),confirmButtonText:"Yes, remove it",cancelButtonText:"Cancel"})).isConfirmed)try{const n=await fetch(`${t.removeTask}${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCsrfToken()}}),o=await n.json();o.success?(Swal.fire({title:"Removed!",text:"The task has been removed from the list.",icon:"success",timer:2e3,showConfirmButton:!1}),setTimeout(()=>this.refreshTaskList(),500)):Swal.fire({title:"Error!",text:o.error||"Failed to remove task",icon:"error"})}catch(n){console.error("Error removing task:",n),Swal.fire({title:"Error!",text:"Failed to remove task",icon:"error"})}},cleanupOldTasks:async function(){if((await Swal.fire({title:"Cleanup Old Tasks?",html:'\n                    <div class="text-start">\n                        <p>This will remove:</p>\n                        <ul class="text-start">\n                            <li>TaskManager entries older than 24 hours</li>\n                            <li>Celery metadata older than 7 days</li>\n                            <li>Improves Redis performance</li>\n                        </ul>\n                        <p class="text-muted"><small>Recent tasks will be preserved</small></p>\n                    </div>\n                ',icon:"question",showCancelButton:!0,confirmButtonColor:this.getThemeColor("warning","#ffc107"),cancelButtonColor:this.getThemeColor("secondary","#6c757d"),confirmButtonText:"ð§¹ Clean Up",cancelButtonText:"Cancel"})).isConfirmed)try{const e=await fetch(t.cleanupTasks,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCsrfToken()}}),n=await e.json();n.success?(Swal.fire({title:"Cleanup Complete! ð§¹",html:`\n                            <div class="text-start">\n                                <p><strong>Cleaned up:</strong></p>\n                                <ul>\n                                    <li>Registry: ${n.registry_cleaned} tasks</li>\n                                    <li>Metadata: ${n.metadata_cleaned} keys</li>\n                                    <li><strong>Total: ${n.total_cleaned} items</strong></li>\n                                </ul>\n                            </div>\n                        `,icon:"success",timer:4e3,showConfirmButton:!1}),setTimeout(()=>this.refreshTaskList(),1e3)):Swal.fire({title:"Error!",text:n.error||"Failed to cleanup tasks",icon:"error"})}catch(e){console.error("Error cleaning up tasks:",e),Swal.fire({title:"Error!",text:"Failed to cleanup tasks",icon:"error"})}},refreshTaskList:function(){this.fetchTaskList()},getCsrfToken:function(){var e,t;return(null==(e=document.querySelector('input[name="csrf_token"]'))?void 0:e.value)||(null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.getAttribute("content"))||""},getThemeColor:function(e,t){return"undefined"!=typeof ECSTheme&&ECSTheme.getColor?ECSTheme.getColor(e):t},showComponentToast:function(e,t,n){var o;(null==(o=window.ModernComponents)?void 0:o.Toast)&&window.ModernComponents.Toast.show({type:e,title:t,message:n,duration:5e3})},showToast:function(t,n,o){const s=document.querySelector(e.toastContainer);if(!s)return;const i="toast-"+Date.now(),a=`\n                <div id="${i}" class="toast align-items-center border-0 bg-${o} text-white" role="alert" aria-live="assertive" aria-atomic="true">\n                    <div class="d-flex">\n                        <div class="toast-body">\n                            <strong>${t}:</strong> ${n}\n                        </div>\n                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                    </div>\n                </div>\n            `;s.insertAdjacentHTML("beforeend",a);const r=document.getElementById(i);r&&"undefined"!=typeof bootstrap&&(new bootstrap.Toast(r,{autohide:!0,delay:5e3}).show(),r.addEventListener("hidden.bs.toast",function(){r.remove()}))}};void 0!==window.InitSystem?window.InitSystem.register("AdminDashboard",{priority:50,init:function(e){n.init(e)}}):document.addEventListener("DOMContentLoaded",function(){n.init(document)}),window.AdminDashboard=n}(),function(){function e(e,t,n){const o=document.getElementById("edit_category_id"),s=document.getElementById("edit_category_name"),i=document.getElementById("edit_category_description");o&&(o.value=e),s&&(s.value=t),i&&(i.value=n||""),document.getElementById("editCategoryModal")&&ModalManager.show("editCategoryModal")}function t(e,t,n,o){Swal.fire({title:"Delete Category?",text:`Are you sure you want to delete "${t}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("info"):"#3085d6",confirmButtonText:"Yes, delete it!"}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=n;const s=document.createElement("input");s.type="hidden",s.name="csrf_token",s.value=o;const i=document.createElement("input");i.type="hidden",i.name="category_id",i.value=e,t.appendChild(s),t.appendChild(i),document.body.appendChild(t),t.submit()}})}function n(t){e(t.target.dataset.categoryId,t.target.dataset.categoryName,t.target.dataset.categoryDescription)}function o(e){t(e.target.dataset.categoryId,e.target.dataset.categoryName,e.target.dataset.deleteUrl,e.target.dataset.csrfToken)}function s(){document.getElementById("editCategoryModal")&&(console.log("[Message Categories] Initializing..."),"undefined"!=typeof EventDelegation?(EventDelegation.register("edit-category",n,{preventDefault:!0}),EventDelegation.register("delete-category",o,{preventDefault:!0})):console.error("[Message Categories] EventDelegation not available"),console.log("[Message Categories] Initialization complete"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s(),window.MessageCategories={version:"1.0.0",editCategory:e,deleteCategory:t,init:s}}(),function(){function e(e,t,n){const o=document.getElementById("view_template_title"),s=document.getElementById("view_template_content");o&&(o.textContent=t),s&&(s.textContent=n),document.getElementById("viewTemplateModal")&&ModalManager.show("viewTemplateModal")}function t(e,t,n,o,s,i,a){const r=document.getElementById("edit_template_id"),c=document.getElementById("edit_template_name"),l=document.getElementById("edit_template_description"),d=document.getElementById("edit_template_content"),u=document.getElementById("edit_channel_type"),m=document.getElementById("edit_usage_context"),h=document.getElementById("edit_template_active");r&&(r.value=e),c&&(c.value=t),l&&(l.value=n||""),d&&(d.value=o),u&&(u.value=s||""),m&&(m.value=i||""),h&&(h.checked=a),document.getElementById("editTemplateModal")&&ModalManager.show("editTemplateModal")}function n(e,t,n,o,s){const i=n?"deactivate":"activate",a=!n;Swal.fire({title:`${i.charAt(0).toUpperCase()+i.slice(1)} Template?`,text:`Are you sure you want to ${i} "${t}"?`,icon:"question",showCancelButton:!0,confirmButtonColor:a?getComputedStyle(document.documentElement).getPropertyValue("--ecs-success").trim()||"#198754":getComputedStyle(document.documentElement).getPropertyValue("--ecs-warning").trim()||"#ffc107",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):getComputedStyle(document.documentElement).getPropertyValue("--ecs-neutral-50").trim()||"#6c757d",confirmButtonText:`Yes, ${i} it!`}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=o;const n=document.createElement("input");n.type="hidden",n.name="csrf_token",n.value=s;const i=document.createElement("input");i.type="hidden",i.name="template_id",i.value=e,t.appendChild(n),t.appendChild(i),document.body.appendChild(t),t.submit()}})}function o(e,t,n,o){Swal.fire({title:"Delete Template?",text:`Are you sure you want to delete "${t}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):getComputedStyle(document.documentElement).getPropertyValue("--ecs-danger").trim()||"#dc3545",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("info"):getComputedStyle(document.documentElement).getPropertyValue("--ecs-info").trim()||"#0dcaf0",confirmButtonText:"Yes, delete it!"}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=n;const s=document.createElement("input");s.type="hidden",s.name="csrf_token",s.value=o;const i=document.createElement("input");i.type="hidden",i.name="template_id",i.value=e,t.appendChild(s),t.appendChild(i),document.body.appendChild(t),t.submit()}})}function s(e,t){const n=document.getElementById(t);if(!n)return;const o=n.selectionStart,s=n.selectionEnd,i=n.value;n.value=i.substring(0,o)+e+i.substring(s);const a=o+e.length;n.setSelectionRange(a,a),n.focus()}function i(e){window.history.back()}function a(t){t.target.dataset.templateId,e(0,t.target.dataset.templateName,t.target.dataset.templateContent)}function r(e){t(e.target.dataset.templateId,e.target.dataset.templateName,e.target.dataset.templateDescription,e.target.dataset.templateContent,e.target.dataset.templateChannel,e.target.dataset.templateContext,"true"===e.target.dataset.templateActive)}function c(e){n(e.target.dataset.templateId,e.target.dataset.templateName,"true"===e.target.dataset.templateActive,e.target.dataset.toggleUrl,e.target.dataset.csrfToken)}function l(e){o(e.target.dataset.templateId,e.target.dataset.templateName,e.target.dataset.deleteUrl,e.target.dataset.csrfToken)}function d(){(document.getElementById("viewTemplateModal")||document.getElementById("editTemplateModal"))&&(console.log("[Template Detail] Initializing..."),"undefined"!=typeof EventDelegation?(EventDelegation.register("go-back",i,{preventDefault:!0}),EventDelegation.register("view-template",a,{preventDefault:!0}),EventDelegation.register("edit-template",r,{preventDefault:!0}),EventDelegation.register("toggle-template",c,{preventDefault:!0}),EventDelegation.register("delete-template",l,{preventDefault:!0})):console.error("[Template Detail] EventDelegation not available"),document.addEventListener("click",function(e){const t=e.target.closest(".var-btn");if(!t)return;e.preventDefault();const n=t.dataset.var;let o=t.dataset.target||"template_content";const i=document.getElementById("editTemplateModal"),a=document.getElementById("createTemplateModal");i&&i.classList.contains("show")?o="edit_template_content":a&&a.classList.contains("show")&&(o="template_content"),s(n,o),t.classList.add("inserted"),setTimeout(()=>t.classList.remove("inserted"),300)}),console.log("[Template Detail] Initialization complete"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d(),window.MessageTemplateDetail={version:"1.1.0",viewTemplate:e,editTemplate:t,toggleTemplate:n,deleteTemplate:o,insertVariable:s,init:d}}(),function(){const e={baseUrl:window.CAMPAIGNS_BASE_URL||"/admin-panel",csrfToken:window.CAMPAIGNS_CSRF_TOKEN||""};async function t(t){try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}`),o=await n.json();o.success&&Swal.fire({title:o.campaign.name,html:`\n                        <div class="text-start">\n                            <p><strong>Title:</strong> ${o.campaign.title}</p>\n                            <p><strong>Body:</strong> ${o.campaign.body}</p>\n                            <p><strong>Target:</strong> ${o.campaign.target_type}</p>\n                            <p><strong>Status:</strong> ${o.campaign.status}</p>\n                        </div>\n                    `,width:600})}catch(n){Swal.fire("Error","Failed to load campaign details","error")}}async function n(t){try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}`);(await n.json()).success&&(window.location.href=`${e.baseUrl}/communication/campaigns/${t}/edit`)}catch(n){Swal.fire("Error","Failed to load campaign for editing","error")}}async function o(t,n){if((await Swal.fire({title:"Send Campaign Now?",text:`Send "${n}" to all targeted users immediately?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, send it!",cancelButtonText:"Cancel"})).isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}/send`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken}}),o=await n.json();o.success?Swal.fire("Sent!",o.message,"success").then(()=>location.reload()):Swal.fire("Error",o.message,"error")}catch(o){Swal.fire("Error","Failed to send campaign","error")}}async function s(t,n){const o=await Swal.fire({title:"Schedule Campaign",html:'\n                <div class="text-start">\n                    <label class="form-label">Schedule Time</label>\n                    <input type="datetime-local" id="scheduleTime" class="form-control">\n                </div>\n            ',showCancelButton:!0,confirmButtonText:"Schedule",preConfirm:()=>{const e=document.getElementById("scheduleTime").value;return e?{scheduleTime:e}:(Swal.showValidationMessage("Please select a time"),!1)}});if(o.isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}/schedule`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken},body:JSON.stringify({scheduled_send_time:o.value.scheduleTime})}),s=await n.json();s.success?Swal.fire("Scheduled!",s.message,"success").then(()=>location.reload()):Swal.fire("Error",s.message,"error")}catch(s){Swal.fire("Error","Failed to schedule campaign","error")}}async function i(t,n){if((await Swal.fire({title:"Delete Campaign?",text:`Delete "${n}"? This cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc3545",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken}}),o=await n.json();o.success?Swal.fire("Deleted!",o.message,"success").then(()=>location.reload()):Swal.fire("Error",o.message,"error")}catch(o){Swal.fire("Error","Failed to delete campaign","error")}}async function a(t,n){if((await Swal.fire({title:"Cancel Campaign?",text:`Cancel scheduled campaign "${n}"?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, cancel it!"})).isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}/cancel`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken}}),o=await n.json();o.success?Swal.fire("Cancelled!",o.message,"success").then(()=>location.reload()):Swal.fire("Error",o.message,"error")}catch(o){Swal.fire("Error","Failed to cancel campaign","error")}}async function r(t,n){if((await Swal.fire({title:"Duplicate Campaign?",text:`Create a copy of "${n}"?`,icon:"question",showCancelButton:!0,confirmButtonText:"Yes, duplicate it!"})).isConfirmed)try{const n=await fetch(`${e.baseUrl}/communication/campaigns/${t}/duplicate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken}}),o=await n.json();o.success?Swal.fire("Duplicated!",o.message,"success").then(()=>location.reload()):Swal.fire("Error",o.message,"error")}catch(o){Swal.fire("Error","Failed to duplicate campaign","error")}}function c(){var e;const t=null==(e=document.getElementById("campaign_target_type"))?void 0:e.value;if(!t)return;["campaignTeamSelector","campaignLeagueSelector","campaignRoleSelector","campaignPoolSelector","campaignGroupSelector"].forEach(e=>{const t=document.getElementById(e);t&&t.classList.add("d-none")});const n={team:"campaignTeamSelector",league:"campaignLeagueSelector",role:"campaignRoleSelector",pool:"campaignPoolSelector",group:"campaignGroupSelector"}[t];if(n){const e=document.getElementById(n);e&&e.classList.remove("d-none")}}function l(){var e;const t=null==(e=document.querySelector('input[name="send_type"]:checked'))?void 0:e.value,n=document.getElementById("campaignScheduleContainer");n&&("scheduled"===t?n.classList.remove("d-none"):n.classList.add("d-none"))}function d(e){window.history.back()}function u(e){t(e.target.dataset.campaignId)}function m(e){n(e.target.dataset.campaignId)}function h(e){o(e.target.dataset.campaignId,e.target.dataset.campaignName)}function p(e){s(e.target.dataset.campaignId,e.target.dataset.campaignName)}function f(e){i(e.target.dataset.campaignId,e.target.dataset.campaignName)}function g(e){a(e.target.dataset.campaignId,e.target.dataset.campaignName)}function v(e){r(e.target.dataset.campaignId,e.target.dataset.campaignName)}function y(){if(!document.querySelector('[data-action*="campaign"]'))return;console.log("[Push Campaigns] Initializing..."),"undefined"!=typeof EventDelegation?(EventDelegation.register("go-back",d,{preventDefault:!0}),EventDelegation.register("view-campaign",u,{preventDefault:!0}),EventDelegation.register("edit-campaign",m,{preventDefault:!0}),EventDelegation.register("send-campaign",h,{preventDefault:!0}),EventDelegation.register("schedule-campaign",p,{preventDefault:!0}),EventDelegation.register("delete-campaign",f,{preventDefault:!0}),EventDelegation.register("cancel-campaign",g,{preventDefault:!0}),EventDelegation.register("duplicate-campaign",v,{preventDefault:!0})):console.error("[Push Campaigns] EventDelegation not available");const e=document.getElementById("campaign_target_type");e&&(e.addEventListener("change",c),c()),document.querySelectorAll('input[name="send_type"]').forEach(e=>{e.addEventListener("change",l)}),l(),console.log("[Push Campaigns] Initialization complete")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y(),window.PushCampaigns={version:"1.0.0",viewCampaign:t,editCampaign:n,sendCampaign:o,scheduleCampaign:s,deleteCampaign:i,cancelCampaign:a,duplicateCampaign:r,init:y}}(),function(){const e={ENDPOINTS:{MESSAGE_DETAILS:"/admin-panel/communication/scheduled-messages/{id}/details",MESSAGE_UPDATE:"/admin-panel/communication/scheduled-messages/{id}/update"}};function t(){var e,t,n,o,s;const i=null==(e=document.getElementById("message_title"))?void 0:e.value,a=null==(t=document.getElementById("message_content"))?void 0:t.value,r=null==(n=document.getElementById("message_type"))?void 0:n.value,c=null==(o=document.getElementById("target_channel"))?void 0:o.value,l=null==(s=document.getElementById("schedule_date"))?void 0:s.value;if(!(i&&a&&r&&c))return void Swal.fire("Error","Please fill in all required fields before previewing","error");const d=document.getElementById("preview_title"),u=document.getElementById("preview_content"),m=document.getElementById("preview_type"),h=document.getElementById("preview_channel"),p=document.getElementById("preview_schedule");d&&(d.textContent=i),u&&(u.textContent=a),m&&(m.textContent=r),h&&(h.textContent=c),p&&(p.textContent=l||"Not set"),document.getElementById("messagePreviewModal")&&ModalManager.show("messagePreviewModal")}function n(t,n){const o=document.getElementById("message_details_title"),s=document.getElementById("message_details_content");o&&(o.textContent=`Details for "${n}"`),s&&(s.innerHTML='<div class="text-center"><div class="spinner-border" role="status"></div></div>'),document.getElementById("messageDetailsModal")&&ModalManager.show("messageDetailsModal");const i=e.ENDPOINTS.MESSAGE_DETAILS.replace("{id}",t);fetch(i).then(e=>e.json()).then(e=>{e.success&&s?s.innerHTML=e.html:s&&(s.innerHTML='<div class="alert alert-danger">Error loading message details</div>')}).catch(()=>{s&&(s.innerHTML='<div class="alert alert-danger">Error loading message details</div>')})}function o(t){const n=e.ENDPOINTS.MESSAGE_DETAILS.replace("{id}",t);fetch(n).then(e=>e.json()).then(n=>{if(n.success){const o=n.message,s=o.scheduled_send_time?o.scheduled_send_time.slice(0,16):"";Swal.fire({title:"Edit Scheduled Message",html:`\n                            <div class="text-start">\n                                <div class="mb-3">\n                                    <label class="form-label">Message Type</label>\n                                    <select id="editMessageType" class="form-select">\n                                        <option value="standard" ${"standard"===o.message_type?"selected":""}>Standard</option>\n                                        <option value="announcement" ${"announcement"===o.message_type?"selected":""}>Announcement</option>\n                                        <option value="reminder" ${"reminder"===o.message_type?"selected":""}>Reminder</option>\n                                        <option value="notification" ${"notification"===o.message_type?"selected":""}>Notification</option>\n                                        <option value="alert" ${"alert"===o.message_type?"selected":""}>Alert</option>\n                                    </select>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Scheduled Time <span class="text-danger">*</span></label>\n                                    <input type="datetime-local" id="editScheduledTime" class="form-control" value="${s}">\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Match ID</label>\n                                    <input type="text" class="form-control" value="${o.match_id||"N/A"}" disabled>\n                                    <small class="text-muted">Match ID cannot be changed</small>\n                                </div>\n                            </div>\n                        `,showCancelButton:!0,confirmButtonText:"Save Changes",cancelButtonText:"Cancel",preConfirm:()=>{var e,t;const n=null==(e=document.getElementById("editScheduledTime"))?void 0:e.value;return n?{message_type:null==(t=document.getElementById("editMessageType"))?void 0:t.value,scheduled_time:n}:(Swal.showValidationMessage("Scheduled time is required"),!1)}}).then(n=>{if(n.isConfirmed){const o=new FormData;o.append("message_type",n.value.message_type),o.append("scheduled_time",n.value.scheduled_time);const s=e.ENDPOINTS.MESSAGE_UPDATE.replace("{id}",t);fetch(s,{method:"POST",body:o}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Success",e.message,"success").then(()=>location.reload()):Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to update message","error"))}})}else Swal.fire("Error",n.message,"error")}).catch(()=>Swal.fire("Error","Failed to load message details","error"))}function s(e,t,n,o){Swal.fire({title:"Cancel Scheduled Message?",text:`Cancel the scheduled message "${t}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"var(--ecs-danger)",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):"#6c757d",confirmButtonText:"Yes, cancel it!"}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=n;const s=document.createElement("input");s.type="hidden",s.name="csrf_token",s.value=o;const i=document.createElement("input");i.type="hidden",i.name="message_id",i.value=e,t.appendChild(s),t.appendChild(i),document.body.appendChild(t),t.submit()}})}function i(e,t,n,o){Swal.fire({title:"Retry Scheduled Message?",text:`Retry sending the failed message "${t}"?`,icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"var(--ecs-success)",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):"#6c757d",confirmButtonText:"Yes, retry!"}).then(t=>{if(t.isConfirmed){const t=document.createElement("form");t.method="POST",t.action=n;const s=document.createElement("input");s.type="hidden",s.name="csrf_token",s.value=o;const i=document.createElement("input");i.type="hidden",i.name="message_id",i.value=e,t.appendChild(s),t.appendChild(i),document.body.appendChild(t),t.submit()}})}function a(e){window.history.back()}function r(e){t()}function c(e){n(e.target.dataset.messageId,e.target.dataset.title)}function l(e){o(e.target.dataset.messageId)}function d(e){s(e.target.dataset.messageId,e.target.dataset.title,e.target.dataset.cancelUrl,e.target.dataset.csrfToken)}function u(e){i(e.target.dataset.messageId,e.target.dataset.title,e.target.dataset.retryUrl,e.target.dataset.csrfToken)}function m(){(document.getElementById("messagePreviewModal")||document.getElementById("messageDetailsModal"))&&(console.log("[Scheduled Messages] Initializing..."),function(){const e=document.getElementById("is_recurring"),t=document.getElementById("recurrence_options"),n=document.getElementById("recurrence_pattern");e&&t&&(e.addEventListener("change",function(){this.checked?(t.classList.remove("u-hidden"),n&&(n.required=!0)):(t.classList.add("u-hidden"),n&&(n.required=!1))}),e.checked?(t.classList.remove("u-hidden"),n&&(n.required=!0)):(t.classList.add("u-hidden"),n&&(n.required=!1)))}(),document.querySelectorAll('input[name="queue_filter"]').forEach(e=>{e.addEventListener("change",function(){const e=this.id.replace("filter_","");document.querySelectorAll(".message-row").forEach(t=>{const n=t.dataset.status;"all"===e||n===e?t.classList.remove("u-hidden"):t.classList.add("u-hidden")})})}),function(){const e=document.getElementById("schedule_date");if(!e)return;const t=new Date,n=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}T${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`;e.min=n}(),"undefined"!=typeof EventDelegation?(EventDelegation.register("go-back",a,{preventDefault:!0}),EventDelegation.register("preview-message",r,{preventDefault:!0}),EventDelegation.register("view-scheduled-message",c,{preventDefault:!0}),EventDelegation.register("edit-scheduled-message",l,{preventDefault:!0}),EventDelegation.register("cancel-scheduled-message",d,{preventDefault:!0}),EventDelegation.register("retry-scheduled-message",u,{preventDefault:!0})):console.error("[Scheduled Messages] EventDelegation not available"),console.log("[Scheduled Messages] Initialization complete"))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",m):m(),window.ScheduledMessages={version:"1.0.0",previewMessage:t,viewScheduledMessage:n,editScheduledMessage:o,cancelScheduledMessage:s,retryScheduledMessage:i,init:m}}(),(document.getElementById("matchStatusChart")||document.getElementById("matchesPerWeekChart")||document.querySelector('[data-action^="generate-"][data-action*="report"]')||document.querySelector('[data-action^="export-"]'))&&(document.addEventListener("DOMContentLoaded",function(){!function(){const e=document.getElementById("matchStatusChart"),t=document.getElementById("matchesPerWeekChart");e&&new Chart(e.getContext("2d"),{type:"doughnut",data:{labels:["Completed","Upcoming","Live","Cancelled"],datasets:[{data:[parseInt(e.dataset.completed||0),parseInt(e.dataset.pending||0),parseInt(e.dataset.live||0),parseInt(e.dataset.cancelled||0)],backgroundColor:[getComputedStyle(document.documentElement).getPropertyValue("--color-success")||"#28a745",getComputedStyle(document.documentElement).getPropertyValue("--color-warning")||"#ffc107",getComputedStyle(document.documentElement).getPropertyValue("--color-primary")||"#007bff",getComputedStyle(document.documentElement).getPropertyValue("--color-danger")||"#dc3545"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),t&&new Chart(t.getContext("2d"),{type:"line",data:{labels:["Week 1","Week 2","Week 3","Week 4","Week 5","Week 6"],datasets:[{label:"Matches Played",data:[12,19,3,5,2,15],borderColor:getComputedStyle(document.documentElement).getPropertyValue("--color-primary")||"#007bff",backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}()}),EventDelegation.register("generate-match-report",function(e,t){!function(e=null){console.log("Generate match report:",e)}(e.dataset.matchId)},{preventDefault:!0}),EventDelegation.register("generate-league-report",function(e,t){console.log("Generate league report")},{preventDefault:!0}),EventDelegation.register("generate-team-report",function(e,t){!function(e=null){console.log("Generate team report:",e)}(e.dataset.teamId)},{preventDefault:!0}),EventDelegation.register("generate-custom-report",function(e,t){console.log("Generate custom report")},{preventDefault:!0}),EventDelegation.register("view-recent-matches",function(e,t){window.location.href="/admin-panel/matches/recent"},{preventDefault:!0}),EventDelegation.register("view-upcoming-matches",function(e,t){window.location.href="/admin-panel/matches/upcoming"},{preventDefault:!0}),EventDelegation.register("view-top-scorers",function(e,t){console.log("View top scorers")},{preventDefault:!0}),EventDelegation.register("view-league-standings",function(e,t){window.location.href="/admin-panel/match-operations/league-standings"},{preventDefault:!0}),EventDelegation.register("export-pdf",function(e,t){window.open("/admin/match-operations/reports/export?format=pdf","_blank")},{preventDefault:!0}),EventDelegation.register("export-excel",function(e,t){window.open("/admin/match-operations/reports/export?format=excel","_blank")},{preventDefault:!0}),EventDelegation.register("export-csv",function(e,t){window.open("/admin/match-operations/reports/export?format=csv","_blank")},{preventDefault:!0}),EventDelegation.register("schedule-report",function(e,t){console.log("Schedule report")},{preventDefault:!0}),EventDelegation.register("view-match-report",function(e,t){!function(e){window.location.href=`/admin/match-operations/match/${e}/report`}(e.dataset.matchId)},{preventDefault:!0}),EventDelegation.register("view-team-report",function(e,t){!function(e){window.location.href=`/admin/match-operations/team/${e}/report`}(e.dataset.teamId)},{preventDefault:!0}),EventDelegation.register("view-all-matches",function(e,t){window.location.href="/admin-panel/matches"},{preventDefault:!0})),function(){function e(){Swal.fire({title:"Create New Season",html:'\n      <div class="text-start">\n        <div class="mb-3">\n          <label class="form-label">Season Name <span class="text-danger">*</span></label>\n          <input type="text" id="seasonName" class="form-control" placeholder="e.g., Spring 2025" data-form-control>\n        </div>\n        <div class="mb-3">\n          <label class="form-label">Start Date</label>\n          <input type="date" id="seasonStartDate" class="form-control" data-form-control>\n        </div>\n        <div class="mb-3">\n          <label class="form-label">End Date</label>\n          <input type="date" id="seasonEndDate" class="form-control" data-form-control>\n        </div>\n        <div class="form-check">\n          <input type="checkbox" id="seasonIsCurrent" class="form-check-input">\n          <label class="form-check-label" for="seasonIsCurrent">Set as current season</label>\n        </div>\n      </div>\n    ',showCancelButton:!0,confirmButtonText:"Create Season",cancelButtonText:"Cancel",preConfirm:()=>{const e=document.getElementById("seasonName").value;return e?{name:e,start_date:document.getElementById("seasonStartDate").value,end_date:document.getElementById("seasonEndDate").value,is_current:document.getElementById("seasonIsCurrent").checked?"true":"false"}:(Swal.showValidationMessage("Season name is required"),!1)}}).then(e=>{e.isConfirmed&&function(e){var t;const n=new FormData;n.append("name",e.name),n.append("start_date",e.start_date),n.append("end_date",e.end_date),n.append("is_current",e.is_current);const o=(null==(t=document.querySelector("[data-create-season-url]"))?void 0:t.dataset.createSeasonUrl)||window.location.origin+"/admin-panel/match-operations/seasons/create";fetch(o,{method:"POST",body:n}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Success",e.message,"success").then(()=>location.reload()):Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to create season","error"))}(e.value)})}function t(e){fetch(`/admin-panel/match-operations/seasons/${e}/details`).then(e=>e.json()).then(t=>{t.success?function(e,t){Swal.fire({title:"Edit Season",html:`\n      <div class="text-start">\n        <div class="mb-3">\n          <label class="form-label">Season Name <span class="text-danger">*</span></label>\n          <input type="text" id="editSeasonName" class="form-control" value="${t.name}" data-form-control>\n        </div>\n        <div class="mb-3">\n          <label class="form-label">Start Date</label>\n          <input type="date" id="editSeasonStartDate" class="form-control" value="${t.start_date}" data-form-control>\n        </div>\n        <div class="mb-3">\n          <label class="form-label">End Date</label>\n          <input type="date" id="editSeasonEndDate" class="form-control" value="${t.end_date}" data-form-control>\n        </div>\n        <div class="form-check">\n          <input type="checkbox" id="editSeasonIsCurrent" class="form-check-input" ${t.is_current?"checked":""}>\n          <label class="form-check-label" for="editSeasonIsCurrent">Set as current season</label>\n        </div>\n      </div>\n    `,showCancelButton:!0,showDenyButton:!0,confirmButtonText:"Save Changes",denyButtonText:"Delete Season",denyButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"var(--ecs-danger)",cancelButtonText:"Cancel",preConfirm:()=>{const e=document.getElementById("editSeasonName").value;return e?{name:e,start_date:document.getElementById("editSeasonStartDate").value,end_date:document.getElementById("editSeasonEndDate").value,is_current:document.getElementById("editSeasonIsCurrent").checked?"true":"false"}:(Swal.showValidationMessage("Season name is required"),!1)}}).then(n=>{n.isConfirmed?function(e,t){const n=new FormData;n.append("name",t.name),n.append("start_date",t.start_date),n.append("end_date",t.end_date),n.append("is_current",t.is_current),fetch(`/admin-panel/match-operations/seasons/${e}/update`,{method:"POST",body:n}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Success",e.message,"success").then(()=>location.reload()):Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to update season","error"))}(e,n.value):n.isDenied&&function(e,t){Swal.fire({title:"Delete Season?",text:`Are you sure you want to delete "${t}"? This cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"var(--ecs-danger)",cancelButtonText:"Cancel"}).then(t=>{t.isConfirmed&&function(e){fetch(`/admin-panel/match-operations/seasons/${e}/delete`,{method:"POST"}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Deleted",e.message,"success").then(()=>location.reload()):Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to delete season","error"))}(e)})}(e,t.name)})}(e,t.season):Swal.fire("Error",t.message,"error")}).catch(()=>Swal.fire("Error","Failed to load season details","error"))}function n(e){Swal.fire({title:"Set Current Season?",text:"This will make this season the active one for new leagues and matches.",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, set as current",cancelButtonText:"Cancel"}).then(t=>{t.isConfirmed&&function(e){var t;const n=(null==(t=document.querySelector("[data-set-current-season-url]"))?void 0:t.dataset.setCurrentSeasonUrl)||window.location.origin+"/admin-panel/match-operations/seasons/set-current";fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`season_id=${e}`}).then(e=>e.json()).then(e=>{e.success?Swal.fire({title:"Success",text:e.message,icon:"success"}).then(()=>{location.reload()}):Swal.fire({title:"Error",text:e.message,icon:"error"})}).catch(e=>{Swal.fire({title:"Error",text:"An error occurred while setting current season",icon:"error"})})}(e)})}(document.querySelector('[data-action="create-season"]')||document.querySelector('[data-action="view-season"]')||document.querySelector('[data-action="edit-season"]')||document.querySelector('[data-action="set-current-season"]')||document.querySelector("[data-create-season-url]"))&&(EventDelegation.register("create-season",function(t,n){e()},{preventDefault:!0}),EventDelegation.register("view-season",function(e,t){!function(e){fetch(`/admin-panel/match-operations/seasons/${e}/details`).then(e=>e.json()).then(e=>{if(e.success){const t=e.season;Swal.fire({title:t.name,html:`\n            <div class="text-start">\n              <p><strong>Start Date:</strong> ${t.start_date||"Not set"}</p>\n              <p><strong>End Date:</strong> ${t.end_date||"Not set"}</p>\n              <p><strong>Current Season:</strong> ${t.is_current?"Yes":"No"}</p>\n            </div>\n          `,icon:"info"})}else Swal.fire("Error",e.message,"error")}).catch(()=>Swal.fire("Error","Failed to load season details","error"))}(e.dataset.seasonId)},{preventDefault:!0}),EventDelegation.register("edit-season",function(e,n){t(e.dataset.seasonId)},{preventDefault:!0}),EventDelegation.register("set-current-season",function(e,t){n(e.dataset.seasonId)},{preventDefault:!0}))}(),x=window,L=document,"undefined"!=typeof InitSystem?(console.log("[App Init] Registering application components..."),InitSystem.register("page-loader",function(){setTimeout(function(){const e=L.getElementById("page-loader");e&&(e.classList.add("hidden"),setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},500))},800)},{priority:85,description:"Hide page loading animation",reinitializable:!1}),InitSystem.register("admin-utilities",function(e){const t=e||L;t.querySelectorAll("[data-width]").forEach(e=>{const t=e.dataset.width;t&&(e.style.width=t+"%")}),t.querySelectorAll("[data-theme-color]").forEach(e=>{const t=e.dataset.themeColor;t&&(e.style.backgroundColor=t)})},{priority:70,description:"Initialize admin utility helpers (progress bars, theme colors)",reinitializable:!0}),InitSystem.register("design-system-fixes",function(){if(!x.ECSDesignSystem)return;const e=ECSDesignSystem.setupCustomBehaviors;ECSDesignSystem.setupCustomBehaviors=function(){try{"function"==typeof e&&e.call(ECSDesignSystem)}catch(o){console.warn("[Design System Fix] Original setupCustomBehaviors failed, using safe version",o);try{"function"==typeof this.addRippleEffect&&this.addRippleEffect()}catch(t){console.warn("[Design System Fix] Error in addRippleEffect",t)}try{"function"==typeof this.improveKeyboardNavigation&&this.improveKeyboardNavigation()}catch(t){console.warn("[Design System Fix] Error in improveKeyboardNavigation",t)}try{"function"==typeof this.setupTransitions&&this.setupTransitions()}catch(t){console.warn("[Design System Fix] Error in setupTransitions",t)}}},setTimeout(function(){try{ECSDesignSystem.setupCustomBehaviors()}catch(o){console.error("[Design System Fix] Error in setupCustomBehaviors:",o)}},500)},{priority:30,description:"Apply design system CSS fixes and safe method overrides",reinitializable:!1}),InitSystem.register("dropdown-menu-fix",function(e){(e||L).querySelectorAll(".table").forEach(e=>{e.classList.add("user-management-table")}),x.location.href.includes("rsvp_status")&&L.body.classList.add("rsvp-status-page")},{priority:30,description:"Fix dropdown menu positioning and z-index issues",reinitializable:!0}),InitSystem.register("mobile-menu-fix",function(){const e=L.getElementById("layout-menu"),t=L.getElementById("close-icon");let n=L.querySelector(".layout-overlay");if(!n){const e=L.createElement("div");e.className="layout-overlay",L.body.appendChild(e),n=e}function o(){L.documentElement.classList.remove("layout-menu-expanded"),L.body.classList.remove("layout-menu-expanded"),e&&e.classList.remove("menu-open"),t&&t.classList.add("d-none")}function s(){L.documentElement.classList.contains("layout-menu-expanded")?o():(L.documentElement.classList.add("layout-menu-expanded"),L.body.classList.add("layout-menu-expanded"),e&&e.classList.add("menu-open"),t&&t.classList.remove("d-none"))}"undefined"!=typeof EventDelegation&&EventDelegation.register("toggle-mobile-menu",function(e,t){t.preventDefault(),s()},{preventDefault:!0}),"undefined"!=typeof EventDelegation&&EventDelegation.register("close-mobile-menu",function(e,t){t.preventDefault(),o()},{preventDefault:!0}),L.addEventListener("click",function(e){e.target.classList.contains("layout-overlay")&&L.documentElement.classList.contains("layout-menu-expanded")&&o()}),L.querySelectorAll(".menu-item a").forEach(e=>{e.removeAttribute("inert"),e.classList.add("pointer-events-auto")}),e&&(e.removeAttribute("inert"),e.classList.add("pointer-events-auto","user-select-auto","touch-action-auto")),(/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&(L.documentElement.classList.add("ios-device"),e&&e.classList.add("ios-overflow-scrolling"),L.querySelectorAll(".menu-link, .menu-toggle").forEach(e=>{e.addEventListener("touchstart",function(e){e.stopPropagation()},{passive:!0})}))},{priority:30,description:"Enhance mobile menu interactions and iOS compatibility",reinitializable:!1}),InitSystem.register("waitlist-register-focus",function(){const e=L.querySelector('a[href*="waitlist_discord_register"]');if(e&&(e.focus(),"undefined"!=typeof DiscordMembershipChecker)){const e=x.discordMembershipStatus;if(!0===e||"true"===e)return void console.log("[waitlist-register-focus] User already in Discord, skipping prompt");setTimeout(()=>{DiscordMembershipChecker.showJoinPrompt({title:"ð¡ Pro Tip: Join Discord First!",urgency:"info",showUrgentPopup:!0})},2e3)}},{priority:20,description:"Auto-focus Discord registration button and show membership prompts",reinitializable:!1}),console.log("[App Init] â 7 components registered successfully"),console.log("[App Init] Run InitSystemDebug.printOrder() to view initialization order")):console.error("[App Init] InitSystem not loaded! Please include init-system.js before this file."),function(e,t){const n={HIDDEN_CLASS:"is-hidden",LEGACY_CLASSES:["d-none","js-hidden","hidden"],hide(e){const t=this._resolveElement(e);return t&&(t.classList.add(this.HIDDEN_CLASS),this.LEGACY_CLASSES.forEach(e=>t.classList.remove(e))),t},show(e){const t=this._resolveElement(e);return t&&(t.classList.remove(this.HIDDEN_CLASS),this.LEGACY_CLASSES.forEach(e=>t.classList.remove(e))),t},toggle(e,t){const n=this._resolveElement(e);return n&&("boolean"==typeof t?n.classList.toggle(this.HIDDEN_CLASS,t):n.classList.toggle(this.HIDDEN_CLASS),this.LEGACY_CLASSES.forEach(e=>n.classList.remove(e))),n},isHidden(t){const n=this._resolveElement(t);if(!n)return!0;if(n.classList.contains(this.HIDDEN_CLASS))return!0;for(const e of this.LEGACY_CLASSES)if(n.classList.contains(e))return!0;const o=e.getComputedStyle(n);return"none"===o.display||"hidden"===o.visibility},isVisible(e){return!this.isHidden(e)},showOnly(e,t){t.forEach(e=>this.hide(e)),this.show(e)},migrate(e){const t=this._resolveElement(e);if(!t)return;const n=this.LEGACY_CLASSES.some(e=>t.classList.contains(e));this.LEGACY_CLASSES.forEach(e=>t.classList.remove(e)),n&&t.classList.add(this.HIDDEN_CLASS)},_resolveElement:e=>e?"string"==typeof e?t.querySelector(e):e:null};e.Visibility=n,"undefined"!=typeof InitSystem&&InitSystem.register&&InitSystem.register("visibility-utils",function(){},{priority:100,description:"Visibility utility functions",reinitializable:!1})}(window,document),function(e,t){const n={SELECTORS:{TABS_CONTAINER:"[data-tabs]",TAB_TRIGGER:"[data-tab-trigger]",TAB_PANE:"[data-tab-pane]"},CLASSES:{ACTIVE_TRIGGER:"is-active",ACTIVE_PANE:"c-settings-tab--active",ACTIVE_PANE_ALT:"is-active"},init(e=t){const n=e.querySelectorAll(this.SELECTORS.TABS_CONTAINER);0!==n.length&&(n.forEach(e=>this.initContainer(e)),this.handleInitialHash())},initContainer(e){"true"!==e.dataset.tabsInitialized&&(e.querySelectorAll(this.SELECTORS.TAB_TRIGGER),e.addEventListener("click",t=>{const n=t.target.closest(this.SELECTORS.TAB_TRIGGER);if(!n)return;t.preventDefault();const o=n.dataset.tabTrigger;o&&this.activateTab(e,o)}),e.addEventListener("keydown",t=>{const n=t.target.closest(this.SELECTORS.TAB_TRIGGER);if(!n)return;const o=Array.from(e.querySelectorAll(this.SELECTORS.TAB_TRIGGER)),s=o.indexOf(n);let i=-1;switch(t.key){case"ArrowLeft":case"ArrowUp":t.preventDefault(),i=s>0?s-1:o.length-1;break;case"ArrowRight":case"ArrowDown":t.preventDefault(),i=s<o.length-1?s+1:0;break;case"Home":t.preventDefault(),i=0;break;case"End":t.preventDefault(),i=o.length-1}if(i>=0&&o[i]){o[i].focus();const t=o[i].dataset.tabTrigger;t&&this.activateTab(e,t)}}),e.dataset.tabsInitialized="true")},activateTab(n,o){const s=n.querySelectorAll(this.SELECTORS.TAB_TRIGGER),i=t.querySelectorAll(this.SELECTORS.TAB_PANE);s.forEach(e=>{e.classList.remove(this.CLASSES.ACTIVE_TRIGGER),e.setAttribute("aria-selected","false"),e.setAttribute("tabindex","-1")}),i.forEach(e=>{e.classList.remove(this.CLASSES.ACTIVE_PANE),e.classList.remove(this.CLASSES.ACTIVE_PANE_ALT),e.classList.remove("show","active")});const a=n.querySelector(`[data-tab-trigger="${o}"]`);a&&(a.classList.add(this.CLASSES.ACTIVE_TRIGGER),a.setAttribute("aria-selected","true"),a.setAttribute("tabindex","0"));const r=t.querySelector(`[data-tab-pane="${o}"]`);r&&(r.classList.add(this.CLASSES.ACTIVE_PANE),r.dispatchEvent(new CustomEvent("tab:activated",{bubbles:!0,detail:{tabId:o,container:n,trigger:a}}))),history.replaceState&&history.replaceState(null,null,`#${o}`),e.InitSystemDebug&&e.InitSystemDebug.log("tabs-controller",`Activated tab: ${o}`)},handleInitialHash(){const n=e.location.hash.slice(1);n&&t.querySelectorAll(this.SELECTORS.TABS_CONTAINER).forEach(e=>{e.querySelector(`[data-tab-trigger="${n}"]`)&&requestAnimationFrame(()=>{this.activateTab(e,n)})})},showTab(e){const n=t.querySelector(`[data-tab-trigger="${e}"]`);if(!n)return void console.warn(`TabsController: Tab trigger not found for "${e}"`);const o=n.closest(this.SELECTORS.TABS_CONTAINER);o&&this.activateTab(o,e)},getActiveTab(e){const t=e.querySelector(`${this.SELECTORS.TAB_TRIGGER}.${this.CLASSES.ACTIVE_TRIGGER}`);return t?t.dataset.tabTrigger:null}};"undefined"!=typeof InitSystem&&InitSystem.register?InitSystem.register("tabs-controller",function(e){n.init(e)},{priority:75,description:"BEM tabs navigation controller",reinitializable:!0}):"loading"===t.readyState?t.addEventListener("DOMContentLoaded",()=>n.init()):n.init(),e.addEventListener("hashchange",()=>{n.handleInitialHash()}),e.TabsController=n}(window,document),function(e,t){const n={initialized:!1,initializing:!1,startTime:null,endTime:null,components:new Map,queue:[],failures:[],config:{logging:!0,throwOnError:!1,initTimeout:3e4,componentTimeout:5e3,autoInit:!0},register(e,t,n={}){if(!e||"string"!=typeof e)return void this._error("register","Component name must be a non-empty string");if(this.components.has(e)&&this._warn("register",`Component "${e}" is already registered. Overwriting.`),"function"!=typeof t)return void this._error("register",`Init function for "${e}" must be a function`);const o={name:e,initFn:t,priority:"number"==typeof n.priority?n.priority:50,dependencies:Array.isArray(n.dependencies)?n.dependencies:[],reinitializable:!0===n.reinitializable,description:n.description||e,initialized:!1,initializing:!1,error:null,initTime:null,initDuration:null};(o.priority<0||o.priority>100)&&(this._warn("register",`Priority for "${e}" should be 0-100, got ${o.priority}`),o.priority=Math.max(0,Math.min(100,o.priority))),this.components.set(e,o);const s=this.queue.findIndex(t=>t.name===e);s>=0?this.queue[s]=o:this.queue.push(o),this.queue.sort((e,t)=>t.priority-e.priority),this._log("register",`Registered "${e}" (priority: ${o.priority}${o.dependencies.length>0?", deps: "+o.dependencies.join(", "):""})`)},async init(){if(this.initialized)return this._warn("init","Already initialized"),this._getStatus();if(this.initializing)return this._warn("init","Already initializing"),this._getStatus();this.initializing=!0,this.startTime=performance.now(),this.failures=[],this._log("init",`Starting initialization of ${this.queue.length} components...`),this._log("init",`Components: ${this.queue.map(e=>e.name).join(", ")}`);try{const e=new Promise((e,t)=>{setTimeout(()=>t(new Error("Initialization timeout")),this.config.initTimeout)}),t=this._initializeQueue();await Promise.race([t,e]),this.initialized=!0,this.initializing=!1,this.endTime=performance.now();const n=(this.endTime-this.startTime).toFixed(2),o=this.queue.filter(e=>e.initialized).length,s=this.failures.length;return 0===s?this._log("init",`â Initialization complete! ${o} components in ${n}ms`):this._warn("init",`â ï¸ Initialization complete with ${s} failures. ${o} components in ${n}ms`),this._dispatchEvent("initialized",this._getStatus()),this._getStatus()}catch(e){if(this.initializing=!1,this._error("init",`â Initialization failed: ${e.message}`,e),this._dispatchEvent("initializationError",{error:e,status:this._getStatus()}),this.config.throwOnError)throw e;return this._getStatus()}},async _initializeQueue(){for(const t of this.queue)try{await this._initComponent(t)}catch(e){if(this.failures.push({component:t.name,error:e.message,stack:e.stack}),this.config.throwOnError)throw e}},async _initComponent(e){if(e.initialized)return;if(e.initializing)throw new Error(`Circular dependency detected: ${e.name}`);for(const o of e.dependencies){const t=this.components.get(o);if(!t)throw new Error(`Component "${e.name}" depends on "${o}" which is not registered`);if(!t.initialized){if(t.initializing)throw new Error(`Component "${e.name}" depends on "${o}" which is currently initializing (circular dependency)`);this._log("init",`Initializing dependency "${o}" for "${e.name}"`),await this._initComponent(t)}}e.initializing=!0;const t=performance.now();try{this._log("init",`Initializing "${e.name}"...`);const n=new Promise((t,n)=>{setTimeout(()=>n(new Error(`Component "${e.name}" initialization timeout`)),this.config.componentTimeout)}),o=Promise.resolve(e.initFn());await Promise.race([o,n]);const s=performance.now();e.initialized=!0,e.initializing=!1,e.initTime=s,e.initDuration=(s-t).toFixed(2),this._log("init",`â "${e.name}" initialized in ${e.initDuration}ms`),this._dispatchEvent("componentInitialized",{component:e.name,duration:e.initDuration})}catch(n){throw e.initializing=!1,e.error=n.message,this._error("init",`â Failed to initialize "${e.name}": ${n.message}`,n),this._dispatchEvent("componentError",{component:e.name,error:n.message}),n}},async reinit(e=[],n=t.body){if(!Array.isArray(e))return void this._error("reinit","componentNames must be an array");this._log("reinit",`Re-initializing ${e.length} components: ${e.join(", ")}`);const o={success:[],failed:[],skipped:[]};for(const t of e){const e=this.components.get(t);if(e)if(e.reinitializable)try{this._log("reinit",`Re-initializing "${t}"...`),e.initFn.length>0?await Promise.resolve(e.initFn(n)):await Promise.resolve(e.initFn()),this._log("reinit",`â "${t}" re-initialized`),o.success.push(t),this._dispatchEvent("componentReinitialized",{component:t})}catch(s){this._error("reinit",`â Failed to re-initialize "${t}": ${s.message}`,s),o.failed.push({name:t,error:s.message}),this._dispatchEvent("componentReinitError",{component:t,error:s.message})}else this._warn("reinit",`Component "${t}" is not reinitializable`),o.skipped.push(t);else this._warn("reinit",`Component "${t}" not found`),o.skipped.push(t)}return this._log("reinit",`Re-initialization complete. Success: ${o.success.length}, Failed: ${o.failed.length}, Skipped: ${o.skipped.length}`),o},isInitialized(e){const t=this.components.get(e);return!!t&&t.initialized},getComponent(e){return this.components.get(e)||null},getAllComponents(){return Array.from(this.components.values())},_getStatus(){const e=Array.from(this.components.values()),t=e.filter(e=>e.initialized),n=e.filter(e=>e.error),o=e.filter(e=>!e.initialized&&!e.error);return{initialized:this.initialized,initializing:this.initializing,duration:this.endTime?(this.endTime-this.startTime).toFixed(2):null,total:e.length,initialized:t.length,failed:n.length,pending:o.length,components:{initialized:t.map(e=>e.name),failed:n.map(e=>({name:e.name,error:e.error})),pending:o.map(e=>e.name)},failures:this.failures}},getInitOrder(){return this.queue.map((e,t)=>({order:t+1,name:e.name,priority:e.priority,dependencies:e.dependencies,initialized:e.initialized,duration:e.initDuration}))},_dispatchEvent(e,n){t.dispatchEvent(new CustomEvent(`app:${e}`,{detail:n}))},_log(e,t){this.config.logging&&console.log(`[Init${e?":"+e:""}] ${t}`)},_warn(e,t){this.config.logging&&console.warn(`[Init${e?":"+e:""}] ${t}`)},_error(e,t,n){console.error(`[Init${e?":"+e:""}] ${t}`,n||"")},configure(e){Object.assign(this.config,e),this._log("configure",`Configuration updated: ${JSON.stringify(this.config)}`)},reset(){this.initialized=!1,this.initializing=!1,this.startTime=null,this.endTime=null,this.components.clear(),this.queue=[],this.failures=[],this._log("reset","Init system reset")}};e.InitSystem=n,n.config.autoInit&&("loading"===t.readyState?t.addEventListener("DOMContentLoaded",()=>{n.init()}):n.init()),e.InitSystemDebug={printOrder(){console.table(n.getInitOrder())},printStatus(){const e=n._getStatus();console.log("Initialization Status:",e),console.log(`Total: ${e.total}, Initialized: ${e.initialized}, Failed: ${e.failed}, Pending: ${e.pending}`),e.components.failed.length>0&&console.error("Failed Components:",e.components.failed),e.components.pending.length>0&&console.warn("Pending Components:",e.components.pending)},async testReinit(e){console.log("Testing re-initialization:",e);const t=await n.reinit(e);console.log("Results:",t)},getComponent(e){const t=n.getComponent(e);t?console.log(`Component: ${e}`,t):console.warn(`Component "${e}" not found`)}}}(window,document),document.addEventListener("DOMContentLoaded",function(){if("undefined"==typeof Shepherd)return void console.warn("[Tour] Shepherd library not loaded, skipping tour initialization");const e=new Shepherd.Tour({defaultStepOptions:{scrollTo:!0,cancelIcon:{enabled:!0}},useModalOverlay:!0});e.addStep({title:"Welcome ð",text:"Glad you're here ! This tour will guide you through the main features of the site.",attachTo:{element:".navbar",on:"bottom"},buttons:[{text:"Next",action:e.next},{text:"Skip",action:function(){const t=document.querySelector('input[name="csrf_token"]').value;fetch("/set_tour_complete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},body:JSON.stringify({})}).then(t=>{t.ok&&e.cancel()}).catch(()=>{})}}]}),e.addStep({title:"User Profile",text:"Click here to view your profile, edit settings, or logout.",attachTo:{element:".nav-item.dropdown-user",on:"bottom"},buttons:[{text:"Next",action:e.next},{text:"Skip",action:function(){const t=document.querySelector('input[name="csrf_token"]').value;fetch("/set_tour_complete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},body:JSON.stringify({})}).then(t=>{t.ok&&e.cancel()}).catch(()=>{})}}]}),e.addStep({title:"Announcements! ð¢",text:"You can see new announcements here.",attachTo:{element:"#announcementsCarousel",on:"top"},buttons:[{text:"Next",action:e.next},{text:"Skip",action:function(){const t=document.querySelector('input[name="csrf_token"]').value;fetch("/set_tour_complete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},body:JSON.stringify({})}).then(t=>{t.ok&&e.cancel()}).catch(()=>{})}}]}),e.addStep({title:"Profile",text:"You can view and update your profile here.",attachTo:{element:"#playerProfile",on:"top"},buttons:[{text:"Next",action:e.next},{text:"Skip",action:function(){const t=document.querySelector('input[name="csrf_token"]').value;fetch("/set_tour_complete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},body:JSON.stringify({})}).then(t=>{t.ok&&e.cancel()}).catch(()=>{})}}]}),e.addStep({title:"Team Page",text:"You can find your teammates here.",attachTo:{element:"#teamOverview",on:"top"},buttons:[{text:"Next",action:e.next},{text:"Skip",action:function(){const t=document.querySelector('input[name="csrf_token"]').value;fetch("/set_tour_complete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},body:JSON.stringify({})}).then(t=>{t.ok&&e.cancel()}).catch(()=>{})}}]}),e.addStep({title:"Matches",text:"You can view and RSVP to your upcomming matches here.",attachTo:{element:"#matchOverview",on:"top"},buttons:[{text:"Next",action:e.next},{text:"Skip",action:function(){const t=document.querySelector('input[name="csrf_token"]').value;fetch("/set_tour_complete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},body:JSON.stringify({})}).then(t=>{t.ok&&e.cancel()}).catch(()=>{})}}]}),e.addStep({title:"Feedback",text:"You can report bugs or give feedback here.  We need your feedback to get better!",attachTo:{element:"a.feedback-link",on:"top"},buttons:[{text:"Next",action:e.next},{text:"Skip",action:function(){const t=document.querySelector('input[name="csrf_token"]').value;fetch("/set_tour_complete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},body:JSON.stringify({})}).then(t=>{t.ok&&e.cancel()}).catch(()=>{})}}]}),e.addStep({title:"Teams",text:"You can view other teams here.",attachTo:{element:"a.teams-link",on:"bottom"},buttons:[{text:"Finish",action:function(){const t=document.querySelector('input[name="csrf_token"]').value;fetch("/set_tour_complete",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},body:JSON.stringify({})}).then(t=>{t.ok&&e.cancel()}).catch(()=>{})}}]}),"undefined"!=typeof showTour&&showTour&&e.start()}),$(document).ready(function(){var e=$('input[name="csrf_token"]').val();$.ajaxSetup({beforeSend:function(t,n){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(n.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",e)}}),void 0===window.playerChoices&&(window.playerChoices={}),function(){const e=document.querySelectorAll(".edit-match-btn");e.length>0&&e.forEach(function(e){const t=e.getAttribute("data-match-id");t&&(e.hasAttribute("data-action")||e.setAttribute("data-action","edit-match-report"),e.setAttribute("data-match-id",t))})}()}),window.playerChoices=window.playerChoices||{},window.addEvent=function(e,t,n=null,o=null,s=null){var i,a="#"+t,r=n?String(n):"new-"+Date.now()+"-"+Math.random(),c=t.split("Container-")[0],l="",d="input-group mb-2 player-event-entry",u=c;"yellowCards"===c?(l='<span class="input-group-text card-indicator-yellow">ð¨</span>',d="input-group player-event-entry-compact player-event-entry",u="yellow_cards"):"redCards"===c?(l='<span class="input-group-text card-indicator-red">ð¥</span>',d="input-group player-event-entry-compact player-event-entry",u="red_cards"):"ownGoals"===c&&(u="own_goals"),i="ownGoals"===c?`\n            <div class="${d}" data-unique-id="${r}">\n                ${l}\n                <input type="hidden" name="${u}-stat_id[]" value="${n||""}">\n                <select class="form-select select-player" name="${u}-team_id[]">\n                    ${function(e){let t='<option value="" selected>Select a team</option>';if(window.currentMatchData&&window.currentMatchData.matchId==e){const e=window.currentMatchData.home_team?window.currentMatchData.home_team.id:null,n=window.currentMatchData.away_team?window.currentMatchData.away_team.id:null,o=window.currentMatchData.home_team_name||"Home Team",s=window.currentMatchData.away_team_name||"Away Team";e&&(t+=`<option value="${e}">${o}</option>`),n&&(t+=`<option value="${n}">${s}</option>`)}else{const n=window["homeTeamName_"+e]||"Home Team",o=window["awayTeamName_"+e]||"Away Team",s=window["homeTeamId_"+e],i=window["awayTeamId_"+e];s&&(t+=`<option value="${s}">${n}</option>`),i&&(t+=`<option value="${i}">${o}</option>`)}return t}(e)}\n                </select>\n                <input type="text" class="form-control input-minute" name="${u}-minute[]"\n                       placeholder="Min"\n                       value="${s||""}"\n                       pattern="^\\d{1,3}(\\+\\d{1,2})?$"\n                       title="Enter a valid minute (e.g., '45' or '45+2')">\n                <button class="btn btn-danger btn-sm" type="button" data-action="remove-event">Ã</button>\n            </div>\n        `:`\n            <div class="${d}" data-unique-id="${r}">\n                ${l}\n                <input type="hidden" name="${u}-stat_id[]" value="${n||""}">\n                <select class="form-select select-player" name="${u}-player_id[]">\n                    ${function(e){let t='<option value="" selected>Select a player</option>';if(playerChoices[e])for(const n in playerChoices[e]){t+=`<optgroup label="${n}">`;for(const o in playerChoices[e][n])t+=`<option value="${o}">${playerChoices[e][n][o]}</option>`;t+="</optgroup>"}return t}(e)}\n                </select>\n                <input type="text" class="form-control input-minute" name="${u}-minute[]"\n                       placeholder="Min"\n                       value="${s||""}"\n                       pattern="^\\d{1,3}(\\+\\d{1,2})?$"\n                       title="Enter a valid minute (e.g., '45' or '45+2')">\n                <button class="btn btn-danger btn-sm" type="button" data-action="remove-event">Ã</button>\n            </div>\n        `,$(a).append(i),o&&$(a).children().last().find(`select[name="${u}-player_id[]"]`).val(o),"undefined"!=typeof feather&&feather&&"undefined"!=typeof feather&&feather.replace()},window.removeEvent=function(e){if(!e)return;let t,n,s=null,i=null;try{if(e instanceof Element&&(s=e.closest(".player-event-entry")||e.closest(".input-group"),s&&(i=$(s))),!s||!i){const t=(Element,$(e));i=t.closest(".player-event-entry"),i.length||(i=t.closest(".input-group")),i.length||(i=t.parents().has('input[name$="-stat_id[]"]').first()),i&&i.length&&(s=i[0])}if((!s||!i||!i.length)&&e.parentNode){let t=e.parentNode;for(let e=0;e<3;e++){if(t&&(t.classList.contains("player-event-entry")||t.classList.contains("input-group"))){s=t,i=$(t);break}if(!t.parentNode)break;t=t.parentNode}}}catch(o){}if(s&&i&&i.length){try{t=i.data("unique-id"),n=i.find('input[name$="-stat_id[]"]').val()}catch(o){}window.innerWidth<768?(i.addClass("to-be-removed"),i.hide(),"undefined"!=typeof Swal&&Swal.fire({title:"Removed",icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})):Swal.fire({title:"Remove Event?",text:"Do you want to remove this event?",icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, remove it"}).then(e=>{e.isConfirmed&&(i.addClass("to-be-removed"),i.hide(),Swal.fire({title:"Removed",text:"Save your changes to apply",icon:"success",timer:1500,showConfirmButton:!1}))})}},window.initialEvents=window.initialEvents||{},$(document).on("submit",".report-match-form",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).data("match-id");"undefined"==typeof initialEvents&&(window.initialEvents={}),initialEvents[t]||(initialEvents[t]={goals:[],assists:[],yellowCards:[],redCards:[],ownGoals:[]});let n=A(t,"goal_scorers"),o=A(t,"assist_providers"),s=A(t,"yellow_cards"),i=A(t,"red_cards"),a=A(t,"own_goals"),r=initialEvents[t].goals||[],c=initialEvents[t].assists||[],l=initialEvents[t].yellowCards||[],d=initialEvents[t].redCards||[],u=initialEvents[t].ownGoals||[],m=I(t,"goal_scorers"),h=I(t,"assist_providers"),p=I(t,"yellow_cards"),f=I(t,"red_cards"),g=function(e){let t=`ownGoalsContainer-${e}`,n=[];return $(`#${t}`).find(".own-goal-event-entry.to-be-removed").each(function(){const e=$(this).find('input[name="own_goals-stat_id[]"]').val();e&&""!==e.trim()&&n.push(e)}),n}(t),v=n.filter(e=>!D(e,r)),y=o.filter(e=>!D(e,c)),b=s.filter(e=>!D(e,l)),w=i.filter(e=>!D(e,d)),S=a.filter(e=>!M(e,u)),_=[],E=[],C=[],T=[],x=[];p.length>0&&p.forEach(e=>{const t=l.find(t=>t.stat_id===e);t?C.push(t):C.push({stat_id:e})}),m.length>0&&m.forEach(e=>{const t=r.find(t=>t.stat_id===e);t?_.push(t):_.push({stat_id:e})}),h.length>0&&h.forEach(e=>{const t=c.find(t=>t.stat_id===e);t?E.push(t):E.push({stat_id:e})}),f.length>0&&f.forEach(e=>{const t=d.find(t=>t.stat_id===e);t?T.push(t):T.push({stat_id:e})}),g.length>0&&g.forEach(e=>{const t=u.find(t=>t.stat_id===e);t?x.push(t):x.push({stat_id:e})}),r.forEach(e=>{D(e,n)||_.some(t=>t.stat_id===e.stat_id)||_.push(e)}),c.forEach(e=>{D(e,o)||E.some(t=>t.stat_id===e.stat_id)||E.push(e)}),l.forEach(e=>{D(e,s)||C.some(t=>t.stat_id===e.stat_id)||C.push(e)}),d.forEach(e=>{D(e,i)||T.some(t=>t.stat_id===e.stat_id)||T.push(e)}),u.forEach(e=>{M(e,a)||x.some(t=>t.stat_id===e.stat_id)||x.push(e)}),Swal.fire({title:"Confirm Submission",text:"Are you sure you want to submit this match report?",icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, submit it!"}).then(n=>{n.isConfirmed&&function(t,n,o,s,i,a,r,c,l,d,u){const m=$("#home_team_score-"+t).val(),h=$("#away_team_score-"+t).val(),p=$("#match_notes-"+t).val(),f=window.currentMatchData?window.currentMatchData.version:null,g=$(`#verifyHomeTeam-${t}`).is(":checked"),v=$(`#verifyAwayTeam-${t}`).is(":checked"),y=$(`#verifyHomeTeam-${t}`),b=$(`#verifyAwayTeam-${t}`);let w=[];if(y.length>0&&!g){const e=window.currentMatchData?window.currentMatchData.home_team_name:"Home Team";w.push(e)}if(b.length>0&&!v){const e=window.currentMatchData?window.currentMatchData.away_team_name:"Away Team";w.push(e)}w.length>0&&(y.length>0||b.length>0)&&!g&&!v?Swal.fire({icon:"warning",title:"Verification Required",text:"Please verify the match results for your team before submitting.",confirmButtonText:"OK"}):$.ajax({url:`/teams/report_match/${t}`,method:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({home_team_score:m,away_team_score:h,notes:p,goals_to_add:n,goals_to_remove:o,assists_to_add:s,assists_to_remove:i,yellow_cards_to_add:a,yellow_cards_to_remove:r,red_cards_to_add:c,red_cards_to_remove:l,own_goals_to_add:d,own_goals_to_remove:u,verify_home_team:g,verify_away_team:v,version:f}),success:function(n){if(n.success){let o="Your match report has been submitted successfully.";n.home_team_verified&&n.away_team_verified?o="Match report submitted and fully verified by both teams.":(n.home_team_verified||n.away_team_verified)&&(o="Match report submitted and verified by one team.",o+=g||v?" Thank you for verifying!":" The other team still needs to verify."),Swal.fire({icon:"success",title:"Success!",text:o}).then(()=>{try{const e=document.getElementById(`reportMatchModal-${t}`);if(e){const t=bootstrap.Modal.getInstance(e);t?t.hide():$(e).modal("hide")}}catch(e){}location.reload()})}else Swal.fire({icon:"error",title:"Error!",text:n.message||"There was an error submitting your report."}).then(()=>{$(`#submitBtn-${t}`).prop("disabled",!1)})},error:function(n,o,s){let i="An unexpected error occurred while submitting your report.",a="Error!",r=!1;if(409===n.status)try{"version_conflict"===JSON.parse(n.responseText).error_type&&(a="Match Updated by Another User",i="This match was modified by another user while you were editing. Please refresh to get the latest data and try again.",r=!0)}catch(e){}else n.responseJSON&&n.responseJSON.message&&(i=n.responseJSON.message);const c={icon:"warning",title:a,text:i};r&&(c.showCancelButton=!0,c.confirmButtonText="Refresh Page",c.cancelButtonText="Cancel"),Swal.fire(c).then(e=>{e.isConfirmed&&r?location.reload():$(`#submitBtn-${t}`).prop("disabled",!1)})}})}(t,v,_,y,E,b,C,w,T,S,x)})}),window.addOwnGoalEvent=function(e,t,n=null,o=null,s=null){var i="#"+t,a=n?String(n):"new-"+Date.now()+"-"+Math.random(),r=window["homeTeamName_"+e],c=window["awayTeamName_"+e],l=window["homeTeamId_"+e],d=window["awayTeamId_"+e];if(!r||!c){const t="#reportMatchModal-"+e,n=document.querySelector(t);if(n){const e=n.querySelector(".modal-title");if(e){const t=e.textContent.match(/Match:\s*(.+?)\s+vs\s+(.+)$/);t&&(r=t[1].trim(),c=t[2].trim())}}window.currentMatchData&&window.currentMatchData.matchId==e&&(r=window.currentMatchData.home_team_name,c=window.currentMatchData.away_team_name,l=window.currentMatchData.home_team?window.currentMatchData.home_team.id:null,d=window.currentMatchData.away_team?window.currentMatchData.away_team.id:null)}r||(r="Home Team"),c||(c="Away Team");var u=`\n        <div class="input-group mb-2 player-event-entry" data-unique-id="${a}">\n            <input type="hidden" name="own_goals-stat_id[]" value="${n||""}">\n            <select class="form-select select-own-goal-team" name="own_goals-team_id[]">\n                <option value="${l}"${o==l?" selected":""}>${r}</option>\n                <option value="${d}"${o==d?" selected":""}>${c}</option>\n            </select>\n            <input type="text" class="form-control input-minute-compact" name="own_goals-minute[]"\n                   placeholder="Min"\n                   value="${s||""}"\n                   pattern="^\\d{1,3}(\\+\\d{1,2})?$"\n                   title="Enter a valid minute (e.g., '45' or '45+2')">\n            <button class="btn btn-danger btn-sm" type="button" data-action="remove-own-goal">Ã</button>\n        </div>\n    `;$(i).append(u),"undefined"!=typeof feather&&feather&&"undefined"!=typeof feather&&feather.replace()},window.removeOwnGoalEvent=function(e){if(!e)return;let t=null,n=null;try{if(e instanceof Element&&(t=e.closest(".own-goal-event-entry")||e.closest(".input-group"),t&&(n=$(t))),!t||!n){const t=(Element,$(e));n=t.closest(".own-goal-event-entry"),n.length||(n=t.closest(".input-group"))}}catch(s){return}if(!n||!n.length)return;const o=n.find('input[name="own_goals-stat_id[]"]').val();o&&""!==o.trim()&&!o.startsWith("new-")?n.addClass("to-be-removed").hide():n.remove()},document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("rsvp-data");if(!e)return;e.getAttribute("data-player-id");const t=e.getAttribute("data-discord-id"),n=e.getAttribute("data-csrf-token");function s(e,i,a=0){const r=this.currentOperationId||"web_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);this.currentOperationId=r,fetch("/api/v2/rsvp/update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify({match_id:parseInt(e),availability:i,operation_id:r,source:"discord",discord_id:t})}).then(e=>{if(!e.ok)throw new Error(`HTTP error ${e.status}`);return e.text().then(e=>{try{return JSON.parse(e)}catch(o){throw new Error("Invalid JSON response")}})}).then(e=>{if(this.currentOperationId=null,e.message&&e.match_id)Swal.fire({icon:"success",title:"RSVP Updated",text:e.message||"Your RSVP status has been updated!",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}),window.location.pathname.includes("/matches/")&&setTimeout(()=>window.location.reload(),1e3);else{if(e.error)throw new Error(e.error);if(!e.success)throw new Error(e.message||"Failed to update RSVP");Swal.fire({icon:"success",title:"RSVP Updated",text:"Your RSVP status has been updated!",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}),window.location.pathname.includes("/matches/")&&setTimeout(()=>window.location.reload(),1e3)}}).catch(t=>{a<2&&(t.message.includes("HTTP error 5")||t.message.includes("NetworkError"))?setTimeout(()=>{console.log(`Retrying RSVP update (attempt ${a+1}/2)`),s(e,i,a+1)},1e3*Math.pow(2,a)):(this.currentOperationId=null,Swal.fire({icon:"error",title:"RSVP Error",text:`Could not update your RSVP: ${t.message}`,toast:!0,position:"top-end",showConfirmButton:!0,confirmButtonText:"Retry",timer:8e3}).then(t=>{t.isConfirmed&&(this.currentOperationId=null,s(e,i,0))}))})}const i={};document.querySelectorAll(".btn-check.rsvp-input").forEach(function(e){e.addEventListener("click",function(e){const t=e.target.name.split("-")[1],n=e.target.value;i[t]===n?(e.target.checked=!1,s(t,"no_response"),i[t]=null):(s(t,n),i[t]=n)})}),function(){try{const e=document.querySelectorAll(".btn-check.rsvp-input");if(!e||0===e.length)return;[...new Set([...e].map(e=>{const t=e.name?e.name.split("-"):[];return t.length>1?t[1]:null}).filter(e=>e&&"undefined"!==e&&""!==e.trim()))].forEach(e=>{e&&"undefined"!==e&&fetch(`/rsvp/status/${e}`,{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":n}}).then(e=>{if(!e.ok)throw new Error(`HTTP error ${e.status}`);return e.text().then(e=>{try{return JSON.parse(e)}catch(o){throw new Error("Invalid JSON response")}})}).then(t=>{if(t&&t.response){const n=document.querySelector(`input[name="response-${e}"][value="${t.response}"]`);n&&(n.checked=!0,i[e]=t.response)}}).catch(e=>{})})}catch(e){}}()}),document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){var e=document.getElementById("page-loader");e&&(e.classList.add("hidden"),setTimeout(function(){e&&e.parentNode&&e.parentNode.removeChild(e)},500))},800),document.getElementById("assignSubModalRSVP")&&function(){try{if(window.jQuery){var e=window.jQuery;if(0===e("#assignSubModalRSVP").length)return;e("#assignSubModalRSVP").on("shown.bs.modal",function(){var t=e("#subPlayerRSVP");t.find("option:not(:first)").remove(),t.append('<option value="loading" disabled>Loading substitute responses...</option>');var n,o,s=e('input[name="match_id"]').val();s.startsWith("ecs_")?(n="ecs",o=s.substring(4)):(n="regular",o=s),fetch(`/api/substitute-pools/responses/${n}/${o}`).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(n=>{t.find('option[value="loading"]').remove(),n.success&&n.substitutes&&n.substitutes.length>0?(n.has_responses&&e(".form-text").html('<i class="ti ti-info-circle me-1"></i> <span class="text-success">Green = Available</span>, <span class="text-muted">Gray = No Response</span>, <span class="text-danger">Red = Not Available</span>'),n.substitutes.forEach(function(e){var n=new Option(e.name,e.id);"available"===e.response_status?(n.className="text-success fw-bold",n.textContent=`â ${e.name}`):"not_available"===e.response_status?(n.className="text-danger",n.textContent=`â ${e.name}`):(n.className="text-muted",n.textContent=`- ${e.name}`),t.append(n)})):t.append('<option value="" disabled>No substitutes found</option>')}).catch(e=>{console.error("Error fetching substitute responses:",e),t.find('option[value="loading"]').remove(),t.append('<option value="" disabled>Error loading substitutes</option>'),window.toastr&&toastr.error("Failed to load substitute responses. Please try again.")})}),e("#assignSubFormRSVP").on("submit",function(t){t.preventDefault();var n=new FormData(this),o=e(this).find('button[type="submit"]'),s=o.html();o.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Assigning...'),fetch(this.action,{method:"POST",body:n,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{if(e.success){window.Swal?Swal.fire({title:"Success!",text:e.message||"Substitute assigned successfully.",icon:"success",timer:1500,showConfirmButton:!1}).then(()=>{window.location.reload()}):window.toastr?(toastr.success(e.message||"Substitute assigned successfully."),setTimeout(()=>window.location.reload(),1500)):(alert("Substitute assigned successfully."),window.location.reload());var t=document.querySelector('[data-modal="assign-sub"]');window.bootstrap&&t&&bootstrap.Modal.getInstance(t).hide()}else window.Swal?Swal.fire({title:"Error",text:e.message||"Failed to assign substitute.",icon:"error"}):window.toastr?toastr.error(e.message||"Failed to assign substitute."):alert("Error: "+(e.message||"Failed to assign substitute."))}).catch(e=>{window.toastr?toastr.error("An error occurred while assigning the substitute."):alert("An error occurred while assigning the substitute.")}).finally(()=>{o.prop("disabled",!1).html(s)})})}}catch(o){}}(),document.getElementById("requestSubModal")&&function(){try{var e=document.getElementById("requestSubModal"),t=document.getElementById("team_id");if(!e||!t)return;if(t.options.length>1)return;var n=document.querySelector("#requestSubModal .alert-info .mb-0");if(!n)return;var s=(n.textContent||"").split(" vs ");if(s.length<2)return;var i=s[0].trim(),a=s[1].split(" - ")[0].trim(),r=e.dataset.homeTeamId,c=e.dataset.awayTeamId;if(r&&c){var l,d,u=document.body.dataset.userRoles||"";return u.includes("Global Admin")||u.includes("Pub League Admin"),(l=document.createElement("option")).value=r,l.text=i,t.appendChild(l),(d=document.createElement("option")).value=c,d.text=a,void t.appendChild(d)}if(document.getElementById("assignSubFormRSVP")){var m=document.getElementById("subTeamRSVP");if(m&&m.options.length>1){for(var h=1;h<m.options.length;h++){var p=m.options[h],f=document.createElement("option");f.value=p.value,f.text=p.text,t.appendChild(f)}return}}var g=document.querySelector('#requestSubForm input[name="match_id"]'),v=g?g.value:"";if(!v)return;fetch("/admin/rsvp_status/"+v).then(e=>e.ok?e.text():null).then(e=>{if(e){var n=document.createElement("div");n.innerHTML=e;var o=n.querySelectorAll("#subTeamRSVP option");if(o.length>1)for(var s=1;s<o.length;s++){var r=o[s],c=document.createElement("option");c.value=r.value,c.text=r.text,t.appendChild(c)}else{var l=document.createElement("option");l.value="home_team",l.text=i,t.appendChild(l);var d=document.createElement("option");d.value="away_team",d.text=a,t.appendChild(d)}}}).catch(e=>{var n=document.createElement("option");n.value="home_team",n.text=i,t.appendChild(n);var o=document.createElement("option");o.value="away_team",o.text=a,t.appendChild(o)})}catch(o){}}();var e=document.getElementById("syncDiscordButton");e&&e.addEventListener("click",function(){var t,n;const o=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="ti ti-loader ti-spin me-1"></i> Syncing...';const s=(null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.getAttribute("content"))||(null==(n=document.querySelector('input[name="csrf_token"]'))?void 0:n.value)||"";fetch("/api/force_discord_sync",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRFToken":s}}).then(e=>e.json()).then(t=>{e.disabled=!1,e.innerHTML=o,t.success?window.toastr?toastr.success("RSVP synchronization with Discord has been triggered.","Sync Started"):window.Swal?Swal.fire({title:"Success!",text:"RSVP synchronization with Discord has been triggered.",icon:"success",timer:3e3,showConfirmButton:!1}):alert("RSVP synchronization with Discord has been triggered."):window.toastr?toastr.error(t.message||"An error occurred syncing with Discord.","Sync Failed"):window.Swal?Swal.fire({title:"Sync Failed",text:t.message||"An error occurred syncing with Discord.",icon:"error"}):alert("Sync Failed: "+(t.message||"An error occurred syncing with Discord."))}).catch(t=>{e.disabled=!1,e.innerHTML=o,window.toastr?toastr.error("Could not connect to the Discord sync service.","Connection Error"):window.Swal?Swal.fire({title:"Connection Error",text:"Could not connect to the Discord sync service.",icon:"error"}):alert("Connection Error: Could not connect to the Discord sync service.")})}),window.jQuery&&jQuery(function(e){try{if(window.toastr&&(toastr.options={closeButton:!0,newestOnTop:!0,progressBar:!0,positionClass:"toast-top-right",timeOut:5e3}),window.bootstrap)for(var t=document.querySelectorAll('[data-bs-toggle="tooltip"]'),n=0;n<t.length;n++)new bootstrap.Tooltip(t[n]);if(e.fn.DataTable){var s={responsive:!0,pageLength:10,lengthMenu:[5,10,25,50],language:{search:"",searchPlaceholder:"Search players..."},drawCallback:function(){B(),P(),q()}};e("#rsvpStatusTable").length&&e("#rsvpStatusTable").DataTable(s),e("#homeTeamTable").length&&e("#homeTeamTable").DataTable(s),e("#awayTeamTable").length&&e("#awayTeamTable").DataTable(s),setTimeout(function(){q()},100),e('[data-datatable="filter"] input').removeClass("form-control-sm").addClass("rounded-pill"),e('[data-datatable="length"] select').removeClass("form-select-sm").addClass("rounded-pill")}P(),B(),function(){try{if(window.jQuery){var e=window.jQuery;e('a[data-bs-toggle="tab"]').on("shown.bs.tab",function(){P(),e.fn.dataTable&&e.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()})}}catch(o){}}()}catch(o){}}),setTimeout(function(){q()},1e3)});let O=class e{constructor(e={}){this.options={discordInviteUrl:"https://discord.gg/weareecs",checkOnLoad:!0,showUrgentPopup:!0,...e},this.options.checkOnLoad&&document.addEventListener("DOMContentLoaded",()=>this.init())}init(){window.discordMembershipStatus?this.handleMembershipStatus(window.discordMembershipStatus):window.discordError?(console.warn("Discord membership check error:",window.discordError),this.showDiscordJoinPrompt("error")):this.showDiscordJoinPrompt("no_info")}handleMembershipStatus(e){e&&!e.in_server?(this.showDiscordJoinPrompt("not_in_server"),this.updateDiscordElements(!1)):e&&e.in_server&&(this.updateDiscordElements(!0),this.showSuccessMessage())}showDiscordJoinPrompt(e="general"){if(!this.options.showUrgentPopup)return;const t=localStorage.getItem("discord_prompt_last_shown"),n=Date.now();if("not_in_server"!==e&&t&&n-parseInt(t)<36e5)return void console.log("Discord prompt rate limited - shown recently");let o,s,i;switch(e){case"not_in_server":o="ð¨ Action Required: Join Discord!",s="<strong>We couldn't find you in our Discord server!</strong>",i="critical";break;case"error":o="â ï¸ Discord Connection Issue",s="We had trouble checking your Discord membership.",i="warning";break;case"no_info":o="ð¢ Join Our Discord Community",s="Connect with us on Discord for the best experience!",i="info";break;case"manual":o="ð¡ Pro Tip: Join Discord First!",s="For the best experience, join our Discord server before registering!",i="info";break;default:o="ð¢ Join Our Discord Community",s="Don't miss out - join our Discord server!",i="info"}const a="critical"===i;Swal.fire({title:o,html:`\n                <div class="text-start">\n                    <p>${s}</p>\n                    <p>This is <strong>${a?"critical":"important"}</strong> because:</p>\n                    <ul class="text-start ms-3">\n                        <li>ð All waitlist notifications are sent through Discord</li>\n                        <li>â¡ You'll miss immediate openings if you're not there</li>\n                        <li>ð Match announcements and league updates</li>\n                        <li>ð¤ Connect with other players and substitutes</li>\n                        <li>ð¬ Get real-time support and community chat</li>\n                    </ul>\n                    <p class="mt-3"><strong>${a?"Don't miss your chance to play!":"Join our community today!"}</strong></p>\n                </div>\n            `,icon:a?"warning":"info",showCancelButton:!0,confirmButtonText:'<i class="ti ti-brand-discord me-2"></i>Join Discord Now',cancelButtonText:a?"I'll Join Later":"Maybe Later",confirmButtonColor:"#5865F2",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):"#6c757d",allowOutsideClick:!a,customClass:{popup:"swal2-discord-popup",confirmButton:"btn-discord-join"}}).then(e=>{localStorage.setItem("discord_prompt_last_shown",n.toString()),e.isConfirmed?this.handleDiscordJoin():a&&this.showReminderMessage()})}handleDiscordJoin(){window.open(this.options.discordInviteUrl,"_blank","noopener,noreferrer"),setTimeout(()=>{Swal.fire({title:"Welcome to ECS!",html:'\n                    <div class="text-start">\n                        <p><strong>Great! You should now be joining our Discord server.</strong></p>\n                        <p>After joining, make sure to:</p>\n                        <ul class="text-start ms-3">\n                            <li>ð Check the <code>#waitlist</code> channel for updates</li>\n                            <li>ð Introduce yourself in <code>#general</code></li>\n                            <li>ð Turn on notifications for important channels</li>\n                        </ul>\n                        <p class="mt-2">We\'ll notify you there when spots become available!</p>\n                    </div>\n                ',icon:"info",confirmButtonText:"Got it!",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"#198754"})},2e3)}showReminderMessage(){Swal.fire({title:"Important Reminder",text:"Remember to join our Discord server soon! You won't receive waitlist notifications without it.",icon:"info",confirmButtonText:"I Understand",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"#198754",timer:5e3,timerProgressBar:!0})}showSuccessMessage(){this.options.showSuccessMessage&&setTimeout(()=>{Swal.fire({title:"â All Set!",text:"Great! You're already in our Discord server and will receive all notifications.",icon:"success",timer:3e3,timerProgressBar:!0,showConfirmButton:!1})},1e3)}updateDiscordElements(e){const t={card:document.getElementById("discord-info-card"),title:document.getElementById("discord-status-title"),message:document.getElementById("discord-status-message"),footer:document.getElementById("discord-status-footer"),button:document.getElementById("discord-join-btn")};Object.values(t).some(e=>null!==e)&&(e?this.setSuccessState(t):this.setWarningState(t))}setSuccessState(e){e.card&&(e.card.className="alert alert-success mb-4"),e.title&&(e.title.innerHTML="â Great! You're in our Discord Server"),e.message&&(e.message.innerHTML="Perfect! You'll receive all waitlist notifications and updates through Discord. Make sure to check:"),e.footer&&(e.footer.innerHTML="<strong>You're all set!</strong>"),e.button&&(e.button.innerHTML='<i class="ti ti-brand-discord me-2"></i>Visit Discord Server',e.button.className="btn btn-success",e.button.href=this.options.discordInviteUrl)}setWarningState(e){e.card&&(e.card.className="alert alert-warning mb-4"),e.title&&(e.title.innerHTML="â ï¸ Critical: You're Not in Our Discord Server!"),e.message&&(e.message.innerHTML="<strong>This is important!</strong> You must join our Discord server to receive waitlist notifications. This is where we:"),e.footer&&(e.footer.innerHTML="<strong>Join now or you'll miss opportunities!</strong>"),e.button&&(e.button.innerHTML='<i class="ti ti-brand-discord me-2"></i>Join Discord Now - Don\'t Miss Out!',e.button.className="btn btn-warning btn-lg btn-pulse-warning",e.button.href=this.options.discordInviteUrl)}static showJoinPrompt(t={}){new e({checkOnLoad:!1,showUrgentPopup:!0,...t}).showDiscordJoinPrompt("manual")}};const N=document.createElement("style");function R(){const e=document.getElementById("selectAll");document.querySelectorAll(".match-checkbox").forEach(t=>{t.checked=e.checked})}let F;function H(){fetch("/admin/redis/api/stats").then(e=>e.json()).then(e=>{var t,n,o,s;if(e.error)return void console.error("Error fetching stats:",e.error);const i=(null==(t=e.health)?void 0:t.overall)?"redis-health-healthy":"redis-health-unhealthy",a=(null==(n=e.health)?void 0:n.overall)?"All connections healthy":"Connection issues detected";document.getElementById("health-status").innerHTML=`<span class="redis-health-indicator ${i}"></span>${a}`,document.getElementById("decoded-status").textContent=(null==(o=e.health)?void 0:o.decoded_client)?"â":"â",document.getElementById("raw-status").textContent=(null==(s=e.health)?void 0:s.raw_client)?"â":"â",e.pool_stats&&(document.getElementById("max-connections").textContent=e.pool_stats.max_connections||0,document.getElementById("utilization").textContent=(e.pool_stats.utilization_percent||0)+"%",document.getElementById("created-connections").textContent=e.pool_stats.created_connections||0,document.getElementById("available-connections").textContent=e.pool_stats.available_connections||0,document.getElementById("in-use-connections").textContent=e.pool_stats.in_use_connections||0),e.server_metrics&&(document.getElementById("connected-clients").textContent=e.server_metrics.connected_clients||"N/A",document.getElementById("memory-usage").textContent=e.server_metrics.used_memory_human||"N/A",document.getElementById("commands-processed").textContent=e.server_metrics.total_commands_processed||"N/A",document.getElementById("ops-per-sec").textContent=e.server_metrics.instantaneous_ops_per_sec||"N/A"),document.getElementById("last-updated").textContent="Last updated: "+(new Date).toLocaleTimeString()}).catch(e=>{console.error("Error updating stats:",e)})}function j(){const e=document.getElementById("test-btn"),t=e.textContent;e.textContent="Testing...",e.disabled=!0,fetch("/admin/redis/test-connection").then(e=>e.json()).then(e=>{const t=document.getElementById("test-results");if(e.error)t.innerHTML=`<div class="alert alert-danger">Error: ${e.error}</div>`;else{let n='<div class="row">';for(const[t,o]of Object.entries(e.tests)){const e="success"===o.status?"bg-success":"bg-danger";n+=`\n                        <div class="col-md-4 mb-2">\n                            <div class="card">\n                                <div class="card-body">\n                                    <h6>${t.replace("_"," ").toUpperCase()}</h6>\n                                    <span class="badge ${e}">${o.status}</span>\n                                    <p class="mt-2 mb-0"><small>${o.message}</small></p>\n                                </div>\n                            </div>\n                        </div>\n                    `}n+="</div>",t.innerHTML=n}}).catch(e=>{document.getElementById("test-results").innerHTML=`<div class="alert alert-danger">Error running tests: ${e}</div>`}).finally(()=>{e.textContent=t,e.disabled=!1})}function z(){const e=document.getElementById("cleanup-btn"),t=e.textContent;e.textContent="Cleaning...",e.disabled=!0,fetch("/admin/redis/connection-cleanup").then(e=>e.json()).then(e=>{e.error?alert("Error during cleanup: "+e.error):(alert("Connection cleanup completed successfully"),H())}).catch(e=>{alert("Error during cleanup: "+e)}).finally(()=>{e.textContent=t,e.disabled=!1})}N.textContent="\n    .swal2-discord-popup .swal2-html-container {\n        text-align: left !important;\n    }\n\n    .btn-discord-join {\n        background-color: #5865F2 !important; /* Discord brand color - intentional */\n        border-color: #5865F2 !important;\n    }\n\n    .swal2-discord-popup code {\n        background-color: var(--ecs-neutral-5, #f8f9fa);\n        padding: 2px 4px;\n        border-radius: 3px;\n        font-family: monospace;\n        font-size: 0.9em;\n        color: var(--ecs-neutral-60, #495057);\n    }\n",document.head.appendChild(N),window.DiscordMembershipChecker=O,(window.location.pathname.includes("waitlist_confirmation")||window.location.pathname.includes("auth")||document.querySelector('[data-discord-check="auto"]'))&&(window.discordChecker=new O),function(){const e=300,t="[data-modal], .modal",n="[data-modal-body], .modal-body",s=".modal-backdrop",i='[data-action], .btn, .c-btn, button[class*="btn-"]',a="modal-open",r="show",c="modal-active",l="show",d="hide",u="ios-scroll",m="ios-modal-open",h="d-none",p={_initialized:!1,init:function(e){(e=e||document)===document&&this._initialized||(console.log("[Modal Helpers] Initializing..."),this.initMobileViewportFix(),e===document&&(this.registerModalEventHandlers(),this._initialized=!0),console.log("[Modal Helpers] Initialization complete"),console.log("[Modal Helpers] iOS device:",this.isIOS()),console.log("[Modal Helpers] Mobile device:",this.isMobile()))},isIOS:function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},isMobile:function(){return window.innerWidth<=767},ensureModalInitialized:function(e){const t=document.getElementById(e);return t?"undefined"!=typeof ModalManager?ModalManager.getInstance(t.id):bootstrap.Modal.getInstance(t):(console.warn(`[Modal Helpers] Modal element #${e} not found`),null)},loadModalsIfNotFound:function(){return new Promise((e,t)=>{if(!window.jQuery)return console.warn("[Modal Helpers] jQuery not available for modal loading"),void t(new Error("jQuery not available"));jQuery.ajax({url:"/modals/render_modals",method:"GET",success:function(t){jQuery("body").append(t),console.log("[Modal Helpers] Modals loaded dynamically"),"undefined"!=typeof ModalManager&&ModalManager.reinit(),e(!0)},error:function(e){console.error("[Modal Helpers] Failed to load modals:",e),t(e)}})})},cleanupModalBackdrop:function(){document.querySelectorAll(s).forEach(t=>{t.classList.remove(l),t.classList.add(d),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},e)}),document.body.classList.remove(a),document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"),document.querySelectorAll(`${t}.${r}`).forEach(e=>{try{const t=bootstrap.Modal.getInstance(e);t?t.hide():(e.classList.remove(r),e.setAttribute("aria-hidden","true"),e.classList.add(h))}catch(o){console.error("[Modal Helpers] Error closing modal:",o)}}),console.log("[Modal Helpers] Backdrop cleanup complete")},disableIOSScrolling:function(){if(!this.isIOS())return;const e=window.scrollY;document.body.dataset.scrollPosition=e.toString(),document.body.classList.add(a,m),document.body.style.setProperty("--scroll-y",`${e}px`),console.log("[Modal Helpers] iOS scrolling disabled")},enableIOSScrolling:function(){if(!this.isIOS())return;const e=parseInt(document.body.dataset.scrollPosition||"0",10);document.body.classList.remove(a,m),document.body.style.removeProperty("--scroll-y"),window.scrollTo(0,e),delete document.body.dataset.scrollPosition,console.log("[Modal Helpers] iOS scrolling enabled")},updateMobileViewportHeight:function(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)},initMobileViewportFix:function(){if(this.updateMobileViewportHeight(),this._viewportFixSetup)return;let e;this._viewportFixSetup=!0,window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>this.updateMobileViewportHeight(),100)}),console.log("[Modal Helpers] Mobile viewport height fix initialized")},applyButtonTransformFix:function(e){const t=(e=e||document).querySelectorAll(i);t.forEach(e=>{"true"!==e.dataset.transformFixed&&(e.dataset.transformFixed="true",e.classList.add("transform-none","transition-colors"),e.disabled||e.classList.contains("disabled")||e.classList.add("cursor-pointer"))}),console.log(`[Modal Helpers] Transform fix applied to ${t.length} buttons`)},registerModalEventHandlers:function(){const o=this;document.addEventListener("show.bs.modal",function(e){const t=e.target;t.classList.add(c),o.isIOS()&&o.disableIOSScrolling(),o.applyButtonTransformFix(t),console.log("[Modal Helpers] Modal show handler executed")}),document.addEventListener("shown.bs.modal",function(e){const t=e.target;if(o.isIOS()){const e=t.querySelector(n);e&&e.classList.add(u)}console.log("[Modal Helpers] Modal shown handler executed")}),document.addEventListener("hide.bs.modal",function(e){e.target.classList.remove(c),console.log("[Modal Helpers] Modal hide handler executed")}),document.addEventListener("hidden.bs.modal",function(e){o.cleanupModalBackdrop(),o.isIOS()&&o.enableIOSScrolling(),console.log("[Modal Helpers] Modal hidden handler executed")}),document.addEventListener("keydown",function(n){"Escape"===n.key&&document.querySelector(`${t}.${r}`)&&setTimeout(()=>o.cleanupModalBackdrop(),e)}),console.log("[Modal Helpers] Event handlers registered")}};void 0!==window.InitSystem?window.InitSystem.register("ModalHelpers",{priority:25,init:function(e){p.init(e)}}):"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){p.init(document)}):p.init(document),window.ModalHelpers=p}(),$(document).ready(function(){"true"===$("#manualReviewData").data("needs-review")&&$("#manualReviewModal").modal("show")}),window.adminSetVerificationCode=function(){if(confirm("ADMIN ONLY: Are you sure you want to generate a manual verification code?")){var e=document.querySelector('input[name="phone"]'),t=document.getElementById("verificationCodeInput");if(!e||!e.value.trim())return;fetch("/set_verification_code",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":document.querySelector('input[name="csrf_token"]').value},body:JSON.stringify({})}).then(function(e){return e.json()}).then(function(e){e.success?(t.classList.remove("d-none"),t.classList.add("d-block"),alert("Verification code: "+e.code)):alert("Error: "+(e.message||"Failed to set verification code"))}).catch(function(e){alert("Error: "+e)})}},document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("smsNotifications"),t=document.getElementById("smsConsent");e&&t&&e.checked&&(function(){const e=document.getElementById("smsOptInSection");e.classList.remove("d-none"),e.classList.add("d-block")}(),t.checked&&function(){const e=document.getElementById("smsVerificationSection");e.classList.remove("d-none"),e.classList.add("d-block")}())}),document.addEventListener("DOMContentLoaded",function(){function e(){document.querySelectorAll(".table-responsive table").forEach(e=>{if(e.dataset.labeled)return;const t=Array.from(e.querySelectorAll("thead th")).map(e=>e.textContent.trim());e.querySelectorAll("tbody tr").forEach(e=>{Array.from(e.querySelectorAll("td")).forEach((e,n)=>{t[n]&&!e.hasAttribute("data-label")&&e.setAttribute("data-label",t[n])})}),e.dataset.labeled="true"})}e(),"undefined"!=typeof $&&$(document).on("ajaxComplete",e)}),console.log("[admin-discord-management] Loaded - using event delegation system"),function(){function e(e){const t=e.target.closest("[data-action]");if(t)switch(t.dataset.action){case"load-assignments":e.preventDefault(),function(e){const t=e.dataset.playerId,n=document.querySelector(`[data-component="assignments-container"][data-player-id="${t}"]`);if(!n)return;const i=n.querySelector("[data-spinner]"),a=n.querySelector('[data-role="assignments-list"]');if(!a.classList.contains("u-hidden"))return a.classList.add("u-hidden"),void o(e,"ti-calendar-stats","View Assignments");i.classList.remove("u-hidden"),e.disabled=!0,fetch(`/admin/subs/player/${t}`).then(e=>e.json()).then(t=>{t.success?(function(e,t){if(0===t.length)return void(e.innerHTML='<div class="alert alert-info" data-alert>No active assignments found.</div>');let n='<div class="list-group">';t.forEach(e=>{const t=new Date(e.match_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});n+=`\n                <div class="list-group-item list-group-item-action c-assignment-item" data-assignment-id="${e.id}">\n                    <div class="c-assignment-item__header">\n                        <span class="c-assignment-item__title">${e.home_team_name} vs ${e.away_team_name}</span>\n                        <span class="c-badge c-badge--primary">${t}</span>\n                    </div>\n                    <div class="c-assignment-item__footer">\n                        <span class="c-assignment-item__team">\n                            <i class="ti ti-users"></i> ${e.team_name}\n                        </span>\n                        <button class="btn btn-sm btn-outline-danger"\n                                data-action="remove-assignment"\n                                data-assignment-id="${e.id}"\n                                title="Remove assignment">\n                            <i class="ti ti-trash"></i>\n                        </button>\n                    </div>\n                </div>`}),n+="</div>",e.innerHTML=n,"undefined"!=typeof bootstrap&&[...e.querySelectorAll('[data-bs-toggle="tooltip"]')].map(e=>new bootstrap.Tooltip(e))}(a,t.assignments),a.classList.remove("u-hidden"),o(e,"ti-calendar-minus","Hide Assignments")):s("error","Failed to load assignments.")}).catch(e=>{console.error("Error loading assignments:",e),s("error","An error occurred while loading assignments.")}).finally(()=>{i.classList.add("u-hidden"),e.disabled=!1})}(t);break;case"assign-sub":e.preventDefault(),function(e){const t=e.dataset.playerId,n=e.dataset.playerName;document.getElementById("subPlayer").value=t,document.getElementById("assignSubModalLabel").innerHTML=`<i class="ti ti-user-plus me-2"></i>Assign ${n} as Substitute`,new bootstrap.Modal(document.getElementById("assignSubModal")).show()}(t);break;case"remove-assignment":e.preventDefault(),function(e){const t=e.dataset.assignmentId;if(!confirm("Are you sure you want to remove this sub assignment?"))return;const n=new FormData;n.append("csrf_token",window.subsPageData.csrfToken),fetch(`/admin/subs/remove/${t}`,{method:"POST",body:new URLSearchParams(n),headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(t=>{if(t.success){s("success",t.message);const n=e.closest(".c-assignment-item");n.style.opacity="0",n.style.transition="opacity 300ms ease",setTimeout(()=>{n.remove();const t=e.closest('[data-role="assignments-list"]');t&&0===t.querySelectorAll(".c-assignment-item").length&&(t.innerHTML='<div class="alert alert-info" data-alert>No active assignments found.</div>')},300)}else s("error",t.message)}).catch(e=>{console.error("Error removing assignment:",e),s("error","An error occurred while trying to remove the assignment.")})}(t)}}function t(e){"match-select"===e.target.dataset.role&&function(e){const t=e.value,n=document.getElementById("subTeam");if(!t)return n.innerHTML='<option value="" selected disabled>Select a team for this match...</option>',void(n.disabled=!0);const o=window.subsPageData.upcomingMatches.find(e=>e.id==t);o&&(n.innerHTML='<option value="" selected disabled>Select a team for this match...</option>',n.innerHTML+=`<option value="${o.home_team_id}">${o.home_team.name}</option>`,n.innerHTML+=`<option value="${o.away_team_id}">${o.away_team.name}</option>`,n.disabled=!1)}(e.target)}function n(e){const t=e.target;"assignSubForm"===t.id&&(e.preventDefault(),function(e){const t=new FormData(e),n=e.querySelector('[data-action="submit-assign-form"]');n.disabled=!0,n.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Assigning...',fetch(e.action,{method:"POST",body:new URLSearchParams(t),headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(t=>{t.success?(s("success",t.message),bootstrap.Modal.getInstance(document.getElementById("assignSubModal")).hide(),e.reset(),document.getElementById("subTeam").disabled=!0,document.getElementById("subTeam").innerHTML='<option value="" selected disabled>Select a team for this match...</option>',setTimeout(()=>{window.location.reload()},1500)):s("error",t.message)}).catch(e=>{console.error("Error assigning sub:",e),s("error","An error occurred while trying to assign the sub.")}).finally(()=>{n.disabled=!1,n.innerHTML='<i class="ti ti-user-plus me-1"></i>Assign Substitute'})}(t))}function o(e,t,n){e.innerHTML=`<i class="ti ${t} me-1"></i> ${n}`}function s(e,t){"undefined"!=typeof toastr?toastr[e](t):console.log(`[${e.toUpperCase()}]: ${t}`)}document.addEventListener("DOMContentLoaded",function(){!function(){const e=document.getElementById("page-loader");e&&setTimeout(()=>{e.classList.add("is-hidden")},300)}(),$.fn.DataTable&&document.getElementById("subsTable")&&$("#subsTable").DataTable({responsive:!0,lengthMenu:[10,25,50],dom:'<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>><"row"<"col-sm-12"tr>><"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',language:{search:"",searchPlaceholder:"Search substitutes...",lengthMenu:"_MENU_ per page",info:"Showing _START_ to _END_ of _TOTAL_ subs",infoEmpty:"No substitutes found",infoFiltered:"(filtered from _MAX_ total subs)",zeroRecords:"No matching substitutes found"},columnDefs:[{orderable:!1,targets:[3,4]}]}),document.addEventListener("click",e),document.addEventListener("change",t),document.addEventListener("submit",n)})}(),function(){function e(e){const c=e.target.closest("[data-action]");if(c)switch(c.dataset.action){case"schedule-match":e.preventDefault(),t(c);break;case"stop-session":e.preventDefault(),n(c);break;case"refresh-session":e.preventDefault(),function(e){const t=e.dataset.sessionId||window.matchDetailData.sessionId;t?(i(e,!0),fetch(`/admin/live-reporting/api/session/${t}/refresh`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s()}}).then(e=>e.json()).then(t=>{t.success?(a(t.message||"Session refreshed"),setTimeout(()=>location.reload(),1e3)):(r(t.error||"Failed to refresh session"),i(e,!1))}).catch(t=>{console.error("[Refresh Session] Error:",t),r("Error refreshing session"),i(e,!1)})):r("Session ID not found")}(c);break;case"force-sync":e.preventDefault(),o(c);break;case"reload-page":e.preventDefault(),i(c,!0),location.reload()}}function t(e){const t=e.dataset.id||window.matchDetailData.matchId;t?confirm("Schedule live reporting for this match?")&&(i(e,!0),fetch(`/admin/live-reporting/api/schedule-match/${t}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s()}}).then(e=>e.json()).then(t=>{t.success?(a(t.message),setTimeout(()=>location.reload(),1500)):(r(t.error||"Failed to schedule match"),i(e,!1))}).catch(t=>{console.error("[Schedule Match] Error:",t),r("Error scheduling match"),i(e,!1)})):r("Match ID not found")}function n(e){const t=e.dataset.id||window.matchDetailData.sessionId;t?confirm("Stop this live reporting session?")&&(i(e,!0),fetch(`/admin/live-reporting/api/session/${t}/stop`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s()}}).then(e=>e.json()).then(t=>{t.success?(a(t.message),setTimeout(()=>location.reload(),1500)):(r(t.error||"Failed to stop session"),i(e,!1))}).catch(t=>{console.error("[Stop Session] Error:",t),r("Error stopping session"),i(e,!1)})):r("Session ID not found")}function o(e){confirm("Force synchronization with real-time service?")&&(i(e,!0),fetch("/admin/live-reporting/api/force-sync",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s()}}).then(e=>e.json()).then(t=>{t.success?(a(t.message||"Sync successful"),setTimeout(()=>location.reload(),1500)):(r(t.error||"Sync failed"),i(e,!1))}).catch(t=>{console.error("[Force Sync] Error:",t),r("Error performing sync"),i(e,!1)}))}function s(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const t=document.cookie.split("; ").find(e=>e.startsWith("csrf_token="));return t?t.split("=")[1]:""}function i(e,t){if(t){e.disabled=!0,e.classList.add("is-loading"),e.dataset.originalContent||(e.dataset.originalContent=e.innerHTML);const t=e.querySelector("i");t&&(t.className="fas fa-spinner fa-spin")}else e.disabled=!1,e.classList.remove("is-loading"),e.dataset.originalContent&&(e.innerHTML=e.dataset.originalContent,delete e.dataset.originalContent)}function a(e){"undefined"!=typeof toastr?toastr.success(e):alert(`Success: ${e}`)}function r(e){"undefined"!=typeof toastr?toastr.error(e):alert(`Error: ${e}`)}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",e),console.log("[Match Detail] Initialized with event delegation")}),window.MatchDetail={scheduleMatch:t,stopSession:n,forceSync:o}}(),document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(e){const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action,o=t.dataset.matchId,s=t.dataset.matchName;switch(n){case"view-match-details":!function(e){fetch(`/admin-panel/matches/${e}/details`).then(e=>e.json()).then(e=>{if(e.success){const t=e.match;let n=`\n                    <div class="row">\n                        <div class="col-md-6">\n                            <h6>Match Information</h6>\n                            <p><strong>Teams:</strong> ${t.home_team} vs ${t.away_team}</p>\n                            <p><strong>Date:</strong> ${t.date||"TBD"}</p>\n                            <p><strong>Time:</strong> ${t.time||"TBD"}</p>\n                            <p><strong>Location:</strong> ${t.location}</p>\n                            <p><strong>Status:</strong> <span class="badge bg-primary">${t.status}</span></p>\n                        </div>\n                        <div class="col-md-6">\n                            <h6>League & Season</h6>\n                            <p><strong>League:</strong> ${t.league}</p>\n                            <p><strong>Season:</strong> ${t.season}</p>\n                        </div>\n                    </div>\n                `;t.rsvp_data&&t.rsvp_data.total>0&&(n+=`\n                        <div class="row mt-3">\n                            <div class="col-12">\n                                <h6>RSVP Information</h6>\n                                <p><strong>Total RSVPs:</strong> ${t.rsvp_data.total}</p>\n                                ${t.rsvp_data.status_breakdown?Object.entries(t.rsvp_data.status_breakdown).map(([e,t])=>`<span class="badge bg-secondary me-1">${e}: ${t}</span>`).join(""):""}\n                            </div>\n                        </div>\n                    `),t.team_history&&t.team_history.length>0&&(n+=`\n                        <div class="row mt-3">\n                            <div class="col-12">\n                                <h6>Recent Head-to-Head</h6>\n                                <div class="table-responsive">\n                                    <table class="table table-sm">\n                                        <thead><tr><th>Date</th><th>Match</th><th>Status</th></tr></thead>\n                                        <tbody>\n                                            ${t.team_history.map(e=>`<tr><td>${e.date}</td><td>${e.home_team} vs ${e.away_team}</td><td>${e.status}</td></tr>`).join("")}\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    `),Swal.fire({title:"Match Details",html:n,width:"700px",confirmButtonText:"Close"})}else Swal.fire("Error","Could not load match details","error")}).catch(e=>{console.error("Error:",e),Swal.fire("Error","Could not load match details","error")})}(o);break;case"delete-match":!function(e,t){Swal.fire({title:"Delete Match?",text:`Are you sure you want to delete "${t}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, delete it!"}).then(t=>{t.isConfirmed&&fetch(`/admin-panel/matches/${e}/delete`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Deleted!","Match has been deleted.","success").then(()=>{location.reload()}):Swal.fire("Error",e.error||"Could not delete match","error")}).catch(e=>{console.error("Error:",e),Swal.fire("Error","Could not delete match","error")})})}(o,s);break;case"duplicate-match":Swal.fire({title:"Duplicate Match",text:"This will create a copy of the match. You can edit the details after creation.",showCancelButton:!0,confirmButtonText:"Duplicate"}).then(e=>{e.isConfirmed&&Swal.fire("Duplicated!","Match has been duplicated. Redirecting to edit...","success")});break;case"schedule-match":Swal.fire("Schedule Match","Match scheduling functionality would be implemented here.","info");break;case"postpone-match":Swal.fire("Postpone Match","Match postponement functionality would be implemented here.","info");break;case"cancel-match":Swal.fire({title:"Cancel Match",text:"Are you sure you want to cancel this match?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, cancel it!"}).then(e=>{e.isConfirmed&&Swal.fire("Cancelled!","Match has been cancelled.","success")});break;case"bulk-actions":!function(){const e=function(){const e=document.querySelectorAll(".match-checkbox:checked");return Array.from(e).map(e=>parseInt(e.value))}();0!==e.length?Swal.fire({title:"Bulk Actions",text:`Perform action on ${e.length} selected matches:`,input:"select",inputOptions:{update_status:"Update Status",delete:"Delete Matches",export:"Export Selected"},showCancelButton:!0,confirmButtonText:"Execute"}).then(t=>{var n;t.isConfirmed&&("delete"===t.value?(n=e,Swal.fire({title:"Confirm Bulk Delete",text:`Are you sure you want to delete ${n.length} matches? This cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, delete them!"}).then(e=>{e.isConfirmed&&fetch("/admin-panel/matches/bulk-actions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete",match_ids:n})}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Success!",e.message,"success").then(()=>{location.reload()}):Swal.fire("Error",e.error,"error")}).catch(e=>{console.error("Error:",e),Swal.fire("Error","Could not perform bulk delete","error")})})):"update_status"===t.value?function(e){Swal.fire({title:"Update Status",text:"Select new status for selected matches:",input:"select",inputOptions:{scheduled:"Scheduled",live:"Live",completed:"Completed",cancelled:"Cancelled",postponed:"Postponed"},showCancelButton:!0,confirmButtonText:"Update"}).then(t=>{t.isConfirmed&&fetch("/admin-panel/matches/bulk-actions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update_status",match_ids:e,status:t.value})}).then(e=>e.json()).then(e=>{e.success?Swal.fire("Success!",e.message,"success").then(()=>{location.reload()}):Swal.fire("Error",e.error,"error")}).catch(e=>{console.error("Error:",e),Swal.fire("Error","Could not update status","error")})})}(e):"export"===t.value&&function(e){Swal.fire("Export Started",`Export of ${e.length} selected matches has been queued.`,"info")}(e))}):Swal.fire("No Selection","Please select matches to perform bulk actions.","warning")}();break;case"export-matches":Swal.fire({title:"Export Matches",text:"Choose export format:",input:"select",inputOptions:{csv:"CSV",xlsx:"Excel",json:"JSON"},showCancelButton:!0,confirmButtonText:"Export"}).then(e=>{e.isConfirmed&&Swal.fire("Export Started",`Export in ${e.value.toUpperCase()} format has been queued.`,"info")});break;case"bulk-schedule-matches":Swal.fire("Bulk Schedule","Bulk scheduling functionality would be implemented here.","info")}});const e=document.getElementById("selectAll");e&&e.addEventListener("change",R)}),document.addEventListener("DOMContentLoaded",function(){setInterval(n,3e4);const e=document.getElementById("refresh-stats");e&&e.addEventListener("click",function(){n(),this.innerHTML='<i class="fas fa-sync-alt fa-spin"></i> Refreshing...',setTimeout(()=>{this.innerHTML='<i class="fas fa-sync-alt"></i> Refresh'},1e3)});const t=document.getElementById("test-cache");function n(){var e;const t=null==(e=document.getElementById("refresh-stats"))?void 0:e.dataset.refreshUrl;t&&fetch(t).then(e=>e.json()).then(e=>{e.error||location.reload()}).catch(e=>console.error("Error refreshing stats:",e))}t&&t.addEventListener("click",function(){!function(){const e=document.getElementById("test-cache"),t=document.getElementById("test-result"),n=null==e?void 0:e.dataset.testUrl;e&&n&&(e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Testing...',e.disabled=!0,fetch(n).then(e=>e.json()).then(e=>{"success"===e.status?t.innerHTML='<div class="alert alert-success"><i class="fas fa-check"></i> '+e.message+"</div>":t.innerHTML='<div class="alert alert-danger"><i class="fas fa-times"></i> '+e.message+"</div>"}).catch(e=>{t.innerHTML='<div class="alert alert-danger"><i class="fas fa-times"></i> Cache test failed: '+e+"</div>"}).finally(()=>{e.innerHTML='<i class="fas fa-vial"></i> Test Cache Connection',e.disabled=!1}))}()})}),$(document).ready(function(){function e(){const e=$("#title").val()||"Poll Title",t=$("#question").val()||"Your poll question will appear here...";$("#preview-title").text(e),$("#preview-question").text(t)}$("#title, #question").on("input",e),e()}),$(document).ready(function(){$.fn.DataTable.isDataTable("#pollsTable")&&$("#pollsTable").DataTable().destroy(),$("#pollsTable").DataTable({order:[[3,"desc"]],pageLength:25,responsive:!0,columnDefs:[{orderable:!1,targets:[5]}]})}),function(){const e={init(){this.initializeSelect2(),this.setupRoleChangeHandler()},initializeSelect2(){"undefined"!=typeof $&&void 0!==$.fn.select2?$("#permissions").select2({placeholder:"Select permissions...",width:"100%",theme:"bootstrap-5",closeOnSelect:!1}):console.warn("Select2 or jQuery not available. Using basic select.")},setupRoleChangeHandler(){const e=document.getElementById("role_id");e&&(e.addEventListener("change",()=>{const t=e.value;t&&this.loadRolePermissions(t)}),e.value&&this.loadRolePermissions(e.value))},loadRolePermissions(e){var t,n;const o=(null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.getAttribute("content"))||(null==(n=document.querySelector('[name="csrf_token"]'))?void 0:n.value);fetch("/admin/get_role_permissions",{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":o},credentials:"same-origin"}).then(t=>{const n=new URL(t.url);return n.searchParams.append("role_id",e),fetch(n.toString())}).then(e=>{if(!e.ok)throw new Error("Failed to load role permissions");return e.json()}).then(e=>{const t=document.getElementById("permissions");t&&("undefined"!=typeof $&&void 0!==$.fn.select2?$("#permissions").val(e.permissions).trigger("change"):Array.from(t.options).forEach(t=>{t.selected=e.permissions.includes(t.value)}))}).catch(e=>{console.error("Error loading role permissions:",e),this.showAlert("Failed to load permissions for the selected role.","danger")})},showAlert(e,t="info"){const n=document.querySelector('[data-component="alerts"]');if(!n)return;const o=document.createElement("div");o.className=`c-alert c-alert--${t}`,o.setAttribute("role","alert"),o.setAttribute("data-alert",""),o.innerHTML=`\n                <i class="ti ti-${"success"===t?"check-circle":"alert-circle"} c-alert__icon"></i>\n                <span class="c-alert__text">${e}</span>\n            `,n.appendChild(o),setTimeout(()=>{o.remove()},5e3)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e.init()):e.init()}(),function(){const e={init(){this.setupEventDelegation(),this.setupModalHandlers(),this.setupFormValidation()},setupEventDelegation(){document.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(t)switch(t.dataset.action){case"open-add-team-modal":this.handleOpenAddTeamModal(t);break;case"open-edit-team-modal":this.handleOpenEditTeamModal(t);break;case"delete-team":this.handleDeleteTeam(t)}})},setupModalHandlers(){const e=document.getElementById("addTeamModal");e&&e.addEventListener("show.bs.modal",t=>{const n=t.relatedTarget;if(!n)return;const o=n.dataset.leagueName,s=n.dataset.seasonId,i=n.dataset.seasonName,a=e.querySelector("#modal_league_name"),r=e.querySelector("#modal_season_id");a&&(a.value=o),r&&(r.value=s);const c=e.querySelector(".modal-title");c&&(c.textContent=`Add Team to ${o} (${i})`)});const t=document.getElementById("editTeamModal");t&&t.addEventListener("show.bs.modal",e=>{const n=e.relatedTarget;if(!n)return;const o=n.dataset.teamId,s=n.dataset.teamName,i=n.dataset.leagueName,a=n.dataset.seasonId,r=t.querySelector("#edit_team_name"),c=t.querySelector("#modal_team_id"),l=t.querySelector("#edit_modal_league_name"),d=t.querySelector("#edit_modal_season_id");r&&(r.value=s),c&&(c.value=o),l&&(l.value=i),d&&(d.value=a);const u=t.querySelector(".modal-title");u&&(u.textContent=`Edit Team: ${s}`)})},setupFormValidation(){document.querySelectorAll(".needs-validation").forEach(e=>{e.addEventListener("submit",t=>{e.checkValidity()||(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")})})},handleOpenAddTeamModal(e){},handleOpenEditTeamModal(e){},handleDeleteTeam(e){const t=e.dataset.teamId,n=e.dataset.teamName;"undefined"!=typeof Swal?Swal.fire({title:"Are you sure?",html:`Do you really want to delete <strong>${n}</strong>?<br><br><span class="text-danger">This action cannot be undone.</span>`,icon:"warning",showCancelButton:!0,confirmButtonColor:this.getThemeColor("danger","#dc3545"),cancelButtonColor:this.getThemeColor("secondary","#6c757d"),confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(e=>{e.isConfirmed&&this.deleteTeam(t)}):confirm(`Do you really want to delete ${n}?\n\nThis action cannot be undone.`)&&this.deleteTeam(t)},deleteTeam(e){var t,n;const o=document.createElement("form");o.method="POST",o.action="/publeague/delete_team";const s=(null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.getAttribute("content"))||(null==(n=document.querySelector('[name="csrf_token"]'))?void 0:n.value);if(s){const e=document.createElement("input");e.type="hidden",e.name="csrf_token",e.value=s,o.appendChild(e)}const i=document.createElement("input");i.type="hidden",i.name="team_id",i.value=e,o.appendChild(i),document.body.appendChild(o),o.submit()},getThemeColor:(e,t)=>"undefined"!=typeof ECSTheme&&ECSTheme.getColor?ECSTheme.getColor(e):getComputedStyle(document.documentElement).getPropertyValue(`--ecs-${e}`).trim()||t};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e.init()):e.init()}(),document.addEventListener("DOMContentLoaded",function(){!function(){const e=document.getElementById("refresh-btn");e&&(e.addEventListener("click",H),document.getElementById("test-btn").addEventListener("click",j),document.getElementById("cleanup-btn").addEventListener("click",z),document.getElementById("auto-refresh").addEventListener("change",function(){this.checked?F=setInterval(H,5e3):clearInterval(F)}),document.getElementById("auto-refresh").checked&&(F=setInterval(H,5e3)),H())}()});let W=null,U=null,Y=null;function X(){const e=document.getElementById("approvalForm"),t=new FormData(e),n=document.getElementById("approvalUserId").value;if(!n)return void Z("User ID is required");if(!t.get("league_type"))return void Z("Please select a league");const o=document.querySelector('[data-action="approve-user"]'),s=o.innerHTML;o.disabled=!0,o.innerHTML='<i class="ti ti-loader"></i> Processing...',fetch(`/admin/user-approvals/approve/${n}`,{method:"POST",body:t,headers:{"X-CSRFToken":J()}}).then(e=>e.json()).then(e=>{e.success?(Q(e.message),G(n),K(),W.hide()):Z(e.message||"Error processing approval")}).catch(e=>{console.error("Error:",e),Z("Network error occurred")}).finally(()=>{o.disabled=!1,o.innerHTML=s})}function V(){const e=document.getElementById("denialForm"),t=new FormData(e),n=document.getElementById("denialUserId").value;if(!n)return void Z("User ID is required");const o=t.get("notes");if(!o||o.trim().length<10)return void Z("Please provide a detailed reason for denial (at least 10 characters)");const s=document.querySelector('[data-action="deny-user"]'),i=s.innerHTML;s.disabled=!0,s.innerHTML='<i class="ti ti-loader"></i> Processing...',fetch(`/admin/user-approvals/deny/${n}`,{method:"POST",body:t,headers:{"X-CSRFToken":J()}}).then(e=>e.json()).then(e=>{e.success?(Q(e.message),G(n),K(),U.hide()):Z(e.message||"Error processing denial")}).catch(e=>{console.error("Error:",e),Z("Network error occurred")}).finally(()=>{s.disabled=!1,s.innerHTML=i})}function G(e){const t=document.querySelector('[data-role="approval-table"]');t&&t.querySelectorAll('[data-role="user-row"]').forEach(n=>{const o=n.getAttribute("data-user-id");o&&parseInt(o)===parseInt(e)&&(n.classList.add("fade-out"),setTimeout(()=>{n.remove(),0===t.querySelectorAll('[data-role="user-row"]').length&&function(){const e=document.querySelector('[data-role="table-container"]');e&&(e.innerHTML='\n            <div class="text-center py-4">\n                <i class="ti ti-users empty-table-icon"></i>\n                <h6 class="mt-3">No pending approvals</h6>\n                <p class="text-muted">All users have been processed</p>\n            </div>\n        ')}()},300))})}function K(){fetch("/admin/user-approvals/stats").then(e=>e.json()).then(e=>{if(e.success){const t=e.stats,n=document.querySelector('[data-role="stats-card"][data-status="pending"]'),o=document.querySelector('[data-role="stats-card"][data-status="approved"]'),s=document.querySelector('[data-role="stats-card"][data-status="denied"]'),i=document.querySelector('[data-role="stats-card"][data-status="total"]');if(n){const e=n.querySelector('[data-role="stats-number"]');e&&(e.textContent=t.pending)}if(o){const e=o.querySelector('[data-role="stats-number"]');e&&(e.textContent=t.approved)}if(s){const e=s.querySelector('[data-role="stats-number"]');e&&(e.textContent=t.denied)}if(i){const e=i.querySelector('[data-role="stats-number"]');e&&(e.textContent=t.total)}const a=document.querySelector('[data-role="pending-count-badge"]');a&&(a.textContent=`${t.pending} pending`)}}).catch(e=>{console.error("Error updating stats:",e)})}function J(){var e,t;const n=(null==(e=document.querySelector("meta[name=csrf-token]"))?void 0:e.getAttribute("content"))||"";return n||((null==(t=document.cookie.split("; ").find(e=>e.startsWith("csrf_token=")))?void 0:t.split("=")[1])||"")}function Q(e){"undefined"!=typeof Swal?Swal.fire({icon:"success",title:"Success!",text:e,showConfirmButton:!1,timer:3e3,toast:!0,position:"top-end"}):alert(e)}function Z(e){"undefined"!=typeof Swal?Swal.fire({icon:"error",title:"Error!",text:e,showConfirmButton:!0}):alert("Error: "+e)}document.addEventListener("DOMContentLoaded",function(){!function(){const e=document.getElementById("approvalModal"),t=document.getElementById("denialModal"),n=document.getElementById("playerDetailsModal");e&&(W=ModalManager.getInstance("approvalModal")),t&&(U=ModalManager.getInstance("denialModal")),n&&(Y=ModalManager.getInstance("playerDetailsModal"))}(),function(){const e=document.getElementById("approvalForm"),t=document.getElementById("denialForm");e&&e.addEventListener("submit",function(e){e.preventDefault(),X()}),t&&t.addEventListener("submit",function(e){e.preventDefault(),V()})}()}),window.showApprovalModal=function(e){W?(document.getElementById("approvalForm").reset(),document.getElementById("approvalUserId").value=e,W.show(),setTimeout(()=>{document.getElementById("leagueSelect").focus()},300)):Z("Modal not initialized")},window.showDenialModal=function(e){U?(document.getElementById("denialForm").reset(),document.getElementById("denialUserId").value=e,U.show(),setTimeout(()=>{document.getElementById("denialNotes").focus()},300)):Z("Modal not initialized")},window.submitApproval=X,window.submitDenial=V,window.refreshStats=function(){const e=document.querySelector('[data-action="refresh-stats"]');if(e){const t=e.innerHTML;e.innerHTML='<i class="ti ti-loader"></i> Refreshing...',e.disabled=!0,setTimeout(()=>{K(),e.innerHTML=t,e.disabled=!1},1e3)}},window.showPlayerDetails=function(e){Y?(document.getElementById("playerDetailsContent").innerHTML='<div class="text-center py-4"><i class="ti ti-loader ti-spin"></i> Loading player details...</div>',Y.show(),fetch(`/admin/user-approvals/user/${e}`).then(e=>e.json()).then(e=>{if(e.success){const t=e.user,n=t.player;let o='<div class="player-details-header">';n&&n.profile_picture_url?o+=`<img src="${n.profile_picture_url}" alt="${n.name}" class="player-details-image">`:o+=`<div class="player-details-avatar">${t.username.charAt(0).toUpperCase()}</div>`,o+='<div class="player-details-info">',o+=`<h3>${t.username}</h3>`,n&&(o+=`<p class="text-muted mb-2">${n.name}</p>`),o+=`<p class="mb-0">${t.email}</p>`,o+="</div>",o+="</div>",o+='<div class="player-details-section">',o+="<h5>Account Information</h5>",o+='<div class="info-grid">',o+='<div class="info-item">',o+='<div class="info-label">Registration Date</div>',o+=`<div class="info-value">${t.created_at?new Date(t.created_at).toLocaleDateString():"Unknown"}</div>`,o+="</div>",o+='<div class="info-item">',o+='<div class="info-label">Status</div>',o+='<div class="info-value"><span data-badge data-status="pending">Pending Approval</span></div>',o+="</div>",n&&n.discord_id&&(o+='<div class="info-item">',o+='<div class="info-label">Discord ID</div>',o+=`<div class="info-value"><code>${n.discord_id}</code></div>`,o+="</div>"),o+='<div class="info-item">',o+='<div class="info-label">Current Roles</div>',o+='<div class="info-value">',o+=t.roles.map(e=>`<span data-badge data-role="user-role">${e}</span>`).join(""),o+="</div>",o+="</div>",o+="</div>",o+="</div>",n&&(o+='<div class="player-details-section">',o+="<h5>Player Information</h5>",o+='<div class="info-grid">',n.pronouns&&(o+='<div class="info-item">',o+='<div class="info-label">Pronouns</div>',o+=`<div class="info-value">${n.pronouns}</div>`,o+="</div>"),n.phone&&(o+='<div class="info-item">',o+='<div class="info-label">Phone</div>',o+=`<div class="info-value">${n.phone}</div>`,o+="</div>"),n.jersey_size&&(o+='<div class="info-item">',o+='<div class="info-label">Jersey Size</div>',o+=`<div class="info-value">${n.jersey_size}</div>`,o+="</div>"),n.favorite_position&&(o+='<div class="info-item">',o+='<div class="info-label">Favorite Position</div>',o+=`<div class="info-value">${n.favorite_position}</div>`,o+="</div>"),"approved"===t.approval_status?(o+='<div class="info-item">',o+='<div class="info-label">Player Status</div>',o+=`<div class="info-value">${n.is_current_player?'<span data-badge data-status="active">Active</span>':'<span data-badge data-status="inactive">Inactive</span>'}</div>`,o+="</div>",n.is_coach&&(o+='<div class="info-item">',o+='<div class="info-label">Coach Status</div>',o+='<div class="info-value"><span data-badge data-role="coach">Coach</span></div>',o+="</div>"),n.is_sub&&(o+='<div class="info-item">',o+='<div class="info-label">Substitute Status</div>',o+='<div class="info-value"><span data-badge data-role="substitute">Substitute</span></div>',o+="</div>")):(o+='<div class="info-item">',o+='<div class="info-label">Player Status</div>',o+='<div class="info-value"><span data-badge data-status="pending">Awaiting Approval</span></div>',o+="</div>"),o+="</div>",o+="</div>"),document.getElementById("playerDetailsContent").innerHTML=o;const s=document.getElementById("profileLink");n?(s.href=`/players/profile/${n.id}`,s.classList.remove("profile-link-hidden"),s.classList.add("profile-link-visible")):(s.classList.remove("profile-link-visible"),s.classList.add("profile-link-hidden"))}else document.getElementById("playerDetailsContent").innerHTML='<div class="text-center text-danger py-4">Error loading player details</div>'}).catch(e=>{console.error("Error loading details:",e),document.getElementById("playerDetailsContent").innerHTML='<div class="text-center text-danger py-4">Error loading player details</div>'})):Z("Details modal not initialized")};const ee=function(){let e=null;async function t(){n(!0);try{const t=await fetch("/api/calendar/subscription",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error("Failed to load subscription");const n=await t.json();e=n,function(){if(!e)return;const t=document.getElementById("subscriptionUrl");t&&(t.value=e.feed_url||"");const n=e.webcal_url,o=e.feed_url,s=document.getElementById("subscribeWebcal");s&&n&&(s.dataset.webcalUrl=n);const i=document.getElementById("subscribeGoogle");i&&o&&(i.dataset.feedUrl=o);const a=document.getElementById("subIncludeMatches");a&&(a.checked=!1!==e.include_team_matches);const r=document.getElementById("subIncludeLeagueEvents");r&&(r.checked=!1!==e.include_league_events);const c=document.getElementById("subIncludeRefAssignments");c&&(c.checked=!1!==e.include_ref_assignments);const l=document.getElementById("subLastAccessed");if(l&&e.last_accessed){const t=new Date(e.last_accessed);l.textContent=t.toLocaleDateString()+" "+t.toLocaleTimeString()}else l&&(l.textContent="Never");const d=document.getElementById("subAccessCount");d&&(d.textContent=e.access_count||0)}()}catch(t){console.error("Error loading subscription:",t),function(e){const t=document.getElementById("subscriptionError");t&&(t.textContent=e,t.classList.remove("u-hidden"))}("Failed to load calendar subscription settings")}finally{n(!1)}}function n(e){const t=document.getElementById("subscriptionLoading"),n=document.getElementById("subscriptionContent");t&&t.classList.toggle("u-hidden",!e),n&&n.classList.toggle("u-hidden",e)}return{init:function(){t()},loadSubscription:t,getCardHTML:function(e={}){const{isReferee:t=!1}=e;return`\n        <div class="js-settings-card u-card u-mb-4" id="calendarSubscriptionCard">\n            <div class="u-card-header u-flex u-align-center u-pb-2 u-border-bottom">\n                <div class="js-settings-icon u-bg-info u-bg-opacity-10 u-text-info u-me-3">\n                    <i class="ti ti-calendar-share"></i>\n                </div>\n                <div>\n                    <h5 class="u-card-title u-mb-0">Calendar Subscription</h5>\n                    <small class="u-text-muted">Sync your schedule to Google, Apple, or Outlook</small>\n                </div>\n            </div>\n            <div class="u-card-body u-pt-3">\n                \x3c!-- Loading State --\x3e\n                <div id="subscriptionLoading" class="u-text-center u-py-4">\n                    <div class="u-spinner u-text-primary" role="status">\n                        <span class="u-visually-hidden">Loading...</span>\n                    </div>\n                    <p class="u-text-muted u-mt-2 u-mb-0">Loading subscription...</p>\n                </div>\n\n                \x3c!-- Error State --\x3e\n                <div id="subscriptionError" class="u-alert u-alert-danger u-hidden"></div>\n\n                \x3c!-- Content --\x3e\n                <div id="subscriptionContent" class="u-hidden">\n                    \x3c!-- Subscription URL --\x3e\n                    <div class="u-mb-3">\n                        <label class="u-form-label u-fw-semibold">Your Subscription URL</label>\n                        <div class="u-input-group">\n                            <input type="text" class="u-form-control" id="subscriptionUrl" readonly\n                                   placeholder="Loading...">\n                            <button class="js-copy-btn u-btn u-btn-outline-primary" type="button" id="copySubscriptionUrl"\n                                    data-action="copy-subscription-url">\n                                <i class="ti ti-copy u-me-1"></i>Copy\n                            </button>\n                        </div>\n                        <small class="u-text-muted">This is your personal calendar feed URL. Keep it private.</small>\n                    </div>\n\n                    \x3c!-- Quick Subscribe Buttons --\x3e\n                    <div class="u-mb-4">\n                        <label class="u-form-label u-fw-semibold">Quick Subscribe</label>\n                        <div class="u-flex u-gap-2 u-flex-wrap">\n                            <button type="button" class="js-subscribe-webcal u-btn u-btn-outline-secondary" id="subscribeWebcal"\n                                    data-action="subscribe-webcal">\n                                <i class="ti ti-device-mobile u-me-1"></i>iOS / macOS\n                            </button>\n                            <button type="button" class="js-subscribe-google u-btn u-btn-outline-secondary" id="subscribeGoogle"\n                                    data-action="subscribe-google">\n                                <i class="ti ti-brand-google u-me-1"></i>Google Calendar\n                            </button>\n                        </div>\n                        <small class="u-text-muted u-block u-mt-2">\n                            For Outlook: Copy the URL above and add it as a subscription calendar.\n                        </small>\n                    </div>\n\n                    \x3c!-- Preferences --\x3e\n                    <div class="u-mb-4">\n                        <label class="u-form-label u-fw-semibold">Include in Calendar</label>\n                        <div class="u-form-check u-form-switch u-mb-2">\n                            <input class="u-form-check-input" type="checkbox" id="subIncludeMatches" checked\n                                   data-on-change="update-calendar-preferences">\n                            <label class="u-form-check-label" for="subIncludeMatches">\n                                <i class="ti ti-ball-football u-me-1"></i>Team Matches\n                            </label>\n                        </div>\n                        <div class="u-form-check u-form-switch u-mb-2">\n                            <input class="u-form-check-input" type="checkbox" id="subIncludeLeagueEvents" checked\n                                   data-on-change="update-calendar-preferences">\n                            <label class="u-form-check-label" for="subIncludeLeagueEvents">\n                                <i class="ti ti-calendar-event u-me-1"></i>League Events\n                            </label>\n                        </div>\n                        ${t?'\n                        <div class="u-form-check u-form-switch u-mb-2">\n                            <input class="u-form-check-input" type="checkbox" id="subIncludeRefAssignments" checked\n                                   data-on-change="update-calendar-preferences">\n                            <label class="u-form-check-label" for="subIncludeRefAssignments">\n                                <i class="ti ti-whistle u-me-1"></i>Referee Assignments\n                            </label>\n                        </div>\n                        ':'<div id="subIncludeRefAssignments" class="u-hidden"></div>'}\n                    </div>\n\n                    \x3c!-- Stats --\x3e\n                    <div class="u-row u-gap-3 u-mb-4">\n                        <div class="u-col-6">\n                            <div class="u-bg-light u-rounded u-p-3 u-text-center">\n                                <small class="u-text-muted u-block">Last Synced</small>\n                                <span class="u-fw-semibold" id="subLastAccessed">Never</span>\n                            </div>\n                        </div>\n                        <div class="u-col-6">\n                            <div class="u-bg-light u-rounded u-p-3 u-text-center">\n                                <small class="u-text-muted u-block">Total Syncs</small>\n                                <span class="u-fw-semibold" id="subAccessCount">0</span>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Security --\x3e\n                    <div class="u-border-top u-pt-3">\n                        <h6 class="u-fw-semibold u-text-muted u-small u-text-uppercase u-mb-2">Security</h6>\n                        <p class="u-text-muted u-small u-mb-3">\n                            If you believe your subscription URL has been compromised, regenerate it below.\n                            This will invalidate your current URL.\n                        </p>\n                        <button type="button" class="js-regenerate-token u-btn u-btn-outline-danger u-btn-sm" id="regenerateSubscriptionToken"\n                                data-action="regenerate-subscription-token">\n                            <i class="ti ti-refresh u-me-1"></i>Regenerate URL\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `}}}();function te(e){return e?e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):e}function ne(){document.querySelectorAll(".js-player-image").forEach(e=>{e.addEventListener("error",function(){const e=this.dataset.fallback||"/static/img/default_player.png";console.log("Image failed to load:",this.src,"- Using fallback:",e),this.src=e}),e.addEventListener("load",function(){console.log("Image loaded successfully:",this.src),"function"==typeof smartCropImage&&smartCropImage(this)})})}function oe(){var e,t,n;const o=(null==(e=document.getElementById("playerSearch"))?void 0:e.value.toLowerCase())||"",s=(null==(t=document.getElementById("positionFilter"))?void 0:t.value.toLowerCase())||"",i=(null==(n=document.getElementById("sortBy"))?void 0:n.value)||"name",a=document.getElementById("available-players"),r=(null==a?void 0:a.querySelectorAll(".col-xl-3, .col-lg-4, .col-md-6, .col-sm-6"))||[];let c=0,l=[];r.forEach(e=>{const t=e.querySelector(".player-card");if(!t)return;const n=t.getAttribute("data-player-name")||"",i=t.getAttribute("data-position")||"";if(o&&!n.includes(o)||s&&i!==s)e.classList.add("d-none"),e.classList.remove("d-block");else{e.classList.add("d-block"),e.classList.remove("d-none"),c++;const o=parseInt(t.getAttribute("data-experience"))||0,s=parseFloat(t.getAttribute("data-attendance"))||0,i=parseInt(t.getAttribute("data-goals"))||0;l.push({element:e,name:n,experience:o,attendance:s,goals:i})}}),l.length>0&&function(e,t){const n=document.getElementById("available-players");n&&(e.sort((e,n)=>{switch(t){case"experience":return n.experience-e.experience;case"attendance":return n.attendance-e.attendance;case"goals":return n.goals-e.goals;default:return e.name.localeCompare(n.name)}}),e.forEach(e=>{n.appendChild(e.element)}))}(l,i),se(c);const d=document.getElementById("emptyState");d&&d.classList.toggle("is-visible",0===c),console.log(`Filtered players: ${c} visible`)}function se(e){const t=document.getElementById("availableCount"),n=document.getElementById("available-players-count");t&&(t.textContent=e),n&&(n.textContent=e)}function ie(e){const t=document.getElementById(`teamPlayers${e}`),n=document.getElementById(`teamCount${e}`);if(t&&n){const o=t.querySelectorAll(".draft-team-player-card").length;n.textContent=`${o} players`,console.log(`Updated team ${e} count to ${o} players`)}}function ae(e,t){document.getElementById("draftPlayerMessage").innerHTML=`Select a team for <strong>${t}</strong>:`;const n=document.getElementById("teamSelect");n.innerHTML='<option value="">Choose a team...</option>',document.querySelectorAll('[id^="teamCount"]').forEach(e=>{const t=e.id.replace("teamCount",""),o=e.parentElement.querySelector(".fw-bold").textContent,s=e.textContent.replace(" players",""),i=document.createElement("option");i.value=t,i.textContent=`${o} (${s})`,n.appendChild(i)}),document.getElementById("confirmDraftBtn").onclick=function(){const t=n.value;if(!t)return void alert("Please select a team!");bootstrap.Modal.getInstance(document.getElementById("draftConfirmModal")).hide();const o=document.querySelector("script[data-league-name]"),s=o?o.getAttribute("data-league-name"):"",i=window.draftEnhancedSocket||window.socket;i&&i.connected&&i.emit("draft_player_enhanced",{player_id:parseInt(e),team_id:parseInt(t),league_name:s}),console.log(`Drafting player ${e} to team ${t}`)},ModalManager.show("draftConfirmModal")}document.addEventListener("DOMContentLoaded",function(){document.getElementById("calendarSubscriptionCard")&&ee.init()}),void 0!==t&&t.exports&&(t.exports=ee),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("duplicate-check-form"),t=document.getElementById("player_id"),n=document.getElementById("action");document.querySelectorAll(".claim-account-btn").forEach(o=>{o.addEventListener("click",function(){const o=this.getAttribute("data-player-id"),s=this.getAttribute("data-player-name"),i=this.getAttribute("data-player-email");Swal.fire({title:"Claim This Account?",html:`\n                    <p class="mb-2">You're claiming the account for:</p>\n                    <div class="text-start border rounded p-3 bg-light">\n                        <strong>${s}</strong><br>\n                        <small class="text-muted">${i}</small>\n                    </div>\n                    <p class="mt-3 mb-0 small text-muted">\n                        We'll send a verification email to <strong>${i}</strong> to confirm this is your account.\n                    </p>\n                `,icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"var(--ecs-primary)",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):"#6c757d",confirmButtonText:'<i class="ti ti-mail me-1"></i>Send Verification Email',cancelButtonText:"Cancel",customClass:{popup:"text-start"}}).then(s=>{s.isConfirmed&&(t.value=o,n.value="claim",Swal.fire({title:"Sending Verification Email...",text:"Please wait while we process your request.",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}}),e.submit())})})});const o=document.getElementById("create-new-btn");o&&o.addEventListener("click",function(){Swal.fire({title:"Create New Account?",text:"This will create a brand new profile for you. Are you sure none of the existing profiles are yours?",icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"var(--ecs-success)",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):"#6c757d",confirmButtonText:'<i class="ti ti-user-plus me-1"></i>Yes, Create New Account',cancelButtonText:"Let me check again"}).then(o=>{o.isConfirmed&&(t.value="",n.value="new",Swal.fire({title:"Creating Your Account...",text:"Please wait while we set up your new profile.",icon:"info",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}}),e.submit())})}),document.querySelectorAll(".duplicate-option").forEach(e=>{e.addEventListener("mouseenter",function(){this.classList.add("card-hover")}),e.addEventListener("mouseleave",function(){this.classList.remove("card-hover")})})}),function(){function e(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.content:""}async function t(t,n,o){if("undefined"==typeof Swal)return void console.warn("SweetAlert2 not available for substitute request");const s=await Swal.fire({title:"Request Substitute",html:'\n                <div class="mb-3">\n                    <label class="form-label">Number of subs needed:</label>\n                    <input type="number" id="subs-needed" class="form-control" value="1" min="1" max="5" data-form-control>\n                </div>\n                <div class="mb-3">\n                    <label class="form-label">Positions needed:</label>\n                    <input type="text" id="positions" class="form-control" placeholder="e.g., Forward, Midfielder" data-form-control>\n                </div>\n                <div class="mb-3">\n                    <label class="form-label">Notes (optional):</label>\n                    <textarea id="notes" class="form-control" rows="3" placeholder="Any additional information..." data-form-control></textarea>\n                </div>\n            ',showCancelButton:!0,confirmButtonText:"Request Sub",preConfirm:()=>({substitutes_needed:document.getElementById("subs-needed").value,positions_needed:document.getElementById("positions").value,notes:document.getElementById("notes").value})});if(s.isConfirmed)try{let i;const a=new FormData,r=e();a.append("csrf_token",r),a.append("substitutes_needed",s.value.substitutes_needed),a.append("positions_needed",s.value.positions_needed),a.append("notes",s.value.notes),"ECS FC"===n?i=`/ecs-fc/sub-request/${t}`:(i="/admin/request_sub",a.append("match_id",t),a.append("team_id",o));const c=await fetch(i,{method:"POST",headers:{"X-CSRFToken":r},body:a});if(!(c.ok||c.status>=300&&c.status<400))throw new Error("Failed to request substitute");Swal.fire({icon:"success",title:"Sub Requested!",text:"Substitute request has been created. Notifications are being sent to available substitutes.",timer:2e3,showConfirmButton:!1}).then(()=>window.location.reload())}catch(i){console.error("Error:",i),Swal.fire({icon:"error",title:"Error",text:i.message||"Failed to request substitute"})}}function n(){document.addEventListener("click",function(e){const n=e.target.closest('[data-action="request-sub"]');n&&(e.preventDefault(),t(n.dataset.matchId,n.dataset.leagueType,n.dataset.teamId))}),document.querySelectorAll(".report-match-form").forEach(e=>{e.addEventListener("submit",function(e){e.preventDefault(),async function(e){const t=e.dataset.matchId,n=new FormData(e);try{const o=await fetch(e.action,{method:"POST",body:n}),s=await o.json();if(!s.success)throw new Error(s.message||"Failed to report match");{const e=bootstrap.Modal.getInstance(document.getElementById(`reportMatchModal-${t}`));e&&e.hide(),"undefined"!=typeof Swal?Swal.fire({icon:"success",title:"Match Reported!",timer:2e3,showConfirmButton:!1}).then(()=>window.location.reload()):window.location.reload()}}catch(o){console.error("Error:",o),"undefined"!=typeof Swal?Swal.fire({icon:"error",title:"Error",text:o.message||"Failed to report match"}):alert("Error: "+o.message)}}(this)})}),console.log("Coach Dashboard initialized")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),window.CoachDashboard={requestSub:t,getCsrfToken:e}}(),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("image");if(!e)return;let t;window.onClickUpload=function(){t&&t.getCroppedCanvas({width:300,height:300,imageSmoothingQuality:"high"}).toBlob(function(e){const t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){const e=t.result;document.getElementById("cropped_image_data").value=e,document.querySelector("#profileImageModal form").submit()}},"image/png")},e.addEventListener("change",function(e){!function(e,n){const o=e.target.files;if(o&&o.length>0){const e=URL.createObjectURL(o[0]),s=document.getElementById("imagecan");s.src=e;const i=document.querySelector(".img-container");i.classList.remove("d-none"),i.classList.add("d-block"),t&&t.destroy(),t=new Cropper(s,{viewMode:1,aspectRatio:n,dragMode:"move",autoCropArea:.8,restore:!1,guides:!0,center:!0,highlight:!0,background:!1,responsive:!0,movable:!0,zoomable:!0,rotatable:!1,scalable:!1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!1,checkOrientation:!1})}}(e,1)})}),document.addEventListener("DOMContentLoaded",function(){"loading"in HTMLImageElement.prototype&&document.querySelectorAll('img[loading="lazy"]').forEach(e=>{e.addEventListener("load",function(){this.classList.add("loaded")})}),document.addEventListener("keydown",function(e){var t;"/"===e.key&&(e.preventDefault(),null==(t=document.getElementById("playerSearch"))||t.focus())}),console.log("ð Draft System v2 loaded successfully"),document.querySelectorAll('[id^="teamPlayers"]').forEach(e=>{ie(e.id.replace("teamPlayers",""))}),function(){const e=document.getElementById("playerSearch"),t=document.getElementById("positionFilter"),n=document.getElementById("sortBy");e&&e.addEventListener("input",oe),t&&t.addEventListener("change",oe),n&&n.addEventListener("change",oe)}(),se(document.querySelectorAll("#available-players .player-card").length),document.addEventListener("click",function(e){if(e.target.closest(".js-draft-player")){const t=e.target.closest(".js-draft-player");ae(t.dataset.playerId,t.dataset.playerName)}if(e.target.closest(".js-view-player-profile")&&function(e){const t=document.getElementById("profileLoading");t.classList.add("d-block"),t.classList.remove("d-none"),document.getElementById("profileData").classList.remove("is-visible"),document.getElementById("draftFromModal").classList.remove("is-visible"),ModalManager.show("playerProfileModal"),fetch(`/players/api/player_profile/${e}`).then(e=>e.json()).then(t=>{!function(e,t){const n=document.getElementById("profileLoading");n.classList.add("d-none"),n.classList.remove("d-block");const o=`\n        <div class="p-4 draft-profile-container">\n            \x3c!-- Player Header Info --\x3e\n            <div class="text-center mb-4">\n                <img src="${e.profile_picture_url||"/static/img/default_player.png"}"\n                     alt="${e.name}"\n                     class="rounded-circle border border-3 border-white mb-3 draft-profile-avatar js-player-image"\n                     data-fallback="/static/img/default_player.png">\n                <h4 class="fw-bold mb-1 draft-profile-name">${e.name}</h4>\n                <p class="mb-2 draft-profile-position">${te(e.favorite_position)||"Any Position"}</p>\n\n                \x3c!-- Career Stats Row --\x3e\n                <div class="row text-center mb-4">\n                    <div class="col-3">\n                        <div class="fw-bold text-success fs-5">${e.goals}</div>\n                        <small class="draft-profile-stat-label">Goals</small>\n                    </div>\n                    <div class="col-3">\n                        <div class="fw-bold text-info fs-5">${e.assists}</div>\n                        <small class="draft-profile-stat-label">Assists</small>\n                    </div>\n                    <div class="col-3">\n                        <div class="fw-bold text-warning fs-5">${e.yellow_cards}</div>\n                        <small class="draft-profile-stat-label">Yellow</small>\n                    </div>\n                    <div class="col-3">\n                        <div class="fw-bold text-danger fs-5">${e.red_cards}</div>\n                        <small class="draft-profile-stat-label">Red</small>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Playing Information Section --\x3e\n            <div class="mb-4">\n                <h5 class="pb-2 mb-3 draft-profile-section-header">\n                    <i class="ti ti-info-circle me-2"></i>Playing Information\n                </h5>\n                <div class="row">\n                    <div class="col-md-6">\n                        <div class="mb-2">\n                            <strong class="draft-profile-label">Preferred Position:</strong>\n                            <span class="badge bg-primary ms-1">${te(e.favorite_position)||"Any"}</span>\n                        </div>\n                        ${e.other_positions?`\n                        <div class="mb-2">\n                            <strong class="draft-profile-label">Other Positions:</strong>\n                            <small class="draft-profile-value">${Array.isArray(e.other_positions)?e.other_positions.map(e=>te(e)).join(", "):e.other_positions}</small>\n                        </div>\n                        `:""}\n                        ${e.positions_to_avoid?`\n                        <div class="mb-2">\n                            <strong class="draft-profile-label">Positions to Avoid:</strong>\n                            <small class="draft-profile-value">${e.positions_to_avoid}</small>\n                        </div>\n                        `:""}\n                    </div>\n                    <div class="col-md-6">\n                        ${e.goal_frequency?`\n                        <div class="mb-2">\n                            <strong class="draft-profile-label">Goal Frequency:</strong>\n                            <small class="draft-profile-value">${e.goal_frequency}</small>\n                        </div>\n                        `:""}\n                        ${e.expected_availability?`\n                        <div class="mb-2">\n                            <strong class="draft-profile-label">Expected Availability:</strong>\n                            <small class="draft-profile-value">${e.expected_availability}</small>\n                        </div>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Player Notes --\x3e\n            ${e.player_notes?`\n            <div class="mb-4">\n                <h5 class="pb-2 mb-3 draft-profile-section-header">\n                    <i class="ti ti-notes me-2"></i>Player Notes\n                </h5>\n                <p class="draft-profile-notes">${e.player_notes}</p>\n            </div>\n            `:""}\n\n            \x3c!-- Admin Notes --\x3e\n            ${e.admin_notes?`\n            <div class="mb-3">\n                <h5 class="pb-2 mb-3 draft-profile-section-header">\n                    <i class="ti ti-shield me-2"></i>Admin Notes\n                </h5>\n                <p class="draft-profile-notes">${e.admin_notes}</p>\n            </div>\n            `:""}\n        </div>\n    `;document.getElementById("profileData").innerHTML=o,document.getElementById("profileData").classList.add("is-visible"),ne();const s=document.getElementById("draftFromModal");s.classList.add("is-visible"),s.onclick=()=>{bootstrap.Modal.getInstance(document.getElementById("playerProfileModal")).hide(),ae(t,e.name)}}(t,e)}).catch(e=>{console.error("Error loading player profile:",e),document.getElementById("profileLoading").innerHTML='\n                <div class="text-center py-5">\n                    <i class="ti ti-exclamation-triangle text-warning mb-3 draft-error-icon"></i>\n                    <h5>Error Loading Profile</h5>\n                    <p class="text-muted">Unable to load player information. Please try again.</p>\n                </div>\n            '})}(e.target.closest(".js-view-player-profile").dataset.playerId),e.target.closest(".js-remove-player")){const t=e.target.closest(".js-remove-player");!function(e,t,n,o){if(confirm(`Remove ${n} from ${o}?`)){const n=window.draftEnhancedSocket||window.socket;if(n&&n.connected){const o=document.querySelector("script[data-league-name]"),s=o?o.getAttribute("data-league-name"):window.draftSystemInstance?window.draftSystemInstance.leagueName:"";n.emit("remove_player_enhanced",{player_id:parseInt(e),team_id:parseInt(t),league_name:s})}console.log(`Removing player ${e} from team ${t}`)}}(t.dataset.playerId,t.dataset.teamId,t.dataset.playerName,t.dataset.teamName)}}),document.addEventListener("dragstart",function(e){const t=e.target.closest(".js-draggable-player");if(t){const n=t.dataset.playerId;e.dataTransfer.setData("text/plain",n),e.dataTransfer.effectAllowed="move",t.classList.add("opacity-50","dragging"),document.body.classList.add("is-dragging"),window._draggedPlayerId=n}}),document.addEventListener("dragend",function(e){const t=e.target.closest(".js-draggable-player");t&&(t.classList.remove("opacity-50","dragging"),window._draggedPlayerId=null),document.body.classList.remove("is-dragging")}),document.addEventListener("dragover",function(e){const t=e.target.closest(".js-draft-drop-zone");if(t){e.preventDefault(),e.dataTransfer.dropEffect="move",t.classList.add("drag-over");const n=t.dataset.dropTarget;"available"===n?t.classList.add("drag-over-available"):"team"===n&&t.classList.add("drag-over-team")}}),document.addEventListener("dragleave",function(e){const t=e.target.closest(".js-draft-drop-zone");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-over","drag-over-available","drag-over-team")}),document.addEventListener("drop",function(e){const t=e.target.closest(".js-draft-drop-zone");if(t){e.preventDefault(),t.classList.remove("drag-over","drag-over-available","drag-over-team");const n=e.dataTransfer.getData("text/plain")||window._draggedPlayerId;if(!n)return void console.error("No player ID found in drop event");const o=t.dataset.dropTarget,s=t.dataset.teamId;"team"===o&&s?function(e,t,n){var o,s,i;const a=document.getElementById(`teamPlayers${t}`);if(a&&a.querySelector(`[data-player-id="${e}"]`))return console.log("[DraftEnhanced] Player already on this team in UI"),void(window.draftSystemInstance&&window.draftSystemInstance.showToast("Player is already on this team","warning"));const r=document.querySelector(`[data-player-id="${e}"]`),c=r&&((null==(o=r.querySelector(".fw-bold"))?void 0:o.textContent)||(null==(s=r.querySelector(".fw-semibold"))?void 0:s.textContent))||"Player",l=n.closest(".accordion-item");l&&(null==(i=l.querySelector(".fw-bold"))||i.textContent);const d=document.querySelector("script[data-league-name]"),u=d?d.getAttribute("data-league-name"):window.draftSystemInstance?window.draftSystemInstance.leagueName:"";if(void 0!==window.SocketManager&&window.SocketManager.isConnected())return window.SocketManager.getSocket().emit("draft_player_enhanced",{player_id:parseInt(e),team_id:parseInt(t),league_name:u,player_name:c}),void console.log(`[DraftEnhanced] Drafting player ${e} to team ${t} via SocketManager`);if(window.draftSystemInstance&&window.draftSystemInstance.socket&&window.draftSystemInstance.isConnected)return window.draftSystemInstance.socket.emit("draft_player_enhanced",{player_id:parseInt(e),team_id:parseInt(t),league_name:u,player_name:c}),void console.log(`[DraftEnhanced] Drafting player ${e} to team ${t} via DraftSystemV2`);const m=window.draftEnhancedSocket||window.socket;m&&m.connected?(m.emit("draft_player_enhanced",{player_id:parseInt(e),team_id:parseInt(t),league_name:u,player_name:c}),console.log(`[DraftEnhanced] Drafting player ${e} to team ${t} via global socket`)):(console.error("[DraftEnhanced] No connected socket available - cannot draft"),"undefined"!=typeof Swal?Swal.fire({icon:"warning",title:"Connection Issue",text:"Not connected to server. Please wait a moment and try again.",timer:3e3,showConfirmButton:!0,confirmButtonText:"Refresh Page"}).then(e=>{e.isConfirmed&&window.location.reload()}):alert("Connection error. Please refresh the page."))}(n,s,t):"available"===o&&function(e){var t,n,o;const s=document.querySelector(`[data-player-id="${e}"]`);if(!s)return void console.error("[DraftEnhanced] Player card not found");const i=s.closest('[id^="teamPlayers"]');if(!i)return void console.log("[DraftEnhanced] Player is already in available pool");const a=i.id.replace("teamPlayers","");(null==(t=s.querySelector(".fw-bold"))?void 0:t.textContent)||null==(n=s.querySelector(".fw-semibold"))||n.textContent;const r=i.closest(".accordion-item");r&&(null==(o=r.querySelector(".fw-bold"))||o.textContent);const c=document.querySelector("script[data-league-name]"),l=c?c.getAttribute("data-league-name"):window.draftSystemInstance?window.draftSystemInstance.leagueName:"",d={player_id:parseInt(e),team_id:parseInt(a),league_name:l};if(void 0!==window.SocketManager&&window.SocketManager.isConnected())return window.SocketManager.getSocket().emit("remove_player_enhanced",d),void console.log(`[DraftEnhanced] Undrafting player ${e} from team ${a} via SocketManager`);if(window.draftSystemInstance&&window.draftSystemInstance.socket&&window.draftSystemInstance.isConnected)return window.draftSystemInstance.socket.emit("remove_player_enhanced",d),void console.log(`[DraftEnhanced] Undrafting player ${e} from team ${a} via DraftSystemV2`);const u=window.draftEnhancedSocket||window.socket;u&&u.connected?(u.emit("remove_player_enhanced",d),console.log(`[DraftEnhanced] Undrafting player ${e} from team ${a} via global socket`)):(console.error("[DraftEnhanced] No connected socket available - cannot undraft"),"undefined"!=typeof Swal?Swal.fire({icon:"warning",title:"Connection Issue",text:"Not connected to server. Please wait a moment and try again.",timer:3e3,showConfirmButton:!0,confirmButtonText:"Refresh Page"}).then(e=>{e.isConfirmed&&window.location.reload()}):alert("Connection error. Please refresh the page."))}(n)}}),ne(),function(){if("undefined"==typeof io)return;let e;window.socket?(console.log("[DraftEnhanced] Reusing existing socket (connected:",window.socket.connected,")"),e=window.socket):(console.log("[DraftEnhanced] Creating new socket connection"),e=io("/",{transports:["polling","websocket"],upgrade:!0,withCredentials:!0}),window.socket=e),window.draftEnhancedSocket=e,e.on("player_drafted_enhanced",function(e){if(console.log("[DraftEnhanced] Player drafted event received:",e),window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.handlePlayerDrafted)window.draftSystemInstance.handlePlayerDrafted(e);else{if(e.player&&e.player.id){const t=document.querySelector(`#available-players [data-player-id="${e.player.id}"]`);if(t){const e=t.closest('[data-component="player-column"]');e&&(e.remove(),se(document.querySelectorAll("#available-players .player-card").length))}}e.team_id&&setTimeout(()=>ie(e.team_id),100)}}),e.on("player_removed_enhanced",function(e){console.log("[DraftEnhanced] Player removed event received:",e),window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.handlePlayerRemoved?window.draftSystemInstance.handlePlayerRemoved(e):e.team_id&&setTimeout(()=>ie(e.team_id),100)}),e.on("draft_error",function(e){console.log("[DraftEnhanced] Draft error:",e.message),window.draftSystemInstance&&"function"==typeof window.draftSystemInstance.showToast?window.draftSystemInstance.showToast(e.message,"error"):"undefined"!=typeof Swal?Swal.fire({icon:"error",title:"Draft Error",text:e.message,timer:3e3,showConfirmButton:!1}):alert("Draft Error: "+e.message)})}()});class re{constructor(){this.pendingSaves=new Map,this.saveTimeouts=new Map,this.init()}init(){this.bindEvents(),this.showAutoSaveStatus("saved")}bindEvents(){const e=document.querySelector('input[name="search"]');if(e){let t;e.addEventListener("input",e=>{clearTimeout(t),t=setTimeout(()=>{this.submitFilterForm()},500)})}const t=document.querySelector('select[name="position"]');t&&t.addEventListener("change",e=>{this.submitFilterForm()}),document.addEventListener("change",e=>{e.target.matches(".predicted-round-input, .confidence-input")&&this.handleFieldChange(e.target)}),document.addEventListener("input",e=>{e.target.matches(".notes-input")&&this.handleNotesChange(e.target)}),document.addEventListener("click",e=>{e.target.classList.contains("player-avatar-clickable")&&this.showPlayerImageModal(e.target)})}handleFieldChange(e){const t=e.dataset.playerId;this.autoSavePrediction(t)}handleNotesChange(e){const t=e.dataset.playerId;this.saveTimeouts.has(t)&&clearTimeout(this.saveTimeouts.get(t));const n=setTimeout(()=>{this.autoSavePrediction(t),this.saveTimeouts.delete(t)},500);this.saveTimeouts.set(t,n)}async autoSavePrediction(e){if(this.pendingSaves.has(e))return;const t=this.getPlayerCurrentValues(e);if(t.predicted_round)try{this.pendingSaves.set(e,!0),this.showAutoSaveStatus("saving"),this.updateRowAppearance(e,"saving"),await this.submitPrediction(e,t),this.updateRowAppearance(e,!0),this.showAutoSaveStatus("saved")}catch(n){console.error("Auto-save failed for player",e,n),this.updateRowAppearance(e,"error"),this.showToast("error",`Failed to save prediction for ${this.getPlayerName(e)}`)}finally{this.pendingSaves.delete(e)}else this.updateRowAppearance(e,!1)}getPlayerCurrentValues(e){const t=document.querySelector(`tr[data-player-id="${e}"]`);if(!t)return{};const n=t.querySelector(".predicted-round-input"),o=t.querySelector(".confidence-input"),s=t.querySelector(".notes-input");return{predicted_round:n?n.value:"",confidence_level:o?o.value:"",notes:s?s.value:""}}getPlayerName(e){const t=document.querySelector(`tr[data-player-id="${e}"]`);if(t){const n=t.querySelector(".fw-medium");return n?n.textContent:`Player ${e}`}return`Player ${e}`}updateRowAppearance(e,t){const n=document.querySelector(`tr[data-player-id="${e}"]`);n&&(n.classList.remove("table-success","table-warning","table-danger","is-saving","is-saved","is-error"),"saving"===t?n.classList.add("is-saving"):!0===t?n.classList.add("is-saved"):"error"===t&&n.classList.add("is-error"))}showAutoSaveStatus(e){const t=document.getElementById("autoSaveStatus");if(!t)return;const n=t.querySelector('[data-status="saved"]'),o=t.querySelector('[data-status="saving"]');n&&(n.classList.remove("is-active"),n.classList.add("draft-status-saved")),o&&(o.classList.remove("is-active"),o.classList.add("draft-status-saving")),"saved"===e&&n?n.classList.add("is-active"):"saving"===e&&o&&o.classList.add("is-active")}async submitPrediction(e,t){try{const n=window.location.pathname.split("/").pop(),o={draft_season_id:parseInt(n),player_id:parseInt(e),predicted_round:t.predicted_round?parseInt(t.predicted_round):null,confidence_level:t.confidence_level?parseInt(t.confidence_level):null,notes:t.notes||""};if(!o.predicted_round)throw new Error("Predicted round is required");const s=this.getCSRFToken();console.log("Auto-saving prediction:",o),console.log("CSRF token:",s);const i=await fetch("/draft-predictions/predict",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},body:JSON.stringify(o)});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const a=await i.json();if(console.log("Auto-save response:",a),!a.success)throw new Error(a.message||"Failed to save prediction");return a}catch(n){throw console.error("Error submitting prediction:",n),n}}submitFilterForm(){const e=document.getElementById("filterForm");e&&e.submit()}showToast(e,t){if("undefined"!=typeof Swal){const n="success"===e?"success":"error",o="success"===e?"Success!":"Error";Swal.fire({icon:n,title:o,text:t,timer:3e3,showConfirmButton:!1,toast:!0,position:"top-end"})}else"error"===e&&console.error(t)}getCSRFToken(){const e=document.querySelector('meta[name="csrf-token"]');if(e){const t=e.getAttribute("content");if(t&&t.trim())return t.trim()}const t=document.querySelector('input[name="csrf_token"]');if(t&&t.value)return t.value.trim();const n=document.cookie.split(";");for(let o of n){const[e,t]=o.trim().split("=");if("csrf_token"===e&&t)return t.trim()}return console.error("CSRF token not found"),""}showPlayerImageModal(e){const t=e.dataset.playerName,n=e.dataset.fullImage;if(!n)return void console.log("No full image URL available for player:",t);const o=document.getElementById("playerImageModal"),s=document.getElementById("playerImageModalImg"),i=document.getElementById("playerImageModalName"),a=document.getElementById("playerImageModalLabel");o&&s&&i&&a?(s.src=n,s.alt=t,i.textContent=t,a.textContent=`${t} - Player Photo`,ModalManager.show(o.id),s.onerror=function(){s.src=e.src,console.log("Full image failed to load, using thumbnail")}):console.error("Modal elements not found")}}window.DraftPredictions={setPrediction:function(e,t,n=null,o=""){const s=document.querySelector(`tr[data-player-id="${e}"]`);if(s){const e=s.querySelector(".predicted-round-input"),i=s.querySelector(".confidence-input"),a=s.querySelector(".notes-input");e&&(e.value=t,e.dispatchEvent(new Event("change"))),n&&i&&(i.value=n,i.dispatchEvent(new Event("change"))),o&&a&&(a.value=o,a.dispatchEvent(new Event("input")))}},bulkSetRounds:function(e){Object.entries(e).forEach(([e,t])=>{this.setPrediction(e,t)})}},document.addEventListener("DOMContentLoaded",function(){document.getElementById("playersTable")&&(window.draftPredictionsManager=new re)});let ce,le,de,ue,me=null,he=null,pe=[];function fe(e=!0){fetch(`/api/ecs-fc/teams/${me}/matches?upcoming_only=${e}`).then(e=>e.json()).then(e=>{e.success?(pe=e.data.matches,function(e){const t=document.getElementById("matches-list-container");if(!t)return;if(0===e.length)return void(t.innerHTML='\n            <div class="alert alert-info">\n                <i class="fas fa-info-circle me-2"></i>\n                No matches found. Create your first match using the "Create Match" button.\n            </div>\n        ');const n=e.map(e=>function(e){const t=new Date(e.match_date+"T"+e.match_time),n=t>new Date,o=function(e){switch(e){case"SCHEDULED":return'<span class="badge bg-info match-status-scheduled">Scheduled</span>';case"COMPLETED":return'<span class="badge bg-success match-status-completed">Completed</span>';case"CANCELLED":return'<span class="badge bg-danger match-status-cancelled">Cancelled</span>';default:return'<span class="badge bg-secondary match-status-unknown">Unknown</span>'}}(e.status),s=e.is_home_match?'<span class="badge bg-success match-location-home">Home</span>':'<span class="badge bg-primary match-location-away">Away</span>';return`\n        <div class="card mb-3 js-match-card" data-match-id="${e.id}">\n            <div class="card-header d-flex justify-content-between align-items-center">\n                <h6 class="mb-0">\n                    <i class="fas fa-futbol me-2"></i>\n                    ${e.team_name} vs ${e.opponent_name}\n                </h6>\n                <div>\n                    ${s}\n                    ${o}\n                </div>\n            </div>\n            <div class="card-body">\n                <div class="row">\n                    <div class="col-md-6">\n                        <p class="mb-1"><strong>Date:</strong> ${i=e.match_date,new Date(i).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}</p>\n                        <p class="mb-1"><strong>Time:</strong> ${function(e){const[t,n]=e.split(":"),o=new Date;return o.setHours(parseInt(t),parseInt(n)),o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}(e.match_time)}</p>\n                        <p class="mb-1"><strong>Location:</strong> ${e.location}</p>\n                        ${e.field_name?`<p class="mb-1"><strong>Field:</strong> ${e.field_name}</p>`:""}\n                    </div>\n                    <div class="col-md-6">\n                        <div class="js-rsvp-summary" id="rsvp-summary-${e.id}">\n                            <div class="spinner-border spinner-border-sm" role="status">\n                                <span class="visually-hidden">Loading...</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                ${e.notes?`<div class="mt-2"><strong>Notes:</strong> ${e.notes}</div>`:""}\n                \n                <div class="mt-3 d-flex flex-wrap gap-2">\n                    ${n?`\n                        <button class="btn btn-sm btn-success js-rsvp-btn" data-match-id="${e.id}" data-response="yes">\n                            <i class="fas fa-check me-1"></i>Yes\n                        </button>\n                        <button class="btn btn-sm btn-danger js-rsvp-btn" data-match-id="${e.id}" data-response="no">\n                            <i class="fas fa-times me-1"></i>No\n                        </button>\n                        <button class="btn btn-sm btn-warning js-rsvp-btn" data-match-id="${e.id}" data-response="maybe">\n                            <i class="fas fa-question me-1"></i>Maybe\n                        </button>\n                        <button class="btn btn-sm btn-info js-send-reminder-btn" data-match-id="${e.id}">\n                            <i class="fas fa-bell me-1"></i>Send Reminder\n                        </button>\n                    `:""}\n\n                    <button class="btn btn-sm btn-outline-primary js-edit-match-btn" data-match-id="${e.id}">\n                        <i class="fas fa-edit me-1"></i>Edit\n                    </button>\n                    <button class="btn btn-sm btn-outline-danger js-delete-match-btn" data-match-id="${e.id}">\n                        <i class="fas fa-trash me-1"></i>Delete\n                    </button>\n                </div>\n            </div>\n        </div>\n    `;var i}(e)).join("");t.innerHTML=n,e.forEach(e=>{ge(e.id)})}(pe)):xe("error","Failed to load matches: "+e.message)}).catch(e=>{console.error("Error loading matches:",e),xe("error","Error loading matches")})}function ge(e){fetch(`/api/ecs-fc/matches/${e}/rsvp`).then(e=>e.json()).then(t=>{t.success?function(e,t){const n=document.getElementById(`rsvp-summary-${e}`);if(!n)return;const o=t.yes+t.no+t.maybe+t.no_response,s=o>0?((t.yes+t.no+t.maybe)/o*100).toFixed(0):0;n.innerHTML=`\n        <div class="js-rsvp-counts">\n            <small class="text-muted">RSVP Status:</small>\n            <div class="d-flex justify-content-between mt-1">\n                <span class="badge bg-success rsvp-status-yes">â ${t.yes}</span>\n                <span class="badge bg-danger rsvp-status-no">â ${t.no}</span>\n                <span class="badge bg-warning rsvp-status-maybe">? ${t.maybe}</span>\n                <span class="badge bg-secondary rsvp-status-none">- ${t.no_response}</span>\n            </div>\n            <small class="text-muted">${s}% responded</small>\n        </div>\n    `}(e,t.data.rsvp_summary):console.error("Failed to load RSVP summary:",t.message)}).catch(e=>{console.error("Error loading RSVP summary:",e)})}function ve(e=null){const t=document.getElementById("createMatchModal");if(!t)return;const n=document.getElementById("ecs-fc-match-form");if(n&&(n.reset(),e)){const t=n.querySelector('[name="match_date"]');t&&(t.value=e.toISOString().split("T")[0])}ModalManager.show(t.id)}function ye(e){e.preventDefault();const t=e.target,n=new FormData(t),o=Object.fromEntries(n.entries());o.is_home_match="on"===n.get("is_home_match"),o.team_id=me;const s=t.dataset.matchId;fetch(s?`/api/ecs-fc/matches/${s}`:"/api/ecs-fc/matches",{method:s?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(e=>e.json()).then(e=>{if(e.success){xe("success",e.message);const t=bootstrap.Modal.getInstance(document.getElementById("createMatchModal"));t&&t.hide(),fe(),he&&he.refetchEvents()}else xe("error","Failed to save match: "+e.message)}).catch(e=>{console.error("Error saving match:",e),xe("error","Error saving match")})}function be(e){const t=pe.find(t=>t.id==e);if(!t)return;const n=document.getElementById("ecs-fc-match-form");if(!n)return;n.dataset.matchId=e,n.querySelector('[name="opponent_name"]').value=t.opponent_name,n.querySelector('[name="match_date"]').value=t.match_date,n.querySelector('[name="match_time"]').value=t.match_time,n.querySelector('[name="location"]').value=t.location,n.querySelector('[name="field_name"]').value=t.field_name||"",n.querySelector('[name="is_home_match"]').checked=t.is_home_match,n.querySelector('[name="notes"]').value=t.notes||"";const o=document.querySelector("#createMatchModal .modal-title");o&&(o.textContent="Edit Match"),ModalManager.show("createMatchModal")}function we(e){confirm("Are you sure you want to delete this match? This action cannot be undone.")&&fetch(`/api/ecs-fc/matches/${e}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{e.success?(xe("success",e.message),fe(),he&&he.refetchEvents()):xe("error","Failed to delete match: "+e.message)}).catch(e=>{console.error("Error deleting match:",e),xe("error","Error deleting match")})}function Se(e){fetch(`/api/ecs-fc/matches/${e}/remind`,{method:"POST"}).then(e=>e.json()).then(e=>{e.success?xe("success",e.message):xe("error","Failed to send reminders: "+e.message)}).catch(e=>{console.error("Error sending reminders:",e),xe("error","Error sending reminders")})}function _e(){const e=document.getElementById("importMatchesModal");e&&ModalManager.show(e.id)}function Ee(e){e.preventDefault();const t=document.getElementById("csv-matches").value.trim();if(!t)return void xe("error","Please enter CSV data");const n=function(e){const t=e.split("\n").map(e=>e.trim()).filter(e=>e),n=[];let o=0;t[0]&&t[0].toLowerCase().includes("opponent")&&(o=1);for(let s=o;s<t.length;s++){const e=t[s].split(",").map(e=>e.trim().replace(/^["']|["']$/g,""));if(e.length>=5){const t={opponent_name:e[0],match_date:e[1],match_time:e[2],location:e[3],is_home_match:"home"===e[4].toLowerCase()||"true"===e[4].toLowerCase(),field_name:e[5]||null,notes:e[6]||null};t.opponent_name&&t.match_date&&t.match_time&&t.location&&n.push(t)}}return n}(t);0!==n.length?fetch("/api/ecs-fc/matches/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:me,matches:n})}).then(e=>e.json()).then(e=>{if(e.success){xe("success",e.message);const t=bootstrap.Modal.getInstance(document.getElementById("importMatchesModal"));t&&t.hide(),fe(),he&&he.refetchEvents()}else xe("error","Import failed: "+e.message)}).catch(e=>{console.error("Error importing matches:",e),xe("error","Error importing matches")}):xe("error","No valid matches found in CSV data")}function Ce(e){"ecs_fc"===e.match_type&&e.match_id&&ge(e.match_id)}function Te(e){"ecs_fc"===e.match_type&&(fe(),he&&he.refetchEvents())}function xe(e,t){const n=document.createElement("div");n.className=`alert alert-${e} alert-dismissible fade show`,n.classList.add("js-alert-message"),n.innerHTML=`\n        ${t}\n        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n    `;let o=document.getElementById("alerts-container");o||(o=document.createElement("div"),o.id="alerts-container",o.classList.add("js-alerts-container","u-fixed-top","u-z-index-9999"),document.body.appendChild(o)),o.appendChild(n),setTimeout(()=>{n.parentNode&&n.remove()},5e3)}document.addEventListener("DOMContentLoaded",function(){!function(){const e=document.getElementById("team-data");e&&(me=parseInt(e.dataset.teamId)),me&&(function(){const e=document.getElementById("ecs-fc-calendar");e&&(he=new FullCalendar.Calendar(e,{initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"},events:function(e,t,n){!function(e,t,n,o){const s=e.toISOString().split("T")[0],i=t.toISOString().split("T")[0];fetch(`/api/ecs-fc/teams/${me}/matches/calendar?start_date=${s}&end_date=${i}`).then(e=>e.json()).then(e=>{e.success?n(e.data.events):(console.error("Failed to load calendar events:",e.message),o(e.message))}).catch(e=>{console.error("Error loading calendar events:",e),o(e)})}(e.start,e.end,t,n)},eventClick:function(e){showMatchDetails(e.event.id)},selectable:!0,select:function(e){ve(e.start)},height:"auto",eventDisplay:"block",dayMaxEvents:3}),he.render())}(),function(){const e=document.getElementById("create-match-btn");e&&e.addEventListener("click",ve);const t=document.getElementById("import-matches-btn");t&&t.addEventListener("click",_e);const n=document.getElementById("ecs-fc-match-form");n&&n.addEventListener("submit",ye);const o=document.getElementById("ecs-fc-import-form");if(o&&o.addEventListener("submit",Ee),document.addEventListener("click",function(e){e.target.classList.contains("js-rsvp-btn")&&function(e){const t=e.dataset.matchId,n=e.dataset.response;fetch(`/api/ecs-fc/matches/${t}/rsvp`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({response:n})}).then(e=>e.json()).then(e=>{e.success?(xe("success","RSVP updated successfully"),ge(t)):xe("error","Failed to update RSVP: "+e.message)}).catch(e=>{console.error("Error updating RSVP:",e),xe("error","Error updating RSVP")})}(e.target),e.target.classList.contains("js-edit-match-btn")&&be(e.target.dataset.matchId),e.target.classList.contains("js-delete-match-btn")&&we(e.target.dataset.matchId),e.target.classList.contains("js-send-reminder-btn")&&Se(e.target.dataset.matchId)}),"undefined"!=typeof io){const e=io();e.on("rsvp_update",Ce),e.on("match_update",Te)}}(),fe())}()}),window.EcsFcSchedule={loadTeamMatches:fe,showCreateMatchModal:ve,editMatch:be,deleteMatch:we,sendRsvpReminder:Se},new class{constructor(){this.leagues=[],this.csrfToken="",this.init()}init(){document.addEventListener("DOMContentLoaded",()=>{var e,t;this.leagues=window.leagues||[],this.csrfToken=(null==(e=document.querySelector('meta[name="csrf-token"]'))?void 0:e.content)||(null==(t=document.querySelector('input[name="csrf_token"]'))?void 0:t.value)||"",this.setupEventDelegation(),this.setupModals()})}setupEventDelegation(){document.addEventListener("click",e=>{var t;const n=null==(t=e.target.closest("[data-action]"))?void 0:t.dataset.action;if(!n)return;const o=e.target.closest("[data-action]");switch(n){case"generate-form":this.handleGenerateForm(o.dataset.leagueName);break;case"edit-match":this.handleEditMatch(o)}})}setupModals(){const e=document.getElementById("addWeekModal");e&&e.addEventListener("show.bs.modal",e=>{const t=e.relatedTarget;if(!t)return;const n=t.getAttribute("data-league-name");document.getElementById("modal_league_name").value=n;const o=this.leagues.find(e=>e.name===n);o&&this.populateTeamSelects(o.teams,["teamA","teamB"])})}handleGenerateForm(e){var t,n,o,s,i,a;const r=null==(t=document.getElementById(`total_weeks-${e}`))?void 0:t.value,c=null==(n=document.getElementById(`matches_per_week-${e}`))?void 0:n.value,l=null==(o=document.getElementById(`fun_week-${e}`))?void 0:o.value,d=null==(s=document.getElementById(`tst_week-${e}`))?void 0:s.value,u=null==(i=document.getElementById(`start_time-${e}`))?void 0:i.value,m=null==(a=document.getElementById(`location-${e}`))?void 0:a.value;if(!r||!c||!u)return void this.showAlert("Total Weeks, Matches Per Week, and Start Time are required!","warning");const h=this.leagues.find(t=>t.name===e);if(!h)return void this.showAlert("League not found","danger");const p=this.generateDetailedInputForm(r,c,l,d,u,m,h.teams,e),f=document.getElementById(`detailedInputForm-${e}`);f&&(f.innerHTML=p)}generateDetailedInputForm(e,t,n,o,s,i,a,r){let c=`\n            <form method="POST" action="/ecsfc/bulk_create_matches/${window.seasonId||""}/${r}" data-component="detailed-bulk-form">\n                <input type="hidden" name="csrf_token" value="${this.csrfToken}">\n                <div class="row g-3">\n        `;for(let l=1;l<=e;l++){if(c+=`\n                <div class="col-lg-4 col-md-6 col-sm-12">\n                    <div class="c-week-form-card card">\n                        <div class="card-header c-week-form-card__header">\n                            <h6 class="c-week-form-card__title">${l==n?"Fun Week":l==o?"TST Week":`Week ${l}`}</h6>\n                        </div>\n                        <div class="card-body">\n            `,l==n||l==o)c+='<p class="c-week-form-card__special">No matches scheduled this week.</p>';else{c+=`\n                    <div class="c-form-group">\n                        <label class="c-form-group__label">Date</label>\n                        <input type="date" class="c-form-group__input" name="date_week${l}" required data-form-control>\n                    </div>\n                `;for(let e=1;e<=t;e++)c+=this.generateMatchInput(l,e,a,s,i)}c+="\n                        </div>\n                    </div>\n                </div>\n            "}return c+='\n                </div>\n                <div class="mt-3">\n                    <button type="submit" class="btn btn-success" data-action="save-matches">\n                        <i class="ti ti-check me-1"></i>\n                        Save Matches\n                    </button>\n                </div>\n            </form>\n        ',c}generateMatchInput(e,t,n,o,s){const i=n.map(e=>`<option value="${e.id}">${e.name}</option>`).join("");return`\n            <div class="c-match-input" data-component="match-input">\n                <div class="row g-2 align-items-center mb-2">\n                    <div class="col-6 col-md-3">\n                        <select class="c-match-input__select" name="teamA_week${e}_match${t}" required data-form-select>\n                            <option value="">Team A</option>\n                            ${i}\n                        </select>\n                    </div>\n                    <div class="col-6 col-md-3">\n                        <select class="c-match-input__select" name="teamB_week${e}_match${t}" required data-form-select>\n                            <option value="">Team B</option>\n                            ${i}\n                        </select>\n                    </div>\n                    <div class="col-6 col-md-3">\n                        <input type="time"\n                               class="c-match-input__time"\n                               name="time_week${e}_match${t}"\n                               value="${o}"\n                               required\n                               data-form-control>\n                    </div>\n                    <div class="col-6 col-md-3">\n                        <select class="c-match-input__location" name="location_week${e}_match${t}" required data-form-select>\n                            <option value="North" ${"North"===s?"selected":""}>North</option>\n                            <option value="South" ${"South"===s?"selected":""}>South</option>\n                        </select>\n                    </div>\n                </div>\n            </div>\n        `}handleEditMatch(e){const t=e.dataset.matchId,n=e.dataset.teamA,o=e.dataset.teamB,s=e.dataset.time,i=e.dataset.location,a=e.dataset.date,r=e.dataset.leagueName;this.loadMatchData(t,n,o,s,i,a,r)}loadMatchData(e,t,n,o,s,i,a){const r=new Date(i).toISOString().split("T")[0],c=this.convertTo24Hour(o),l=this.leagues.find(e=>e.name===a);l&&(this.populateTeamSelectsWithSelection(l.teams,"edit_team_a",t),this.populateTeamSelectsWithSelection(l.teams,"edit_team_b",n)),document.getElementById("edit_time").value=c,document.getElementById("edit_location").value=s,document.getElementById("edit_date").value=r;const d=document.querySelector("#manage-ecsfc-editModal form");d&&(d.action=`/ecsfc/edit_match/${e}`)}convertTo24Hour(e){const t=e.match(/(\d+):(\d+)\s*(AM|PM)/i);if(!t)return e;let[,n,o,s]=t;return n=parseInt(n),"PM"===s.toUpperCase()&&n<12?n+=12:"AM"===s.toUpperCase()&&12===n&&(n=0),`${n.toString().padStart(2,"0")}:${o}`}populateTeamSelects(e,t){t.forEach(t=>{const n=document.getElementById(t);n&&(n.innerHTML=e.map(e=>`<option value="${e.name}">${e.name}</option>`).join(""))})}populateTeamSelectsWithSelection(e,t,n){const o=document.getElementById(t);o&&(o.innerHTML=e.map(e=>`<option value="${e.name}" ${e.name===n?"selected":""}>${e.name}</option>`).join(""))}showAlert(e,t="info"){"undefined"!=typeof Swal?Swal.fire({icon:"warning"===t?"warning":"danger"===t?"error":"info",title:e,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}):alert(e)}},document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("enable2FABtn"),t=document.getElementById("verify2FAForm"),n=document.getElementById("disable2FAForm");e&&e.addEventListener("click",function(){fetch("/account/enable-2fa").then(e=>e.json()).then(e=>{document.getElementById("qrCodeContainer").innerHTML=`<img src="data:image/png;base64,${e.qr_code}" alt="QR Code">`,document.getElementById("enable2FAModal").setAttribute("data-secret",e.secret),ModalManager.show("enable2FAModal")})}),t&&t.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("twoFactorCode").value,n=document.getElementById("enable2FAModal").getAttribute("data-secret");fetch("/account/enable-2fa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,secret:n})}).then(e=>e.json()).then(e=>{e.success?(alert("2FA enabled successfully"),location.reload()):alert(e.message)})}),n&&n.addEventListener("submit",function(e){e.preventDefault(),confirm("Are you sure you want to disable 2FA? This will make your account less secure.")&&this.submit()})}),function(){const e=768,t=50,n=5e3,o=1e4,s=6048e5;function i(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}function a(){window.innerWidth>=e||document.querySelectorAll('[data-role="tab-navigation"]').forEach(e=>{e.classList.add("small-tabs","overflow-auto","flex-nowrap");let n=0,o=0;const s=e.getAttribute("aria-controls"),i=s?document.getElementById(s):document.querySelector('[data-role="tab-content"]');i&&(i.addEventListener("touchstart",e=>{n=e.changedTouches[0].screenX},{passive:!0}),i.addEventListener("touchend",s=>{o=s.changedTouches[0].screenX,function(e){const s=Array.from(e.querySelectorAll('[data-action="switch-tab"]')),i=s.findIndex(e=>e.classList.contains("is-active")),a=o-n;a<-50&&i<s.length-1?s[i+1].click():a>t&&i>0&&s[i-1].click()}(e)},{passive:!0}))})}function r(){document.querySelectorAll('[data-action="switch-tab"]').forEach(e=>{const t="undefined"!=typeof bootstrap?"shown.bs.tab":"click";e.addEventListener(t,function(){const e=this.closest('[data-role="tab-navigation"]');if(!e)return;const t=this.getBoundingClientRect(),n=e.getBoundingClientRect();(t.right>n.right||t.left<n.left)&&this.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})})})}function c(){const e=document.getElementById("rsvp-data");if(!e)return;const t=e.dataset.discordId,i=e.dataset.discordInServer,a=e.dataset.discordLastChecked;t&&"None"!==t&&""!==t?function(e,t){if("true"===e)return void console.log("[Home] User is in Discord server (cached), skipping prompt");if("unknown"===e)return console.log("[Home] Discord membership status unknown, skipping prompt"),void l();if(t){const e=new Date(t);if((Date.now()-e.getTime())/864e5>30)return console.log("[Home] Discord membership data is stale, triggering refresh"),void l()}console.log("[Home] User confirmed NOT in Discord server, showing prompt");const o=localStorage.getItem("discord_prompt_shown"),i=Date.now();o&&i-parseInt(o)<s||setTimeout(()=>{0!==document.querySelectorAll("[data-rsvp]").length&&"undefined"!=typeof DiscordMembershipChecker&&(DiscordMembershipChecker.showJoinPrompt({title:"ð¡ Stay Connected on Discord",urgency:"info",showUrgentPopup:!0}),localStorage.setItem("discord_prompt_shown",i.toString()))},n)}(i,a):setTimeout(()=>{"undefined"!=typeof Swal?Swal.fire({title:"ð Connect Your Discord Account",html:'\n          <div class="text-start">\n            <p><strong>Your Discord account isn\'t connected yet!</strong></p>\n            <p>Connecting Discord is important for:</p>\n            <ul class="text-start ms-3">\n              <li>ð Getting match notifications and updates</li>\n              <li>ð¬ Communicating with teammates</li>\n              <li>ð Receiving RSVP reminders</li>\n              <li>ð Staying updated on league announcements</li>\n            </ul>\n            <p class="mt-3"><strong>Connect now to enhance your experience!</strong></p>\n          </div>\n        ',icon:"info",showCancelButton:!0,confirmButtonText:'<i class="fab fa-discord me-2"></i>Connect Discord',cancelButtonText:"Maybe Later",confirmButtonColor:"#5865F2",cancelButtonColor:getComputedStyle(document.documentElement).getPropertyValue("--ecs-secondary").trim()||"#6c757d"}).then(e=>{var t;if(e.isConfirmed){const e=null==(t=document.querySelector("[data-discord-auth-url]"))?void 0:t.dataset.discordAuthUrl;e&&(window.location.href=e)}}):console.warn("SweetAlert2 not available for Discord prompt")},o)}function l(){const e=document.getElementById("rsvp-data");if(!e)return;const t=e.dataset.csrfToken;fetch("/api/discord/check-membership",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"same-origin"}).then(e=>{e.ok&&console.log("[Home] Discord membership check triggered successfully")}).catch(e=>{console.debug("[Home] Discord membership check failed:",e)})}function d(){i(),window.addEventListener("resize",i),window.addEventListener("orientationchange",i),window.innerWidth<e&&(a(),"ontouchstart"in window&&document.querySelectorAll("button, .btn, a, [data-action]").forEach(e=>{e.addEventListener("touchstart",function(){},{passive:!0})})),r(),document.querySelectorAll("[data-modal]").forEach(e=>{const t="undefined"!=typeof bootstrap?"shown.bs.modal":"modal:opened",n="undefined"!=typeof bootstrap?"hidden.bs.modal":"modal:closed";e.addEventListener(t,function(){/iPad|iPhone|iPod/.test(navigator.userAgent)&&document.body.classList.add("modal-open-ios")}),e.addEventListener(n,function(){/iPad|iPhone|iPod/.test(navigator.userAgent)&&document.body.classList.remove("modal-open-ios")})}),"serviceWorker"in navigator?navigator.serviceWorker.register("/static/js/service-worker.js").then(e=>{console.log("ServiceWorker registered:",e.scope)}).catch(e=>{console.error("ServiceWorker registration failed:",e)}):console.log("Service Workers not supported"),c(),console.log("â Home page initialized")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d(),window.HomePage={setViewportHeight:i,initializeSwipeNavigation:a,initializeTabAutoScroll:r}}();let Le,ke=[],Ie=[],Ae=!1;function $e(){ce.emit("join_match",{match_id:le,team_id:de})}function De(e,t){ce.emit("update_score",{match_id:le,home_score:e,away_score:t})}function Me(e,t,n=null){const o={match_id:le,elapsed_seconds:e,is_running:t};n&&(o.period=n),ce.emit("update_timer",o)}function Pe(e){ue&&e!==Ae&&(Ae=e,e?(Le&&clearInterval(Le),Le=setInterval(()=>{ue&&Ae&&(ue.elapsed_seconds++,Oe(ue.elapsed_seconds))},1e3),Me(ue.elapsed_seconds,!0),$("#startStopTimer").text("Pause Timer"),$("#startStopTimer").removeClass("timer-stopped").addClass("timer-running")):(Le&&(clearInterval(Le),Le=null),Me(ue.elapsed_seconds,!1),$("#startStopTimer").text("Start Timer"),$("#startStopTimer").removeClass("timer-running").addClass("timer-stopped")))}function Be(e,t){$("#homeScore").text(e),$("#awayScore").text(t)}function qe(e,t,n){n&&$("#periodSelector").val()!==n&&$("#periodSelector").val(n),Oe(e),t!==Ae&&Pe(t)}function Oe(e){const t=Math.floor(e/60),n=e%60;$("#timerDisplay").text(`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`)}function Ne(e){const t=$("#eventsList");t.empty(),e&&0!==e.length?(e.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)),e.forEach(e=>{let n=`${e.event_type}`;e.player_name&&(n+=` - ${e.player_name}`),e.team_name&&(n+=` (${e.team_name})`),e.minute&&(n+=` - ${e.minute}'`);let o="list-group-item js-event-item";switch(e.event_type){case"GOAL":o+=" event-type-goal";break;case"YELLOW_CARD":o+=" event-type-yellow-card";break;case"RED_CARD":o+=" event-type-red-card"}t.append(`<li class="${o}">${n}</li>`)})):t.append('<li class="list-group-item">No events recorded yet</li>')}function Re(e){$("#matchStatus").text(e);let t="badge js-match-status-badge ";switch(e){case"in_progress":t+="match-status-in-progress";break;case"completed":t+="match-status-completed";break;case"canceled":t+="match-status-canceled";break;default:t+="match-status-unknown"}$("#matchStatusBadge").attr("class",t)}function Fe(e){const t=$("#reportersList");t.empty(),e&&0!==e.length?e.forEach(e=>{const n=function(e){const t=new Date-e,n=Math.floor(t/1e3);return n<60?"just now":n<3600?`${Math.floor(n/60)}m ago`:`${Math.floor(n/3600)}h ago`}(new Date(e.last_active));t.append(`\n            <li class="list-group-item js-reporter-item d-flex justify-content-between align-items-center">\n                ${e.username} (${e.team_name})\n                <span class="badge bg-secondary reporter-time-badge">${n}</span>\n            </li>\n        `)}):t.append('<li class="list-group-item">No other reporters</li>')}function He(e){const t=$("#playerShiftsContainer");if(t.empty(),!e||0===e.length)return void t.append("<p>No player shifts recorded</p>");const n=e.filter(e=>e.is_active),o=e.filter(e=>!e.is_active);if(t.append('<h5 class="mt-3">Active Players</h5>'),0===n.length)t.append("<p>No active players</p>");else{const e=$('<div class="row"></div>');n.forEach(t=>{e.append(`\n                <div class="col-md-6 mb-2">\n                    <button class="btn btn-success w-100 js-player-shift-toggle"\n                            data-player-id="${t.player_id}"\n                            data-active="true">\n                        ${t.player_name}\n                    </button>\n                </div>\n            `)}),t.append(e)}if(t.append('<h5 class="mt-3">Available Players</h5>'),0===o.length)t.append("<p>No available players</p>");else{const e=$('<div class="row"></div>');o.forEach(t=>{e.append(`\n                <div class="col-md-6 mb-2">\n                    <button class="btn btn-outline-secondary w-100 js-player-shift-toggle"\n                            data-player-id="${t.player_id}"\n                            data-active="false">\n                        ${t.player_name}\n                    </button>\n                </div>\n            `)}),t.append(e)}}function je(e){if(!ue)return;const t=$("#eventPlayer");t.empty(),t.append('<option value="">Select Player</option>');let n=[];parseInt(e)===ue.home_team_id?n=$("#homeTeamPlayers").data("players")||[]:parseInt(e)===ue.away_team_id&&(n=$("#awayTeamPlayers").data("players")||[]),n.forEach(e=>{t.append(`<option value="${e.id}">${e.name}</option>`)})}function ze(){$("#increaseHomeScore, #decreaseHomeScore, #increaseAwayScore, #decreaseAwayScore").prop("disabled",!0),$("#startStopTimer, #resetTimer, #periodSelector").prop("disabled",!0),$("#addEventForm :input").prop("disabled",!0),$(".js-player-shift-toggle").prop("disabled",!0),$("#submitReportBtn").prop("disabled",!0),Le&&(clearInterval(Le),Le=null,Ae=!1)}function We(e,t="info"){const n=$("#notifications"),o=$(`\n        <div class="alert alert-${t} alert-dismissible fade show" role="alert">\n            ${e}\n            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n        </div>\n    `);n.append(o),setTimeout(()=>{o.alert("close")},5e3)}function Ue(){const e=document.getElementById("lastUpdated");e&&fetch("/admin/match_management/statuses").then(e=>e.json()).then(t=>{t.statuses&&t.statuses.forEach(e=>{!function(e){const t=document.getElementById(`status-${e.id}`);t&&(t.className="badge",t.classList.add(`bg-${e.status_color}`),t.setAttribute("data-status",e.status),t.innerHTML=`<i class="fas ${e.status_icon}"></i> ${e.status_display}`),Ye(e.id)}(e)}),e.textContent=`Last updated: ${(new Date).toLocaleTimeString()}`}).catch(e=>console.error("Error refreshing statuses:",e))}function Ye(e){fetch(`/admin/match_management/match-tasks/${e}`).then(e=>e.json()).then(t=>{!function(e,t){const n=document.getElementById(`task-details-${e}`);if(!n)return void console.error(`No container found for task-details-${e}`);if(!t.success)return void Ge(e,t.error||"Failed to load task details");const o=t.tasks||{};let s="";o.thread?s+=Xe("thread",o.thread,e):s+=Ve("Thread Creation","No thread task scheduled"),o.reporting?s+=Xe("reporting",o.reporting,e):s+=Ve("Live Reporting","No reporting task scheduled"),s||(s='<small class="text-muted">No tasks scheduled</small>'),n.innerHTML=s}(e,t)}).catch(t=>{console.error(`Error loading task details for match ${e}:`,t),Ge(e,"Failed to load task details")})}function Xe(e,t,n){const o={PENDING:"warning",STARTED:"info",SUCCESS:"success",FAILURE:"danger",RETRY:"warning",REVOKED:"secondary",RUNNING:"info",FINISHED:"success",MISSING:"danger",Completed:"success",Scheduled:"warning",Active:"info",Issue:"danger"}[t.status]||"secondary",s=function(e){return{PENDING:"fa-clock",STARTED:"fa-play",SUCCESS:"fa-check",FAILURE:"fa-times",RETRY:"fa-redo",REVOKED:"fa-ban",RUNNING:"fa-play",FINISHED:"fa-check",MISSING:"fa-exclamation-triangle",Completed:"fa-check",Scheduled:"fa-clock",Active:"fa-play",Issue:"fa-exclamation-triangle"}[e]||"fa-question"}(t.status),i=t.type||("thread"===e?"Thread Creation":"Live Reporting"),a="thread"===e?"fa-comments":"fa-broadcast-tower",r=t.message||i,c=!0===t.fallback;let l="N/A";if(t.ttl&&t.ttl>0)l=Ke(t.ttl);else if(t.eta&&"completed"!==t.eta){const e=new Date(t.eta),n=new Date,o=Math.max(0,Math.floor((e-n)/1e3));l=o>0?Ke(o):"Due now"}let d=t.status;c&&("SUCCESS"===t.status&&(d="Completed"),"PENDING"===t.status&&(d="Scheduled"),"RUNNING"===t.status&&(d="Active"),"FINISHED"===t.status&&(d="Completed"),"MISSING"===t.status&&(d="Issue"));const u=c?'<i class="fas fa-info-circle text-muted" title="Status derived from match data"></i>':"",m=JSON.stringify(t).replace(/"/g,"&quot;").replace(/'/g,"&#39;");return`\n        <div data-component="task-card" data-task-type="${e}" data-match-id="${n}" class="mb-2 p-2 border rounded ${c?"border-info":""}">\n            <div class="d-flex justify-content-between align-items-center mb-1">\n                <span class="badge bg-${o}" data-status="${t.status}">\n                    <i class="fas ${s}"></i> ${d}\n                </span>\n                <small class="text-muted">${l} ${u}</small>\n            </div>\n            <div class="d-flex align-items-center mb-2">\n                <i class="fas ${a} me-2 text-primary"></i>\n                <div class="flex-grow-1">\n                    <small class="fw-bold">${i}</small><br>\n                    <small class="text-muted">${r}</small>\n                </div>\n            </div>\n            ${t.result?`<div class="mb-2"><small class="text-muted"><strong>Details:</strong> ${t.result}</small></div>`:""}\n            <div class="task-actions">\n                <button class="btn btn-xs btn-outline-info me-1"\n                        data-action="show-task-info"\n                        data-task-id="${t.task_id}"\n                        data-task-type="${i}"\n                        data-task-data='${m}'>\n                    <i class="fas fa-info-circle"></i>\n                </button>\n                ${c||"unknown"===t.task_id||"scheduled"===t.task_id?"":`\n                <button class="btn btn-xs btn-outline-danger me-1"\n                        data-action="revoke-task"\n                        data-task-id="${t.task_id}"\n                        data-match-id="${n}"\n                        data-task-type="${e}">\n                    <i class="fas fa-times"></i>\n                </button>`}\n                <button class="btn btn-xs btn-outline-warning"\n                        data-action="reschedule-task"\n                        data-match-id="${n}"\n                        data-task-type="${e}">\n                    <i class="fas fa-redo"></i>\n                </button>\n            </div>\n        </div>\n    `}function Ve(e,t){const n=e.includes("Thread")?"fa-comments":"fa-broadcast-tower";return`\n        <div data-component="no-task-card" data-task-name="${e}" class="mb-1 p-2 border rounded bg-light">\n            <div class="d-flex align-items-center">\n                <i class="fas ${n} me-2 text-muted"></i>\n                <div class="flex-grow-1">\n                    <small class="fw-bold text-muted">${e}</small><br>\n                    <small class="text-muted">${t}</small>\n                </div>\n                <span class="badge bg-secondary" data-status="not-scheduled">Not Scheduled</span>\n            </div>\n        </div>\n    `}function Ge(e,t){const n=document.getElementById(`task-details-${e}`);n&&(n.innerHTML="Redis not available"===t?'\n            <div class="text-center">\n                <small class="text-muted"><i class="fas fa-database"></i> Task system unavailable</small><br>\n                <small class="text-muted">Redis connection needed</small>\n            </div>\n        ':`\n            <div class="alert alert-danger alert-sm mb-0">\n                <small><i class="fas fa-exclamation-triangle"></i> ${t}</small>\n            </div>\n        `)}function Ke(e){if(e<60)return`${e}s`;const t=Math.floor(e/60);return t<60?`${t}m ${e%60}s`:`${Math.floor(t/60)}h ${t%60}m`}function Je(){document.querySelectorAll('[data-match-id]:not([data-match-type="historical"])').forEach(e=>{const t=e.getAttribute("data-match-id");t&&Ye(t)});const e=document.getElementById("historicalMatches");e&&e.classList.contains("show")&&document.querySelectorAll('[data-match-type="historical"][data-match-id]').forEach(e=>{const t=e.getAttribute("data-match-id");t&&Ye(t)})}function Qe(){document.querySelectorAll('[data-time][data-component="scheduled-time"]').forEach(e=>{const t=e.getAttribute("data-time");e.textContent=function(e){if(!e)return"Unknown";try{const t=new Date(e)-new Date;if(t>0){const e=Math.floor(t/36e5),n=Math.floor(t%36e5/6e4);return e>24?`${Math.floor(e/24)}d ${e%24}h`:e>0?`${e}h ${n}m`:`${n}m`}return"Overdue"}catch(o){return"Invalid"}}(t)})}function Ze(){var e=$("#matchFilter").val();$("#matchStatsContainer .card").each(function(){var t=$(this).data("match-id");""===e||t==e?$(this).show():$(this).hide()})}function et(){const e=document.getElementById("updatesList");if(!e)return;const t=[];document.querySelectorAll('input[type="radio"]:checked').forEach(e=>{const n=e.name.replace("field_",""),o=e.value;"new"===o?t.push(`<small class="d-block text-primary">Update ${n.replace("_"," ")}</small>`):"combine"===o&&t.push(`<small class="d-block text-warning">Combine ${n.replace("_"," ")}</small>`)}),t.length>0?e.innerHTML=t.join(""):e.innerHTML='<p class="text-muted mb-0"><em>No changes selected</em></p>'}window.LiveReporting={init:function(e){le=e.matchId,de=e.teamId;const t=e.socketUrl||window.location.origin;ce=io(t+"/live"),ce.on("disconnect",()=>{We("Connection lost. Attempting to reconnect...","warning"),Le&&(clearInterval(Le),Le=null)}),ce.on("error",e=>{We("Error: "+e.message,"danger")}),ce.on("match_state",e=>{ue=e,function(e){Be(e.home_score,e.away_score),qe(e.elapsed_seconds,e.timer_running,e.period),Ne(e.events),Re(e.status),$("#homeTeamName").text(e.home_team_name),$("#awayTeamName").text(e.away_team_name),e.report_submitted&&(ze(),$("#reportCompleteMessage").removeClass("u-hidden"))}(e)}),ce.on("active_reporters",e=>{ke=e,Fe(e)}),ce.on("player_shifts",e=>{Ie=e,He(e)}),ce.on("reporter_joined",e=>{We(`${e.username} joined as a reporter for ${e.team_name}`,"info"),ke.find(t=>t.user_id===e.user_id)||(ke.push(e),Fe(ke))}),ce.on("reporter_left",e=>{We(`${e.username} is no longer reporting`,"info"),ke=ke.filter(t=>t.user_id!==e.user_id),Fe(ke)}),ce.on("score_updated",e=>{ue&&(ue.home_score=e.home_score,ue.away_score=e.away_score,Be(e.home_score,e.away_score)),We(`Score updated to ${e.home_score}-${e.away_score} by ${e.updated_by_name}`,"success")}),ce.on("timer_updated",e=>{ue&&(ue.elapsed_seconds=e.elapsed_seconds,ue.timer_running=e.is_running,e.period&&(ue.period=e.period),qe(e.elapsed_seconds,e.is_running,e.period)),We(`Timer updated by ${e.updated_by_name}`,"info")}),ce.on("event_added",e=>{const t=e.event;ue&&ue.events&&(ue.events.push(t),Ne(ue.events));let n=`${t.event_type}`;t.player_name&&(n+=` by ${t.player_name}`),t.team_name&&(n+=` (${t.team_name})`),t.minute&&(n+=` at ${t.minute}'`),We(`New event: ${n}`,"success")}),ce.on("player_shift_updated",e=>{if(e.team_id===de){const t=Ie.findIndex(t=>t.player_id===e.player_id);t>=0?(Ie[t].is_active=e.is_active,Ie[t].last_updated=(new Date).toISOString()):Ie.push({player_id:e.player_id,player_name:e.player_name,is_active:e.is_active,last_updated:(new Date).toISOString()}),He(Ie),We(`Player ${e.player_name} shift ${e.is_active?"started":"ended"}`,"info")}}),ce.on("report_submitted",e=>{ue&&(ue.report_submitted=!0,ue.report_submitted_by=e.submitted_by,Re("completed")),We(`Final report submitted by ${e.submitted_by_name}`,"success"),ze(),$("#reportCompleteMessage").removeClass("u-hidden")}),ce.on("report_submission_error",e=>{We(`Error submitting report: ${e.message}`,"danger")}),$("#increaseHomeScore").on("click",function(){ue&&De(ue.home_score+1,ue.away_score)}),$("#decreaseHomeScore").on("click",function(){!ue||ue.home_score<=0||De(ue.home_score-1,ue.away_score)}),$("#increaseAwayScore").on("click",function(){if(!ue)return;const e=ue.away_score+1;De(ue.home_score,e)}),$("#decreaseAwayScore").on("click",function(){if(!ue||ue.away_score<=0)return;const e=ue.away_score-1;De(ue.home_score,e)}),$("#startStopTimer").on("click",function(){ue&&Pe(!Ae)}),$("#resetTimer").on("click",function(){ue&&confirm("Are you sure you want to reset the timer to 0?")&&Me(0,Ae)}),$("#periodSelector").on("change",function(){if(!ue)return;const e=$(this).val();var t;t=e,ue&&Me(ue.elapsed_seconds,Ae,t)}),$("#addEventForm").on("submit",function(e){e.preventDefault();const t=$("#eventType").val(),n=$("#eventTeam").val(),o=$("#eventPlayer").val(),s=$("#eventMinute").val();var i;i={event_type:t,team_id:parseInt(n),player_id:o?parseInt(o):null,minute:s?parseInt(s):null,period:ue?ue.period:null},ce.emit("add_event",{match_id:le,event:i}),this.reset(),je($("#eventTeam option:first").val())}),$("#eventTeam").on("change",function(){je($(this).val())}),$("#playerShiftsContainer").on("click",".js-player-shift-toggle",function(){!function(e,t){ce.emit("update_player_shift",{match_id:le,player_id:e,is_active:t,team_id:de})}($(this).data("player-id"),!0!==$(this).data("active"))}),$("#submitReportBtn").on("click",function(){ue&&confirm("Are you sure you want to submit the final match report? This action cannot be undone.")&&function(){const e=$("#matchNotes").val();ce.emit("submit_report",{match_id:le,report_data:{notes:e}})}()}),$("#eventType").on("change",function(){const e=$(this).val();["GOAL","YELLOW_CARD","RED_CARD","SUBSTITUTION"].includes(e)?$("#playerSelectGroup").removeClass("u-hidden"):$("#playerSelectGroup").addClass("u-hidden"),"SUBSTITUTION"===e?$("#substitutionFields").removeClass("u-hidden"):$("#substitutionFields").addClass("u-hidden")}),ce.on("connect",()=>{$e()})},join:$e,leave:function(){ce.emit("leave_match",{match_id:le})}},$(document).ready(function(){!function(){const e=document.querySelector('meta[name="csrf-token"]');if(e)e.getAttribute("content");else{const e=document.querySelector('input[name="csrf_token"]');e&&e.value}}(),Qe(),setTimeout(Je,1e3),setInterval(Je,6e4),setInterval(Ue,6e4);const e=document.getElementById("historicalMatches"),t=document.getElementById("historicalToggleIcon");e&&t&&(e.addEventListener("show.bs.collapse",function(){t.classList.remove("ti-chevron-down"),t.classList.add("ti-chevron-up"),setTimeout(()=>{document.querySelectorAll('[data-match-type="historical"][data-match-id]').forEach(e=>{const t=e.dataset.matchId;t&&Ye(t)})},100)}),e.addEventListener("hide.bs.collapse",function(){t.classList.remove("ti-chevron-up"),t.classList.add("ti-chevron-down")}))}),$(document).ready(function(){feather&&"undefined"!=typeof feather&&feather.replace(),$(document).on("click",".edit-match-stat-btn",function(){!function(e){var t=$('input[name="csrf_token"]').val();$.ajax({url:"/edit_match_stat/"+e,method:"GET",headers:{"X-CSRFToken":t},success:function(t){$("#editGoalsInput").val(t.goals),$("#editAssistsInput").val(t.assists),$("#editYellowCardsInput").val(t.yellow_cards),$("#editRedCardsInput").val(t.red_cards),$("#editStatId").val(e),$("#editMatchStatModal").modal("show")},error:function(){Swal.fire({icon:"error",title:"Error",text:"Failed to load match stats. Please try again."})}})}($(this).data("stat-id"))}),$(document).on("click",".remove-match-stat-btn",function(){!function(e){Swal.fire({title:"Are you sure?",text:"Do you want to remove this stat?",icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, remove it!"}).then(t=>{if(t.isConfirmed){var n=$('input[name="csrf_token"]').val();$.ajax({url:"/remove_match_stat/"+e,method:"POST",headers:{"X-CSRFToken":n},beforeSend:function(){Swal.fire({title:"Removing...",text:"Please wait while the stat is being removed.",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}})},success:function(e){e.success?Swal.fire("Removed!","The stat has been removed successfully.","success").then(()=>{location.reload()}):Swal.fire("Error!",e.message||"Failed to remove the stat.","error")},error:function(){Swal.fire("Error!","Failed to remove match stat. Please try again.","error")}})}})}($(this).data("stat-id"))}),Ze(),$("#matchFilter").on("change",function(){Ze()})}),$("#editMatchStatForm").submit(function(e){e.preventDefault();var t=$("#editStatId").val(),n=$(this).serialize(),o=$('input[name="csrf_token"]').val();Swal.fire({title:"Confirm Changes",text:"Are you sure you want to save these changes?",icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, save it!"}).then(e=>{e.isConfirmed&&$.ajax({url:"/edit_match_stat/"+t,method:"POST",data:n,headers:{"X-CSRFToken":o},beforeSend:function(){Swal.fire({title:"Saving...",text:"Please wait while your changes are being saved.",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}})},success:function(e){e.success?Swal.fire("Success!","Match stat has been updated successfully.","success").then(()=>{$("#editMatchStatModal").modal("hide"),location.reload()}):Swal.fire("Error!",e.message||"Failed to update match stat.","error")},error:function(){Swal.fire("Error!","Failed to update match stat. Please try again.","error")}})})}),function(){const e={MLS:"usa.1","US Open Cup":"usa.open","FIFA Club World Cup":"fifa.cwc",Concacaf:"concacaf.league","Concacaf Champions League":"concacaf.champions"},t=Object.fromEntries(Object.entries(e).map(([e,t])=>[t,e]));function n(){document.addEventListener("click",o),"undefined"!=typeof flatpickr&&flatpickr(".flatpickr",{enableTime:!0,dateFormat:"Y-m-d H:i",time_24hr:!0}),a(),setInterval(a,3e4)}function o(n){const o=n.target.closest("[data-action]");if(!o)return;const a=o.dataset.action,r=o.dataset.matchId;switch(a){case"edit-match":n.preventDefault(),function(t){const n=document.querySelector(`tr[data-match-id="${t}"]`);if(!n)return void console.error(`Row with match ID ${t} not found`);const o=n.querySelector("td:nth-child(2)"),s=n.querySelector("td:nth-child(3)"),i=n.querySelector("td:last-child");o.setAttribute("data-original-value",o.textContent),s.setAttribute("data-original-value",s.textContent),o.innerHTML=`<input type="text" id="edit-date-${t}" class="form-control flatpickr" value="${o.textContent.trim()}" data-form-control>`,"undefined"!=typeof flatpickr&&flatpickr(`#edit-date-${t}`,{enableTime:!0,dateFormat:"Y-m-d H:i",time_24hr:!0});let a=`<select class="form-select" id="edit-competition-${t}" data-form-select>`;for(const[r,c]of Object.entries(e))a+=`<option value="${r}" ${s.textContent.trim()===r?"selected":""}>${r}</option>`;a+="</select>",s.innerHTML=a,i.innerHTML=`\n      <button type="button" class="btn btn-sm btn-success" data-action="save-row" data-match-id="${t}">\n        <i class="fas fa-save"></i> Save\n      </button>\n      <button type="button" class="btn btn-sm btn-secondary" data-action="cancel-edit" data-match-id="${t}">\n        <i class="fas fa-times"></i> Cancel\n      </button>\n    `}(r);break;case"remove-match":n.preventDefault(),function(e){("undefined"!=typeof Swal?Swal.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}):Promise.resolve({isConfirmed:confirm("Are you sure you want to delete this match?")})).then(t=>{var n;if(t.isConfirmed){const t=null==(n=document.querySelector('input[name="csrf_token"]'))?void 0:n.value;fetch(`/bot/admin/matches/remove/${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t}}).then(e=>e.json()).then(t=>{if(!t.success)throw new Error(t.message||"Failed to remove the match.");{const n=document.querySelector(`tr[data-match-id="${e}"]`);n&&n.remove(),"undefined"!=typeof Swal&&Swal.fire("Deleted!",t.message,"success")}}).catch(e=>{console.error("Error:",e),"undefined"!=typeof Swal?Swal.fire("Error",e.message,"error"):alert("Error: "+e.message)})}})}(r);break;case"clear-matches":n.preventDefault(),("undefined"!=typeof Swal?Swal.fire({title:"Are you sure?",text:"This will delete ALL matches. This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, clear all!",cancelButtonText:"Cancel"}):Promise.resolve({isConfirmed:confirm("Are you sure you want to clear ALL matches?")})).then(e=>{var t,n;if(e.isConfirmed){const e=null==(t=document.querySelector('input[name="csrf_token"]'))?void 0:t.value,o=(null==(n=document.querySelector('[data-action="clear-matches"]'))?void 0:n.getAttribute("href"))||"/bot/admin/clear_all_mls_matches";fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error("Failed to clear matches.");"undefined"!=typeof Swal?Swal.fire("Cleared!","All matches have been cleared.","success").then(()=>{location.reload()}):(alert("All matches have been cleared."),location.reload())}).catch(e=>{console.error("Error:",e),"undefined"!=typeof Swal?Swal.fire("Error",e.message,"error"):alert("Error: "+e.message)})}});break;case"start-reporting":!function(e){var t;const n=document.querySelector(`[data-action="start-reporting"][data-match-id="${e}"]`);document.querySelector(`[data-action="stop-reporting"][data-match-id="${e}"]`),n&&(n.disabled=!0);const o=null==(t=document.querySelector('input[name="csrf_token"]'))?void 0:t.value;fetch(`/bot/admin/start_live_reporting/${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":o}}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(t=>{t.success?(i(e,"running"),console.log(`Live reporting started. Task ID: ${t.task_id}`)):(n&&(n.disabled=!1),alert(t.message))}).catch(e=>{console.error("Error:",e),n&&(n.disabled=!1),alert("Failed to start live reporting. Please try again.")})}(r);break;case"stop-reporting":!function(e){var t;const n=document.querySelector(`[data-action="stop-reporting"][data-match-id="${e}"]`);n&&(n.disabled=!0);const o=null==(t=document.querySelector('input[name="csrf_token"]'))?void 0:t.value;fetch(`/bot/admin/stop_live_reporting/${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":o}}).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(t=>{t.success?i(e,"stopped"):(n&&(n.disabled=!1),alert(t.message))}).catch(e=>{console.error("Error:",e),n&&(n.disabled=!1),alert("Failed to stop live reporting. Please try again.")})}(r);break;case"save-row":n.preventDefault(),function(e){var n,o,i;const a=document.querySelector(`tr[data-match-id="${e}"]`),r=null==(n=document.getElementById(`edit-date-${e}`))?void 0:n.value.trim(),c=null==(o=document.getElementById(`edit-competition-${e}`))?void 0:o.value.trim(),l=null==(i=document.querySelector('input[name="csrf_token"]'))?void 0:i.value;r&&c?fetch(`/bot/admin/update_match/${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":l},body:JSON.stringify({date:r,competition:c})}).then(e=>e.json()).then(n=>{if(n.success){const n=function(e){const t=new Date(e);t.setHours(t.getHours()+25);const n={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0};return t.toLocaleString("en-US",n).replace(",","")}(r);a.querySelector("td:nth-child(2)").textContent=n;const o=t[c]||c;a.querySelector("td:nth-child(3)").textContent=o,s(e)}else alert("Failed to save changes.")}).catch(e=>{console.error("Error:",e),alert("Failed to save changes. Please try again.")}):alert("Date and Competition fields cannot be empty.")}(r);break;case"cancel-edit":n.preventDefault(),function(e){const t=document.querySelector(`tr[data-match-id="${e}"]`),n=t.querySelector("td:nth-child(2)"),o=t.querySelector("td:nth-child(3)");n.textContent=n.getAttribute("data-original-value"),o.textContent=o.getAttribute("data-original-value"),s(e)}(r)}}function s(e){const t=document.querySelector(`tr[data-match-id="${e}"]`);if(!t)return;const n=t.querySelector("td:last-child"),o=t.querySelector("td:nth-child(4) span"),s=(null==o?void 0:o.textContent.toLowerCase().trim())||"stopped";n.innerHTML=`\n      <div class="c-match-actions">\n        <div class="c-match-actions__dropdown dropdown d-inline-block me-2">\n          <button class="btn btn-link text-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" data-dropdown-toggle>\n            <i class="fas fa-ellipsis-v"></i>\n          </button>\n          <ul class="dropdown-menu dropdown-menu-end" data-dropdown-menu>\n            <li>\n              <a class="dropdown-item" href="#" data-action="edit-match" data-match-id="${e}">\n                <i class="fas fa-edit me-1"></i> Edit\n              </a>\n            </li>\n            <li>\n              <a class="dropdown-item text-danger" href="#" data-action="remove-match" data-match-id="${e}">\n                <i class="fas fa-trash-alt me-1"></i> Delete\n              </a>\n            </li>\n          </ul>\n        </div>\n        <button class="c-match-actions__button c-match-actions__button--primary" data-action="start-reporting" data-match-id="${e}" ${"running"===s?"disabled":""}>\n          ${"scheduled"===s?"Force Start":"running"===s?"Running":"Start"}\n        </button>\n        <button class="c-match-actions__button c-match-actions__button--danger" data-action="stop-reporting" data-match-id="${e}" ${"running"!==s?"disabled":""}>\n          Stop\n        </button>\n      </div>\n    `}function i(e,t){const n=document.getElementById(`status-${e}`),o=document.querySelector(`[data-action="start-reporting"][data-match-id="${e}"]`),s=document.querySelector(`[data-action="stop-reporting"][data-match-id="${e}"]`);n&&o&&s&&(n.textContent=t.charAt(0).toUpperCase()+t.slice(1),n.className=`c-live-status c-live-status--${t}`,"running"===t?(o.textContent="Running",o.disabled=!0,s.disabled=!1):"scheduled"===t?(o.textContent="Force Start",o.disabled=!1,s.disabled=!0):(o.textContent="Start",o.disabled=!1,s.disabled=!0))}function a(){fetch("/bot/admin/get_all_match_statuses").then(e=>e.json()).then(e=>{Object.entries(e).forEach(([e,t])=>{i(e,t.status)})}).catch(e=>console.error("Error updating statuses:",e))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()}(),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".value-option").forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.field;this.dataset.value,document.querySelectorAll(`[data-field="${e}"]`).forEach(e=>{e.classList.remove("selected")}),this.classList.add("selected"),this.querySelector('input[type="radio"]').checked=!0,et()})}),et()}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("onboardingSlideModal"),t=document.getElementById("modalCarouselControls"),n=document.getElementById("nextOrSaveButton"),o=document.getElementById("previousButton"),s=document.getElementById("carouselControls");document.getElementById("createProfileCarouselButton"),document.getElementById("skipProfileButton");const i=document.getElementById("onboardingProgress"),a=e?e.querySelector("form.needs-validation"):null,r=document.getElementById("form_action");document.getElementById("image");const c=document.getElementById("cropped_image_data");let l,d=document.querySelectorAll(".carousel-item").length;if(e){try{ModalManager.getInstance(e.id,{backdrop:"static",keyboard:!1}).show()}catch(g){}e.addEventListener("shown.bs.modal",function(){$(e).find(".select2-single").select2({theme:"bootstrap-5",width:"100%",placeholder:"Select an option",allowClear:!0,dropdownParent:$(e)}),$(e).find(".select2-multiple").select2({theme:"bootstrap-5",width:"100%",placeholder:"Select options",allowClear:!0,dropdownParent:$(e)}),f()}),e.addEventListener("hidden.bs.modal",function(){$(e).find(".select2-single, .select2-multiple").select2("destroy")})}null==e||e.addEventListener("shown.bs.modal",function(){window.SimpleCropperInstance||(window.SimpleCropperInstance=initializeSimpleCropper("cropCanvas"));const e=document.getElementById("image");e&&!e.hasAttribute("data-listener-added")&&(e.setAttribute("data-listener-added","true"),e.addEventListener("change",function(e){window.loadImageIntoCropper(this)}))}),t&&(l=new bootstrap.Carousel(t,{interval:!1,ride:!1,touch:!1,wrap:!1,keyboard:!1}),t.addEventListener("slide.bs.carousel",function(e){}),t.addEventListener("slid.bs.carousel",function(){p(),f()})),window.OnboardingWizard={getCurrentStep:h,updateNavButtons:p,updateProgress:f,getFormElements:()=>({form:a,formActionInput:r,croppedImageHiddenInput:c,carouselElement:t,bootstrapCarousel:l,totalSteps:d})};const u=document.getElementById("smsNotifications"),m=document.getElementById("smsOptInSection");function h(){if(!t)return-1;const e=t.querySelector(".carousel-item.active");if(!e)return-1;const n=e.getAttribute("data-step"),o=n?parseFloat(n):null;return o?Math.floor(o):-1}function p(){const e=h();0===e&&s?s.classList.add("d-none"):s&&(s.classList.remove("d-none"),1===e&&o?o.classList.add("d-none"):o&&o.classList.remove("d-none"),e===d&&n?(n.innerHTML="Save and Finish",n.type="button",n.classList.remove("btn-primary"),n.classList.add("btn-success"),n.removeAttribute("data-bs-slide"),n.removeAttribute("data-bs-target")):n&&(n.innerHTML='Next <i class="ti ti-chevron-right ms-2"></i>',n.type="button",n.classList.remove("btn-success"),n.classList.add("btn-primary"),n.removeAttribute("data-bs-slide"),n.removeAttribute("data-bs-target")))}function f(){if(!i)return;const e=h();if(e<=0)return;const t=Math.floor(e/d*100);i.style.width=`${t}%`,i.setAttribute("aria-valuenow",t);const n=document.getElementById("currentStep");n&&(n.textContent=`Step ${e} of ${d}`)}u&&m&&(u.checked?(m.classList.add("sms-section-show"),m.classList.remove("sms-section-hide","sms-section-entering")):(m.classList.add("sms-section-hide"),m.classList.remove("sms-section-show","sms-section-entering"))),window.OnboardingWizard.handleSmsToggle=function(e){const t=document.getElementById("smsOptInSection");if(!t)return;const n=t.querySelector("#phoneNumber"),o=t.querySelector("#smsConsent");e.checked?(t.classList.remove("sms-section-hide"),t.classList.add("sms-section-entering"),t.offsetWidth,setTimeout(()=>{t.classList.remove("sms-section-entering"),t.classList.add("sms-section-show")},10),n&&n.setAttribute("required","true"),o&&o.setAttribute("required","true")):(t.classList.remove("sms-section-show"),t.classList.add("sms-section-exiting"),setTimeout(()=>{t.classList.remove("sms-section-exiting"),t.classList.add("sms-section-hide")},300),n&&n.removeAttribute("required"),o&&o.removeAttribute("required"))},a&&a.addEventListener("submit",function(e){if(!a.checkValidity()){e.preventDefault(),e.stopPropagation();const t=a.querySelector(":invalid");t&&(t.focus(),t.scrollIntoView({behavior:"smooth",block:"center"}))}a.classList.add("was-validated")},!1),p(),f(),null==e||e.addEventListener("input",function(e){if(e.target.matches("input[required], select[required], textarea[required]")&&e.target.checkValidity()){e.target.classList.remove("is-invalid");const t=e.target.nextElementSibling;t&&t.classList.contains("invalid-feedback")&&t.remove()}})}),function(){const e=3e3,t=1e3,n=3e3;function s(e,t="info"){"undefined"!=typeof Swal?Swal.fire({toast:!0,position:"top-end",icon:t,title:e,showConfirmButton:!1,timer:n}):alert(e)}function i(){const e=document.querySelector('meta[name="csrf-token"]');if(e)return e.getAttribute("content");const t=document.querySelector('input[name="csrf_token"]');return t?t.value:null}function a(e){"undefined"!=typeof Swal?Swal.fire({title:"Verify Your Profile",text:"Please review your profile information and confirm it is accurate.",icon:"info",showCancelButton:!0,confirmButtonText:"Verify Now",cancelButtonText:"Later"}).then(t=>{t.isConfirmed&&(window.location.href=e)}):window.confirm("Please review your profile information and confirm it is accurate.\n\nVerify now?")&&(window.location.href=e)}function r(e){"undefined"!=typeof Swal&&Swal.fire({title:"Link Your Discord Account",text:"Connect your Discord account to receive notifications and access exclusive features.",icon:"info",showCancelButton:!0,confirmButtonText:"Link Discord",cancelButtonText:"Maybe Later",confirmButtonColor:"#7289DA"}).then(t=>{t.isConfirmed&&(window.location.href=e)})}function c(){document.addEventListener("click",function(e){const t=e.target.closest('[data-action="edit-toggle"]');if(t){const e=t.dataset.section,n=document.querySelector(`[data-profile-section="${e}"]`);return void(n&&function(e,t){e.querySelectorAll(".c-form-field").forEach(e=>{e.dataset.editing="true"}),e.querySelectorAll(".c-form-field__view:not(.c-form-field .c-form-field__view)").forEach(e=>{e.classList.add("u-hidden")}),e.querySelectorAll(".c-form-field__edit:not(.c-form-field .c-form-field__edit)").forEach(e=>{e.classList.remove("u-hidden")});const n=e.querySelector(".c-form-field__actions");n&&(n.classList.remove("u-hidden"),n.style.display="flex"),t.classList.add("u-hidden"),e.classList.add("is-editing"),console.log("[Player Profile] Entered edit mode for section:",e.dataset.profileSection)}(n,t))}const n=e.target.closest('[data-action="cancel-edit"]');if(n){const e=n.dataset.section,t=document.querySelector(`[data-profile-section="${e}"]`);return void(t&&function(e){e.querySelectorAll(".c-form-field").forEach(e=>{delete e.dataset.editing}),e.querySelectorAll(".c-form-field__view:not(.c-form-field .c-form-field__view)").forEach(e=>{e.classList.remove("u-hidden")}),e.querySelectorAll(".c-form-field__edit:not(.c-form-field .c-form-field__edit)").forEach(e=>{e.classList.add("u-hidden")});const t=e.querySelector(".c-form-field__actions");t&&(t.classList.add("u-hidden"),t.style.display="");const n=e.querySelector('[data-action="edit-toggle"]');n&&n.classList.remove("u-hidden"),e.classList.remove("is-editing"),console.log("[Player Profile] Exited edit mode for section:",e.dataset.profileSection)}(t))}})}function l(){document.addEventListener("click",function(e){const t=e.target.closest("[data-image-action]");if(t)switch(t.dataset.imageAction){case"upload":const e=document.querySelector('input[type="file"][data-image-upload]');e&&e.click();break;case"remove":!function(e){const t=e.dataset.removeUrl;t&&("undefined"!=typeof Swal?Swal.fire({title:"Remove Profile Picture?",text:"Your profile picture will be removed.",icon:"warning",showCancelButton:!0,confirmButtonText:"Remove",confirmButtonColor:"#dc3545"}).then(e=>{e.isConfirmed&&d(t)}):confirm("Remove your profile picture?")&&d(t))}(t);break;case"change":const n=document.querySelector('input[type="file"][data-image-upload]');n&&n.click()}})}function d(e){fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":i(),"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?(s("Profile picture removed","success"),setTimeout(()=>location.reload(),1e3)):s(e.message||"Failed to remove image","error")}).catch(e=>{console.error("Image remove error:",e),s("An error occurred","error")})}function u(){document.addEventListener("click",function(e){const t=e.target.closest('[data-action="edit-match-stat"]');if(t)return e.preventDefault(),void function(e){fetch(`/players/edit_match_stat/${e}`).then(e=>e.json()).then(t=>{const n=t.event_type?t.event_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"Event",o=t.minute||"";if("undefined"!=typeof Swal)Swal.fire({title:`Edit ${n}`,html:`\n                            <div class="mb-3 text-start">\n                                <label class="form-label">Match: ${t.match_date}</label>\n                            </div>\n                            <div class="mb-3 text-start">\n                                <label class="form-label" for="stat-minute">Minute</label>\n                                <input type="text" id="stat-minute" class="form-control" value="${o}" placeholder="e.g., 45, 90+2">\n                            </div>\n                        `,showCancelButton:!0,confirmButtonText:"Save",cancelButtonText:"Cancel",confirmButtonColor:"#696cff",preConfirm:()=>document.getElementById("stat-minute").value}).then(t=>{t.isConfirmed&&m(e,t.value)});else{const s=prompt(`Edit minute for ${n} (${t.match_date}):`,o);null!==s&&m(e,s)}}).catch(e=>{console.error("Error fetching stat:",e),s("Error loading stat data","error")})}(t.dataset.statId);const n=e.target.closest('[data-action="remove-match-stat"]');return n?(e.preventDefault(),void function(e,t){const n=t.closest("[data-match-stat]"),o=n?n.querySelector(".c-badge"):null,s=o?o.textContent.trim():"this stat";"undefined"!=typeof Swal?Swal.fire({title:"Remove Stat?",text:`Are you sure you want to remove "${s}"? This will also update the player's overall stats.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Remove",cancelButtonText:"Cancel",confirmButtonColor:"#dc3545"}).then(t=>{t.isConfirmed&&h(e,n)}):confirm(`Remove "${s}"? This will also update the player's overall stats.`)&&h(e,n)}(n.dataset.statId,n)):void 0})}function m(e,t){const n=new FormData;n.append("minute",t),fetch(`/players/edit_match_stat/${e}`,{method:"POST",headers:{"X-CSRFToken":i(),"X-Requested-With":"XMLHttpRequest"},body:n}).then(e=>e.json()).then(e=>{e.success?(s("Stat updated successfully","success"),setTimeout(()=>location.reload(),1e3)):s(e.error||"Failed to update stat","error")}).catch(e=>{console.error("Error updating stat:",e),s("An error occurred","error")})}function h(e,t){fetch(`/players/remove_match_stat/${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":i(),"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{e.success?(s("Stat removed successfully","success"),t?(t.style.transition="opacity 0.3s, transform 0.3s",t.style.opacity="0",t.style.transform="translateX(-20px)",setTimeout(()=>t.remove(),300)):setTimeout(()=>location.reload(),1e3)):s(e.error||"Failed to remove stat","error")}).catch(e=>{console.error("Error removing stat:",e),s("An error occurred","error")})}function p(){console.log("[Player Profile] Initializing..."),function(){if("undefined"==typeof bootstrap)return;const e=[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(e=>new bootstrap.Tooltip(e));console.log(`[Player Profile] Initialized ${e.length} tooltips`)}(),function(){const e=document.querySelector("[data-profile-verify]");if(!e)return;const n=e.dataset.verifyUrl;"true"!==e.dataset.verified&&n&&setTimeout(()=>{a(n)},t)}(),function(){const t=document.querySelector("[data-discord-prompt]");if(!t)return;const n=t.dataset.discordUrl,o="true"===t.dataset.linked,s=parseInt(t.dataset.delay)||e;!o&&n&&setTimeout(()=>{r(n)},s)}(),function(){const e=document.querySelector('[data-filter="matches"]');e&&e.addEventListener("change",function(){const e=this.value;document.querySelectorAll("[data-match-season]").forEach(t=>{const n=t.dataset.matchSeason;"all"===e||n===e?t.classList.remove("u-hidden"):t.classList.add("u-hidden")})})}(),c(),function(){const e=document.getElementById("contactModal");if(!e)return;const t=e.querySelector("form");t&&t.addEventListener("submit",function(n){n.preventDefault();const o=t.querySelector('[name="message"]');if(!o||!o.value.trim())return s("Please enter a message","error"),void(o&&o.focus());const i=new FormData(t),a=t.action;fetch(a,{method:"POST",body:i,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(n=>{if(n.success){s("Message sent successfully!","success"),t.reset();const n=bootstrap.Modal.getInstance(e);n&&n.hide()}else s(n.message||"Failed to send message","error")}).catch(e=>{console.error("Contact form error:",e),s("An error occurred. Please try again.","error")})})}(),function(){const e=document.querySelector("[data-flash-messages]");if(e)try{const t=JSON.parse(e.dataset.flashMessages);t&&t.length>0&&t.forEach(e=>{s(e.text,e.category)})}catch(o){console.error("Failed to parse flash messages:",o)}}(),l(),function(){const e=document.querySelector('[data-component="profile-tabs"]');e&&e.addEventListener("shown.bs.tab",function(t){e.querySelectorAll(".c-tabs__link--active").forEach(e=>{e.classList.remove("c-tabs__link--active")}),console.log("[Player Profile] Tab synced:",t.target)})}(),u(),console.log("[Player Profile] Initialization complete")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):p(),window.PlayerProfile={version:"1.0.0",showToast:s,showVerificationDialog:a,showDiscordLinkDialog:r,init:p}}(),function(){function e(e){var t;const n=document.createElement("form");n.method="POST",n.action=`/players/delete_player/${e}`;const o=null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.getAttribute("content");if(o){const e=document.createElement("input");e.type="hidden",e.name="csrf_token",e.value=o,n.appendChild(e)}document.body.appendChild(n),n.submit()}function t(e,t){return"undefined"!=typeof ECSTheme&&ECSTheme.getColor?ECSTheme.getColor(e):getComputedStyle(document.documentElement).getPropertyValue(`--ecs-${e}`).trim()||t}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(n){const o=n.target.closest("[data-action]");if(o)switch(o.dataset.action){case"clear-search":!function(e){e.preventDefault();const t=document.querySelector('[data-form="search-players"]');if(!t)return;const n=t.querySelector('[data-input="search"]');n&&(n.value=""),window.location.href=t.action}(n);break;case"delete-player":!function(n){const o=n.dataset.playerId,s=n.dataset.playerName;o?"undefined"!=typeof Swal?Swal.fire({title:"Are you sure?",html:`This will delete <strong>${s}</strong> and their associated user account.`,icon:"warning",showCancelButton:!0,confirmButtonColor:t("danger","#dc3545"),cancelButtonColor:t("secondary","#6c757d"),confirmButtonText:"Yes, delete them!",cancelButtonText:"Cancel",focusCancel:!0}).then(t=>{t.isConfirmed&&e(o)}):confirm(`Are you sure you want to delete ${s}? This will delete the player and associated user account.`)&&e(o):console.error("No player ID found for deletion")}(o)}}),function(){const e=document.querySelector('[data-form="update-players"]');e&&e.addEventListener("submit",function(n){n.preventDefault(),"undefined"!=typeof Swal?Swal.fire({title:"Sync with WooCommerce?",text:"This will synchronize player data with WooCommerce orders. Continue?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, sync now",cancelButtonText:"Cancel",confirmButtonColor:t("success","#28a745"),cancelButtonColor:t("secondary","#6c757d")}).then(n=>{n.isConfirmed&&function(e){var n;Swal.fire({title:"Syncing with WooCommerce",html:'\n        <div class="text-center">\n          <div class="mb-3 progress-stage">Initializing...</div>\n          <div class="progress mb-3">\n            <div class="progress-bar progress-bar-striped progress-bar-animated"\n                 role="progressbar"\n                 aria-valuenow="0"\n                 aria-valuemin="0"\n                 aria-valuemax="100"\n                 style="width: 0%">\n            </div>\n          </div>\n          <div class="small text-muted progress-message">Starting...</div>\n        </div>\n      ',allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1});let o="",s=null;const i=()=>{o&&fetch(`/players/update_status/${o}`).then(e=>e.json()).then(e=>{const t=document.querySelector(".progress-bar"),n=document.querySelector(".progress-message");if(t&&n){const o=e.progress||0;t.style.width=`${o}%`,t.setAttribute("aria-valuenow",o),n.textContent=e.message||"Processing..."}}).catch(e=>{console.error("Error fetching progress:",e)})},a=null==(n=e.querySelector('[name="csrf_token"]'))?void 0:n.value;fetch(e.action,{method:"POST",headers:{"X-CSRFToken":a}}).then(e=>e.json()).then(e=>{o=e.task_id,s=setInterval(i,1e3);const n=setInterval(()=>{o&&fetch(`/players/update_status/${o}`).then(e=>e.json()).then(e=>{"complete"===e.stage&&(clearInterval(n),clearInterval(s),function(e,n,o){const s=e.new_players||0,i=e.potential_inactive||0;Swal.fire({title:"Sync Results",html:`\n        <p><strong>${s}</strong> new players found</p>\n        <p><strong>${i}</strong> players without current orders</p>\n        <div class="mb-3 form-check">\n          <input type="checkbox" class="form-check-input" id="processNew" checked>\n          <label class="form-check-label" for="processNew">Import new players</label>\n        </div>\n        <div class="mb-3 form-check">\n          <input type="checkbox" class="form-check-input" id="processInactive" checked>\n          <label class="form-check-label" for="processInactive">Mark inactive players</label>\n        </div>\n      `,showCancelButton:!0,confirmButtonText:"Proceed",cancelButtonText:"Cancel",confirmButtonColor:t("success","#28a745"),cancelButtonColor:t("secondary","#6c757d")}).then(e=>{e.isConfirmed&&function(e,n){var o,s;const i=(null==(o=document.getElementById("processNew"))?void 0:o.checked)||!1,a=(null==(s=document.getElementById("processInactive"))?void 0:s.checked)||!1;fetch("/players/confirm_update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify({task_id:e,process_new:i,process_inactive:a})}).then(e=>e.json()).then(e=>{if("success"!==e.status)throw new Error(e.message||"Unknown error");Swal.fire({title:"Success!",text:"Player data has been synchronized.",icon:"success",confirmButtonColor:t("success","#28a745")}).then(()=>{window.location.reload()})}).catch(e=>{Swal.fire({title:"Error!",text:e.message||"An error occurred during synchronization.",icon:"error",confirmButtonColor:t("danger","#dc3545")})})}(n,o)})}(e,o,a))}).catch(e=>{console.error("Error checking completion:",e)})},1e3)}).catch(e=>{console.error("Error starting sync:",e),Swal.fire({title:"Error!",text:e.message||"An error occurred during synchronization.",icon:"error"})})}(e)}):this.submit()})}(),"undefined"!=typeof feather&&feather.replace()})}();class tt{constructor(e,t,n=null){this.leagueId=e,this.seasonId=t,this.currentTeamId=n,this.refreshInterval=null,this.autoRefreshEnabled=!0,this.autoRefreshDelay=3e4,this.data={groupA:{teams:[],matches:[],standings:[]},groupB:{teams:[],matches:[],standings:[]},placementMatches:[],status:"not_started"},this.initialize=this.initialize.bind(this),this.fetchBracketData=this.fetchBracketData.bind(this),this.renderBracket=this.renderBracket.bind(this),this.handleMatchReport=this.handleMatchReport.bind(this)}async initialize(){console.log("Initializing playoff bracket...",{leagueId:this.leagueId,seasonId:this.seasonId,currentTeamId:this.currentTeamId});try{await this.fetchBracketData(),this.renderBracket(),this.startAutoRefresh()}catch(e){console.error("Failed to initialize playoff bracket:",e),this.showError("Failed to load playoff bracket. Please refresh the page.")}}async fetchBracketData(){const e=`/api/playoffs/bracket/${this.leagueId}`;try{const t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();return console.log("Fetched bracket data:",n),this.data=n,n}catch(t){throw console.error("Error fetching bracket data:",t),t}}renderBracket(){const e=document.querySelector(".playoff-bracket-container");if(!e)return;const t=e.querySelector(".bracket-loading"),n=e.querySelector(".bracket-error"),o=e.querySelector(".bracket-content");t&&t.classList.add("d-none"),this.data&&this.data.groupA&&this.data.groupB?(n&&n.classList.add("d-none"),o&&o.classList.remove("d-none"),this.updateStatusBadge(),this.renderGroup("A",this.data.groupA),this.renderGroup("B",this.data.groupB),this.renderPlacementFinals(this.data.placementMatches)):n&&(n.classList.remove("d-none"),n.querySelector(".bracket-error-message").textContent="No playoff data available. Playoffs may not have been generated yet.")}updateStatusBadge(){const e=document.querySelector(".bracket-status-text");e&&(e.textContent={not_started:"Playoffs Not Started",group_stage:"Group Stage in Progress",week2_morning:"Week 2 Morning - Final Group Matches",placement_finals:"Placement Finals",completed:"Playoffs Completed"}[this.data.status]||"Unknown Status")}renderGroup(e,t){const n=document.getElementById(`group${e}Matches`),o=document.getElementById(`group${e}Standings`);if(!n||!o)return;if(n.innerHTML="",t.matches&&t.matches.length>0){const e=this.groupMatchesByRound(t.matches);Object.keys(e).sort().forEach(o=>{const s=document.createElement("div");s.className="round-group mb-3";const i=document.createElement("div");i.className="round-label",i.innerHTML=`<i class="ti ti-calendar-event me-1"></i>${this.getRoundLabel(o,t.matches[0])}`,s.appendChild(i),e[o].forEach(e=>{s.appendChild(this.createMatchCard(e))}),n.appendChild(s)})}else n.innerHTML='<p class="text-muted text-center">No matches scheduled</p>';if(o.innerHTML="",!o.querySelector(".standings-table")){const e=document.createElement("div");e.className="standings-table",o.appendChild(e)}const s=o.querySelector(".standings-table");s.innerHTML="",t.standings&&t.standings.length>0?t.standings.forEach((e,t)=>{s.appendChild(this.createStandingRow(e,t+1))}):s.innerHTML='<p class="text-muted text-center small">Standings will appear after matches are played</p>'}getRoundLabel(e,t){const n=parseInt(e);return 1===n?"Week 1":2===n?"Week 2 Morning":`Round ${n}`}groupMatchesByRound(e){const t={};return e.forEach(e=>{const n=e.playoff_round||1;t[n]||(t[n]=[]),t[n].push(e)}),t}createMatchCard(e){const t=document.createElement("div");t.className="bracket-match-card",t.dataset.matchId=e.id;const n=null!==e.home_team_score&&null!==e.away_team_score;n&&t.classList.add("reported"),!this.currentTeamId||e.home_team_id!=this.currentTeamId&&e.away_team_id!=this.currentTeamId||t.classList.add("current-team");let o=!1,s=!1;n&&(e.home_team_score>e.away_team_score?o=!0:e.away_team_score>e.home_team_score&&(s=!0));const i=`\n            <div class="match-teams">\n                <div class="team home-team ${o?"winner":""}">\n                    <span class="team-name">${e.home_team_name||"TBD"}</span>\n                    <span class="team-score">${null!==e.home_team_score?e.home_team_score:"-"}</span>\n                </div>\n                <div class="match-divider">vs</div>\n                <div class="team away-team ${s?"winner":""}">\n                    <span class="team-name">${e.away_team_name||"TBD"}</span>\n                    <span class="team-score">${null!==e.away_team_score?e.away_team_score:"-"}</span>\n                </div>\n            </div>\n        `,a=`\n            <div class="match-info">\n                <span class="match-time">\n                    <i class="ti ti-clock"></i>\n                    <span class="time-text">${e.date?new Date(e.date).toLocaleDateString():"TBD"} ${e.time||"TBD"}</span>\n                </span>\n                <span class="match-location">\n                    <i class="ti ti-map-pin"></i>\n                    <span class="location-text">${e.location||"TBD"}</span>\n                </span>\n            </div>\n        `,r=`\n            <button class="btn btn-sm btn-primary match-report-btn"\n                    data-match-id="${e.id}"\n                    onclick="window.playoffBracket.handleMatchReport(${e.id})">\n                <i class="ti ti-pencil"></i>\n                <span class="d-none d-md-inline">${n?"Edit":"Report"}</span>\n            </button>\n        `;return t.innerHTML=i+a+r,t}createStandingRow(e,t){const n=document.createElement("div");return n.className=`standings-row position-${t}`,n.dataset.teamId=e.team_id,this.currentTeamId&&e.team_id==this.currentTeamId&&n.classList.add("current-team"),n.innerHTML=`\n            <div class="position">${t}</div>\n            <div class="team-name">${e.team_name}</div>\n            <div class="stats">\n                <div class="stat">\n                    <span class="stat-label">PTS</span>\n                    <span class="stat-value">${e.points||0}</span>\n                </div>\n                <div class="stat">\n                    <span class="stat-label">GD</span>\n                    <span class="stat-value">${e.goal_difference||0}</span>\n                </div>\n                <div class="stat">\n                    <span class="stat-label">GF</span>\n                    <span class="stat-value">${e.goals_for||0}</span>\n                </div>\n            </div>\n        `,n}renderPlacementFinals(e){if(!e||0===e.length)return this.renderTBDPlacementMatch("championshipMatch","A1st vs B1st"),this.renderTBDPlacementMatch("thirdPlaceMatch","A2nd vs B2nd"),this.renderTBDPlacementMatch("fifthPlaceMatch","A3rd vs B3rd"),void this.renderTBDPlacementMatch("seventhPlaceMatch","A4th vs B4th");e.forEach(e=>{const t=(e.description||"").toLowerCase();let n=null;t.includes("championship")?n="championshipMatch":t.includes("3rd")?n="thirdPlaceMatch":t.includes("5th")?n="fifthPlaceMatch":t.includes("7th")&&(n="seventhPlaceMatch"),n&&this.renderPlacementMatch(n,e)})}renderTBDPlacementMatch(e,t){const n=document.getElementById(e);n&&(n.innerHTML=`\n            <div class="tbd-message">\n                <div class="text-center">\n                    <i class="ti ti-help-circle mb-2 tbd-icon"></i>\n                    <p class="mb-1">${t}</p>\n                    <small class="text-muted">To be determined after group stage</small>\n                </div>\n            </div>\n        `)}renderPlacementMatch(e,t){const n=document.getElementById(e);if(!n)return;const o=this.createMatchCard(t);n.innerHTML="",n.appendChild(o)}handleMatchReport(e){console.log("Opening match report modal for match:",e);const t=`reportMatchModal-${e}`,n=document.getElementById(t);n?ModalManager.show(n.id):(console.warn("Match report modal not found on page. You may need to load it first."),alert("Please navigate to the team page to report this match."))}startAutoRefresh(){this.autoRefreshEnabled&&(this.refreshInterval=setInterval(async()=>{console.log("Auto-refreshing bracket data...");try{await this.fetchBracketData(),this.renderBracket()}catch(e){console.error("Auto-refresh failed:",e)}},this.autoRefreshDelay))}stopAutoRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}async refresh(){console.log("Manual refresh triggered");try{await this.fetchBracketData(),this.renderBracket()}catch(e){console.error("Refresh failed:",e),this.showError("Failed to refresh bracket data.")}}showError(e){const t=document.querySelector(".playoff-bracket-container");if(!t)return;const n=t.querySelector(".bracket-error");n&&(n.classList.remove("d-none"),n.querySelector(".bracket-error-message").textContent=e);const o=t.querySelector(".bracket-loading"),s=t.querySelector(".bracket-content");o&&o.classList.add("d-none"),s&&s.classList.add("d-none")}destroy(){this.stopAutoRefresh()}}function nt(){document.querySelectorAll("[data-hours-until]").forEach(function(e){const t=parseFloat(e.getAttribute("data-hours-until"))-1/60;e.setAttribute("data-hours-until",t),e.textContent=function(e){return e<0?"READY":e<1?Math.round(60*e)+"m":e<24?Math.round(e)+"h":Math.round(e/24)+"d"}(t)})}"undefined"!=typeof window&&(window.PlayoffBracket=tt),function(){const e="bootstrap-5",t="You have unsaved changes. Are you sure you want to leave?";let n=!1,o=!1;function s(){n=!0}function i(){n=!1}function a(){console.log("[Profile Form] Initializing..."),function(){if("undefined"==typeof jQuery||void 0===jQuery.fn.select2)return void console.warn("[Profile Form] Select2 not available");const t=document.querySelectorAll("[data-select2]");t.forEach(t=>{const n=jQuery(t),o={theme:e,placeholder:t.dataset.placeholder||"Select an option",allowClear:"true"===t.dataset.allowClear,dropdownParent:t.dataset.dropdownParent?jQuery(t.dataset.dropdownParent):null};n.select2(o),n.on("change",function(){s()})}),console.log(`[Profile Form] Initialized ${t.length} Select2 dropdowns`)}(),function(){const e=document.querySelectorAll("[data-track-changes]");e.forEach(e=>{e.addEventListener("input",function(e){e.target.matches("input, textarea, select")&&s()}),e.addEventListener("change",function(e){e.target.matches("input, textarea, select")&&s()}),e.addEventListener("submit",function(){o=!0})}),console.log(`[Profile Form] Tracking changes on ${e.length} forms`)}(),window.addEventListener("beforeunload",function(e){if(n&&!o)return e.preventDefault(),e.returnValue=t,t}),document.addEventListener("click",function(e){const s=e.target.closest("a[href]");if(!s)return;if(o)return;const i=s.getAttribute("href");i&&"#"!==i&&!i.startsWith("javascript:")&&n&&(confirm(t)||e.preventDefault())}),console.log("[Profile Form] Unsaved changes warning enabled"),function(){const e=document.querySelectorAll("[data-auto-submit]");e.forEach(e=>{const t=parseInt(e.dataset.autoSubmitDelay)||0;let n=null;e.addEventListener("change",function(s){n&&clearTimeout(n),n=setTimeout(()=>{o=!0,e.submit()},t)})}),console.log(`[Profile Form] Initialized ${e.length} auto-submit forms`)}(),function(){const e=document.querySelectorAll("[data-validate]");e.forEach(e=>{e.addEventListener("submit",function(t){e.checkValidity()||(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated")})}),console.log(`[Profile Form] Initialized validation on ${e.length} forms`)}(),function(){const e=document.querySelectorAll('[data-format="phone"]');e.forEach(e=>{e.addEventListener("input",function(e){let t=e.target.value.replace(/\D/g,"");t.length>0&&(t=t.length<=3?`(${t}`:t.length<=6?`(${t.slice(0,3)}) ${t.slice(3)}`:`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6,10)}`),e.target.value=t})}),e.length>0&&console.log(`[Profile Form] Initialized phone formatting on ${e.length} inputs`)}(),function(){const e=document.querySelectorAll("[data-max-length]");e.forEach(e=>{const t=parseInt(e.dataset.maxLength),n=e.dataset.counter,o=n?document.getElementById(n):null;o&&(e.addEventListener("input",function(){const e=t-this.value.length;o.textContent=`${e} characters remaining`,e<20?o.classList.add("text-warning"):o.classList.remove("text-warning"),e<0&&(o.classList.add("text-danger"),o.classList.remove("text-warning"))}),e.dispatchEvent(new Event("input")))}),console.log(`[Profile Form] Initialized ${e.length} character counters`)}(),document.addEventListener("click",function(e){const t=e.target.closest('[data-action="reset-form"]');if(!t)return;const n=t.dataset.formId,o=document.getElementById(n);o&&confirm("Reset form to original values?")&&(o.reset(),"undefined"!=typeof jQuery&&jQuery(o).find(".select2-hidden-accessible").val(null).trigger("change"),i(),o.classList.remove("was-validated"))}),console.log("[Profile Form] Initialization complete")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a(),window.ProfileForm={version:"1.0.0",markFormChanged:s,markFormSaved:i,init:a}}(),function(){function e(){!function(){const e=document.querySelector('[data-action="close-window"]');e&&e.addEventListener("click",function(e){e.preventDefault();const t=function(){const e=window.location.pathname.match(/\/players\/profile\/(\d+)/);return e?e[1]:null}();window.location.href=t?`/players/profile/${t}`:"/"})}(),function(){const e=document.querySelector("[data-success-celebration]");e&&("vibrate"in navigator&&navigator.vibrate([50,30,50]),"true"===e.dataset.playSound&&function(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),n=e.createGain();t.connect(n),n.connect(e.destination),t.frequency.value=800,t.type="sine",n.gain.setValueAtTime(.1,e.currentTime),n.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),t.start(e.currentTime),t.stop(e.currentTime+.3)}catch(o){console.debug("Success sound not played:",o.message)}}())}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}(),new class{constructor(){var e;this.editMatchModal=null,this.isAddOperation=!1,this.currentMatchId=null,this.csrfToken=(null==(e=document.querySelector('meta[name="csrf-token"]'))?void 0:e.content)||null,this.init()}init(){document.addEventListener("DOMContentLoaded",()=>{if(document.getElementById("editMatchModal")){this.editMatchModal=ModalManager.getInstance("editMatchModal");const e=document.getElementById("editMatchForm");e&&e.addEventListener("submit",e=>this.handleMatchFormSubmit(e))}this.setupSingleWeekModal(),this.setupEditButtons(),this.setupDeleteButtons(),this.setupAddMatchButtons()})}setupSingleWeekModal(){const e=document.getElementById("addSingleWeekModal");if(!e)return;e.addEventListener("show.bs.modal",e=>{const t=e.relatedTarget;if(!t)return;const n=t.getAttribute("data-league-id");document.getElementById("singleWeekLeagueId").value=n,document.getElementById("singleWeekTimeSlots").innerHTML="",this.addSingleWeekTimeSlot()});const t=document.getElementById("addTimeSlotBtn");t&&t.addEventListener("click",e=>{e.preventDefault(),this.addSingleWeekTimeSlot()});const n=document.getElementById("addSingleWeekForm");n&&n.addEventListener("submit",e=>this.handleSingleWeekSubmit(e))}addSingleWeekTimeSlot(){const e=document.getElementById("singleWeekTimeSlots");if(!e)return;const t=document.getElementById("singleWeekLeagueId").value,n=window.leagueTeams[t]||[];let o='<option value="">--Select--</option>';n.forEach(e=>{o+=`<option value="${e.id}">${e.name}</option>`});const s=document.createElement("div");s.className="row g-2 mb-2",s.innerHTML=`\n          <div class="col-md-3">\n            <input type="time" name="times[]" class="form-control" required>\n          </div>\n          <div class="col-md-3">\n            <select name="fields[]" class="form-select" required>\n              <option value="North">North</option>\n              <option value="South">South</option>\n            </select>\n          </div>\n          <div class="col-md-3">\n            <select name="team_a[]" class="form-select" required>\n              ${o}\n            </select>\n          </div>\n          <div class="col-md-3">\n            <div class="input-group">\n              <select name="team_b[]" class="form-select" required>\n                ${o}\n              </select>\n              <button type="button" class="btn btn-danger" onclick="this.closest('.row').remove()">\n                <i class="ti ti-trash"></i>\n              </button>\n            </div>\n          </div>\n        `,e.appendChild(s)}async handleSingleWeekSubmit(e){e.preventDefault();const t=e.target,n=new FormData(t);try{const e=await fetch(t.action||"/publeague/schedules/add_single_week",{method:"POST",body:n}),o=await e.json();o.success?(bootstrap.Modal.getInstance(document.getElementById("addSingleWeekModal")).hide(),location.reload()):alert(o.message||"Error adding single week")}catch(o){alert("Error adding single week")}}setupAddMatchButtons(){document.querySelectorAll(".schedule-add-match-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n={league_id:e.dataset.leagueId,week:e.dataset.week,date:e.dataset.date};this.openAddMatchModal(n)})})}setupEditButtons(){document.querySelectorAll(".schedule-edit-match-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n={match_id:e.dataset.matchId,date:e.dataset.date,time:e.dataset.time,location:e.dataset.location,team_a_id:e.dataset.teamAId,team_b_id:e.dataset.teamBId,week:e.dataset.week};this.openEditMatchModal(n)})})}setupDeleteButtons(){document.querySelectorAll(".schedule-delete-match-btn").forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault();const n=e.dataset.matchId;this.deleteMatch(n)})})}openAddMatchModal({league_id:e,week:t,date:n}){if(!this.editMatchModal)return;this.isAddOperation=!0,this.currentMatchId=null;const o=document.getElementById("editMatchForm");o.reset(),document.getElementById("editWeek").value=t,document.getElementById("editDate").value=this.toISODate(n),document.getElementById("editMatchModalLabel").textContent="Add Match",o.querySelector('button[type="submit"]').textContent="Add Match",this.editMatchModal.show()}openEditMatchModal(e){this.editMatchModal&&(this.isAddOperation=!1,this.currentMatchId=e.match_id,document.getElementById("editMatchId").value=e.match_id,document.getElementById("editWeek").value=e.week||"",document.getElementById("editDate").value=this.toISODate(e.date),document.getElementById("editTime").value=this.toISOTime(e.time),document.getElementById("editLocation").value=e.location||"",document.getElementById("editTeamA").value=e.team_a_id||"",document.getElementById("editTeamB").value=e.team_b_id||"",document.getElementById("editMatchModalLabel").textContent="Edit Match",document.querySelector('#editMatchForm button[type="submit"]').textContent="Save Changes",this.editMatchModal.show())}async handleMatchFormSubmit(e){e.preventDefault();const t=e.target,n=new FormData(t),o=this.isAddOperation?"/publeague/schedules/add_match":`/publeague/schedules/edit_match/${this.currentMatchId}`;try{const e=await fetch(o,{method:"POST",body:n,headers:{"X-Requested-With":"XMLHttpRequest"}}),t=await e.json();t.success?(this.editMatchModal.hide(),alert(t.message||(this.isAddOperation?"Match created successfully":"Match updated successfully")),location.reload()):alert(t.message||"Failed to save match")}catch(s){alert("Error saving match")}}async deleteMatch(e){if(confirm("Are you sure you want to delete this match?"))try{const t=await fetch(`/publeague/schedules/delete_match/${e}`,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}}),n=await t.json();n.success?(alert(n.message||"Match deleted"),location.reload()):alert(n.message||"Failed to delete match")}catch(t){alert("Error deleting match")}}toISODate(e){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const t=new Date(e);return isNaN(t)?"":`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}toISOTime(e){if(/^\d{2}:\d{2}$/.test(e))return e;const t=e.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!t)return e;let[n,o,s,i]=t,a=parseInt(o,10);return i=i.toUpperCase(),"PM"===i&&a<12&&(a+=12),"AM"===i&&12===a&&(a=0),String(a).padStart(2,"0")+":"+s}},document.addEventListener("DOMContentLoaded",function(){(function(){const e=document.querySelector("[data-overdue-count]");e&&parseInt(e.getAttribute("data-overdue-count"))>0&&(setTimeout(function(){window.location.reload()},3e4),function(e){const t=document.title;let n=e;const o=setInterval(function(){document.title=`(${n}s) ${t}`,n--,n<0&&(clearInterval(o),document.title=t)},1e3)}(30))})(),"undefined"!=typeof bootstrap&&bootstrap.Tooltip&&[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)}),document.querySelectorAll('[onclick*="refreshValidation"]').forEach(function(e){e.id="refresh-btn"}),document.querySelectorAll("[data-hours-until]").length>0&&setInterval(nt,6e4)}),function(){const e={SELECTORS:{CONTAINER:"[data-tabs]",TRIGGER:"[data-tab-trigger]",PANE:"[data-tab-pane]"},CLASSES:{ACTIVE_TRIGGER:"is-active",ACTIVE_PANE:"c-settings-tab--active"},init(){document.querySelectorAll(this.SELECTORS.CONTAINER).forEach(e=>{"true"!==e.dataset.tabsInitialized&&(this.initContainer(e),e.dataset.tabsInitialized="true")}),this.handleHash()},initContainer(e){e.addEventListener("click",t=>{const n=t.target.closest(this.SELECTORS.TRIGGER);if(!n)return;t.preventDefault();const o=n.dataset.tabTrigger;o&&this.activateTab(e,o)}),e.addEventListener("keydown",t=>{const n=t.target.closest(this.SELECTORS.TRIGGER);if(!n)return;const o=Array.from(e.querySelectorAll(this.SELECTORS.TRIGGER)),s=o.indexOf(n);let i=-1;switch(t.key){case"ArrowLeft":case"ArrowUp":t.preventDefault(),i=s>0?s-1:o.length-1;break;case"ArrowRight":case"ArrowDown":t.preventDefault(),i=s<o.length-1?s+1:0;break;case"Home":t.preventDefault(),i=0;break;case"End":t.preventDefault(),i=o.length-1}if(i>=0&&o[i]){o[i].focus();const t=o[i].dataset.tabTrigger;t&&this.activateTab(e,t)}})},activateTab(e,t){const n=e.querySelectorAll(this.SELECTORS.TRIGGER),o=document.querySelectorAll(this.SELECTORS.PANE);n.forEach(e=>{e.classList.remove(this.CLASSES.ACTIVE_TRIGGER),e.setAttribute("aria-selected","false"),e.setAttribute("tabindex","-1")}),o.forEach(e=>{e.classList.remove(this.CLASSES.ACTIVE_PANE),e.classList.remove("is-active"),e.classList.remove("show","active")});const s=e.querySelector(`[data-tab-trigger="${t}"]`);s&&(s.classList.add(this.CLASSES.ACTIVE_TRIGGER),s.setAttribute("aria-selected","true"),s.setAttribute("tabindex","0"));const i=document.querySelector(`[data-tab-pane="${t}"]`);i&&(i.classList.add(this.CLASSES.ACTIVE_PANE),i.dispatchEvent(new CustomEvent("tab:activated",{bubbles:!0,detail:{tabId:t,container:e,trigger:s}}))),history.replaceState&&history.replaceState(null,null,`#${t}`)},handleHash(){const e=window.location.hash.slice(1);e&&document.querySelectorAll(this.SELECTORS.CONTAINER).forEach(t=>{t.querySelector(`[data-tab-trigger="${e}"]`)&&requestAnimationFrame(()=>{this.activateTab(t,e)})})},showTab(e){const t=document.querySelector(`[data-tab-trigger="${e}"]`);if(!t)return void console.warn(`SettingsTabs: Tab trigger not found for "${e}"`);const n=t.closest(this.SELECTORS.CONTAINER);n&&this.activateTab(n,e)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e.init()):e.init(),window.addEventListener("hashchange",()=>e.handleHash()),window.SettingsTabs=e}(),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("accountInfoForm"),t=document.getElementById("passwordChangeForm"),n=document.getElementById("notificationForm");document.getElementById("enable2FABtn"),document.getElementById("verify2FAForm");const o=document.getElementById("unlinkDiscordForm");document.getElementById("smsOptInBtn");const s=document.getElementById("smsOptOutBtn"),i=document.getElementById("smsOptInForm"),a=document.getElementById("smsVerificationForm"),r=document.getElementById("resendCodeBtn"),c=document.getElementById("smsConsentStep"),l=document.getElementById("smsVerificationStep"),d=document.getElementById("smsConfirmationStep");function u(){return document.querySelector('meta[name="csrf-token"]').getAttribute("content")}e&&e.addEventListener("submit",function(e){e.preventDefault(),this.submit()}),t&&t.addEventListener("submit",function(e){e.preventDefault(),document.getElementById("new_password").value===document.getElementById("confirm_password").value?this.submit():Swal.fire({icon:"error",title:"Oops...",text:"New passwords do not match!"})}),n&&n.addEventListener("submit",function(e){e.preventDefault(),this.submit()}),o&&o.addEventListener("submit",function(e){e.preventDefault(),Swal.fire({title:"Are you sure?",text:"You want to unlink your Discord account?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, unlink it!",cancelButtonText:"No, keep it"}).then(e=>{e.isConfirmed&&this.submit()})}),i&&i.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("phoneNumber").value,n=document.getElementById("smsConsent").checked;fetch("/account/initiate-sms-opt-in",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":u()},body:JSON.stringify({phone_number:t,consent_given:n})}).then(e=>e.json()).then(e=>{e.success?(c.classList.add("is-hidden"),l.classList.remove("is-hidden"),document.getElementById("sentPhoneNumber").textContent=t):Swal.fire({icon:"warning",title:"Resubscribe Required",text:e.message})})}),a&&a.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("verificationCode").value;fetch("/account/confirm-sms-opt-in",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":u()},body:JSON.stringify({confirmation_code:t})}).then(e=>e.json()).then(e=>{e.success?(l.classList.add("is-hidden"),d.classList.remove("is-hidden")):Swal.fire({icon:"error",title:"Invalid Code",text:e.message})}),setTimeout(function(){r.classList.remove("is-hidden")},1e4)}),r&&r.addEventListener("click",function(){fetch("/account/resend-sms-confirmation",{method:"POST",headers:{"X-CSRFToken":u()}}).then(e=>e.json()).then(e=>{Swal.fire({icon:"info",title:"Code Resent",text:e.message})})}),s&&s.addEventListener("click",function(){Swal.fire({title:"Are you sure?",text:"You want to opt-out of SMS notifications?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, opt-out!",cancelButtonText:"No, stay subscribed"}).then(e=>{e.isConfirmed&&fetch("/account/opt_out_sms",{method:"POST",headers:{"X-CSRFToken":u()}}).then(e=>e.json()).then(e=>{e.success?Swal.fire({icon:"success",title:"Opted Out",text:e.message}).then(()=>{location.reload()}):Swal.fire({icon:"error",title:"Error",text:"Failed to opt-out. Please try again."})})})})});class ot{constructor(e,t={}){this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.image=null,this.scale=1,this.offsetX=0,this.offsetY=0,this.isDragging=!1,this.lastX=0,this.lastY=0;const n="undefined"!=typeof ECSTheme?ECSTheme.getColor("light"):"#f8f9fa",o="undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd";this.options={cropSize:300,backgroundColor:n,borderColor:o,...t},this.init()}init(){this.canvas.width=this.options.cropSize,this.canvas.height=this.options.cropSize,this.canvas.classList.add("cropper-canvas"),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("wheel",this.handleWheel.bind(this)),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this)),this.drawBackground()}drawBackground(){this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#666",this.ctx.font="16px Arial",this.ctx.textAlign="center",this.ctx.fillText("Upload an image to crop",this.canvas.width/2,this.canvas.height/2)}loadImage(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=e=>{const o=new Image;o.onload=()=>{this.image=o,this.resetTransform(),this.draw(),t()},o.onerror=n,o.src=e.target.result},o.onerror=n,o.readAsDataURL(e)})}resetTransform(){if(!this.image)return;const e=this.canvas.width/this.image.width,t=this.canvas.height/this.image.height;this.scale=Math.max(e,t),this.offsetX=(this.canvas.width-this.image.width*this.scale)/2,this.offsetY=(this.canvas.height-this.image.height*this.scale)/2}draw(){this.image?(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.image,this.offsetX,this.offsetY,this.image.width*this.scale,this.image.height*this.scale),this.drawCropOverlay()):this.drawBackground()}drawCropOverlay(){this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2-10,0,2*Math.PI),this.ctx.fill(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.options.borderColor,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2-10,0,2*Math.PI),this.ctx.stroke()}handleMouseDown(e){this.isDragging=!0;const t=this.canvas.getBoundingClientRect();this.lastX=e.clientX-t.left,this.lastY=e.clientY-t.top}handleMouseMove(e){if(!this.isDragging||!this.image)return;const t=this.canvas.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top;this.offsetX+=n-this.lastX,this.offsetY+=o-this.lastY,this.lastX=n,this.lastY=o,this.draw()}handleMouseUp(){this.isDragging=!1}handleWheel(e){if(e.preventDefault(),!this.image)return;const t=e.deltaY>0?.9:1.1,n=this.scale*t;if(n<.1||n>5)return;const o=this.canvas.getBoundingClientRect(),s=e.clientX-o.left,i=e.clientY-o.top;this.offsetX=s-(s-this.offsetX)*(n/this.scale),this.offsetY=i-(i-this.offsetY)*(n/this.scale),this.scale=n,this.draw()}handleTouchStart(e){if(e.preventDefault(),1===e.touches.length){const t=e.touches[0],n=this.canvas.getBoundingClientRect();this.isDragging=!0,this.lastX=t.clientX-n.left,this.lastY=t.clientY-n.top}}handleTouchMove(e){if(e.preventDefault(),1===e.touches.length&&this.isDragging&&this.image){const t=e.touches[0],n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,s=t.clientY-n.top;this.offsetX+=o-this.lastX,this.offsetY+=s-this.lastY,this.lastX=o,this.lastY=s,this.draw()}}handleTouchEnd(e){e.preventDefault(),this.isDragging=!1}getCroppedImageData(e="image/jpeg",t=.8){if(!this.image)return null;const n=document.createElement("canvas"),o=n.getContext("2d"),s=300;n.width=s,n.height=s;const i=this.canvas.width/2,a=this.canvas.height/2,r=this.canvas.width/2-10;return o.drawImage(this.canvas,i-r,a-r,2*r,2*r,0,0,s,s),n.toDataURL(e,t)}reset(){this.image=null,this.scale=1,this.offsetX=0,this.offsetY=0,this.drawBackground()}}function st(e,t){"undefined"!=typeof toastr?toastr[e](t):"undefined"!=typeof Swal?Swal.fire({icon:"success"===e?"success":"error"===e?"error":"info",title:e.charAt(0).toUpperCase()+e.slice(1),text:t,timer:3e3,showConfirmButton:!1}):alert(t)}function it(){let e;$("#playerSearch").on("input",function(){clearTimeout(e);const t=$(this).val().trim();t.length<2?$("#searchResults").hide():e=setTimeout(function(){!function(e){const t=$("#searchLeagueFilter").val();$.ajax({url:"/api/substitute-pools/player-search",method:"GET",data:{q:e,league_type:t},success:function(e){e.success?function(e){const t=$("#searchResults");t.empty(),0===e.length?t.html('<div class="search-result-item">No players found</div>'):e.forEach(function(e){const n=$(`\n                <div class="search-result-item">\n                    <div class="d-flex justify-content-between align-items-center">\n                        <div>\n                            <strong>${e.name}</strong>\n                            <br><small class="text-muted">${e.email||"No email"}</small>\n                        </div>\n                        <div class="text-end">\n                            <small class="text-muted d-block">Can add to:</small>\n                            <div>\n                                ${e.can_add_to.map(t=>`\n                                    <button class="btn btn-sm btn-outline-primary ms-1"\n                                            data-action="add-player-to-league"\n                                            data-player-id="${e.id}"\n                                            data-league="${t}">\n                                        ${t}\n                                    </button>\n                                `).join("")}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `);t.append(n)}),t.show()}(e.players):st("error",e.message)},error:function(){st("error","Search failed. Please try again.")}})}(t)},300)}),$(document).on("click",function(e){$(e.target).closest(".search-container").length||$("#searchResults").hide()})}function at(e){const t=new Date-new Date(e),n=Math.floor(t/6e4),o=Math.floor(t/36e5),s=Math.floor(t/864e5);return n<1?"Just now":n<60?`${n}m ago`:o<24?`${o}h ago`:`${s}d ago`}function rt(e){const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function ct(e,t){"undefined"!=typeof toastr?toastr[e](t):"undefined"!=typeof showAlert?showAlert(e,t):alert(t)}function lt(e){$("#recentActivityTable").html('\n        <tr>\n            <td colspan="4" class="text-center">\n                <div class="spinner-border spinner-border-sm text-primary" role="status">\n                    <span class="visually-hidden">Loading...</span>\n                </div>\n                <span class="ms-2">Loading activity...</span>\n            </td>\n        </tr>\n    '),$.ajax({url:`/admin/substitute-pools/${e}/history`,method:"GET",timeout:1e4,success:function(e){console.log("Recent activity response:",e),e.success&&e.history?(console.log("History length:",e.history.length),dt(e.history.slice(0,10))):(console.log("No history in response or response not successful"),dt([]))},error:function(t,n,o){console.error("Error loading activity:",o,t.responseText);let s="Unable to load activity history";"timeout"===n?s="Request timed out - server may be slow":404===t.status?s="History endpoint not found":403===t.status?s="Access denied - insufficient permissions":500===t.status&&(s="Server error loading history"),$("#recentActivityTable").html(`\n                <tr>\n                    <td colspan="4" class="text-center">\n                        <i class="ti ti-alert-circle text-warning me-2"></i>\n                        <span class="text-muted">${s}</span>\n                        <br>\n                        <small class="text-muted">Status: ${t.status} - ${o}</small>\n                        <br>\n                        <button class="js-retry-activity mt-2" data-action="retry-activity" onclick="loadRecentActivity('${e}')">\n                            <i class="ti ti-refresh me-1"></i>Retry\n                        </button>\n                    </td>\n                </tr>\n            `)}})}function dt(e){const t=$("#recentActivityTable");t.empty(),e&&0!==e.length?e.forEach(e=>{let n="bg-secondary";"ADDED"!==e.action&&"APPROVED"!==e.action||(n="bg-success"),"REMOVED"===e.action&&(n="bg-danger"),"UPDATED"===e.action&&(n="bg-info");const o=`\n            <tr>\n                <td><small>${rt(e.performed_at)}</small></td>\n                <td><span data-component="action-badge" class="${n}">${e.action}</span></td>\n                <td>${e.player_name||"Unknown"}</td>\n                <td>${e.performer_name||"System"}</td>\n            </tr>\n        `;t.append(o)}):t.html('\n            <tr>\n                <td colspan="4" class="text-center py-4">\n                    <i class="ti ti-clock-off text-muted mb-2 d-block icon-lg"></i>\n                    <span class="text-muted">No recent activity for this pool</span>\n                    <br>\n                    <small class="text-muted">Activities will appear here when players are added or removed</small>\n                </td>\n            </tr>\n        ')}function ut(e){$("#substituteRequestsTable").html('\n        <tr>\n            <td colspan="5" class="text-center">\n                <div class="spinner-border spinner-border-sm text-primary" role="status">\n                    <span class="visually-hidden">Loading...</span>\n                </div>\n                <span class="ms-2">Loading substitute requests...</span>\n            </td>\n        </tr>\n    '),$.ajax({url:`/admin/substitute-pools/${e}/requests`,method:"GET",timeout:1e4,success:function(e){console.log("Substitute requests response:",e),e.success&&e.requests?mt(e.requests):mt([])},error:function(t,n,o){console.error("Error loading substitute requests:",o),$("#substituteRequestsTable").html(`\n                <tr>\n                    <td colspan="5" class="text-center">\n                        <i class="ti ti-alert-circle text-warning me-2"></i>\n                        <span class="text-muted">Unable to load substitute requests</span>\n                        <br>\n                        <button class="js-retry-requests mt-2" data-action="retry-requests" onclick="loadSubstituteRequests('${e}')">\n                            <i class="ti ti-refresh me-1"></i>Retry\n                        </button>\n                    </td>\n                </tr>\n            `)}})}function mt(e){const t=$("#substituteRequestsTable");t.empty(),e&&0!==e.length?e.forEach(e=>{let n="bg-secondary",o=e.status;if("OPEN"===e.status||"FILLED"===e.status){const t=e.assigned_count||0,s=e.substitutes_needed||1;e.assignments_remaining,0===t?(n="bg-warning",o=`0 of ${s} assigned`):t<s?(n="bg-info",o=`${t} of ${s} assigned`):(n="bg-success",o=`${t} of ${s} assigned`)}else"CANCELLED"===e.status&&(n="bg-danger",o="Cancelled");const s=at(e.created_at),i="OPEN"===e.status,a="OPEN"===e.status,r="CANCELLED"===e.status,c=`\n            <tr>\n                <td>\n                    <small>${rt(e.created_at)}</small>\n                    <br>\n                    <small class="text-muted">${s}</small>\n                </td>\n                <td>\n                    <strong>${e.team_name||"Unknown Team"}</strong>\n                    ${e.positions_needed?`<br><small class="text-muted">${e.positions_needed}</small>`:""}\n                </td>\n                <td>\n                    <span data-component="status-badge" class="${n}">${o}</span>\n                </td>\n                <td>\n                    <span class="fw-bold">${e.response_rate}</span>\n                    ${e.available_responses>0?`<br><small class="text-success">${e.available_responses} available</small>`:'<br><small class="text-muted">No responses</small>'}\n                </td>\n                <td>\n                    <div data-component="action-buttons">\n                        ${i?`\n                            <button data-action="resend-request" \n                                    data-request-id="${e.id}" \n                                    data-league="${e.league_type}"\n                                    data-team="${e.team_name}"\n                                    data-created="${e.created_at}"\n                                    title="Resend notifications">\n                                <i class="ti ti-send"></i>\n                            </button>\n                        `:""}\n                        ${a?`\n                            <button data-action="cancel-request" \n                                    data-request-id="${e.id}" \n                                    data-league="${e.league_type}"\n                                    data-team="${e.team_name}"\n                                    title="Cancel request">\n                                <i class="ti ti-x"></i>\n                            </button>\n                        `:""}\n                        ${r?`\n                            <button data-action="delete-request"\n                                    data-request-id="${e.id}"\n                                    data-league="${e.league_type}"\n                                    data-team="${e.team_name}"\n                                    title="Delete cancelled request">\n                                <i class="ti ti-trash"></i>\n                            </button>\n                        `:""}\n                        <button data-action="view-request-details" \n                                data-request-id="${e.id}" \n                                title="View details">\n                            <i class="ti ti-eye"></i>\n                        </button>\n                    </div>\n                </td>\n            </tr>\n        `;t.append(c)}):t.html('\n            <tr>\n                <td colspan="5" class="text-center py-4">\n                    <i class="ti ti-message-off text-muted mb-2 d-block icon-lg"></i>\n                    <span class="text-muted">No recent substitute requests</span>\n                    <br>\n                    <small class="text-muted">Substitute requests will appear here when teams request subs</small>\n                </td>\n            </tr>\n        ')}function ht(e,t,n,o){const s=new Date,i=new Date(o),a=Math.floor((s-i)/6e4);if(a<30){const o=`This substitute request for ${n} was sent only ${a} minutes ago. Are you sure you want to send notifications again?`;if("undefined"!=typeof Swal)return void Swal.fire({title:"Resend Confirmation",text:o,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, resend it!"}).then(n=>{n.isConfirmed&&pt(e,t)});if(!confirm(o))return}pt(e,t)}function pt(e,t){const n=$(`[data-action="resend-request"][data-request-id="${e}"]`),o=n.html();n.prop("disabled",!0),n.html('<i class="ti ti-loader spinner-border spinner-border-sm"></i>'),$.ajax({url:`/admin/substitute-pools/${t}/requests/${e}/resend`,method:"POST",success:function(e){e.success?(ct("success",e.message),ut(t)):ct("error",e.message)},error:function(n){const o=n.responseJSON;if(o&&o.requires_confirmation){const n=`${o.message} Send anyway?`;"undefined"!=typeof Swal?Swal.fire({title:"Force Resend?",text:n,icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, send anyway!"}).then(n=>{n.isConfirmed&&resendSubstituteRequestForce(e,t)}):confirm(n)&&resendSubstituteRequestForce(e,t)}else ct("error","Failed to resend substitute request")},complete:function(){n.prop("disabled",!1),n.html(o)}})}function ft(e){e?($("#matchSubstituteRequestsTable").html('\n        <tr>\n            <td colspan="5" class="text-center">\n                <div class="spinner-border spinner-border-sm text-primary" role="status">\n                    <span class="visually-hidden">Loading...</span>\n                </div>\n                <span class="ms-2">Loading substitute requests...</span>\n            </td>\n        </tr>\n    '),$.ajax({url:`/admin/substitute-pools/match/${e}/requests`,method:"GET",timeout:1e4,success:function(e){console.log("Match substitute requests response:",e),e.success&&e.requests?gt(e.requests):gt([])},error:function(t,n,o){console.error("Error loading match substitute requests:",o),$("#matchSubstituteRequestsTable").html(`\n                <tr>\n                    <td colspan="5" class="text-center">\n                        <i class="ti ti-alert-circle text-warning me-2"></i>\n                        <span class="text-muted">Unable to load substitute requests</span>\n                        <br>\n                        <button class="js-retry-match-requests mt-2" data-action="retry-match-requests" data-match-id="${e}" onclick="loadMatchSubstituteRequests(this.dataset.matchId)">\n                            <i class="ti ti-refresh me-1"></i>Retry\n                        </button>\n                    </td>\n                </tr>\n            `)}})):console.warn("No match ID provided for loading substitute requests")}function gt(e){const t=$("#matchSubstituteRequestsTable");t.empty(),e&&0!==e.length?e.forEach(e=>{let n="bg-secondary",o=e.status;if("OPEN"===e.status||"FILLED"===e.status){const t=e.assigned_count||0,s=e.substitutes_needed||1;e.assignments_remaining,0===t?(n="bg-warning",o=`0 of ${s} assigned`):t<s?(n="bg-info",o=`${t} of ${s} assigned`):(n="bg-success",o=`${t} of ${s} assigned`)}else"CANCELLED"===e.status&&(n="bg-danger",o="Cancelled");const s=at(e.created_at),i="OPEN"===e.status,a="OPEN"===e.status,r="CANCELLED"===e.status,c=`\n            <tr>\n                <td>\n                    <small>${rt(e.created_at)}</small>\n                    <br>\n                    <small class="text-muted">${s}</small>\n                </td>\n                <td>\n                    <strong>${e.team_name||"Unknown Team"}</strong>\n                    ${e.positions_needed?`<br><small class="text-muted">${e.positions_needed}</small>`:""}\n                </td>\n                <td>\n                    <span data-component="status-badge" class="${n}">${o}</span>\n                </td>\n                <td>\n                    <span class="fw-bold">${e.response_rate}</span>\n                    ${e.available_responses>0?`<br><small class="text-success">${e.available_responses} available</small>`:'<br><small class="text-muted">No responses</small>'}\n                </td>\n                <td>\n                    <div data-component="action-buttons">\n                        ${i?`\n                            <button data-action="resend-match-request" \n                                    data-request-id="${e.id}" \n                                    data-league="${e.league_type}"\n                                    data-team="${e.team_name}"\n                                    data-created="${e.created_at}"\n                                    title="Resend notifications">\n                                <i class="ti ti-send"></i>\n                            </button>\n                        `:""}\n                        ${a?`\n                            <button data-action="cancel-match-request" \n                                    data-request-id="${e.id}" \n                                    data-league="${e.league_type}"\n                                    data-team="${e.team_name}"\n                                    title="Cancel request">\n                                <i class="ti ti-x"></i>\n                            </button>\n                        `:""}\n                        ${r?`\n                            <button data-action="delete-request"\n                                    data-request-id="${e.id}"\n                                    data-league="${e.league_type}"\n                                    data-team="${e.team_name}"\n                                    title="Delete cancelled request">\n                                <i class="ti ti-trash"></i>\n                            </button>\n                        `:""}\n                        <button data-action="view-match-request-details" \n                                data-request-id="${e.id}" \n                                title="View details">\n                            <i class="ti ti-eye"></i>\n                        </button>\n                    </div>\n                </td>\n            </tr>\n        `;t.append(c)}):t.html('\n            <tr>\n                <td colspan="5" class="text-center py-4">\n                    <i class="ti ti-message-off text-muted mb-2 d-block icon-lg"></i>\n                    <span class="text-muted">No substitute requests for this match</span>\n                    <br>\n                    <small class="text-muted">Create a new request to notify substitutes</small>\n                </td>\n            </tr>\n        ')}function vt(e,t){const n=$(`[data-action="resend-match-request"][data-request-id="${e}"]`),o=n.html();n.prop("disabled",!0),n.html('<i class="ti ti-loader spinner-border spinner-border-sm"></i>'),$.ajax({url:`/admin/substitute-pools/${t}/requests/${e}/resend`,method:"POST",success:function(e){e.success?(ct("success",e.message),"undefined"!=typeof matchId&&ft(matchId)):ct("error",e.message)},error:function(e){const t=e.responseJSON;if(t&&t.requires_confirmation){const e=`${t.message} Send anyway?`;"undefined"!=typeof Swal?Swal.fire({title:"Force Resend?",text:e,icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, send anyway!"}).then(e=>{e.isConfirmed&&ct("info","Force resend not yet implemented")}):confirm(e)&&ct("info","Force resend not yet implemented")}else ct("error","Failed to resend substitute request")},complete:function(){n.prop("disabled",!1),n.html(o)}})}function yt(e,t){$.ajax({url:`/api/substitute-pools/requests/${e}`,method:"DELETE",success:function(n){n.success?(ct("success","Request deleted successfully"),$(`[data-action="delete-request"][data-request-id="${e}"]`).closest("tr").fadeOut(300,function(){$(this).remove();const e=$("#matchSubstituteRequestsTable, #substituteRequestsTable");0===e.find("tr").length&&e.html('\n                            <tr>\n                                <td colspan="5" class="text-center py-4">\n                                    <i class="ti ti-message-off text-muted mb-2 d-block icon-lg"></i>\n                                    <span class="text-muted">No substitute requests</span>\n                                </td>\n                            </tr>\n                        ')}),lt(t),ut(t),"undefined"!=typeof matchId&&ft(matchId)):ct("error",n.error||"Failed to delete request")},error:function(e){var t;ct("error",(null==(t=e.responseJSON)?void 0:t.error)||"Failed to delete substitute request")}})}function bt(e,t){$.ajax({url:`/admin/substitute-pools/${t}/requests/${e}`,method:"GET",success:function(e){e.success?function(e){const t=e.responses.filter(e=>e.is_available),n=e.responses.filter(e=>!e.is_available),o=0===e.total_responses;let s="";o?s='\n            <div class="alert alert-info">\n                <i class="ti ti-info-circle me-2"></i>\n                No responses received yet.\n            </div>\n        ':(t.length>0&&(s+=`\n                <div class="mb-4">\n                    <h6 class="text-success"><i class="ti ti-check-circle me-2"></i>Available (${t.length})</h6>\n                    <div class="list-group">\n            `,t.forEach(t=>{const n="OPEN"===e.status&&0===e.assignments.length;s+=`\n                    <div class="list-group-item d-flex justify-content-between align-items-center">\n                        <div>\n                            <strong>${t.player_name}</strong>\n                            <br>\n                            <small class="text-muted">\n                                <i class="ti ti-clock me-1"></i>Responded ${rt(t.responded_at)}\n                                via ${t.response_method}\n                            </small>\n                            ${t.player_phone?`<br><small class="text-muted"><i class="ti ti-phone me-1"></i>${t.player_phone}</small>`:""}\n                        </div>\n                        <div>\n                            ${n?`\n                                <button data-action="assign-substitute" \n                                        data-request-id="${e.id}" \n                                        data-player-id="${t.player_id}"\n                                        data-player-name="${t.player_name}"\n                                        data-league="${e.league_type}">\n                                    <i class="ti ti-user-plus me-1"></i>Assign\n                                </button>\n                            `:""}\n                        </div>\n                    </div>\n                `}),s+="</div></div>"),n.length>0&&(s+=`\n                <div class="mb-4">\n                    <h6 class="text-warning"><i class="ti ti-x-circle me-2"></i>Not Available (${n.length})</h6>\n                    <div class="list-group">\n            `,n.forEach(e=>{s+=`\n                    <div class="list-group-item">\n                        <strong>${e.player_name}</strong>\n                        <br>\n                        <small class="text-muted">\n                            <i class="ti ti-clock me-1"></i>Responded ${rt(e.responded_at)}\n                            via ${e.response_method}\n                        </small>\n                    </div>\n                `}),s+="</div></div>"));let i="";e.assignments.length>0&&(i='\n            <div class="mb-4">\n                <h6 class="text-primary"><i class="ti ti-user-check me-2"></i>Assigned Substitute</h6>\n                <div class="list-group">\n        ',e.assignments.forEach(e=>{i+=`\n                <div class="list-group-item">\n                    <div class="d-flex justify-content-between align-items-center">\n                        <div>\n                            <strong>${e.player_name}</strong>\n                            ${e.position_assigned?`<span class="badge bg-info ms-2">${e.position_assigned}</span>`:""}\n                            <br>\n                            <small class="text-muted">\n                                <i class="ti ti-clock me-1"></i>Assigned ${rt(e.assigned_at)}\n                            </small>\n                            ${e.notes?`<br><small class="text-muted"><i class="ti ti-note me-1"></i>${e.notes}</small>`:""}\n                        </div>\n                        <span class="badge bg-success">Assigned</span>\n                    </div>\n                </div>\n            `}),i+="</div></div>");const a=`\n        <div class="modal fade" id="requestDetailsModal" tabindex="-1">\n            <div class="modal-dialog modal-lg">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h5 class="modal-title">\n                            <i class="ti ti-list-details me-2"></i>\n                            Substitute Request Details - ${e.team_name}\n                        </h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="row mb-4">\n                            <div class="col-md-6">\n                                <h6>Request Information</h6>\n                                <p><strong>Team:</strong> ${e.team_name}</p>\n                                <p><strong>League:</strong> ${e.league_type}</p>\n                                <p><strong>Status:</strong> ${(()=>{const t=e.assigned_count||0,n=e.substitutes_needed||1;let o="bg-secondary",s=e.status;return"OPEN"===e.status||"FILLED"===e.status?0===t?(o="bg-warning",s=`0 of ${n} assigned`):t<n?(o="bg-info",s=`${t} of ${n} assigned`):(o="bg-success",s=`${t} of ${n} assigned`):"CANCELLED"===e.status&&(o="bg-danger",s="Cancelled"),`<span class="badge ${o}">${s}</span>`})()}</p>\n                                <p><strong>Created:</strong> ${rt(e.created_at)}</p>\n                                ${e.positions_needed?`<p><strong>Positions:</strong> ${e.positions_needed}</p>`:""}\n                                ${e.gender_preference?`<p><strong>Gender Preference:</strong> <span class="badge bg-info">${e.gender_preference}</span></p>`:""}\n                                ${e.notes?`<p><strong>Notes:</strong> ${e.notes}</p>`:""}\n                            </div>\n                            <div class="col-md-6">\n                                <h6>Response Summary</h6>\n                                <p><strong>Total Notified:</strong> ${e.total_responses}</p>\n                                <p><strong>Available:</strong> <span class="text-success">${e.available_responses}</span></p>\n                                <p><strong>Not Available:</strong> <span class="text-warning">${e.total_responses-e.available_responses}</span></p>\n                                <p><strong>Response Rate:</strong> ${e.response_rate}</p>\n                            </div>\n                        </div>\n                        \n                        ${i}\n                        ${s}\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" data-action="close-modal" data-bs-dismiss="modal">Close</button>\n                        ${"OPEN"===e.status?`\n                            <button type="button" data-action="resend-from-details" \n                                    data-request-id="${e.id}" \n                                    data-league="${e.league_type}"\n                                    data-team="${e.team_name}"\n                                    data-created="${e.created_at}">\n                                <i class="ti ti-send me-2"></i>Resend Notifications\n                            </button>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `;$("#requestDetailsModal").remove(),$("body").append(a),$("#requestDetailsModal").modal("show")}(e.request):ct("error",e.message)},error:function(){ct("error","Failed to load request details")}})}function wt(e,t,n,o){$.ajax({url:`/admin/substitute-pools/${n}/requests/${e}/assign`,method:"POST",contentType:"application/json",data:JSON.stringify({player_id:t,position_assigned:o,notes:""}),success:function(e){if(e.success){if(ct("success",e.message),$("#requestDetailsModal").modal("hide"),$("#substituteRequestsTable").length){const e=$("#leagueManagementModal").data("current-league");e&&ut(e)}$("#matchSubstituteRequestsTable").length&&"undefined"!=typeof matchId&&ft(matchId)}else ct("error",e.message)},error:function(){ct("error","Failed to assign substitute")}})}window.SimpleCropperInstance=null,window.initializeSimpleCropper=function(e){return window.SimpleCropperInstance=new ot(e),window.SimpleCropperInstance},window.loadImageIntoCropper=function(e){const t=e.files[0];t&&window.SimpleCropperInstance&&window.SimpleCropperInstance.loadImage(t).then(()=>{switchToCropMode()}).catch(e=>{console.error("Error loading image:",e),window.Swal&&Swal.fire({icon:"error",title:"Error",text:"Failed to load image. Please try again."})})},window.switchToCropMode=function(){const e=document.getElementById("profilePicturePreview"),t=document.getElementById("uploadInstructions");e&&e.classList.add("d-none"),t&&t.classList.add("d-none");const n=document.getElementById("cropperInterface"),o=document.getElementById("cropperControls");n&&n.classList.remove("d-none"),o&&o.classList.remove("d-none")},window.resetImageSelection=function(){window.SimpleCropperInstance&&window.SimpleCropperInstance.reset();const e=document.getElementById("image");e&&(e.value=""),switchToUploadMode()},window.switchToUploadMode=function(){const e=document.getElementById("profilePicturePreview"),t=document.getElementById("uploadInstructions");e&&e.classList.remove("d-none"),t&&t.classList.remove("d-none");const n=document.getElementById("cropperInterface"),o=document.getElementById("cropperControls");n&&n.classList.add("d-none"),o&&o.classList.add("d-none")},window.getCroppedImage=function(){return window.SimpleCropperInstance?window.SimpleCropperInstance.getCroppedImageData():null},window.cropAndSaveProfileImage=async function(){var e;const t=window.getCroppedImage();if(t){window.Swal&&Swal.fire({title:"Saving Image...",text:"Optimizing and saving your profile picture",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}});try{const n=document.getElementById("cropped_image_data");n&&(n.value=t);const o=null==(e=document.getElementById("playerId"))?void 0:e.value;if(o){const e=new FormData;e.append("cropped_image_data",t);const n=document.querySelector('input[name="csrf_token"]');n&&e.append("csrf_token",n.value);const s=`/players/player/${o}/upload_profile_picture`,i=await fetch(s,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:e});if(!i.ok)throw new Error(`Upload failed: ${i.status}`);const a=await i.json();console.log("Image uploaded successfully:",a)}const s=document.getElementById("currentProfilePicture");s&&(s.src=t),switchToUploadMode(),window.Swal&&Swal.fire({icon:"success",title:"Image Saved!",text:"Your profile picture has been optimized and saved to your profile.",timer:3e3,showConfirmButton:!1})}catch(n){console.error("Error saving image:",n);const e=document.getElementById("currentProfilePicture");e&&(e.src=t),switchToUploadMode(),window.Swal&&Swal.fire({icon:"warning",title:"Image Prepared",text:"Image cropped successfully. It will be saved when you complete registration.",timer:3e3,showConfirmButton:!1})}}else window.Swal&&Swal.fire({icon:"warning",title:"No Image",text:"Please select and adjust an image first."})},window.handleDragStart=function(e){const t=e.target.closest(".player-card, .player-list-item");t&&(t.classList.add("dragging"),e.dataTransfer.setData("text/plain",JSON.stringify({playerId:t.dataset.playerId,league:t.dataset.league,status:t.dataset.status})))},window.handleDragEnd=function(e){const t=e.target.closest(".player-card, .player-list-item");t&&t.classList.remove("dragging")},window.handleDragOver=function(e){e.preventDefault(),e.currentTarget.classList.add("drag-over")},window.handleDragLeave=function(e){e.currentTarget.classList.remove("drag-over")},window.handleDrop=function(e){e.preventDefault();const t=e.currentTarget;t.classList.remove("drag-over");const n=JSON.parse(e.dataTransfer.getData("text/plain")),o=t.dataset.status,s=t.dataset.league;var i,a;n.league===s?n.status!==o&&("active"===o?(i=n.playerId,a=n.league,$.ajax({url:`/admin/substitute-pools/${a}/add-player`,method:"POST",contentType:"application/json",data:JSON.stringify({player_id:i,sms_notifications:!0,discord_notifications:!0,email_notifications:!0}),success:function(e){e.success?(st("success",e.message),setTimeout(()=>location.reload(),1500)):st("error",e.message)},error:function(){st("error","Failed to add player to pool")}})):"pending"===o&&function(e,t){confirm("Are you sure you want to remove this player from the substitute pool?")&&$.ajax({url:`/admin/substitute-pools/${t}/remove-player`,method:"POST",contentType:"application/json",data:JSON.stringify({player_id:e}),success:function(e){e.success?(st("success",e.message),setTimeout(()=>location.reload(),1500)):st("error",e.message)},error:function(){st("error","Failed to remove player from pool")}})}(n.playerId,n.league)):st("error","Cannot move players between different leagues")},$(document).ready(function(){it()}),$(document).on("click",'[data-action="resend-request"]',function(){ht($(this).data("request-id"),$(this).data("league"),$(this).data("team"),$(this).data("created"))}),$(document).on("click",'[data-action="cancel-request"]',function(){!function(e,t,n){if(!confirm(`Are you sure you want to cancel the substitute request for ${n}?`))return;const o=$(`[data-action="cancel-request"][data-request-id="${e}"]`),s=o.html();o.prop("disabled",!0),o.html('<i class="ti ti-loader spinner-border spinner-border-sm"></i>'),$.ajax({url:`/admin/substitute-pools/${t}/requests/${e}/cancel`,method:"POST",success:function(e){e.success?(ct("success",e.message),ut(t)):ct("error",e.message)},error:function(){ct("error","Failed to cancel substitute request")},complete:function(){o.prop("disabled",!1),o.html(s)}})}($(this).data("request-id"),$(this).data("league"),$(this).data("team"))}),$(document).on("click",'[data-action="refresh-requests"]',function(){const e=$("#leagueManagementModal").data("current-league");e&&ut(e)}),$(document).on("click",'[data-action="view-request-details"]',function(){bt($(this).data("request-id"),$("#leagueManagementModal").data("current-league"))}),$(document).on("click",'[data-action="resend-match-request"]',function(){!function(e,t,n,o){const s=new Date,i=new Date(o),a=Math.floor((s-i)/6e4);if(a<30){const o=`This substitute request for ${n} was sent only ${a} minutes ago. Are you sure you want to send notifications again?`;if("undefined"!=typeof Swal)return void Swal.fire({title:"Resend Confirmation",text:o,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, resend it!"}).then(n=>{n.isConfirmed&&vt(e,t)});if(!confirm(o))return}vt(e,t)}($(this).data("request-id"),$(this).data("league"),$(this).data("team"),$(this).data("created"))}),$(document).on("click",'[data-action="cancel-match-request"]',function(){!function(e,t,n){if(!confirm(`Are you sure you want to cancel the substitute request for ${n}?`))return;const o=$(`[data-action="cancel-match-request"][data-request-id="${e}"]`),s=o.html();o.prop("disabled",!0),o.html('<i class="ti ti-loader spinner-border spinner-border-sm"></i>'),$.ajax({url:`/admin/substitute-pools/${t}/requests/${e}/cancel`,method:"POST",success:function(e){e.success?(ct("success",e.message),"undefined"!=typeof matchId&&ft(matchId)):ct("error",e.message)},error:function(){ct("error","Failed to cancel substitute request")},complete:function(){o.prop("disabled",!1),o.html(s)}})}($(this).data("request-id"),$(this).data("league"),$(this).data("team"))}),$(document).on("click",'[data-action="delete-request"]',function(){!function(e,t,n){"undefined"!=typeof Swal?Swal.fire({title:"Delete Request?",text:`Are you sure you want to delete this cancelled substitute request for ${n}? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"}).then(n=>{n.isConfirmed&&yt(e,t)}):confirm(`Are you sure you want to delete this cancelled substitute request for ${n}? This action cannot be undone.`)&&yt(e,t)}($(this).data("request-id"),$(this).data("league"),$(this).data("team"))}),$(document).on("click",'[data-action="refresh-match-requests"]',function(){"undefined"!=typeof matchId&&ft(matchId)}),$(document).on("click",'[data-action="view-match-request-details"]',function(){bt($(this).data("request-id"),"ECS FC")}),$(document).on("click","#bulkApproveBtn",function(){const e=$("#leagueManagementModal").data("current-league"),t=parseInt($(`#pending-count-${e}`).text())||0;0!==t?confirm(`Are you sure you want to approve all ${t} pending players for this league?`)&&function(e){const t=$(`[data-component="player-item"][data-league="${e}"][data-status="pending"]`),n=[];if(t.each(function(){const e=$(this).data("player-id");e&&n.push(e)}),0===n.length)return void ct("info","No pending players to approve");let o=0;n.forEach(t=>{"function"==typeof approvePlayer&&(approvePlayer(t,e),o++,o===n.length&&(ct("success",`Approved ${o} players`),setTimeout(()=>location.reload(),1500)))})}(e):ct("info","No pending players to approve")}),$(document).on("click","#exportPoolBtn",function(){$("#leagueManagementModal").data("current-league");const e=$(this);e.prop("disabled",!0),e.html('<i class="ti ti-loader me-2 spinner-border spinner-border-sm"></i>Exporting...'),setTimeout(function(){e.prop("disabled",!1),e.html('<i class="ti ti-download me-2"></i>Export Pool Data'),ct("success","Pool data export started. Check your downloads.")},1500)}),$(document).on("click","#sendNotificationBtn",function(){const e=$("#leagueManagementModal").data("current-league"),t=parseInt($(`#active-count-${e}`).text())||0;0!==t?ct("info",`Notification feature coming soon! Would notify ${t} active substitutes.`):ct("warning","No active substitutes to notify")}),$(document).on("click","#savePoolSettings",function(){const e=$("#leagueManagementModal").data("current-league"),t=$("#defaultMaxMatches").val(),n=$("#autoApprovalSwitch").is(":checked"),o=$(this);o.prop("disabled",!0),o.text("Saving..."),setTimeout(function(){o.prop("disabled",!1),o.text("Save Settings"),ct("success","Pool settings saved successfully"),console.log("Saving settings for",e,{defaultMaxMatches:t,autoApproval:n})},1e3)}),$(document).on("click",'[data-action="assign-substitute"]',function(){const e=$(this).data("request-id"),t=$(this).data("player-id"),n=$(this).data("player-name"),o=$(this).data("league");if("undefined"!=typeof Swal)Swal.fire({title:"Assign Substitute",text:`Assign ${n} as substitute for this match?`,input:"text",inputLabel:"Position (optional)",inputPlaceholder:"e.g., Forward, Midfielder",showCancelButton:!0,confirmButtonText:"Assign",cancelButtonText:"Cancel",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"#198754"}).then(n=>{n.isConfirmed&&wt(e,t,o,n.value||"")});else{const s=prompt(`Assign ${n} as substitute.\nPosition (optional):`)||"";null!==s&&wt(e,t,o,s)}}),$(document).on("click",'[data-action="resend-from-details"]',function(){const e=$(this).data("request-id"),t=$(this).data("league"),n=$(this).data("team"),o=$(this).data("created");$("#requestDetailsModal").modal("hide"),ht(e,t,n,o)}),function(){let e={zoom:1,xPos:50,yPos:50,originalImage:null,imageWidth:0,imageHeight:0},t=!1,n=0,o=0,s=50,i=50;function a(a){t=!0,n=a.clientX,o=a.clientY,s=e.xPos,i=e.yPos,document.body.style.cursor="move"}function r(a){if(!t)return;const r=a.clientX-n,c=a.clientY-o,d=document.getElementById("headerPreview");if(!d)return;const u=d.offsetWidth,m=.3*u,h=r/u*100/e.zoom,p=c/m*100/e.zoom;e.xPos=Math.max(0,Math.min(100,s-h)),e.yPos=Math.max(0,Math.min(100,i-p));const f=document.getElementById("xPosSlider"),g=document.getElementById("yPosSlider");f&&(f.value=e.xPos),g&&(g.value=e.yPos),l();const v=document.getElementById("dragHint");v&&(v.style.display="none")}function c(){t=!1,document.body.style.cursor=""}function l(){const t=document.getElementById("previewImageWrapper"),n=document.getElementById("zoomValue");if(!t||!e.originalImage)return;const o=1===e.zoom?"cover":100*e.zoom+"%";t.style.backgroundImage=`url(${e.originalImage})`,t.style.backgroundSize=o,t.style.backgroundPosition=`${e.xPos}% ${e.yPos}%`,n&&(n.textContent=Math.round(100*e.zoom)+"%")}function d(){e.zoom=1,e.xPos=50,e.yPos=50;const t=document.getElementById("zoomSlider"),n=document.getElementById("xPosSlider"),o=document.getElementById("yPosSlider");t&&(t.value=1),n&&(n.value=50),o&&(o.value=50),l()}function u(e){var t;"undefined"!=typeof Swal&&Swal.fire({title:"Assigning Discord Roles...",html:"Processing role assignments for this team.",icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}});const n=null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.getAttribute("content");fetch(`/teams/${e}/assign-discord-roles`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":n}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to assign Discord roles");"undefined"!=typeof Swal?Swal.fire({icon:"success",title:"Discord Roles Assigned!",html:`Successfully processed Discord role assignments.<br><br><strong>${e.processed_count||0}</strong> players processed successfully`,timer:5e3,showConfirmButton:!0}):alert(`Discord roles assigned successfully! ${e.processed_count||0} players processed.`)}).catch(e=>{console.error("Error:",e),"undefined"!=typeof Swal?Swal.fire({icon:"error",title:"Error",text:e.message||"Failed to assign Discord roles. Please try again."}):alert("Error: "+(e.message||"Failed to assign Discord roles. Please try again."))})}function m(e){var t;"undefined"!=typeof Swal&&Swal.fire({title:"Refreshing Discord Status...",html:"Checking Discord server status for all players.",icon:"info",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}});const n=null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.getAttribute("content");fetch(`/teams/${e}/refresh-discord-status`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":n}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to refresh Discord status");"undefined"!=typeof Swal?Swal.fire({icon:"success",title:"Discord Status Refreshed!",html:`Successfully refreshed Discord status.<br><br><strong>${e.processed_count||0}</strong> players checked`,timer:5e3,showConfirmButton:!0}).then(()=>{window.location.reload()}):(alert(`Discord status refreshed successfully! ${e.processed_count||0} players processed.`),window.location.reload())}).catch(e=>{console.error("Error:",e),"undefined"!=typeof Swal?Swal.fire({icon:"error",title:"Error",text:e.message||"Failed to refresh Discord status. Please try again."}):alert("Error: "+(e.message||"Failed to refresh Discord status. Please try again."))})}function h(e,t){return"undefined"!=typeof ECSTheme&&ECSTheme.getColor?ECSTheme.getColor(e):getComputedStyle(document.documentElement).getPropertyValue(`--ecs-${e}`).trim()||t}function p(){const e=document.querySelectorAll(".c-schedule__week"),t=document.querySelector('[data-action="expand-all-schedule"]'),n=document.querySelector('[data-action="collapse-all-schedule"]');if(!t||!n||0===e.length)return;const o=Array.from(e).every(e=>!e.open),s=Array.from(e).every(e=>e.open);t.disabled=s,t.classList.toggle("is-disabled",s),n.disabled=o,n.classList.toggle("is-disabled",o)}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(t){const n=t.target.closest("[data-action]");if(n)switch(n.dataset.action){case"trigger-file-input":!function(e){const t=e.dataset.target,n=document.querySelector(`[data-action="auto-submit"][data-target="${t}"]`);n&&n.click()}(n);break;case"trigger-background-input":!function(e){const t=e.dataset.target,n=document.querySelector(`[data-action="load-image-cropping"][data-target="${t}"]`);n&&n.click()}(n);break;case"load-image-cropping":case"edit-match":case"close-modal":break;case"adjust-zoom":!function(t){const n=parseFloat(t.dataset.delta),o=document.getElementById("zoomSlider");if(o){const t=Math.max(1,Math.min(3,parseFloat(o.value)+n));o.value=t,e.zoom=t,l()}}(n);break;case"reset-image-position":d();break;case"upload-cropped-image":!function(){if(!e.originalImage)return;const t=new FormData;fetch(e.originalImage).then(e=>e.blob()).then(n=>{var o;const s=function(){const e=window.location.pathname.match(/\/teams\/(\d+)/);return e?e[1]:null}();if(!s)return void console.error("Unable to determine team ID");t.append("team_background",n,"background.jpg");const i=null==(o=document.querySelector('meta[name="csrf-token"]'))?void 0:o.getAttribute("content");i&&t.append("csrf_token",i);const a={zoom:e.zoom,xPos:e.xPos,yPos:e.yPos,backgroundSize:1===e.zoom?"cover":100*e.zoom+"%",backgroundPosition:`${e.xPos}% ${e.yPos}%`};t.append("position_data",JSON.stringify(a));const r=document.querySelector('[data-action="upload-cropped-image"]');if(r){const e=r.innerHTML;r.innerHTML='<i class="ti ti-loader"></i>Uploading...',r.disabled=!0,fetch(`/teams/${s}/upload_team_background`,{method:"POST",body:t}).then(e=>{if(!e.ok)throw new Error("Upload failed");window.location.reload()}).catch(t=>{console.error("Error:",t),alert("Error uploading image. Please try again."),r.innerHTML=e,r.disabled=!1})}})}();break;case"assign-discord-roles":!function(e){const t=e.dataset.teamId;"undefined"!=typeof Swal?Swal.fire({title:"Assign Discord Roles?",html:'This will assign Discord roles to all players on this team.<br><br><small class="text-info">This is a manual fix for the draft role assignment issue.</small>',icon:"question",showCancelButton:!0,confirmButtonColor:h("warning","#ffc107"),cancelButtonColor:h("secondary","#6c757d"),confirmButtonText:"Yes, Assign Roles",cancelButtonText:"Cancel",focusCancel:!1}).then(e=>{e.isConfirmed&&u(t)}):confirm("Are you sure you want to assign Discord roles to all players on this team?")&&u(t)}(n);break;case"refresh-discord-status":!function(e){const t=e.dataset.teamId;"undefined"!=typeof Swal?Swal.fire({title:"Refresh Discord Status?",html:"This will check the current Discord server status for all players on this team.",icon:"question",showCancelButton:!0,confirmButtonColor:h("info","#17a2b8"),cancelButtonColor:h("secondary","#6c757d"),confirmButtonText:"Yes, Refresh Status",cancelButtonText:"Cancel",focusCancel:!1}).then(e=>{e.isConfirmed&&m(t)}):confirm("Are you sure you want to refresh Discord status for all players on this team?")&&m(t)}(n);break;case"refresh-player-discord":!function(e){const t=e.dataset.playerId,n=e.dataset.playerName;"undefined"!=typeof Swal&&Swal.fire({title:"Refresh Discord Status?",html:`Check if <strong>${n}</strong> has joined the Discord server?`,icon:"question",showCancelButton:!0,confirmButtonColor:h("info","#17a2b8"),cancelButtonColor:h("secondary","#6c757d"),confirmButtonText:"Yes, Check Now",cancelButtonText:"Cancel"}).then(o=>{o.isConfirmed&&function(e,t,n){var o;const s=null==(o=document.querySelector('meta[name="csrf-token"]'))?void 0:o.getAttribute("content");fetch(`/teams/player/${e}/refresh-discord-status`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s}}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to refresh Discord status");n.classList.remove("c-discord-badge--active","c-discord-badge--inactive"),!0===e.in_server?n.classList.add("c-discord-badge--active"):!1===e.in_server&&n.classList.add("c-discord-badge--inactive"),"undefined"!=typeof Swal&&Swal.fire({icon:e.in_server?"success":"warning",title:"Discord Status Updated!",html:`<strong>${t}</strong><br>Status: ${e.status_change}`,timer:3e3,showConfirmButton:!1,toast:!0,position:"top-end"})}).catch(e=>{console.error("Error:",e),"undefined"!=typeof Swal&&Swal.fire({icon:"error",title:"Error",text:e.message||`Failed to check Discord status for ${t}.`,toast:!0,position:"top-end",timer:5e3})})}(t,n,e)})}(n);break;case"expand-all-schedule":document.querySelectorAll(".c-schedule__week").forEach(e=>{e.open=!0}),p();break;case"collapse-all-schedule":document.querySelectorAll(".c-schedule__week").forEach(e=>{e.open=!1}),p()}}),function(){const n=document.querySelector('[data-action="load-image-cropping"]');n&&n.addEventListener("change",function(n){n.target.files&&n.target.files[0]&&function(n){if(n.files&&n.files[0]){const o=new FileReader;o.onload=function(n){e.originalImage=n.target.result;const o=new Image;o.onload=function(){e.imageWidth=this.width,e.imageHeight=this.height,d();const n=document.getElementById("cropBackgroundModal");n&&(bootstrap.Modal.getOrCreateInstance(n).show(),setTimeout(()=>{!function(){const n=document.getElementById("previewImageWrapper"),o=document.getElementById("zoomSlider"),s=document.getElementById("xPosSlider"),i=document.getElementById("yPosSlider"),d=document.getElementById("dragHint");if(!(n&&o&&s&&i))return;l();let u=!0;function m(){u&&d&&(d.style.display="none",u=!1)}o.addEventListener("input",function(){e.zoom=parseFloat(this.value),l(),m()}),s.addEventListener("input",function(){e.xPos=parseFloat(this.value),l(),m()}),i.addEventListener("input",function(){e.yPos=parseFloat(this.value),l(),m()}),n.addEventListener("mousedown",a),document.addEventListener("mousemove",r),document.addEventListener("mouseup",c),n.addEventListener("touchstart",function(e){const t=e.touches[0];a({clientX:t.clientX,clientY:t.clientY})}),document.addEventListener("touchmove",function(e){if(t){const t=e.touches[0];r({clientX:t.clientX,clientY:t.clientY})}}),document.addEventListener("touchend",c)}()},100))},o.src=n.target.result},o.readAsDataURL(n.files[0])}}(n.target)})}(),[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e,{delay:{show:500,hide:100}})}),document.querySelectorAll('[data-action="auto-submit"]').forEach(e=>{e.addEventListener("change",function(){const e=this.closest("form");e&&e.submit()})}),document.querySelectorAll("[data-background-url]").forEach(e=>{const t=e.dataset.backgroundUrl,n=e.dataset.backgroundSize||"cover",o=e.dataset.backgroundPosition||"center";e.style.backgroundImage=`url('${t}')`,e.style.backgroundSize=n,e.style.backgroundPosition=o}),function(){const e=document.querySelectorAll(".c-schedule__week[data-date]");if(0===e.length)return;const t=new Date;t.setHours(0,0,0,0);let n=null,o=null,s=null,i=null;e.forEach(e=>{const a=e.dataset.date;if(!a)return;const r=new Date(a+"T00:00:00");(!i||r>i)&&(i=r,s=e),r>=t&&(!o||r<o)&&(o=r,n=e)}),e.forEach(e=>{e.open=!1});const a=n||s;a&&(a.open=!0),e.forEach(e=>{e.addEventListener("toggle",p)}),p()}()})}(),function(){const e={init(){this.restoreActiveTab(),this.setupTabPersistence(),this.optimizeForMobile()},restoreActiveTab(){const e=localStorage.getItem("teamOverviewActiveTab");e&&window.TabsController&&window.TabsController.showTab(e)},setupTabPersistence(){document.addEventListener("tab:activated",e=>{const{tabId:t}=e.detail;t&&localStorage.setItem("teamOverviewActiveTab",t)})},optimizeForMobile(){if(window.innerWidth<768){const e=document.querySelector("[data-tabs]");e&&e.classList.add("c-nav-modern--scrollable")}}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e.init()):e.init()}(),document.addEventListener("DOMContentLoaded",function(){if(document.querySelector(".alert-danger")){const e=document.querySelector(".token-input");e&&(e.classList.add("animate"),setTimeout(()=>{e.classList.remove("animate")},500))}const e=document.querySelector(".token-input");e&&setTimeout(()=>{e.focus()},500);const t=document.getElementById("twoFactorForm");t&&t.addEventListener("submit",function(e){const n=window.location.href;t.action=n})}),document.addEventListener("DOMContentLoaded",function(){const e=window.verifyMergeData||{};e.hasToken&&setTimeout(function(){const e=document.getElementById("verify-form");e&&e.submit()},2e3);const t=document.getElementById("resend-email-btn");t&&t.addEventListener("click",function(){const t=this,n=t.innerHTML;Swal.fire({title:"Resend Verification Email?",text:`We'll send another verification email to ${e.oldEmail}.`,icon:"question",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"var(--ecs-primary)",cancelButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("secondary"):"#6c757d",confirmButtonText:'<i class="ti ti-mail me-1"></i>Resend Email',cancelButtonText:"Cancel"}).then(o=>{o.isConfirmed&&(t.disabled=!0,t.innerHTML='<i class="ti ti-loader-2 rotating me-1"></i>Sending...',fetch(e.resendUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.csrfToken},body:JSON.stringify({old_email:e.oldEmail,merge_data:e.mergeData})}).then(e=>e.json()).then(e=>{if(!e.success)throw new Error(e.message||"Failed to send email");Swal.fire({title:"Email Sent!",text:"We've sent another verification email. Please check your inbox.",icon:"success",confirmButtonText:"OK"})}).catch(e=>{Swal.fire({title:"Error",text:"Failed to send verification email. Please try again later.",icon:"error",confirmButtonText:"OK"})}).finally(()=>{t.disabled=!1,t.innerHTML=n}))})})}),function(){const e={init(){this.initializeBootstrapComponents(),this.setupTabPersistence(),this.optimizeForMobile()},initializeBootstrapComponents(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(e=>new bootstrap.Tooltip(e,{delay:{show:300,hide:100}})),[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(e=>new bootstrap.Popover(e,{delay:{show:100,hide:100},container:"body"}))},setupTabPersistence(){const e=localStorage.getItem("standingsActiveTab");if(e){const t=document.getElementById(e);t&&new bootstrap.Tab(t).show()}document.querySelectorAll("#league-tabs button").forEach(e=>{e.addEventListener("shown.bs.tab",e=>{localStorage.setItem("standingsActiveTab",e.target.id)})})},optimizeForMobile(){if(window.innerWidth<768){const e=document.querySelector("#league-tabs");e&&e.classList.add("c-nav-modern--scrollable")}}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>e.init()):e.init()}(),document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector('a[href*="waitlist_discord_register"]');e&&e.focus()});let St=!1;function _t(){const e=parseInt(document.getElementById("totalSeasonWeeks").value),t=document.getElementById("seasonBreakdown"),n=function(){var e,t,n;let o=0;return(null==(e=document.getElementById("includeTstWeek"))?void 0:e.checked)&&o++,(null==(t=document.getElementById("includeFunWeek"))?void 0:t.checked)&&o++,(null==(n=document.getElementById("includeByeWeek"))?void 0:n.checked)&&o++,o}(),o=e-2-n,s=e-1-n,i=document.getElementById("premierRegularWeeks"),a=document.getElementById("classicRegularWeeks");i&&(i.value=o),a&&(a.value=s),t.innerHTML=`\n        <div><strong>Premier:</strong> ${o} regular + 2 playoff weeks</div>\n        <div><strong>Classic:</strong> ${s} regular + 1 playoff week</div>\n        <div class="text-muted"><small>Plus ${n} shared special weeks</small></div>\n        <div class="text-muted"><small>Total season length: ${e} weeks</small></div>\n    `}function Et(){document.getElementById("totalSeasonWeeks")&&(function(){const e=document.querySelectorAll(".wizard-field-item");document.querySelectorAll('[data-action="remove-field"]').forEach(t=>{t.disabled=e.length<=2})}(),_t(),function(){let e=7;const t=document.getElementById("premierRegularWeeks"),n=document.getElementById("classicRegularWeeks"),o=document.getElementById("totalSeasonWeeks");t&&n?e=Math.max(parseInt(t.value)||7,parseInt(n.value)||8):o&&(e=Math.min(8,parseInt(o.value||11)-3));const s=document.getElementById("classicPracticeWeekCheckboxes");if(s){s.innerHTML="";for(let t=1;t<=e;t++){const e=document.createElement("div");e.className="form-check form-check-inline";const n=1===t||3===t?"checked":"";e.innerHTML=`\n                <input class="form-check-input" type="checkbox" id="practice-week-${t}" value="${t}" ${n}>\n                <label class="form-check-label" for="practice-week-${t}">Week ${t}</label>\n            `,s.appendChild(e)}}}())}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector('button[type="submit"]');e&&e.focus(),document.addEventListener("click",function(e){const t=e.target.closest("[data-action]");if(t)switch(t.dataset.action){case"show-profile-modal":ModalManager.show("profileModal");break;case"toggle-edit":!function(){St=!St;const e=document.getElementById("editProfileBtn"),t=document.getElementById("profileForm").querySelectorAll("input:not([readonly]), select, textarea");St?(t.forEach(e=>{"name"!==e.id&&"email"!==e.id&&(e.removeAttribute("readonly"),e.removeAttribute("disabled"))}),e.innerHTML='<i class="ti ti-x me-1"></i>Cancel Edit',e.className="btn btn-secondary"):(t.forEach(e=>{"SELECT"===e.tagName?e.setAttribute("disabled","disabled"):e.setAttribute("readonly","readonly")}),e.innerHTML='<i class="ti ti-edit me-1"></i>Edit Profile',e.className="btn btn-warning")}();break;case"verify-profile":!function(){const e=window.playerData||{};if(!e.id)return void Swal.fire({title:"No Player Profile",text:"No player profile found. Please contact an administrator.",icon:"error"});let t={};if(St){const e=document.getElementById("profileForm"),n=new FormData(e);for(let[o,s]of n.entries())t[o]=s}Swal.fire({title:St?"Save & Verify Profile":"Verify Profile Information",html:`<div class="text-start">\n               <p class="mb-2">Please confirm that your profile information is current and accurate.</p>\n               <p class="mb-2">This includes:</p>\n               <ul class="mb-3">\n                   <li>Contact information (email, phone)</li>\n                   <li>Player details (jersey size, positions, availability)</li>\n                   <li>Personal information (pronouns, notes)</li>\n               </ul>\n               <p class="fw-bold mb-0">By confirming, you ${St?"save your changes and":""} verify that all information is up to date.</p>\n               </div>`,icon:"question",showCancelButton:!0,confirmButtonText:St?"Save & Verify":"Yes, my profile is accurate",cancelButtonText:"Cancel",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("success"):"#28a745",showLoaderOnConfirm:!0,preConfirm:()=>{const n=St?e.updateUrl:e.verifyUrl,o="POST",s={"Content-Type":"application/json","X-CSRFToken":e.csrfToken},i=St?JSON.stringify(t):JSON.stringify({});return fetch(n,{method:o,headers:s,body:i}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{if(e.success)return e;throw new Error(e.message||"Operation failed")}).catch(e=>{Swal.showValidationMessage("Error: "+e.message)})}}).then(e=>{if(e.isConfirmed){const e=bootstrap.Modal.getInstance(document.getElementById("profileModal"));e&&e.hide(),Swal.fire({title:St?"Profile Updated & Verified!":"Profile Verified!",text:St?"Your profile has been updated and verified successfully.":"Thank you for confirming your profile information is current.",icon:"success",confirmButtonText:"Continue to Waitlist"}).then(()=>{window.location.reload()})}})}()}})}),function(){var e;const t=null==(e=document.querySelector('meta[name="csrf-token"]'))?void 0:e.getAttribute("content");function n(e,t,n){"undefined"!=typeof Swal?Swal.fire({icon:e,title:t,text:n,timer:2e3,showConfirmButton:!1,toast:!0,position:"top-end"}):alert(`${t}: ${n}`)}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("change",function(e){const o=e.target.closest("[data-setting-toggle]");o&&function(e,o,s){const i=e.parentElement.querySelector("[data-toggle-status]"),a=document.querySelector(`[data-setting-row][data-setting-key="${o}"] .c-setting-row__status-icon`);e.disabled=!0,i&&(i.textContent="Updating..."),fetch("/admin_panel/toggle_setting",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},body:JSON.stringify({key:o})}).then(e=>e.json()).then(t=>{t.success?(e.checked=t.new_value,i&&(i.textContent=t.new_value?"Enabled":"Disabled"),a&&(t.new_value?(a.classList.remove("ti-toggle-left","c-setting-row__status-icon--disabled"),a.classList.add("ti-toggle-right","c-setting-row__status-icon--enabled")):(a.classList.remove("ti-toggle-right","c-setting-row__status-icon--enabled"),a.classList.add("ti-toggle-left","c-setting-row__status-icon--disabled"))),n("success","Setting Updated",t.message)):(e.checked=!s,i&&(i.textContent=s?"Disabled":"Enabled"),n("error","Error",t.message||"Failed to update setting"))}).catch(t=>{console.error("Error:",t),e.checked=!s,i&&(i.textContent=s?"Disabled":"Enabled"),n("error","Network Error","Failed to communicate with server")}).finally(()=>{e.disabled=!1})}(o,o.dataset.settingKey,o.checked)}),document.addEventListener("submit",function(e){const t=e.target.closest("[data-setting-form]");if(!t)return;const n=t.querySelector(".c-setting-form__submit");n&&(n.innerHTML,n.disabled=!0,n.innerHTML='<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div>')})})}(),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("title"),t=document.getElementById("content");if(!e||!t)return;const n=document.getElementById("priority"),o=document.getElementById("announcement_type"),s=document.getElementById("preview-title"),i=document.getElementById("preview-body"),a=document.getElementById("preview-priority"),r=document.getElementById("preview-type");if(!s||!i)return;function c(){switch(s.textContent=e.value||"Announcement Title",i.textContent=t.value||"Announcement content will appear here...",a.textContent=n.value.charAt(0).toUpperCase()+n.value.slice(1),r.textContent=o.value.charAt(0).toUpperCase()+o.value.slice(1),a.className="badge ",n.value){case"high":a.className+="bg-danger";break;case"medium":a.className+="bg-warning";break;case"low":a.className+="bg-secondary";break;default:a.className+="bg-info"}}e.addEventListener("input",c),t.addEventListener("input",c),n.addEventListener("change",c),o.addEventListener("change",c);const l=2e3,d=document.createElement("div");d.className="form-text",d.innerHTML=`<small>Characters: <span id="char-count">${t.value.length}</span>/2000</small>`,t.parentNode.appendChild(d),t.addEventListener("input",function(){document.getElementById("char-count").textContent=this.value.length,this.value.length>1800?d.className="form-text text-warning":this.value.length>l?d.className="form-text text-danger":d.className="form-text"}),document.querySelectorAll('[data-action="delete-announcement"]').forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.id;if(confirm("Are you sure you want to delete this announcement? This action cannot be undone.")){const n=document.createElement("form");n.method="POST",n.action=e.getAttribute("data-url")||`/admin-panel/communication/announcements/${t}/delete`;const o=document.createElement("input");o.type="hidden",o.name="csrf_token",o.value=document.querySelector('input[name="csrf_token"]').value,n.appendChild(o),document.body.appendChild(n),n.submit()}})})}),function(){const e=document.createElement("style");e.textContent="\n        .spin {\n            animation: spin 1s linear infinite;\n        }\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n    ",document.head.appendChild(e)}(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Et):Et(),function(e){const t={selectedPlayer:null,selectedTeam:null,isMobile:function(){return e.innerWidth<768},setupTapToSelect:function(){this.isMobile()&&document.querySelectorAll('[data-component="player-card"], [data-component="player-item"]').forEach(t=>{if(t.removeAttribute("draggable"),t.classList.add("cursor-pointer"),t.addEventListener("click",n=>{if(n.target.closest("button, a"))return;const o=t.dataset.playerId||t.id;t.classList.contains("mobile-selected")?(t.classList.remove("mobile-selected"),this.selectedPlayer=null,e.Haptics&&e.Haptics.deselection()):(document.querySelectorAll(".mobile-selected").forEach(e=>{e.classList.remove("mobile-selected")}),t.classList.add("mobile-selected"),this.selectedPlayer=o,e.Haptics&&e.Haptics.selection(),this.showQuickDraftPanel(t))}),e.Hammer){const n=new Hammer(t);n.get("press").set({time:500}),n.on("press",()=>{e.Haptics&&e.Haptics.longPress();const n=t.querySelector('[data-action="view-profile"]');if(n)n.click();else{const n=t.dataset.playerId;n&&e.showPlayerInfo&&e.showPlayerInfo(n)}})}})},showQuickDraftPanel:function(t){var n,o;const s=document.querySelector(".mobile-quick-draft-panel");s&&s.remove();const i=document.createElement("div");i.className="mobile-quick-draft-panel position-fixed bottom-0 start-0 end-0 bg-body border-top border-primary border-2 p-3 translate-y-full transition-transform z-index-1060";const a=(null==(n=t.querySelector('[data-component="player-name"], .fw-semibold, h6'))?void 0:n.textContent)||"Player",r=t.dataset.playerId;i.innerHTML=`\n        <div class="d-flex align-items-center justify-content-between mb-3">\n          <div class="d-flex align-items-center gap-2">\n            <img src="${(null==(o=t.querySelector("img"))?void 0:o.src)||""}"\n                 class="rounded-circle"\n                 width="40" height="40"\n                 onerror="this.src='/static/assets/img/default-avatar.png'">\n            <div>\n              <div class="fw-bold">${a}</div>\n              <div class="small text-muted">Select team to draft</div>\n            </div>\n          </div>\n          <button class="btn btn-sm btn-light" onclick="this.closest('.mobile-quick-draft-panel').remove()">\n            <i class="ti ti-x"></i>\n          </button>\n        </div>\n        <div class="d-grid gap-2">\n          <button class="btn btn-success btn-lg" onclick="MobileDraft.quickDraft('${r}', 'default')">\n            <i class="ti ti-check"></i> Quick Draft\n          </button>\n          <button class="btn btn-outline-primary" onclick="MobileDraft.showTeamSelector('${r}')">\n            <i class="ti ti-users"></i> Select Team\n          </button>\n        </div>\n      `,document.body.appendChild(i),setTimeout(()=>{i.classList.remove("translate-y-full")},10),e.Haptics&&e.Haptics.light()},quickDraft:function(t,n){const o=document.querySelector(`[data-player-id="${t}"] [data-action="draft-player"]`);if(o){o.click(),e.Haptics&&e.Haptics.drafted();const t=document.querySelector(".mobile-quick-draft-panel");t&&t.remove()}},showTeamSelector:function(e){const t=document.querySelector(`[data-player-id="${e}"] [data-bs-toggle="modal"]`);t&&t.click();const n=document.querySelector(".mobile-quick-draft-panel");n&&n.remove()},optimizePitchView:function(){if(!this.isMobile())return;const t=document.querySelector(".pitch-container, .pitch-view, #pitch");if(t&&(t.classList.add("overflow-x-auto","webkit-overflow-scrolling-touch"),t.querySelectorAll(".position-player, .player-marker").forEach(e=>{e.classList.add("mobile-touch-target","fs-6")}),t.querySelectorAll(".position-zone, .zone").forEach(e=>{e.classList.add("mobile-zone-enhanced","fs-7")}),e.Hammer)){const e=new Hammer(t);e.get("pinch").set({enable:!0});let n=1;e.on("pinchstart",()=>{t.classList.remove("transition-transform")}),e.on("pinchmove",e=>{const o=Math.max(1,Math.min(n*e.scale,3));t.style.transform=`scale(${o})`,t.style.transformOrigin="center center"}),e.on("pinchend",e=>{t.classList.add("transition-transform"),n=Math.max(1,Math.min(n*e.scale,3)),n>1.2&&setTimeout(()=>{t.style.transform="scale(1)",n=1},5e3)})}},setupTeamSwipe:function(){if(!this.isMobile()||!e.Hammer)return;const t=document.querySelector(".teams-container, .accordion");if(!t)return;const n=new Hammer(t);n.get("swipe").set({direction:Hammer.DIRECTION_HORIZONTAL});const o=Array.from(t.querySelectorAll(".accordion-item, .team-card"));n.on("swipeleft",()=>{const t=o.findIndex(e=>e.querySelector(".accordion-collapse.show")||e.classList.contains("active"));if(t<o.length-1){const n=o[t+1].querySelector(".accordion-button, .team-toggle");n&&n.click(),e.Haptics&&e.Haptics.swipe()}}),n.on("swiperight",()=>{const t=o.findIndex(e=>e.querySelector(".accordion-collapse.show")||e.classList.contains("active"));if(t>0){const n=o[t-1].querySelector(".accordion-button, .team-toggle");n&&n.click(),e.Haptics&&e.Haptics.swipe()}})},optimizeRemoveButtons:function(){this.isMobile()&&document.querySelectorAll('[data-action="remove-player"]').forEach(t=>{t.classList.add("mobile-touch-target","p-3"),t.addEventListener("click",()=>{e.Haptics&&e.Haptics.delete()});const n=t.onclick;t.onclick=o=>this.isMobile()?(e.Swal?Swal.fire({title:"Remove Player?",text:"Are you sure you want to remove this player from the team?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, remove",cancelButtonText:"Cancel",confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545"}).then(s=>{s.isConfirmed&&(n&&n.call(t,o),e.Haptics&&e.Haptics.delete())}):confirm("Remove this player?")&&(n&&n.call(t,o),e.Haptics&&e.Haptics.delete()),!1):n?n.call(t,o):void 0})},optimizeFilters:function(){if(!this.isMobile())return;const e=document.querySelector('[data-component="player-search"], input#playerSearch');e&&e.classList.add("mobile-input-no-zoom","mobile-touch-target"),document.querySelectorAll('[data-component="filter-select"], select[data-filter]').forEach(e=>{e.classList.add("mobile-input-no-zoom","mobile-touch-target")});const t=document.querySelector('[data-component="draft-controls"], [data-component="filters"]');t&&t.classList.add("sticky-filter-mobile","bg-body","pb-3","mb-3","border-bottom")},addMobileDraftStyles:function(){if(document.getElementById("mobile-draft-styles"))return;const e=document.createElement("style");e.id="mobile-draft-styles",e.textContent='\n        /* Mobile draft optimizations */\n        @media (max-width: 767.98px) {\n          /* Utility classes for mobile interactions */\n          .cursor-pointer { cursor: pointer; }\n          .translate-y-full { transform: translateY(100%); }\n          .transition-transform { transition: transform 0.3s ease; }\n          .overflow-x-auto { overflow-x: auto; }\n\n          .mobile-touch-target {\n            min-width: 44px;\n            min-height: 44px;\n          }\n\n          .mobile-zone-enhanced {\n            min-height: 60px;\n          }\n\n          .mobile-input-no-zoom {\n            font-size: 16px; /* Prevent iOS zoom on focus */\n          }\n\n          /* Selected player indicator */\n          .mobile-selected {\n            border: 3px solid var(--bs-primary) !important;\n            box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.2) !important;\n            transform: scale(1.02);\n          }\n\n          /* Player cards */\n          [data-component="player-card"],\n          [data-component="player-item"] {\n            min-height: 80px;\n            margin-bottom: 12px;\n          }\n\n          [data-component="player-card"] img,\n          [data-component="player-item"] img {\n            width: 60px;\n            height: 60px;\n          }\n\n          /* Draft buttons */\n          [data-action="draft-player"],\n          button[data-action*="draft"] {\n            min-height: 48px;\n            font-size: 16px;\n            padding: 12px 20px;\n          }\n\n          /* Team accordion */\n          .accordion-button {\n            min-height: 56px;\n            font-size: 16px;\n            padding: 16px;\n          }\n\n          /* Position zones on pitch */\n          .position-zone,\n          .zone {\n            min-height: 60px;\n            padding: 8px;\n          }\n\n          /* Player markers on pitch */\n          .position-player,\n          .player-marker {\n            min-width: 44px;\n            min-height: 44px;\n            font-size: 14px;\n          }\n\n          /* Quick draft panel animation */\n          .mobile-quick-draft-panel {\n            animation: slideUp 0.3s ease;\n            box-shadow: 0 -4px 12px rgba(0,0,0,0.2);\n          }\n\n          @keyframes slideUp {\n            from { transform: translateY(100%); }\n            to { transform: translateY(0); }\n          }\n\n          /* Remove buttons */\n          [data-action="remove-player"],\n          button[data-action*="remove"] {\n            min-width: 44px !important;\n            min-height: 44px !important;\n          }\n\n          /* Filter controls */\n          [data-component="filters"],\n          [data-component="draft-controls"] {\n            flex-wrap: wrap;\n            gap: 8px;\n          }\n\n          [data-component="filters"] > *,\n          [data-component="draft-controls"] > * {\n            flex: 1 1 100%;\n          }\n\n          /* Hide drag handles on mobile */\n          [data-component="drag-handle"],\n          [draggable="true"]::before {\n            display: none;\n          }\n\n          /* Stack pitch and teams vertically */\n          .draft-layout {\n            flex-direction: column;\n          }\n\n          /* Full-width teams on mobile */\n          .teams-section {\n            width: 100%;\n            max-width: 100%;\n          }\n        }\n\n        /* Pitch container scroll hint */\n        .pitch-container::after {\n          content: \'Swipe to view full pitch\';\n          position: absolute;\n          bottom: 8px;\n          right: 8px;\n          background: rgba(0,0,0,0.7);\n          color: white;\n          padding: 4px 8px;\n          border-radius: 4px;\n          font-size: 12px;\n          pointer-events: none;\n          opacity: 0;\n          transition: opacity 0.3s;\n        }\n\n        .pitch-container:hover::after {\n          opacity: 1;\n        }\n      ',document.head.appendChild(e)},init:function(){this.isMobile()?(this.addMobileDraftStyles(),this.setupTapToSelect(),this.optimizePitchView(),this.setupTeamSwipe(),this.optimizeRemoveButtons(),this.optimizeFilters(),new MutationObserver(e=>{let t=!1;e.forEach(e=>{e.addedNodes.forEach(e=>{var n,o,s;1!==e.nodeType||"player-card"!==(null==(n=e.getAttribute)?void 0:n.call(e,"data-component"))&&"player-item"!==(null==(o=e.getAttribute)?void 0:o.call(e,"data-component"))&&!(null==(s=e.querySelector)?void 0:s.call(e,'[data-component="player-card"], [data-component="player-item"]'))||(t=!0)})}),t&&setTimeout(()=>{this.setupTapToSelect(),this.optimizeRemoveButtons()},100)}).observe(document.body,{childList:!0,subtree:!0}),console.log("MobileDraft: Initialized successfully")):console.log("MobileDraft: Not mobile, skipping initialization")}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{document.querySelector('[data-component="player-card"], [data-component="draft-container"]')&&t.init()}):document.querySelector('[data-component="player-card"], [data-component="draft-container"]')&&t.init(),e.MobileDraft=t}(window),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-table]:not([data-mobile-view])").forEach(function(e){const t=[];e.querySelectorAll("thead th").forEach(function(e){t.push(e.textContent.trim())}),e.querySelectorAll("tbody tr").forEach(function(e){e.querySelectorAll("td").forEach(function(e,n){n<t.length&&!e.hasAttribute("data-title")&&e.setAttribute("data-title",t[n])})})}),document.querySelectorAll("[data-dropdown-toggle]").forEach(function(e){e.addEventListener("click",function(e){if(window.innerWidth<992){const e=this.nextElementSibling;e&&e.hasAttribute("data-dropdown-menu")&&(e.classList.add("dropdown-measuring"),setTimeout(()=>{e.offsetHeight;const t=window.innerHeight,n=this.getBoundingClientRect();if(n.top+n.height/2<t/2){e.classList.add("dropdown-position-below","dropdown-constrained-below"),e.classList.remove("dropdown-position-above","dropdown-constrained-above");const o=t-n.bottom-10;e.style.setProperty("--dropdown-top-offset",t-o+"px")}else e.classList.add("dropdown-position-above","dropdown-constrained-above"),e.classList.remove("dropdown-position-below","dropdown-constrained-below");e.classList.remove("dropdown-measuring")},10))}})});const e=new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&"class"===e.attributeName&&e.target.hasAttribute("data-dropdown-menu")&&e.target.classList.contains("show")&&document.querySelectorAll("[data-dropdown-menu].show").forEach(function(e){const t=e.getBoundingClientRect();t.right>window.innerWidth&&(e.classList.add("dropdown-align-right"),e.classList.remove("dropdown-align-left")),t.bottom>window.innerHeight&&(e.classList.add("dropdown-position-above"),e.classList.remove("dropdown-position-below"))})})});document.querySelectorAll("[data-dropdown-menu]").forEach(function(t){e.observe(t,{attributes:!0})});const t=document.querySelectorAll("[data-pagination]");window.innerWidth<768&&t.length>0&&t.forEach(function(e){const t=e.querySelectorAll("[data-page-item]:not([data-page-disabled]):not([data-page-active])");if(t.length>7){const n=e.querySelector("[data-page-item][data-page-active]");if(n){const o=parseInt(n.textContent.trim(),10)||1,s=Array.from(e.querySelectorAll("[data-page-item]")),i=s.find(e=>!e.hasAttribute("data-page-disabled")&&"Â«"!==e.textContent.trim()),a=[...s].reverse().find(e=>!e.hasAttribute("data-page-disabled")&&"Â»"!==e.textContent.trim());if(t.forEach(e=>{e!==i&&e!==a&&e.classList.add("d-none")}),s.forEach(e=>{const t=parseInt(e.textContent.trim(),10)||0;isNaN(t)||t!==o&&t!==o-1&&t!==o+1&&1!==t&&t!==parseInt(a.textContent.trim(),10)||e.classList.remove("d-none")}),o>3){const e=document.createElement("li");e.className="page-item disabled",e.innerHTML='<span class="page-link">â¦</span>',i.after(e)}if(o<parseInt(a.textContent.trim(),10)-2){const e=document.createElement("li");e.className="page-item disabled",e.innerHTML='<span class="page-link">â¦</span>';const t=s.findIndex(e=>e===n);-1!==t&&t<s.length-1&&s[t+1].after(e)}}}})}),function(){function e(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function t(e,t,n="info"){let o=document.querySelector('[data-role="toast-container"]');o||(o=document.createElement("div"),o.className="toast-container position-fixed top-0 end-0 p-3",o.setAttribute("data-role","toast-container"),document.body.appendChild(o));const s=document.createElement("div");s.className="toast align-items-center text-white border-0",s.setAttribute("role","alert"),s.setAttribute("aria-live","assertive"),s.setAttribute("aria-atomic","true"),s.setAttribute("data-toast-type",n),s.classList.add({success:"bg-success",danger:"bg-danger",warning:"bg-warning",info:"bg-info",primary:"bg-primary",secondary:"bg-secondary"}[n]||"bg-info"),s.innerHTML=`\n            <div class="d-flex">\n                <div class="toast-body">\n                    <strong>${e}:</strong> ${t}\n                </div>\n                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n            </div>\n        `,o.appendChild(s),new bootstrap.Toast(s).show(),s.addEventListener("hidden.bs.toast",function(){s.remove()})}document.addEventListener("DOMContentLoaded",function(){console.log("Message Management JS loaded"),[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)})}),window.previewTemplate=function(t){ModalManager.show("previewModal");const n=document.getElementById("previewContent");n.innerHTML='\n            <div class="text-center">\n                <div class="spinner-border text-primary" role="status">\n                    <span class="visually-hidden">Loading...</span>\n                </div>\n                <p class="mt-2">Loading preview...</p>\n            </div>\n        ',fetch(`/admin/messages/api/preview/${t}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({})}).then(e=>e.json()).then(t=>{t.preview?n.innerHTML=`\n                    <div class="mb-4" data-role="preview-section">\n                        <h6 class="text-muted mb-3">Discord Message Preview:</h6>\n                        <div class="discord-preview p-4 rounded" data-role="discord-preview">\n                            <div style="white-space: pre-wrap; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">${e(t.preview)}</div>\n                        </div>\n                    </div>\n                    ${t.variables_used?`\n                    <div class="mt-4" data-role="variables-section">\n                        <h6 class="text-muted mb-2">Sample Variables Used:</h6>\n                        <div class="bg-light p-3 rounded" data-role="variables-display">\n                            <pre class="mb-0 small">${JSON.stringify(t.variables_used,null,2)}</pre>\n                        </div>\n                    </div>\n                    `:""}\n                `:n.innerHTML='\n                    <div class="alert alert-danger">\n                        <i class="ti ti-alert-circle me-2"></i>\n                        Failed to load preview\n                    </div>\n                '}).catch(e=>{n.innerHTML=`\n                <div class="alert alert-danger">\n                    <i class="ti ti-alert-circle me-2"></i>\n                    Error loading preview: ${e.message}\n                </div>\n            `})},window.copyTemplate=function(e){fetch(`/admin/messages/api/template/${e}`).then(e=>e.json()).then(e=>{e.message_content&&navigator.clipboard.writeText(e.message_content).then(function(){t("Success","Message content copied to clipboard!","success")}).catch(function(e){t("Error","Failed to copy to clipboard","danger")})}).catch(e=>{t("Error","Error copying template: "+e.message,"danger")})},window.previewMessage=function(){const n=document.getElementById("message_content").value;if(!n.trim())return void t("Warning","Please enter message content to preview.","warning");ModalManager.show("previewModal");const o={username:"SampleUser",league_display_name:"Pub League Premier",league_welcome_message:"Welcome to competitive soccer!",league_contact_info:"Contact us at admin@ecsfc.com",team_name:"Sample Team FC",match_date:"Saturday, July 20th",match_time:"2:00 PM",match_location:"North Field"};let s=n;for(const[e,t]of Object.entries(o)){const n=new RegExp(`{${e}}`,"g");s=s.replace(n,t)}document.getElementById("previewContent").innerHTML=`\n            <div class="mb-4" data-role="preview-section">\n                <h6 class="text-muted mb-3">Discord Message Preview:</h6>\n                <div class="discord-preview p-4 rounded" data-role="discord-preview">\n                    <div style="white-space: pre-wrap; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">${e(s)}</div>\n                </div>\n            </div>\n            <div class="mt-4" data-role="variables-section">\n                <h6 class="text-muted mb-2">Sample variables used:</h6>\n                <div class="bg-light p-3 rounded" data-role="variables-display">\n                    <pre class="mb-0 small">${JSON.stringify(o,null,2)}</pre>\n                </div>\n            </div>\n        `}}(),function(){const e=window.MessagesInboxConfig||{},t=e.apiBase||"/api/messages",n=e.currentUserId,o=e.settings||{};let s=[],i=null,a=null,r=!1,c=null,l=null,d=null;const u=document.querySelector('[data-component="messages-inbox"]');if(!u)return void console.warn("[MessagesInbox] No messages-inbox component found. Skipping initialization.");console.log("[MessagesInbox] Initializing...");const m={inbox:u,conversationList:u.querySelector('[data-list="conversations"]'),loadingState:u.querySelector('[data-state="loading"]'),emptyState:u.querySelector('[data-state="empty"]'),sidebarFooter:u.querySelector('[data-footer="sidebar"]'),welcomeState:u.querySelector('[data-state="welcome"]'),chatView:u.querySelector('[data-view="chat"]'),chatAvatar:u.querySelector("[data-chat-avatar]"),chatStatus:u.querySelector("[data-chat-status]"),chatName:u.querySelector("[data-chat-name]"),chatOnlineText:u.querySelector("[data-chat-online-text]"),chatProfileLink:u.querySelector("[data-chat-profile-link]"),messagesContainer:u.querySelector("[data-messages]"),messagesLoading:u.querySelector('[data-state="messages-loading"]'),typingIndicator:u.querySelector("[data-typing-indicator]"),typingName:u.querySelector("[data-typing-name]"),messageInput:u.querySelector('[data-input="message"]'),charCount:u.querySelector("[data-char-count]"),sendButton:u.querySelector('[data-action="send-message"]'),searchInput:u.querySelector('[data-input="search-conversations"]')},h=document.getElementById("newConversationModal"),p=document.getElementById("userSearchInput"),f=document.querySelector('[data-list="user-results"]');function g(){y(),function(){document.querySelectorAll('[data-action="new-conversation"]').forEach(e=>{e.addEventListener("click",function(e){h?"undefined"!=typeof ModalManager?ModalManager.show("newConversationModal"):"undefined"!=typeof bootstrap&&bootstrap.Modal?new bootstrap.Modal(h).show():console.error("[MessagesInbox] Neither ModalManager nor Bootstrap available"):console.error("[MessagesInbox] Modal element not found")})});const e=u.querySelector('[data-action="mark-all-read"]');e&&e.addEventListener("click",M);const t=u.querySelector('[data-action="back-to-list"]');t&&t.addEventListener("click",C),m.messageInput&&(m.messageInput.addEventListener("input",x),m.messageInput.addEventListener("keydown",L)),m.sendButton&&m.sendButton.addEventListener("click",k),m.searchInput&&m.searchInput.addEventListener("input",B),p&&p.addEventListener("input",q),h&&h.addEventListener("hidden.bs.modal",()=>{p&&(p.value=""),f&&(f.innerHTML='\n            <div class="c-user-search-results__hint">\n              <i class="ti ti-info-circle me-1" aria-hidden="true"></i>\n              Type at least 2 characters to search\n            </div>\n          ')})}(),function(){if("undefined"!=typeof io)window.socket?(console.log("[MessagesInbox] Reusing existing socket (connected:",window.socket.connected,")"),c=window.socket,v()):(console.log("[MessagesInbox] Creating new socket connection"),c=io({transports:["polling","websocket"],upgrade:!0,withCredentials:!0}),window.socket=c,v())}(),e.initialUser&&S(e.initialUser)}function v(){c&&(c.on("connect",()=>{console.log("[MessagesInbox] WebSocket connected")}),c.on("new_message",I),c.on("typing_start",A),c.on("typing_stop",$),c.on("message_read",D))}async function y(){try{b(!0);const e=await fetch(`${t}?limit=50`),n=await e.json();n.success&&(s=n.conversations||[],w())}catch(e){console.error("[MessagesInbox] Error loading conversations:",e)}finally{b(!1)}}function b(e){m.loadingState&&m.loadingState.classList.toggle("u-hidden",!e)}function w(e=null){const t=e||s;m.emptyState&&m.emptyState.classList.toggle("u-hidden",t.length>0),m.sidebarFooter&&m.sidebarFooter.classList.toggle("u-hidden",0===t.length),m.conversationList.querySelectorAll(".c-messages-conversation").forEach(e=>e.remove()),t.forEach(e=>{const t=function(e){const t=document.createElement("div");t.className="c-messages-conversation",t.dataset.userId=e.user.id,e.user.id===i&&t.classList.add("is-active");const n=e.user.avatar_url||"/static/img/default-avatar.png",o=e.user.is_online?"is-online":"is-offline",s=e.last_message.sent_by_me?"is-sent":"",a=R(e.user);return t.innerHTML=`\n      <div class="c-messages-conversation__avatar-wrapper">\n        <img src="${n}" alt="${e.user.name}" class="c-messages-conversation__avatar">\n        <span class="c-online-status c-online-status--sm ${o}"></span>\n      </div>\n      <div class="c-messages-conversation__info">\n        <p class="c-messages-conversation__name">${N(e.user.name)}${a}</p>\n        <p class="c-messages-conversation__preview ${s}">${N(e.last_message.content)}</p>\n      </div>\n      <div class="c-messages-conversation__meta">\n        <span class="c-messages-conversation__time">${e.last_message.time_ago}</span>\n        ${e.unread_count>0?`<span class="c-messages-conversation__unread">${e.unread_count}</span>`:""}\n      </div>\n    `,t.addEventListener("click",()=>S(e.user)),t}(e);m.conversationList.appendChild(t)})}async function S(e){if(i=e.id,a=e,document.querySelectorAll(".c-messages-conversation").forEach(t=>{t.classList.toggle("is-active",parseInt(t.dataset.userId)===e.id)}),_(e),E(!0),await async function(e){if(!r){r=!0;try{m.messagesLoading&&m.messagesLoading.classList.remove("u-hidden"),m.messagesContainer&&m.messagesContainer.querySelectorAll(".c-messages-message, .c-messages-date-separator").forEach(e=>e.remove());const n=await fetch(`${t}/${e}?limit=100`),o=await n.json();o.success&&(function(e){let t=null;e.forEach(e=>{const n=new Date(e.created_at).toDateString();if(n!==t){const o=function(e){const t=document.createElement("div");t.className="c-messages-date-separator";const n=new Date(e),o=new Date,s=new Date(o);let i;return s.setDate(s.getDate()-1),i=n.toDateString()===o.toDateString()?"Today":n.toDateString()===s.toDateString()?"Yesterday":n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),t.innerHTML=`<span class="c-messages-date-separator__text">${i}</span>`,t}(e.created_at);m.messagesContainer.appendChild(o),t=n}const o=T(e);m.messagesContainer.appendChild(o)}),O()}(o.messages||[]),o.user&&a&&(a.is_online=o.user.is_online,_(a)),function(e){const t=document.querySelector(`.c-messages-conversation[data-user-id="${e}"]`);if(t){let e=t.querySelector(".c-messages-conversation__unread");e&&e.remove()}}(e))}catch(n){console.error("[MessagesInbox] Error loading messages:",n)}finally{r=!1,m.messagesLoading&&m.messagesLoading.classList.add("u-hidden")}}}(e.id),h)if("undefined"!=typeof ModalManager)ModalManager.hide("newConversationModal");else{const e=bootstrap.Modal.getInstance(h);e&&e.hide()}m.messageInput&&m.messageInput.focus()}function _(e){const t=e.avatar_url||"/static/img/default-avatar.png",n=R(e);m.chatAvatar&&(m.chatAvatar.src=t,m.chatAvatar.alt=e.name),m.chatStatus&&(m.chatStatus.className="c-online-status c-online-status--sm "+(e.is_online?"is-online":"is-offline")),m.chatName&&(m.chatName.innerHTML=N(e.name)+n,m.chatName.href=e.profile_url||"#"),m.chatOnlineText&&(m.chatOnlineText.textContent=e.is_online?"Online":"Offline",m.chatOnlineText.className="c-messages-chat__user-status "+(e.is_online?"is-online":"")),m.chatProfileLink&&(m.chatProfileLink.href=e.profile_url||"#",m.chatProfileLink.style.display=e.profile_url?"":"none")}function E(e){m.welcomeState&&m.welcomeState.classList.toggle("u-hidden",e),m.chatView&&m.chatView.classList.toggle("u-hidden",!e),u.classList.toggle("is-chatting",e)}function C(){i=null,a=null,E(!1),document.querySelectorAll(".c-messages-conversation").forEach(e=>{e.classList.remove("is-active")})}function T(e){const t=document.createElement("div"),s=e.sender_id===n;t.className="c-messages-message "+(s?"c-messages-message--sent":"c-messages-message--received"),t.dataset.messageId=e.id;const i=(a=e.created_at,new Date(a).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}));var a;const r=s&&e.is_read&&o.read_receipts?'<i class="ti ti-checks c-messages-message__read" aria-label="Read"></i>':"";return t.innerHTML=`\n      <div class="c-messages-message__bubble">${N(e.content)}</div>\n      <div class="c-messages-message__time">${i}${r}</div>\n    `,t}function x(){const e=m.messageInput.value.length,t=o.max_message_length||2e3;m.charCount&&(m.charCount.textContent=`${e}/${t}`,m.charCount.classList.toggle("is-warning",e>.8*t),m.charCount.classList.toggle("is-limit",e>=t)),m.sendButton&&(m.sendButton.disabled=0===e||e>t),m.messageInput.style.height="auto",m.messageInput.style.height=Math.min(m.messageInput.scrollHeight,120)+"px",o.typing_indicators&&i&&c&&(clearTimeout(l),c.emit("typing_start",{recipient_id:i}),l=setTimeout(()=>{c.emit("typing_stop",{recipient_id:i})},2e3))}function L(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())}async function k(){const e=m.messageInput.value.trim();if(!e||!i)return;const n=o.max_message_length||2e3;if(!(e.length>n)){m.sendButton&&(m.sendButton.disabled=!0);try{const o=await fetch(`${t}/${i}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":F()},body:JSON.stringify({content:e})}),s=await o.json();if(s.success&&s.message){m.messageInput.value="",m.messageInput.style.height="auto",m.charCount&&(m.charCount.textContent=`0/${n}`,m.charCount.classList.remove("is-warning","is-limit"));const t=T(s.message);m.messagesContainer.appendChild(t),O(),P(i,e,!0),c&&c.emit("typing_stop",{recipient_id:i})}else H(s.error||"Failed to send message")}catch(s){console.error("[MessagesInbox] Error sending message:",s),H("Failed to send message")}x()}}function I(e){if(e.sender_id===i){const n=T(e);m.messagesContainer.appendChild(n),O(),async function(e){try{await fetch(`${t}/${e}/read`,{method:"POST",headers:{"X-CSRFToken":F()}})}catch(n){console.error("[MessagesInbox] Error marking message read:",n)}}(e.id)}e.sender_id!==n&&(P(e.sender_id,e.content,!1),e.sender_id!==i&&function(e){const t=document.querySelector(`.c-messages-conversation[data-user-id="${e}"]`);if(t){let e=t.querySelector(".c-messages-conversation__unread");e?e.textContent=parseInt(e.textContent)+1:(e=document.createElement("span"),e.className="c-messages-conversation__unread",e.textContent="1",t.querySelector(".c-messages-conversation__meta").appendChild(e))}}(e.sender_id)),y()}function A(e){e.user_id===i&&m.typingIndicator&&(m.typingIndicator.classList.remove("u-hidden"),m.typingName&&(m.typingName.textContent=(null==a?void 0:a.name)+" is typing"),O())}function $(e){e.user_id===i&&m.typingIndicator&&m.typingIndicator.classList.add("u-hidden")}function D(e){e.reader_id===i&&document.querySelectorAll(".c-messages-message--sent").forEach(e=>{const t=e.querySelector(".c-messages-message__time");t&&!t.querySelector(".c-messages-message__read")&&(t.innerHTML+='<i class="ti ti-checks c-messages-message__read" aria-label="Read"></i>')})}async function M(){try{const e=await fetch(`${t}/mark-all-read`,{method:"POST",headers:{"X-CSRFToken":F()}});(await e.json()).success&&(document.querySelectorAll(".c-messages-conversation__unread").forEach(e=>e.remove()),function(e){const t=document.querySelector('[data-badge="messages-count"]');t&&(t.textContent=e,t.classList.toggle("u-hidden",0===e))}(0))}catch(e){console.error("[MessagesInbox] Error marking all read:",e)}}function P(e,t,n){const o=document.querySelector(`.c-messages-conversation[data-user-id="${e}"]`);if(o){const e=o.querySelector(".c-messages-conversation__preview");e&&(e.textContent=t.length>50?t.substring(0,50)+"...":t,e.classList.toggle("is-sent",n));const s=o.querySelector(".c-messages-conversation__time");s&&(s.textContent="Just now")}}function B(){const e=m.searchInput.value.toLowerCase().trim();e?w(s.filter(t=>t.user.name.toLowerCase().includes(e)||t.last_message.content.toLowerCase().includes(e))):w()}function q(){const e=p.value.trim();clearTimeout(d),e.length<2?f.innerHTML='\n        <div class="c-user-search-results__hint">\n          <i class="ti ti-info-circle me-1" aria-hidden="true"></i>\n          Type at least 2 characters to search\n        </div>\n      ':(f.innerHTML='\n      <div class="c-user-search-results__loading">\n        <div class="c-messages-list__spinner"></div>\n      </div>\n    ',d=setTimeout(async()=>{try{const n=await fetch(`${t}/users/search?q=${encodeURIComponent(e)}&limit=10`),o=await n.json();o.success&&o.users.length>0?(f.innerHTML="",o.users.forEach(e=>{const t=document.createElement("div");t.className="c-user-search-results__item";const n=R(e);t.innerHTML=`\n              <img src="${e.avatar_url||"/static/img/default-avatar.png"}" alt="${e.name}" class="c-user-search-results__avatar">\n              <span class="c-user-search-results__name">${N(e.name)}${n}</span>\n            `,t.addEventListener("click",()=>S(e)),f.appendChild(t)})):f.innerHTML='\n            <div class="c-user-search-results__empty">\n              <i class="ti ti-user-off" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;" aria-hidden="true"></i>\n              <p>No users found</p>\n            </div>\n          '}catch(n){console.error("[MessagesInbox] Error searching users:",n),f.innerHTML='\n          <div class="c-user-search-results__empty">\n            <p>Search failed. Please try again.</p>\n          </div>\n        '}},300))}function O(){m.messagesContainer&&(m.messagesContainer.scrollTop=m.messagesContainer.scrollHeight)}function N(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function R(e){if(!e)return"";const t=[];return e.is_global_admin?t.push('<span class="c-role-badge c-role-badge--admin" title="Global Admin"><i class="ti ti-crown"></i></span>'):e.is_admin&&t.push('<span class="c-role-badge c-role-badge--admin" title="Admin"><i class="ti ti-shield-check"></i></span>'),e.is_coach&&t.push('<span class="c-role-badge c-role-badge--coach" title="Coach"><i class="ti ti-speakerphone"></i></span>'),e.is_ref&&t.push('<span class="c-role-badge c-role-badge--ref" title="Referee"><i class="ti ti-cards"></i></span>'),t.length>0?`<span class="c-role-badges">${t.join("")}</span>`:""}function F(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):""}function H(e){"function"==typeof window.showToast?window.showToast(e,"error"):console.error("[MessagesInbox]",e)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g()}();const Ct={passTypeCode:"",hasUnsavedChanges:!1,previewData:null,currentPlatform:"apple",assets:{},init(e){this.passTypeCode=e,this.loadPreviewData(),this.loadAssets(),this.bindEvents(),this.initColorPickers()},bindEvents(){document.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("change",()=>this.markUnsaved())}),window.addEventListener("beforeunload",e=>{this.hasUnsavedChanges&&(e.preventDefault(),e.returnValue="")})},markUnsaved(){this.hasUnsavedChanges=!0,document.body.classList.add("has-unsaved-changes")},markSaved(){this.hasUnsavedChanges=!1,document.body.classList.remove("has-unsaved-changes")},async loadPreviewData(){try{const e=await fetch(`/admin/wallet/studio/${this.passTypeCode}/preview`),t=await e.json();t.success&&(this.previewData=t,this.updatePreview())}catch(e){console.error("Error loading preview data:",e)}},async loadAssets(){try{const e=await fetch(`/admin/wallet/studio/${this.passTypeCode}/assets`),t=await e.json();t.success&&(this.assets=t.assets||{},this.updateAssetPreviews())}catch(e){console.error("Error loading assets:",e)}},updateAssetPreviews(){Object.entries(this.assets).forEach(([e,t])=>{const n=document.querySelector(`.asset-upload-card[data-asset-type="${e}"]`);if(n&&t&&t.url){const o=n.querySelector(".asset-preview");o&&(o.innerHTML=`\n                        <img src="${t.url}" alt="${e}" id="asset-preview-${e}">\n                        <span class="badge bg-success position-absolute top-0 end-0 m-1"><i class="ti ti-check"></i></span>\n                    `)}}),this.updateLivePreviewAssets()},updateLivePreviewAssets(){var e;const t=document.getElementById("preview-logo"),n=document.getElementById("preview-strip");if(t&&(this.assets.logo&&this.assets.logo.url?(t.classList.remove("d-none"),t.classList.add("d-flex"),t.innerHTML=`<img src="${this.assets.logo.url}" alt="Logo">`):(t.classList.add("d-none"),t.classList.remove("d-flex"),t.innerHTML="")),n){let e=n.querySelector(".pass-strip-image");const t=n.querySelector(".pass-primary-field-overlay");this.assets.strip&&this.assets.strip.url?(e||(e=document.createElement("img"),e.className="pass-strip-image",e.alt="Strip",t?n.insertBefore(e,t):n.appendChild(e)),e.src=this.assets.strip.url):e&&e.remove()}const o=document.getElementById("preview-google-logo");if(o){const t=null==(e=document.getElementById("google_logo_url"))?void 0:e.value;t?o.innerHTML=`<img src="${t}" alt="Logo">`:this.assets.logo&&this.assets.logo.url&&(o.innerHTML=`<img src="${this.assets.logo.url}" alt="Logo">`)}},setPreviewPlatform(e){this.currentPlatform=e,document.querySelectorAll("[data-platform]").forEach(t=>{t.classList.toggle("active",t.dataset.platform===e)});const t=document.getElementById("apple-preview"),n=document.getElementById("google-preview");t&&n&&("apple"===e?(t.classList.remove("d-none"),n.classList.add("d-none")):(t.classList.add("d-none"),n.classList.remove("d-none")))},updatePassStylePreview(){var e;const t=(null==(e=document.querySelector('input[name="apple_pass_style"]:checked'))?void 0:e.value)||"generic";document.querySelectorAll('[id^="style-desc-"]').forEach(e=>e.classList.add("d-none"));const n=document.getElementById(`style-desc-${t}`);n&&n.classList.remove("d-none");const o=document.getElementById("asset-strip-wrapper"),s=document.getElementById("asset-thumbnail-wrapper");"generic"===t?(o&&o.classList.add("d-none"),s&&s.classList.remove("d-none")):(o&&o.classList.remove("d-none"),s&&s.classList.add("d-none")),this.updatePreviewForPassStyle(t)},updatePreviewForPassStyle(e){const t=document.getElementById("pass-preview");if(!t)return;t.classList.remove("pass-style-generic","pass-style-storeCard","pass-style-eventTicket"),t.classList.add(`pass-style-${e}`),t.setAttribute("data-pass-style",e);const n=t.querySelector(".pass-strip-area"),o=t.querySelector(".pass-thumbnail"),s=t.querySelector(".pass-primary-fields-section"),i=t.querySelector(".pass-primary-field-overlay"),a=t.querySelector(".pass-notch");"generic"===e?(n&&n.classList.add("d-none"),o&&o.classList.remove("d-none"),s&&s.classList.remove("d-none"),i&&i.classList.add("d-none"),a&&a.classList.add("d-none")):"eventTicket"===e?(n&&(n.classList.remove("d-none"),n.classList.add("d-flex")),o&&o.classList.add("d-none"),s&&s.classList.add("d-none"),i&&i.classList.add("d-none"),a&&a.classList.remove("d-none")):(n&&(n.classList.remove("d-none"),n.classList.add("d-flex")),o&&o.classList.add("d-none"),s&&s.classList.add("d-none"),i&&i.classList.remove("d-none"),a&&a.classList.add("d-none"))},openAssetCropper(e){var t;if("undefined"!=typeof AssetCropper){const n=(null==(t=this.assets[e])?void 0:t.url)||null;AssetCropper.open(e,this.passTypeCode,n)}else console.error("AssetCropper not loaded"),this.showToast("Asset cropper not available","error")},onAssetUploaded(e,t){this.assets[e]=t,this.updateAssetPreviews(),this.updateLivePreviewAssets()},onAssetDeleted(e){delete this.assets[e];const t=document.querySelector(`[data-asset-type="${e}"]`);if(t){const e=t.querySelector(".asset-preview");e&&(e.innerHTML='\n                    <div class="asset-placeholder">\n                        <i class="ti ti-photo fs-1"></i>\n                    </div>\n                ');const n=t.querySelector(".badge.bg-success");n&&n.remove()}this.updateLivePreviewAssets()},updateGooglePreview(){var e,t;const n=null==(e=document.getElementById("google_hero_image_url"))?void 0:e.value,o=null==(t=document.getElementById("google_logo_url"))?void 0:t.value,s=document.getElementById("preview-google-hero"),i=document.getElementById("preview-google-logo");s&&(n?(s.style.backgroundImage=`url('${n}')`,s.innerHTML=""):(s.style.backgroundImage="",s.innerHTML='\n                    <div class="google-hero-placeholder">\n                        <i class="ti ti-photo-plus"></i>\n                        <span>Hero Image</span>\n                    </div>\n                ')),i&&(o?i.innerHTML=`<img src="${o}" alt="Logo">`:this.assets.logo&&this.assets.logo.url?i.innerHTML=`<img src="${this.assets.logo.url}" alt="Logo">`:i.innerHTML='\n                    <div class="google-logo-placeholder">\n                        <i class="ti ti-building"></i>\n                    </div>\n                ')},updatePreview(){const e=document.getElementById("pass-preview");if(e&&this.previewData){const t=this.previewData.pass_type;e.style.backgroundColor=t.background_color,e.style.color=t.foreground_color,e.querySelectorAll(".pass-field-label").forEach(e=>{e.style.color=t.label_color});const n=document.getElementById("preview-logo-text");n&&(n.textContent=t.logo_text)}const t=document.querySelector(".google-pass-content");if(t&&this.previewData){const e=this.previewData.pass_type;t.style.backgroundColor=e.background_color,t.style.color=e.foreground_color,t.querySelectorAll(".google-info-label, .google-card-subtitle").forEach(t=>{t.style.color=e.label_color})}this.updateLivePreviewAssets()},updatePreviewFields(e,t){var n,o,s;if(!e||!t)return;const i={header:e.filter(e=>"header"===e.field_location&&!1!==e.is_visible),primary:e.filter(e=>"primary"===e.field_location&&!1!==e.is_visible),secondary:e.filter(e=>"secondary"===e.field_location&&!1!==e.is_visible),auxiliary:e.filter(e=>"auxiliary"===e.field_location&&!1!==e.is_visible)},a=(null==(n=document.getElementById("label_color"))?void 0:n.value)||(null==(s=null==(o=this.previewData)?void 0:o.pass_type)?void 0:s.label_color)||("undefined"!=typeof ECSTheme?ECSTheme.getColor("neutral-50"):"#999999"),r=e=>{if(!e.value_template)return e.default_value||"";let n=e.value_template;for(const[o,s]of Object.entries(t))n=n.replace(new RegExp("\\{\\{"+o+"\\}\\}","g"),s||"");return n};this.updateApplePreviewFields(i,a,r),this.updateGooglePreviewFields(i,a,r)},updateApplePreviewFields(e,t,n){const o=document.getElementById("pass-preview");if(!o)return;const s=o.querySelector(".pass-header");let i=o.querySelector(".pass-header-fields");if(e.header.length>0){if(!i){i=document.createElement("div"),i.className="pass-header-fields",i.id="preview-header-fields";const e=s.querySelector(".pass-thumbnail");e?s.insertBefore(i,e):s.appendChild(i)}i.classList.remove("d-none"),i.classList.add("d-flex"),i.innerHTML=e.header.map(e=>`\n                <div class="pass-header-field">\n                    <div class="pass-field-label pass-field-label--dynamic" data-label-color="${t}">${e.label||""}</div>\n                    <div class="pass-field-value">${n(e)}</div>\n                </div>\n            `).join(""),i.querySelectorAll(".pass-field-label--dynamic").forEach(e=>{e.style.color=e.dataset.labelColor})}else i&&(i.classList.add("d-none"),i.classList.remove("d-flex"),i.innerHTML="");const a=o.getAttribute("data-pass-style")||"generic";let r=o.querySelector(".pass-primary-field-overlay"),c=o.querySelector(".pass-primary-fields-section");if(r)if("storeCard"===a&&e.primary.length>0){const o=e.primary[0];r.innerHTML=`\n                    <div class="pass-field-label pass-field-label--dynamic" data-label-color="${t}">${o.label||""}</div>\n                    <div class="pass-field-value">${n(o)}</div>\n                `;const s=r.querySelector(".pass-field-label--dynamic");s&&(s.style.color=s.dataset.labelColor)}else if("storeCard"===a){r.innerHTML=`\n                    <div class="pass-field-label pass-field-label--dynamic pass-field-value--muted" data-label-color="${t}">MEMBER</div>\n                    <div class="pass-field-value pass-field-value--muted">No primary field</div>\n                `;const e=r.querySelector(".pass-field-label--dynamic");e&&(e.style.color=e.dataset.labelColor)}if(c)if("generic"===a&&e.primary.length>0)c.innerHTML=e.primary.map(e=>`\n                    <div class="pass-field primary-field">\n                        <div class="pass-field-label pass-field-label--dynamic" data-label-color="${t}">${e.label||""}</div>\n                        <div class="pass-field-value">${n(e)}</div>\n                    </div>\n                `).join(""),c.querySelectorAll(".pass-field-label--dynamic").forEach(e=>{e.style.color=e.dataset.labelColor});else if("generic"===a){c.innerHTML=`\n                    <div class="pass-field primary-field">\n                        <div class="pass-field-label pass-field-label--dynamic pass-field-value--muted" data-label-color="${t}">MEMBER</div>\n                        <div class="pass-field-value pass-field-value--muted">No primary field</div>\n                    </div>\n                `;const e=c.querySelector(".pass-field-label--dynamic");e&&(e.style.color=e.dataset.labelColor)}let l=o.querySelector(".pass-secondary-fields"),d=[...e.secondary,...e.auxiliary];if("eventTicket"===a&&(d=[...e.primary,...d]),d.length>0){if(!l){l=document.createElement("div"),l.className="pass-secondary-fields";const e=o.querySelector(".pass-strip-area"),t=o.querySelector(".pass-primary-fields-section");e&&!e.classList.contains("d-none")?e.after(l):t&&t.after(l)}l.innerHTML=d.map(e=>`\n                <div class="pass-field">\n                    <div class="pass-field-label pass-field-label--dynamic" data-label-color="${t}">${e.label||""}</div>\n                    <div class="pass-field-value">${n(e)}</div>\n                </div>\n            `).join(""),l.querySelectorAll(".pass-field-label--dynamic").forEach(e=>{e.style.color=e.dataset.labelColor})}else l&&l.remove()},updateGooglePreviewFields(e,t,n){const o=document.querySelector(".google-pass-content");if(!o)return;let s=o.querySelector(".google-primary-value");if(e.primary.length>0){const t=e.primary[0];if(!s){s=document.createElement("div"),s.className="google-primary-value";const e=o.querySelector(".google-header");e&&e.after(s)}s.classList.remove("text-muted"),s.textContent=n(t)}else s&&(s.classList.add("text-muted"),s.textContent="No primary field configured");let i=o.querySelector(".google-info-rows");const a=[...e.secondary,...e.auxiliary];if(a.length>0){if(!i){i=document.createElement("div"),i.className="google-info-rows";const e=o.querySelector(".google-primary-value");e&&e.after(i)}i.innerHTML=a.map(e=>`\n                <div class="google-info-row">\n                    <span class="google-info-label pass-field-label--dynamic" data-label-color="${t}">${e.label||""}</span>\n                    <span class="google-info-value">${n(e)}</span>\n                </div>\n            `).join(""),i.querySelectorAll(".pass-field-label--dynamic").forEach(e=>{e.style.color=e.dataset.labelColor})}else i&&i.remove()},updatePreviewFromForm(){var e,t,n,o;const s=null==(e=document.getElementById("background_color"))?void 0:e.value,i=null==(t=document.getElementById("foreground_color"))?void 0:t.value,a=null==(n=document.getElementById("label_color"))?void 0:n.value,r=null==(o=document.getElementById("logo_text"))?void 0:o.value,c=document.getElementById("pass-preview");if(c&&(s&&(c.style.backgroundColor=s),i&&(c.style.color=i),a&&c.querySelectorAll(".pass-field-label").forEach(e=>{e.style.color=a}),void 0!==r)){const e=document.getElementById("preview-logo-text");e&&(e.textContent=r)}const l=document.querySelector(".google-pass-content");l&&(s&&(l.style.backgroundColor=s),i&&(l.style.color=i),a&&l.querySelectorAll(".google-info-label, .google-card-subtitle").forEach(e=>{e.style.color=a}))},updateBarcodePreview(){var e;const t=null==(e=document.getElementById("suppress_barcode"))?void 0:e.checked,n=document.querySelector("#apple-preview .pass-barcode-area");n&&n.classList.toggle("d-none",t);const o=document.querySelector("#google-preview .google-barcode-area");o&&o.classList.toggle("d-none",t)},initColorPickers(){document.querySelectorAll(".color-input").forEach(e=>{e.addEventListener("input",()=>{this.updatePreviewFromForm(),this.markUnsaved()})})},toggleLogoVisibility(){var e;const t=(null==(e=document.getElementById("show_logo"))?void 0:e.checked)??!0,n=document.getElementById("preview-logo");n&&(t&&this.assets.logo&&this.assets.logo.url?(n.classList.remove("d-none"),n.classList.add("d-flex")):(n.classList.add("d-none"),n.classList.remove("d-flex")))},async saveAppearance(){var e,t,n,o,s,i;const a=document.getElementById("appearance-form"),r=new FormData(a),c=Object.fromEntries(r);c.google_hero_image_url=(null==(e=document.getElementById("google_hero_image_url"))?void 0:e.value)||"",c.google_logo_url=(null==(t=document.getElementById("google_logo_url"))?void 0:t.value)||"",c.suppress_barcode=(null==(n=document.getElementById("suppress_barcode"))?void 0:n.checked)||!1,c.show_logo=(null==(o=document.getElementById("show_logo"))?void 0:o.checked)??!0;const l=document.querySelector('input[name="apple_pass_style"]:checked');c.apple_pass_style=(null==l?void 0:l.value)||"generic";try{const e=(null==(s=document.querySelector("meta[name=csrf-token]"))?void 0:s.getAttribute("content"))||(null==(i=document.querySelector("[name=csrf_token]"))?void 0:i.value)||"",t=await fetch(`/admin/wallet/studio/${this.passTypeCode}/appearance`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e},body:JSON.stringify(c)}),n=await t.json();n.success?(this.showToast("Appearance saved successfully","success"),this.markSaved()):this.showToast(n.error||"Error saving appearance","error")}catch(d){console.error("Error saving appearance:",d),this.showToast("Error saving appearance","error")}},showToast(e,t="info"){"undefined"!=typeof Swal?Swal.fire({toast:!0,position:"top-end",icon:t,title:e,showConfirmButton:!1,timer:3e3}):alert(e)},insertVariable(e,t){const n=document.getElementById(e);if(n){const e=n.selectionStart,o=n.selectionEnd,s=n.value,i="{{"+t+"}}";n.value=s.substring(0,e)+i+s.substring(o),n.focus(),n.selectionStart=n.selectionEnd=e+i.length,this.markUnsaved()}}};document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("script[data-pass-type-code]");if(e){const t=e.dataset.passTypeCode;Ct.init(t)}});const Tt={canvas:null,ctx:null,image:null,scale:1,minScale:.1,maxScale:5,offsetX:0,offsetY:0,isDragging:!1,lastX:0,lastY:0,currentAssetType:null,targetWidth:29,targetHeight:29,passTypeCode:null,DIMENSIONS:{icon:{width:29,height:29,label:"Icon"},icon2x:{width:58,height:58,label:"Icon @2x"},logo:{width:160,height:50,label:"Logo"},logo2x:{width:320,height:100,label:"Logo @2x"},strip:{width:375,height:123,label:"Strip Image"},strip2x:{width:750,height:246,label:"Strip @2x"},thumbnail:{width:90,height:90,label:"Thumbnail"},thumbnail2x:{width:180,height:180,label:"Thumbnail @2x"},background:{width:180,height:220,label:"Background"},background2x:{width:360,height:440,label:"Background @2x"}},assetExists:!1,open(e,t,n=null){this.currentAssetType=e,this.passTypeCode=t,this.assetExists=!!n;const o=this.DIMENSIONS[e];if(!o)return void console.error("Unknown asset type:",e);this.targetWidth=o.width,this.targetHeight=o.height,document.getElementById("cropper-asset-name").textContent=o.label,document.getElementById("cropper-dimensions").textContent=`${this.targetWidth}x${this.targetHeight}`,this.reset(),document.getElementById("cropper-upload-area").classList.remove("d-none"),document.getElementById("cropper-canvas-area").classList.add("d-none"),document.getElementById("cropper-save-btn").disabled=!0,document.getElementById("cropper-change-btn").classList.add("d-none");const s=document.getElementById("cropper-delete-btn");s&&(this.assetExists?s.classList.remove("d-none"):s.classList.add("d-none")),ModalManager.show("assetCropperModal")},initCanvas(){this.canvas=document.getElementById("asset-cropper-canvas"),this.ctx=this.canvas.getContext("2d");const e=this.targetWidth/this.targetHeight;e>1?(this.canvas.width=Math.min(400,2*this.targetWidth),this.canvas.height=this.canvas.width/e):(this.canvas.height=Math.min(400,2*this.targetHeight),this.canvas.width=this.canvas.height*e),this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseUp.bind(this)),this.canvas.addEventListener("wheel",this.handleWheel.bind(this),{passive:!1}),this.canvas.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.canvas.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.canvas.addEventListener("touchend",this.handleTouchEnd.bind(this)),this.canvas.classList.add("cursor-move")},loadImage(e){const t=e.files[0];if(!t)return;if(!t.type.startsWith("image/"))return void Swal.fire({icon:"warning",title:"Invalid File",text:"Please select an image file (PNG, JPG, etc.)"});const n=new FileReader;n.onload=e=>{const t=new Image;t.onload=()=>{this.image=t,this.initCanvas(),this.fitImageToCanvas(),this.draw(),document.getElementById("cropper-upload-area").classList.add("d-none"),document.getElementById("cropper-canvas-area").classList.remove("d-none"),document.getElementById("cropper-save-btn").disabled=!1,document.getElementById("cropper-change-btn").classList.remove("d-none")},t.onerror=()=>{Swal.fire({icon:"error",title:"Load Error",text:"Failed to load the image. Please try another file."})},t.src=e.target.result},n.readAsDataURL(t)},fitImageToCanvas(){if(!this.image)return;const e=this.canvas.width/this.image.width,t=this.canvas.height/this.image.height;this.scale=Math.max(e,t),this.minScale=.5*this.scale,this.offsetX=(this.canvas.width-this.image.width*this.scale)/2,this.offsetY=(this.canvas.height-this.image.height*this.scale)/2},draw(){this.ctx&&this.image&&(this.drawCheckerboard(),this.ctx.drawImage(this.image,this.offsetX,this.offsetY,this.image.width*this.scale,this.image.height*this.scale),this.ctx.strokeStyle="undefined"!=typeof ECSTheme?ECSTheme.getColor("primary"):"#0d6efd",this.ctx.lineWidth=2,this.ctx.strokeRect(1,1,this.canvas.width-2,this.canvas.height-2))},drawCheckerboard(){const e=10;for(let t=0;t<this.canvas.width;t+=e)for(let n=0;n<this.canvas.height;n+=e){const o="undefined"!=typeof ECSTheme?ECSTheme.getColor("neutral-10"):"#e0e0e0",s="undefined"!=typeof ECSTheme?ECSTheme.getColor("neutral-5"):"#f5f5f5";this.ctx.fillStyle=(Math.floor(t/e)+Math.floor(n/e))%2==0?o:s,this.ctx.fillRect(t,n,e,e)}},handleMouseDown(e){this.isDragging=!0;const t=this.canvas.getBoundingClientRect();this.lastX=e.clientX-t.left,this.lastY=e.clientY-t.top,this.canvas.classList.remove("cursor-move"),this.canvas.classList.add("cursor-grabbing")},handleMouseMove(e){if(!this.isDragging||!this.image)return;const t=this.canvas.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top;this.offsetX+=n-this.lastX,this.offsetY+=o-this.lastY,this.lastX=n,this.lastY=o,this.draw()},handleMouseUp(){this.isDragging=!1,this.canvas&&(this.canvas.classList.remove("cursor-grabbing"),this.canvas.classList.add("cursor-move"))},handleWheel(e){if(e.preventDefault(),!this.image)return;const t=e.deltaY>0?.9:1.1,n=this.scale*t;if(n<this.minScale||n>this.maxScale)return;const o=this.canvas.getBoundingClientRect(),s=e.clientX-o.left,i=e.clientY-o.top;this.offsetX=s-(s-this.offsetX)*(n/this.scale),this.offsetY=i-(i-this.offsetY)*(n/this.scale),this.scale=n,this.draw()},handleTouchStart(e){if(e.preventDefault(),1===e.touches.length){const t=e.touches[0],n=this.canvas.getBoundingClientRect();this.isDragging=!0,this.lastX=t.clientX-n.left,this.lastY=t.clientY-n.top}},handleTouchMove(e){if(e.preventDefault(),1===e.touches.length&&this.isDragging&&this.image){const t=e.touches[0],n=this.canvas.getBoundingClientRect(),o=t.clientX-n.left,s=t.clientY-n.top;this.offsetX+=o-this.lastX,this.offsetY+=s-this.lastY,this.lastX=o,this.lastY=s,this.draw()}},handleTouchEnd(e){e.preventDefault(),this.isDragging=!1},zoomIn(){if(!this.image)return;const e=this.canvas.width/2,t=this.canvas.height/2,n=1.2*this.scale;n>this.maxScale||(this.offsetX=e-(e-this.offsetX)*(n/this.scale),this.offsetY=t-(t-this.offsetY)*(n/this.scale),this.scale=n,this.draw())},zoomOut(){if(!this.image)return;const e=this.canvas.width/2,t=this.canvas.height/2,n=.8*this.scale;n<this.minScale||(this.offsetX=e-(e-this.offsetX)*(n/this.scale),this.offsetY=t-(t-this.offsetY)*(n/this.scale),this.scale=n,this.draw())},resetPosition(){this.image&&(this.fitImageToCanvas(),this.draw())},reset(){this.image=null,this.scale=1,this.offsetX=0,this.offsetY=0,this.isDragging=!1;const e=document.getElementById("cropper-file-input");e&&(e.value="")},changeImage(){document.getElementById("cropper-file-input").click()},getCroppedImageData(){if(!this.image)return null;const e=document.createElement("canvas");e.width=this.targetWidth,e.height=this.targetHeight;const t=e.getContext("2d"),n=(e=>(e-this.offsetX)/this.scale)(0),o=(e=>(e-this.offsetY)/this.scale)(0),s=this.canvas.width/this.scale,i=this.canvas.height/this.scale;return t.drawImage(this.image,n,o,s,i,0,0,this.targetWidth,this.targetHeight),e.toDataURL("image/png")},async saveAndUpload(){var e,t;const n=this.getCroppedImageData();if(n){Swal.fire({title:"Uploading...",text:"Saving your asset",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>Swal.showLoading()});try{const o=(null==(e=document.querySelector("[name=csrf_token]"))?void 0:e.value)||(null==(t=document.querySelector('meta[name="csrf-token"]'))?void 0:t.content),s=await fetch(`/admin/wallet/studio/${this.passTypeCode}/assets/upload`,{method:"POST",headers:{"Content-Type":"application/json",...o&&{"X-CSRFToken":o}},body:JSON.stringify({asset_type:this.currentAssetType,cropped_image:n})}),i=await s.json();if(!i.success)throw new Error(i.error||"Upload failed");{Swal.fire({icon:"success",title:"Asset Saved!",text:i.message,timer:2e3,showConfirmButton:!1});const e=bootstrap.Modal.getInstance(document.getElementById("assetCropperModal"));e&&e.hide(),"undefined"!=typeof PassStudio&&PassStudio.onAssetUploaded&&PassStudio.onAssetUploaded(this.currentAssetType,i.asset)}}catch(o){console.error("Upload error:",o),Swal.fire({icon:"error",title:"Upload Failed",text:o.message||"An error occurred while uploading the asset."})}}else Swal.fire({icon:"warning",title:"No Image",text:"Please select an image first."})},async deleteAsset(){var e,t,n;if(this.currentAssetType&&this.passTypeCode&&(await Swal.fire({title:"Remove Asset?",text:`Are you sure you want to remove the ${(null==(e=this.DIMENSIONS[this.currentAssetType])?void 0:e.label)||this.currentAssetType} image?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"undefined"!=typeof ECSTheme?ECSTheme.getColor("danger"):"#dc3545",confirmButtonText:"Yes, remove it",cancelButtonText:"Cancel"})).isConfirmed){Swal.fire({title:"Removing...",text:"Deleting asset",allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>Swal.showLoading()});try{const e=(null==(t=document.querySelector("[name=csrf_token]"))?void 0:t.value)||(null==(n=document.querySelector('meta[name="csrf-token"]'))?void 0:n.content),o=await fetch(`/admin/wallet/studio/${this.passTypeCode}/assets/${this.currentAssetType}`,{method:"DELETE",headers:{"Content-Type":"application/json",...e&&{"X-CSRFToken":e}}}),s=await o.json();if(!s.success)throw new Error(s.error||"Delete failed");{Swal.fire({icon:"success",title:"Asset Removed!",text:s.message,timer:2e3,showConfirmButton:!1});const e=bootstrap.Modal.getInstance(document.getElementById("assetCropperModal"));e&&e.hide(),"undefined"!=typeof PassStudio&&PassStudio.onAssetDeleted&&PassStudio.onAssetDeleted(this.currentAssetType)}}catch(o){console.error("Delete error:",o),Swal.fire({icon:"error",title:"Delete Failed",text:o.message||"An error occurred while removing the asset."})}}}};window.AssetCropper=Tt;class xt{constructor(){this.refreshInterval=null,this.countdownInterval=null,this.init()}init(){this.initTooltips(),this.loadSecurityEvents(),this.loadSecurityLogs(),this.startCountdowns(),this.startAutoRefresh()}initTooltips(){[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(e=>new bootstrap.Tooltip(e))}async refreshAll(){const e=document.getElementById("refreshBtn"),t=document.getElementById("refreshIndicator");e&&t&&(e.disabled=!0,t.classList.add("is-active"));try{await Promise.all([this.loadSecurityEvents(),this.loadSecurityLogs(),this.refreshStats()]);const e=document.getElementById("lastUpdated");e&&(e.textContent=(new Date).toLocaleTimeString())}catch(n){console.error("Error refreshing dashboard:",n),this.showAlert("Error refreshing dashboard","error")}finally{e&&t&&(e.disabled=!1,t.classList.remove("is-active"))}}async loadSecurityEvents(){try{console.log("Loading security events...");const e=await fetch("/security/events");if(console.log("Security events response:",e.status),!e.ok)throw new Error(`Failed to load security events: ${e.status}`);const t=await e.json();console.log("Security events data:",t),this.renderSecurityEvents(t.events||[])}catch(e){console.error("Error loading security events:",e),this.renderSecurityEventsError()}}async loadSecurityLogs(){try{console.log("Loading security logs...");const e=await fetch("/security/logs");if(console.log("Security logs response:",e.status),!e.ok)throw new Error(`Failed to load security logs: ${e.status}`);const t=await e.json();console.log("Security logs data:",t),this.renderSecurityLogs(t.logs||[])}catch(e){console.error("Error loading security logs:",e),this.renderSecurityLogsError()}}async refreshStats(){try{const e=await fetch("/security/status");if(!e.ok)throw new Error("Failed to refresh stats");const t=await e.json(),n=document.getElementById("monitoredIps");n&&t.attack_protection&&(n.textContent=t.attack_protection.total_monitored_ips||0);const o=document.getElementById("blacklistedIps");o&&t.attack_protection&&(o.textContent=t.attack_protection.total_blacklisted_ips||0);const s=document.getElementById("attackAttempts");s&&t.attack_protection&&(s.textContent=t.attack_protection.total_attack_attempts||0)}catch(e){console.error("Error refreshing stats:",e)}}renderSecurityEvents(e){const t=document.getElementById("securityEvents");if(!t)return;if(0===e.length)return void(t.innerHTML='\n                <div class="u-text-center u-py-4">\n                    <i class="ti ti-shield-check u-text-success u-mb-2 u-fs-1"></i>\n                    <p class="u-text-muted u-mb-0">No recent security events</p>\n                </div>\n            ');const n=e.map(e=>{const t=this.getSeverityClass(e.severity),n=this.getEventIcon(e.type),o=new Date(e.timestamp).toLocaleString();return`\n                <div class="js-event-item" data-severity="${e.severity}">\n                    <div class="u-flex u-align-start">\n                        <div class="u-avatar u-avatar-sm u-me-3">\n                            <div class="u-avatar-initial u-bg-light-${t} u-rounded-circle">\n                                <i class="ti ${n} u-text-${t}"></i>\n                            </div>\n                        </div>\n                        <div class="u-flex-grow">\n                            <div class="u-flex u-justify-between u-align-start">\n                                <div>\n                                    <h6 class="u-mb-1">${this.formatEventTitle(e.type)}</h6>\n                                    <p class="u-mb-1 u-text-muted">${e.description}</p>\n                                    <small class="u-text-muted">\n                                        <i class="ti ti-clock u-me-1"></i>\n                                        ${o}\n                                    </small>\n                                </div>\n                                <div class="u-ms-2">\n                                    ${this.shouldShowBanButton(e)?`\n                                        <button class="u-btn u-btn-outline-danger u-btn-xs" data-action="ban-ip-quick" data-ip="${e.ip}" data-reason="Security event: ${e.type}">\n                                            <i class="ti ti-ban"></i>\n                                            Ban\n                                        </button>\n                                    `:""}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `}).join("");t.innerHTML=n}renderSecurityLogs(e){const t=document.getElementById("securityLogs");if(!t)return;if(0===e.length)return void(t.innerHTML='\n                <div class="u-text-center u-py-4">\n                    <i class="ti ti-file-text u-text-muted u-mb-2 u-fs-1"></i>\n                    <p class="u-text-muted u-mb-0">No recent logs</p>\n                </div>\n            ');const n=e.map(e=>{const t=this.getLogLevelClass(e.level),n=this.getLogLevelIcon(e.level),o=new Date(e.timestamp),s=o.toLocaleDateString()+" "+o.toLocaleTimeString();return`\n                <div class="js-log-item u-flex u-align-start u-mb-3 u-p-3 u-border u-rounded">\n                    <div class="u-avatar u-avatar-sm u-me-3">\n                        <div class="u-avatar-initial u-bg-light-${t} u-rounded-circle">\n                            <i class="ti ${n} u-text-${t}"></i>\n                        </div>\n                    </div>\n                    <div class="u-flex-grow">\n                        <div class="u-flex u-justify-between u-align-start u-mb-1">\n                            <span class="u-badge u-bg-light-${t} u-text-${t}">${e.level}</span>\n                            <small class="u-text-muted">${e.source}</small>\n                        </div>\n                        <p class="u-mb-2 u-fw-medium">${e.message}</p>\n                        <small class="u-text-muted">\n                            <i class="ti ti-clock u-me-1"></i>\n                            ${s}\n                        </small>\n                    </div>\n                </div>\n            `}).join("");t.innerHTML=n}renderSecurityEventsError(){const e=document.getElementById("securityEvents");e&&(e.innerHTML='\n                <div class="u-text-center u-py-4">\n                    <i class="ti ti-alert-triangle u-text-warning u-mb-2 u-fs-1"></i>\n                    <p class="u-text-muted u-mb-0">Error loading security events</p>\n                </div>\n            ')}renderSecurityLogsError(){const e=document.getElementById("securityLogs");e&&(e.innerHTML='\n                <div class="u-text-center u-py-4">\n                    <i class="ti ti-alert-triangle u-text-warning u-mb-2 u-fs-1"></i>\n                    <p class="u-text-muted u-mb-0">Error loading security logs</p>\n                </div>\n            ')}async unbanIP(e,t){var n;if(!e||!t)return;const o=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="ti ti-loader-2"></i> Unbanning...';try{const o=(null==(n=document.querySelector("meta[name=csrf-token]"))?void 0:n.getAttribute("content"))||"",s={ip_address:e},i={"Content-Type":"application/json"};o&&(i["X-CSRFToken"]=o);const a=await fetch("/security/unban_ip",{method:"POST",headers:i,body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to unban IP");const r=await a.json();if(!r.success)throw new Error(r.error||"Unknown error");{const e=t.closest("[data-banned-ip]");e&&e.remove(),this.showAlert(r.message,"success"),this.refreshStats()}}catch(s){console.error("Error unbanning IP:",s),this.showAlert("Error unbanning IP: "+s.message,"error"),t.disabled=!1,t.innerHTML=o}}async banIP(){var e;const t=document.getElementById("banIpForm"),n=new FormData(t),o=n.get("ip_address"),s=n.get("duration"),i=n.get("reason");if(!o)return void this.showAlert("IP address is required","error");const a=document.getElementById("confirmBanBtn"),r=a.innerHTML;a.disabled=!0,a.innerHTML='<i class="ti ti-loader-2"></i> Banning...';try{const n=(null==(e=document.querySelector("meta[name=csrf-token]"))?void 0:e.getAttribute("content"))||"",a={ip_address:o,duration_hours:s?parseInt(s):null,reason:i||null},r={"Content-Type":"application/json"};n&&(r["X-CSRFToken"]=n);const c=await fetch("/security/ban_ip",{method:"POST",headers:r,body:JSON.stringify(a)});if(!c.ok)throw new Error(`Failed to ban IP: ${c.status}`);const l=await c.json();if(!l.success)throw new Error(l.error||"Unknown error");this.showAlert(l.message,"success"),bootstrap.Modal.getInstance(document.getElementById("banIpModal")).hide(),t.reset(),await this.refreshAll()}catch(c){console.error("Error banning IP:",c),this.showAlert("Error banning IP: "+c.message,"error")}finally{a.disabled=!1,a.innerHTML=r}}async clearAllBans(){var e;if(!confirm("Are you sure you want to clear ALL IP bans? This action cannot be undone."))return;const t=document.getElementById("clearAllBansBtn"),n=t.innerHTML;t.disabled=!0,t.innerHTML='<i class="ti ti-loader-2"></i> Clearing...';try{const t=(null==(e=document.querySelector("meta[name=csrf-token]"))?void 0:e.getAttribute("content"))||"",n={"Content-Type":"application/json"};t&&(n["X-CSRFToken"]=t);const o=await fetch("/security/clear_all_bans",{method:"POST",headers:n});if(!o.ok)throw new Error(`Failed to clear bans: ${o.status}`);const s=await o.json();if(!s.success)throw new Error(s.error||"Unknown error");this.showAlert(s.message,"success"),await this.refreshAll()}catch(o){console.error("Error clearing bans:",o),this.showAlert("Error clearing bans: "+o.message,"error")}finally{t.disabled=!1,t.innerHTML=n}}startCountdowns(){this.countdownInterval=setInterval(()=>{document.querySelectorAll(".countdown").forEach(e=>{let t=parseInt(e.getAttribute("data-expiry"));if(t>0){t--,e.setAttribute("data-expiry",t);const n=Math.floor(t/60),o=t%60;if(e.textContent=`${n}:${o.toString().padStart(2,"0")}`,0===t){const t=e.closest("[data-banned-ip]");t&&t.remove(),this.refreshStats()}}})},1e3)}startAutoRefresh(){this.refreshInterval=setInterval(()=>{this.loadSecurityEvents(),this.loadSecurityLogs(),this.refreshStats()},3e4)}getSeverityClass(e){switch(e){case"high":return"danger";case"medium":return"warning";case"low":return"success";default:return"secondary"}}getEventIcon(e){switch(e){case"ip_blacklisted":return"ti-ban";case"high_request_rate":return"ti-activity";case"attack_detected":return"ti-shield-x";case"suspicious_activity":return"ti-eye-exclamation";default:return"ti-alert-triangle"}}getLogLevelClass(e){switch(e){case"ERROR":return"danger";case"WARNING":return"warning";case"INFO":return"info";default:return"secondary"}}getLogLevelIcon(e){switch(e){case"ERROR":return"ti-circle-x";case"WARNING":return"ti-alert-triangle";case"INFO":return"ti-info-circle";case"DEBUG":return"ti-bug";default:return"ti-file-text"}}formatEventTitle(e){switch(e){case"ip_blacklisted":return"IP Blacklisted";case"high_request_rate":return"High Request Rate";case"attack_detected":return"Attack Detected";case"suspicious_activity":return"Suspicious Activity";default:return"Security Event"}}shouldShowBanButton(e){return!!e.ip&&"ip_blacklisted"!==e.type&&("high"===e.severity||"attack_detected"===e.type||"suspicious_activity"===e.type||"high_request_rate"===e.type)}async quickBanIP(e,t){var n;if(e&&confirm(`Ban IP address ${e}?\nReason: ${t}`))try{const o=(null==(n=document.querySelector("meta[name=csrf-token]"))?void 0:n.getAttribute("content"))||"",s={ip_address:e,duration_hours:24,reason:t},i={"Content-Type":"application/json"};o&&(i["X-CSRFToken"]=o);const a=await fetch("/security/ban_ip",{method:"POST",headers:i,body:JSON.stringify(s)});if(!a.ok)throw new Error(`Failed to ban IP: ${a.status}`);const r=await a.json();if(!r.success)throw new Error(r.error||"Unknown error");this.showAlert(`IP ${e} has been banned successfully`,"success"),await this.refreshAll()}catch(o){console.error("Error banning IP:",o),this.showAlert("Error banning IP: "+o.message,"error")}}showAlert(e,t="info"){"undefined"!=typeof Swal?Swal.fire({title:"error"===t?"Error":"Success",text:e,icon:"error"===t?"error":"success",confirmButtonText:"OK"}):alert(e)}destroy(){this.refreshInterval&&clearInterval(this.refreshInterval),this.countdownInterval&&clearInterval(this.countdownInterval)}}
/*! shepherd.js 11.2.0 */
var Lt,kt;document.addEventListener("DOMContentLoaded",()=>{window.securityDashboard=new xt}),window.addEventListener("beforeunload",()=>{window.securityDashboard&&window.securityDashboard.destroy()}),Lt=void 0,kt=function(){function e(e,t){return!1!==t.clone&&t.isMergeableObject(e)?s(Array.isArray(e)?[]:{},e,t):e}function t(t,n,o){return t.concat(n).map(function(t){return e(t,o)})}function n(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return Object.propertyIsEnumerable.call(e,t)}):[]}(e))}function o(e,t){try{return t in e}catch(n){return!1}}function s(i,a,r){(r=r||{}).arrayMerge=r.arrayMerge||t,r.isMergeableObject=r.isMergeableObject||Ge,r.cloneUnlessOtherwiseSpecified=e;var c=Array.isArray(a);return c!==Array.isArray(i)?e(a,r):c?r.arrayMerge(i,a,r):function(t,i,a){var r={};return a.isMergeableObject(t)&&n(t).forEach(function(n){r[n]=e(t[n],a)}),n(i).forEach(function(n){if(!o(t,n)||Object.hasOwnProperty.call(t,n)&&Object.propertyIsEnumerable.call(t,n))if(o(t,n)&&a.isMergeableObject(i[n])){if(a.customMerge){var c=a.customMerge(n);c="function"==typeof c?c:s}else c=s;r[n]=c(t[n],i[n],a)}else r[n]=e(i[n],a)}),r}(i,a,r)}function i(e){return"function"==typeof e}function a(e){return"string"==typeof e}function r(e){let t=Object.getOwnPropertyNames(e.constructor.prototype);for(let n=0;n<t.length;n++){let o=t[n],s=e[o];"constructor"!==o&&"function"==typeof s&&(e[o]=s.bind(e))}return e}function c(e){return a(e)&&""!==e?"-"!==e.charAt(e.length-1)?`${e}-`:e:""}function l(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},d.apply(this,arguments)}function u(e,t){if(null==e)return{};var n,o={},s=Object.keys(e);for(n=0;n<s.length;n++){var i=s[n];0<=t.indexOf(i)||(o[i]=e[i])}return o}function m(e,t){return"function"==typeof e?e(t):e}function h(e){return e.split("-")[0]}function p(e){return"x"===e?"y":"x"}function f(e){return"y"===e?"height":"width"}function g(e){return["top","bottom"].includes(h(e))?"y":"x"}function v(e){return e.replace(/start|end/g,e=>at[e])}function y(e){return e.replace(/left|right|bottom|top/g,e=>it[e])}function b(e){return"number"!=typeof e?d({top:0,right:0,bottom:0,left:0},e):{top:e,right:e,bottom:e,left:e}}function w(e){return d({},e,{top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height})}function S(e,t,n){let{reference:o,floating:s}=e;var i=g(t),a=f(e=p(g(t))),r=h(t);i="y"===i;let c=o.x+o.width/2-s.width/2,l=o.y+o.height/2-s.height/2;switch(a=o[a]/2-s[a]/2,r){case"top":r={x:c,y:o.y-s.height};break;case"bottom":r={x:c,y:o.y+o.height};break;case"right":r={x:o.x+o.width,y:l};break;case"left":r={x:o.x-s.width,y:l};break;default:r={x:o.x,y:o.y}}switch(t.split("-")[1]){case"start":r[e]-=a*(n&&i?-1:1);break;case"end":r[e]+=a*(n&&i?-1:1)}return r}async function _(e,t){var n;void 0===t&&(t={});let{x:o,y:s,platform:i,rects:a,elements:r,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:p=!1,padding:f=0}=m(t,e);e=b(f),t=r[p?"floating"===h?"reference":"floating":h],t=w(await i.getClippingRect({element:null==(n=await(null==i.isElement?void 0:i.isElement(t)))||n?t:t.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(r.floating)),boundary:l,rootBoundary:u,strategy:c}));var g="floating"===h?d({},a.floating,{x:o,y:s}):a.reference;let v=await(null==i.getOffsetParent?void 0:i.getOffsetParent(r.floating));return n=await(null==i.isElement?void 0:i.isElement(v))&&await(null==i.getScale?void 0:i.getScale(v))||{x:1,y:1},g=w(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({rect:g,offsetParent:v,strategy:c}):g),{top:(t.top-g.top+e.top)/n.y,bottom:(g.bottom-t.bottom+e.bottom)/n.y,left:(t.left-g.left+e.left)/n.x,right:(g.right-t.right+e.right)/n.x}}function E(e){return x(e)?(e.nodeName||"").toLowerCase():"#document"}function C(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function T(e){var t;return null==(t=(x(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function x(e){return e instanceof Node||e instanceof C(e).Node}function L(e){return e instanceof Element||e instanceof C(e).Element}function k(e){return e instanceof HTMLElement||e instanceof C(e).HTMLElement}function I(e){return"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof C(e).ShadowRoot)}function A(e){let{overflow:t,overflowX:n,overflowY:o,display:s}=P(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+n)&&!["inline","contents"].includes(s)}function $(e){let t=D(),n=P(e);return"none"!==n.transform||"none"!==n.perspective||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some(e=>(n.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(n.contain||"").includes(e))}function D(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function M(e){return["html","body","#document"].includes(E(e))}function P(e){return C(e).getComputedStyle(e)}function B(e){return L(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function q(e){return"html"===E(e)?e:(e=e.assignedSlot||e.parentNode||I(e)&&e.host||T(e),I(e)?e.host:e)}function O(e){let t=q(e);return M(t)?e.ownerDocument?e.ownerDocument.body:e.body:k(t)&&A(t)?t:O(t)}function N(e,t){var n;void 0===t&&(t=[]);let o=O(e);return e=o===(null==(n=e.ownerDocument)?void 0:n.body),n=C(o),e?t.concat(n,n.visualViewport||[],A(o)?o:[]):t.concat(o,N(o))}function R(e){var t=P(e);let n=parseFloat(t.width)||0;t=parseFloat(t.height)||0;var o=k(e);let s=o?e.offsetWidth:n;return e=o?e.offsetHeight:t,(o=ot(n)!==s||ot(t)!==e)&&(n=s,t=e),{width:n,height:t,$:o}}function F(e){return L(e)?e:e.contextElement}function H(e){var t=F(e);if(!k(t))return{x:1,y:1};e=t.getBoundingClientRect();let{width:n,height:o,$:s}=R(t);return t=(s?ot(e.width):e.width)/n,e=(s?ot(e.height):e.height)/o,t&&Number.isFinite(t)||(t=1),e&&Number.isFinite(e)||(e=1),{x:t,y:e}}function j(e){return e=C(e),D()&&e.visualViewport?{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}:ht}function z(e,t,n,o){void 0===t&&(t=!1),void 0===n&&(n=!1);var s=e.getBoundingClientRect(),i=F(e),a={x:1,y:1};if(t&&(o?L(o)&&(a=H(o)):a=H(e)),void 0===(e=n)&&(e=!1),t=(e=!(!o||e&&o!==C(i))&&e)?j(i):{x:0,y:0},e=(s.left+t.x)/a.x,t=(s.top+t.y)/a.y,n=s.width/a.x,s=s.height/a.y,i){i=C(i),a=o&&L(o)?C(o):o;let c=i.frameElement;for(;c&&o&&a!==i;){let o=H(c);var r=c.getBoundingClientRect();let i=P(c),a=r.left+(c.clientLeft+parseFloat(i.paddingLeft))*o.x;r=r.top+(c.clientTop+parseFloat(i.paddingTop))*o.y,e*=o.x,t*=o.y,n*=o.x,s*=o.y,e+=a,t+=r,c=C(c).frameElement}}return w({width:n,height:s,x:e,y:t})}function W(e){return z(T(e)).left+B(e).scrollLeft}function U(e,t,n){if("viewport"===t){t=C(e);var o=T(e);t=t.visualViewport,e=o.clientWidth,o=o.clientHeight;var s=0,i=0;if(t){e=t.width,o=t.height;let a=D();(!a||a&&"fixed"===n)&&(s=t.offsetLeft,i=t.offsetTop)}n={width:e,height:o,x:s,y:i}}else"document"===t?(i=T(e),n=T(i),s=B(i),t=i.ownerDocument.body,e=nt(n.scrollWidth,n.clientWidth,t.scrollWidth,t.clientWidth),o=nt(n.scrollHeight,n.clientHeight,t.scrollHeight,t.clientHeight),i=-s.scrollLeft+W(i),s=-s.scrollTop,"rtl"===P(t).direction&&(i+=nt(n.clientWidth,t.clientWidth)-e),n={width:e,height:o,x:i,y:s}):L(t)?(n=(e=z(t,!0,"fixed"===n)).top+t.clientTop,e=e.left+t.clientLeft,o=k(t)?H(t):{x:1,y:1},n={width:t.clientWidth*o.x,height:t.clientHeight*o.y,x:e*o.x,y:n*o.y}):(n=j(e),n=d({},t,{x:t.x-n.x,y:t.y-n.y}));return w(n)}function Y(e,t){return!((e=q(e))===t||!L(e)||M(e))&&("fixed"===P(e).position||Y(e,t))}function X(e,t){var n=t.get(e);if(n)return n;n=N(e).filter(e=>L(e)&&"body"!==E(e));let o=null,s="fixed"===P(e).position,i=s?q(e):e;for(;L(i)&&!M(i);){let t=P(i),a=$(i);a||"fixed"!==t.position||(o=null),(s?!a&&!o:!a&&"static"===t.position&&o&&["absolute","fixed"].includes(o.position)||A(i)&&!a&&Y(e,i))?n=n.filter(e=>e!==i):o=t,i=q(i)}return t.set(e,n),n}function V(e,t){return k(e)&&"fixed"!==P(e).position?t?t(e):e.offsetParent:null}function G(e,t){let n=C(e);if(!k(e))return n;let o=V(e,t);for(;o&&["table","td","th"].includes(E(o))&&"static"===P(o).position;)o=V(o,t);if(o&&("html"===E(o)||"body"===E(o)&&"static"===P(o).position&&!$(o)))return n;if(!(t=o))e:{for(e=q(e);k(e)&&!M(e);){if($(e)){t=e;break e}e=q(e)}t=null}return t||n}function K(e,t,n,o){void 0===o&&(o={});let{ancestorScroll:s=!0,ancestorResize:i=!0,elementResize:a="function"==typeof ResizeObserver,layoutShift:r="function"==typeof IntersectionObserver,animationFrame:c=!1}=o,l=F(e),u=s||i?[...l?N(l):[],...N(t)]:[];u.forEach(e=>{s&&e.addEventListener("scroll",n,{passive:!0}),i&&e.addEventListener("resize",n)});let m=l&&r?function(e,t){function n(){clearTimeout(o),s&&s.disconnect(),s=null}let o,s=null,i=T(e);return function a(r,c){function l(e){if((e=e[0].intersectionRatio)!==c){if(!f)return a();e?a(!1,e):o=setTimeout(()=>{a(!1,1e-7)},100)}f=!1}void 0===r&&(r=!1),void 0===c&&(c=1),n();let{left:u,top:m,width:h,height:p}=e.getBoundingClientRect();if(r||t(),h&&p){r={rootMargin:-(r=st(m))+"px "+-st(i.clientWidth-(u+h))+"px "+-st(i.clientHeight-(m+p))+"px "+-st(u)+"px",threshold:nt(0,tt(1,c))||1};var f=!0;try{s=new IntersectionObserver(l,d({},r,{root:i.ownerDocument}))}catch(g){s=new IntersectionObserver(l,r)}s.observe(e)}}(!0),n}(l,n):null,h=-1,p=null;a&&(p=new ResizeObserver(e=>{[e]=e,e&&e.target===l&&p&&(p.unobserve(t),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{p&&p.observe(t)})),n()}),l&&!c&&p.observe(l),p.observe(t));let f,g=c?z(e):null;return c&&function t(){let o=z(e);!g||o.x===g.x&&o.y===g.y&&o.width===g.width&&o.height===g.height||n(),g=o,f=requestAnimationFrame(t)}(),n(),()=>{u.forEach(e=>{s&&e.removeEventListener("scroll",n),i&&e.removeEventListener("resize",n)}),m&&m(),p&&p.disconnect(),p=null,c&&cancelAnimationFrame(f)}}function J(e){e.cleanup&&e.cleanup();let t=e._getResolvedAttachToOptions(),n=t.element,o=function(e,t){let n={strategy:"absolute",middleware:[]};var o=!(!t.options.arrow||!t.el)&&t.el.querySelector(".shepherd-arrow");return null!=e&&e.element&&e.on&&(n.middleware.push(dt(),ut({limiter:mt(),crossAxis:!0})),o&&n.middleware.push(lt({element:o})),n.placement=e.on),Je(t.options.floatingUIOptions||{},n)}(t,e),s=null==t||!t.element||!t.on;return s&&(n=document.body,e.shepherdElementComponent.getElement().classList.add("shepherd-centered")),e.cleanup=K(n,e.el,()=>{e.el?function(e,t,n,o){ft(e,t.el,n).then(function(e,t){return({x:n,y:o,placement:s,middlewareData:i})=>{if(!e.el)return e;if(t?Object.assign(e.el.style,{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}):Object.assign(e.el.style,{position:"absolute",left:`${n}px`,top:`${o}px`}),e.el.dataset.popperPlacement=s,(n=e.el.querySelector(".shepherd-arrow"))&&i.arrow){let{x:e,y:t}=i.arrow;Object.assign(n.style,{left:null!=e?`${e}px`:"",top:null!=t?`${t}px`:""})}return e}}(t,o)).then(e=>new Promise(t=>{setTimeout(()=>t(e),300)})).then(e=>{e&&e.el&&e.el.focus({preventScroll:!0})})}(n,e,o,s):e.cleanup()}),e.target=t.element,o}function Q(){}function Z(e,t){for(let n in t)e[n]=t[n];return e}function ee(e){return e()}function te(e){return"function"==typeof e}function ne(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function oe(e){e.parentNode&&e.parentNode.removeChild(e)}function se(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ie(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function ae(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function re(e,t){let n=Object.getOwnPropertyDescriptors(e.__proto__);for(let o in t)null==t[o]?e.removeAttribute(o):"style"===o?e.style.cssText=t[o]:"__value"===o?e.value=e[o]=t[o]:n[o]&&n[o].set&&-1===gt.indexOf(o)?e[o]=t[o]:ae(e,o,t[o])}function ce(e,t,n){e.classList[n?"add":"remove"](t)}function le(){if(!Ze)throw Error("Function called outside component initialization");return Ze}function de(e){bt.push(e)}function ue(){if(0===Ct){var e=Ze;do{try{for(;Ct<vt.length;){let e=vt[Ct];Ct++,Ze=e;var t=e.$$;if(null!==t.fragment){t.update(),t.before_update.forEach(ee);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(de)}}}catch(n){throw Ct=vt.length=0,n}for(Ze=null,Ct=vt.length=0;yt.length;)yt.pop()();for(let e=0;e<bt.length;e+=1){let t=bt[e];Et.has(t)||(Et.add(t),t())}bt.length=0}while(vt.length);for(;wt.length;)wt.pop()();_t=!1,Et.clear(),Ze=e}}function me(){et={r:0,c:[],p:et}}function he(){et.r||et.c.forEach(ee),et=et.p}function pe(e,t){e&&e.i&&(Tt.delete(e),e.i(t))}function fe(e,t,n,o){e&&e.o?Tt.has(e)||(Tt.add(e),et.c.push(()=>{Tt.delete(e),o&&(n&&e.d(1),o())}),e.o(t)):o&&o()}function ge(e){e&&e.c()}function ve(e,t,n,o){let{fragment:s,after_update:i}=e.$$;s&&s.m(t,n),o||de(()=>{let t=e.$$.on_mount.map(ee).filter(te);e.$$.on_destroy?e.$$.on_destroy.push(...t):t.forEach(ee),e.$$.on_mount=[]}),i.forEach(de)}function ye(e,t){null!==(e=e.$$).fragment&&(function(e){let t=[],n=[];bt.forEach(o=>-1===e.indexOf(o)?t.push(o):n.push(o)),n.forEach(e=>e()),bt=t}(e.after_update),e.on_destroy.forEach(ee),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function be(e,t,n,o,s,i,a,r=[-1]){let c=Ze;Ze=e;let l=e.$$={fragment:null,ctx:[],props:i,update:Q,not_equal:s,bound:Object.create(null),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:Object.create(null),dirty:r,skip_bound:!1,root:t.target||c.$$.root},d=!1;l.ctx=n?n(e,t.props||{},(t,n,...o)=>(o=o.length?o[0]:n,l.ctx&&s(l.ctx[t],l.ctx[t]=o)&&(!l.skip_bound&&l.bound[t]&&l.bound[t](o),d&&(-1===e.$$.dirty[0]&&(vt.push(e),_t||(_t=!0,St.then(ue)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31)),n)):[],l.update(),d=!0,l.before_update.forEach(ee),l.fragment=!!o&&o(l.ctx),t.target&&(t.hydrate?(n=Array.from(t.target.childNodes),l.fragment&&l.fragment.l(n),n.forEach(oe)):l.fragment&&l.fragment.c(),t.intro&&pe(e.$$.fragment),ve(e,t.target,t.anchor,t.customElement),ue()),Ze=c}function we(e){let t,n,o,s,i;return{c(){t=document.createElement("button"),ae(t,"aria-label",n=e[3]?e[3]:null),ae(t,"class",o=`${e[1]||""} shepherd-button ${e[4]?"shepherd-button-secondary":""}`),t.disabled=e[2],ae(t,"tabindex","0")},m(n,o){n.insertBefore(t,o||null),t.innerHTML=e[5],s||(i=ie(t,"click",function(){te(e[0])&&e[0].apply(this,arguments)}),s=!0)},p(s,[i]){e=s,32&i&&(t.innerHTML=e[5]),8&i&&n!==(n=e[3]?e[3]:null)&&ae(t,"aria-label",n),18&i&&o!==(o=`${e[1]||""} shepherd-button ${e[4]?"shepherd-button-secondary":""}`)&&ae(t,"class",o),4&i&&(t.disabled=e[2])},i:Q,o:Q,d(e){e&&oe(t),s=!1,i()}}}function Se(e,t,n){function o(e){return i(e)?e.call(m):e}let s,a,r,c,l,d,{config:u,step:m}=t;return e.$$set=e=>{"config"in e&&n(6,u=e.config),"step"in e&&n(7,m=e.step)},e.$$.update=()=>{192&e.$$.dirty&&(n(0,s=u.action?u.action.bind(m.tour):null),n(1,a=u.classes),n(2,r=!!u.disabled&&o(u.disabled)),n(3,c=u.label?o(u.label):null),n(4,l=u.secondary),n(5,d=u.text?o(u.text):null))},[s,a,r,c,l,d,u,m]}function _e(e,t,n){return(e=e.slice())[2]=t[n],e}function Ee(e){let t,n,o=e[1],s=[];for(let a=0;a<o.length;a+=1)s[a]=Ce(_e(e,o,a));let i=e=>fe(s[e],1,1,()=>{s[e]=null});return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=document.createTextNode("")},m(e,o){for(let t=0;t<s.length;t+=1)s[t]&&s[t].m(e,o);e.insertBefore(t,o||null),n=!0},p(e,n){if(3&n){let a;for(o=e[1],a=0;a<o.length;a+=1){let i=_e(e,o,a);s[a]?(s[a].p(i,n),pe(s[a],1)):(s[a]=Ce(i),s[a].c(),pe(s[a],1),s[a].m(t.parentNode,t))}for(me(),a=o.length;a<s.length;a+=1)i(a);he()}},i(e){if(!n){for(e=0;e<o.length;e+=1)pe(s[e]);n=!0}},o(e){for(s=s.filter(Boolean),e=0;e<s.length;e+=1)fe(s[e]);n=!1},d(e){var n=s;for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e);e&&oe(t)}}}function Ce(e){let t,n;return t=new Lt({props:{config:e[2],step:e[0]}}),{c(){ge(t.$$.fragment)},m(e,o){ve(t,e,o),n=!0},p(e,n){let o={};2&n&&(o.config=e[2]),1&n&&(o.step=e[0]),t.$set(o)},i(e){n||(pe(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Te(e){let t,n,o=e[1]&&Ee(e);return{c(){t=document.createElement("footer"),o&&o.c(),ae(t,"class","shepherd-footer")},m(e,s){e.insertBefore(t,s||null),o&&o.m(t,null),n=!0},p(e,[n]){e[1]?o?(o.p(e,n),2&n&&pe(o,1)):(o=Ee(e),o.c(),pe(o,1),o.m(t,null)):o&&(me(),fe(o,1,1,()=>{o=null}),he())},i(e){n||(pe(o),n=!0)},o(e){fe(o),n=!1},d(e){e&&oe(t),o&&o.d()}}}function xe(e,t,n){let o,{step:s}=t;return e.$$set=e=>{"step"in e&&n(0,s=e.step)},e.$$.update=()=>{1&e.$$.dirty&&n(1,o=s.options.buttons)},[s,o]}function Le(e){let t,n,o,s,i;return{c(){t=document.createElement("button"),n=document.createElement("span"),n.textContent="Ã",ae(n,"aria-hidden","true"),ae(t,"aria-label",o=e[0].label?e[0].label:"Close Tour"),ae(t,"class","shepherd-cancel-icon"),ae(t,"type","button")},m(o,a){o.insertBefore(t,a||null),t.appendChild(n),s||(i=ie(t,"click",e[1]),s=!0)},p(e,[n]){1&n&&o!==(o=e[0].label?e[0].label:"Close Tour")&&ae(t,"aria-label",o)},i:Q,o:Q,d(e){e&&oe(t),s=!1,i()}}}function ke(e,t,n){let{cancelIcon:o,step:s}=t;return e.$$set=e=>{"cancelIcon"in e&&n(0,o=e.cancelIcon),"step"in e&&n(2,s=e.step)},[o,e=>{e.preventDefault(),s.cancel()},s]}function Ie(e){let t;return{c(){t=document.createElement("h3"),ae(t,"id",e[1]),ae(t,"class","shepherd-title")},m(n,o){n.insertBefore(t,o||null),e[3](t)},p(e,[n]){2&n&&ae(t,"id",e[1])},i:Q,o:Q,d(n){n&&oe(t),e[3](null)}}}function Ae(e,t,n){let{labelId:o,element:s,title:a}=t;return le().$$.after_update.push(()=>{i(a)&&n(2,a=a()),n(0,s.innerHTML=a,s)}),e.$$set=e=>{"labelId"in e&&n(1,o=e.labelId),"element"in e&&n(0,s=e.element),"title"in e&&n(2,a=e.title)},[s,o,a,function(e){yt[e?"unshift":"push"](()=>{s=e,n(0,s)})}]}function $e(e){let t,n;return t=new At({props:{labelId:e[0],title:e[2]}}),{c(){ge(t.$$.fragment)},m(e,o){ve(t,e,o),n=!0},p(e,n){let o={};1&n&&(o.labelId=e[0]),4&n&&(o.title=e[2]),t.$set(o)},i(e){n||(pe(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function De(e){let t,n;return t=new It({props:{cancelIcon:e[3],step:e[1]}}),{c(){ge(t.$$.fragment)},m(e,o){ve(t,e,o),n=!0},p(e,n){let o={};8&n&&(o.cancelIcon=e[3]),2&n&&(o.step=e[1]),t.$set(o)},i(e){n||(pe(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Me(e){let t,n,o,s=e[2]&&$e(e),i=e[3]&&e[3].enabled&&De(e);return{c(){t=document.createElement("header"),s&&s.c(),n=document.createTextNode(" "),i&&i.c(),ae(t,"class","shepherd-header")},m(e,a){e.insertBefore(t,a||null),s&&s.m(t,null),t.appendChild(n),i&&i.m(t,null),o=!0},p(e,[o]){e[2]?s?(s.p(e,o),4&o&&pe(s,1)):(s=$e(e),s.c(),pe(s,1),s.m(t,n)):s&&(me(),fe(s,1,1,()=>{s=null}),he()),e[3]&&e[3].enabled?i?(i.p(e,o),8&o&&pe(i,1)):(i=De(e),i.c(),pe(i,1),i.m(t,null)):i&&(me(),fe(i,1,1,()=>{i=null}),he())},i(e){o||(pe(s),pe(i),o=!0)},o(e){fe(s),fe(i),o=!1},d(e){e&&oe(t),s&&s.d(),i&&i.d()}}}function Pe(e,t,n){let o,s,{labelId:i,step:a}=t;return e.$$set=e=>{"labelId"in e&&n(0,i=e.labelId),"step"in e&&n(1,a=e.step)},e.$$.update=()=>{2&e.$$.dirty&&(n(2,o=a.options.title),n(3,s=a.options.cancelIcon))},[i,a,o,s]}function Be(e){let t;return{c(){t=document.createElement("div"),ae(t,"class","shepherd-text"),ae(t,"id",e[1])},m(n,o){n.insertBefore(t,o||null),e[3](t)},p(e,[n]){2&n&&ae(t,"id",e[1])},i:Q,o:Q,d(n){n&&oe(t),e[3](null)}}}function qe(e,t,n){let{descriptionId:o,element:s,step:a}=t;return le().$$.after_update.push(()=>{let{text:e}=a.options;i(e)&&(e=e.call(a)),e instanceof HTMLElement?s.appendChild(e):n(0,s.innerHTML=e,s)}),e.$$set=e=>{"descriptionId"in e&&n(1,o=e.descriptionId),"element"in e&&n(0,s=e.element),"step"in e&&n(2,a=e.step)},[s,o,a,function(e){yt[e?"unshift":"push"](()=>{s=e,n(0,s)})}]}function Oe(e){let t,n;return t=new $t({props:{labelId:e[1],step:e[2]}}),{c(){ge(t.$$.fragment)},m(e,o){ve(t,e,o),n=!0},p(e,n){let o={};2&n&&(o.labelId=e[1]),4&n&&(o.step=e[2]),t.$set(o)},i(e){n||(pe(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Ne(e){let t,n;return t=new Dt({props:{descriptionId:e[0],step:e[2]}}),{c(){ge(t.$$.fragment)},m(e,o){ve(t,e,o),n=!0},p(e,n){let o={};1&n&&(o.descriptionId=e[0]),4&n&&(o.step=e[2]),t.$set(o)},i(e){n||(pe(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Re(e){let t,n;return t=new kt({props:{step:e[2]}}),{c(){ge(t.$$.fragment)},m(e,o){ve(t,e,o),n=!0},p(e,n){let o={};4&n&&(o.step=e[2]),t.$set(o)},i(e){n||(pe(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){ye(t,e)}}}function Fe(e){let t,n,o,s,i=void 0!==e[2].options.title||e[2].options.cancelIcon&&e[2].options.cancelIcon.enabled,a=void 0!==e[2].options.text,r=Array.isArray(e[2].options.buttons)&&e[2].options.buttons.length,c=i&&Oe(e),l=a&&Ne(e),d=r&&Re(e);return{c(){t=document.createElement("div"),c&&c.c(),n=document.createTextNode(" "),l&&l.c(),o=document.createTextNode(" "),d&&d.c(),ae(t,"class","shepherd-content")},m(e,i){e.insertBefore(t,i||null),c&&c.m(t,null),t.appendChild(n),l&&l.m(t,null),t.appendChild(o),d&&d.m(t,null),s=!0},p(e,[s]){4&s&&(i=void 0!==e[2].options.title||e[2].options.cancelIcon&&e[2].options.cancelIcon.enabled),i?c?(c.p(e,s),4&s&&pe(c,1)):(c=Oe(e),c.c(),pe(c,1),c.m(t,n)):c&&(me(),fe(c,1,1,()=>{c=null}),he()),4&s&&(a=void 0!==e[2].options.text),a?l?(l.p(e,s),4&s&&pe(l,1)):(l=Ne(e),l.c(),pe(l,1),l.m(t,o)):l&&(me(),fe(l,1,1,()=>{l=null}),he()),4&s&&(r=Array.isArray(e[2].options.buttons)&&e[2].options.buttons.length),r?d?(d.p(e,s),4&s&&pe(d,1)):(d=Re(e),d.c(),pe(d,1),d.m(t,null)):d&&(me(),fe(d,1,1,()=>{d=null}),he())},i(e){s||(pe(c),pe(l),pe(d),s=!0)},o(e){fe(c),fe(l),fe(d),s=!1},d(e){e&&oe(t),c&&c.d(),l&&l.d(),d&&d.d()}}}function He(e,t,n){let{descriptionId:o,labelId:s,step:i}=t;return e.$$set=e=>{"descriptionId"in e&&n(0,o=e.descriptionId),"labelId"in e&&n(1,s=e.labelId),"step"in e&&n(2,i=e.step)},[o,s,i]}function je(e){let t;return{c(){t=document.createElement("div"),ae(t,"class","shepherd-arrow"),ae(t,"data-popper-arrow","")},m(e,n){e.insertBefore(t,n||null)},d(e){e&&oe(t)}}}function ze(e){let t,n,o,s,i,a,r,c,l=e[4].options.arrow&&e[4].options.attachTo&&e[4].options.attachTo.element&&e[4].options.attachTo.on&&je();o=new Mt({props:{descriptionId:e[2],labelId:e[3],step:e[4]}});let d=[{"aria-describedby":s=void 0!==e[4].options.text?e[2]:null},{"aria-labelledby":i=e[4].options.title?e[3]:null},e[1],{role:"dialog"},{tabindex:"0"}],u={};for(let m=0;m<d.length;m+=1)u=Z(u,d[m]);return{c(){t=document.createElement("div"),l&&l.c(),n=document.createTextNode(" "),ge(o.$$.fragment),re(t,u),ce(t,"shepherd-has-cancel-icon",e[5]),ce(t,"shepherd-has-title",e[6]),ce(t,"shepherd-element",!0)},m(s,i){s.insertBefore(t,i||null),l&&l.m(t,null),t.appendChild(n),ve(o,t,null),e[13](t),a=!0,r||(c=ie(t,"keydown",e[7]),r=!0)},p(e,[r]){e[4].options.arrow&&e[4].options.attachTo&&e[4].options.attachTo.element&&e[4].options.attachTo.on?l||(l=je(),l.c(),l.m(t,n)):l&&(l.d(1),l=null);var c={};4&r&&(c.descriptionId=e[2]),8&r&&(c.labelId=e[3]),16&r&&(c.step=e[4]),o.$set(c),c=t,r=[(!a||20&r&&s!==(s=void 0!==e[4].options.text?e[2]:null))&&{"aria-describedby":s},(!a||24&r&&i!==(i=e[4].options.title?e[3]:null))&&{"aria-labelledby":i},2&r&&e[1],{role:"dialog"},{tabindex:"0"}];let m={},h={},p={$$scope:1},f=d.length;for(;f--;){let e=d[f],t=r[f];if(t){for(let n in e)n in t||(h[n]=1);for(let e in t)p[e]||(m[e]=t[e],p[e]=1);d[f]=t}else for(let n in e)p[n]=1}for(let t in h)t in m||(m[t]=void 0);re(c,u=m),ce(t,"shepherd-has-cancel-icon",e[5]),ce(t,"shepherd-has-title",e[6]),ce(t,"shepherd-element",!0)},i(e){a||(pe(o.$$.fragment,e),a=!0)},o(e){fe(o.$$.fragment,e),a=!1},d(n){n&&oe(t),l&&l.d(),ye(o),e[13](null),r=!1,c()}}}function We(e){return e.split(" ").filter(e=>!!e.length)}function Ue(e,t,n){let o,s,i,{classPrefix:r,element:c,descriptionId:l,firstFocusableElement:d,focusableElements:u,labelId:m,lastFocusableElement:h,step:p,dataStepId:f}=t;return le().$$.on_mount.push(()=>{n(1,f={[`data-${r}shepherd-step-id`]:p.id}),n(9,u=c.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]')),n(8,d=u[0]),n(10,h=u[u.length-1])}),le().$$.after_update.push(()=>{if(i!==p.options.classes){var e=i;a(e)&&(e=We(e)).length&&c.classList.remove(...e),a(e=i=p.options.classes)&&(e=We(e)).length&&c.classList.add(...e)}}),e.$$set=e=>{"classPrefix"in e&&n(11,r=e.classPrefix),"element"in e&&n(0,c=e.element),"descriptionId"in e&&n(2,l=e.descriptionId),"firstFocusableElement"in e&&n(8,d=e.firstFocusableElement),"focusableElements"in e&&n(9,u=e.focusableElements),"labelId"in e&&n(3,m=e.labelId),"lastFocusableElement"in e&&n(10,h=e.lastFocusableElement),"step"in e&&n(4,p=e.step),"dataStepId"in e&&n(1,f=e.dataStepId)},e.$$.update=()=>{16&e.$$.dirty&&(n(5,o=p.options&&p.options.cancelIcon&&p.options.cancelIcon.enabled),n(6,s=p.options&&p.options.title))},[c,f,l,m,p,o,s,e=>{const{tour:t}=p;switch(e.keyCode){case 9:if(0===u.length){e.preventDefault();break}e.shiftKey?(document.activeElement===d||document.activeElement.classList.contains("shepherd-element"))&&(e.preventDefault(),h.focus()):document.activeElement===h&&(e.preventDefault(),d.focus());break;case 27:t.options.exitOnEsc&&(e.stopPropagation(),p.cancel());break;case 37:t.options.keyboardNavigation&&(e.stopPropagation(),t.back());break;case 39:t.options.keyboardNavigation&&(e.stopPropagation(),t.next())}},d,u,h,r,()=>c,function(e){yt[e?"unshift":"push"](()=>{c=e,n(0,c)})}]}function Ye(e){let t,n,o,s,i;return{c(){t=se("svg"),n=se("path"),ae(n,"d",e[2]),ae(t,"class",o=(e[1]?"shepherd-modal-is-visible":"")+" shepherd-modal-overlay-container")},m(o,a){o.insertBefore(t,a||null),t.appendChild(n),e[11](t),s||(i=ie(t,"touchmove",e[3]),s=!0)},p(e,[s]){4&s&&ae(n,"d",e[2]),2&s&&o!==(o=(e[1]?"shepherd-modal-is-visible":"")+" shepherd-modal-overlay-container")&&ae(t,"class",o)},i:Q,o:Q,d(n){n&&oe(t),e[11](null),s=!1,i()}}}function Xe(e){if(!e)return null;let t=e instanceof HTMLElement&&window.getComputedStyle(e).overflowY;return"hidden"!==t&&"visible"!==t&&e.scrollHeight>=e.clientHeight?e:Xe(e.parentElement)}function Ve(e,t,n){function o(){n(4,u={width:0,height:0,x:0,y:0,r:0})}function s(){n(1,p=!1),r()}function i(e=0,t=0,s,i){if(i){var a=i.getBoundingClientRect();let o=a.y||a.top;if(a=a.bottom||o+a.height,s){var r=s.getBoundingClientRect();s=r.y||r.top,r=r.bottom||s+r.height,o=Math.max(o,s),a=Math.min(a,r)}let{y:c,height:l}={y:o,height:Math.max(a-o,0)},{x:d,width:m,left:h}=i.getBoundingClientRect();n(4,u={width:m+2*e,height:l+2*e,x:(d||h)-e,y:c-e,r:t})}else o()}function a(){n(1,p=!0)}function r(){m&&(cancelAnimationFrame(m),m=void 0),window.removeEventListener("touchmove",f,{passive:!1})}function c(e){let{modalOverlayOpeningPadding:t,modalOverlayOpeningRadius:n}=e.options,o=Xe(e.target),s=()=>{m=void 0,i(t,n,o,e.target),m=requestAnimationFrame(s)};s(),window.addEventListener("touchmove",f,{passive:!1})}let{element:d,openingProperties:u}=t;l();let m,h,p=!1;o();let f=e=>{e.preventDefault()};return e.$$set=e=>{"element"in e&&n(0,d=e.element),"openingProperties"in e&&n(4,u=e.openingProperties)},e.$$.update=()=>{16&e.$$.dirty&&n(2,h=function({width:e,height:t,x:n=0,y:o=0,r:s=0}){let{innerWidth:i,innerHeight:a}=window,{topLeft:r=0,topRight:c=0,bottomRight:l=0,bottomLeft:d=0}="number"==typeof s?{topLeft:s,topRight:s,bottomRight:s,bottomLeft:s}:s;return`M${i},${a}H0V0H${i}V${a}ZM${n+r},${o}a${r},${r},0,0,0-${r},${r}V${t+o-d}a${d},${d},0,0,0,${d},${d}H${e+n-l}a${l},${l},0,0,0,${l}-${l}V${o+c}a${c},${c},0,0,0-${c}-${c}Z`}(u))},[d,p,h,e=>{e.stopPropagation()},u,()=>d,o,s,i,function(e){r(),e.tour.options.useModalOverlay?(c(e),a()):s()},a,function(e){yt[e?"unshift":"push"](()=>{d=e,n(0,d)})}]}var Ge=function(e){var t;return(t=!!e&&"object"==typeof e)&&(t=!("[object RegExp]"===(t=Object.prototype.toString.call(e))||"[object Date]"===t||e.$$typeof===Ke)),t},Ke="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;s.all=function(e,t){if(!Array.isArray(e))throw Error("first argument should be an array");return e.reduce(function(e,n){return s(e,n,t)},{})};var Je=s;class Qe{on(e,t,n,o=!1){return void 0===this.bindings&&(this.bindings={}),void 0===this.bindings[e]&&(this.bindings[e]=[]),this.bindings[e].push({handler:t,ctx:n,once:o}),this}once(e,t,n){return this.on(e,t,n,!0)}off(e,t){return void 0===this.bindings||void 0===this.bindings[e]||(void 0===t?delete this.bindings[e]:this.bindings[e].forEach((n,o)=>{n.handler===t&&this.bindings[e].splice(o,1)})),this}trigger(e,...t){return void 0!==this.bindings&&this.bindings[e]&&this.bindings[e].forEach((n,o)=>{let{ctx:s,handler:i,once:a}=n;i.apply(s||this,t),a&&this.bindings[e].splice(o,1)}),this}}let Ze,et,tt=Math.min,nt=Math.max,ot=Math.round,st=Math.floor,it={left:"right",right:"left",bottom:"top",top:"bottom"},at={start:"end",end:"start"},rt="mainAxis crossAxis fallbackPlacements fallbackStrategy fallbackAxisSideDirection flipAlignment".split(" "),ct=["mainAxis","crossAxis","limiter"],lt=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:o,placement:s,rects:i,platform:a,elements:r}=t,{element:c,padding:l=0}=m(e,t)||{};if(null==c)return{};var d=b(l);t={x:n,y:o};const u=p(g(s));var h=f(u);const v=await a.getDimensions(c);var y="y"===u,w=y?"top":"left",S=y?"bottom":"right",_=y?"clientHeight":"clientWidth",E=i.reference[h]+i.reference[u]-t[u]-i.floating[h];const C=t[u]-i.reference[u],T=await(null==a.getOffsetParent?void 0:a.getOffsetParent(c));return(y=T?T[_]:0)&&await(null==a.isElement?void 0:a.isElement(T))||(y=r.floating[_]||i.floating[h]),_=E/2-C/2,E=y/2-v[h]/2-1,w=tt(d[w],E),d=tt(d[S],E),S=y-v[h]-d,y=y/2-v[h]/2+_,_=nt(w,tt(y,S)),h=null!=s.split("-")[1]&&y!=_&&0>i.reference[h]/2-(y<w?w:d)-v[h]/2?y<w?w-y:S-y:0,{[u]:t[u]-h,data:{[u]:_,centerOffset:y-_+h}}}}),dt=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:r,elements:c}=t;var l=m(e,t);const{mainAxis:d=!0,crossAxis:b=!0,fallbackPlacements:w,fallbackStrategy:S="bestFit",fallbackAxisSideDirection:E="none",flipAlignment:C=!0}=l;var T=u(l,rt);l=h(o);var x=h(a)===a;const L=await(null==r.isRTL?void 0:r.isRTL(c.floating));x=w||(x||!C?[y(a)]:function(e){let t=y(e);return[v(e),t,v(t)]}(a)),w||"none"===E||x.push(...function(e,t,n,o){let s=e.split("-")[1];return e=function(e,t,n){let o=["left","right"],s=["right","left"],i=["top","bottom"],a=["bottom","top"];switch(e){case"top":case"bottom":return n?t?s:o:t?o:s;case"left":case"right":return t?i:a;default:return[]}}(h(e),"start"===n,o),s&&(e=e.map(e=>e+"-"+s),t&&(e=e.concat(e.map(v)))),e}(a,C,E,L)),x=[a,...x],T=await _(t,T);const k=[];if(t=(null==(n=s.flip)?void 0:n.overflows)||[],d&&k.push(T[l]),b&&(n=function(e,t,n){void 0===n&&(n=!1);let o=e.split("-")[1],s=p(g(e));return e=f(s),n="x"===s?o===(n?"end":"start")?"right":"left":"start"===o?"bottom":"top",t.reference[e]>t.floating[e]&&(n=y(n)),[n,y(n)]}(o,i,L),k.push(T[n[0]],T[n[1]])),t=[...t,{placement:o,overflows:k}],!k.every(e=>0>=e)){var I,A;if(n=((null==(I=s.flip)?void 0:I.index)||0)+1,I=x[n])return{data:{index:n,overflows:t},reset:{placement:I}};if(!(I=null==(A=t.filter(e=>0>=e.overflows[0]).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:A.placement))switch(S){case"bestFit":var $;(A=null==($=t.map(e=>[e.placement,e.overflows.filter(e=>0<e).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:$[0])&&(I=A);break;case"initialPlacement":I=a}if(o!==I)return{reset:{placement:I}}}return{}}}},ut=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:o,placement:s}=t;var i=m(e,t);const{mainAxis:a=!0,crossAxis:r=!1,limiter:c={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}}}=i;var l=u(i,ct);i={x:n,y:o},l=await _(t,l);const f=g(h(s)),v=p(f);let y=i[v];return i=i[f],a&&(y=nt(y+l["y"===v?"top":"left"],tt(y,y-l["y"===v?"bottom":"right"]))),r&&(i=nt(i+l["y"===f?"top":"left"],tt(i,i-l["y"===f?"bottom":"right"]))),t=c.fn(d({},t,{[v]:y,[f]:i})),d({},t,{data:{x:t.x-n,y:t.y-o}})}}},mt=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:n,y:o,placement:s,rects:i,middlewareData:a}=t,{offset:r=0,mainAxis:c=!0,crossAxis:l=!0}=m(e,t);var u={x:n,y:o};const f=g(s),v=p(f);let y=u[v];if(u=u[f],t="number"==typeof(t=m(r,t))?{mainAxis:t,crossAxis:0}:d({mainAxis:0,crossAxis:0},t),c){var b="y"===v?"height":"width",w=i.reference[v]-i.floating[b]+t.mainAxis;b=i.reference[v]+i.reference[b]-t.mainAxis,y<w?y=w:y>b&&(y=b)}if(l){var S,_;b="y"===v?"width":"height";const e=["top","left"].includes(h(s));w=i.reference[f]-i.floating[b]+(e&&(null==(S=a.offset)?void 0:S[f])||0)+(e?0:t.crossAxis),S=i.reference[f]+i.reference[b]+(e?0:(null==(_=a.offset)?void 0:_[f])||0)-(e?t.crossAxis:0),u<w?u=w:u>S&&(u=S)}return{[v]:y,[f]:u}}}},ht={x:0,y:0},pt={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{rect:t,offsetParent:n,strategy:o}=e;var s=k(n);let i=T(n);if(n===i)return t;e={scrollLeft:0,scrollTop:0};let a={x:1,y:1};var r=0,c=0;return(s||!s&&"fixed"!==o)&&(("body"!==E(n)||A(i))&&(e=B(n)),k(n)&&(s=z(n),a=H(n),r=s.x+n.clientLeft,c=s.y+n.clientTop)),{width:t.width*a.x,height:t.height*a.y,x:t.x*a.x-e.scrollLeft*a.x+r,y:t.y*a.y-e.scrollTop*a.y+c}},getDocumentElement:T,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:o,strategy:s}=e;return{width:(e=(e=[..."clippingAncestors"===n?X(t,this._c):[].concat(n),o]).reduce((e,n)=>(n=U(t,n,s),e.top=nt(n.top,e.top),e.right=tt(n.right,e.right),e.bottom=tt(n.bottom,e.bottom),e.left=nt(n.left,e.left),e),U(t,e[0],s))).right-e.left,height:e.bottom-e.top,x:e.left,y:e.top}},getOffsetParent:G,getElementRects:async function(e){let{reference:t,floating:n,strategy:o}=e;e=this.getDimensions;var s=await(this.getOffsetParent||G)(n),i=k(s);let a=T(s),r="fixed"===o,c=z(t,!0,r,s),l={scrollLeft:0,scrollTop:0};var u=0,m=0;return(i||!i&&!r)&&(("body"!==E(s)||A(a))&&(l=B(s)),i?(u=(i=z(s,!0,r,s)).x+s.clientLeft,m=i.y+s.clientTop):a&&(u=W(a))),{reference:{x:c.left+l.scrollLeft-u,y:c.top+l.scrollTop-m,width:c.width,height:c.height},floating:d({x:0,y:0},await e(n))}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){return R(e)},getScale:H,isElement:L,isRTL:function(e){return"rtl"===P(e).direction}},ft=(e,t,n)=>{var o=new Map;return n=d({platform:pt},n),o=d({},n.platform,{_c:o}),(async(e,t,n)=>{const{placement:o="bottom",strategy:s="absolute",middleware:i=[],platform:a}=n;n=i.filter(Boolean);const r=await(null==a.isRTL?void 0:a.isRTL(t));let c=await a.getElementRects({reference:e,floating:t,strategy:s}),{x:l,y:u}=S(c,o,r),m=o,h={},p=0;for(let f=0;f<n.length;f++){const{name:i,fn:g}=n[f],{x:v,y:y,data:b,reset:w}=await g({x:l,y:u,initialPlacement:o,placement:m,strategy:s,middlewareData:h,rects:c,platform:a,elements:{reference:e,floating:t}});l=null!=v?v:l,u=null!=y?y:u,h=d({},h,{[i]:d({},h[i],b)}),w&&50>=p&&(p++,"object"==typeof w&&(w.placement&&(m=w.placement),w.rects&&(c=!0===w.rects?await a.getElementRects({reference:e,floating:t,strategy:s}):w.rects),({x:l,y:u}=S(c,m,r))),f=-1)}return{x:l,y:u,placement:m,strategy:s,middlewareData:h}})(e,t,d({},n,{platform:o}))},gt=["width","height"],vt=[],yt=[],bt=[],wt=[],St=Promise.resolve(),_t=!1,Et=new Set,Ct=0,Tt=new Set;class xt{$destroy(){ye(this,1),this.$destroy=Q}$on(e,t){if(!te(t))return Q;let n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{let e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&0!==Object.keys(e).length&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class Lt extends xt{constructor(e){super(),be(this,e,Se,we,ne,{config:6,step:7})}}class kt extends xt{constructor(e){super(),be(this,e,xe,Te,ne,{step:0})}}class It extends xt{constructor(e){super(),be(this,e,ke,Le,ne,{cancelIcon:0,step:2})}}class At extends xt{constructor(e){super(),be(this,e,Ae,Ie,ne,{labelId:1,element:0,title:2})}}class $t extends xt{constructor(e){super(),be(this,e,Pe,Me,ne,{labelId:0,step:1})}}class Dt extends xt{constructor(e){super(),be(this,e,qe,Be,ne,{descriptionId:1,element:0,step:2})}}class Mt extends xt{constructor(e){super(),be(this,e,He,Fe,ne,{descriptionId:0,labelId:1,step:2})}}class Pt extends xt{constructor(e){super(),be(this,e,Ue,ze,ne,{classPrefix:11,element:0,descriptionId:2,firstFocusableElement:8,focusableElements:9,labelId:3,lastFocusableElement:10,step:4,dataStepId:1,getElement:12})}get getElement(){return this.$$.ctx[12]}}class Bt extends Qe{constructor(e,t={}){return super(e,t),this.tour=e,this.classPrefix=this.tour.options?c(this.tour.options.classPrefix):"",this.styles=e.styles,this._resolvedAttachTo=null,r(this),this._setOptions(t),this}cancel(){this.tour.cancel(),this.trigger("cancel")}complete(){this.tour.complete(),this.trigger("complete")}destroy(){this.cleanup&&this.cleanup(),this.cleanup=null,this.el instanceof HTMLElement&&(this.el.remove(),this.el=null),this._updateStepTargetOnHide(),this.trigger("destroy")}getTour(){return this.tour}hide(){this.tour.modal.hide(),this.trigger("before-hide"),this.el&&(this.el.hidden=!0),this._updateStepTargetOnHide(),this.trigger("hide")}_resolveAttachToOptions(){let e=this.options.attachTo||{},t=Object.assign({},e);if(i(t.element)&&(t.element=t.element.call(this)),a(t.element)){try{t.element=document.querySelector(t.element)}catch(n){}t.element||console.error(`The element for this Shepherd step was not found ${e.element}`)}return this._resolvedAttachTo=t}_getResolvedAttachToOptions(){return null===this._resolvedAttachTo?this._resolveAttachToOptions():this._resolvedAttachTo}isOpen(){return!(!this.el||this.el.hidden)}show(){return i(this.options.beforeShowPromise)?Promise.resolve(this.options.beforeShowPromise()).then(()=>this._show()):Promise.resolve(this._show())}updateStepOptions(e){Object.assign(this.options,e),this.shepherdElementComponent&&this.shepherdElementComponent.$set({step:this})}getElement(){return this.el}getTarget(){return this.target}_createTooltipContent(){return this.shepherdElementComponent=new Pt({target:this.tour.options.stepsContainer||document.body,props:{classPrefix:this.classPrefix,descriptionId:`${this.id}-description`,labelId:`${this.id}-label`,step:this,styles:this.styles}}),this.shepherdElementComponent.getElement()}_scrollTo(e){let{element:t}=this._getResolvedAttachToOptions();i(this.options.scrollToHandler)?this.options.scrollToHandler(t):t instanceof Element&&"function"==typeof t.scrollIntoView&&t.scrollIntoView(e)}_getClassOptions(e){var t=this.tour&&this.tour.options&&this.tour.options.defaultStepOptions;return t=t&&t.classes?t.classes:"",e=[...(e.classes?e.classes:"").split(" "),...t.split(" ")],e=new Set(e),Array.from(e).join(" ").trim()}_setOptions(e={}){let t=this.tour&&this.tour.options&&this.tour.options.defaultStepOptions;t=Je({},t||{}),this.options=Object.assign({arrow:!0},t,e,{floatingUIOptions:Je(t.floatingUIOptions||{},e.floatingUIOptions||{})});let{when:n}=this.options;this.options.classes=this._getClassOptions(e),this.destroy(),this.id=this.options.id||`step-${l()}`,n&&Object.keys(n).forEach(e=>{this.on(e,n[e],this)})}_setupElements(){void 0!==this.el&&this.destroy(),this.el=this._createTooltipContent(),this.options.advanceOn&&function(e){let{event:t,selector:n}=e.options.advanceOn||{};if(!t)return console.error("advanceOn was defined, but no event name was passed.");{let s,i=function(e,t){return n=>{if(t.isOpen()){let o=t.el&&n.currentTarget===t.el;(void 0!==e&&n.currentTarget.matches(e)||o)&&t.tour.next()}}}(n,e);try{s=document.querySelector(n)}catch(o){}if(void 0!==n&&!s)return console.error(`No element was found for the selector supplied to advanceOn: ${n}`);s?(s.addEventListener(t,i),e.on("destroy",()=>s.removeEventListener(t,i))):(document.body.addEventListener(t,i,!0),e.on("destroy",()=>document.body.removeEventListener(t,i,!0)))}}(this),J(this)}_show(){this.trigger("before-show"),this._resolveAttachToOptions(),this._setupElements(),this.tour.modal||this.tour._setupModal(),this.tour.modal.setupForStep(this),this._styleTargetElementForStep(this),this.el.hidden=!1,this.options.scrollTo&&setTimeout(()=>{this._scrollTo(this.options.scrollTo)}),this.el.hidden=!1;let e=this.shepherdElementComponent.getElement(),t=this.target||document.body;t.classList.add(`${this.classPrefix}shepherd-enabled`),t.classList.add(`${this.classPrefix}shepherd-target`),e.classList.add("shepherd-enabled"),this.trigger("show")}_styleTargetElementForStep(e){let t=e.target;t&&(e.options.highlightClass&&t.classList.add(e.options.highlightClass),t.classList.remove("shepherd-target-click-disabled"),!1===e.options.canClickTarget&&t.classList.add("shepherd-target-click-disabled"))}_updateStepTargetOnHide(){let e=this.target||document.body;this.options.highlightClass&&e.classList.remove(this.options.highlightClass),e.classList.remove("shepherd-target-click-disabled",`${this.classPrefix}shepherd-enabled`,`${this.classPrefix}shepherd-target`)}}class qt extends xt{constructor(e){super(),be(this,e,Ve,Ye,ne,{element:0,openingProperties:4,getElement:5,closeModalOpening:6,hide:7,positionModal:8,setupForStep:9,show:10})}get getElement(){return this.$$.ctx[5]}get closeModalOpening(){return this.$$.ctx[6]}get hide(){return this.$$.ctx[7]}get positionModal(){return this.$$.ctx[8]}get setupForStep(){return this.$$.ctx[9]}get show(){return this.$$.ctx[10]}}let Ot=new Qe;class Nt{constructor(){}}return"undefined"==typeof window?Object.assign(Ot,{Tour:Nt,Step:Nt}):Object.assign(Ot,{Tour:class extends Qe{constructor(e={}){return super(e),r(this),this.options=Object.assign({},{exitOnEsc:!0,keyboardNavigation:!0},e),this.classPrefix=c(this.options.classPrefix),this.steps=[],this.addSteps(this.options.steps),"active cancel complete inactive show start".split(" ").map(e=>{(e=>{this.on(e,t=>{(t=t||{}).tour=this,Ot.trigger(e,t)})})(e)}),this._setTourID(),this}addStep(e,t){return e instanceof Bt?e.tour=this:e=new Bt(this,e),void 0!==t?this.steps.splice(t,0,e):this.steps.push(e),e}addSteps(e){return Array.isArray(e)&&e.forEach(e=>{this.addStep(e)}),this}back(){let e=this.steps.indexOf(this.currentStep);this.show(e-1,!1)}async cancel(){if(this.options.confirmCancel){let e=this.options.confirmCancelMessage||"Are you sure you want to stop the tour?";("function"==typeof this.options.confirmCancel?await this.options.confirmCancel():window.confirm(e))&&this._done("cancel")}else this._done("cancel")}complete(){this._done("complete")}getById(e){return this.steps.find(t=>t.id===e)}getCurrentStep(){return this.currentStep}hide(){let e=this.getCurrentStep();if(e)return e.hide()}isActive(){return Ot.activeTour===this}next(){let e=this.steps.indexOf(this.currentStep);e===this.steps.length-1?this.complete():this.show(e+1,!0)}removeStep(e){let t=this.getCurrentStep();this.steps.some((t,n)=>{if(t.id===e)return t.isOpen()&&t.hide(),t.destroy(),this.steps.splice(n,1),!0}),t&&t.id===e&&(this.currentStep=void 0,this.steps.length?this.show(0):this.cancel())}show(e=0,t=!0){(e=a(e)?this.getById(e):this.steps[e])&&(this._updateStateBeforeShow(),i(e.options.showOn)&&!e.options.showOn()?this._skipStep(e,t):(this.trigger("show",{step:e,previous:this.currentStep}),this.currentStep=e,e.show()))}start(){this.trigger("start"),this.focusedElBeforeOpen=document.activeElement,this.currentStep=null,this._setupModal(),this._setupActiveTour(),this.next()}_done(e){let t=this.steps.indexOf(this.currentStep);Array.isArray(this.steps)&&this.steps.forEach(e=>e.destroy()),function(e){e&&(({steps:e}=e),e.forEach(e=>{e.options&&!1===e.options.canClickTarget&&e.options.attachTo&&e.target instanceof HTMLElement&&e.target.classList.remove("shepherd-target-click-disabled")}))}(this),this.trigger(e,{index:t}),Ot.activeTour=null,this.trigger("inactive",{tour:this}),this.modal&&this.modal.hide(),"cancel"!==e&&"complete"!==e||!this.modal||(e=document.querySelector(".shepherd-modal-overlay-container"))&&e.remove(),this.focusedElBeforeOpen instanceof HTMLElement&&this.focusedElBeforeOpen.focus()}_setupActiveTour(){this.trigger("active",{tour:this}),Ot.activeTour=this}_setupModal(){this.modal=new qt({target:this.options.modalContainer||document.body,props:{classPrefix:this.classPrefix,styles:this.styles}})}_skipStep(e,t){(e=this.steps.indexOf(e))===this.steps.length-1?this.complete():this.show(t?e+1:e-1,t)}_updateStateBeforeShow(){this.currentStep&&this.currentStep.hide(),this.isActive()||this._setupActiveTour()}_setTourID(){this.id=`${this.options.tourName||"tour"}--${l()}`}},Step:Bt}),Ot},"object"==typeof e&&void 0!==t?t.exports=kt():"function"==typeof define&&define.amd?define(kt):(Lt="undefined"!=typeof globalThis?globalThis:Lt||self).Shepherd=kt(),window.isRtl=window.Helpers.isRtl(),window.isDarkStyle=window.Helpers.isDarkStyle();let It,At=!1;document.getElementById("layout-menu")&&(At=document.getElementById("layout-menu").classList.contains("menu-horizontal")),function(){var e,t;setTimeout(function(){window.Helpers.initCustomOptionCheck()},1e3),"undefined"!=typeof Waves&&(Waves.init(),Waves.attach(".btn[class*='btn-']:not(.position-relative):not([class*='btn-outline-']):not([class*='btn-label-'])",["waves-light"]),Waves.attach("[class*='btn-outline-']:not(.position-relative)"),Waves.attach("[class*='btn-label-']:not(.position-relative)"),Waves.attach(".pagination .page-item .page-link"),Waves.attach(".dropdown-menu .dropdown-item"),Waves.attach(".light-style .list-group .list-group-item-action"),Waves.attach(".dark-style .list-group .list-group-item-action",["waves-light"]),Waves.attach(".nav-tabs:not(.nav-tabs-widget) .nav-item .nav-link"),Waves.attach(".nav-pills .nav-item .nav-link",["waves-light"])),document.querySelectorAll("#layout-menu").forEach(function(e){It=new Menu(e,{orientation:At?"horizontal":"vertical",closeChildren:!!At,showDropdownOnHover:localStorage.getItem("templateCustomizer-"+templateName+"--ShowDropdownOnHover")?"true"===localStorage.getItem("templateCustomizer-"+templateName+"--ShowDropdownOnHover"):void 0===window.templateCustomizer||window.templateCustomizer.settings.defaultShowDropdownOnHover}),window.Helpers.scrollToActive(!1),window.Helpers.mainMenu=It}),document.querySelectorAll(".layout-menu-toggle").forEach(e=>{e.addEventListener("click",e=>{if(e.preventDefault(),window.Helpers.toggleCollapsed(),config.enableMenuLocalStorage&&!window.Helpers.isSmallScreen())try{localStorage.setItem("templateCustomizer-"+templateName+"--LayoutCollapsed",String(window.Helpers.isCollapsed()));let e=document.querySelector(".template-customizer-layouts-options");if(e){let t=window.Helpers.isCollapsed()?"collapsed":"expanded";e.querySelector(`input[value="${t}"]`).click()}}catch(o){}})}),window.Helpers.swipeIn(".drag-target",function(e){window.Helpers.setCollapsed(!1)}),window.Helpers.swipeOut("#layout-menu",function(e){window.Helpers.isSmallScreen()&&window.Helpers.setCollapsed(!0)});let n=document.getElementsByClassName("menu-inner"),s=document.getElementsByClassName("menu-inner-shadow")[0];n.length>0&&s&&n[0].addEventListener("ps-scroll-y",function(){const e=this.querySelector(".ps__thumb-y").offsetTop;s.classList.toggle("d-none",!e)});let i=document.querySelector(".dropdown-style-switcher");const a=document.documentElement.getAttribute("data-style");let r=localStorage.getItem("templateCustomizer-"+templateName+"--Style")||((null==(t=null==(e=window.templateCustomizer)?void 0:e.settings)?void 0:t.defaultStyle)??"light");
//!if there is no Customizer then use default style as light
if(window.templateCustomizer&&i){[].slice.call(i.children[1].querySelectorAll(".dropdown-item")).forEach(function(e){e.classList.remove("active"),e.addEventListener("click",function(){let e=this.getAttribute("data-theme");"light"===e?window.templateCustomizer.setStyle("light"):"dark"===e?window.templateCustomizer.setStyle("dark"):window.templateCustomizer.setStyle("system")}),e.getAttribute("data-theme")===a&&e.classList.add("active")});const e=i.querySelector("i");"light"===r?(e.classList.add("ti-sun"),new bootstrap.Tooltip(e,{title:"Light Mode",fallbackPlacements:["bottom"]})):"dark"===r?(e.classList.add("ti-moon-stars"),new bootstrap.Tooltip(e,{title:"Dark Mode",fallbackPlacements:["bottom"]})):(e.classList.add("ti-device-desktop-analytics"),new bootstrap.Tooltip(e,{title:"System Mode",fallbackPlacements:["bottom"]}))}var c;"system"===(c=r)&&(c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),[].slice.call(document.querySelectorAll("[data-app-"+c+"-img]")).map(function(e){const t=e.getAttribute("data-app-"+c+"-img");e.src=assetsPath+"img/"+t}),"undefined"!=typeof i18next&&"undefined"!=typeof i18NextHttpBackend&&i18next.use(i18NextHttpBackend).init({lng:window.templateCustomizer?window.templateCustomizer.settings.lang:"en",debug:!1,fallbackLng:"en",backend:{loadPath:assetsPath+"json/locales/{{lng}}.json"},returnObjects:!0}).then(function(e){d()});let l=document.getElementsByClassName("dropdown-language");if(l.length){let e=function(e){"rtl"===e?"true"!==localStorage.getItem("templateCustomizer-"+templateName+"--Rtl")&&window.templateCustomizer&&window.templateCustomizer.setRtl(!0):"true"===localStorage.getItem("templateCustomizer-"+templateName+"--Rtl")&&window.templateCustomizer&&window.templateCustomizer.setRtl(!1)},t=l[0].querySelectorAll(".dropdown-item");for(let n=0;n<t.length;n++)t[n].addEventListener("click",function(){let t=this.getAttribute("data-language"),n=this.getAttribute("data-text-direction");for(let e of this.parentNode.children)for(var o=e.parentElement.parentNode.firstChild;o;)1===o.nodeType&&o!==o.parentElement&&o.querySelector(".dropdown-item").classList.remove("active"),o=o.nextSibling;this.classList.add("active"),i18next.changeLanguage(t,(o,s)=>{if(window.templateCustomizer&&window.templateCustomizer.setLang(t),e(n),o)return console.log("something went wrong loading",o);d()})})}function d(){let e=document.querySelectorAll("[data-i18n]"),t=document.querySelector('.dropdown-item[data-language="'+i18next.language+'"]');t&&t.click(),e.forEach(function(e){e.innerHTML=i18next.t(e.dataset.i18n)})}const u=document.querySelector(".dropdown-notifications-all"),m=document.querySelectorAll(".dropdown-notifications-read");u&&u.addEventListener("click",e=>{m.forEach(e=>{e.closest(".dropdown-notifications-item").classList.add("marked-as-read")})}),m&&m.forEach(e=>{e.addEventListener("click",t=>{e.closest(".dropdown-notifications-item").classList.toggle("marked-as-read")})}),document.querySelectorAll(".dropdown-notifications-archive").forEach(e=>{e.addEventListener("click",t=>{e.closest(".dropdown-notifications-item").remove()})}),[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)});const h=function(e){"show.bs.collapse"==e.type||"show.bs.collapse"==e.type?e.target.closest(".accordion-item").classList.add("active"):e.target.closest(".accordion-item").classList.remove("active")};[].slice.call(document.querySelectorAll(".accordion")).map(function(e){e.addEventListener("show.bs.collapse",h),e.addEventListener("hide.bs.collapse",h)}),window.Helpers.setAutoUpdate(!0),window.Helpers.initPasswordToggle(),window.Helpers.initSpeechToText(),window.Helpers.initNavbarDropdownScrollbar();let p=document.querySelector("[data-template^='horizontal-menu']");if(p&&(window.innerWidth<window.Helpers.LAYOUT_BREAKPOINT?window.Helpers.setNavbarFixed("fixed"):window.Helpers.setNavbarFixed("")),window.addEventListener("resize",function(e){window.innerWidth>=window.Helpers.LAYOUT_BREAKPOINT&&document.querySelector(".search-input-wrapper")&&(document.querySelector(".search-input-wrapper").classList.add("d-none"),document.querySelector(".search-input").value=""),p&&(window.innerWidth<window.Helpers.LAYOUT_BREAKPOINT?window.Helpers.setNavbarFixed("fixed"):window.Helpers.setNavbarFixed(""),setTimeout(function(){window.innerWidth<window.Helpers.LAYOUT_BREAKPOINT?document.getElementById("layout-menu")&&document.getElementById("layout-menu").classList.contains("menu-horizontal")&&It.switchMenu("vertical"):document.getElementById("layout-menu")&&document.getElementById("layout-menu").classList.contains("menu-vertical")&&It.switchMenu("horizontal")},100))},!0),!At&&!window.Helpers.isSmallScreen()&&("undefined"!=typeof TemplateCustomizer&&(window.templateCustomizer.settings.defaultMenuCollapsed?window.Helpers.setCollapsed(!0,!1):window.Helpers.setCollapsed(!1,!1)),"undefined"!=typeof config&&config.enableMenuLocalStorage))try{null!==localStorage.getItem("templateCustomizer-"+templateName+"--LayoutCollapsed")&&window.Helpers.setCollapsed("true"===localStorage.getItem("templateCustomizer-"+templateName+"--LayoutCollapsed"),!1)}catch(o){}}(),"undefined"!=typeof $&&$(function(){window.Helpers.initSidebarToggle();var e=$(".search-toggler"),t=$(".search-input-wrapper"),n=$(".search-input"),o=$(".content-backdrop");if(e.length&&e.on("click",function(){t.length&&(t.toggleClass("d-none"),n.focus())}),$(document).on("keydown",function(e){let o=e.ctrlKey,s=191===e.which;o&&s&&t.length&&(t.toggleClass("d-none"),n.focus())}),setTimeout(function(){var e=$(".twitter-typeahead");n.on("focus",function(){t.hasClass("container-xxl")?(t.find(e).addClass("container-xxl"),e.removeClass("container-fluid")):t.hasClass("container-fluid")&&(t.find(e).addClass("container-fluid"),e.removeClass("container-xxl"))})},10),n.length){var s=function(e){return function(t,n){let o;o=[],e.filter(function(e){if(e.name.toLowerCase().startsWith(t.toLowerCase()))o.push(e);else{if(e.name.toLowerCase().startsWith(t.toLowerCase())||!e.name.toLowerCase().includes(t.toLowerCase()))return[];o.push(e),o.sort(function(e,t){return t.name<e.name?1:-1})}}),n(o)}},i="search-vertical.json";$("#layout-menu").hasClass("menu-horizontal")&&(i="search-horizontal.json");var a,r=$.ajax({url:assetsPath+"json/"+i,dataType:"json",async:!1}).responseJSON;n.each(function(){var e=$(this);n.typeahead({hint:!1,classNames:{menu:"tt-menu navbar-search-suggestion",cursor:"active",suggestion:"suggestion d-flex justify-content-between px-4 py-2 w-100"}},{name:"pages",display:"name",limit:5,source:s(r.pages),templates:{header:'<h6 class="suggestions-header text-primary mb-0 mx-4 mt-3 pb-2">Pages</h6>',suggestion:function({url:e,icon:t,name:n}){return'<a href="'+e+'"><div><i class="ti '+t+' me-2"></i><span class="align-middle">'+n+"</span></div></a>"},notFound:'<div class="not-found px-4 py-2"><h6 class="suggestions-header text-primary mb-2">Pages</h6><p class="py-2 mb-0"><i class="ti ti-alert-circle ti-xs me-2"></i> No Results Found</p></div>'}},{name:"files",display:"name",limit:4,source:s(r.files),templates:{header:'<h6 class="suggestions-header text-primary mb-0 mx-4 mt-3 pb-2">Files</h6>',suggestion:function({src:e,name:t,subtitle:n,meta:o}){return'<a href="javascript:;"><div class="d-flex w-50"><img class="me-3" src="'+assetsPath+e+'" alt="'+t+'" height="32"><div class="w-75"><h6 class="mb-0">'+t+'</h6><small class="text-muted">'+n+'</small></div></div><small class="text-muted">'+o+"</small></a>"},notFound:'<div class="not-found px-4 py-2"><h6 class="suggestions-header text-primary mb-2">Files</h6><p class="py-2 mb-0"><i class="ti ti-alert-circle ti-xs me-2"></i> No Results Found</p></div>'}},{name:"members",display:"name",limit:4,source:s(r.members),templates:{header:'<h6 class="suggestions-header text-primary mb-0 mx-4 mt-3 pb-2">Members</h6>',suggestion:function({name:e,src:t,subtitle:n}){return'<a href="app-user-view-account.html"><div class="d-flex align-items-center"><img class="rounded-circle me-3" src="'+assetsPath+t+'" alt="'+e+'" height="32"><div class="user-info"><h6 class="mb-0">'+e+'</h6><small class="text-muted">'+n+"</small></div></div></a>"},notFound:'<div class="not-found px-4 py-2"><h6 class="suggestions-header text-primary mb-2">Members</h6><p class="py-2 mb-0"><i class="ti ti-alert-circle ti-xs me-2"></i> No Results Found</p></div>'}}).bind("typeahead:render",function(){o.addClass("show").removeClass("fade")}).bind("typeahead:select",function(e,t){t.url&&(window.location=t.url)}).bind("typeahead:close",function(){n.val(""),e.typeahead("val",""),t.addClass("d-none"),o.addClass("fade").removeClass("show")}),n.on("keyup",function(){""==n.val()&&o.addClass("fade").removeClass("show")})}),$(".navbar-search-suggestion").each(function(){a=new PerfectScrollbar($(this)[0],{wheelPropagation:!1,suppressScrollX:!0})}),n.on("keyup",function(){a.update()})}}),console.log("[Main Entry] All modules loaded successfully")}},function(){return t||(0,e[o(e)[0]])((t={exports:{}}).exports,t),t.exports});export default i();
//# sourceMappingURL=main-Bl0STsa9.js.map
